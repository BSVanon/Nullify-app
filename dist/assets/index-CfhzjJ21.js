var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=e=>{let n={};for(var r in e)t(n,r,{get:e[r],enumerable:!0});return n},c=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},l=(n,r,a)=>(a=n==null?{}:e(i(n)),c(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),u=(e=>typeof require<`u`?require:typeof Proxy<`u`?new Proxy(e,{get:(e,t)=>(typeof require<`u`?require:e)[t]}):e)(function(e){if(typeof require<`u`)return require.apply(this,arguments);throw Error('Calling `require` for "'+e+"\" in an environment that doesn't expose the `require` function.")});(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var d=o((e=>{var t=Symbol.for(`react.element`),n=Symbol.for(`react.portal`),r=Symbol.for(`react.fragment`),i=Symbol.for(`react.strict_mode`),a=Symbol.for(`react.profiler`),o=Symbol.for(`react.provider`),s=Symbol.for(`react.context`),c=Symbol.for(`react.forward_ref`),l=Symbol.for(`react.suspense`),u=Symbol.for(`react.memo`),d=Symbol.for(`react.lazy`),f=Symbol.iterator;function p(e){return typeof e!=`object`||!e?null:(e=f&&e[f]||e[`@@iterator`],typeof e==`function`?e:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if(typeof e!=`object`&&typeof e!=`function`&&e!=null)throw Error(`setState(...): takes an object of state variables to update or a function which returns an object of state variables.`);this.updater.enqueueSetState(this,e,t,`setState`)},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,`forceUpdate`)};function v(){}v.prototype=_.prototype;function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}var b=y.prototype=new v;b.constructor=y,h(b,_.prototype),b.isPureReactComponent=!0;var x=Array.isArray,S=Object.prototype.hasOwnProperty,C={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function T(e,n,r){var i,a={},o=null,s=null;if(n!=null)for(i in n.ref!==void 0&&(s=n.ref),n.key!==void 0&&(o=``+n.key),n)S.call(n,i)&&!w.hasOwnProperty(i)&&(a[i]=n[i]);var c=arguments.length-2;if(c===1)a.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps,c)a[i]===void 0&&(a[i]=c[i]);return{$$typeof:t,type:e,key:o,ref:s,props:a,_owner:C.current}}function E(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function D(e){return typeof e==`object`&&!!e&&e.$$typeof===t}function O(e){var t={"=":`=0`,":":`=2`};return`$`+e.replace(/[=:]/g,function(e){return t[e]})}var k=/\/+/g;function A(e,t){return typeof e==`object`&&e&&e.key!=null?O(``+e.key):t.toString(36)}function ee(e,r,i,a,o){var s=typeof e;(s===`undefined`||s===`boolean`)&&(e=null);var c=!1;if(e===null)c=!0;else switch(s){case`string`:case`number`:c=!0;break;case`object`:switch(e.$$typeof){case t:case n:c=!0}}if(c)return c=e,o=o(c),e=a===``?`.`+A(c,0):a,x(o)?(i=``,e!=null&&(i=e.replace(k,`$&/`)+`/`),ee(o,r,i,``,function(e){return e})):o!=null&&(D(o)&&(o=E(o,i+(!o.key||c&&c.key===o.key?``:(``+o.key).replace(k,`$&/`)+`/`)+e)),r.push(o)),1;if(c=0,a=a===``?`.`:a+`:`,x(e))for(var l=0;l<e.length;l++){s=e[l];var u=a+A(s,l);c+=ee(s,r,i,u,o)}else if(u=p(e),typeof u==`function`)for(e=u.call(e),l=0;!(s=e.next()).done;)s=s.value,u=a+A(s,l++),c+=ee(s,r,i,u,o);else if(s===`object`)throw r=String(e),Error(`Objects are not valid as a React child (found: `+(r===`[object Object]`?`object with keys {`+Object.keys(e).join(`, `)+`}`:r)+`). If you meant to render a collection of children, use an array instead.`);return c}function te(e,t,n){if(e==null)return e;var r=[],i=0;return ee(e,r,``,``,function(e){return t.call(n,e,i++)}),r}function ne(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(t){(e._status===0||e._status===-1)&&(e._status=1,e._result=t)},function(t){(e._status===0||e._status===-1)&&(e._status=2,e._result=t)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var j={current:null},M={transition:null},re={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:M,ReactCurrentOwner:C};e.Children={map:te,forEach:function(e,t,n){te(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return te(e,function(){t++}),t},toArray:function(e){return te(e,function(e){return e})||[]},only:function(e){if(!D(e))throw Error(`React.Children.only expected to receive a single React element child.`);return e}},e.Component=_,e.Fragment=r,e.Profiler=a,e.PureComponent=y,e.StrictMode=i,e.Suspense=l,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=re,e.cloneElement=function(e,n,r){if(e==null)throw Error(`React.cloneElement(...): The argument must be a React element, but you passed `+e+`.`);var i=h({},e.props),a=e.key,o=e.ref,s=e._owner;if(n!=null){if(n.ref!==void 0&&(o=n.ref,s=C.current),n.key!==void 0&&(a=``+n.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in n)S.call(n,l)&&!w.hasOwnProperty(l)&&(i[l]=n[l]===void 0&&c!==void 0?c[l]:n[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:t,type:e.type,key:a,ref:o,props:i,_owner:s}},e.createContext=function(e){return e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:o,_context:e},e.Consumer=e},e.createElement=T,e.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},e.createRef=function(){return{current:null}},e.forwardRef=function(e){return{$$typeof:c,render:e}},e.isValidElement=D,e.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:ne}},e.memo=function(e,t){return{$$typeof:u,type:e,compare:t===void 0?null:t}},e.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},e.unstable_act=function(){throw Error(`act(...) is not supported in production builds of React.`)},e.useCallback=function(e,t){return j.current.useCallback(e,t)},e.useContext=function(e){return j.current.useContext(e)},e.useDebugValue=function(){},e.useDeferredValue=function(e){return j.current.useDeferredValue(e)},e.useEffect=function(e,t){return j.current.useEffect(e,t)},e.useId=function(){return j.current.useId()},e.useImperativeHandle=function(e,t,n){return j.current.useImperativeHandle(e,t,n)},e.useInsertionEffect=function(e,t){return j.current.useInsertionEffect(e,t)},e.useLayoutEffect=function(e,t){return j.current.useLayoutEffect(e,t)},e.useMemo=function(e,t){return j.current.useMemo(e,t)},e.useReducer=function(e,t,n){return j.current.useReducer(e,t,n)},e.useRef=function(e){return j.current.useRef(e)},e.useState=function(e){return j.current.useState(e)},e.useSyncExternalStore=function(e,t,n){return j.current.useSyncExternalStore(e,t,n)},e.useTransition=function(){return j.current.useTransition()},e.version=`18.2.0`})),f=o(((e,t)=>{t.exports=d()})),p=o((e=>{function t(e,t){var n=e.length;e.push(t);a:for(;0<n;){var r=n-1>>>1,a=e[r];if(0<i(a,t))e[r]=t,e[n]=a,n=r;else break a}}function n(e){return e.length===0?null:e[0]}function r(e){if(e.length===0)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;a:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>i(c,n))l<a&&0>i(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else if(l<a&&0>i(u,n))e[r]=u,e[l]=n,r=l;else break a}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return n===0?e.id-t.id:n}if(typeof performance==`object`&&typeof performance.now==`function`){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var c=[],l=[],u=1,d=null,f=3,p=!1,m=!1,h=!1,g=typeof setTimeout==`function`?setTimeout:null,_=typeof clearTimeout==`function`?clearTimeout:null,v=typeof setImmediate<`u`?setImmediate:null;typeof navigator<`u`&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(e){for(var i=n(l);i!==null;){if(i.callback===null)r(l);else if(i.startTime<=e)r(l),i.sortIndex=i.expirationTime,t(c,i);else break;i=n(l)}}function b(e){if(h=!1,y(e),!m)if(n(c)!==null)m=!0,te(x);else{var t=n(l);t!==null&&ne(b,t.startTime-e)}}function x(t,i){m=!1,h&&(h=!1,_(w),w=-1),p=!0;var a=f;try{for(y(i),d=n(c);d!==null&&(!(d.expirationTime>i)||t&&!D());){var o=d.callback;if(typeof o==`function`){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=i);i=e.unstable_now(),typeof s==`function`?d.callback=s:d===n(c)&&r(c),y(i)}else r(c);d=n(c)}if(d!==null)var u=!0;else{var g=n(l);g!==null&&ne(b,g.startTime-i),u=!1}return u}finally{d=null,f=a,p=!1}}var S=!1,C=null,w=-1,T=5,E=-1;function D(){return!(e.unstable_now()-E<T)}function O(){if(C!==null){var t=e.unstable_now();E=t;var n=!0;try{n=C(!0,t)}finally{n?k():(S=!1,C=null)}}else S=!1}var k;if(typeof v==`function`)k=function(){v(O)};else if(typeof MessageChannel<`u`){var A=new MessageChannel,ee=A.port2;A.port1.onmessage=O,k=function(){ee.postMessage(null)}}else k=function(){g(O,0)};function te(e){C=e,S||(S=!0,k())}function ne(t,n){w=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,te(x))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error(`forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported`):T=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch(typeof a==`object`&&a?(a=a.delay,a=typeof a==`number`&&0<a?o+a:o):a=o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return s=a+s,r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s,sortIndex:-1},a>o?(r.sortIndex=a,t(l,r),n(c)===null&&r===n(l)&&(h?(_(w),w=-1):h=!0,ne(b,a-o))):(r.sortIndex=s,t(c,r),m||p||(m=!0,te(x))),r},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}})),m=o(((e,t)=>{t.exports=p()})),h=o((e=>{var t=f(),n=m();function r(e){for(var t=`https://reactjs.org/docs/error-decoder.html?invariant=`+e,n=1;n<arguments.length;n++)t+=`&args[]=`+encodeURIComponent(arguments[n]);return`Minified React error #`+e+`; visit `+t+` for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`}var i=new Set,a={};function o(e,t){s(e,t),s(e+`Capture`,t)}function s(e,t){for(a[e]=t,e=0;e<t.length;e++)i.add(t[e])}var c=!(typeof window>`u`||window.document===void 0||window.document.createElement===void 0),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function h(e){return l.call(p,e)?!0:l.call(d,e)?!1:u.test(e)?p[e]=!0:(d[e]=!0,!1)}function g(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case`function`:case`symbol`:return!0;case`boolean`:return r?!1:n===null?(e=e.toLowerCase().slice(0,5),e!==`data-`&&e!==`aria-`):!n.acceptsBooleans;default:return!1}}function _(e,t,n,r){if(t==null||g(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function v(e,t,n,r,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var y={};`children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style`.split(` `).forEach(function(e){y[e]=new v(e,0,!1,e,null,!1,!1)}),[[`acceptCharset`,`accept-charset`],[`className`,`class`],[`htmlFor`,`for`],[`httpEquiv`,`http-equiv`]].forEach(function(e){var t=e[0];y[t]=new v(t,1,!1,e[1],null,!1,!1)}),[`contentEditable`,`draggable`,`spellCheck`,`value`].forEach(function(e){y[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)}),[`autoReverse`,`externalResourcesRequired`,`focusable`,`preserveAlpha`].forEach(function(e){y[e]=new v(e,2,!1,e,null,!1,!1)}),`allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope`.split(` `).forEach(function(e){y[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)}),[`checked`,`multiple`,`muted`,`selected`].forEach(function(e){y[e]=new v(e,3,!0,e,null,!1,!1)}),[`capture`,`download`].forEach(function(e){y[e]=new v(e,4,!1,e,null,!1,!1)}),[`cols`,`rows`,`size`,`span`].forEach(function(e){y[e]=new v(e,6,!1,e,null,!1,!1)}),[`rowSpan`,`start`].forEach(function(e){y[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function x(e){return e[1].toUpperCase()}`accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height`.split(` `).forEach(function(e){var t=e.replace(b,x);y[t]=new v(t,1,!1,e,null,!1,!1)}),`xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type`.split(` `).forEach(function(e){var t=e.replace(b,x);y[t]=new v(t,1,!1,e,`http://www.w3.org/1999/xlink`,!1,!1)}),[`xml:base`,`xml:lang`,`xml:space`].forEach(function(e){var t=e.replace(b,x);y[t]=new v(t,1,!1,e,`http://www.w3.org/XML/1998/namespace`,!1,!1)}),[`tabIndex`,`crossOrigin`].forEach(function(e){y[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)}),y.xlinkHref=new v(`xlinkHref`,1,!1,`xlink:href`,`http://www.w3.org/1999/xlink`,!0,!1),[`src`,`href`,`action`,`formAction`].forEach(function(e){y[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});function S(e,t,n,r){var i=y.hasOwnProperty(t)?y[t]:null;(i===null?r||!(2<t.length)||t[0]!==`o`&&t[0]!==`O`||t[1]!==`n`&&t[1]!==`N`:i.type!==0)&&(_(t,n,i,r)&&(n=null),r||i===null?h(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,``+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:``:n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&!0===n?``:``+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var C=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for(`react.element`),T=Symbol.for(`react.portal`),E=Symbol.for(`react.fragment`),D=Symbol.for(`react.strict_mode`),O=Symbol.for(`react.profiler`),k=Symbol.for(`react.provider`),A=Symbol.for(`react.context`),ee=Symbol.for(`react.forward_ref`),te=Symbol.for(`react.suspense`),ne=Symbol.for(`react.suspense_list`),j=Symbol.for(`react.memo`),M=Symbol.for(`react.lazy`),re=Symbol.for(`react.offscreen`),ie=Symbol.iterator;function ae(e){return typeof e!=`object`||!e?null:(e=ie&&e[ie]||e[`@@iterator`],typeof e==`function`?e:null)}var oe=Object.assign,se;function ce(e){if(se===void 0)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);se=t&&t[1]||``}return`
`+se+e}var le=!1;function ue(e,t){if(!e||le)return``;le=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,`props`,{set:function(){throw Error()}}),typeof Reflect==`object`&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&typeof t.stack==`string`){for(var i=t.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var c=`
`+i[o].replace(` at new `,` at `);return e.displayName&&c.includes(`<anonymous>`)&&(c=c.replace(`<anonymous>`,e.displayName)),c}while(1<=o&&0<=s);break}}}finally{le=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:``)?ce(e):``}function de(e){switch(e.tag){case 5:return ce(e.type);case 16:return ce(`Lazy`);case 13:return ce(`Suspense`);case 19:return ce(`SuspenseList`);case 0:case 2:case 15:return e=ue(e.type,!1),e;case 11:return e=ue(e.type.render,!1),e;case 1:return e=ue(e.type,!0),e;default:return``}}function fe(e){if(e==null)return null;if(typeof e==`function`)return e.displayName||e.name||null;if(typeof e==`string`)return e;switch(e){case E:return`Fragment`;case T:return`Portal`;case O:return`Profiler`;case D:return`StrictMode`;case te:return`Suspense`;case ne:return`SuspenseList`}if(typeof e==`object`)switch(e.$$typeof){case A:return(e.displayName||`Context`)+`.Consumer`;case k:return(e._context.displayName||`Context`)+`.Provider`;case ee:var t=e.render;return e=e.displayName,e||=(e=t.displayName||t.name||``,e===``?`ForwardRef`:`ForwardRef(`+e+`)`),e;case j:return t=e.displayName||null,t===null?fe(e.type)||`Memo`:t;case M:t=e._payload,e=e._init;try{return fe(e(t))}catch{}}return null}function pe(e){var t=e.type;switch(e.tag){case 24:return`Cache`;case 9:return(t.displayName||`Context`)+`.Consumer`;case 10:return(t._context.displayName||`Context`)+`.Provider`;case 18:return`DehydratedFragment`;case 11:return e=t.render,e=e.displayName||e.name||``,t.displayName||(e===``?`ForwardRef`:`ForwardRef(`+e+`)`);case 7:return`Fragment`;case 5:return t;case 4:return`Portal`;case 3:return`Root`;case 6:return`Text`;case 16:return fe(t);case 8:return t===D?`StrictMode`:`Mode`;case 22:return`Offscreen`;case 12:return`Profiler`;case 21:return`Scope`;case 13:return`Suspense`;case 19:return`SuspenseList`;case 25:return`TracingMarker`;case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t==`function`)return t.displayName||t.name||null;if(typeof t==`string`)return t}return null}function me(e){switch(typeof e){case`boolean`:case`number`:case`string`:case`undefined`:return e;case`object`:return e;default:return``}}function he(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()===`input`&&(t===`checkbox`||t===`radio`)}function ge(e){var t=he(e)?`checked`:`value`,n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=``+e[t];if(!e.hasOwnProperty(t)&&n!==void 0&&typeof n.get==`function`&&typeof n.set==`function`){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=``+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=``+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function _e(e){e._valueTracker||=ge(e)}function ve(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r=``;return e&&(r=he(e)?e.checked?`true`:`false`:e.value),e=r,e===n?!1:(t.setValue(e),!0)}function ye(e){if(e||=typeof document<`u`?document:void 0,e===void 0)return null;try{return e.activeElement||e.body}catch{return e.body}}function be(e,t){var n=t.checked;return oe({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function xe(e,t){var n=t.defaultValue==null?``:t.defaultValue,r=t.checked==null?t.defaultChecked:t.checked;n=me(t.value==null?n:t.value),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type===`checkbox`||t.type===`radio`?t.checked!=null:t.value!=null}}function Se(e,t){t=t.checked,t!=null&&S(e,`checked`,t,!1)}function Ce(e,t){Se(e,t);var n=me(t.value),r=t.type;if(n!=null)r===`number`?(n===0&&e.value===``||e.value!=n)&&(e.value=``+n):e.value!==``+n&&(e.value=``+n);else if(r===`submit`||r===`reset`){e.removeAttribute(`value`);return}t.hasOwnProperty(`value`)?Te(e,t.type,n):t.hasOwnProperty(`defaultValue`)&&Te(e,t.type,me(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function we(e,t,n){if(t.hasOwnProperty(`value`)||t.hasOwnProperty(`defaultValue`)){var r=t.type;if(!(r!==`submit`&&r!==`reset`||t.value!==void 0&&t.value!==null))return;t=``+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==``&&(e.name=``),e.defaultChecked=!!e._wrapperState.initialChecked,n!==``&&(e.name=n)}function Te(e,t,n){(t!==`number`||ye(e.ownerDocument)!==e)&&(n==null?e.defaultValue=``+e._wrapperState.initialValue:e.defaultValue!==``+n&&(e.defaultValue=``+n))}var Ee=Array.isArray;function De(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t[`$`+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty(`$`+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=``+me(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Oe(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(r(91));return oe({},t,{value:void 0,defaultValue:void 0,children:``+e._wrapperState.initialValue})}function ke(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(r(92));if(Ee(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}t??=``,n=t}e._wrapperState={initialValue:me(n)}}function Ae(e,t){var n=me(t.value),r=me(t.defaultValue);n!=null&&(n=``+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=``+r)}function je(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==``&&t!==null&&(e.value=t)}function Me(e){switch(e){case`svg`:return`http://www.w3.org/2000/svg`;case`math`:return`http://www.w3.org/1998/Math/MathML`;default:return`http://www.w3.org/1999/xhtml`}}function Ne(e,t){return e==null||e===`http://www.w3.org/1999/xhtml`?Me(t):e===`http://www.w3.org/2000/svg`&&t===`foreignObject`?`http://www.w3.org/1999/xhtml`:e}var Pe,Fe=function(e){return typeof MSApp<`u`&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!==`http://www.w3.org/2000/svg`||`innerHTML`in e)e.innerHTML=t;else{for(Pe||=document.createElement(`div`),Pe.innerHTML=`<svg>`+t.valueOf().toString()+`</svg>`,t=Pe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ie(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Le={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Re=[`Webkit`,`ms`,`Moz`,`O`];Object.keys(Le).forEach(function(e){Re.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Le[t]=Le[e]})});function ze(e,t,n){return t==null||typeof t==`boolean`||t===``?``:n||typeof t!=`number`||t===0||Le.hasOwnProperty(e)&&Le[e]?(``+t).trim():t+`px`}function Be(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=n.indexOf(`--`)===0,i=ze(n,t[n],r);n===`float`&&(n=`cssFloat`),r?e.setProperty(n,i):e[n]=i}}var Ve=oe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function He(e,t){if(t){if(Ve[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(r(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(r(60));if(typeof t.dangerouslySetInnerHTML!=`object`||!(`__html`in t.dangerouslySetInnerHTML))throw Error(r(61))}if(t.style!=null&&typeof t.style!=`object`)throw Error(r(62))}}function Ue(e,t){if(e.indexOf(`-`)===-1)return typeof t.is==`string`;switch(e){case`annotation-xml`:case`color-profile`:case`font-face`:case`font-face-src`:case`font-face-uri`:case`font-face-format`:case`font-face-name`:case`missing-glyph`:return!1;default:return!0}}var We=null;function Ge(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ke=null,qe=null,Je=null;function Ye(e){if(e=na(e)){if(typeof Ke!=`function`)throw Error(r(280));var t=e.stateNode;t&&(t=ia(t),Ke(e.stateNode,e.type,t))}}function Xe(e){qe?Je?Je.push(e):Je=[e]:qe=e}function Ze(){if(qe){var e=qe,t=Je;if(Je=qe=null,Ye(e),t)for(e=0;e<t.length;e++)Ye(t[e])}}function Qe(e,t){return e(t)}function $e(){}var et=!1;function tt(e,t,n){if(et)return e(t,n);et=!0;try{return Qe(e,t,n)}finally{et=!1,(qe!==null||Je!==null)&&($e(),Ze())}}function nt(e,t){var n=e.stateNode;if(n===null)return null;var i=ia(n);if(i===null)return null;n=i[t];a:switch(t){case`onClick`:case`onClickCapture`:case`onDoubleClick`:case`onDoubleClickCapture`:case`onMouseDown`:case`onMouseDownCapture`:case`onMouseMove`:case`onMouseMoveCapture`:case`onMouseUp`:case`onMouseUpCapture`:case`onMouseEnter`:(i=!i.disabled)||(e=e.type,i=!(e===`button`||e===`input`||e===`select`||e===`textarea`)),e=!i;break a;default:e=!1}if(e)return null;if(n&&typeof n!=`function`)throw Error(r(231,t,typeof n));return n}var rt=!1;if(c)try{var it={};Object.defineProperty(it,`passive`,{get:function(){rt=!0}}),window.addEventListener(`test`,it,it),window.removeEventListener(`test`,it,it)}catch{rt=!1}function at(e,t,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(e){this.onError(e)}}var ot=!1,st=null,ct=!1,lt=null,ut={onError:function(e){ot=!0,st=e}};function dt(e,t,n,r,i,a,o,s,c){ot=!1,st=null,at.apply(ut,arguments)}function ft(e,t,n,i,a,o,s,c,l){if(dt.apply(this,arguments),ot){if(ot){var u=st;ot=!1,st=null}else throw Error(r(198));ct||(ct=!0,lt=u)}}function pt(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function mt(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ht(e){if(pt(e)!==e)throw Error(r(188))}function gt(e){var t=e.alternate;if(!t){if(t=pt(e),t===null)throw Error(r(188));return t===e?e:null}for(var n=e,i=t;;){var a=n.return;if(a===null)break;var o=a.alternate;if(o===null){if(i=a.return,i!==null){n=i;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return ht(a),e;if(o===i)return ht(a),t;o=o.sibling}throw Error(r(188))}if(n.return!==i.return)n=a,i=o;else{for(var s=!1,c=a.child;c;){if(c===n){s=!0,n=a,i=o;break}if(c===i){s=!0,i=a,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,i=a;break}if(c===i){s=!0,i=o,n=a;break}c=c.sibling}if(!s)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(n.tag!==3)throw Error(r(188));return n.stateNode.current===n?e:t}function _t(e){return e=gt(e),e===null?null:vt(e)}function vt(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=vt(e);if(t!==null)return t;e=e.sibling}return null}var yt=n.unstable_scheduleCallback,bt=n.unstable_cancelCallback,xt=n.unstable_shouldYield,St=n.unstable_requestPaint,Ct=n.unstable_now,wt=n.unstable_getCurrentPriorityLevel,Tt=n.unstable_ImmediatePriority,Et=n.unstable_UserBlockingPriority,Dt=n.unstable_NormalPriority,Ot=n.unstable_LowPriority,kt=n.unstable_IdlePriority,At=null,jt=null;function Mt(e){if(jt&&typeof jt.onCommitFiberRoot==`function`)try{jt.onCommitFiberRoot(At,e,void 0,(e.current.flags&128)==128)}catch{}}var Nt=Math.clz32?Math.clz32:It,Pt=Math.log,Ft=Math.LN2;function It(e){return e>>>=0,e===0?32:31-(Pt(e)/Ft|0)|0}var N=64,Lt=4194304;function Rt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function zt(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=n&268435455;if(o!==0){var s=o&~i;s===0?(a&=o,a!==0&&(r=Rt(a))):r=Rt(s)}else o=n&~i,o===0?a!==0&&(r=Rt(a)):r=Rt(o);if(r===0)return 0;if(t!==0&&t!==r&&(t&i)===0&&(i=r&-r,a=t&-t,i>=a||i===16&&a&4194240))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Nt(t),i=1<<n,r|=e[n],t&=~i;return r}function Bt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vt(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-Nt(a),s=1<<o,c=i[o];c===-1?((s&n)===0||(s&r)!==0)&&(i[o]=Bt(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}}function Ht(e){return e=e.pendingLanes&-1073741825,e===0?e&1073741824?1073741824:0:e}function Ut(){var e=N;return N<<=1,!(N&4194240)&&(N=64),e}function Wt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Gt(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Nt(t),e[t]=n}function Kt(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-Nt(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}function qt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Nt(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Jt=0;function Yt(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Xt,Zt,Qt,$t,en,tn=!1,nn=[],rn=null,an=null,on=null,sn=new Map,cn=new Map,ln=[],un=`mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit`.split(` `);function dn(e,t){switch(e){case`focusin`:case`focusout`:rn=null;break;case`dragenter`:case`dragleave`:an=null;break;case`mouseover`:case`mouseout`:on=null;break;case`pointerover`:case`pointerout`:sn.delete(t.pointerId);break;case`gotpointercapture`:case`lostpointercapture`:cn.delete(t.pointerId)}}function fn(e,t,n,r,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},t!==null&&(t=na(t),t!==null&&Zt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function pn(e,t,n,r,i){switch(t){case`focusin`:return rn=fn(rn,e,t,n,r,i),!0;case`dragenter`:return an=fn(an,e,t,n,r,i),!0;case`mouseover`:return on=fn(on,e,t,n,r,i),!0;case`pointerover`:var a=i.pointerId;return sn.set(a,fn(sn.get(a)||null,e,t,n,r,i)),!0;case`gotpointercapture`:return a=i.pointerId,cn.set(a,fn(cn.get(a)||null,e,t,n,r,i)),!0}return!1}function mn(e){var t=ta(e.target);if(t!==null){var n=pt(t);if(n!==null){if(t=n.tag,t===13){if(t=mt(n),t!==null){e.blockedOn=t,en(e.priority,function(){Qt(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hn(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=En(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);We=r,n.target.dispatchEvent(r),We=null}else return t=na(n),t!==null&&Zt(t),e.blockedOn=n,!1;t.shift()}return!0}function gn(e,t,n){hn(e)&&n.delete(t)}function _n(){tn=!1,rn!==null&&hn(rn)&&(rn=null),an!==null&&hn(an)&&(an=null),on!==null&&hn(on)&&(on=null),sn.forEach(gn),cn.forEach(gn)}function vn(e,t){e.blockedOn===t&&(e.blockedOn=null,tn||(tn=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,_n)))}function yn(e){function t(t){return vn(t,e)}if(0<nn.length){vn(nn[0],e);for(var n=1;n<nn.length;n++){var r=nn[n];r.blockedOn===e&&(r.blockedOn=null)}}for(rn!==null&&vn(rn,e),an!==null&&vn(an,e),on!==null&&vn(on,e),sn.forEach(t),cn.forEach(t),n=0;n<ln.length;n++)r=ln[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<ln.length&&(n=ln[0],n.blockedOn===null);)mn(n),n.blockedOn===null&&ln.shift()}var bn=C.ReactCurrentBatchConfig,xn=!0;function Sn(e,t,n,r){var i=Jt,a=bn.transition;bn.transition=null;try{Jt=1,wn(e,t,n,r)}finally{Jt=i,bn.transition=a}}function Cn(e,t,n,r){var i=Jt,a=bn.transition;bn.transition=null;try{Jt=4,wn(e,t,n,r)}finally{Jt=i,bn.transition=a}}function wn(e,t,n,r){if(xn){var i=En(e,t,n,r);if(i===null)Di(e,t,r,Tn,n),dn(e,r);else if(pn(i,e,t,n,r))r.stopPropagation();else if(dn(e,r),t&4&&-1<un.indexOf(e)){for(;i!==null;){var a=na(i);if(a!==null&&Xt(a),a=En(e,t,n,r),a===null&&Di(e,t,r,Tn,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Di(e,t,r,null,n)}}var Tn=null;function En(e,t,n,r){if(Tn=null,e=Ge(r),e=ta(e),e!==null)if(t=pt(e),t===null)e=null;else if(n=t.tag,n===13){if(e=mt(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Tn=e,null}function Dn(e){switch(e){case`cancel`:case`click`:case`close`:case`contextmenu`:case`copy`:case`cut`:case`auxclick`:case`dblclick`:case`dragend`:case`dragstart`:case`drop`:case`focusin`:case`focusout`:case`input`:case`invalid`:case`keydown`:case`keypress`:case`keyup`:case`mousedown`:case`mouseup`:case`paste`:case`pause`:case`play`:case`pointercancel`:case`pointerdown`:case`pointerup`:case`ratechange`:case`reset`:case`resize`:case`seeked`:case`submit`:case`touchcancel`:case`touchend`:case`touchstart`:case`volumechange`:case`change`:case`selectionchange`:case`textInput`:case`compositionstart`:case`compositionend`:case`compositionupdate`:case`beforeblur`:case`afterblur`:case`beforeinput`:case`blur`:case`fullscreenchange`:case`focus`:case`hashchange`:case`popstate`:case`select`:case`selectstart`:return 1;case`drag`:case`dragenter`:case`dragexit`:case`dragleave`:case`dragover`:case`mousemove`:case`mouseout`:case`mouseover`:case`pointermove`:case`pointerout`:case`pointerover`:case`scroll`:case`toggle`:case`touchmove`:case`wheel`:case`mouseenter`:case`mouseleave`:case`pointerenter`:case`pointerleave`:return 4;case`message`:switch(wt()){case Tt:return 1;case Et:return 4;case Dt:case Ot:return 16;case kt:return 536870912;default:return 16}default:return 16}}var On=null,kn=null,An=null;function jn(){if(An)return An;var e,t=kn,n=t.length,r,i=`value`in On?On.value:On.textContent,a=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[a-r];r++);return An=i.slice(e,1<r?1-r:void 0)}function Mn(e){var t=e.keyCode;return`charCode`in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Nn(){return!0}function Pn(){return!1}function Fn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented==null?!1===i.returnValue:i.defaultPrevented)?Nn:Pn,this.isPropagationStopped=Pn,this}return oe(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!=`unknown`&&(e.returnValue=!1),this.isDefaultPrevented=Nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!=`unknown`&&(e.cancelBubble=!0),this.isPropagationStopped=Nn)},persist:function(){},isPersistent:Nn}),t}var In={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ln=Fn(In),Rn=oe({},In,{view:0,detail:0}),zn=Fn(Rn),Bn,Vn,Hn,Un=oe({},Rn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ar,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return`movementX`in e?e.movementX:(e!==Hn&&(Hn&&e.type===`mousemove`?(Bn=e.screenX-Hn.screenX,Vn=e.screenY-Hn.screenY):Vn=Bn=0,Hn=e),Bn)},movementY:function(e){return`movementY`in e?e.movementY:Vn}}),Wn=Fn(Un),Gn=oe({},Un,{dataTransfer:0}),Kn=Fn(Gn),qn=oe({},Rn,{relatedTarget:0}),Jn=Fn(qn),Yn=oe({},In,{animationName:0,elapsedTime:0,pseudoElement:0}),Xn=Fn(Yn),Zn=oe({},In,{clipboardData:function(e){return`clipboardData`in e?e.clipboardData:window.clipboardData}}),Qn=Fn(Zn),$n=oe({},In,{data:0}),er=Fn($n),tr={Esc:`Escape`,Spacebar:` `,Left:`ArrowLeft`,Up:`ArrowUp`,Right:`ArrowRight`,Down:`ArrowDown`,Del:`Delete`,Win:`OS`,Menu:`ContextMenu`,Apps:`ContextMenu`,Scroll:`ScrollLock`,MozPrintableKey:`Unidentified`},nr={8:`Backspace`,9:`Tab`,12:`Clear`,13:`Enter`,16:`Shift`,17:`Control`,18:`Alt`,19:`Pause`,20:`CapsLock`,27:`Escape`,32:` `,33:`PageUp`,34:`PageDown`,35:`End`,36:`Home`,37:`ArrowLeft`,38:`ArrowUp`,39:`ArrowRight`,40:`ArrowDown`,45:`Insert`,46:`Delete`,112:`F1`,113:`F2`,114:`F3`,115:`F4`,116:`F5`,117:`F6`,118:`F7`,119:`F8`,120:`F9`,121:`F10`,122:`F11`,123:`F12`,144:`NumLock`,145:`ScrollLock`,224:`Meta`},rr={Alt:`altKey`,Control:`ctrlKey`,Meta:`metaKey`,Shift:`shiftKey`};function ir(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=rr[e])?!!t[e]:!1}function ar(){return ir}var or=oe({},Rn,{key:function(e){if(e.key){var t=tr[e.key]||e.key;if(t!==`Unidentified`)return t}return e.type===`keypress`?(e=Mn(e),e===13?`Enter`:String.fromCharCode(e)):e.type===`keydown`||e.type===`keyup`?nr[e.keyCode]||`Unidentified`:``},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ar,charCode:function(e){return e.type===`keypress`?Mn(e):0},keyCode:function(e){return e.type===`keydown`||e.type===`keyup`?e.keyCode:0},which:function(e){return e.type===`keypress`?Mn(e):e.type===`keydown`||e.type===`keyup`?e.keyCode:0}}),sr=Fn(or),cr=oe({},Un,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lr=Fn(cr),ur=oe({},Rn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ar}),dr=Fn(ur),fr=oe({},In,{propertyName:0,elapsedTime:0,pseudoElement:0}),pr=Fn(fr),mr=oe({},Un,{deltaX:function(e){return`deltaX`in e?e.deltaX:`wheelDeltaX`in e?-e.wheelDeltaX:0},deltaY:function(e){return`deltaY`in e?e.deltaY:`wheelDeltaY`in e?-e.wheelDeltaY:`wheelDelta`in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),hr=Fn(mr),gr=[9,13,27,32],_r=c&&`CompositionEvent`in window,vr=null;c&&`documentMode`in document&&(vr=document.documentMode);var yr=c&&`TextEvent`in window&&!vr,br=c&&(!_r||vr&&8<vr&&11>=vr),xr=` `,Sr=!1;function Cr(e,t){switch(e){case`keyup`:return gr.indexOf(t.keyCode)!==-1;case`keydown`:return t.keyCode!==229;case`keypress`:case`mousedown`:case`focusout`:return!0;default:return!1}}function wr(e){return e=e.detail,typeof e==`object`&&`data`in e?e.data:null}var Tr=!1;function Er(e,t){switch(e){case`compositionend`:return wr(t);case`keypress`:return t.which===32?(Sr=!0,xr):null;case`textInput`:return e=t.data,e===xr&&Sr?null:e;default:return null}}function Dr(e,t){if(Tr)return e===`compositionend`||!_r&&Cr(e,t)?(e=jn(),An=kn=On=null,Tr=!1,e):null;switch(e){case`paste`:return null;case`keypress`:if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case`compositionend`:return br&&t.locale!==`ko`?null:t.data;default:return null}}var Or={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t===`input`?!!Or[e.type]:t===`textarea`}function Ar(e,t,n,r){Xe(r),t=ki(t,`onChange`),0<t.length&&(n=new Ln(`onChange`,`change`,null,n,r),e.push({event:n,listeners:t}))}var jr=null,Mr=null;function Nr(e){xi(e,0)}function Pr(e){var t=ra(e);if(ve(t))return e}function Fr(e,t){if(e===`change`)return t}var P=!1;if(c){var F;if(c){var Ir=`oninput`in document;if(!Ir){var Lr=document.createElement(`div`);Lr.setAttribute(`oninput`,`return;`),Ir=typeof Lr.oninput==`function`}F=Ir}else F=!1;P=F&&(!document.documentMode||9<document.documentMode)}function Rr(){jr&&(jr.detachEvent(`onpropertychange`,I),Mr=jr=null)}function I(e){if(e.propertyName===`value`&&Pr(Mr)){var t=[];Ar(t,Mr,e,Ge(e)),tt(Nr,t)}}function zr(e,t,n){e===`focusin`?(Rr(),jr=t,Mr=n,jr.attachEvent(`onpropertychange`,I)):e===`focusout`&&Rr()}function Br(e){if(e===`selectionchange`||e===`keyup`||e===`keydown`)return Pr(Mr)}function Vr(e,t){if(e===`click`)return Pr(t)}function Hr(e,t){if(e===`input`||e===`change`)return Pr(t)}function Ur(e,t){return e===t&&(e!==0||1/e==1/t)||e!==e&&t!==t}var Wr=typeof Object.is==`function`?Object.is:Ur;function Gr(e,t){if(Wr(e,t))return!0;if(typeof e!=`object`||!e||typeof t!=`object`||!t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!l.call(t,i)||!Wr(e[i],t[i]))return!1}return!0}function L(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Kr(e,t){var n=L(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}a:{for(;n;){if(n.nextSibling){n=n.nextSibling;break a}n=n.parentNode}n=void 0}n=L(n)}}function qr(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qr(e,t.parentNode):`contains`in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Jr(){for(var e=window,t=ye();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href==`string`}catch{n=!1}if(n)e=t.contentWindow;else break;t=ye(e.document)}return t}function Yr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t===`input`&&(e.type===`text`||e.type===`search`||e.type===`tel`||e.type===`url`||e.type===`password`)||t===`textarea`||e.contentEditable===`true`)}function Xr(e){var t=Jr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&qr(n.ownerDocument.documentElement,n)){if(r!==null&&Yr(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),`selectionStart`in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=Kr(n,a);var o=Kr(n,r);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus==`function`&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Zr=c&&`documentMode`in document&&11>=document.documentMode,Qr=null,$r=null,ei=null,ti=!1;function ni(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ti||Qr==null||Qr!==ye(r)||(r=Qr,`selectionStart`in r&&Yr(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ei&&Gr(ei,r)||(ei=r,r=ki($r,`onSelect`),0<r.length&&(t=new Ln(`onSelect`,`select`,null,t,n),e.push({event:t,listeners:r}),t.target=Qr)))}function ri(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n[`Webkit`+e]=`webkit`+t,n[`Moz`+e]=`moz`+t,n}var ii={animationend:ri(`Animation`,`AnimationEnd`),animationiteration:ri(`Animation`,`AnimationIteration`),animationstart:ri(`Animation`,`AnimationStart`),transitionend:ri(`Transition`,`TransitionEnd`)},R={},ai={};c&&(ai=document.createElement(`div`).style,`AnimationEvent`in window||(delete ii.animationend.animation,delete ii.animationiteration.animation,delete ii.animationstart.animation),`TransitionEvent`in window||delete ii.transitionend.transition);function oi(e){if(R[e])return R[e];if(!ii[e])return e;var t=ii[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ai)return R[e]=t[n];return e}var si=oi(`animationend`),ci=oi(`animationiteration`),li=oi(`animationstart`),ui=oi(`transitionend`),di=new Map,fi=`abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel`.split(` `);function pi(e,t){di.set(e,t),o(t,[e])}for(var mi=0;mi<fi.length;mi++){var hi=fi[mi],gi=hi.toLowerCase(),_i=hi[0].toUpperCase()+hi.slice(1);pi(gi,`on`+_i)}pi(si,`onAnimationEnd`),pi(ci,`onAnimationIteration`),pi(li,`onAnimationStart`),pi(`dblclick`,`onDoubleClick`),pi(`focusin`,`onFocus`),pi(`focusout`,`onBlur`),pi(ui,`onTransitionEnd`),s(`onMouseEnter`,[`mouseout`,`mouseover`]),s(`onMouseLeave`,[`mouseout`,`mouseover`]),s(`onPointerEnter`,[`pointerout`,`pointerover`]),s(`onPointerLeave`,[`pointerout`,`pointerover`]),o(`onChange`,`change click focusin focusout input keydown keyup selectionchange`.split(` `)),o(`onSelect`,`focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange`.split(` `)),o(`onBeforeInput`,[`compositionend`,`keypress`,`textInput`,`paste`]),o(`onCompositionEnd`,`compositionend focusout keydown keypress keyup mousedown`.split(` `)),o(`onCompositionStart`,`compositionstart focusout keydown keypress keyup mousedown`.split(` `)),o(`onCompositionUpdate`,`compositionupdate focusout keydown keypress keyup mousedown`.split(` `));var vi=`abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting`.split(` `),yi=new Set(`cancel close invalid load scroll toggle`.split(` `).concat(vi));function bi(e,t,n){var r=e.type||`unknown-event`;e.currentTarget=n,ft(r,t,void 0,e),e.currentTarget=null}function xi(e,t){t=(t&4)!=0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;a:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break a;bi(i,s,l),a=c}else for(o=0;o<r.length;o++){if(s=r[o],c=s.instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break a;bi(i,s,l),a=c}}}if(ct)throw e=lt,ct=!1,lt=null,e}function Si(e,t){var n=t[Qi];n===void 0&&(n=t[Qi]=new Set);var r=e+`__bubble`;n.has(r)||(Ei(t,e,2,!1),n.add(r))}function Ci(e,t,n){var r=0;t&&(r|=4),Ei(n,e,r,t)}var wi=`_reactListening`+Math.random().toString(36).slice(2);function Ti(e){if(!e[wi]){e[wi]=!0,i.forEach(function(t){t!==`selectionchange`&&(yi.has(t)||Ci(t,!1,e),Ci(t,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[wi]||(t[wi]=!0,Ci(`selectionchange`,!1,t))}}function Ei(e,t,n,r){switch(Dn(t)){case 1:var i=Sn;break;case 4:i=Cn;break;default:i=wn}n=i.bind(null,t,n,e),i=void 0,!rt||t!==`touchstart`&&t!==`touchmove`&&t!==`wheel`||(i=!0),r?i===void 0?e.addEventListener(t,n,!0):e.addEventListener(t,n,{capture:!0,passive:i}):i===void 0?e.addEventListener(t,n,!1):e.addEventListener(t,n,{passive:i})}function Di(e,t,n,r,i){var a=r;if(!(t&1)&&!(t&2)&&r!==null)a:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;s!==null;){if(o=ta(s),o===null)return;if(c=o.tag,c===5||c===6){r=a=o;continue a}s=s.parentNode}}r=r.return}tt(function(){var r=a,i=Ge(n),o=[];a:{var s=di.get(e);if(s!==void 0){var c=Ln,l=e;switch(e){case`keypress`:if(Mn(n)===0)break a;case`keydown`:case`keyup`:c=sr;break;case`focusin`:l=`focus`,c=Jn;break;case`focusout`:l=`blur`,c=Jn;break;case`beforeblur`:case`afterblur`:c=Jn;break;case`click`:if(n.button===2)break a;case`auxclick`:case`dblclick`:case`mousedown`:case`mousemove`:case`mouseup`:case`mouseout`:case`mouseover`:case`contextmenu`:c=Wn;break;case`drag`:case`dragend`:case`dragenter`:case`dragexit`:case`dragleave`:case`dragover`:case`dragstart`:case`drop`:c=Kn;break;case`touchcancel`:case`touchend`:case`touchmove`:case`touchstart`:c=dr;break;case si:case ci:case li:c=Xn;break;case ui:c=pr;break;case`scroll`:c=zn;break;case`wheel`:c=hr;break;case`copy`:case`cut`:case`paste`:c=Qn;break;case`gotpointercapture`:case`lostpointercapture`:case`pointercancel`:case`pointerdown`:case`pointermove`:case`pointerout`:case`pointerover`:case`pointerup`:c=lr}var u=(t&4)!=0,d=!u&&e===`scroll`,f=u?s===null?null:s+`Capture`:s;u=[];for(var p=r,m;p!==null;){m=p;var h=m.stateNode;if(m.tag===5&&h!==null&&(m=h,f!==null&&(h=nt(p,f),h!=null&&u.push(Oi(p,h,m)))),d)break;p=p.return}0<u.length&&(s=new c(s,l,null,n,i),o.push({event:s,listeners:u}))}}if(!(t&7)){a:{if(s=e===`mouseover`||e===`pointerover`,c=e===`mouseout`||e===`pointerout`,s&&n!==We&&(l=n.relatedTarget||n.fromElement)&&(ta(l)||l[Zi]))break a;if((c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(l=n.relatedTarget||n.toElement,c=r,l=l?ta(l):null,l!==null&&(d=pt(l),l!==d||l.tag!==5&&l.tag!==6)&&(l=null)):(c=null,l=r),c!==l)){if(u=Wn,h=`onMouseLeave`,f=`onMouseEnter`,p=`mouse`,(e===`pointerout`||e===`pointerover`)&&(u=lr,h=`onPointerLeave`,f=`onPointerEnter`,p=`pointer`),d=c==null?s:ra(c),m=l==null?s:ra(l),s=new u(h,p+`leave`,c,n,i),s.target=d,s.relatedTarget=m,h=null,ta(i)===r&&(u=new u(f,p+`enter`,l,n,i),u.target=m,u.relatedTarget=d,h=u),d=h,c&&l)b:{for(u=c,f=l,p=0,m=u;m;m=Ai(m))p++;for(m=0,h=f;h;h=Ai(h))m++;for(;0<p-m;)u=Ai(u),p--;for(;0<m-p;)f=Ai(f),m--;for(;p--;){if(u===f||f!==null&&u===f.alternate)break b;u=Ai(u),f=Ai(f)}u=null}else u=null;c!==null&&ji(o,s,c,u,!1),l!==null&&d!==null&&ji(o,d,l,u,!0)}}a:{if(s=r?ra(r):window,c=s.nodeName&&s.nodeName.toLowerCase(),c===`select`||c===`input`&&s.type===`file`)var g=Fr;else if(kr(s))if(P)g=Hr;else{g=Br;var _=zr}else (c=s.nodeName)&&c.toLowerCase()===`input`&&(s.type===`checkbox`||s.type===`radio`)&&(g=Vr);if(g&&=g(e,r)){Ar(o,g,n,i);break a}_&&_(e,s,r),e===`focusout`&&(_=s._wrapperState)&&_.controlled&&s.type===`number`&&Te(s,`number`,s.value)}switch(_=r?ra(r):window,e){case`focusin`:(kr(_)||_.contentEditable===`true`)&&(Qr=_,$r=r,ei=null);break;case`focusout`:ei=$r=Qr=null;break;case`mousedown`:ti=!0;break;case`contextmenu`:case`mouseup`:case`dragend`:ti=!1,ni(o,n,i);break;case`selectionchange`:if(Zr)break;case`keydown`:case`keyup`:ni(o,n,i)}var v;if(_r)b:{switch(e){case`compositionstart`:var y=`onCompositionStart`;break b;case`compositionend`:y=`onCompositionEnd`;break b;case`compositionupdate`:y=`onCompositionUpdate`;break b}y=void 0}else Tr?Cr(e,n)&&(y=`onCompositionEnd`):e===`keydown`&&n.keyCode===229&&(y=`onCompositionStart`);y&&(br&&n.locale!==`ko`&&(Tr||y!==`onCompositionStart`?y===`onCompositionEnd`&&Tr&&(v=jn()):(On=i,kn=`value`in On?On.value:On.textContent,Tr=!0)),_=ki(r,y),0<_.length&&(y=new er(y,e,null,n,i),o.push({event:y,listeners:_}),v?y.data=v:(v=wr(n),v!==null&&(y.data=v)))),(v=yr?Er(e,n):Dr(e,n))&&(r=ki(r,`onBeforeInput`),0<r.length&&(i=new er(`onBeforeInput`,`beforeinput`,null,n,i),o.push({event:i,listeners:r}),i.data=v))}xi(o,t)})}function Oi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ki(e,t){for(var n=t+`Capture`,r=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=nt(e,n),a!=null&&r.unshift(Oi(e,a,i)),a=nt(e,t),a!=null&&r.push(Oi(e,a,i))),e=e.return}return r}function Ai(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ji(e,t,n,r,i){for(var a=t._reactName,o=[];n!==null&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(c!==null&&c===r)break;s.tag===5&&l!==null&&(s=l,i?(c=nt(n,a),c!=null&&o.unshift(Oi(n,c,s))):i||(c=nt(n,a),c!=null&&o.push(Oi(n,c,s)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Mi=/\r\n?/g,Ni=/\u0000|\uFFFD/g;function Pi(e){return(typeof e==`string`?e:``+e).replace(Mi,`
`).replace(Ni,``)}function Fi(e,t,n){if(t=Pi(t),Pi(e)!==t&&n)throw Error(r(425))}function Ii(){}var Li=null,Ri=null;function zi(e,t){return e===`textarea`||e===`noscript`||typeof t.children==`string`||typeof t.children==`number`||typeof t.dangerouslySetInnerHTML==`object`&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Bi=typeof setTimeout==`function`?setTimeout:void 0,Vi=typeof clearTimeout==`function`?clearTimeout:void 0,Hi=typeof Promise==`function`?Promise:void 0,Ui=typeof queueMicrotask==`function`?queueMicrotask:Hi===void 0?Bi:function(e){return Hi.resolve(null).then(e).catch(Wi)};function Wi(e){setTimeout(function(){throw e})}function Gi(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n===`/$`){if(r===0){e.removeChild(i),yn(t);return}r--}else n!==`$`&&n!==`$?`&&n!==`$!`||r++;n=i}while(n);yn(t)}function Ki(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t===`$`||t===`$!`||t===`$?`)break;if(t===`/$`)return null}}return e}function qi(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n===`$`||n===`$!`||n===`$?`){if(t===0)return e;t--}else n===`/$`&&t++}e=e.previousSibling}return null}var Ji=Math.random().toString(36).slice(2),Yi=`__reactFiber$`+Ji,Xi=`__reactProps$`+Ji,Zi=`__reactContainer$`+Ji,Qi=`__reactEvents$`+Ji,$i=`__reactListeners$`+Ji,ea=`__reactHandles$`+Ji;function ta(e){var t=e[Yi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Zi]||n[Yi]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=qi(e);e!==null;){if(n=e[Yi])return n;e=qi(e)}return t}e=n,n=e.parentNode}return null}function na(e){return e=e[Yi]||e[Zi],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ra(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(r(33))}function ia(e){return e[Xi]||null}var aa=[],oa=-1;function sa(e){return{current:e}}function ca(e){0>oa||(e.current=aa[oa],aa[oa]=null,oa--)}function la(e,t){oa++,aa[oa]=e.current,e.current=t}var ua={},da=sa(ua),fa=sa(!1),pa=ua;function ma(e,t){var n=e.type.contextTypes;if(!n)return ua;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function ha(e){return e=e.childContextTypes,e!=null}function z(){ca(fa),ca(da)}function ga(e,t,n){if(da.current!==ua)throw Error(r(168));la(da,t),la(fa,n)}function _a(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!=`function`)return n;for(var a in i=i.getChildContext(),i)if(!(a in t))throw Error(r(108,pe(e)||`Unknown`,a));return oe({},n,i)}function va(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ua,pa=da.current,la(da,e),la(fa,fa.current),!0}function ya(e,t,n){var i=e.stateNode;if(!i)throw Error(r(169));n?(e=_a(e,t,pa),i.__reactInternalMemoizedMergedChildContext=e,ca(fa),ca(da),la(da,e)):ca(fa),la(fa,n)}var ba=null,xa=!1,Sa=!1;function Ca(e){ba===null?ba=[e]:ba.push(e)}function wa(e){xa=!0,Ca(e)}function Ta(){if(!Sa&&ba!==null){Sa=!0;var e=0,t=Jt;try{var n=ba;for(Jt=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}ba=null,xa=!1}catch(t){throw ba!==null&&(ba=ba.slice(e+1)),yt(Tt,Ta),t}finally{Jt=t,Sa=!1}}return null}var Ea=[],Da=0,Oa=null,ka=0,Aa=[],ja=0,Ma=null,Na=1,Pa=``;function Fa(e,t){Ea[Da++]=ka,Ea[Da++]=Oa,Oa=e,ka=t}function Ia(e,t,n){Aa[ja++]=Na,Aa[ja++]=Pa,Aa[ja++]=Ma,Ma=e;var r=Na;e=Pa;var i=32-Nt(r)-1;r&=~(1<<i),n+=1;var a=32-Nt(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Na=1<<32-Nt(t)+i|n<<i|r,Pa=a+e}else Na=1<<a|n<<i|r,Pa=e}function La(e){e.return!==null&&(Fa(e,1),Ia(e,1,0))}function Ra(e){for(;e===Oa;)Oa=Ea[--Da],Ea[Da]=null,ka=Ea[--Da],Ea[Da]=null;for(;e===Ma;)Ma=Aa[--ja],Aa[ja]=null,Pa=Aa[--ja],Aa[ja]=null,Na=Aa[--ja],Aa[ja]=null}var za=null,Ba=null,Va=!1,Ha=null;function Ua(e,t){var n=gu(5,null,null,0);n.elementType=`DELETED`,n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Wa(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t===null?!1:(e.stateNode=t,za=e,Ba=Ki(t.firstChild),!0);case 6:return t=e.pendingProps===``||t.nodeType!==3?null:t,t===null?!1:(e.stateNode=t,za=e,Ba=null,!0);case 13:return t=t.nodeType===8?t:null,t===null?!1:(n=Ma===null?null:{id:Na,overflow:Pa},e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=gu(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,za=e,Ba=null,!0);default:return!1}}function Ga(e){return(e.mode&1)!=0&&(e.flags&128)==0}function Ka(e){if(Va){var t=Ba;if(t){var n=t;if(!Wa(e,t)){if(Ga(e))throw Error(r(418));t=Ki(n.nextSibling);var i=za;t&&Wa(e,t)?Ua(i,n):(e.flags=e.flags&-4097|2,Va=!1,za=e)}}else{if(Ga(e))throw Error(r(418));e.flags=e.flags&-4097|2,Va=!1,za=e}}}function qa(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;za=e}function Ja(e){if(e!==za)return!1;if(!Va)return qa(e),Va=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!==`head`&&t!==`body`&&!zi(e.type,e.memoizedProps)),t&&=Ba){if(Ga(e))throw Ya(),Error(r(418));for(;t;)Ua(e,t),t=Ki(t.nextSibling)}if(qa(e),e.tag===13){if(e=e.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(r(317));a:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n===`/$`){if(t===0){Ba=Ki(e.nextSibling);break a}t--}else n!==`$`&&n!==`$!`&&n!==`$?`||t++}e=e.nextSibling}Ba=null}}else Ba=za?Ki(e.stateNode.nextSibling):null;return!0}function Ya(){for(var e=Ba;e;)e=Ki(e.nextSibling)}function Xa(){Ba=za=null,Va=!1}function Za(e){Ha===null?Ha=[e]:Ha.push(e)}var Qa=C.ReactCurrentBatchConfig;function $a(e,t){if(e&&e.defaultProps){for(var n in t=oe({},t),e=e.defaultProps,e)t[n]===void 0&&(t[n]=e[n]);return t}return t}var eo=sa(null),to=null,no=null,ro=null;function io(){ro=no=to=null}function ao(e){var t=eo.current;ca(eo),e._currentValue=t}function oo(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)===t?r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t):(e.childLanes|=t,r!==null&&(r.childLanes|=t)),e===n)break;e=e.return}}function so(e,t){to=e,ro=no=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(ac=!0),e.firstContext=null)}function co(e){var t=e._currentValue;if(ro!==e)if(e={context:e,memoizedValue:t,next:null},no===null){if(to===null)throw Error(r(308));no=e,to.dependencies={lanes:0,firstContext:e}}else no=no.next=e;return t}var lo=null;function uo(e){lo===null?lo=[e]:lo.push(e)}function fo(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,uo(t)):(n.next=i.next,i.next=n),t.interleaved=n,po(e,r)}function po(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var mo=!1;function ho(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function go(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function _o(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function vo(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,pl&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,po(e,n)}return i=r.interleaved,i===null?(t.next=t,uo(r)):(t.next=i.next,i.next=t),r.interleaved=t,po(e,n)}function yo(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,n&4194240)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,qt(e,n)}}function bo(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=t:a=a.next=t}else i=a=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xo(e,t,n,r){var i=e.updateQueue;mo=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,o===null?a=l:o.next=l,o=c;var u=e.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==o&&(s===null?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(a!==null){var d=i.baseState;o=0,u=l=c=null,s=a;do{var f=s.lane,p=s.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});a:{var m=e,h=s;switch(f=t,p=n,h.tag){case 1:if(m=h.payload,typeof m==`function`){d=m.call(p,d,f);break a}d=m;break a;case 3:m.flags=m.flags&-65537|128;case 0:if(m=h.payload,f=typeof m==`function`?m.call(p,d,f):m,f==null)break a;d=oe({},d,f);break a;case 2:mo=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=i.effects,f===null?i.effects=[s]:f.push(s))}else p={eventTime:p,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;f=s,s=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);xl|=o,e.lanes=o,e.memoizedState=d}}function So(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],a=i.callback;if(a!==null){if(i.callback=null,i=n,typeof a!=`function`)throw Error(r(191,a));a.call(i)}}}var Co=new t.Component().refs;function wo(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:oe({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var To={isMounted:function(e){return(e=e._reactInternals)?pt(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=zl(),i=Bl(e),a=_o(r,i);a.payload=t,n!=null&&(a.callback=n),t=vo(e,a,i),t!==null&&(Vl(t,e,i,r),yo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=zl(),i=Bl(e),a=_o(r,i);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=vo(e,a,i),t!==null&&(Vl(t,e,i,r),yo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=zl(),r=Bl(e),i=_o(n,r);i.tag=2,t!=null&&(i.callback=t),t=vo(e,i,r),t!==null&&(Vl(t,e,r,n),yo(t,e,r))}};function Eo(e,t,n,r,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate==`function`?e.shouldComponentUpdate(r,a,o):t.prototype&&t.prototype.isPureReactComponent?!Gr(n,r)||!Gr(i,a):!0}function Do(e,t,n){var r=!1,i=ua,a=t.contextType;return typeof a==`object`&&a?a=co(a):(i=ha(t)?pa:da.current,r=t.contextTypes,a=(r=r!=null)?ma(e,i):ua),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=To,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Oo(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps==`function`&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps==`function`&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&To.enqueueReplaceState(t,t.state,null)}function ko(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Co,ho(e);var a=t.contextType;typeof a==`object`&&a?i.context=co(a):(a=ha(t)?pa:da.current,i.context=ma(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a==`function`&&(wo(e,t,a,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps==`function`||typeof i.getSnapshotBeforeUpdate==`function`||typeof i.UNSAFE_componentWillMount!=`function`&&typeof i.componentWillMount!=`function`||(t=i.state,typeof i.componentWillMount==`function`&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount==`function`&&i.UNSAFE_componentWillMount(),t!==i.state&&To.enqueueReplaceState(i,i.state,null),xo(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount==`function`&&(e.flags|=4194308)}function Ao(e,t,n){if(e=n.ref,e!==null&&typeof e!=`function`&&typeof e!=`object`){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(r(309));var i=n.stateNode}if(!i)throw Error(r(147,e));var a=i,o=``+e;return t!==null&&t.ref!==null&&typeof t.ref==`function`&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Co&&(t=a.refs={}),e===null?delete t[o]:t[o]=e},t._stringRef=o,t)}if(typeof e!=`string`)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function jo(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,e===`[object Object]`?`object with keys {`+Object.keys(t).join(`, `)+`}`:e))}function Mo(e){var t=e._init;return t(e._payload)}function No(e){function t(t,n){if(e){var r=t.deletions;r===null?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;r!==null;)t(n,r),r=r.sibling;return null}function i(e,t){for(e=new Map;t!==null;)t.key===null?e.set(t.index,t):e.set(t.key,t),t=t.sibling;return e}function a(e,t){return e=yu(e,t),e.index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?(r=t.alternate,r===null?(t.flags|=2,n):(r=r.index,r<n?(t.flags|=2,n):r)):(t.flags|=1048576,n)}function s(t){return e&&t.alternate===null&&(t.flags|=2),t}function c(e,t,n,r){return t===null||t.tag!==6?(t=Su(n,e.mode,r),t.return=e,t):(t=a(t,n),t.return=e,t)}function l(e,t,n,r){var i=n.type;return i===E?d(e,t,n.props.children,r,n.key):t!==null&&(t.elementType===i||typeof i==`object`&&i&&i.$$typeof===M&&Mo(i)===t.type)?(r=a(t,n.props),r.ref=Ao(e,t,n),r.return=e,r):(r=G(n.type,n.key,n.props,null,e.mode,r),r.ref=Ao(e,t,n),r.return=e,r)}function u(e,t,n,r){return t===null||t.tag!==4||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=Cu(n,e.mode,r),t.return=e,t):(t=a(t,n.children||[]),t.return=e,t)}function d(e,t,n,r,i){return t===null||t.tag!==7?(t=bu(n,e.mode,r,i),t.return=e,t):(t=a(t,n),t.return=e,t)}function f(e,t,n){if(typeof t==`string`&&t!==``||typeof t==`number`)return t=Su(``+t,e.mode,n),t.return=e,t;if(typeof t==`object`&&t){switch(t.$$typeof){case w:return n=G(t.type,t.key,t.props,null,e.mode,n),n.ref=Ao(e,null,t),n.return=e,n;case T:return t=Cu(t,e.mode,n),t.return=e,t;case M:var r=t._init;return f(e,r(t._payload),n)}if(Ee(t)||ae(t))return t=bu(t,e.mode,n,null),t.return=e,t;jo(e,t)}return null}function p(e,t,n,r){var i=t===null?null:t.key;if(typeof n==`string`&&n!==``||typeof n==`number`)return i===null?c(e,t,``+n,r):null;if(typeof n==`object`&&n){switch(n.$$typeof){case w:return n.key===i?l(e,t,n,r):null;case T:return n.key===i?u(e,t,n,r):null;case M:return i=n._init,p(e,t,i(n._payload),r)}if(Ee(n)||ae(n))return i===null?d(e,t,n,r,null):null;jo(e,n)}return null}function m(e,t,n,r,i){if(typeof r==`string`&&r!==``||typeof r==`number`)return e=e.get(n)||null,c(t,e,``+r,i);if(typeof r==`object`&&r){switch(r.$$typeof){case w:return e=e.get(r.key===null?n:r.key)||null,l(t,e,r,i);case T:return e=e.get(r.key===null?n:r.key)||null,u(t,e,r,i);case M:var a=r._init;return m(e,t,n,a(r._payload),i)}if(Ee(r)||ae(r))return e=e.get(n)||null,d(t,e,r,i,null);jo(t,r)}return null}function h(r,a,s,c){for(var l=null,u=null,d=a,h=a=0,g=null;d!==null&&h<s.length;h++){d.index>h?(g=d,d=null):g=d.sibling;var _=p(r,d,s[h],c);if(_===null){d===null&&(d=g);break}e&&d&&_.alternate===null&&t(r,d),a=o(_,a,h),u===null?l=_:u.sibling=_,u=_,d=g}if(h===s.length)return n(r,d),Va&&Fa(r,h),l;if(d===null){for(;h<s.length;h++)d=f(r,s[h],c),d!==null&&(a=o(d,a,h),u===null?l=d:u.sibling=d,u=d);return Va&&Fa(r,h),l}for(d=i(r,d);h<s.length;h++)g=m(d,r,h,s[h],c),g!==null&&(e&&g.alternate!==null&&d.delete(g.key===null?h:g.key),a=o(g,a,h),u===null?l=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(r,e)}),Va&&Fa(r,h),l}function g(a,s,c,l){var u=ae(c);if(typeof u!=`function`)throw Error(r(150));if(c=u.call(c),c==null)throw Error(r(151));for(var d=u=null,h=s,g=s=0,_=null,v=c.next();h!==null&&!v.done;g++,v=c.next()){h.index>g?(_=h,h=null):_=h.sibling;var y=p(a,h,v.value,l);if(y===null){h===null&&(h=_);break}e&&h&&y.alternate===null&&t(a,h),s=o(y,s,g),d===null?u=y:d.sibling=y,d=y,h=_}if(v.done)return n(a,h),Va&&Fa(a,g),u;if(h===null){for(;!v.done;g++,v=c.next())v=f(a,v.value,l),v!==null&&(s=o(v,s,g),d===null?u=v:d.sibling=v,d=v);return Va&&Fa(a,g),u}for(h=i(a,h);!v.done;g++,v=c.next())v=m(h,a,g,v.value,l),v!==null&&(e&&v.alternate!==null&&h.delete(v.key===null?g:v.key),s=o(v,s,g),d===null?u=v:d.sibling=v,d=v);return e&&h.forEach(function(e){return t(a,e)}),Va&&Fa(a,g),u}function _(e,r,i,o){if(typeof i==`object`&&i&&i.type===E&&i.key===null&&(i=i.props.children),typeof i==`object`&&i){switch(i.$$typeof){case w:a:{for(var c=i.key,l=r;l!==null;){if(l.key===c){if(c=i.type,c===E){if(l.tag===7){n(e,l.sibling),r=a(l,i.props.children),r.return=e,e=r;break a}}else if(l.elementType===c||typeof c==`object`&&c&&c.$$typeof===M&&Mo(c)===l.type){n(e,l.sibling),r=a(l,i.props),r.ref=Ao(e,l,i),r.return=e,e=r;break a}n(e,l);break}else t(e,l);l=l.sibling}i.type===E?(r=bu(i.props.children,e.mode,o,i.key),r.return=e,e=r):(o=G(i.type,i.key,i.props,null,e.mode,o),o.ref=Ao(e,r,i),o.return=e,e=o)}return s(e);case T:a:{for(l=i.key;r!==null;){if(r.key===l)if(r.tag===4&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),r=a(r,i.children||[]),r.return=e,e=r;break a}else{n(e,r);break}else t(e,r);r=r.sibling}r=Cu(i,e.mode,o),r.return=e,e=r}return s(e);case M:return l=i._init,_(e,r,l(i._payload),o)}if(Ee(i))return h(e,r,i,o);if(ae(i))return g(e,r,i,o);jo(e,i)}return typeof i==`string`&&i!==``||typeof i==`number`?(i=``+i,r!==null&&r.tag===6?(n(e,r.sibling),r=a(r,i),r.return=e,e=r):(n(e,r),r=Su(i,e.mode,o),r.return=e,e=r),s(e)):n(e,r)}return _}var Po=No(!0),Fo=No(!1),Io={},Lo=sa(Io),Ro=sa(Io),zo=sa(Io);function Bo(e){if(e===Io)throw Error(r(174));return e}function Vo(e,t){switch(la(zo,t),la(Ro,e),la(Lo,Io),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ne(null,``);break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ne(t,e)}ca(Lo),la(Lo,t)}function Ho(){ca(Lo),ca(Ro),ca(zo)}function Uo(e){Bo(zo.current);var t=Bo(Lo.current),n=Ne(t,e.type);t!==n&&(la(Ro,e),la(Lo,n))}function Wo(e){Ro.current===e&&(ca(Lo),ca(Ro))}var Go=sa(0);function Ko(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data===`$?`||n.data===`$!`))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var qo=[];function Jo(){for(var e=0;e<qo.length;e++)qo[e]._workInProgressVersionPrimary=null;qo.length=0}var Yo=C.ReactCurrentDispatcher,Xo=C.ReactCurrentBatchConfig,Zo=0,Qo=null,$o=null,es=null,ts=!1,ns=!1,rs=0,os=0;function ss(){throw Error(r(321))}function cs(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wr(e[n],t[n]))return!1;return!0}function ls(e,t,n,i,a,o){if(Zo=o,Qo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yo.current=e===null||e.memoizedState===null?Ks:qs,e=n(i,a),ns){o=0;do{if(ns=!1,rs=0,25<=o)throw Error(r(301));o+=1,es=$o=null,t.updateQueue=null,Yo.current=Js,e=n(i,a)}while(ns)}if(Yo.current=Gs,t=$o!==null&&$o.next!==null,Zo=0,es=$o=Qo=null,ts=!1,t)throw Error(r(300));return e}function us(){var e=rs!==0;return rs=0,e}function ds(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return es===null?Qo.memoizedState=es=e:es=es.next=e,es}function fs(){if($o===null){var e=Qo.alternate;e=e===null?null:e.memoizedState}else e=$o.next;var t=es===null?Qo.memoizedState:es.next;if(t!==null)es=t,$o=e;else{if(e===null)throw Error(r(310));$o=e,e={memoizedState:$o.memoizedState,baseState:$o.baseState,baseQueue:$o.baseQueue,queue:$o.queue,next:null},es===null?Qo.memoizedState=es=e:es=es.next=e}return es}function ps(e,t){return typeof t==`function`?t(e):t}function ms(e){var t=fs(),n=t.queue;if(n===null)throw Error(r(311));n.lastRenderedReducer=e;var i=$o,a=i.baseQueue,o=n.pending;if(o!==null){if(a!==null){var s=a.next;a.next=o.next,o.next=s}i.baseQueue=a=o,n.pending=null}if(a!==null){o=a.next,i=i.baseState;var c=s=null,l=null,u=o;do{var d=u.lane;if((Zo&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(c=l=f,s=i):l=l.next=f,Qo.lanes|=d,xl|=d}u=u.next}while(u!==null&&u!==o);l===null?s=i:l.next=c,Wr(i,t.memoizedState)||(ac=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(e=n.interleaved,e!==null){a=e;do o=a.lane,Qo.lanes|=o,xl|=o,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function hs(e){var t=fs(),n=t.queue;if(n===null)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,a=n.pending,o=t.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do o=e(o,s.action),s=s.next;while(s!==a);Wr(o,t.memoizedState)||(ac=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function gs(){}function _s(e,t){var n=Qo,i=fs(),a=t(),o=!Wr(i.memoizedState,a);if(o&&(i.memoizedState=a,ac=!0),i=i.queue,ks(bs.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||es!==null&&es.memoizedState.tag&1){if(n.flags|=2048,ws(9,ys.bind(null,n,i,a,t),void 0,null),ml===null)throw Error(r(349));Zo&30||vs(n,t,a)}return a}function vs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Qo.updateQueue,t===null?(t={lastEffect:null,stores:null},Qo.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function ys(e,t,n,r){t.value=n,t.getSnapshot=r,xs(t)&&Ss(e)}function bs(e,t,n){return n(function(){xs(t)&&Ss(e)})}function xs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wr(e,n)}catch{return!0}}function Ss(e){var t=po(e,1);t!==null&&Vl(t,e,1,-1)}function Cs(e){var t=ds();return typeof e==`function`&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ps,lastRenderedState:e},t.queue=e,e=e.dispatch=Vs.bind(null,Qo,e),[t.memoizedState,e]}function ws(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Qo.updateQueue,t===null?(t={lastEffect:null,stores:null},Qo.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Ts(){return fs().memoizedState}function Es(e,t,n,r){var i=ds();Qo.flags|=e,i.memoizedState=ws(1|t,n,void 0,r===void 0?null:r)}function Ds(e,t,n,r){var i=fs();r=r===void 0?null:r;var a=void 0;if($o!==null){var o=$o.memoizedState;if(a=o.destroy,r!==null&&cs(r,o.deps)){i.memoizedState=ws(t,n,a,r);return}}Qo.flags|=e,i.memoizedState=ws(1|t,n,a,r)}function Os(e,t){return Es(8390656,8,e,t)}function ks(e,t){return Ds(2048,8,e,t)}function As(e,t){return Ds(4,2,e,t)}function js(e,t){return Ds(4,4,e,t)}function Ms(e,t){if(typeof t==`function`)return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ns(e,t,n){return n=n==null?null:n.concat([e]),Ds(4,4,Ms.bind(null,t,e),n)}function Ps(){}function Fs(e,t){var n=fs();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&cs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Is(e,t){var n=fs();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&cs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ls(e,t,n){return Zo&21?(Wr(n,t)||(n=Ut(),Qo.lanes|=n,xl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ac=!0),e.memoizedState=n)}function Rs(e,t){var n=Jt;Jt=n!==0&&4>n?n:4,e(!0);var r=Xo.transition;Xo.transition={};try{e(!1),t()}finally{Jt=n,Xo.transition=r}}function zs(){return fs().memoizedState}function Bs(e,t,n){var r=Bl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Hs(e))Us(t,n);else if(n=fo(e,t,n,r),n!==null){var i=zl();Vl(n,e,r,i),Ws(n,t,r)}}function Vs(e,t,n){var r=Bl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Hs(e))Us(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,Wr(s,o)){var c=t.interleaved;c===null?(i.next=i,uo(t)):(i.next=c.next,c.next=i),t.interleaved=i;return}}catch{}n=fo(e,t,i,r),n!==null&&(i=zl(),Vl(n,e,r,i),Ws(n,t,r))}}function Hs(e){var t=e.alternate;return e===Qo||t!==null&&t===Qo}function Us(e,t){ns=ts=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ws(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,qt(e,n)}}var Gs={readContext:co,useCallback:ss,useContext:ss,useEffect:ss,useImperativeHandle:ss,useInsertionEffect:ss,useLayoutEffect:ss,useMemo:ss,useReducer:ss,useRef:ss,useState:ss,useDebugValue:ss,useDeferredValue:ss,useTransition:ss,useMutableSource:ss,useSyncExternalStore:ss,useId:ss,unstable_isNewReconciler:!1},Ks={readContext:co,useCallback:function(e,t){return ds().memoizedState=[e,t===void 0?null:t],e},useContext:co,useEffect:Os,useImperativeHandle:function(e,t,n){return n=n==null?null:n.concat([e]),Es(4194308,4,Ms.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Es(4194308,4,e,t)},useInsertionEffect:function(e,t){return Es(4,2,e,t)},useMemo:function(e,t){var n=ds();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ds();return t=n===void 0?t:n(t),r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Bs.bind(null,Qo,e),[r.memoizedState,e]},useRef:function(e){var t=ds();return e={current:e},t.memoizedState=e},useState:Cs,useDebugValue:Ps,useDeferredValue:function(e){return ds().memoizedState=e},useTransition:function(){var e=Cs(!1),t=e[0];return e=Rs.bind(null,e[1]),ds().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=Qo,a=ds();if(Va){if(n===void 0)throw Error(r(407));n=n()}else{if(n=t(),ml===null)throw Error(r(349));Zo&30||vs(i,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Os(bs.bind(null,i,o,e),[e]),i.flags|=2048,ws(9,ys.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=ds(),t=ml.identifierPrefix;if(Va){var n=Pa,r=Na;n=(r&~(1<<32-Nt(r)-1)).toString(32)+n,t=`:`+t+`R`+n,n=rs++,0<n&&(t+=`H`+n.toString(32)),t+=`:`}else n=os++,t=`:`+t+`r`+n.toString(32)+`:`;return e.memoizedState=t},unstable_isNewReconciler:!1},qs={readContext:co,useCallback:Fs,useContext:co,useEffect:ks,useImperativeHandle:Ns,useInsertionEffect:As,useLayoutEffect:js,useMemo:Is,useReducer:ms,useRef:Ts,useState:function(){return ms(ps)},useDebugValue:Ps,useDeferredValue:function(e){var t=fs();return Ls(t,$o.memoizedState,e)},useTransition:function(){var e=ms(ps)[0],t=fs().memoizedState;return[e,t]},useMutableSource:gs,useSyncExternalStore:_s,useId:zs,unstable_isNewReconciler:!1},Js={readContext:co,useCallback:Fs,useContext:co,useEffect:ks,useImperativeHandle:Ns,useInsertionEffect:As,useLayoutEffect:js,useMemo:Is,useReducer:hs,useRef:Ts,useState:function(){return hs(ps)},useDebugValue:Ps,useDeferredValue:function(e){var t=fs();return $o===null?t.memoizedState=e:Ls(t,$o.memoizedState,e)},useTransition:function(){var e=hs(ps)[0],t=fs().memoizedState;return[e,t]},useMutableSource:gs,useSyncExternalStore:_s,useId:zs,unstable_isNewReconciler:!1};function Ys(e,t){try{var n=``,r=t;do n+=de(r),r=r.return;while(r);var i=n}catch(e){i=`
Error generating stack: `+e.message+`
`+e.stack}return{value:e,source:t,stack:i,digest:null}}function Xs(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Zs(e,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var Qs=typeof WeakMap==`function`?WeakMap:Map;function $s(e,t,n){n=_o(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){kl||(kl=!0,Al=r),Zs(e,t)},n}function ec(e,t,n){n=_o(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r==`function`){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Zs(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch==`function`&&(n.callback=function(){Zs(e,t),typeof r!=`function`&&(jl===null?jl=new Set([this]):jl.add(this));var n=t.stack;this.componentDidCatch(t.value,{componentStack:n===null?``:n})}),n}function tc(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Qs;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=lu.bind(null,e,t,n),t.then(e,e))}function nc(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t===null?!0:t.dehydrated!==null),t)return e;e=e.return}while(e!==null);return null}function rc(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=_o(-1,1),t.tag=2,vo(n,t,1))),n.lanes|=1),e)}var ic=C.ReactCurrentOwner,ac=!1;function oc(e,t,n,r){t.child=e===null?Fo(t,null,n,r):Po(t,e.child,n,r)}function sc(e,t,n,r,i){n=n.render;var a=t.ref;return so(t,i),r=ls(e,t,n,r,a,i),n=us(),e!==null&&!ac?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ec(e,t,i)):(Va&&n&&La(t),t.flags|=1,oc(e,t,r,i),t.child)}function B(e,t,n,r,i){if(e===null){var a=n.type;return typeof a==`function`&&!_u(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,cc(e,t,a,r,i)):(e=G(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,(e.lanes&i)===0){var o=a.memoizedProps;if(n=n.compare,n=n===null?Gr:n,n(o,r)&&e.ref===t.ref)return Ec(e,t,i)}return t.flags|=1,e=yu(a,r),e.ref=t.ref,e.return=t,t.child=e}function cc(e,t,n,r,i){if(e!==null){var a=e.memoizedProps;if(Gr(a,r)&&e.ref===t.ref)if(ac=!1,t.pendingProps=r=a,(e.lanes&i)!==0)e.flags&131072&&(ac=!0);else return t.lanes=e.lanes,Ec(e,t,i)}return dc(e,t,n,r,i)}function lc(e,t,n){var r=t.pendingProps,i=r.children,a=e===null?null:e.memoizedState;if(r.mode===`hidden`)if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},la(vl,_l),_l|=n;else{if(!(n&1073741824))return e=a===null?n:a.baseLanes|n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,la(vl,_l),_l|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a===null?n:a.baseLanes,la(vl,_l),_l|=r}else a===null?r=n:(r=a.baseLanes|n,t.memoizedState=null),la(vl,_l),_l|=r;return oc(e,t,i,n),t.child}function uc(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function dc(e,t,n,r,i){var a=ha(n)?pa:da.current;return a=ma(t,a),so(t,i),n=ls(e,t,n,r,a,i),r=us(),e!==null&&!ac?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ec(e,t,i)):(Va&&r&&La(t),t.flags|=1,oc(e,t,n,i),t.child)}function fc(e,t,n,r,i){if(ha(n)){var a=!0;va(t)}else a=!1;if(so(t,i),t.stateNode===null)Tc(e,t),Do(t,n,r),ko(t,n,r,i),r=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,l=n.contextType;typeof l==`object`&&l?l=co(l):(l=ha(n)?pa:da.current,l=ma(t,l));var u=n.getDerivedStateFromProps,d=typeof u==`function`||typeof o.getSnapshotBeforeUpdate==`function`;d||typeof o.UNSAFE_componentWillReceiveProps!=`function`&&typeof o.componentWillReceiveProps!=`function`||(s!==r||c!==l)&&Oo(t,o,r,l),mo=!1;var f=t.memoizedState;o.state=f,xo(t,r,o,i),c=t.memoizedState,s!==r||f!==c||fa.current||mo?(typeof u==`function`&&(wo(t,n,u,r),c=t.memoizedState),(s=mo||Eo(t,n,s,r,f,c,l))?(d||typeof o.UNSAFE_componentWillMount!=`function`&&typeof o.componentWillMount!=`function`||(typeof o.componentWillMount==`function`&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount==`function`&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount==`function`&&(t.flags|=4194308)):(typeof o.componentDidMount==`function`&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):(typeof o.componentDidMount==`function`&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,go(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:$a(t.type,s),o.props=l,d=t.pendingProps,f=o.context,c=n.contextType,typeof c==`object`&&c?c=co(c):(c=ha(n)?pa:da.current,c=ma(t,c));var p=n.getDerivedStateFromProps;(u=typeof p==`function`||typeof o.getSnapshotBeforeUpdate==`function`)||typeof o.UNSAFE_componentWillReceiveProps!=`function`&&typeof o.componentWillReceiveProps!=`function`||(s!==d||f!==c)&&Oo(t,o,r,c),mo=!1,f=t.memoizedState,o.state=f,xo(t,r,o,i);var m=t.memoizedState;s!==d||f!==m||fa.current||mo?(typeof p==`function`&&(wo(t,n,p,r),m=t.memoizedState),(l=mo||Eo(t,n,l,r,f,m,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!=`function`&&typeof o.componentWillUpdate!=`function`||(typeof o.componentWillUpdate==`function`&&o.componentWillUpdate(r,m,c),typeof o.UNSAFE_componentWillUpdate==`function`&&o.UNSAFE_componentWillUpdate(r,m,c)),typeof o.componentDidUpdate==`function`&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate==`function`&&(t.flags|=1024)):(typeof o.componentDidUpdate!=`function`||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!=`function`||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=c,r=l):(typeof o.componentDidUpdate!=`function`||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!=`function`||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return pc(e,t,n,r,a,i)}function pc(e,t,n,r,i,a){uc(e,t);var o=(t.flags&128)!=0;if(!r&&!o)return i&&ya(t,n,!1),Ec(e,t,a);r=t.stateNode,ic.current=t;var s=o&&typeof n.getDerivedStateFromError!=`function`?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Po(t,e.child,null,a),t.child=Po(t,null,s,a)):oc(e,t,s,a),t.memoizedState=r.state,i&&ya(t,n,!0),t.child}function mc(e){var t=e.stateNode;t.pendingContext?ga(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ga(e,t.context,!1),Vo(e,t.containerInfo)}function hc(e,t,n,r,i){return Xa(),Za(i),t.flags|=256,oc(e,t,n,r),t.child}var gc={dehydrated:null,treeContext:null,retryLane:0};function _c(e){return{baseLanes:e,cachePool:null,transitions:null}}function vc(e,t,n){var r=t.pendingProps,i=Go.current,a=!1,o=(t.flags&128)!=0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(i&2)!=0),s?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),la(Go,i&1),e===null)return Ka(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data===`$!`?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,a?(r=t.mode,a=t.child,o={mode:`hidden`,children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=xu(o,r,0,null),e=bu(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=_c(n),t.memoizedState=gc,e):yc(t,o));if(i=e.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return xc(e,t,o,r,s,i,n);if(a){a=r.fallback,o=t.mode,i=e.child,s=i.sibling;var c={mode:`hidden`,children:r.children};return!(o&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=yu(i,c),r.subtreeFlags=i.subtreeFlags&14680064),s===null?(a=bu(a,o,n,null),a.flags|=2):a=yu(s,a),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,o=e.child.memoizedState,o=o===null?_c(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~n,t.memoizedState=gc,r}return a=e.child,e=a.sibling,r=yu(a,{mode:`visible`,children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function yc(e,t){return t=xu({mode:`visible`,children:t},e.mode,0,null),t.return=e,e.child=t}function bc(e,t,n,r){return r!==null&&Za(r),Po(t,e.child,null,n),e=yc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function xc(e,t,n,i,a,o,s){if(n)return t.flags&256?(t.flags&=-257,i=Xs(Error(r(422))),bc(e,t,s,i)):t.memoizedState===null?(o=i.fallback,a=t.mode,i=xu({mode:`visible`,children:i.children},a,0,null),o=bu(o,a,s,null),o.flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,t.mode&1&&Po(t,e.child,null,s),t.child.memoizedState=_c(s),t.memoizedState=gc,o):(t.child=e.child,t.flags|=128,null);if(!(t.mode&1))return bc(e,t,s,null);if(a.data===`$!`){if(i=a.nextSibling&&a.nextSibling.dataset,i)var c=i.dgst;return i=c,o=Error(r(419)),i=Xs(o,i,void 0),bc(e,t,s,i)}if(c=(s&e.childLanes)!==0,ac||c){if(i=ml,i!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=(a&(i.suspendedLanes|s))===0?a:0,a!==0&&a!==o.retryLane&&(o.retryLane=a,po(e,a),Vl(i,e,a,-1))}return Ql(),i=Xs(Error(r(421))),bc(e,t,s,i)}return a.data===`$?`?(t.flags|=128,t.child=e.child,t=du.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,Ba=Ki(a.nextSibling),za=t,Va=!0,Ha=null,e!==null&&(Aa[ja++]=Na,Aa[ja++]=Pa,Aa[ja++]=Ma,Na=e.id,Pa=e.overflow,Ma=t),t=yc(t,i.children),t.flags|=4096,t)}function Sc(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),oo(e.return,t,n)}function Cc(e,t,n,r,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function wc(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(oc(e,t,r.children,n),r=Go.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)a:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Sc(e,n,t);else if(e.tag===19)Sc(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break a;for(;e.sibling===null;){if(e.return===null||e.return===t)break a;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(la(Go,r),!(t.mode&1))t.memoizedState=null;else switch(i){case`forwards`:for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&Ko(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Cc(t,!1,i,n,a);break;case`backwards`:for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Ko(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Cc(t,!0,n,null,a);break;case`together`:Cc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Tc(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ec(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),xl|=t.lanes,(n&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,n=yu(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=yu(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Dc(e,t,n){switch(t.tag){case 3:mc(t),Xa();break;case 5:Uo(t);break;case 1:ha(t.type)&&va(t);break;case 4:Vo(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;la(eo,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated===null?(n&t.child.childLanes)===0?(la(Go,Go.current&1),e=Ec(e,t,n),e===null?null:e.sibling):vc(e,t,n):(la(Go,Go.current&1),t.flags|=128,null);la(Go,Go.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return wc(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),la(Go,Go.current),r)break;return null;case 22:case 23:return t.lanes=0,lc(e,t,n)}return Ec(e,t,n)}var Oc=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},kc=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Bo(Lo.current);var o=null;switch(n){case`input`:i=be(e,i),r=be(e,r),o=[];break;case`select`:i=oe({},i,{value:void 0}),r=oe({},r,{value:void 0}),o=[];break;case`textarea`:i=Oe(e,i),r=Oe(e,r),o=[];break;default:typeof i.onClick!=`function`&&typeof r.onClick==`function`&&(e.onclick=Ii)}He(n,r);var s;for(u in n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u===`style`){var c=i[u];for(s in c)c.hasOwnProperty(s)&&(n||={},n[s]=``)}else u!==`dangerouslySetInnerHTML`&&u!==`children`&&u!==`suppressContentEditableWarning`&&u!==`suppressHydrationWarning`&&u!==`autoFocus`&&(a.hasOwnProperty(u)?o||=[]:(o||=[]).push(u,null));for(u in r){var l=r[u];if(c=i?.[u],r.hasOwnProperty(u)&&l!==c&&(l!=null||c!=null))if(u===`style`)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||={},n[s]=``);for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(n||={},n[s]=l[s])}else n||(o||=[],o.push(u,n)),n=l;else u===`dangerouslySetInnerHTML`?(l=l?l.__html:void 0,c=c?c.__html:void 0,l!=null&&c!==l&&(o||=[]).push(u,l)):u===`children`?typeof l!=`string`&&typeof l!=`number`||(o||=[]).push(u,``+l):u!==`suppressContentEditableWarning`&&u!==`suppressHydrationWarning`&&(a.hasOwnProperty(u)?(l!=null&&u===`onScroll`&&Si(`scroll`,e),o||c===l||(o=[])):(o||=[]).push(u,l))}n&&(o||=[]).push(`style`,n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Ac=function(e,t,n,r){n!==r&&(t.flags|=4)};function jc(e,t){if(!Va)switch(e.tailMode){case`hidden`:t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case`collapsed`:n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Mc(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Nc(e,t,n){var i=t.pendingProps;switch(Ra(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mc(t),null;case 1:return ha(t.type)&&z(),Mc(t),null;case 3:return i=t.stateNode,Ho(),ca(fa),ca(da),Jo(),i.pendingContext&&=(i.context=i.pendingContext,null),(e===null||e.child===null)&&(Ja(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ha!==null&&(Gl(Ha),Ha=null))),Mc(t),null;case 5:Wo(t);var o=Bo(zo.current);if(n=t.type,e!==null&&t.stateNode!=null)kc(e,t,n,i,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(r(166));return Mc(t),null}if(e=Bo(Lo.current),Ja(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[Yi]=t,i[Xi]=s,e=(t.mode&1)!=0,n){case`dialog`:Si(`cancel`,i),Si(`close`,i);break;case`iframe`:case`object`:case`embed`:Si(`load`,i);break;case`video`:case`audio`:for(o=0;o<vi.length;o++)Si(vi[o],i);break;case`source`:Si(`error`,i);break;case`img`:case`image`:case`link`:Si(`error`,i),Si(`load`,i);break;case`details`:Si(`toggle`,i);break;case`input`:xe(i,s),Si(`invalid`,i);break;case`select`:i._wrapperState={wasMultiple:!!s.multiple},Si(`invalid`,i);break;case`textarea`:ke(i,s),Si(`invalid`,i)}for(var c in He(n,s),o=null,s)if(s.hasOwnProperty(c)){var l=s[c];c===`children`?typeof l==`string`?i.textContent!==l&&(!0!==s.suppressHydrationWarning&&Fi(i.textContent,l,e),o=[`children`,l]):typeof l==`number`&&i.textContent!==``+l&&(!0!==s.suppressHydrationWarning&&Fi(i.textContent,l,e),o=[`children`,``+l]):a.hasOwnProperty(c)&&l!=null&&c===`onScroll`&&Si(`scroll`,i)}switch(n){case`input`:_e(i),we(i,s,!0);break;case`textarea`:_e(i),je(i);break;case`select`:case`option`:break;default:typeof s.onClick==`function`&&(i.onclick=Ii)}i=o,t.updateQueue=i,i!==null&&(t.flags|=4)}else{c=o.nodeType===9?o:o.ownerDocument,e===`http://www.w3.org/1999/xhtml`&&(e=Me(n)),e===`http://www.w3.org/1999/xhtml`?n===`script`?(e=c.createElement(`div`),e.innerHTML=`<script><\/script>`,e=e.removeChild(e.firstChild)):typeof i.is==`string`?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),n===`select`&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[Yi]=t,e[Xi]=i,Oc(e,t,!1,!1),t.stateNode=e;a:{switch(c=Ue(n,i),n){case`dialog`:Si(`cancel`,e),Si(`close`,e),o=i;break;case`iframe`:case`object`:case`embed`:Si(`load`,e),o=i;break;case`video`:case`audio`:for(o=0;o<vi.length;o++)Si(vi[o],e);o=i;break;case`source`:Si(`error`,e),o=i;break;case`img`:case`image`:case`link`:Si(`error`,e),Si(`load`,e),o=i;break;case`details`:Si(`toggle`,e),o=i;break;case`input`:xe(e,i),o=be(e,i),Si(`invalid`,e);break;case`option`:o=i;break;case`select`:e._wrapperState={wasMultiple:!!i.multiple},o=oe({},i,{value:void 0}),Si(`invalid`,e);break;case`textarea`:ke(e,i),o=Oe(e,i),Si(`invalid`,e);break;default:o=i}for(s in He(n,o),l=o,l)if(l.hasOwnProperty(s)){var u=l[s];s===`style`?Be(e,u):s===`dangerouslySetInnerHTML`?(u=u?u.__html:void 0,u!=null&&Fe(e,u)):s===`children`?typeof u==`string`?(n!==`textarea`||u!==``)&&Ie(e,u):typeof u==`number`&&Ie(e,``+u):s!==`suppressContentEditableWarning`&&s!==`suppressHydrationWarning`&&s!==`autoFocus`&&(a.hasOwnProperty(s)?u!=null&&s===`onScroll`&&Si(`scroll`,e):u!=null&&S(e,s,u,c))}switch(n){case`input`:_e(e),we(e,i,!1);break;case`textarea`:_e(e),je(e);break;case`option`:i.value!=null&&e.setAttribute(`value`,``+me(i.value));break;case`select`:e.multiple=!!i.multiple,s=i.value,s==null?i.defaultValue!=null&&De(e,!!i.multiple,i.defaultValue,!0):De(e,!!i.multiple,s,!1);break;default:typeof o.onClick==`function`&&(e.onclick=Ii)}switch(n){case`button`:case`input`:case`select`:case`textarea`:i=!!i.autoFocus;break a;case`img`:i=!0;break a;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Mc(t),null;case 6:if(e&&t.stateNode!=null)Ac(e,t,e.memoizedProps,i);else{if(typeof i!=`string`&&t.stateNode===null)throw Error(r(166));if(n=Bo(zo.current),Bo(Lo.current),Ja(t)){if(i=t.stateNode,n=t.memoizedProps,i[Yi]=t,(s=i.nodeValue!==n)&&(e=za,e!==null))switch(e.tag){case 3:Fi(i.nodeValue,n,(e.mode&1)!=0);break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Fi(i.nodeValue,n,(e.mode&1)!=0)}s&&(t.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Yi]=t,t.stateNode=i}return Mc(t),null;case 13:if(ca(Go),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Va&&Ba!==null&&t.mode&1&&!(t.flags&128))Ya(),Xa(),t.flags|=98560,s=!1;else if(s=Ja(t),i!==null&&i.dehydrated!==null){if(e===null){if(!s)throw Error(r(318));if(s=t.memoizedState,s=s===null?null:s.dehydrated,!s)throw Error(r(317));s[Yi]=t}else Xa(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Mc(t),s=!1}else Ha!==null&&(Gl(Ha),Ha=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Go.current&1?yl===0&&(yl=3):Ql())),t.updateQueue!==null&&(t.flags|=4),Mc(t),null);case 4:return Ho(),e===null&&Ti(t.stateNode.containerInfo),Mc(t),null;case 10:return ao(t.type._context),Mc(t),null;case 17:return ha(t.type)&&z(),Mc(t),null;case 19:if(ca(Go),s=t.memoizedState,s===null)return Mc(t),null;if(i=(t.flags&128)!=0,c=s.rendering,c===null)if(i)jc(s,!1);else{if(yl!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(c=Ko(e),c!==null){for(t.flags|=128,jc(s,!1),i=c.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;n!==null;)s=n,e=i,s.flags&=14680066,c=s.alternate,c===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return la(Go,Go.current&1|2),t.child}e=e.sibling}s.tail!==null&&Ct()>Dl&&(t.flags|=128,i=!0,jc(s,!1),t.lanes=4194304)}else{if(!i)if(e=Ko(c),e!==null){if(t.flags|=128,i=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),jc(s,!0),s.tail===null&&s.tailMode===`hidden`&&!c.alternate&&!Va)return Mc(t),null}else 2*Ct()-s.renderingStartTime>Dl&&n!==1073741824&&(t.flags|=128,i=!0,jc(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(n=s.last,n===null?t.child=c:n.sibling=c,s.last=c)}return s.tail===null?(Mc(t),null):(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ct(),t.sibling=null,n=Go.current,la(Go,i?n&1|2:n&1),t);case 22:case 23:return Yl(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?_l&1073741824&&(Mc(t),t.subtreeFlags&6&&(t.flags|=8192)):Mc(t),null;case 24:return null;case 25:return null}throw Error(r(156,t.tag))}function Pc(e,t){switch(Ra(t),t.tag){case 1:return ha(t.type)&&z(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ho(),ca(fa),ca(da),Jo(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Wo(t),null;case 13:if(ca(Go),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));Xa()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ca(Go),null;case 4:return Ho(),null;case 10:return ao(t.type._context),null;case 22:case 23:return Yl(),null;case 24:return null;default:return null}}var Fc=!1,Ic=!1,Lc=typeof WeakSet==`function`?WeakSet:Set,V=null;function Rc(e,t){var n=e.ref;if(n!==null)if(typeof n==`function`)try{n(null)}catch(n){cu(e,t,n)}else n.current=null}function zc(e,t,n){try{n()}catch(n){cu(e,t,n)}}var Bc=!1;function Vc(e,t){if(Li=xn,e=Jr(),Yr(e)){if(`selectionStart`in e)var n={start:e.selectionStart,end:e.selectionEnd};else a:{n=(n=e.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var a=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break a}var s=0,c=-1,l=-1,u=0,d=0,f=e,p=null;b:for(;;){for(var m;f!==n||a!==0&&f.nodeType!==3||(c=s+a),f!==o||i!==0&&f.nodeType!==3||(l=s+i),f.nodeType===3&&(s+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===e)break b;if(p===n&&++u===a&&(c=s),p===o&&++d===i&&(l=s),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}n=c===-1||l===-1?null:{start:c,end:l}}else n=null}n||={start:0,end:0}}else n=null;for(Ri={focusedElem:e,selectionRange:n},xn=!1,V=t;V!==null;)if(t=V,e=t.child,t.subtreeFlags&1028&&e!==null)e.return=t,V=e;else for(;V!==null;){t=V;try{var h=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var g=h.memoizedProps,_=h.memoizedState,v=t.stateNode;v.__reactInternalSnapshotBeforeUpdate=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:$a(t.type,g),_)}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent=``:y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(e){cu(t,t.return,e)}if(e=t.sibling,e!==null){e.return=t.return,V=e;break}V=t.return}return h=Bc,Bc=!1,h}function Hc(e,t,n){var r=t.updateQueue;if(r=r===null?null:r.lastEffect,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&zc(t,n,a)}i=i.next}while(i!==r)}}function Uc(e,t){if(t=t.updateQueue,t=t===null?null:t.lastEffect,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Wc(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t==`function`?t(e):t.current=e}}function Gc(e){var t=e.alternate;t!==null&&(e.alternate=null,Gc(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Yi],delete t[Xi],delete t[Qi],delete t[$i],delete t[ea])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Kc(e){return e.tag===5||e.tag===3||e.tag===4}function qc(e){a:for(;;){for(;e.sibling===null;){if(e.return===null||Kc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue a;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Jc(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Ii));else if(r!==4&&(e=e.child,e!==null))for(Jc(e,t,n),e=e.sibling;e!==null;)Jc(e,t,n),e=e.sibling}function Yc(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Yc(e,t,n),e=e.sibling;e!==null;)Yc(e,t,n),e=e.sibling}var Xc=null,Zc=!1;function Qc(e,t,n){for(n=n.child;n!==null;)$c(e,t,n),n=n.sibling}function $c(e,t,n){if(jt&&typeof jt.onCommitFiberUnmount==`function`)try{jt.onCommitFiberUnmount(At,n)}catch{}switch(n.tag){case 5:Ic||Rc(n,t);case 6:var r=Xc,i=Zc;Xc=null,Qc(e,t,n),Xc=r,Zc=i,Xc!==null&&(Zc?(e=Xc,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Xc.removeChild(n.stateNode));break;case 18:Xc!==null&&(Zc?(e=Xc,n=n.stateNode,e.nodeType===8?Gi(e.parentNode,n):e.nodeType===1&&Gi(e,n),yn(e)):Gi(Xc,n.stateNode));break;case 4:r=Xc,i=Zc,Xc=n.stateNode.containerInfo,Zc=!0,Qc(e,t,n),Xc=r,Zc=i;break;case 0:case 11:case 14:case 15:if(!Ic&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&zc(n,t,o),i=i.next}while(i!==r)}Qc(e,t,n);break;case 1:if(!Ic&&(Rc(n,t),r=n.stateNode,typeof r.componentWillUnmount==`function`))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){cu(n,t,e)}Qc(e,t,n);break;case 21:Qc(e,t,n);break;case 22:n.mode&1?(Ic=(r=Ic)||n.memoizedState!==null,Qc(e,t,n),Ic=r):Qc(e,t,n);break;default:Qc(e,t,n)}}function el(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Lc),t.forEach(function(t){var r=fu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function tl(e,t){var n=t.deletions;if(n!==null)for(var i=0;i<n.length;i++){var a=n[i];try{var o=e,s=t,c=s;a:for(;c!==null;){switch(c.tag){case 5:Xc=c.stateNode,Zc=!1;break a;case 3:Xc=c.stateNode.containerInfo,Zc=!0;break a;case 4:Xc=c.stateNode.containerInfo,Zc=!0;break a}c=c.return}if(Xc===null)throw Error(r(160));$c(o,s,a),Xc=null,Zc=!1;var l=a.alternate;l!==null&&(l.return=null),a.return=null}catch(e){cu(a,t,e)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)nl(t,e),t=t.sibling}function nl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(tl(t,e),rl(e),i&4){try{Hc(3,e,e.return),Uc(3,e)}catch(t){cu(e,e.return,t)}try{Hc(5,e,e.return)}catch(t){cu(e,e.return,t)}}break;case 1:tl(t,e),rl(e),i&512&&n!==null&&Rc(n,n.return);break;case 5:if(tl(t,e),rl(e),i&512&&n!==null&&Rc(n,n.return),e.flags&32){var a=e.stateNode;try{Ie(a,``)}catch(t){cu(e,e.return,t)}}if(i&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,s=n===null?o:n.memoizedProps,c=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{c===`input`&&o.type===`radio`&&o.name!=null&&Se(a,o),Ue(c,s);var u=Ue(c,o);for(s=0;s<l.length;s+=2){var d=l[s],f=l[s+1];d===`style`?Be(a,f):d===`dangerouslySetInnerHTML`?Fe(a,f):d===`children`?Ie(a,f):S(a,d,f,u)}switch(c){case`input`:Ce(a,o);break;case`textarea`:Ae(a,o);break;case`select`:var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m==null?p!==!!o.multiple&&(o.defaultValue==null?De(a,!!o.multiple,o.multiple?[]:``,!1):De(a,!!o.multiple,o.defaultValue,!0)):De(a,!!o.multiple,m,!1)}a[Xi]=o}catch(t){cu(e,e.return,t)}}break;case 6:if(tl(t,e),rl(e),i&4){if(e.stateNode===null)throw Error(r(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(t){cu(e,e.return,t)}}break;case 3:if(tl(t,e),rl(e),i&4&&n!==null&&n.memoizedState.isDehydrated)try{yn(t.containerInfo)}catch(t){cu(e,e.return,t)}break;case 4:tl(t,e),rl(e);break;case 13:tl(t,e),rl(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(El=Ct())),i&4&&el(e);break;case 22:if(d=n!==null&&n.memoizedState!==null,e.mode&1?(Ic=(u=Ic)||d,tl(t,e),Ic=u):tl(t,e),rl(e),i&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(V=e,d=e.child;d!==null;){for(f=V=d;V!==null;){switch(p=V,m=p.child,p.tag){case 0:case 11:case 14:case 15:Hc(4,p,p.return);break;case 1:Rc(p,p.return);var h=p.stateNode;if(typeof h.componentWillUnmount==`function`){i=p,n=p.return;try{t=i,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(e){cu(i,n,e)}}break;case 5:Rc(p,p.return);break;case 22:if(p.memoizedState!==null){sl(f);continue}}m===null?sl(f):(m.return=p,V=m)}d=d.sibling}a:for(d=null,f=e;;){if(f.tag===5){if(d===null){d=f;try{a=f.stateNode,u?(o=a.style,typeof o.setProperty==`function`?o.setProperty(`display`,`none`,`important`):o.display=`none`):(c=f.stateNode,l=f.memoizedProps.style,s=l!=null&&l.hasOwnProperty(`display`)?l.display:null,c.style.display=ze(`display`,s))}catch(t){cu(e,e.return,t)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?``:f.memoizedProps}catch(t){cu(e,e.return,t)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break a;for(;f.sibling===null;){if(f.return===null||f.return===e)break a;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:tl(t,e),rl(e),i&4&&el(e);break;case 21:break;default:tl(t,e),rl(e)}}function rl(e){var t=e.flags;if(t&2){try{a:{for(var n=e.return;n!==null;){if(Kc(n)){var i=n;break a}n=n.return}throw Error(r(160))}switch(i.tag){case 5:var a=i.stateNode;i.flags&32&&(Ie(a,``),i.flags&=-33);var o=qc(e);Yc(e,o,a);break;case 3:case 4:var s=i.stateNode.containerInfo,c=qc(e);Jc(e,c,s);break;default:throw Error(r(161))}}catch(t){cu(e,e.return,t)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function il(e,t,n){V=e,al(e,t,n)}function al(e,t,n){for(var r=(e.mode&1)!=0;V!==null;){var i=V,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Fc;if(!o){var s=i.alternate,c=s!==null&&s.memoizedState!==null||Ic;s=Fc;var l=Ic;if(Fc=o,(Ic=c)&&!l)for(V=i;V!==null;)o=V,c=o.child,o.tag===22&&o.memoizedState!==null||c===null?cl(i):(c.return=o,V=c);for(;a!==null;)V=a,al(a,t,n),a=a.sibling;V=i,Fc=s,Ic=l}ol(e,t,n)}else i.subtreeFlags&8772&&a!==null?(a.return=i,V=a):ol(e,t,n)}}function ol(e){for(;V!==null;){var t=V;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ic||Uc(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!Ic)if(n===null)i.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:$a(t.type,n.memoizedProps);i.componentDidUpdate(a,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&So(t,o,i);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}So(t,s,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var l=t.memoizedProps;switch(t.type){case`button`:case`input`:case`select`:case`textarea`:l.autoFocus&&n.focus();break;case`img`:l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&yn(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}Ic||t.flags&512&&Wc(t)}catch(e){cu(t,t.return,e)}}if(t===e){V=null;break}if(n=t.sibling,n!==null){n.return=t.return,V=n;break}V=t.return}}function sl(e){for(;V!==null;){var t=V;if(t===e){V=null;break}var n=t.sibling;if(n!==null){n.return=t.return,V=n;break}V=t.return}}function cl(e){for(;V!==null;){var t=V;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Uc(4,t)}catch(e){cu(t,n,e)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount==`function`){var i=t.return;try{r.componentDidMount()}catch(e){cu(t,i,e)}}var a=t.return;try{Wc(t)}catch(e){cu(t,a,e)}break;case 5:var o=t.return;try{Wc(t)}catch(e){cu(t,o,e)}}}catch(e){cu(t,t.return,e)}if(t===e){V=null;break}var s=t.sibling;if(s!==null){s.return=t.return,V=s;break}V=t.return}}var ll=Math.ceil,ul=C.ReactCurrentDispatcher,dl=C.ReactCurrentOwner,fl=C.ReactCurrentBatchConfig,pl=0,ml=null,hl=null,gl=0,_l=0,vl=sa(0),yl=0,bl=null,xl=0,Sl=0,Cl=0,wl=null,Tl=null,El=0,Dl=1/0,Ol=null,kl=!1,Al=null,jl=null,Ml=!1,Nl=null,Pl=0,Fl=0,Il=null,Ll=-1,Rl=0;function zl(){return pl&6?Ct():Ll===-1?Ll=Ct():Ll}function Bl(e){return e.mode&1?pl&2&&gl!==0?gl&-gl:Qa.transition===null?(e=Jt,e===0?(e=window.event,e=e===void 0?16:Dn(e.type),e):e):(Rl===0&&(Rl=Ut()),Rl):1}function Vl(e,t,n,i){if(50<Fl)throw Fl=0,Il=null,Error(r(185));Gt(e,n,i),(!(pl&2)||e!==ml)&&(e===ml&&(!(pl&2)&&(Sl|=n),yl===4&&ql(e,gl)),Hl(e,i),n===1&&pl===0&&!(t.mode&1)&&(Dl=Ct()+500,xa&&Ta()))}function Hl(e,t){var n=e.callbackNode;Vt(e,t);var r=zt(e,e===ml?gl:0);if(r===0)n!==null&&bt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&bt(n),t===1)e.tag===0?wa(Jl.bind(null,e)):Ca(Jl.bind(null,e)),Ui(function(){!(pl&6)&&Ta()}),n=null;else{switch(Yt(r)){case 1:n=Tt;break;case 4:n=Et;break;case 16:n=Dt;break;case 536870912:n=kt;break;default:n=Dt}n=mu(n,Ul.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Ul(e,t){if(Ll=-1,Rl=0,pl&6)throw Error(r(327));var n=e.callbackNode;if(ou()&&e.callbackNode!==n)return null;var i=zt(e,e===ml?gl:0);if(i===0)return null;if(i&30||(i&e.expiredLanes)!==0||t)t=$l(e,i);else{t=i;var a=pl;pl|=2;var o=W();(ml!==e||gl!==t)&&(Ol=null,Dl=Ct()+500,Xl(e,t));do try{tu();break}catch(t){Zl(e,t)}while(1);io(),ul.current=o,pl=a,hl===null?(ml=null,gl=0,t=yl):t=0}if(t!==0){if(t===2&&(a=Ht(e),a!==0&&(i=a,t=Wl(e,a))),t===1)throw n=bl,Xl(e,0),ql(e,i),Hl(e,Ct()),n;if(t===6)ql(e,i);else{if(a=e.current.alternate,!(i&30)&&!Kl(a)&&(t=$l(e,i),t===2&&(o=Ht(e),o!==0&&(i=o,t=Wl(e,o))),t===1))throw n=bl,Xl(e,0),ql(e,i),Hl(e,Ct()),n;switch(e.finishedWork=a,e.finishedLanes=i,t){case 0:case 1:throw Error(r(345));case 2:iu(e,Tl,Ol);break;case 3:if(ql(e,i),(i&130023424)===i&&(t=El+500-Ct(),10<t)){if(zt(e,0)!==0)break;if(a=e.suspendedLanes,(a&i)!==i){zl(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Bi(iu.bind(null,e,Tl,Ol),t);break}iu(e,Tl,Ol);break;case 4:if(ql(e,i),(i&4194240)===i)break;for(t=e.eventTimes,a=-1;0<i;){var s=31-Nt(i);o=1<<s,s=t[s],s>a&&(a=s),i&=~o}if(i=a,i=Ct()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*ll(i/1960))-i,10<i){e.timeoutHandle=Bi(iu.bind(null,e,Tl,Ol),i);break}iu(e,Tl,Ol);break;case 5:iu(e,Tl,Ol);break;default:throw Error(r(329))}}}return Hl(e,Ct()),e.callbackNode===n?Ul.bind(null,e):null}function Wl(e,t){var n=wl;return e.current.memoizedState.isDehydrated&&(Xl(e,t).flags|=256),e=$l(e,t),e!==2&&(t=Tl,Tl=n,t!==null&&Gl(t)),e}function Gl(e){Tl===null?Tl=e:Tl.push.apply(Tl,e)}function Kl(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Wr(a(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ql(e,t){for(t&=~Cl,t&=~Sl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Nt(t),r=1<<n;e[n]=-1,t&=~r}}function Jl(e){if(pl&6)throw Error(r(327));ou();var t=zt(e,0);if(!(t&1))return Hl(e,Ct()),null;var n=$l(e,t);if(e.tag!==0&&n===2){var i=Ht(e);i!==0&&(t=i,n=Wl(e,i))}if(n===1)throw n=bl,Xl(e,0),ql(e,t),Hl(e,Ct()),n;if(n===6)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,iu(e,Tl,Ol),Hl(e,Ct()),null}function H(e,t){var n=pl;pl|=1;try{return e(t)}finally{pl=n,pl===0&&(Dl=Ct()+500,xa&&Ta())}}function U(e){Nl!==null&&Nl.tag===0&&!(pl&6)&&ou();var t=pl;pl|=1;var n=fl.transition,r=Jt;try{if(fl.transition=null,Jt=1,e)return e()}finally{Jt=r,fl.transition=n,pl=t,!(pl&6)&&Ta()}}function Yl(){_l=vl.current,ca(vl)}function Xl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Vi(n)),hl!==null)for(n=hl.return;n!==null;){var r=n;switch(Ra(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&z();break;case 3:Ho(),ca(fa),ca(da),Jo();break;case 5:Wo(r);break;case 4:Ho();break;case 13:ca(Go);break;case 19:ca(Go);break;case 10:ao(r.type._context);break;case 22:case 23:Yl()}n=n.return}if(ml=e,hl=e=yu(e.current,null),gl=_l=t,yl=0,bl=null,Cl=Sl=xl=0,Tl=wl=null,lo!==null){for(t=0;t<lo.length;t++)if(n=lo[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}lo=null}return e}function Zl(e,t){do{var n=hl;try{if(io(),Yo.current=Gs,ts){for(var i=Qo.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}ts=!1}if(Zo=0,es=$o=Qo=null,ns=!1,rs=0,dl.current=null,n===null||n.return===null){yl=1,bl=t,hl=null;break}a:{var o=e,s=n.return,c=n,l=t;if(t=gl,c.flags|=32768,typeof l==`object`&&l&&typeof l.then==`function`){var u=l,d=c,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=nc(s);if(m!==null){m.flags&=-257,rc(m,s,c,o,t),m.mode&1&&tc(o,u,t),t=m,l=u;var h=t.updateQueue;if(h===null){var g=new Set;g.add(l),t.updateQueue=g}else h.add(l);break a}else{if(!(t&1)){tc(o,u,t),Ql();break a}l=Error(r(426))}}else if(Va&&c.mode&1){var _=nc(s);if(_!==null){!(_.flags&65536)&&(_.flags|=256),rc(_,s,c,o,t),Za(Ys(l,c));break a}}o=l=Ys(l,c),yl!==4&&(yl=2),wl===null?wl=[o]:wl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var v=$s(o,l,t);bo(o,v);break a;case 1:c=l;var y=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof y.getDerivedStateFromError==`function`||b!==null&&typeof b.componentDidCatch==`function`&&(jl===null||!jl.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t;var x=ec(o,c,t);bo(o,x);break a}}o=o.return}while(o!==null)}ru(n)}catch(e){t=e,hl===n&&n!==null&&(hl=n=n.return);continue}break}while(1)}function W(){var e=ul.current;return ul.current=Gs,e===null?Gs:e}function Ql(){(yl===0||yl===3||yl===2)&&(yl=4),ml===null||!(xl&268435455)&&!(Sl&268435455)||ql(ml,gl)}function $l(e,t){var n=pl;pl|=2;var i=W();(ml!==e||gl!==t)&&(Ol=null,Xl(e,t));do try{eu();break}catch(t){Zl(e,t)}while(1);if(io(),pl=n,ul.current=i,hl!==null)throw Error(r(261));return ml=null,gl=0,yl}function eu(){for(;hl!==null;)nu(hl)}function tu(){for(;hl!==null&&!xt();)nu(hl)}function nu(e){var t=pu(e.alternate,e,_l);e.memoizedProps=e.pendingProps,t===null?ru(e):hl=t,dl.current=null}function ru(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Pc(n,t),n!==null){n.flags&=32767,hl=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{yl=6,hl=null;return}}else if(n=Nc(n,t,_l),n!==null){hl=n;return}if(t=t.sibling,t!==null){hl=t;return}hl=t=e}while(t!==null);yl===0&&(yl=5)}function iu(e,t,n){var r=Jt,i=fl.transition;try{fl.transition=null,Jt=1,au(e,t,n,r)}finally{fl.transition=i,Jt=r}return null}function au(e,t,n,i){do ou();while(Nl!==null);if(pl&6)throw Error(r(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(Kt(e,o),e===ml&&(hl=ml=null,gl=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ml||(Ml=!0,mu(Dt,function(){return ou(),null})),o=(n.flags&15990)!=0,n.subtreeFlags&15990||o){o=fl.transition,fl.transition=null;var s=Jt;Jt=1;var c=pl;pl|=4,dl.current=null,Vc(e,n),nl(n,e),Xr(Ri),xn=!!Li,Ri=Li=null,e.current=n,il(n,e,a),St(),pl=c,Jt=s,fl.transition=o}else e.current=n;if(Ml&&(Ml=!1,Nl=e,Pl=a),o=e.pendingLanes,o===0&&(jl=null),Mt(n.stateNode,i),Hl(e,Ct()),t!==null)for(i=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],i(a.value,{componentStack:a.stack,digest:a.digest});if(kl)throw kl=!1,e=Al,Al=null,e;return Pl&1&&e.tag!==0&&ou(),o=e.pendingLanes,o&1?e===Il?Fl++:(Fl=0,Il=e):Fl=0,Ta(),null}function ou(){if(Nl!==null){var e=Yt(Pl),t=fl.transition,n=Jt;try{if(fl.transition=null,Jt=16>e?16:e,Nl===null)var i=!1;else{if(e=Nl,Nl=null,Pl=0,pl&6)throw Error(r(331));var a=pl;for(pl|=4,V=e.current;V!==null;){var o=V,s=o.child;if(V.flags&16){var c=o.deletions;if(c!==null){for(var l=0;l<c.length;l++){var u=c[l];for(V=u;V!==null;){var d=V;switch(d.tag){case 0:case 11:case 15:Hc(8,d,o)}var f=d.child;if(f!==null)f.return=d,V=f;else for(;V!==null;){d=V;var p=d.sibling,m=d.return;if(Gc(d),d===u){V=null;break}if(p!==null){p.return=m,V=p;break}V=m}}}var h=o.alternate;if(h!==null){var g=h.child;if(g!==null){h.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(g!==null)}}V=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,V=s;else b:for(;V!==null;){if(o=V,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Hc(9,o,o.return)}var v=o.sibling;if(v!==null){v.return=o.return,V=v;break b}V=o.return}}var y=e.current;for(V=y;V!==null;){s=V;var b=s.child;if(s.subtreeFlags&2064&&b!==null)b.return=s,V=b;else b:for(s=y;V!==null;){if(c=V,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Uc(9,c)}}catch(e){cu(c,c.return,e)}if(c===s){V=null;break b}var x=c.sibling;if(x!==null){x.return=c.return,V=x;break b}V=c.return}}if(pl=a,Ta(),jt&&typeof jt.onPostCommitFiberRoot==`function`)try{jt.onPostCommitFiberRoot(At,e)}catch{}i=!0}return i}finally{Jt=n,fl.transition=t}}return!1}function su(e,t,n){t=Ys(n,t),t=$s(e,t,1),e=vo(e,t,1),t=zl(),e!==null&&(Gt(e,1,t),Hl(e,t))}function cu(e,t,n){if(e.tag===3)su(e,e,n);else for(;t!==null;){if(t.tag===3){su(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError==`function`||typeof r.componentDidCatch==`function`&&(jl===null||!jl.has(r))){e=Ys(n,e),e=ec(t,e,1),t=vo(t,e,1),e=zl(),t!==null&&(Gt(t,1,e),Hl(t,e));break}}t=t.return}}function lu(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=zl(),e.pingedLanes|=e.suspendedLanes&n,ml===e&&(gl&n)===n&&(yl===4||yl===3&&(gl&130023424)===gl&&500>Ct()-El?Xl(e,0):Cl|=n),Hl(e,t)}function uu(e,t){t===0&&(e.mode&1?(t=Lt,Lt<<=1,!(Lt&130023424)&&(Lt=4194304)):t=1);var n=zl();e=po(e,t),e!==null&&(Gt(e,t,n),Hl(e,n))}function du(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),uu(e,n)}function fu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}i!==null&&i.delete(t),uu(e,n)}var pu=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||fa.current)ac=!0;else{if((e.lanes&n)===0&&!(t.flags&128))return ac=!1,Dc(e,t,n);ac=!!(e.flags&131072)}else ac=!1,Va&&t.flags&1048576&&Ia(t,ka,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Tc(e,t),e=t.pendingProps;var a=ma(t,da.current);so(t,n),a=ls(null,t,i,e,a,n);var o=us();return t.flags|=1,typeof a==`object`&&a&&typeof a.render==`function`&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ha(i)?(o=!0,va(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,ho(t),a.updater=To,t.stateNode=a,a._reactInternals=t,ko(t,i,e,n),t=pc(null,t,i,!0,o,n)):(t.tag=0,Va&&o&&La(t),oc(null,t,a,n),t=t.child),t;case 16:i=t.elementType;a:{switch(Tc(e,t),e=t.pendingProps,a=i._init,i=a(i._payload),t.type=i,a=t.tag=vu(i),e=$a(i,e),a){case 0:t=dc(null,t,i,e,n);break a;case 1:t=fc(null,t,i,e,n);break a;case 11:t=sc(null,t,i,e,n);break a;case 14:t=B(null,t,i,$a(i.type,e),n);break a}throw Error(r(306,i,``))}return t;case 0:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:$a(i,a),dc(e,t,i,a,n);case 1:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:$a(i,a),fc(e,t,i,a,n);case 3:a:{if(mc(t),e===null)throw Error(r(387));i=t.pendingProps,o=t.memoizedState,a=o.element,go(e,t),xo(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=Ys(Error(r(423)),t),t=hc(e,t,i,n,a);break a}else if(i!==a){a=Ys(Error(r(424)),t),t=hc(e,t,i,n,a);break a}else for(Ba=Ki(t.stateNode.containerInfo.firstChild),za=t,Va=!0,Ha=null,n=Fo(t,null,i,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Xa(),i===a){t=Ec(e,t,n);break a}oc(e,t,i,n)}t=t.child}return t;case 5:return Uo(t),e===null&&Ka(t),i=t.type,a=t.pendingProps,o=e===null?null:e.memoizedProps,s=a.children,zi(i,a)?s=null:o!==null&&zi(i,o)&&(t.flags|=32),uc(e,t),oc(e,t,s,n),t.child;case 6:return e===null&&Ka(t),null;case 13:return vc(e,t,n);case 4:return Vo(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=Po(t,null,i,n):oc(e,t,i,n),t.child;case 11:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:$a(i,a),sc(e,t,i,a,n);case 7:return oc(e,t,t.pendingProps,n),t.child;case 8:return oc(e,t,t.pendingProps.children,n),t.child;case 12:return oc(e,t,t.pendingProps.children,n),t.child;case 10:a:{if(i=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,la(eo,i._currentValue),i._currentValue=s,o!==null)if(Wr(o.value,s)){if(o.children===a.children&&!fa.current){t=Ec(e,t,n);break a}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){s=o.child;for(var l=c.firstContext;l!==null;){if(l.context===i){if(o.tag===1){l=_o(-1,n&-n),l.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),oo(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(r(341));s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),oo(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}oc(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,i=t.pendingProps.children,so(t,n),a=co(a),i=i(a),t.flags|=1,oc(e,t,i,n),t.child;case 14:return i=t.type,a=$a(i,t.pendingProps),a=$a(i.type,a),B(e,t,i,a,n);case 15:return cc(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:$a(i,a),Tc(e,t),t.tag=1,ha(i)?(e=!0,va(t)):e=!1,so(t,n),Do(t,i,a),ko(t,i,a,n),pc(null,t,i,!0,e,n);case 19:return wc(e,t,n);case 22:return lc(e,t,n)}throw Error(r(156,t.tag))};function mu(e,t){return yt(e,t)}function hu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gu(e,t,n,r){return new hu(e,t,n,r)}function _u(e){return e=e.prototype,!(!e||!e.isReactComponent)}function vu(e){if(typeof e==`function`)return _u(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ee)return 11;if(e===j)return 14}return 2}function yu(e,t){var n=e.alternate;return n===null?(n=gu(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function G(e,t,n,i,a,o){var s=2;if(i=e,typeof e==`function`)_u(e)&&(s=1);else if(typeof e==`string`)s=5;else a:switch(e){case E:return bu(n.children,a,o,t);case D:s=8,a|=8;break;case O:return e=gu(12,n,t,a|2),e.elementType=O,e.lanes=o,e;case te:return e=gu(13,n,t,a),e.elementType=te,e.lanes=o,e;case ne:return e=gu(19,n,t,a),e.elementType=ne,e.lanes=o,e;case re:return xu(n,a,o,t);default:if(typeof e==`object`&&e)switch(e.$$typeof){case k:s=10;break a;case A:s=9;break a;case ee:s=11;break a;case j:s=14;break a;case M:s=16,i=null;break a}throw Error(r(130,e==null?e:typeof e,``))}return t=gu(s,n,t,a),t.elementType=e,t.type=i,t.lanes=o,t}function bu(e,t,n,r){return e=gu(7,e,r,t),e.lanes=n,e}function xu(e,t,n,r){return e=gu(22,e,r,t),e.elementType=re,e.lanes=n,e.stateNode={isHidden:!1},e}function Su(e,t,n){return e=gu(6,e,null,t),e.lanes=n,e}function Cu(e,t,n){return t=gu(4,e.children===null?[]:e.children,e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function wu(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wt(0),this.expirationTimes=Wt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Tu(e,t,n,r,i,a,o,s,c){return e=new wu(e,t,n,s,c),t===1?(t=1,!0===a&&(t|=8)):t=0,a=gu(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ho(a),e}function Eu(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:T,key:r==null?null:``+r,children:e,containerInfo:t,implementation:n}}function Du(e){if(!e)return ua;e=e._reactInternals;a:{if(pt(e)!==e||e.tag!==1)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break a;case 1:if(ha(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break a}}t=t.return}while(t!==null);throw Error(r(171))}if(e.tag===1){var n=e.type;if(ha(n))return _a(e,n,t)}return t}function Ou(e,t,n,r,i,a,o,s,c){return e=Tu(n,r,!0,e,i,a,o,s,c),e.context=Du(null),n=e.current,r=zl(),i=Bl(n),a=_o(r,i),a.callback=t??null,vo(n,a,i),e.current.lanes=i,Gt(e,i,r),Hl(e,r),e}function ku(e,t,n,r){var i=t.current,a=zl(),o=Bl(i);return n=Du(n),t.context===null?t.context=n:t.pendingContext=n,t=_o(a,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=vo(i,t,o),e!==null&&(Vl(e,i,o,a),yo(e,i,o)),o}function Au(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ju(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Mu(e,t){ju(e,t),(e=e.alternate)&&ju(e,t)}function Nu(){return null}var Pu=typeof reportError==`function`?reportError:function(e){console.error(e)};function Fu(e){this._internalRoot=e}Iu.prototype.render=Fu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));ku(e,t,null,null)},Iu.prototype.unmount=Fu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;U(function(){ku(null,e,null,null)}),t[Zi]=null}};function Iu(e){this._internalRoot=e}Iu.prototype.unstable_scheduleHydration=function(e){if(e){var t=$t();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ln.length&&t!==0&&t<ln[n].priority;n++);ln.splice(n,0,e),n===0&&mn(e)}};function Lu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ru(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==` react-mount-point-unstable `))}function zu(){}function Bu(e,t,n,r,i){if(i){if(typeof r==`function`){var a=r;r=function(){var e=Au(o);a.call(e)}}var o=Ou(t,r,e,0,null,!1,!1,``,zu);return e._reactRootContainer=o,e[Zi]=o.current,Ti(e.nodeType===8?e.parentNode:e),U(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof r==`function`){var s=r;r=function(){var e=Au(c);s.call(e)}}var c=Tu(e,0,!1,null,null,!1,!1,``,zu);return e._reactRootContainer=c,e[Zi]=c.current,Ti(e.nodeType===8?e.parentNode:e),U(function(){ku(t,c,n,r)}),c}function Vu(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i==`function`){var s=i;i=function(){var e=Au(o);s.call(e)}}ku(t,o,e,i)}else o=Bu(n,t,e,i,r);return Au(o)}Xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Rt(t.pendingLanes);n!==0&&(qt(t,n|1),Hl(t,Ct()),!(pl&6)&&(Dl=Ct()+500,Ta()))}break;case 13:U(function(){var t=po(e,1);if(t!==null){var n=zl();Vl(t,e,1,n)}}),Mu(e,1)}},Zt=function(e){if(e.tag===13){var t=po(e,134217728);if(t!==null){var n=zl();Vl(t,e,134217728,n)}Mu(e,134217728)}},Qt=function(e){if(e.tag===13){var t=Bl(e),n=po(e,t);if(n!==null){var r=zl();Vl(n,e,t,r)}Mu(e,t)}},$t=function(){return Jt},en=function(e,t){var n=Jt;try{return Jt=e,t()}finally{Jt=n}},Ke=function(e,t,n){switch(t){case`input`:if(Ce(e,n),t=n.name,n.type===`radio`&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll(`input[name=`+JSON.stringify(``+t)+`][type="radio"]`),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var a=ia(i);if(!a)throw Error(r(90));ve(i),Ce(i,a)}}}break;case`textarea`:Ae(e,n);break;case`select`:t=n.value,t!=null&&De(e,!!n.multiple,t,!1)}},Qe=H,$e=U;var Hu={usingClientEntryPoint:!1,Events:[na,ra,ia,Xe,Ze,H]},Uu={findFiberByHostInstance:ta,bundleType:0,version:`18.2.0`,rendererPackageName:`react-dom`},Wu={bundleType:Uu.bundleType,version:Uu.version,rendererPackageName:Uu.rendererPackageName,rendererConfig:Uu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=_t(e),e===null?null:e.stateNode},findFiberByHostInstance:Uu.findFiberByHostInstance||Nu,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:`18.2.0-next-9e3b772b8-20220608`};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<`u`){var Gu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gu.isDisabled&&Gu.supportsFiber)try{At=Gu.inject(Wu),jt=Gu}catch{}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hu,e.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lu(t))throw Error(r(200));return Eu(e,t,null,n)},e.createRoot=function(e,t){if(!Lu(e))throw Error(r(299));var n=!1,i=``,a=Pu;return t!=null&&(!0===t.unstable_strictMode&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Tu(e,1,!1,null,null,n,!1,i,a),e[Zi]=t.current,Ti(e.nodeType===8?e.parentNode:e),new Fu(t)},e.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render==`function`?Error(r(188)):(e=Object.keys(e).join(`,`),Error(r(268,e)));return e=_t(t),e=e===null?null:e.stateNode,e},e.flushSync=function(e){return U(e)},e.hydrate=function(e,t,n){if(!Ru(t))throw Error(r(200));return Vu(null,e,t,!0,n)},e.hydrateRoot=function(e,t,n){if(!Lu(e))throw Error(r(405));var i=n!=null&&n.hydratedSources||null,a=!1,o=``,s=Pu;if(n!=null&&(!0===n.unstable_strictMode&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=Ou(t,null,e,1,n??null,a,!1,o,s),e[Zi]=t.current,Ti(e),i)for(e=0;e<i.length;e++)n=i[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Iu(t)},e.render=function(e,t,n){if(!Ru(t))throw Error(r(200));return Vu(null,e,t,!1,n)},e.unmountComponentAtNode=function(e){if(!Ru(e))throw Error(r(40));return e._reactRootContainer?(U(function(){Vu(null,null,e,!1,function(){e._reactRootContainer=null,e[Zi]=null})}),!0):!1},e.unstable_batchedUpdates=H,e.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Ru(n))throw Error(r(200));if(e==null||e._reactInternals===void 0)throw Error(r(38));return Vu(e,t,n,!1,i)},e.version=`18.2.0-next-9e3b772b8-20220608`})),g=o(((e,t)=>{function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>`u`||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=`function`))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}n(),t.exports=h()})),_=l(o((e=>{var t=g();e.createRoot=t.createRoot,e.hydrateRoot=t.hydrateRoot}))()),v=l(g()),y=l(f());
/**
* @remix-run/router v1.23.0
*
* Copyright (c) Remix Software Inc.
*
* This source code is licensed under the MIT license found in the
* LICENSE.md file in the root directory of this source tree.
*
* @license MIT
*/
function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}var x;(function(e){e.Pop=`POP`,e.Push=`PUSH`,e.Replace=`REPLACE`})(x||={});var S=`popstate`;function C(e){e===void 0&&(e={});function t(e,t){let{pathname:n,search:r,hash:i}=e.location;return O(``,{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||`default`)}function n(e,t){return typeof t==`string`?t:k(t)}return ee(t,n,null,e)}function w(e,t){if(e===!1||e==null)throw Error(t)}function T(e,t){if(!e){typeof console<`u`&&console.warn(t);try{throw Error(t)}catch{}}}function E(){return Math.random().toString(36).substr(2,8)}function D(e,t){return{usr:e.state,key:e.key,idx:t}}function O(e,t,n,r){return n===void 0&&(n=null),b({pathname:typeof e==`string`?e:e.pathname,search:``,hash:``},typeof t==`string`?A(t):t,{state:n,key:t&&t.key||r||E()})}function k(e){let{pathname:t=`/`,search:n=``,hash:r=``}=e;return n&&n!==`?`&&(t+=n.charAt(0)===`?`?n:`?`+n),r&&r!==`#`&&(t+=r.charAt(0)===`#`?r:`#`+r),t}function A(e){let t={};if(e){let n=e.indexOf(`#`);n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf(`?`);r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function ee(e,t,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,s=x.Pop,c=null,l=u();l??(l=0,o.replaceState(b({},o.state,{idx:l}),``));function u(){return(o.state||{idx:null}).idx}function d(){s=x.Pop;let e=u(),t=e==null?null:e-l;l=e,c&&c({action:s,location:h.location,delta:t})}function f(e,t){s=x.Push;let r=O(h.location,e,t);n&&n(r,e),l=u()+1;let d=D(r,l),f=h.createHref(r);try{o.pushState(d,``,f)}catch(e){if(e instanceof DOMException&&e.name===`DataCloneError`)throw e;i.location.assign(f)}a&&c&&c({action:s,location:h.location,delta:1})}function p(e,t){s=x.Replace;let r=O(h.location,e,t);n&&n(r,e),l=u();let i=D(r,l),d=h.createHref(r);o.replaceState(i,``,d),a&&c&&c({action:s,location:h.location,delta:0})}function m(e){let t=i.location.origin===`null`?i.location.href:i.location.origin,n=typeof e==`string`?e:k(e);return n=n.replace(/ $/,`%20`),w(t,`No window.location.(origin|href) available to create URL for href: `+n),new URL(n,t)}let h={get action(){return s},get location(){return e(i,o)},listen(e){if(c)throw Error(`A history only accepts one active listener`);return i.addEventListener(S,d),c=e,()=>{i.removeEventListener(S,d),c=null}},createHref(e){return t(i,e)},createURL:m,encodeLocation(e){let t=m(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:f,replace:p,go(e){return o.go(e)}};return h}var te;(function(e){e.data=`data`,e.deferred=`deferred`,e.redirect=`redirect`,e.error=`error`})(te||={});function ne(e,t,n){return n===void 0&&(n=`/`),j(e,t,n,!1)}function j(e,t,n,r){let i=typeof t==`string`?A(t):t,a=ve(i.pathname||`/`,n);if(a==null)return null;let o=M(e);ie(o);let s=null;for(let e=0;s==null&&e<o.length;++e){let t=_e(a);s=me(o[e],t,r)}return s}function M(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r=``);let i=(e,i,a)=>{let o={relativePath:a===void 0?e.path||``:a,caseSensitive:e.caseSensitive===!0,childrenIndex:i,route:e};o.relativePath.startsWith(`/`)&&(w(o.relativePath.startsWith(r),`Absolute route path "`+o.relativePath+`" nested under path `+(`"`+r+`" is not valid. An absolute child route path `)+`must start with the combined path of all its parent routes.`),o.relativePath=o.relativePath.slice(r.length));let s=Te([r,o.relativePath]),c=n.concat(o);e.children&&e.children.length>0&&(w(e.index!==!0,`Index routes must not have child routes. Please remove `+(`all child routes from route path "`+s+`".`)),M(e.children,t,c,s)),!(e.path==null&&!e.index)&&t.push({path:s,score:fe(s,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(e.path===``||!((n=e.path)!=null&&n.includes(`?`)))i(e,t);else for(let n of re(e.path))i(e,t,n)}),t}function re(e){let t=e.split(`/`);if(t.length===0)return[];let[n,...r]=t,i=n.endsWith(`?`),a=n.replace(/\?$/,``);if(r.length===0)return i?[a,``]:[a];let o=re(r.join(`/`)),s=[];return s.push(...o.map(e=>e===``?a:[a,e].join(`/`))),i&&s.push(...o),s.map(t=>e.startsWith(`/`)&&t===``?`/`:t)}function ie(e){e.sort((e,t)=>e.score===t.score?pe(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)):t.score-e.score)}var ae=/^:[\w-]+$/,oe=3,se=2,ce=1,le=10,ue=-2,de=e=>e===`*`;function fe(e,t){let n=e.split(`/`),r=n.length;return n.some(de)&&(r+=ue),t&&(r+=se),n.filter(e=>!de(e)).reduce((e,t)=>e+(ae.test(t)?oe:t===``?ce:le),r)}function pe(e,t){return e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n])?e[e.length-1]-t[t.length-1]:0}function me(e,t,n){n===void 0&&(n=!1);let{routesMeta:r}=e,i={},a=`/`,o=[];for(let e=0;e<r.length;++e){let s=r[e],c=e===r.length-1,l=a===`/`?t:t.slice(a.length)||`/`,u=he({path:s.relativePath,caseSensitive:s.caseSensitive,end:c},l),d=s.route;if(!u&&c&&n&&!r[r.length-1].route.index&&(u=he({path:s.relativePath,caseSensitive:s.caseSensitive,end:!1},l)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:Te([a,u.pathname]),pathnameBase:Ee(Te([a,u.pathnameBase])),route:d}),u.pathnameBase!==`/`&&(a=Te([a,u.pathnameBase]))}return o}function he(e,t){typeof e==`string`&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=ge(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,`$1`),s=i.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:i}=t;if(r===`*`){let e=s[n]||``;o=a.slice(0,a.length-e.length).replace(/(.)\/+$/,`$1`)}let c=s[n];return i&&!c?e[r]=void 0:e[r]=(c||``).replace(/%2F/g,`/`),e},{}),pathname:a,pathnameBase:o,pattern:e}}function ge(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),T(e===`*`||!e.endsWith(`*`)||e.endsWith(`/*`),`Route path "`+e+`" will be treated as if it were `+(`"`+e.replace(/\*$/,`/*`)+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+(`please change the route path to "`+e.replace(/\*$/,`/*`)+`".`));let r=[],i=`^`+e.replace(/\/*\*?$/,``).replace(/^\/*/,`/`).replace(/[\\.*+^${}|()[\]]/g,`\\$&`).replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:n!=null}),n?`/?([^\\/]+)?`:`/([^\\/]+)`));return e.endsWith(`*`)?(r.push({paramName:`*`}),i+=e===`*`||e===`/*`?`(.*)$`:`(?:\\/(.+)|\\/*)$`):n?i+=`\\/*$`:e!==``&&e!==`/`&&(i+=`(?:(?=\\/|$))`),[new RegExp(i,t?void 0:`i`),r]}function _e(e){try{return e.split(`/`).map(e=>decodeURIComponent(e).replace(/\//g,`%2F`)).join(`/`)}catch(t){return T(!1,`The URL path "`+e+`" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent `+(`encoding (`+t+`).`)),e}}function ve(e,t){if(t===`/`)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith(`/`)?t.length-1:t.length,r=e.charAt(n);return r&&r!==`/`?null:e.slice(n)||`/`}function ye(e,t){t===void 0&&(t=`/`);let{pathname:n,search:r=``,hash:i=``}=typeof e==`string`?A(e):e;return{pathname:n?n.startsWith(`/`)?n:be(n,t):t,search:De(r),hash:Oe(i)}}function be(e,t){let n=t.replace(/\/+$/,``).split(`/`);return e.split(`/`).forEach(e=>{e===`..`?n.length>1&&n.pop():e!==`.`&&n.push(e)}),n.length>1?n.join(`/`):`/`}function xe(e,t,n,r){return`Cannot include a '`+e+`' character in a manually specified `+("`to."+t+"` field ["+JSON.stringify(r)+`].  Please separate it out to the `)+("`to."+n+"` field. Alternatively you may provide the full path as ")+`a string in <Link to="..."> and the router will parse it for you.`}function Se(e){return e.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ce(e,t){let n=Se(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function we(e,t,n,r){r===void 0&&(r=!1);let i;typeof e==`string`?i=A(e):(i=b({},e),w(!i.pathname||!i.pathname.includes(`?`),xe(`?`,`pathname`,`search`,i)),w(!i.pathname||!i.pathname.includes(`#`),xe(`#`,`pathname`,`hash`,i)),w(!i.search||!i.search.includes(`#`),xe(`#`,`search`,`hash`,i)));let a=e===``||i.pathname===``,o=a?`/`:i.pathname,s;if(o==null)s=n;else{let e=t.length-1;if(!r&&o.startsWith(`..`)){let t=o.split(`/`);for(;t[0]===`..`;)t.shift(),--e;i.pathname=t.join(`/`)}s=e>=0?t[e]:`/`}let c=ye(i,s),l=o&&o!==`/`&&o.endsWith(`/`),u=(a||o===`.`)&&n.endsWith(`/`);return!c.pathname.endsWith(`/`)&&(l||u)&&(c.pathname+=`/`),c}var Te=e=>e.join(`/`).replace(/\/\/+/g,`/`),Ee=e=>e.replace(/\/+$/,``).replace(/^\/*/,`/`),De=e=>!e||e===`?`?``:e.startsWith(`?`)?e:`?`+e,Oe=e=>!e||e===`#`?``:e.startsWith(`#`)?e:`#`+e;function ke(e){return e!=null&&typeof e.status==`number`&&typeof e.statusText==`string`&&typeof e.internal==`boolean`&&`data`in e}function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ae.apply(this,arguments)}var je=y.createContext(null),Me=y.createContext(null),Ne=y.createContext(null),Pe=y.createContext(null),Fe=y.createContext({outlet:null,matches:[],isDataRoute:!1}),Ie=y.createContext(null);function Le(e,t){let{relative:n}=t===void 0?{}:t;!Re()&&w(!1);let{basename:r,navigator:i}=y.useContext(Ne),{hash:a,pathname:o,search:s}=Ke(e,{relative:n}),c=o;return r!==`/`&&(c=o===`/`?r:Te([r,o])),i.createHref({pathname:c,search:s,hash:a})}function Re(){return y.useContext(Pe)!=null}function ze(){return!Re()&&w(!1),y.useContext(Pe).location}function Be(e){y.useContext(Ne).static||y.useLayoutEffect(e)}function Ve(){let{isDataRoute:e}=y.useContext(Fe);return e?st():He()}function He(){!Re()&&w(!1);let e=y.useContext(je),{basename:t,future:n,navigator:r}=y.useContext(Ne),{matches:i}=y.useContext(Fe),{pathname:a}=ze(),o=JSON.stringify(Ce(i,n.v7_relativeSplatPath)),s=y.useRef(!1);return Be(()=>{s.current=!0}),y.useCallback(function(n,i){if(i===void 0&&(i={}),!s.current)return;if(typeof n==`number`){r.go(n);return}let c=we(n,JSON.parse(o),a,i.relative===`path`);e==null&&t!==`/`&&(c.pathname=c.pathname===`/`?t:Te([t,c.pathname])),(i.replace?r.replace:r.push)(c,i.state,i)},[t,r,o,a,e])}var Ue=y.createContext(null);function We(e){let t=y.useContext(Fe).outlet;return t&&y.createElement(Ue.Provider,{value:e},t)}function Ge(){let{matches:e}=y.useContext(Fe),t=e[e.length-1];return t?t.params:{}}function Ke(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=y.useContext(Ne),{matches:i}=y.useContext(Fe),{pathname:a}=ze(),o=JSON.stringify(Ce(i,r.v7_relativeSplatPath));return y.useMemo(()=>we(e,JSON.parse(o),a,n===`path`),[e,o,a,n])}function qe(e,t){return Je(e,t)}function Je(e,t,n,r){!Re()&&w(!1);let{navigator:i}=y.useContext(Ne),{matches:a}=y.useContext(Fe),o=a[a.length-1],s=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:`/`;o&&o.route;let l=ze(),u;if(t){let e=typeof t==`string`?A(t):t;!(c===`/`||e.pathname?.startsWith(c))&&w(!1),u=e}else u=l;let d=u.pathname||`/`,f=d;if(c!==`/`){let e=c.replace(/^\//,``).split(`/`);f=`/`+d.replace(/^\//,``).split(`/`).slice(e.length).join(`/`)}let p=ne(e,{pathname:f}),m=$e(p&&p.map(e=>Object.assign({},e,{params:Object.assign({},s,e.params),pathname:Te([c,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:e.pathnameBase===`/`?c:Te([c,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),a,n,r);return t&&m?y.createElement(Pe.Provider,{value:{location:Ae({pathname:`/`,search:``,hash:``,state:null,key:`default`},u),navigationType:x.Pop}},m):m}function Ye(){let e=ot(),t=ke(e)?e.status+` `+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null;return y.createElement(y.Fragment,null,y.createElement(`h2`,null,`Unexpected Application Error!`),y.createElement(`h3`,{style:{fontStyle:`italic`}},t),n?y.createElement(`pre`,{style:{padding:`0.5rem`,backgroundColor:`rgba(200,200,200, 0.5)`}},n):null,null)}var Xe=y.createElement(Ye,null),Ze=class extends y.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!==`idle`&&e.revalidation===`idle`?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error===void 0?t.error:e.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error(`React Router caught the following error during render`,e,t)}render(){return this.state.error===void 0?this.props.children:y.createElement(Fe.Provider,{value:this.props.routeContext},y.createElement(Ie.Provider,{value:this.state.error,children:this.props.component}))}};function Qe(e){let{routeContext:t,match:n,children:r}=e,i=y.useContext(je);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),y.createElement(Fe.Provider,{value:t},r)}function $e(e,t,n,r){if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var i;if(!n)return null;if(n.errors)e=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,o=n?.errors;if(o!=null){let e=a.findIndex(e=>e.route.id&&o?.[e.route.id]!==void 0);!(e>=0)&&w(!1),a=a.slice(0,Math.min(a.length,e+1))}let s=!1,c=-1;if(n&&r&&r.v7_partialHydration)for(let e=0;e<a.length;e++){let t=a[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(c=e),t.route.id){let{loaderData:e,errors:r}=n,i=t.route.loader&&e[t.route.id]===void 0&&(!r||r[t.route.id]===void 0);if(t.route.lazy||i){s=!0,a=c>=0?a.slice(0,c+1):[a[0]];break}}}return a.reduceRight((e,r,i)=>{let l,u=!1,d=null,f=null;n&&(l=o&&r.route.id?o[r.route.id]:void 0,d=r.route.errorElement||Xe,s&&(c<0&&i===0?(lt(`route-fallback`,!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,f=null):c===i&&(u=!0,f=r.route.hydrateFallbackElement||null)));let p=t.concat(a.slice(0,i+1)),m=()=>{let t;return t=l?d:u?f:r.route.Component?y.createElement(r.route.Component,null):r.route.element?r.route.element:e,y.createElement(Qe,{match:r,routeContext:{outlet:e,matches:p,isDataRoute:n!=null},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||i===0)?y.createElement(Ze,{location:n.location,revalidation:n.revalidation,component:d,error:l,children:m(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):m()},null)}var et=function(e){return e.UseBlocker=`useBlocker`,e.UseRevalidator=`useRevalidator`,e.UseNavigateStable=`useNavigate`,e}(et||{}),tt=function(e){return e.UseBlocker=`useBlocker`,e.UseLoaderData=`useLoaderData`,e.UseActionData=`useActionData`,e.UseRouteError=`useRouteError`,e.UseNavigation=`useNavigation`,e.UseRouteLoaderData=`useRouteLoaderData`,e.UseMatches=`useMatches`,e.UseRevalidator=`useRevalidator`,e.UseNavigateStable=`useNavigate`,e.UseRouteId=`useRouteId`,e}(tt||{});function nt(e){let t=y.useContext(je);return!t&&w(!1),t}function rt(e){let t=y.useContext(Me);return!t&&w(!1),t}function it(e){let t=y.useContext(Fe);return!t&&w(!1),t}function at(e){let t=it(e),n=t.matches[t.matches.length-1];return!n.route.id&&w(!1),n.route.id}function ot(){let e=y.useContext(Ie),t=rt(tt.UseRouteError),n=at(tt.UseRouteError);return e===void 0?t.errors?.[n]:e}function st(){let{router:e}=nt(et.UseNavigateStable),t=at(tt.UseNavigateStable),n=y.useRef(!1);return Be(()=>{n.current=!0}),y.useCallback(function(r,i){i===void 0&&(i={}),n.current&&(typeof r==`number`?e.navigate(r):e.navigate(r,Ae({fromRouteId:t},i)))},[e,t])}var ct={};function lt(e,t,n){!t&&!ct[e]&&(ct[e]=!0)}var ut=(e,t,n)=>(``+t+("You can use the `"+e+"` future flag to opt-in early. ")+(`For more information, see `+n+`.`),void 0);function dt(e,t){e?.v7_startTransition===void 0&&ut(`v7_startTransition`,"React Router will begin wrapping state updates in `React.startTransition` in v7",`https://reactrouter.com/v6/upgrading/future#v7_starttransition`),e?.v7_relativeSplatPath===void 0&&(!t||t.v7_relativeSplatPath===void 0)&&ut(`v7_relativeSplatPath`,`Relative route resolution within Splat routes is changing in v7`,`https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath`),t&&(t.v7_fetcherPersist===void 0&&ut(`v7_fetcherPersist`,`The persistence behavior of fetchers is changing in v7`,`https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist`),t.v7_normalizeFormMethod===void 0&&ut(`v7_normalizeFormMethod`,"Casing of `formMethod` fields is being normalized to uppercase in v7",`https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod`),t.v7_partialHydration===void 0&&ut(`v7_partialHydration`,"`RouterProvider` hydration behavior is changing in v7",`https://reactrouter.com/v6/upgrading/future#v7_partialhydration`),t.v7_skipActionErrorRevalidation===void 0&&ut(`v7_skipActionErrorRevalidation`,"The revalidation behavior after 4xx/5xx `action` responses is changing in v7",`https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation`))}y.startTransition;function ft(e){let{to:t,replace:n,state:r,relative:i}=e;!Re()&&w(!1);let{future:a,static:o}=y.useContext(Ne),{matches:s}=y.useContext(Fe),{pathname:c}=ze(),l=Ve(),u=we(t,Ce(s,a.v7_relativeSplatPath),c,i===`path`),d=JSON.stringify(u);return y.useEffect(()=>l(JSON.parse(d),{replace:n,state:r,relative:i}),[l,d,i,n,r]),null}function pt(e){return We(e.context)}function mt(e){w(!1)}function ht(e){let{basename:t=`/`,children:n=null,location:r,navigationType:i=x.Pop,navigator:a,static:o=!1,future:s}=e;Re()&&w(!1);let c=t.replace(/^\/*/,`/`),l=y.useMemo(()=>({basename:c,navigator:a,static:o,future:Ae({v7_relativeSplatPath:!1},s)}),[c,s,a,o]);typeof r==`string`&&(r=A(r));let{pathname:u=`/`,search:d=``,hash:f=``,state:p=null,key:m=`default`}=r,h=y.useMemo(()=>{let e=ve(u,c);return e==null?null:{location:{pathname:e,search:d,hash:f,state:p,key:m},navigationType:i}},[c,u,d,f,p,m,i]);return h==null?null:y.createElement(Ne.Provider,{value:l},y.createElement(Pe.Provider,{children:n,value:h}))}function gt(e){let{children:t,location:n}=e;return qe(_t(t),n)}new Promise(()=>{});function _t(e,t){t===void 0&&(t=[]);let n=[];return y.Children.forEach(e,(e,r)=>{if(!y.isValidElement(e))return;let i=[...t,r];if(e.type===y.Fragment){n.push.apply(n,_t(e.props.children,i));return}e.type!==mt&&w(!1),!(!e.props.index||!e.props.children)&&w(!1);let a={id:e.props.id||i.join(`-`),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:e.props.ErrorBoundary!=null||e.props.errorElement!=null,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=_t(e.props.children,i)),n.push(a)}),n}function vt(){return vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vt.apply(this,arguments)}function yt(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,a;for(a=0;a<r.length;a++)i=r[a],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function bt(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function xt(e,t){return e.button===0&&(!t||t===`_self`)&&!bt(e)}var St=[`onClick`,`relative`,`reloadDocument`,`replace`,`state`,`target`,`to`,`preventScrollReset`,`viewTransition`],Ct=[`aria-current`,`caseSensitive`,`className`,`end`,`style`,`to`,`viewTransition`,`children`],wt=`6`;try{window.__reactRouterVersion=wt}catch{}var Tt=y.createContext({isTransitioning:!1}),Et=y.startTransition;v.flushSync,y.useId;function Dt(e){let{basename:t,children:n,future:r,window:i}=e,a=y.useRef();a.current??=C({window:i,v5Compat:!0});let o=a.current,[s,c]=y.useState({action:o.action,location:o.location}),{v7_startTransition:l}=r||{},u=y.useCallback(e=>{l&&Et?Et(()=>c(e)):c(e)},[c,l]);return y.useLayoutEffect(()=>o.listen(u),[o,u]),y.useEffect(()=>dt(r),[r]),y.createElement(ht,{basename:t,children:n,location:s.location,navigationType:s.action,navigator:o,future:r})}var Ot=typeof window<`u`&&window.document!==void 0&&window.document.createElement!==void 0,kt=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,At=y.forwardRef(function(e,t){let{onClick:n,relative:r,reloadDocument:i,replace:a,state:o,target:s,to:c,preventScrollReset:l,viewTransition:u}=e,d=yt(e,St),{basename:f}=y.useContext(Ne),p,m=!1;if(typeof c==`string`&&kt.test(c)&&(p=c,Ot))try{let e=new URL(window.location.href),t=c.startsWith(`//`)?new URL(e.protocol+c):new URL(c),n=ve(t.pathname,f);t.origin===e.origin&&n!=null?c=n+t.search+t.hash:m=!0}catch{}let h=Le(c,{relative:r}),g=Ft(c,{replace:a,state:o,target:s,preventScrollReset:l,relative:r,viewTransition:u});function _(e){n&&n(e),e.defaultPrevented||g(e)}return y.createElement(`a`,vt({},d,{href:p||h,onClick:m||i?n:_,ref:t,target:s}))}),jt=y.forwardRef(function(e,t){let{"aria-current":n=`page`,caseSensitive:r=!1,className:i=``,end:a=!1,style:o,to:s,viewTransition:c,children:l}=e,u=yt(e,Ct),d=Ke(s,{relative:u.relative}),f=ze(),p=y.useContext(Me),{navigator:m,basename:h}=y.useContext(Ne),g=p!=null&&It(d)&&c===!0,_=m.encodeLocation?m.encodeLocation(d).pathname:d.pathname,v=f.pathname,b=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;r||(v=v.toLowerCase(),b=b?b.toLowerCase():null,_=_.toLowerCase()),b&&h&&(b=ve(b,h)||b);let x=_!==`/`&&_.endsWith(`/`)?_.length-1:_.length,S=v===_||!a&&v.startsWith(_)&&v.charAt(x)===`/`,C=b!=null&&(b===_||!a&&b.startsWith(_)&&b.charAt(_.length)===`/`),w={isActive:S,isPending:C,isTransitioning:g},T=S?n:void 0,E;E=typeof i==`function`?i(w):[i,S?`active`:null,C?`pending`:null,g?`transitioning`:null].filter(Boolean).join(` `);let D=typeof o==`function`?o(w):o;return y.createElement(At,vt({},u,{"aria-current":T,className:E,ref:t,style:D,to:s,viewTransition:c}),typeof l==`function`?l(w):l)}),Mt;(function(e){e.UseScrollRestoration=`useScrollRestoration`,e.UseSubmit=`useSubmit`,e.UseSubmitFetcher=`useSubmitFetcher`,e.UseFetcher=`useFetcher`,e.useViewTransitionState=`useViewTransitionState`})(Mt||={});var Nt;(function(e){e.UseFetcher=`useFetcher`,e.UseFetchers=`useFetchers`,e.UseScrollRestoration=`useScrollRestoration`})(Nt||={});function Pt(e){let t=y.useContext(je);return!t&&w(!1),t}function Ft(e,t){let{target:n,replace:r,state:i,preventScrollReset:a,relative:o,viewTransition:s}=t===void 0?{}:t,c=Ve(),l=ze(),u=Ke(e,{relative:o});return y.useCallback(t=>{if(xt(t,n)){t.preventDefault();let n=r===void 0?k(l)===k(u):r;c(e,{replace:n,state:i,preventScrollReset:a,relative:o,viewTransition:s})}},[l,c,u,r,i,n,e,a,o,s])}function It(e,t){t===void 0&&(t={});let n=y.useContext(Tt);n??w(!1);let{basename:r}=Pt(Mt.useViewTransitionState),i=Ke(e,{relative:t.relative});if(!n.isTransitioning)return!1;let a=ve(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=ve(n.nextLocation.pathname,r)||n.nextLocation.pathname;return he(i.pathname,o)!=null||he(i.pathname,a)!=null}var N=class e{static zeros=`.0.00.000.0000.00000.000000.0000000.00000000.000000000.0000000000.00000000000.000000000000.0000000000000.00000000000000.000000000000000.0000000000000000.00000000000000000.000000000000000000.0000000000000000000.00000000000000000000.000000000000000000000.0000000000000000000000.00000000000000000000000.000000000000000000000000.0000000000000000000000000`.split(`.`);static groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];static groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];static wordSize=26;static WORD_SIZE_BIGINT=BigInt(e.wordSize);static WORD_MASK=(1n<<e.WORD_SIZE_BIGINT)-1n;static MAX_SAFE_INTEGER_BIGINT=BigInt(2**53-1);static MIN_SAFE_INTEGER_BIGINT=BigInt(-(2**53-1));static MAX_IMULN_ARG=67108863;static MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT=(1n<<53n)-1n;_magnitude;_sign;_nominalWordLength;red;get negative(){return this._sign}set negative(e){this.assert(e===0||e===1,`Negative property must be 0 or 1`);let t=e===1?1:0;this._magnitude===0n?this._sign=0:this._sign=t}get _computedWordsArray(){if(this._magnitude===0n)return[0];let t=[],n=this._magnitude;for(;n>0n;)t.push(Number(n&e.WORD_MASK)),n>>=e.WORD_SIZE_BIGINT;return t.length>0?t:[0]}get words(){let e=this._computedWordsArray;if(this._nominalWordLength<=e.length)return e;let t=Array(this._nominalWordLength).fill(0);for(let n=0;n<e.length;n++)t[n]=e[n];return t}set words(t){let n=this._sign,r=0n,i=t.length>0?t.length:1;for(let n=i-1;n>=0;n--){let i=t[n]===void 0?0:t[n];r=r<<e.WORD_SIZE_BIGINT|BigInt(i&Number(e.WORD_MASK))}this._magnitude=r,this._sign=n,this._nominalWordLength=i,this.normSign()}get length(){return Math.max(1,this._nominalWordLength)}static isBN(t){return t instanceof e?!0:typeof t==`object`&&!!t&&t.constructor?.wordSize===e.wordSize&&Array.isArray(t.words)}static max(e,t){return e.cmp(t)>0?e:t}static min(e,t){return e.cmp(t)<0?e:t}constructor(e=0,t=10,n=`be`){if(this._magnitude=0n,this._sign=0,this._nominalWordLength=1,this.red=null,e===void 0&&(e=0),e===null){this._initializeState(0n,0);return}if(typeof e==`bigint`){this._initializeState(e<0n?-e:e,e<0n?1:0),this.normSign();return}let r=t,i=n;if((t===`le`||t===`be`)&&(i=t,r=10),typeof e==`number`){this.initNumber(e,i);return}if(Array.isArray(e)){this.initArray(e,i);return}if(typeof e==`string`){r===`hex`&&(r=16),this.assert(typeof r==`number`&&r===(r|0)&&r>=2&&r<=36,`Base must be an integer between 2 and 36`);let t=e.toString().replace(/\s+/g,``),n=0,a=0;t.startsWith(`-`)?(n++,a=1):t.startsWith(`+`)&&n++;let o=t.substring(n);if(o.length===0){this._initializeState(0n,a===1&&t.startsWith(`-`)?1:0),this.normSign();return}if(r===16){let e;if(i===`le`){let e=[],t=o;t.length%2!=0&&(t=`0`+t);for(let n=0;n<t.length;n+=2){let r=t.substring(n,n+2),i=parseInt(r,16);if(isNaN(i))throw Error(`Invalid character in `+t);e.push(i)}this.initArray(e,`le`),this._sign=a,this.normSign();return}else try{e=BigInt(`0x`+o)}catch{throw Error(`Invalid character in `+o)}this._initializeState(e,a),this.normSign()}else try{if(this._parseBaseString(o,r),this._sign=a,this.normSign(),i===`le`){let e=this._sign;this.initArray(this.toArray(`be`),`le`),this._sign=e,this.normSign()}}catch(e){let t=e;throw t.message.includes(`Invalid character in string`)||t.message.includes(`Invalid digit for base`)||t.message.startsWith(`Invalid character:`)?Error(`Invalid character`):t}}else e===0?this._initializeState(0n,0):this.assert(!1,`Unsupported input type for BigNumber constructor`)}_bigIntToStringInBase(e,t){if(e===0n)return`0`;if(t<2||t>36)throw Error(`Base must be between 2 and 36`);let n=``,r=e>0n?e:-e,i=BigInt(t);for(;r>0n;)n=`0123456789abcdefghijklmnopqrstuvwxyz`[Number(r%i)]+n,r/=i;return n}_parseBaseString(t,n){if(t.length===0){this._magnitude=0n,this._finishInitialization();return}this._magnitude=0n;let r=BigInt(n),i=e.groupSizes[n],a=BigInt(e.groupBases[n]);(i===0||a===0n)&&(i=Math.floor(Math.log(67108863)/Math.log(n)),i===0&&(i=1),a=r**BigInt(i));let o=0,s=t.length,c=s%i;if(c===0&&s>0&&(c=i),c>0){let e=t.substring(o,o+c);this._magnitude=BigInt(this._parseBaseWord(e,n)),o+=c}for(;o<s;){let e=t.substring(o,o+i),r=BigInt(this._parseBaseWord(e,n));this._magnitude=this._magnitude*a+r,o+=i}this._finishInitialization()}_parseBaseWord(e,t){let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r),a;if(i>=48&&i<=57)a=i-48;else if(i>=65&&i<=90)a=i-65+10;else if(i>=97&&i<=122)a=i-97+10;else throw Error(`Invalid character: `+e[r]);if(a>=t)throw Error(`Invalid character`);n=n*t+a}return n}_initializeState(e,t){this._magnitude=e,this._sign=e===0n?0:t,this._finishInitialization()}_finishInitialization(){if(this._magnitude===0n)this._nominalWordLength=1,this._sign=0;else{let t=this._magnitude.toString(2).length;this._nominalWordLength=Math.max(1,Math.ceil(t/e.wordSize))}}assert(e,t=`Assertion failed`){if(!e)throw Error(t)}initNumber(t,n=`be`){if(this.assert(BigInt(Math.abs(t))<=e.MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT,`The number is larger than 2 ^ 53 (unsafe)`),this.assert(t%1==0,`Number must be an integer for BigNumber conversion`),this._initializeState(BigInt(Math.abs(t)),t<0?1:0),n===`le`){let e=this._sign,t=this.toArray(`be`);this.initArray(t,`le`),this._sign=e,this.normSign()}return this}initArray(e,t){if(e.length===0)return this._initializeState(0n,0),this;let n=0n;if(t===`be`)for(let t=0;t<e.length;t++)n=n<<8n|BigInt(e[t]&255);else for(let t=e.length-1;t>=0;t--)n=n<<8n|BigInt(e[t]&255);return this._initializeState(n,0),this}copy(e){e._magnitude=this._magnitude,e._sign=this._sign,e._nominalWordLength=this._nominalWordLength,e.red=this.red}static move(e,t){e._magnitude=t._magnitude,e._sign=t._sign,e._nominalWordLength=t._nominalWordLength,e.red=t.red}clone(){let t=new e(0n);return this.copy(t),t}expand(e){return this.assert(e>=0,`Expand size must be non-negative`),this._nominalWordLength=Math.max(this._nominalWordLength,e,1),this}strip(){return this._finishInitialization(),this.normSign()}normSign(){return this._magnitude===0n&&(this._sign=0),this}inspect(){return(this.red===null?`<BN: `:`<BN-R: `)+this.toString(16)+`>`}_getMinimalHex(){return this._magnitude===0n?`0`:this._magnitude.toString(16)}toString(e=10,t=1){if(e===16||e===`hex`){let e=this._getMinimalHex();if(t>1)for(e!==`0`&&e.length%2!=0&&(e=`0`+e);e.length%t!==0;)e=`0`+e;return(this.isNeg()?`-`:``)+e}if(typeof e!=`number`||e<2||e>36||e%1!=0)throw Error(`Base should be an integer between 2 and 36`);return this.toBaseString(e,t)}toBaseString(t,n){if(this._magnitude===0n){let e=`0`;if(n>1)for(;e.length<n;)e=`0`+e;return e}let r=e.groupSizes[t],i=BigInt(e.groupBases[t]);(r===0||i===0n)&&(r=Math.floor(Math.log(2**53-1)/Math.log(t)),r===0&&(r=1),i=BigInt(t)**BigInt(r));let a=``,o=this._magnitude;for(;o>0n;){let n=o%i;o/=i;let s=this._bigIntToStringInBase(n,t);if(o>0n){let t=r-s.length;a=t>0&&t<e.zeros.length?e.zeros[t]+s+a:t>0?`0`.repeat(t)+s+a:s+a}else a=s+a}if(n>0)for(;a.length<n;)a=`0`+a;return(this._sign===1?`-`:``)+a}toNumber(){let t=this._getSignedValue();if(t>e.MAX_SAFE_INTEGER_BIGINT||t<e.MIN_SAFE_INTEGER_BIGINT)throw Error(`Number can only safely store up to 53 bits`);return Number(t)}toJSON(){let e=this._getMinimalHex();return(this.isNeg()?`-`:``)+e}toArrayLikeGeneric(e,t){let n=this._magnitude,r=t?0:e.length-1,i=t?1:-1;for(let t=0;t<e.length;++t){if(n===0n&&r>=0&&r<e.length)e[r]=0;else if(r>=0&&r<e.length)e[r]=Number(n&255n);else break;n>>=8n,r+=i}}toArray(e=`be`,t){this.strip();let n=this.byteLength(),r=t??Math.max(1,n);this.assert(n<=r,`byte array longer than desired length`),this.assert(r>0,`Requested array length <= 0`);let i=Array(r).fill(0);return this._magnitude===0n&&r>0?i:this._magnitude===0n&&r===0?[]:(this.toArrayLikeGeneric(i,e===`le`),i)}bitLength(){return this._magnitude===0n?0:this._magnitude.toString(2).length}static toBitArray(e){let t=e.bitLength();if(t===0)return[];let n=Array(t),r=e._magnitude;for(let e=0;e<t;e++)n[e]=(r>>BigInt(e)&1n)==0n?0:1;return n}toBitArray(){return e.toBitArray(this)}zeroBits(){if(this._magnitude===0n)return 0;let e=0,t=this._magnitude;for(;(t&1n)==0n&&t!==0n;)e++,t>>=1n;return e}byteLength(){return this._magnitude===0n?0:Math.ceil(this.bitLength()/8)}_getSignedValue(){return this._sign===1?-this._magnitude:this._magnitude}_setValueFromSigned(e){e<0n?(this._magnitude=-e,this._sign=1):(this._magnitude=e,this._sign=0),this._finishInitialization(),this.normSign()}toTwos(t){this.assert(t>=0);let n=BigInt(t),r=this._getSignedValue();this._sign===1&&this._magnitude!==0n&&(r=(1n<<n)+r);let i=(1n<<n)-1n;r&=i;let a=new e(0n);return a._initializeState(r,0),a}fromTwos(t){this.assert(t>=0);let n=BigInt(t),r=this._magnitude;if(t>0&&(r>>n-1n&1n)!=0n&&this._sign===0){let t=r-(1n<<n),i=new e(0n);return i._setValueFromSigned(t),i}return this.clone()}isNeg(){return this._sign===1&&this._magnitude!==0n}neg(){return this.clone().ineg()}ineg(){return this._magnitude!==0n&&(this._sign=this._sign===1?0:1),this}_iuop(e,t){let n=t(this._magnitude,e._magnitude),r=t===((e,t)=>e^t),i=this._nominalWordLength;return r&&(i=Math.max(this.length,e.length)),this._magnitude=n,this._finishInitialization(),r&&(this._nominalWordLength=Math.max(this._nominalWordLength,i)),this.strip()}iuor(e){return this._iuop(e,(e,t)=>e|t)}iuand(e){return this._iuop(e,(e,t)=>e&t)}iuxor(e){return this._iuop(e,(e,t)=>e^t)}_iop(e,t){return this.assert(this._sign===0&&e._sign===0),this._iuop(e,t)}ior(e){return this._iop(e,(e,t)=>e|t)}iand(e){return this._iop(e,(e,t)=>e&t)}ixor(e){return this._iop(e,(e,t)=>e^t)}_uop_new(e,t){return this.length>=e.length?this.clone()[t](e):e.clone()[t](this)}or(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuor`)}uor(e){return this._uop_new(e,`iuor`)}and(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuand`)}uand(e){return this._uop_new(e,`iuand`)}xor(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuxor`)}uxor(e){return this._uop_new(e,`iuxor`)}inotn(t){this.assert(typeof t==`number`&&t>=0);let n=(1n<<BigInt(t))-1n;this._magnitude=~this._magnitude&n;let r=t===0?1:Math.ceil(t/e.wordSize);return this._nominalWordLength=Math.max(1,r),this.strip(),this._nominalWordLength=Math.max(this._nominalWordLength,Math.max(1,r)),this}notn(e){return this.clone().inotn(e)}setn(t,n){this.assert(typeof t==`number`&&t>=0);let r=BigInt(t);n===1||n===!0?this._magnitude|=1n<<r:this._magnitude&=~(1n<<r);let i=Math.floor(t/e.wordSize)+1;return this._nominalWordLength=Math.max(this._nominalWordLength,i),this._finishInitialization(),this.strip()}iadd(e){return this._setValueFromSigned(this._getSignedValue()+e._getSignedValue()),this}add(t){let n=new e(0n);return n._setValueFromSigned(this._getSignedValue()+t._getSignedValue()),n}isub(e){return this._setValueFromSigned(this._getSignedValue()-e._getSignedValue()),this}sub(t){let n=new e(0n);return n._setValueFromSigned(this._getSignedValue()-t._getSignedValue()),n}mul(t){let n=new e(0n);return n._magnitude=this._magnitude*t._magnitude,n._sign=n._magnitude===0n?0:this._sign^t._sign,n._nominalWordLength=this.length+t.length,n.red=null,n.normSign()}imul(e){return this._magnitude*=e._magnitude,this._sign=this._magnitude===0n?0:this._sign^e._sign,this._nominalWordLength=this.length+e.length,this.red=null,this.normSign()}imuln(t){return this.assert(typeof t==`number`,`Assertion failed`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Assertion failed`),this._setValueFromSigned(this._getSignedValue()*BigInt(t)),this}muln(e){return this.clone().imuln(e)}sqr(){let t=new e(0n);return t._magnitude=this._magnitude*this._magnitude,t._sign=0,t._nominalWordLength=this.length*2,t.red=null,t}isqr(){return this._magnitude*=this._magnitude,this._sign=0,this._nominalWordLength=this.length*2,this.red=null,this}pow(t){if(this.assert(t._sign===0,`Exponent for pow must be non-negative`),t.isZero())return new e(1n);let n=new e(1n),r=this.clone(),i=t.clone(),a=r.isNeg(),o=i.isOdd();for(a&&r.ineg();!i.isZero();)i.isOdd()&&n.imul(r),r.isqr(),i.iushrn(1);return a&&o&&n.ineg(),n}iushln(e){return this.assert(typeof e==`number`&&e>=0),e===0?this:(this._magnitude<<=BigInt(e),this._finishInitialization(),this.strip())}ishln(e){return this.assert(this._sign===0,`ishln requires positive number`),this.iushln(e)}iushrn(e,t,n){if(this.assert(typeof e==`number`&&e>=0),e===0)return n?._initializeState(0n,0),this;if(n!=null){let t=(1n<<BigInt(e))-1n,r=this._magnitude&t;n._initializeState(r,0)}return this._magnitude>>=BigInt(e),this._finishInitialization(),this.strip()}ishrn(e,t,n){return this.assert(this._sign===0,`ishrn requires positive number`),this.iushrn(e,t,n)}shln(e){return this.clone().ishln(e)}ushln(e){return this.clone().iushln(e)}shrn(e){return this.clone().ishrn(e)}ushrn(e){return this.clone().iushrn(e)}testn(e){return this.assert(typeof e==`number`&&e>=0),(this._magnitude>>BigInt(e)&1n)!=0n}imaskn(t){this.assert(typeof t==`number`&&t>=0),this.assert(this._sign===0,`imaskn works only with positive numbers`);let n=BigInt(t),r=n===0n?0n:(1n<<n)-1n;this._magnitude&=r;let i=t===0?1:Math.max(1,Math.ceil(t/e.wordSize));return this._nominalWordLength=i,this._finishInitialization(),this._nominalWordLength=Math.max(this._nominalWordLength,i),this.strip()}maskn(e){return this.clone().imaskn(e)}iaddn(t){return this.assert(typeof t==`number`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`num is too large`),this._setValueFromSigned(this._getSignedValue()+BigInt(t)),this}_iaddn(e){return this.iaddn(e)}isubn(t){return this.assert(typeof t==`number`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Assertion failed`),this._setValueFromSigned(this._getSignedValue()-BigInt(t)),this}addn(e){return this.clone().iaddn(e)}subn(e){return this.clone().isubn(e)}iabs(){return this._sign=0,this}abs(){return this.clone().iabs()}divmod(t,n,r){if(this.assert(!t.isZero(),`Division by zero`),this.isZero()){let t=new e(0n);return{div:n===`mod`?null:t,mod:n===`div`?null:t}}let i=this._getSignedValue(),a=t._getSignedValue(),o=null,s=null;n!==`mod`&&(o=i/a),n!==`div`&&(s=i%a,r===!0&&s<0n&&(s+=a<0n?-a:a));let c=o===null?null:new e(0n);c!==null&&o!==null&&c._setValueFromSigned(o);let l=s===null?null:new e(0n);return l!==null&&s!==null&&l._setValueFromSigned(s),{div:c,mod:l}}div(e){return this.divmod(e,`div`,!1).div}mod(e){return this.divmod(e,`mod`,!1).mod}umod(e){return this.divmod(e,`mod`,!0).mod}divRound(t){this.assert(!t.isZero());let n=this._getSignedValue(),r=t._getSignedValue(),i=n/r,a=n%r;if(a===0n){let t=new e(0n);return t._setValueFromSigned(i),t}let o=a<0n?-a:a,s=r<0n?-r:r;o*2n>=s&&(n>0n&&r>0n||n<0n&&r<0n?i+=1n:i-=1n);let c=new e(0n);return c._setValueFromSigned(i),c}modrn(e){this.assert(e!==0,`Division by zero in modrn`);let t=BigInt(Math.abs(e));if(t===0n)throw Error(`Division by zero in modrn`);let n=this._magnitude%t;return e<0?Number(-n):Number(n)}idivn(t){return this.assert(t!==0),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`num is too large`),this._setValueFromSigned(this._getSignedValue()/BigInt(t)),this}divn(e){return this.clone().idivn(e)}egcd(t){this.assert(t._sign===0,`p must not be negative`),this.assert(!t.isZero(),`p must not be zero`);let n=this._getSignedValue(),r=t._magnitude,i=1n,a=0n,o=0n,s=1n;for(;r!==0n;){let e=n/r,t=r;r=n%r,n=t,t=a,a=i-e*a,i=t,t=s,s=o-e*s,o=t}let c=new e(0n);c._setValueFromSigned(i);let l=new e(0n);l._setValueFromSigned(o);let u=new e(0n);return u._initializeState(n<0n?-n:n,0),{a:c,b:l,gcd:u}}gcd(t){let n=this._magnitude,r=t._magnitude;if(n===0n){let t=new e(0n);return t._setValueFromSigned(r),t.iabs()}if(r===0n){let t=new e(0n);return t._setValueFromSigned(n),t.iabs()}for(;r!==0n;){let e=n%r;n=r,r=e}let i=new e(0n);return i._initializeState(n,0),i}invm(e){this.assert(!e.isZero()&&e._sign===0,`Modulus for invm must be positive and non-zero`);let t=this.egcd(e);if(!t.gcd.eqn(1))throw Error(`Inverse does not exist (numbers are not coprime).`);return t.a.umod(e)}isEven(){return this._magnitude%2n==0n}isOdd(){return this._magnitude%2n==1n}andln(e){return this.assert(e>=0),Number(this._magnitude&BigInt(e))}bincn(e){this.assert(typeof e==`number`&&e>=0);let t=1n<<BigInt(e);return this._setValueFromSigned(this._getSignedValue()+t),this}isZero(){return this._magnitude===0n}cmpn(t){this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Number is too big`);let n=this._getSignedValue(),r=BigInt(t);return n<r?-1:n>r?1:0}cmp(e){let t=this._getSignedValue(),n=e._getSignedValue();return t<n?-1:t>n?1:0}ucmp(e){return this._magnitude<e._magnitude?-1:this._magnitude>e._magnitude?1:0}gtn(e){return this.cmpn(e)===1}gt(e){return this.cmp(e)===1}gten(e){return this.cmpn(e)>=0}gte(e){return this.cmp(e)>=0}ltn(e){return this.cmpn(e)===-1}lt(e){return this.cmp(e)===-1}lten(e){return this.cmpn(e)<=0}lte(e){return this.cmp(e)<=0}eqn(e){return this.cmpn(e)===0}eq(e){return this.cmp(e)===0}toRed(e){return this.assert(this.red==null,`Already a number in reduction context`),this.assert(this._sign===0,`toRed works only with positives`),e.convertTo(this).forceRed(e)}fromRed(){return this.assert(this.red,`fromRed works only with numbers in reduction context`),this.red.convertFrom(this)}forceRed(e){return this.red=e,this}redAdd(e){return this.assert(this.red,`redAdd works only with red numbers`),this.red.add(this,e)}redIAdd(e){return this.assert(this.red,`redIAdd works only with red numbers`),this.red.iadd(this,e)}redSub(e){return this.assert(this.red,`redSub works only with red numbers`),this.red.sub(this,e)}redISub(e){return this.assert(this.red,`redISub works only with red numbers`),this.red.isub(this,e)}redShl(e){return this.assert(this.red,`redShl works only with red numbers`),this.red.shl(this,e)}redMul(e){return this.assert(this.red,`redMul works only with red numbers`),this.red.verify2(this,e),this.red.mul(this,e)}redIMul(e){return this.assert(this.red,`redIMul works only with red numbers`),this.red.verify2(this,e),this.red.imul(this,e)}redSqr(){return this.assert(this.red,`redSqr works only with red numbers`),this.red.verify1(this),this.red.sqr(this)}redISqr(){return this.assert(this.red,`redISqr works only with red numbers`),this.red.verify1(this),this.red.isqr(this)}redSqrt(){return this.assert(this.red,`redSqrt works only with red numbers`),this.red.verify1(this),this.red.sqrt(this)}redInvm(){return this.assert(this.red,`redInvm works only with red numbers`),this.red.verify1(this),this.red.invm(this)}redNeg(){return this.assert(this.red,`redNeg works only with red numbers`),this.red.verify1(this),this.red.neg(this)}redPow(e){return this.assert(this.red!=null&&e.red==null,`redPow(normalNum)`),this.red.verify1(this),this.red.pow(this,e)}static fromHex(t,n){let r=`be`;return(n===`little`||n===`le`)&&(r=`le`),new e(t,16,r)}toHex(e=0){if(this.isZero()&&e===0)return``;let t=this._getMinimalHex();t!==`0`&&t.length%2!=0&&(t=`0`+t);let n=e*2;for(;t.length<n;)t=`0`+t;return(this.isNeg()?`-`:``)+t}static fromJSON(t){return new e(t,16)}static fromNumber(t){return new e(t)}static fromString(t,n){return new e(t,n)}static fromSm(t,n=`big`){if(t.length===0)return new e(0n);let r=0,i=``;if(n===`little`){let e=t.length-1,n=t[e];n&128&&(r=1,n&=127),i+=(n<16?`0`:``)+n.toString(16);for(let n=e-1;n>=0;n--){let e=t[n];i+=(e<16?`0`:``)+e.toString(16)}}else{let e=t[0];e&128&&(r=1,e&=127),i+=(e<16?`0`:``)+e.toString(16);for(let e=1;e<t.length;e++){let n=t[e];i+=(n<16?`0`:``)+n.toString(16)}}let a=i===``?0n:BigInt(`0x`+i),o=new e(0n);return o._initializeState(a,r),o}toSm(e=`big`){if(this._magnitude===0n)return this._sign===1?[128]:[];let t=this._getMinimalHex();t.length%2!=0&&(t=`0`+t);let n=t.length/2,r=Array(n);for(let e=0,n=0;e<t.length;e+=2)r[n++]=parseInt(t.slice(e,e+2),16);return this._sign===1?r[0]&128?r.unshift(128):r[0]|=128:r[0]&128&&r.unshift(0),e===`little`?r.reverse():r}static fromBits(t,n=!1){let r=t>>>24,i=t&8388607,a=(t&8388608)!=0;if(n&&a)throw Error(`negative bit set`);if(r===0&&i===0){if(a&&n)throw Error(`negative bit set for zero value`);return new e(0n)}let o=new e(i);return r<=3?o.iushrn((3-r)*8):o.iushln((r-3)*8),a&&o.ineg(),o}toBits(){if(this.strip(),this.isZero()&&!this.isNeg())return 0;let e=this.isNeg(),t=this.abs(),n=t.toArray(`be`),r=0;for(;r<n.length-1&&n[r]===0;)r++;n=n.slice(r);let i=n.length;i===0&&!t.isZero()&&(n=[0],i=1),t.isZero()&&(i=0,n=[]);let a;if(i===0)a=0;else if(i<=3){a=0;for(let e=0;e<i;e++)a=a<<8|n[e]}else a=n[0]<<16|n[1]<<8|n[2];a&8388608&&i<=255&&(a>>>=8,i++);let o=i<<24|a;return e&&(o|=8388608),o>>>0}static fromScriptNum(t,n=!1,r){if(r!==void 0&&t.length>r)throw Error(`script number overflow`);if(t.length===0)return new e(0n);if(n&&!(t[t.length-1]&127)&&(t.length<=1||!(t[t.length-2]&128)))throw Error(`non-minimally encoded script number`);return e.fromSm(t,`little`)}toScriptNum(){return this.toSm(`little`)}_invmp(t){this.assert(t._sign===0,`p must not be negative for _invmp`),this.assert(!t.isZero(),`p must not be zero for _invmp`);let n=this.umod(t)._magnitude,r=t._magnitude,i=1n,a=0n,o=t._magnitude;for(;n>1n&&r>1n;){let e=0;for(;(n>>BigInt(e)&1n)==0n;)e++;if(e>0){n>>=BigInt(e);for(let t=0;t<e;++t)(i&1n)!=0n&&(i+=o),i>>=1n}let t=0;for(;(r>>BigInt(t)&1n)==0n;)t++;if(t>0){r>>=BigInt(t);for(let e=0;e<t;++e)(a&1n)!=0n&&(a+=o),a>>=1n}n>=r?(n-=r,i-=a):(r-=n,a-=i)}let s;if(n===1n)s=i;else if(r===1n)s=a;else if(n===0n&&r===1n)s=a;else if(r===0n&&n===1n)s=i;else throw Error(`_invmp: GCD is not 1, inverse does not exist. aVal=`+n+`, bVal=`+r);s%=o,s<0n&&(s+=o);let c=new e(0n);return c._initializeState(s,0),c}mulTo(e,t){return t._magnitude=this._magnitude*e._magnitude,t._sign=t._magnitude===0n?0:this._sign^e._sign,t._nominalWordLength=this.length+e.length,t.red=null,t.normSign(),t}},Lt=class{name;p;k;n;tmp;constructor(e,t){this.name=e,this.p=new N(t,16),this.n=this.p.bitLength(),this.k=new N(BigInt(1)).iushln(this.n).isub(this.p),this.tmp=this._tmp()}_tmp(){let e=new N(BigInt(0)),t=Math.ceil(this.n/N.wordSize);return e.expand(Math.max(1,t)),e}ireduce(e){let t=e,n;do this.split(t,this.tmp),this.imulK(t),t.iadd(this.tmp),n=t.bitLength();while(n>this.n);let r=n<this.n?-1:t.ucmp(this.p);return r===0?t.words=[0]:r>0&&t.isub(this.p),t.strip(),t}split(e,t){e.iushrn(this.n,0,t)}imulK(e){return e.imul(this.k)}},Rt=class extends Lt{constructor(){super(`k256`,`ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f`)}split(e,t){let n=4194303,r=e.words,i=e.length,a=Math.min(i,9),o=Array(a+(i>9?1:0)).fill(0);for(let e=0;e<a;e++)o[e]=r[e];let s=a;if(i<=9){let n=Array(s);for(let e=0;e<s;++e)n[e]=o[e];t.words=n,e.words=[0];return}let c=r[9];o[s++]=c&n;let l=Array(s);for(let e=0;e<s;++e)l[e]=o[e];t.words=l;let u=Array(Math.max(1,i-9)).fill(0),d=0;for(let e=10;e<i;e++){let t=r[e]|0;d<u.length&&(u[d++]=(t&n)<<4|c>>>22),c=t}c>>>=22,d<u.length?u[d++]=c:c!==0&&u.length;let f=Array(d);for(let e=0;e<d;++e)f[e]=u[e];e.words=f}imulK(e){let t=e.words,n=e.length,r=n+2,i=Array(r).fill(0);for(let e=0;e<n;e++)i[e]=t[e];let a=0;for(let e=0;e<r;e++){let t=i[e]|0;a+=t*977,i[e]=a&67108863,a=t*64+(a/67108864|0)}return e.words=i,e}},zt=class{prime;m;constructor(e){if(e===`k256`){let e=new Rt;this.m=e.p,this.prime=e}else this.assert(e.gtn(1),`modulus must be greater than 1`),this.m=e,this.prime=null}assert(e,t=`Assertion failed`){if(!e)throw Error(t)}verify1(e){this.assert(e.negative===0,`red works only with positives`),this.assert(e.red,`red works only with red numbers`)}verify2(e,t){this.assert((e.negative|t.negative)===0,`red works only with positives`),this.assert(e.red!=null&&e.red===t.red,`red works only with red numbers`)}imod(e){return this.prime==null?(N.move(e,e.umod(this.m).forceRed(this)),e):this.prime.ireduce(e).forceRed(this)}neg(e){return e.isZero()?e.clone():this.m.sub(e).forceRed(this)}add(e,t){this.verify2(e,t);let n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n.forceRed(this)}iadd(e,t){this.verify2(e,t);let n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n}sub(e,t){this.verify2(e,t);let n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n.forceRed(this)}isub(e,t){this.verify2(e,t);let n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n}shl(e,t){return this.verify1(e),this.imod(e.ushln(t))}imul(e,t){return this.verify2(e,t),this.imod(e.imul(t))}mul(e,t){return this.verify2(e,t),this.imod(e.mul(t))}isqr(e){return this.imul(e,e.clone())}sqr(e){return this.mul(e,e)}sqrt(e){if(e.isZero())return e.clone();let t=this.m.andln(3);if(this.assert(t%2==1),t===3){let t=this.m.add(new N(1)).iushrn(2);return this.pow(e,t)}let n=this.m.subn(1),r=0;for(;!n.isZero()&&n.andln(1)===0;)r++,n.iushrn(1);this.assert(!n.isZero());let i=new N(1).toRed(this),a=i.redNeg(),o=this.m.subn(1).iushrn(1),s=this.m.bitLength(),c=new N(2*s*s).toRed(this);for(;this.pow(c,o).cmp(a)!==0;)c.redIAdd(a);let l=this.pow(c,n),u=this.pow(e,n.addn(1).iushrn(1)),d=this.pow(e,n),f=r;for(;d.cmp(i)!==0;){let e=d,t=0;for(;e.cmp(i)!==0;t++)e=e.redSqr();this.assert(t<f);let n=this.pow(l,new N(1).iushln(f-t-1));u=u.redMul(n),l=n.redSqr(),d=d.redMul(l),f=t}return u}invm(e){let t=e._invmp(this.m);return t.negative===0?this.imod(t):(t.negative=0,this.imod(t).redNeg())}pow(e,t){if(t.isZero())return new N(1).toRed(this);if(t.cmpn(1)===0)return e.clone();let n=Array(16);n[0]=new N(1).toRed(this),n[1]=e;let r=2;for(;r<n.length;r++)n[r]=this.mul(n[r-1],e);let i=n[0],a=0,o=0,s=t.bitLength()%26;for(s===0&&(s=26),r=t.length-1;r>=0;r--){let e=t.words[r];for(let t=s-1;t>=0;t--){let s=e>>t&1;if(i!==n[0]&&(i=this.sqr(i)),s===0&&a===0){o=0;continue}a<<=1,a|=s,o++,!(o!==4&&(r!==0||t!==0))&&(i=this.mul(i,n[a]),o=0,a=0)}s=26}return i}convertTo(e){let t=e.umod(this.m);return t===e?t.clone():t}convertFrom(e){let t=e.clone();return t.red=null,t}},Bt=class extends zt{shift;r;r2;rinv;minv;constructor(e){super(e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new N(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}convertTo(e){return this.imod(e.ushln(this.shift))}convertFrom(e){let t=this.imod(e.mul(this.rinv));return t.red=null,t}imul(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;let n=e.imul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a.forceRed(this)}mul(e,t){if(e.isZero()||t.isZero())return new N(0).forceRed(this);let n=e.mul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a.forceRed(this)}invm(e){return this.imod(e._invmp(this.m).mul(this.r2)).forceRed(this)}},Vt=class{curve;type;precomputed;constructor(e){this.curve=new wi,this.type=e,this.precomputed=null}},Ht=class e extends Vt{x;y;z;zOne;constructor(e,t,n){super(`jacobian`),e===null&&t===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new N(0)):(N.isBN(e)||(e=new N(e,16)),this.x=e,N.isBN(t)||(t=new N(t,16)),this.y=t,N.isBN(n)||(n=new N(n,16)),this.z=n),this.x.red??(this.x=this.x.toRed(this.curve.red)),this.y.red??(this.y=this.y.toRed(this.curve.red)),this.z.red??(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}toP(){if(this.isInfinity())return new Si(null,null);let e=this.z.redInvm(),t=e.redSqr(),n=this.x.redMul(t),r=this.y.redMul(t).redMul(e);return new Si(n,r)}neg(){return new e(this.x,this.y.redNeg(),this.z)}add(t){if(this.isInfinity())return t;if(t.isInfinity())return this;let n=t.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(n),a=t.x.redMul(r),o=this.y.redMul(n.redMul(t.z)),s=t.y.redMul(r.redMul(this.z)),c=i.redSub(a),l=o.redSub(s);if(c.cmpn(0)===0)return l.cmpn(0)===0?this.dbl():new e(null,null,null);let u=c.redSqr(),d=u.redMul(c),f=i.redMul(u),p=l.redSqr().redIAdd(d).redISub(f).redISub(f),m=l.redMul(f.redISub(p)).redISub(o.redMul(d)),h=this.z.redMul(t.z).redMul(c);return new e(p,m,h)}mixedAdd(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;if(t.x===null||t.y===null)throw Error(`Point coordinates cannot be null`);let n=this.z.redSqr(),r=this.x,i=t.x.redMul(n),a=this.y,o=t.y.redMul(n).redMul(this.z),s=r.redSub(i),c=a.redSub(o);if(s.cmpn(0)===0)return c.cmpn(0)===0?this.dbl():new e(null,null,null);let l=s.redSqr(),u=l.redMul(s),d=r.redMul(l),f=c.redSqr().redIAdd(u).redISub(d).redISub(d),p=c.redMul(d.redISub(f)).redISub(a.redMul(u)),m=this.z.redMul(s);return new e(f,p,m)}dblp(e){if(e===0||this.isInfinity())return this;if(e===void 0)return this.dbl();let t=this;for(let n=0;n<e;n++)t=t.dbl();return t}dbl(){if(this.isInfinity())return this;let t,n,r;if(this.zOne){let e=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(e).redISub(a);o=o.redIAdd(o);let s=e.redAdd(e).redIAdd(e),c=s.redSqr().redISub(o).redISub(o),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),t=c,n=s.redMul(o.redISub(c)).redISub(l),r=this.y.redAdd(this.y)}else{let e=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(e).redISub(a);o=o.redIAdd(o);let s=e.redAdd(e).redIAdd(e),c=s.redSqr(),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),t=c.redISub(o).redISub(o),n=s.redMul(o.redISub(t)).redISub(l),r=this.y.redMul(this.z),r=r.redIAdd(r)}return new e(t,n,r)}eq(e){if(e.type===`affine`)return this.eq(e.toJ());if(this===e)return!0;let t=this.z.redSqr();e=e;let n=e.z.redSqr();if(this.x.redMul(n).redISub(e.x.redMul(t)).cmpn(0)!==0)return!1;let r=t.redMul(this.z),i=n.redMul(e.z);return this.y.redMul(i).redISub(e.y.redMul(r)).cmpn(0)===0}eqXToP(e){let t=this.z.redSqr(),n=e.toRed(this.curve?.red).redMul(t);if(this.x.cmp(n)===0)return!0;let r=e.clone();if(this.curve===null||this.curve.redN==null)throw Error(`Curve or redN is not initialized.`);let i=this.curve.redN.redMul(t);for(;r.cmp(this.curve.p)<0;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(n.redIAdd(i),this.x.cmp(n)===0)return!0}return!1}inspect(){return this.isInfinity()?`<EC JPoint Infinity>`:`<EC JPoint x: `+this.x.toString(16,2)+` y: `+this.y.toString(16,2)+` z: `+this.z.toString(16,2)+`>`}isInfinity(){return this.z.cmpn(0)===0}},Ut=o(((e,t)=>{t.exports={}})),Wt=s({RIPEMD160:()=>Cn,SHA1:()=>Tn,SHA1HMAC:()=>On,SHA256:()=>wn,SHA256HMAC:()=>Dn,SHA512:()=>En,SHA512HMAC:()=>kn,hash160:()=>Fn,hash256:()=>Pn,pbkdf2:()=>Nr,ripemd160:()=>An,sha1:()=>jn,sha256:()=>Mn,sha256hmac:()=>In,sha512:()=>Nn,sha512hmac:()=>Ln,toArray:()=>Jt}),Gt=(e,t=`Hash assertion failed`)=>{if(!e)throw Error(t)},Kt=class{pending;pendingTotal;blockSize;outSize;endian;_delta8;_delta32;padLength;hmacStrength;constructor(e,t,n,r){this.pending=null,this.pendingTotal=0,this.blockSize=e,this.outSize=t,this.hmacStrength=n,this.padLength=r/8,this.endian=`big`,this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}_update(e,t){throw Error(`Not implemented`)}_digest(){throw Error(`Not implemented`)}_digestHex(){throw Error(`Not implemented`)}update(e,t){if(e=Jt(e,t),this.pending==null?this.pending=e:this.pending=this.pending.concat(e),this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;let t=e.length%this._delta8;this.pending=e.slice(e.length-t,e.length),this.pending.length===0&&(this.pending=null),e=$t(e,0,e.length-t,this.endian);for(let t=0;t<e.length;t+=this._delta32)this._update(e,t)}return this}digest(){return this.update(this._pad()),Gt(this.pending===null),this._digest()}digestHex(){return this.update(this._pad()),Gt(this.pending===null),this._digestHex()}_pad(){let e=this.pendingTotal,t=this._delta8,n=t-(e+this.padLength)%t,r=Array(n+this.padLength);r[0]=128;let i;for(i=1;i<n;i++)r[i]=0;e<<=3;let a;if(this.endian===`big`){for(a=8;a<this.padLength;a++)r[i++]=0;r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=e>>>24&255,r[i++]=e>>>16&255,r[i++]=e>>>8&255,r[i++]=e&255}else for(r[i++]=e&255,r[i++]=e>>>8&255,r[i++]=e>>>16&255,r[i++]=e>>>24&255,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,a=8;a<this.padLength;a++)r[i++]=0;return r}};function qt(e,t){return(e.charCodeAt(t)&64512)!=55296||t<0||t+1>=e.length?!1:(e.charCodeAt(t+1)&64512)==56320}function Jt(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];let n=[];if(typeof e==`string`)if(t!==`hex`){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?n[t++]=i:i<2048?(n[t++]=i>>6|192,n[t++]=i&63|128):qt(e,r)?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),n[t++]=i>>18|240,n[t++]=i>>12&63|128,n[t++]=i>>6&63|128,n[t++]=i&63|128):(n[t++]=i>>12|224,n[t++]=i>>6&63|128,n[t++]=i&63|128)}}else{e=e.replace(/[^a-z0-9]+/gi,``),e.length%2!=0&&(e=`0`+e);for(let t=0;t<e.length;t+=2)n.push(parseInt(e[t]+e[t+1],16))}else{e=e;for(let t=0;t<e.length;t++)n[t]=e[t]|0}return n}function Yt(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(e&255)<<24)>>>0}function Xt(e,t){let n=``;for(let r=0;r<e.length;r++){let i=e[r];t===`little`&&(i=Yt(i)),n+=Zt(i.toString(16))}return n}function Zt(e){return e.length===7?`0`+e:e.length===6?`00`+e:e.length===5?`000`+e:e.length===4?`0000`+e:e.length===3?`00000`+e:e.length===2?`000000`+e:e.length===1?`0000000`+e:e}function Qt(e){let t=``;for(let n of e)t+=n.toString(16).padStart(2,`0`);return t}function $t(e,t,n,r){let i=n-t;Gt(i%4==0);let a=Array(i/4);for(let n=0,i=t;n<a.length;n++,i+=4){let t;t=r===`big`?e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]:e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i],a[n]=t>>>0}return a}function en(e,t){let n=Array(e.length*4);for(let r=0,i=0;r<e.length;r++,i+=4){let a=e[r];t===`big`?(n[i]=a>>>24,n[i+1]=a>>>16&255,n[i+2]=a>>>8&255,n[i+3]=a&255):(n[i+3]=a>>>24,n[i+2]=a>>>16&255,n[i+1]=a>>>8&255,n[i]=a&255)}return n}function tn(e,t){return e>>>t|e<<32-t}function nn(e,t){return e<<t|e>>>32-t}function rn(e,t){return e+t>>>0}function an(e,t,n){return e+t+n>>>0}function on(e,t,n,r){return e+t+n+r>>>0}function sn(e,t,n,r,i){return e+t+n+r+i>>>0}function cn(e,t,n,r){return e===0?ln(t,n,r):e===1||e===3?dn(t,n,r):e===2?un(t,n,r):0}function ln(e,t,n){return e&t^~e&n}function un(e,t,n){return e&t^e&n^t&n}function dn(e,t,n){return e^t^n}function fn(e){return tn(e,2)^tn(e,13)^tn(e,22)}function pn(e){return tn(e,6)^tn(e,11)^tn(e,25)}function mn(e){return tn(e,7)^tn(e,18)^e>>>3}function hn(e){return tn(e,17)^tn(e,19)^e>>>10}var gn=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],_n=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],vn=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],yn=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function bn(e,t,n,r){return e<=15?t^n^r:e<=31?t&n|~t&r:e<=47?(t|~n)^r:e<=63?t&r|n&~r:t^(n|~r)}function xn(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function Sn(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var Cn=class extends Kt{h;constructor(){super(512,160,192,64),this.endian=`little`,this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian=`little`}_update(e,t){let n=this.h[0],r=this.h[1],i=this.h[2],a=this.h[3],o=this.h[4],s=n,c=r,l=i,u=a,d=o,f;for(let p=0;p<80;p++)f=rn(nn(on(n,bn(p,r,i,a),e[gn[p]+t],xn(p)),vn[p]),o),n=o,o=a,a=nn(i,10),i=r,r=f,f=rn(nn(on(s,bn(79-p,c,l,u),e[_n[p]+t],Sn(p)),yn[p]),d),s=d,d=u,u=nn(l,10),l=c,c=f;f=an(this.h[1],i,u),this.h[1]=an(this.h[2],a,d),this.h[2]=an(this.h[3],o,s),this.h[3]=an(this.h[4],n,c),this.h[4]=an(this.h[0],r,l),this.h[0]=f}_digest(){return en(this.h,`little`)}_digestHex(){return Xt(this.h,`little`)}},wn=class{h;constructor(){this.h=new yr}update(e,t){let n=Uint8Array.from(Jt(e,t));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return Qt(this.h.digest())}},Tn=class extends Kt{h;W;k;constructor(){super(512,160,80,64),this.k=[1518500249,1859775393,2400959708,3395469782],this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=Array(80)}_update(e,t){let n=this.W;t===void 0&&(t=0);let r;for(r=0;r<16;r++)n[r]=e[t+r];for(;r<n.length;r++)n[r]=nn(n[r-3]^n[r-8]^n[r-14]^n[r-16],1);let i=this.h[0],a=this.h[1],o=this.h[2],s=this.h[3],c=this.h[4];for(r=0;r<n.length;r++){let e=~~(r/20),t=sn(nn(i,5),cn(e,a,o,s),c,n[r],this.k[e]);c=s,s=o,o=nn(a,30),a=i,i=t}this.h[0]=rn(this.h[0],i),this.h[1]=rn(this.h[1],a),this.h[2]=rn(this.h[2],o),this.h[3]=rn(this.h[3],s),this.h[4]=rn(this.h[4],c)}_digest(){return en(this.h,`big`)}_digestHex(){return Xt(this.h,`big`)}},En=class{h;constructor(){this.h=new Dr}update(e,t){let n=Uint8Array.from(Jt(e,t));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return Qt(this.h.digest())}},Dn=class{h;blockSize=64;outSize=32;constructor(e){let t=Uint8Array.from(Jt(e,`hex`));this.h=new kr(br,t)}update(e,t){return this.h.update(Uint8Array.from(Jt(e,t))),this}digest(){return Array.from(this.h.digest())}digestHex(){return Qt(this.h.digest())}},On=class{inner;outer;blockSize=64;constructor(e){e=Jt(e,`hex`),e.length>this.blockSize&&(e=new Tn().update(e).digest());let t;for(t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=new Tn().update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=new Tn().update(e)}update(e,t){return this.inner.update(e,t),this}digest(){return this.outer.update(this.inner.digest()),this.outer.digest()}digestHex(){return this.outer.update(this.inner.digest()),this.outer.digestHex()}},kn=class{h;blockSize=128;outSize=32;constructor(e){let t=Uint8Array.from(Jt(e,`hex`));this.h=new kr(Or,t)}update(e,t){return this.h.update(Uint8Array.from(Jt(e,t))),this}digest(){return Array.from(this.h.digest())}digestHex(){return Qt(this.h.digest())}};const An=(e,t)=>new Cn().update(e,t).digest(),jn=(e,t)=>new Tn().update(e,t).digest(),Mn=(e,t)=>new wn().update(e,t).digest(),Nn=(e,t)=>new En().update(e,t).digest(),Pn=(e,t)=>{let n=new wn().update(e,t).digest();return new wn().update(n).digest()},Fn=(e,t)=>{let n=new wn().update(e,t).digest();return new Cn().update(n).digest()},In=(e,t,n)=>new Dn(e).update(t,n).digest(),Ln=(e,t,n)=>new kn(e).update(t,n).digest();function Rn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function zn(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got ${e}`)}function Bn(e,...t){if(!Rn(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length)){let n=t.join(`,`);throw Error(`Uint8Array expected of length ${n}, got length=${e.length}`)}}function Vn(e){if(typeof e!=`function`||typeof e.create!=`function`)throw Error(`Hash should be wrapped by utils.createHasher`);zn(e.outputLen),zn(e.blockLen)}function Hn(e,t=!0){if(e.destroyed===!0)throw Error(`Hash instance has been destroyed`);if(t&&e.finished===!0)throw Error(`Hash#digest() has already been called`)}function Un(e,t){Bn(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least ${n}`)}function Wn(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Gn(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Kn(e){return typeof e==`string`&&(e=qn(e)),Bn(e),e}function qn(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}function Jn(e){return typeof e==`string`&&(e=qn(e)),Bn(e),e}var Yn=class{};function Xn(e){let t=t=>e().update(Kn(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}var Zn=BigInt(2**32-1),Qn=BigInt(32);function $n(e,t=!1){return t?{h:Number(e&Zn),l:Number(e>>Qn&Zn)}:{h:Number(e>>Qn&Zn)|0,l:Number(e&Zn)|0}}function er(e,t=!1){let n=e.length,r=new Uint32Array(n),i=new Uint32Array(n);for(let a=0;a<n;a++){let{h:n,l:o}=$n(e[a],t);r[a]=n,i[a]=o}return[r,i]}var tr=(e,t,n)=>e>>>n,nr=(e,t,n)=>e<<32-n|t>>>n,rr=(e,t,n)=>e>>>n|t<<32-n,ir=(e,t,n)=>e<<32-n|t>>>n,ar=(e,t,n)=>e<<64-n|t>>>n-32,or=(e,t,n)=>e>>>n-32|t<<64-n;function sr(e,t,n,r){let i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}var cr=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),lr=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,ur=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),dr=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,fr=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),pr=(e,t,n,r,i,a)=>t+n+r+i+a+(e/2**32|0)|0,mr=class extends Yn{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=Gn(this.buffer)}update(e){Hn(this),e=Kn(e),Bn(e);let{view:t,buffer:n,blockLen:r}=this,i=e.length;for(let a=0;a<i;){let o=Math.min(r-this.pos,i-a);if(o===r){let t=Gn(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hn(this),Un(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,Wn(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;hr(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=Gn(e),s=this.outputLen;if(s%4!=0)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.destroyed=a,e.finished=i,e.length=r,e.pos=o,r%t!==0&&e.buffer.set(n),e}clone(){return this._cloneInto()}};function hr(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}var gr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_r=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vr=new Uint32Array(64),yr=class extends mr{A=gr[0]|0;B=gr[1]|0;C=gr[2]|0;D=gr[3]|0;E=gr[4]|0;F=gr[5]|0;G=gr[6]|0;H=gr[7]|0;constructor(e=32){super(64,e,8,!1)}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)vr[n]=e.getUint32(t);for(let e=16;e<64;e++){let t=vr[e-15],n=vr[e-2],r=mn(t),i=hn(n);vr[e]=rn(rn(r,vr[e-7]),rn(i,vr[e-16]))}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=sn(l,pn(o),ln(o,s,c),_r[e],vr[e]),u=rn(fn(n),un(n,r,i));l=c,c=s,s=o,o=rn(a,t),a=i,i=r,r=n,n=rn(t,u)}this.A=rn(this.A,n),this.B=rn(this.B,r),this.C=rn(this.C,i),this.D=rn(this.D,a),this.E=rn(this.E,o),this.F=rn(this.F,s),this.G=rn(this.G,c),this.H=rn(this.H,l)}roundClean(){Wn(vr)}destroy(){Wn(this.buffer),this.set(0,0,0,0,0,0,0,0)}},br=Xn(()=>new yr),xr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Sr=(()=>er(`0x428a2f98d728ae22.0x7137449123ef65cd.0xb5c0fbcfec4d3b2f.0xe9b5dba58189dbbc.0x3956c25bf348b538.0x59f111f1b605d019.0x923f82a4af194f9b.0xab1c5ed5da6d8118.0xd807aa98a3030242.0x12835b0145706fbe.0x243185be4ee4b28c.0x550c7dc3d5ffb4e2.0x72be5d74f27b896f.0x80deb1fe3b1696b1.0x9bdc06a725c71235.0xc19bf174cf692694.0xe49b69c19ef14ad2.0xefbe4786384f25e3.0x0fc19dc68b8cd5b5.0x240ca1cc77ac9c65.0x2de92c6f592b0275.0x4a7484aa6ea6e483.0x5cb0a9dcbd41fbd4.0x76f988da831153b5.0x983e5152ee66dfab.0xa831c66d2db43210.0xb00327c898fb213f.0xbf597fc7beef0ee4.0xc6e00bf33da88fc2.0xd5a79147930aa725.0x06ca6351e003826f.0x142929670a0e6e70.0x27b70a8546d22ffc.0x2e1b21385c26c926.0x4d2c6dfc5ac42aed.0x53380d139d95b3df.0x650a73548baf63de.0x766a0abb3c77b2a8.0x81c2c92e47edaee6.0x92722c851482353b.0xa2bfe8a14cf10364.0xa81a664bbc423001.0xc24b8b70d0f89791.0xc76c51a30654be30.0xd192e819d6ef5218.0xd69906245565a910.0xf40e35855771202a.0x106aa07032bbd1b8.0x19a4c116b8d2d0c8.0x1e376c085141ab53.0x2748774cdf8eeb99.0x34b0bcb5e19b48a8.0x391c0cb3c5c95a63.0x4ed8aa4ae3418acb.0x5b9cca4f7763e373.0x682e6ff3d6b2b8a3.0x748f82ee5defb2fc.0x78a5636f43172f60.0x84c87814a1f0ab72.0x8cc702081a6439ec.0x90befffa23631e28.0xa4506cebde82bde9.0xbef9a3f7b2c67915.0xc67178f2e372532b.0xca273eceea26619c.0xd186b8c721c0c207.0xeada7dd6cde0eb1e.0xf57d4f7fee6ed178.0x06f067aa72176fba.0x0a637dc5a2c898a6.0x113f9804bef90dae.0x1b710b35131c471b.0x28db77f523047d84.0x32caab7b40c72493.0x3c9ebe0a15c9bebc.0x431d67c49c100d4c.0x4cc5d4becb3e42b6.0x597f299cfc657e2a.0x5fcb6fab3ad6faec.0x6c44198c4a475817`.split(`.`).map(e=>BigInt(e))))(),Cr=(()=>Sr[0])(),wr=(()=>Sr[1])(),Tr=new Uint32Array(80),Er=new Uint32Array(80),Dr=class extends mr{Ah=xr[0]|0;Al=xr[1]|0;Bh=xr[2]|0;Bl=xr[3]|0;Ch=xr[4]|0;Cl=xr[5]|0;Dh=xr[6]|0;Dl=xr[7]|0;Eh=xr[8]|0;El=xr[9]|0;Fh=xr[10]|0;Fl=xr[11]|0;Gh=xr[12]|0;Gl=xr[13]|0;Hh=xr[14]|0;Hl=xr[15]|0;constructor(e=64){super(128,e,16,!1)}get(){let{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:a,Dh:o,Dl:s,Eh:c,El:l,Fh:u,Fl:d,Gh:f,Gl:p,Hh:m,Hl:h}=this;return[e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h]}set(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=r|0,this.Ch=i|0,this.Cl=a|0,this.Dh=o|0,this.Dl=s|0,this.Eh=c|0,this.El=l|0,this.Fh=u|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=m|0,this.Hl=h|0}process(e,t){for(let n=0;n<16;n++,t+=4)Tr[n]=e.getUint32(t),Er[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=Tr[e-15]|0,n=Er[e-15]|0,r=rr(t,n,1)^rr(t,n,8)^tr(t,n,7),i=ir(t,n,1)^ir(t,n,8)^nr(t,n,7),a=Tr[e-2]|0,o=Er[e-2]|0,s=rr(a,o,19)^ar(a,o,61)^tr(a,o,6),c=ir(a,o,19)^or(a,o,61)^nr(a,o,6),l=ur(i,c,Er[e-7],Er[e-16]);Tr[e]=dr(l,r,s,Tr[e-7],Tr[e-16])|0,Er[e]=l|0}let{Ah:n,Al:r,Bh:i,Bl:a,Ch:o,Cl:s,Dh:c,Dl:l,Eh:u,El:d,Fh:f,Fl:p,Gh:m,Gl:h,Hh:g,Hl:_}=this;for(let e=0;e<80;e++){let t=rr(u,d,14)^rr(u,d,18)^ar(u,d,41),v=ir(u,d,14)^ir(u,d,18)^or(u,d,41),y=u&f^~u&m,b=d&p^~d&h,x=fr(_,v,b,wr[e],Er[e]),S=pr(x,g,t,y,Cr[e],Tr[e]),C=x|0,w=rr(n,r,28)^ar(n,r,34)^ar(n,r,39),T=ir(n,r,28)^or(n,r,34)^or(n,r,39),E=n&i^n&o^i&o,D=r&a^r&s^a&s;g=m|0,_=h|0,m=f|0,h=p|0,f=u|0,p=d|0,{h:u,l:d}=sr(c|0,l|0,S|0,C|0),c=o|0,l=s|0,o=i|0,s=a|0,i=n|0,a=r|0;let O=cr(T,D,C);n=lr(O,w,E,S),r=O|0}({h:n,l:r}=sr(n,r,this.Ah,this.Al)),{h:i,l:a}=sr(i,a,this.Bh,this.Bl),{h:o,l:s}=sr(o,s,this.Ch,this.Cl),{h:c,l}=sr(c,l,this.Dh,this.Dl),{h:u,l:d}=sr(u,d,this.Eh,this.El),{h:f,l:p}=sr(f,p,this.Fh,this.Fl),{h:m,l:h}=sr(m,h,this.Gh,this.Gl),{h:g,l:_}=sr(g,_,this.Hh,this.Hl),this.set(n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_)}roundClean(){Wn(Tr,Er)}destroy(){Wn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Or=Xn(()=>new Dr),kr=class extends Yn{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){super(),Vn(e);let n=Kn(t);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),Wn(i)}update(e){return Hn(this),this.iHash.update(e),this}digestInto(e){Hn(this),Bn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash??void 0),e.iHash=n._cloneInto(e.iHash??void 0),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};function Ar(e,t,n,r){Vn(e);let{c:i,dkLen:a}=Object.assign({dkLen:32},r);if(zn(i),zn(a),i<1)throw Error(`iterations (c) should be >= 1`);let o=Jn(t),s=Jn(n),c=new Uint8Array(a),l=jr.create(e,o),u=l._cloneInto().update(s),d,f=new Uint8Array(4),p=Gn(f),m=new Uint8Array(l.outputLen);for(let e=1,t=0;t<a;e++,t+=l.outputLen){let n=c.subarray(t,t+l.outputLen);p.setInt32(0,e,!1),(d=u._cloneInto(d)).update(f).digestInto(m),n.set(m.subarray(0,n.length));for(let e=1;e<i;e++){l._cloneInto(d).update(m).digestInto(m);for(let e=0;e<n.length;e++)n[e]^=m[e]}}return l.destroy(),u.destroy(),d?.destroy(),Wn(m),c}var jr=(e,t,n)=>new kr(e,t).update(n).digest();jr.create=(e,t)=>new kr(e,t);function Mr(e,t,n,r){return Ar(Or,e,t,{c:n,dkLen:r})}function Nr(e,t,n,r,i=`sha512`){if(i!==`sha512`)throw Error(`Only sha512 is supported in this PBKDF2 implementation`);try{let a=Ut();if(typeof a.pbkdf2Sync==`function`){let o=Buffer.from(e),s=Buffer.from(t);return[...a.pbkdf2Sync(o,s,n,r,i)]}}catch{}let a=Uint8Array.from(e),o=Uint8Array.from(t),s=Mr(a,o,n,r);return Array.from(s)}var Pr=s({Reader:()=>Kr,Writer:()=>L,encode:()=>zr,fromBase58:()=>Hr,fromBase58Check:()=>Gr,minimallyEncode:()=>qr,toArray:()=>F,toBase58:()=>Ur,toBase58Check:()=>Wr,toBase64:()=>Br,toHex:()=>P,toUTF8:()=>I,zero2:()=>Fr});const Fr=e=>e.length%2==1?`0`+e:e,P=e=>{let t=``;for(let n of e)t+=Fr(n.toString(16));return t},F=(e,t)=>{if(Array.isArray(e))return e.slice();if(e===void 0)return[];if(typeof e!=`string`)return Array.from(e,e=>e|0);switch(t){case`hex`:return Ir(e);case`base64`:return Lr(e);default:return Rr(e)}};var Ir=e=>{e=e.replace(/[^a-z0-9]+/gi,``),e.length%2!=0&&(e=`0`+e);let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e[n]+e[n+1],16));return t},Lr=e=>{let t=[],n=0,r=0;for(let i of e.replace(/=+$/,``))n=n<<6|`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`.indexOf(i),r+=6,r>=8&&(r-=8,t.push(n>>r&255),n&=(1<<r)-1);return t};function Rr(e){let t=[];for(let n=0;n<e.length;n++){let r=e.codePointAt(n);if(r===void 0)throw Error(`Index out of range: ${n}`);let i=r;i>65535?n++:i>=55296&&i<=57343&&(i=65533),i<=127?t.push(i):i<=2047?t.push(192|i>>6,128|i&63):i<=65535?t.push(224|i>>12,128|i>>6&63,128|i&63):t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}return t}const I=e=>{let t=``,n=0;for(let r=0;r<e.length;r++){let i=e[r];if(n>0){n--;continue}if(i<=127)t+=String.fromCharCode(i);else if(i>=192&&i<=223){let a=e[r+1];n=1;let o=(i&31)<<6|a&63;t+=String.fromCharCode(o)}else if(i>=224&&i<=239){let a=e[r+1],o=e[r+2];n=2;let s=(i&15)<<12|(a&63)<<6|o&63;t+=String.fromCharCode(s)}else if(i>=240&&i<=247){let a=e[r+1],o=e[r+2],s=e[r+3];n=3;let c=(i&7)<<18|(a&63)<<12|(o&63)<<6|s&63,l=55296+(c-65536>>10),u=56320+(c-65536&1023);t+=String.fromCharCode(l,u)}}return t},zr=(e,t)=>{switch(t){case`hex`:return P(e);case`utf8`:return I(e);default:return e}};function Br(e){let t=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,n=``,r;for(r=0;r<e.length;r+=3){let i=e[r],a=r+1<e.length?e[r+1]:0,o=r+2<e.length?e[r+2]:0,s=i>>2,c=(i&3)<<4|a>>4,l=(a&15)<<2|o>>6,u=o&63;n+=t.charAt(s)+t.charAt(c),n+=r+1<e.length?t.charAt(l):`=`,n+=r+2<e.length?t.charAt(u):`=`}return n}var Vr=`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`;const Hr=e=>{if(e===``||typeof e!=`string`)throw Error(`Expected base58 string but got ${e}`);let t=e.match(/[IOl0]/gmu);if(t!==null)throw Error(`Invalid base58 character ${t.join(``)}`);let n=e.match(/^1+/gmu),r=n===null?0:n[0].length,i=(e.length-r)*(Math.log(58)/Math.log(256))+1>>>0;return[...new Uint8Array([...new Uint8Array(r),...(e.match(/./gmu)??[]).map(e=>Vr.indexOf(e)).reduce((e,t)=>(e=e.map(e=>{let n=e*58+t;return t=n>>8,n}),e),new Uint8Array(i)).reverse().filter((e=>t=>e||=t)(!1))])]},Ur=e=>{let t=Array(256).fill(-1);for(let e=0;e<58;++e)t[Vr.charCodeAt(e)]=e;let n=[];for(let r of e){let e=r;for(let r=0;r<n.length;++r){let i=(t[n[r]]<<8)+e;n[r]=Vr.charCodeAt(i%58),e=i/58|0}for(;e!==0;)n.push(Vr.charCodeAt(e%58)),e=e/58|0}for(let t of e)if(t!==0)break;else n.push(49);return n.reverse(),String.fromCharCode(...n)},Wr=(e,t=[0])=>{let n=Pn([...t,...e]);return n=[...t,...e,...n.slice(0,4)],Ur(n)},Gr=(e,t,n=1)=>{let r=Hr(e),i=r.slice(0,n),a=r.slice(n,-4),o=[...i,...a];return o=Pn(o),r.slice(-4).forEach((e,t)=>{if(e!==o[t])throw Error(`Invalid checksum`)}),t===`hex`&&(i=P(i),a=P(a)),{prefix:i,data:a}};var L=class e{bufs;length;constructor(e){this.bufs=e===void 0?[]:e,this.length=0;for(let e of this.bufs)this.length+=e.length}getLength(){return this.length}toArray(){let e=this.length,t=Array(e),n=0;for(let e of this.bufs)for(let r of e)t[n++]=r;return t}write(e){return this.bufs.push(e),this.length+=e.length,this}writeReverse(e){let t=Array(e.length);for(let n=0;n<t.length;n++)t[n]=e[e.length-1-n];return this.bufs.push(t),this.length+=t.length,this}writeUInt8(e){let t=[,];return t[0]=e,this.write(t),this}writeInt8(e){let t=[,];return t[0]=e&255,this.write(t),this}writeUInt16BE(e){let t=[e>>8&255,e&255];return this.bufs.push(t),this.length+=2,this}writeInt16BE(e){return this.writeUInt16BE(e&65535)}writeUInt16LE(e){let t=[e&255,e>>8&255];return this.bufs.push(t),this.length+=2,this}writeInt16LE(e){return this.writeUInt16LE(e&65535)}writeUInt32BE(e){let t=[e>>24&255,e>>16&255,e>>8&255,e&255];return this.bufs.push(t),this.length+=4,this}writeInt32BE(e){return this.writeUInt32BE(e>>>0)}writeUInt32LE(e){let t=[e&255,e>>8&255,e>>16&255,e>>24&255];return this.bufs.push(t),this.length+=4,this}writeInt32LE(e){return this.writeUInt32LE(e>>>0)}writeUInt64BEBn(e){let t=e.toArray(`be`,8);return this.write(t),this}writeUInt64LEBn(e){let t=e.toArray(`be`,8);return this.writeReverse(t),this}writeUInt64LE(e){let t=new N(e).toArray(`be`,8);return this.writeReverse(t),this}writeVarIntNum(t){let n=e.varIntNum(t);return this.write(n),this}writeVarIntBn(t){let n=e.varIntBn(t);return this.write(n),this}static varIntNum(e){let t;if(e<0)return this.varIntBn(new N(e));if(e<253)t=[e];else if(e<65536)t=[253,e&255,e>>8&255];else if(e<4294967296)t=[254,e&255,e>>8&255,e>>16&255,e>>24&255];else{let n=e&4294967295,r=Math.floor(e/4294967296)&4294967295;t=[255,n&255,n>>8&255,n>>16&255,n>>24&255,r&255,r>>8&255,r>>16&255,r>>24&255]}return t}static varIntBn(t){let n;if(t.isNeg()&&(t=t.add(Yr)),t.ltn(253))n=[t.toNumber()];else if(t.ltn(65536)){let e=t.toNumber();n=[253,e&255,e>>8&255]}else if(t.lt(new N(4294967296))){let e=t.toNumber();n=[254,e&255,e>>8&255,e>>16&255,e>>24&255]}else{let r=new e;r.writeUInt8(255),r.writeUInt64LEBn(t),n=r.toArray()}return n}},Kr=class{bin;pos;length;constructor(e=[],t=0){this.bin=e,this.pos=t,this.length=e.length}eof(){return this.pos>=this.length}read(e=this.length){let t=this.pos,n=this.pos+e;return this.pos=n,this.bin.slice(t,n)}readReverse(e=this.length){let t=Array(e);for(let n=0;n<e;n++)t[n]=this.bin[this.pos+e-1-n];return this.pos+=e,t}readUInt8(){let e=this.bin[this.pos];return this.pos+=1,e}readInt8(){let e=this.bin[this.pos];return this.pos+=1,e&128?e-256:e}readUInt16BE(){let e=this.bin[this.pos]<<8|this.bin[this.pos+1];return this.pos+=2,e}readInt16BE(){let e=this.readUInt16BE();return e&32768?e-65536:e}readUInt16LE(){let e=this.bin[this.pos]|this.bin[this.pos+1]<<8;return this.pos+=2,e}readInt16LE(){let e=this.readUInt16LE();return e&32768?e-65536:e}readUInt32BE(){let e=this.bin[this.pos]*16777216+(this.bin[this.pos+1]<<16|this.bin[this.pos+2]<<8|this.bin[this.pos+3]);return this.pos+=4,e}readInt32BE(){let e=this.readUInt32BE();return e&2147483648?e-4294967296:e}readUInt32LE(){let e=(this.bin[this.pos]|this.bin[this.pos+1]<<8|this.bin[this.pos+2]<<16|this.bin[this.pos+3]<<24)>>>0;return this.pos+=4,e}readInt32LE(){let e=this.readUInt32LE();return e&2147483648?e-4294967296:e}readUInt64BEBn(){let e=this.bin.slice(this.pos,this.pos+8),t=new N(e);return this.pos+=8,t}readUInt64LEBn(){let e=this.readReverse(8);return new N(e)}readInt64LEBn(){let e=this.readReverse(8),t=new N(e);return t.gte(Jr)&&(t=t.sub(Yr)),t}readVarIntNum(e=!0){let t=this.readUInt8(),n;switch(t){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:if(n=e?this.readInt64LEBn():this.readUInt64LEBn(),n.lte(new N(2).pow(new N(53))))return n.toNumber();throw Error(`number too large to retain precision - use readVarIntBn`);default:return t}}readVarInt(){switch(this.bin[this.pos]){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}}readVarIntBn(){let e=this.readUInt8();switch(e){case 253:return new N(this.readUInt16LE());case 254:return new N(this.readUInt32LE());case 255:return this.readUInt64LEBn();default:return new N(e)}}};const qr=e=>{if(e.length===0)return e;let t=e[e.length-1];if(t&127)return e;if(e.length===1)return[];if(e[e.length-2]&128)return e;for(let n=e.length-1;n>0;n--)if(e[n-1]!==0)return e[n-1]&128?(e[n]=t,e.slice(0,n+1)):(e[n-1]|=t,e.slice(0,n));return[]};var Jr=new N(2).pow(new N(63)),Yr=new N(2).pow(new N(64));const Xr=0n,Zr=1n,Qr=2n,$r=115792089237316195423570985008687907853269984665640564039457584007908834671663n,ei=115792089237316195423570985008687907852837564279074904382605163141518161494337n,ti=(1n<<256n)-1n;function ni(e){let t=e>>256n;return e=(e&ti)+(t<<32n)+t*977n,t=e>>256n,e=(e&ti)+(t<<32n)+t*977n,e>=115792089237316195423570985008687907853269984665640564039457584007908834671663n&&(e-=$r),e}const ri=e=>ni((e%$r+$r)%$r),ii=(e,t)=>e>=t?e-t:$r-(t-e),R=(e,t)=>ni(e*t),ai=(e,t)=>ni(e+t),oi=e=>{let t=Zr,n=Xr,r=ri(e),i=$r;for(;r>Zr;){let e=i/r;[t,n]=[n-t*e,t],[r,i]=[i-r*e,r]}return ri(t)},si=e=>R(e,e),ci=(e,t)=>{let n=Zr;e=ri(e);let r=t;for(;r>Xr;)(r&1n)==1n&&(n=R(n,e)),e=R(e,e),r>>=Zr;return n},li=$r+1n>>2n,ui=e=>{let t=ci(e,li);return R(t,t)===ri(e)?t:null};var di=e=>N.isBN(e)?BigInt(`0x`+e.toString(16)):typeof e==`string`?BigInt(`0x`+e):Array.isArray(e)?BigInt(`0x`+P(e)):BigInt(e);const fi=BigInt(`0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798`),pi=BigInt(`0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8`);var mi=new Map;const hi=e=>{let{X:t,Y:n,Z:r}=e;if(n===0n)return{X:Xr,Y:Zr,Z:Xr};let i=R(n,n),a=R(4n,R(t,i)),o=R(3n,R(t,t)),s=ii(R(o,o),R(Qr,a)),c=ii(R(o,ii(a,s)),R(8n,R(i,i))),l=R(Qr,R(n,r));return{X:s,Y:c,Z:l}},gi=(e,t)=>{if(e.Z===0n)return t;if(t.Z===0n)return e;let n=R(e.Z,e.Z),r=R(t.Z,t.Z),i=R(e.X,r),a=R(t.X,n),o=R(e.Y,R(r,t.Z)),s=R(t.Y,R(n,e.Z)),c=ii(a,i),l=ii(s,o);if(c===0n)return l===0n?hi(e):{X:Xr,Y:Zr,Z:Xr};let u=R(c,c),d=R(c,u),f=R(i,u),p=ii(ii(R(l,l),d),R(Qr,f)),m=ii(R(l,ii(f,p)),R(o,d)),h=R(c,R(e.Z,t.Z));return{X:p,Y:m,Z:h}},_i=e=>e.Z===0n?e:{X:e.X,Y:$r-e.Y,Z:e.Z},vi=(e,t,n=5)=>{let r=`${n}:${t.x.toString(16)}:${t.y.toString(16)}`,i=mi.get(r),a;if(i===void 0){let e=1<<n-1;i=Array(e),a={X:t.x,Y:t.y,Z:Zr},i[0]=a;let o=hi(a);for(let t=1;t<e;t++)i[t]=gi(i[t-1],o);mi.set(r,i)}else a=i[0];let o=[],s=1n<<BigInt(n),c=s>>1n,l=e;for(;l>0n;)if((l&1n)==0n)o.push(0),l>>=Zr;else{let e=l&s-1n;e>c&&(e-=s),o.push(Number(e)),l-=e,l>>=Zr}let u={X:Xr,Y:Zr,Z:Xr};for(let e=o.length-1;e>=0;e--){u=hi(u);let t=o[e];if(t!==0){let e=Math.abs(t)>>1,n=t>0?i[e]:_i(i[e]);u=gi(u,n)}}return u},yi=e=>{let t=e%ei;return t<0n&&(t+=ei),t},bi=(e,t)=>yi(e*t),xi=e=>{let t=1n,n=0n,r=yi(e),i=ei;for(;r>1n;){let e=i/r;[t,n]=[n-t*e,t],[r,i]=[i-r*e,r]}return yi(t)};var Si=class e extends Vt{x;y;inf;static fromDER(t){if((t[0]===4||t[0]===6||t[0]===7)&&t.length-1==64){if(t[0]===6){if(t[t.length-1]%2!=0)throw Error(`Point string value is wrong length`)}else if(t[0]===7&&t[t.length-1]%2!=1)throw Error(`Point string value is wrong length`);return new e(t.slice(1,33),t.slice(33,65))}else if((t[0]===2||t[0]===3)&&t.length-1==32)return e.fromX(t.slice(1,33),t[0]===3);throw Error(`Unknown point format`)}static fromString(t){let n=F(t,`hex`);return e.fromDER(n)}static fromX(t,n){let r=di(t);r=ri(r);let i=ai(R(si(r),r),7n),a=ui(i);if(a===null)throw Error(`Invalid point`);let o=a;(o&1n)!=(n?1n:0n)&&(o=ii($r,o));let s=new N(r.toString(16),16),c=new N(o.toString(16),16);return new e(s,c)}static fromJSON(t,n){typeof t==`string`&&(t=JSON.parse(t));let r=new e(t[0],t[1],n);if(typeof t[2]!=`object`)return r;let i=t=>new e(t[0],t[1],n),a=t[2];return r.precomputed={beta:null,doubles:typeof a.doubles==`object`&&a.doubles!==null?{step:a.doubles.step,points:[r].concat(a.doubles.points.map(i))}:void 0,naf:typeof a.naf==`object`&&a.naf!==null?{wnd:a.naf.wnd,points:[r].concat(a.naf.points.map(i))}:void 0},r}constructor(e,t,n=!0){super(`affine`),this.precomputed=null,e===null&&t===null?(this.x=null,this.y=null,this.inf=!0):(N.isBN(e)||(e=new N(e,16)),this.x=e,N.isBN(t)||(t=new N(t,16)),this.y=t,n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red===null&&(this.x=this.x.toRed(this.curve.red)),this.y.red===null&&(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}validate(){return this.curve.validate(this)}encode(e=!0,t){let n=this.curve.p.byteLength(),r=this.getX().toArray(`be`,n),i;return i=e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray(`be`,n)),t===`hex`?P(i):i}toString(){return this.encode(!0,`hex`)}toJSON(){return this.precomputed==null?[this.x,this.y]:[this.x,this.y,typeof this.precomputed==`object`&&this.precomputed!==null?{doubles:this.precomputed.doubles==null?void 0:{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf==null?void 0:{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}:void 0]}inspect(){return this.isInfinity()?`<EC Point Infinity>`:`<EC Point x: `+(this.x?.fromRed()?.toString(16,2)??`undefined`)+` y: `+(this.y?.fromRed()?.toString(16,2)??`undefined`)+`>`}isInfinity(){return this.inf}add(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t)||this.x?.cmp(t.x??new N(0))===0)return new e(null,null);let n={X:BigInt(`0x`+this.x.fromRed().toString(16)),Y:BigInt(`0x`+this.y.fromRed().toString(16)),Z:Zr},r={X:BigInt(`0x`+t.x.fromRed().toString(16)),Y:BigInt(`0x`+t.y.fromRed().toString(16)),Z:Zr},i=gi(n,r);if(i.Z===0n)return new e(null,null);let a=oi(i.Z),o=R(a,a),s=R(i.X,o),c=R(i.Y,R(o,a));return new e(s.toString(16),c.toString(16))}dbl(){if(this.inf)return this;if(this.x===null||this.y===null)throw Error(`Point coordinates cannot be null`);let t=BigInt(`0x`+this.x.fromRed().toString(16)),n=BigInt(`0x`+this.y.fromRed().toString(16));if(n===0n)return new e(null,null);let r=hi({X:t,Y:n,Z:Zr}),i=oi(r.Z),a=R(i,i),o=R(r.X,a),s=R(r.Y,R(a,i));return new e(o.toString(16),s.toString(16))}getX(){return(this.x??new N(0)).fromRed()}getY(){return(this.y??new N(0)).fromRed()}mul(t){if(N.isBN(t)||(t=new N(t,16)),t=t,this.inf)return this;let n=BigInt(`0x`+t.toString(16)),r=n<Xr;if(r&&(n=-n),n=ri(n),n===0n)return new e(null,null);if(this.x===null||this.y===null)throw Error(`Point coordinates cannot be null`);let i,a;this===this.curve.g?(i=fi,a=pi):(i=BigInt(`0x`+this.x.fromRed().toString(16)),a=BigInt(`0x`+this.y.fromRed().toString(16)));let o=vi(n,{x:i,y:a});if(o.Z===0n)return new e(null,null);let s=oi(o.Z),c=R(s,s),l=R(o.X,c),u=R(o.Y,R(c,s)),d=new N(l.toString(16),16),f=new N(u.toString(16),16),p=new e(d,f);return r?p.neg():p}mulAdd(e,t,n){let r=[this,t],i=[e,n];return this._endoWnafMulAdd(r,i)}jmulAdd(e,t,n){let r=[this,t],i=[e,n];return this._endoWnafMulAdd(r,i,!0)}eq(e){return this===e||this.inf===e.inf&&(this.inf||(this.x??new N(0)).cmp(e.x??new N(0))===0&&(this.y??new N(0)).cmp(e.y??new N(0))===0)}neg(t){if(this.inf)return this;let n=new e(this.x,(this.y??new N(0)).redNeg());if(t===!0&&this.precomputed!=null){let e=this.precomputed;n.precomputed={naf:e.naf==null?void 0:{wnd:e.naf.wnd,points:e.naf.points.map(e=>e.neg())},doubles:e.doubles==null?void 0:{step:e.doubles.step,points:e.doubles.points.map(e=>e.neg())},beta:void 0}}return n}dblp(e){let t=this;for(let n=0;n<e;n++)t=t.dbl();return t}toJ(){return this.inf?new Ht(null,null,null):new Ht(this.x,this.y,this.curve.one)}_getBeta(){if(typeof this.curve.endo!=`object`)return;let t=this.precomputed;if(typeof t==`object`&&t&&typeof t.beta==`object`&&t.beta!==null)return t.beta;let n=new e((this.x??new N(0)).redMul(this.curve.endo.beta),this.y);if(t!=null){let r=this.curve,i=t=>{if(t.x===null)throw Error(`p.x is null`);if(r.endo===void 0||r.endo===null)throw Error(`curve.endo is undefined`);return new e(t.x.redMul(r.endo.beta),t.y)};t.beta=n,n.precomputed={beta:null,naf:t.naf==null?void 0:{wnd:t.naf.wnd,points:t.naf.points.map(i)},doubles:t.doubles==null?void 0:{step:t.doubles.step,points:t.doubles.points.map(i)}}}return n}_fixedNafMul(e){if(typeof this.precomputed!=`object`||this.precomputed===null)throw Error(`_fixedNafMul requires precomputed values for the point`);let t=this._getDoubles(),n=this.curve.getNAF(e,1,this.curve._bitLength),r=(1<<t.step+1)-(t.step%2==0?2:1);r/=3;let i=[];for(let e=0;e<n.length;e+=t.step){let r=0;for(let i=e+t.step-1;i>=e;i--)r=(r<<1)+n[i];i.push(r)}let a=new Ht(null,null,null),o=new Ht(null,null,null);for(let e=r;e>0;e--){for(let n=0;n<i.length;n++){let r=i[n];r===e?o=o.mixedAdd(t.points[n]):r===-e&&(o=o.mixedAdd(t.points[n].neg()))}a=a.add(o)}return a.toP()}_wnafMulAdd(e,t,n,r,i){let a=this.curve._wnafT1.map(e=>e.toNumber()),o=this.curve._wnafT2.map(()=>[]),s=this.curve._wnafT3.map(()=>[]),c=0;for(let n=0;n<r;n++){let r=t[n]._getNAFPoints(e);a[n]=r.wnd,o[n]=r.points}for(let e=r-1;e>=1;e-=2){let r=e-1,i=e;if(a[r]!==1||a[i]!==1){s[r]=this.curve.getNAF(n[r],a[r],this.curve._bitLength),s[i]=this.curve.getNAF(n[i],a[i],this.curve._bitLength),c=Math.max(s[r].length,c),c=Math.max(s[i].length,c);continue}let l=[t[r],null,null,t[i]];(t[r].y??new N(0)).cmp(t[i].y??new N(0))===0?(l[1]=t[r].add(t[i]),l[2]=t[r].toJ().mixedAdd(t[i].neg())):(t[r].y??new N(0)).cmp((t[i].y??new N(0)).redNeg())===0?(l[1]=t[r].toJ().mixedAdd(t[i]),l[2]=t[r].add(t[i].neg())):(l[1]=t[r].toJ().mixedAdd(t[i]),l[2]=t[r].toJ().mixedAdd(t[i].neg()));let u=[-3,-1,-5,-7,0,7,5,1,3],d=this.curve.getJSF(n[r],n[i]);c=Math.max(d[0].length,c),s[r]=Array(c),s[i]=Array(c);for(let e=0;e<c;e++){let t=d[0][e]|0,n=d[1][e]|0;s[r][e]=u[(t+1)*3+(n+1)],s[i][e]=0,o[r]=l}}let l=new Ht(null,null,null),u=this.curve._wnafT4;for(let e=c;e>=0;e--){let t=0;for(;e>=0;){let n=!0;for(let t=0;t<r;t++)u[t]=new N(typeof s[t][e]==`number`?s[t][e]:0),u[t].isZero()||(n=!1);if(!n)break;t++,e--}if(e>=0&&t++,l=l.dblp(t),e<0)break;let n=new N(1),i=new N(2);for(let e=0;e<r;e++){let t=u[e],r;t.cmpn(0)!==0&&(r=t.isNeg()?o[e][t.neg().sub(n).div(i).toNumber()].neg():o[e][t.sub(n).div(i).toNumber()],l=r.type===`affine`?l.mixedAdd(r):l.add(r))}}for(let e=0;e<r;e++)o[e]=[];return i===!0?l:l.toP()}_endoWnafMulAdd(t,n,r){let i=Array(t.length*2),a=Array(t.length*2),o;for(o=0;o<t.length;o++){let r=this.curve._endoSplit(n[o]),s=t[o],c=s._getBeta()??new e(null,null);r.k1.negative!==0&&(r.k1.ineg(),s=s.neg(!0)),r.k2.negative!==0&&(r.k2.ineg(),c=c.neg(!0)),i[o*2]=s,i[o*2+1]=c,a[o*2]=r.k1,a[o*2+1]=r.k2}let s=this._wnafMulAdd(1,i,a,o*2,r);for(let e=0;e<o*2;e++)i[e]=null,a[e]=null;return s}_hasDoubles(e){if(this.precomputed==null)return!1;let t=this.precomputed.doubles;return typeof t==`object`?t.points.length>=Math.ceil((e.bitLength()+1)/t.step):!1}_getDoubles(e,t){if(typeof this.precomputed==`object`&&this.precomputed!==null&&typeof this.precomputed.doubles==`object`&&this.precomputed.doubles!==null)return this.precomputed.doubles;let n=[this],r=this;for(let i=0;i<(t??0);i+=e??1){for(let t=0;t<(e??1);t++)r=r.dbl();n.push(r)}return{step:e??1,points:n}}_getNAFPoints(e){if(typeof this.precomputed==`object`&&this.precomputed!==null&&typeof this.precomputed.naf==`object`&&this.precomputed.naf!==null)return this.precomputed.naf;let t=[this],n=(1<<e)-1,r=n===1?null:this.dbl();for(let e=1;e<n;e++)r!==null&&(t[e]=t[e-1].add(r));return{wnd:e,points:t}}},Ci,wi=class e{p;red;redN;zero;one;two;g;n;a;b;tinv;zeroA;threeA;endo;_endoWnafT1;_endoWnafT2;_wnafT1;_wnafT2;_wnafT3;_wnafT4;_bitLength;static assert(e,t=`Elliptic curve assertion failed`){if(!e)throw Error(t)}getNAF(e,t,n){let r=Array(Math.max(e.bitLength(),n)+1);r.fill(0);let i=1<<t+1,a=e.clone();for(let e=0;e<r.length;e++){let t,n=a.andln(i-1);a.isOdd()?(t=n>(i>>1)-1?(i>>1)-n:n,a.isubn(t)):t=0,r[e]=t,a.iushrn(1)}return r}getJSF(e,t){let n=[[],[]];e=e.clone(),t=t.clone();let r=0,i=0;for(;e.cmpn(-r)>0||t.cmpn(-i)>0;){let a=e.andln(3)+r&3,o=t.andln(3)+i&3;a===3&&(a=-1),o===3&&(o=-1);let s;if(!(a&1))s=0;else{let t=e.andln(7)+r&7;s=(t===3||t===5)&&o===2?-a:a}n[0].push(s);let c;if(!(o&1))c=0;else{let e=t.andln(7)+i&7;c=(e===3||e===5)&&a===2?-o:o}n[1].push(c),2*r===s+1&&(r=1-r),2*i===c+1&&(i=1-i),e.iushrn(1),t.iushrn(1)}return n}static cachedProperty(e,t,n){let r=`_`+t;e.prototype[t]=function(){return this[r]===void 0?this[r]=n.call(this):this[r]}}static parseBytes(e){return typeof e==`string`?F(e,`hex`):e}static intFromLE(e){return new N(e,`hex`,`le`)}constructor(){if(Ci!==void 0)return Ci;Ci=this;let e={prime:`k256`,p:`ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f`,a:`0`,b:`7`,n:`ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141`,h:`1`,beta:`7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee`,lambda:`5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72`,basis:[{a:`3086d221a7d46bcde86c90e49284eb15`,b:`-e4437ed6010e88286f547fa90abfe4c3`},{a:`114ca50f7a8e2f3f657c1108d9d44cfd8`,b:`3086d221a7d46bcde86c90e49284eb15`}],gRed:!1,g:[`79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798`,`483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8`,{doubles:{step:4,points:[[`e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a`,`f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821`],[`8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508`,`11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf`],[`175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739`,`d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695`],[`363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640`,`4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9`],[`8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c`,`4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36`],[`723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda`,`96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f`],[`eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa`,`5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999`],[`100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0`,`cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09`],[`e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d`,`9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d`],[`feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d`,`e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088`],[`da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1`,`9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d`],[`53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0`,`5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8`],[`8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047`,`10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a`],[`385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862`,`283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453`],[`6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7`,`7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160`],[`3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd`,`56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0`],[`85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83`,`7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6`],[`948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a`,`53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589`],[`6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8`,`bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17`],[`e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d`,`4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda`],[`e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725`,`7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd`],[`213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754`,`4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2`],[`4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c`,`17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6`],[`fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6`,`6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f`],[`76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39`,`c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01`],[`c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891`,`893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3`],[`d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b`,`febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f`],[`b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03`,`2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7`],[`e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d`,`eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78`],[`a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070`,`7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1`],[`90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4`,`e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150`],[`8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da`,`662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82`],[`e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11`,`1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc`],[`8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e`,`efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b`],[`e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41`,`2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51`],[`b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef`,`67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45`],[`d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8`,`db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120`],[`324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d`,`648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84`],[`4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96`,`35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d`],[`9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd`,`ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d`],[`6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5`,`9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8`],[`a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266`,`40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8`],[`7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71`,`34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac`],[`928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac`,`c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f`],[`85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751`,`1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962`],[`ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e`,`493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907`],[`827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241`,`c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec`],[`eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3`,`be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d`],[`e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f`,`4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414`],[`1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19`,`aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd`],[`146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be`,`b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0`],[`fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9`,`6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811`],[`da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2`,`8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1`],[`a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13`,`7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c`],[`174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c`,`ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73`],[`959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba`,`2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd`],[`d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151`,`e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405`],[`64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073`,`d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589`],[`8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458`,`38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e`],[`13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b`,`69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27`],[`bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366`,`d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1`],[`8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa`,`40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482`],[`8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0`,`620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945`],[`dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787`,`7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573`],[`f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e`,`ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82`]]},naf:{wnd:7,points:[[`f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9`,`388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672`],[`2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4`,`d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6`],[`5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc`,`6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da`],[`acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe`,`cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37`],[`774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb`,`d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b`],[`f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8`,`ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81`],[`d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e`,`581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58`],[`defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34`,`4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77`],[`2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c`,`85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a`],[`352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5`,`321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c`],[`2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f`,`2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67`],[`9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714`,`73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402`],[`daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729`,`a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55`],[`c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db`,`2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482`],[`6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4`,`e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82`],[`1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5`,`b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396`],[`605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479`,`2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49`],[`62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d`,`80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf`],[`80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f`,`1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a`],[`7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb`,`d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7`],[`d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9`,`eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933`],[`49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963`,`758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a`],[`77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74`,`958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6`],[`f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530`,`e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37`],[`463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b`,`5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e`],[`f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247`,`cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6`],[`caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1`,`cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476`],[`2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120`,`4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40`],[`7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435`,`91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61`],[`754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18`,`673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683`],[`e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8`,`59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5`],[`186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb`,`3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b`],[`df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f`,`55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417`],[`5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143`,`efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868`],[`290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba`,`e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a`],[`af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45`,`f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6`],[`766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a`,`744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996`],[`59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e`,`c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e`],[`f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8`,`e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d`],[`7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c`,`30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2`],[`948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519`,`e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e`],[`7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab`,`100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437`],[`3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca`,`ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311`],[`d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf`,`8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4`],[`1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610`,`68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575`],[`733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4`,`f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d`],[`15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c`,`d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d`],[`a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940`,`edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629`],[`e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980`,`a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06`],[`311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3`,`66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374`],[`34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf`,`9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee`],[`f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63`,`4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1`],[`d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448`,`fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b`],[`32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf`,`5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661`],[`7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5`,`8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6`],[`ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6`,`8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e`],[`16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5`,`5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d`],[`eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99`,`f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc`],[`78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51`,`f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4`],[`494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5`,`42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c`],[`a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5`,`204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b`],[`c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997`,`4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913`],[`841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881`,`73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154`],[`5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5`,`39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865`],[`36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66`,`d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc`],[`336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726`,`ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224`],[`8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede`,`6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e`],[`1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94`,`60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6`],[`85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31`,`3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511`],[`29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51`,`b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b`],[`a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252`,`ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2`],[`4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5`,`cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c`],[`d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b`,`6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3`],[`ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4`,`322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d`],[`af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f`,`6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700`],[`e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889`,`2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4`],[`591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246`,`b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196`],[`11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984`,`998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4`],[`3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a`,`b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257`],[`cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030`,`bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13`],[`c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197`,`6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096`],[`c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593`,`c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38`],[`a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef`,`21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f`],[`347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38`,`60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448`],[`da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a`,`49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a`],[`c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111`,`5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4`],[`4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502`,`7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437`],[`3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea`,`be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7`],[`cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26`,`8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d`],[`b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986`,`39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a`],[`d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e`,`62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54`],[`48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4`,`25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77`],[`dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda`,`ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517`],[`6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859`,`cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10`],[`e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f`,`f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125`],[`eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c`,`6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e`],[`13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942`,`fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1`],[`ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a`,`1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2`],[`b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80`,`5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423`],[`ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d`,`438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8`],[`8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1`,`cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758`],[`52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63`,`c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375`],[`e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352`,`6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d`],[`7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193`,`ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec`],[`5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00`,`9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0`],[`32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58`,`ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c`],[`e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7`,`d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4`],[`8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8`,`c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f`],[`4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e`,`67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649`],[`3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d`,`cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826`],[`674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b`,`299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5`],[`d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f`,`f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87`],[`30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6`,`462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b`],[`be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297`,`62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc`],[`93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a`,`7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c`],[`b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c`,`ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f`],[`d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52`,`4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a`],[`d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb`,`bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46`],[`463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065`,`bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f`],[`7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917`,`603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03`],[`74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9`,`cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08`],[`30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3`,`553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8`],[`9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57`,`712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373`],[`176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66`,`ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3`],[`75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8`,`9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8`],[`809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721`,`9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1`],[`1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180`,`4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9`]]}}]};this.p=new N(e.p,16),this.red=new zt(e.prime),this.zero=new N(0).toRed(this.red),this.one=new N(1).toRed(this.red),this.two=new N(2).toRed(this.red),this.n=new N(e.n,16),this.g=Si.fromJSON(e.g,e.gRed),this._wnafT1=[,,,,],this._wnafT2=[,,,,],this._wnafT3=[,,,,],this._wnafT4=[,,,,],this._bitLength=this.n.bitLength(),this.redN=this.n.toRed(this.red),this.a=new N(e.a,16).toRed(this.red),this.b=new N(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=[,,,,],this._endoWnafT2=[,,,,]}_getEndomorphism(t){if(!this.zeroA||this.p.modrn(3)!==1)return;let n,r;if(t.beta!==void 0)n=new N(t.beta,16).toRed(this.red);else{let e=this._getEndoRoots(this.p);if(e===null)throw Error(`Failed to get endomorphism roots for beta.`);n=e[0].cmp(e[1])<0?e[0]:e[1],n=n.toRed(this.red)}if(t.lambda!==void 0)r=new N(t.lambda,16);else{let t=this._getEndoRoots(this.n);if(t===null)throw Error(`Failed to get endomorphism roots for lambda.`);if(this.g==null)throw Error(`Curve generator point (g) is not defined.`);let i=this.g.mul(t[0])?.x,a=this.g.x==null?void 0:this.g.x.redMul(n);if(i!=null&&a!=null&&i.cmp(a)===0)r=t[0];else{if(r=t[1],this.g==null)throw Error(`Curve generator point (g) is not defined.`);let i=this.g.mul(r)?.x,a=this.g.x==null?void 0:this.g.x.redMul(n);if(i==null||a==null)throw Error(`Lambda computation failed: g.mul(lambda).x or g.x.redMul(beta) is undefined.`);e.assert(i.cmp(a)===0,`Lambda selection does not match computed beta.`)}}let i;return i=typeof t.basis==`object`&&t.basis!==null?t.basis.map(function(e){return{a:new N(e.a,16),b:new N(e.b,16)}}):this._getEndoBasis(r),{beta:n,lambda:r,basis:i}}_getEndoRoots(e){let t=e===this.p?this.red:new Bt(e),n=new N(2).toRed(t).redInvm(),r=n.redNeg(),i=new N(3).toRed(t).redNeg().redSqrt().redMul(n),a=r.redAdd(i).fromRed(),o=r.redSub(i).fromRed();return[a,o]}_getEndoBasis(e){let t=this.n.ushrn(Math.floor(this.n.bitLength()/2)),n=e,r=this.n.clone(),i=new N(1),a=new N(0),o=new N(0),s=new N(1),c,l,u,d,f,p,m=new N(0),h=0,g=new N(0),_=new N(0);for(;n.cmpn(0)!==0;){let e=r.div(n);g=r.sub(e.mul(n)),_=o.sub(e.mul(i));let f=s.sub(e.mul(a));if(u===void 0&&g.cmp(t)<0)c=m.neg(),l=i,u=g.neg(),d=_;else if(u!==void 0&&++h===2)break;m=g,r=n,n=g,o=i,i=_,s=a,a=f}if(c===void 0||l===void 0||u===void 0||d===void 0)throw Error(`Failed to compute Endo Basis values`);f=g.neg(),p=_;let v=u.sqr().add(d.sqr());return f.sqr().add(p.sqr()).cmp(v)>=0&&(f=c,p=l),u.negative!==0&&(u=u.neg(),d=d.neg()),f.negative!==0&&(f=f.neg(),p=p.neg()),[{a:u,b:d},{a:f,b:p}]}_endoSplit(e){if(this.endo==null)throw Error(`Endomorphism is not defined.`);let t=this.endo.basis,n=t[0],r=t[1],i=r.b.mul(e).divRound(this.n),a=n.b.neg().mul(e).divRound(this.n),o=i.mul(n.a),s=a.mul(r.a),c=i.mul(n.b),l=a.mul(r.b),u=e.sub(o).sub(s),d=c.add(l).neg();return{k1:u,k2:d}}validate(e){if(e.inf)return!0;let t=e.x,n=e.y;if(t===null||n===null)throw Error(`Point coordinates cannot be null`);let r=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(r).redIAdd(this.b);return n.redSqr().redISub(i).cmpn(0)===0}},Ti=class e{r;s;static fromDER(t,n){let r=(e,t)=>{let n=e[t.place++];if(n&128)throw Error(`Invalid DER entity length`);return n};class i{place;constructor(){this.place=0}}t=F(t,n);let a=new i;if(t[a.place++]!==48)throw Error(`Signature DER must start with 0x30`);if(r(t,a)+a.place!==t.length||t[a.place++]!==2)throw Error(`Signature DER invalid`);let o=r(t,a),s=t.slice(a.place,o+a.place);if(a.place+=o,t[a.place++]!==2)throw Error(`Signature DER invalid`);let c=r(t,a);if(t.length!==c+a.place)throw Error(`Invalid R-length in signature DER`);let l=t.slice(a.place,c+a.place);if(s[0]===0)if(s[1]&128)s=s.slice(1);else throw Error(`Invalid R-value in signature DER`);if(l[0]===0)if(l[1]&128)l=l.slice(1);else throw Error(`Invalid S-value in signature DER`);return new e(new N(s),new N(l))}static fromCompact(t,n){if(t=F(t,n),t.length!==65)throw Error(`Invalid Compact Signature`);let r=t[0];if(r<27||r>=35)throw Error(`Invalid Compact Byte`);return new e(new N(t.slice(1,33)),new N(t.slice(33,65)))}constructor(e,t){this.r=e,this.s=t}verify(e,t,n){let r=new N(Mn(e,n),16);return Pi(r,this,t)}toString(e){return this.toDER(e)}toDER(e){let t=(e,t)=>{if(t<128)e.push(t);else throw Error(`len must be < 0x80`)},n=e=>{let t=0,n=e.length-1;for(;e[t]===0&&!(e[t+1]&128)&&t<n;)t++;return t===0?e:e.slice(t)},r=this.r.toArray(),i=this.s.toArray();for(r[0]&128&&(r=[0].concat(r)),i[0]&128&&(i=[0].concat(i)),r=n(r),i=n(i);i[0]===0&&!(i[1]&128);)i=i.slice(1);let a=[2];t(a,r.length),a=a.concat(r),a.push(2),t(a,i.length);let o=a.concat(i),s=[48];return t(s,o.length),s=s.concat(o),e===`hex`?P(s):e===`base64`?Br(s):s}toCompact(e,t,n){if(e<0||e>3)throw Error(`Invalid recovery param`);if(typeof t!=`boolean`)throw Error(`Invalid compressed param`);let r=27+e;t&&(r+=4);let i=[r];return i=i.concat(this.r.toArray(`be`,32)),i=i.concat(this.s.toArray(`be`,32)),n===`hex`?P(i):n===`base64`?Br(i):i}RecoverPublicKey(e,t){let n=this.r,r=this.s,i=(e&1)!=0,a=e>>1,o=new wi,s=o.n,c=o.g,l=a===0?n:n.add(s),u=Si.fromX(l,i);if(!u.mul(s).isInfinity())throw Error(`nR is not at infinity`);let d=t.neg().umod(s),f=n.invm(s),p=f.mul(r).umod(s),m=f.mul(d).umod(s),h=c.mul(m).add(u.mul(p)),g=new Fi(h);return g.validate(),g}CalculateRecoveryFactor(e,t){for(let n=0;n<4;n++){let r;try{r=this.RecoverPublicKey(n,t)}catch{continue}if(e.eq(r))return n}throw Error(`Unable to find valid recovery factor`)}},Ei=class{K;V;constructor(e,t){if(e=F(e,`hex`),t=F(t,`hex`),e.length<32)throw Error(`Not enough entropy. Minimum is 256 bits`);let n=e.concat(t);this.K=Array(32),this.V=Array(32);for(let e=0;e<32;e++)this.K[e]=0,this.V[e]=1;this.update(n)}hmac(){return new Dn(this.K)}update(e){let t=this.hmac().update(this.V).update([0]);e!==void 0&&(t=t.update(e)),this.K=t.digest(),this.V=this.hmac().update(this.V).digest(),e!==void 0&&(this.K=this.hmac().update(this.V).update([1]).update(e).digest(),this.V=this.hmac().update(this.V).digest())}generate(e){let t=[];for(;t.length<e;)this.V=this.hmac().update(this.V).digest(),t=t.concat(this.V);let n=t.slice(0,e);return this.update(),P(n)}},Di=s({sign:()=>Ni,verify:()=>Pi});function Oi(e,t,n=new wi){let r=e.byteLength()*8-n.n.bitLength();return r>0&&e.iushrn(r),t===null&&e.cmp(n.n)>=0?e.sub(n.n):e}var ki=new wi,Ai=ki.n.byteLength(),ji=ki.n.subn(1),Mi=ei>>1n;const Ni=(e,t,n=!1,r)=>{e=Oi(e);let i=BigInt(`0x`+e.toString(16)),a=BigInt(`0x`+t.toString(16)),o=t.toArray(`be`,Ai),s=e.toArray(`be`,Ai),c=new Ei(o,s);for(let e=0;;e++){let t=typeof r==`function`?r(e):N.isBN(r)?r:new N(c.generate(Ai),16);if(t==null)throw Error(`k is undefined`);if(t=Oi(t,!0),t.cmpn(1)<=0||t.cmp(ji)>=0){if(N.isBN(r))throw Error(`Invalid fixed custom K value (must be >1 and <N1)`);continue}let o=BigInt(`0x`+t.toString(16)),s=vi(o,{x:fi,y:pi});if(s.Z===0n){if(N.isBN(r))throw Error(`Invalid fixed custom K value (kG at infinity)`);continue}let l=oi(s.Z),u=R(l,l),d=R(s.X,u),f=yi(d);if(f===0n){if(N.isBN(r))throw Error(`Invalid fixed custom K value (r == 0)`);continue}let p=xi(o),m=bi(f,a),h=yi(i+m),g=bi(p,h);if(g===0n){if(N.isBN(r))throw Error(`Invalid fixed custom K value (s == 0)`);continue}n&&g>Mi&&(g=ei-g);let _=new N(f.toString(16),16),v=new N(g.toString(16),16);return new Ti(_,v)}},Pi=(e,t,n)=>{let r=BigInt(`0x`+e.toString(16));if(n.x==null||n.y==null)throw Error(`Invalid public key: missing coordinates.`);let i={x:BigInt(`0x`+n.x.toString(16)),y:BigInt(`0x`+n.y.toString(16))},{r:a,s:o}={r:BigInt(`0x`+t.r.toString(16)),s:BigInt(`0x`+t.s.toString(16))},s=r;if(a<=0n||a>=115792089237316195423570985008687907852837564279074904382605163141518161494337n||o<=0n||o>=115792089237316195423570985008687907852837564279074904382605163141518161494337n)return!1;let c=xi(o);if(c===0n)return!1;let l=bi(s,c),u=bi(a,c),d=vi(l,{x:fi,y:pi}),f=vi(u,i),p=gi(d,f);if(p.Z===0n)return!1;let m=oi(p.Z),h=R(m,m),g=R(p.X,h);return yi(g)===a};var Fi=class e extends Si{static fromPrivateKey(t){let n=new wi().g.mul(t);return new e(n.x,n.y)}static fromString(t){let n=Si.fromString(t);return new e(n.x,n.y)}static fromDER(t){let n=Si.fromDER(t);return new e(n.x,n.y)}constructor(e,t=null,n=!0){if(e instanceof Si)super(e.getX(),e.getY());else{if(t===null&&n&&typeof e==`string`&&(e.length===66||e.length===130))throw Error(`You are using the "new PublicKey()" constructor with a DER hex string. You need to use "PublicKey.fromString()" instead.`);super(e,t,n)}}deriveSharedSecret(e){if(!this.validate())throw Error(`Public key not valid for ECDH secret derivation`);return this.mul(e)}verify(e,t,n){let r=new N(Mn(e,n),16);return Pi(r,t,this)}toDER(e){return e===`hex`?this.encode(!0,e):this.encode(!0)}toHash(e){let t=Fn(this.encode(!0));return e===`hex`?P(t):t}toAddress(e=[0]){if(typeof e==`string`)if(e===`testnet`||e===`test`)e=[111];else if(e===`mainnet`||e===`main`)e=[0];else throw Error(`Invalid prefix ${e}`);return Wr(this.toHash(),e)}deriveChild(t,n,r,i){let a;if(typeof i==`function`){let e=i(t,this);e===void 0?(a=this.deriveSharedSecret(t),typeof r==`function`&&r(t,this,a)):a=e}else a=this.deriveSharedSecret(t);let o=F(n,`utf8`),s=In(a.encode(!0),o),c=new wi().g.mul(new N(s)),l=this.add(c);return new e(l.x,l.y)}static fromMsgHashAndCompactSignature(e,t,n){let r=F(t,n);if(r.length!==65)throw Error(`Invalid Compact Signature`);let i=r[0];if(i<27||i>=35)throw Error(`Invalid Compact Byte`);let a=r[0]-27;return a>3&&(a-=4),new Ti(new N(r.slice(1,33)),new N(r.slice(33,65))).RecoverPublicKey(a,e)}},Ii=class{_rand;constructor(){let e=()=>{throw Error(`No secure random number generator is available in this environment.`)};if(this._rand=e,typeof self==`object`)self.crypto?.getRandomValues?this._rand=e=>{let t=new Uint8Array(e);return self.crypto.getRandomValues(t),[...t]}:this._rand=e;else try{let e=Ut();typeof e.randomBytes==`function`&&(this._rand=t=>[...e.randomBytes(t)])}catch{this._rand=e}}generate(e){return this._rand(e)}},Li=null,Ri=e=>(Li??=new Ii,Li.generate(e)),zi=class e{x;y;constructor(e,t){let n=new wi().p;this.x=e.umod(n),this.y=t.umod(n)}toString(){return Ur(this.x.toArray())+`.`+Ur(this.y.toArray())}static fromString(t){let[n,r]=t.split(`.`);return new e(new N(Hr(n)),new N(Hr(r)))}},Bi=class e{points;threshold;constructor(e,t){this.points=e,this.threshold=t??e.length}static fromPrivateKey(t,n){let r=new wi().p,i=[new zi(new N(0),new N(t.toArray()))];for(let e=1;e<n;e++){let e=new N(Ri(32)).umod(r),t=new N(Ri(32)).umod(r);i.push(new zi(e,t))}return new e(i)}valueAt(e){let t=new wi().p,n=new N(0);for(let r=0;r<this.threshold;r++){let i=this.points[r].y;for(let n=0;n<this.threshold;n++)if(r!==n){let a=this.points[n].x,o=this.points[r].x,s=e.sub(a).umod(t),c=o.sub(a).umod(t).invm(t),l=s.mul(c).umod(t);i=i.mul(l).umod(t)}n=n.add(i).umod(t)}return n}},Vi=class e{points;threshold;integrity;constructor(e,t,n){this.points=e,this.threshold=t,this.integrity=n}static fromBackupFormat(t){let n=0,r=``,i=t.map((e,t)=>{let i=e.split(`.`);if(i.length!==4)throw Error(`Invalid share format in share `+t.toString()+`. Expected format: "x.y.t.i" - received `+e);let[a,o,s,c]=i;if(s===void 0)throw Error(`Threshold not found in share `+t.toString());if(c===void 0)throw Error(`Integrity not found in share `+t.toString());let l=parseInt(s);if(t!==0&&n!==l)throw Error(`Threshold mismatch in share `+t.toString());if(t!==0&&r!==c)throw Error(`Integrity mismatch in share `+t.toString());return n=l,r=c,zi.fromString([a,o].join(`.`))});return new e(i,n,r)}toBackupFormat(){return this.points.map(e=>e.toString()+`.`+this.threshold.toString()+`.`+this.integrity)}},Hi=class e extends N{static fromRandom(){return new e(Ri(32))}static fromString(t,n=`hex`){return new e(super.fromString(t,n).toArray())}static fromHex(t){return new e(super.fromHex(t,`big`))}static fromWif(t,n=1){let r=Gr(t,void 0,n);if(r.data.length!==33)throw Error(`Invalid WIF length`);if(r.data[32]!==1)throw Error(`Invalid WIF padding`);return new e(r.data.slice(0,32))}constructor(e=0,t=10,n=`be`,r=`apply`){if(e instanceof N?(super(),e.copy(this)):super(e,t,n),r!==`nocheck`){let e=this.checkInField();if(!e.inField){if(r===`error`)throw Error(`Input is out of field`);N.move(this,e.modN)}}}checkInField(){let e=new wi,t=this.mod(e.n);return{inField:this.cmp(t)===0,modN:t}}isValid(){return this.checkInField().inField}sign(e,t,n=!0,r){let i=new N(Mn(e,t),16);return Ni(i,this,n,r)}verify(e,t,n){let r=new N(Mn(e,n),16);return Pi(r,t,this.toPublicKey())}toPublicKey(){let e=new wi().g.mul(this);return new Fi(e.x,e.y)}toWif(e=[128]){if(!this.isValid())throw Error(`Value is out of field`);return Wr([...this.toArray(`be`,32),1],e)}toAddress(e=[0]){return this.toPublicKey().toAddress(e)}toHex(){return super.toHex(32)}toString(e=`hex`,t=64){return super.toString(e,t)}deriveSharedSecret(e){if(!e.validate())throw Error(`Public key not valid for ECDH secret derivation`);return e.mul(this)}deriveChild(t,n,r,i){let a;if(typeof i==`function`){let e=i(this,t);e===void 0?(a=this.deriveSharedSecret(t),typeof r==`function`&&r(this,t,a)):a=e}else a=this.deriveSharedSecret(t);let o=F(n,`utf8`),s=In(a.encode(!0),o),c=new wi;return new e(this.add(new N(s)).mod(c.n).toArray())}toKeyShares(e,t){if(typeof e!=`number`||typeof t!=`number`)throw Error(`threshold and totalShares must be numbers`);if(e<2)throw Error(`threshold must be at least 2`);if(t<2)throw Error(`totalShares must be at least 2`);if(e>t)throw Error(`threshold should be less than or equal to totalShares`);let n=Bi.fromPrivateKey(this,e),r=[],i=new Set,a=new wi,o=Ri(64);for(let e=0;e<t;e++){let t,s=0;do{let n=[e,s,...Ri(32)],r=Ln(o,n);if(t=new N(r).umod(a.p),s++,s>5)throw Error(`Failed to generate unique x coordinate after 5 attempts`)}while(t.isZero()||i.has(t.toString()));i.add(t.toString());let c=n.valueAt(t);r.push(new zi(t,c))}let s=this.toPublicKey().toHash(`hex`).slice(0,8);return new Vi(r,e,s)}toBackupShares(e,t){return this.toKeyShares(e,t).toBackupFormat()}static fromBackupShares(t){return e.fromKeyShares(Vi.fromBackupFormat(t))}static fromKeyShares(t){let{points:n,threshold:r,integrity:i}=t;if(r<2)throw Error(`threshold must be at least 2`);if(n.length<r)throw Error(`At least ${r} shares are required to reconstruct the private key`);for(let e=0;e<r;e++)for(let t=e+1;t<r;t++)if(n[e].x.eq(n[t].x))throw Error(`Duplicate share detected, each must be unique.`);let a=new Bi(n,r),o=new e(a.valueAt(new N(0)).toArray());if(o.toPublicKey().toHash(`hex`).slice(0,8)!==i)throw Error(`Integrity hash mismatch`);return o}},Ui=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),Wi=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]].map(e=>new Uint8Array(e)),Gi=new Uint8Array(256),Ki=new Uint8Array(256);for(let e=0;e<256;e++){let t=(e<<1^(e&128?27:0))&255;Gi[e]=t,Ki[e]=t^e}function qi(e,t,n){for(let r=0;r<4;r++){let i=t[n+r];for(let t=0;t<4;t++)e[t][r]^=i[t]}}function Ji(e){for(let t=0;t<4;t++)for(let n=0;n<4;n++)e[t][n]=Ui[e[t][n]]}function Yi(e){for(let t=0;t<4;t++)e[t]=Ui[e[t]]}function Xi(e){let t=e[0];e[0]=e[1],e[1]=e[2],e[2]=e[3],e[3]=t}function Zi(e){let t=e[1][0];e[1][0]=e[1][1],e[1][1]=e[1][2],e[1][2]=e[1][3],e[1][3]=t,t=e[2][0];let n=e[2][1];e[2][0]=e[2][2],e[2][1]=e[2][3],e[2][2]=t,e[2][3]=n,t=e[3][3],e[3][3]=e[3][2],e[3][2]=e[3][1],e[3][1]=e[3][0],e[3][0]=t}function Qi(e){for(let t=0;t<4;t++){let n=e[0][t],r=e[1][t],i=e[2][t],a=e[3][t];e[0][t]=Gi[n]^Ki[r]^i^a,e[1][t]=n^Gi[r]^Ki[i]^a,e[2][t]=n^r^Gi[i]^Ki[a],e[3][t]=Ki[n]^r^i^Gi[a]}}function $i(e,t){let n=t.length/4,r=[];for(let e=0;e<t.length;e++)e%4==0&&r.push([]),r[e>>2].push(t[e]);for(let t=n;t<4*e;t++){r[t]=[];let e=r[t-1].slice();if(t%n===0){Xi(e),Yi(e);let r=Wi[t/n];for(let t=0;t<4;t++)e[t]^=r[t]}else n>6&&t%n===4&&Yi(e);for(let i=0;i<4;i++)r[t][i]=r[t-n][i]^e[i]}return r}function ea(e,t){let n,r,i,a,o=[[],[],[],[]],s=[],c=Array.from(t);if(c.length<=16){for(;c.length<16;)c.unshift(0);a=11}else if(c.length<=24){for(;c.length<24;)c.unshift(0);a=13}else if(t.length<=32){for(;c.length<32;)c.unshift(0);a=15}else throw Error(`Illegal key length: `+String(t.length));let l=$i(a,c);for(let t=0;t<4;t++)o[0][t]=e[t*4],o[1][t]=e[t*4+1],o[2][t]=e[t*4+2],o[3][t]=e[t*4+3];for(qi(o,l,0),i=1;i<a;i++)Ji(o),Zi(o),i+1<a&&Qi(o),qi(o,l,i*4);for(n=0;n<4;n++)for(r=0;r<4;r++)s.push(o[r][n]);return s}const ta=function(e){return[(e&4278190080)>>>24,(e&16711680)>>16,(e&65280)>>8,e&255]};var na=function(e){return Array(e).fill(0)},ra=[225].concat(na(15)),ia=function(e,t){for(let n=0;n<e.length;n++)e[n]^=t[n]};const aa=function(e){let t,n=0,r=0;for(t=0;t<e.length;t++)r=n,n=e[t]&1,e[t]=e[t]>>1,r!==0&&(e[t]=e[t]|128);return e},oa=function(e,t){let n=t.slice(),r=na(16);for(let t=0;t<16;t++)for(let i=7;i>=0;i--)e[t]&1<<i&&ia(r,n),n[15]&1?(aa(n),ia(n,ra)):aa(n);return r},sa=function(e){let t,n=e.slice();for(t=15;t!==11&&(n[t]=n[t]+1,n[t]===256);t--)n[t]=0;return n};function ca(e,t){let n=na(16);for(let r=0;r<e.length;r+=16){let i=n.slice();for(let t=0;t<16;t++)i[t]^=e[r+t]??0;n=oa(i,t)}return n}function la(e,t,n){if(e.length===0)return[];let r=Array(e.length),i=t,a=0,o=Math.ceil(e.length/16);for(let t=0;t<o;t++){let s=ea(i,n),c=Math.min(16,e.length-a);for(let t=0;t<c;t++)r[a]=e[a]^s[t],a++;t+1<o&&(i=sa(i))}return r}function ua(e,t,n,r){let i,a,o=ea(na(16),r);i=[...n],n.length===12?i=i.concat(na(3)).concat([1]):(n.length%16!=0&&(i=i.concat(na(16-n.length%16))),i=i.concat(na(8)),i=ca(i.concat(na(4)).concat(ta(n.length*8)),o));let s=la(e,sa(i),r);return a=t.slice(),t.length===0?a=a.concat(na(16)):t.length%16!=0&&(a=a.concat(na(16-t.length%16))),a=a.concat(s),s.length===0?a=a.concat(na(16)):s.length%16!=0&&(a=a.concat(na(16-s.length%16))),a=a.concat(na(4)).concat(ta(t.length*8)).concat(na(4)).concat(ta(s.length*8)),{result:s,authenticationTag:la(ca(a,o),i,r)}}function da(e,t,n,r,i){let a,o,s=ea(na(16),i);a=[...n],n.length===12?a=a.concat(na(3)).concat([1]):(n.length%16!=0&&(a=a.concat(na(16-n.length%16))),a=a.concat(na(8)),a=ca(a.concat(na(4)).concat(ta(n.length*8)),s));let c=la(e,sa(a),i);return o=t.slice(),t.length===0?o=o.concat(na(16)):t.length%16!=0&&(o=o.concat(na(16-t.length%16))),o=o.concat(e),e.length===0?o=o.concat(na(16)):e.length%16!=0&&(o=o.concat(na(16-e.length%16))),o=o.concat(na(4)).concat(ta(t.length*8)).concat(na(4)).concat(ta(e.length*8)),la(ca(o,s),a,i).join()===r.join()?c:null}var fa=class e extends N{static fromRandom(){return new e(Ri(32))}encrypt(e,t){let n=Ri(32);e=F(e,t);let{result:r,authenticationTag:i}=ua(e,[],n,this.toArray(`be`,32));return zr([...n,...r,...i],t)}decrypt(e,t){e=F(e,t);let n=e.slice(0,32),r=e.slice(32),i=r.slice(-16),a=r.slice(0,-16),o=da(a,[],n,i,this.toArray());if(o===null)throw Error(`Decryption failed!`);return zr(o,t)}},pa=class e extends Ti{static SIGHASH_ALL=1;static SIGHASH_NONE=2;static SIGHASH_SINGLE=3;static SIGHASH_FORKID=64;static SIGHASH_ANYONECANPAY=128;scope;static format(t){let n={sourceTXID:t.sourceTXID,sourceOutputIndex:t.sourceOutputIndex,sequence:t.inputSequence},r=[...t.otherInputs];r.splice(t.inputIndex,0,n);let i=()=>{let e=new L;for(let t of r){if(t.sourceTXID===void 0){if(t.sourceTransaction==null)throw Error(`Missing sourceTransaction for input`);e.write(t.sourceTransaction.hash())}else e.writeReverse(F(t.sourceTXID,`hex`));e.writeUInt32LE(t.sourceOutputIndex)}let t=e.toArray();return Pn(t)},a=()=>{let e=new L;for(let t of r){let n=t.sequence??4294967295;e.writeUInt32LE(n)}let t=e.toArray();return Pn(t)};function o(e){let n=new L;if(e===void 0)for(let e of t.outputs){let t=e.satoshis??0;n.writeUInt64LE(t);let r=e.lockingScript?.toBinary()??[];n.writeVarIntNum(r.length),n.write(r)}else{let r=t.outputs[e];if(r===void 0)throw Error(`Output at index ${e} does not exist`);let i=r.satoshis??0;n.writeUInt64LE(i);let a=r.lockingScript?.toBinary()??[];n.writeVarIntNum(a.length),n.write(a)}let r=n.toArray();return Pn(r)}let s=Array(32).fill(0),c=Array(32).fill(0),l=Array(32).fill(0);(t.scope&e.SIGHASH_ANYONECANPAY)===0&&(s=i()),(t.scope&e.SIGHASH_ANYONECANPAY)===0&&(t.scope&31)!==e.SIGHASH_SINGLE&&(t.scope&31)!==e.SIGHASH_NONE&&(c=a()),(t.scope&31)!==e.SIGHASH_SINGLE&&(t.scope&31)!==e.SIGHASH_NONE?l=o():(t.scope&31)===e.SIGHASH_SINGLE&&t.inputIndex<t.outputs.length&&(l=o(t.inputIndex));let u=new L;u.writeInt32LE(t.transactionVersion),u.write(s),u.write(c),u.writeReverse(F(t.sourceTXID,`hex`)),u.writeUInt32LE(t.sourceOutputIndex);let d=t.subscript.toBinary();u.writeVarIntNum(d.length),u.write(d),u.writeUInt64LE(t.sourceSatoshis);let f=n.sequence;return u.writeUInt32LE(f),u.write(l),u.writeUInt32LE(t.lockTime),u.writeUInt32LE(t.scope>>>0),u.toArray()}static fromChecksigFormat(t){if(t.length===0){let t=new N(1),n=new N(1);return new e(t,n,1)}let n=t[t.length-1],r=t.slice(0,t.length-1),i=Ti.fromDER(r);return new e(i.r,i.s,n)}constructor(e,t,n){super(e,t),this.scope=n}hasLowS(){return!(this.s.ltn(1)||this.s.gt(new N(`7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0`,`hex`)))}toChecksigFormat(){return[...this.toDER(),this.scope]}},ma=class{curve;constructor(){this.curve=new wi}generateProof(e,t,n,r){let i=Hi.fromRandom(),a=i.toPublicKey(),o=n.mul(i),s=this.computeChallenge(t,n,r,o,a),c=i.add(s.mul(e)).umod(this.curve.n);return{R:a,SPrime:o,z:c}}verifyProof(e,t,n,r){let{R:i,SPrime:a,z:o}=r,s=this.computeChallenge(e,t,n,a,i),c=this.curve.g.mul(o),l=i.add(e.mul(s));if(!c.eq(l))return!1;let u=t.mul(o),d=a.add(n.mul(s));return!!u.eq(d)}computeChallenge(e,t,n,r,i){let a=[...e.encode(!0),...t.encode(!0),...n.encode(!0),...r.encode(!0),...i.encode(!0)],o=Mn(a);return new N(o).umod(this.curve.n)}},ha={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_SPLIT:127,OP_LEFT:128,OP_NUM2BIN:128,OP_RIGHT:129,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_NOP11:186,OP_NOP12:187,OP_NOP13:188,OP_NOP14:189,OP_NOP15:190,OP_NOP16:191,OP_NOP17:192,OP_NOP18:193,OP_NOP19:194,OP_NOP20:195,OP_NOP21:196,OP_NOP22:197,OP_NOP23:198,OP_NOP24:199,OP_NOP25:200,OP_NOP26:201,OP_NOP27:202,OP_NOP28:203,OP_NOP29:204,OP_NOP30:205,OP_NOP31:206,OP_NOP32:207,OP_NOP33:208,OP_NOP34:209,OP_NOP35:210,OP_NOP36:211,OP_NOP37:212,OP_NOP38:213,OP_NOP39:214,OP_NOP40:215,OP_NOP41:216,OP_NOP42:217,OP_NOP43:218,OP_NOP44:219,OP_NOP45:220,OP_NOP46:221,OP_NOP47:222,OP_NOP48:223,OP_NOP49:224,OP_NOP50:225,OP_NOP51:226,OP_NOP52:227,OP_NOP53:228,OP_NOP54:229,OP_NOP55:230,OP_NOP56:231,OP_NOP57:232,OP_NOP58:233,OP_NOP59:234,OP_NOP60:235,OP_NOP61:236,OP_NOP62:237,OP_NOP63:238,OP_NOP64:239,OP_NOP65:240,OP_NOP66:241,OP_NOP67:242,OP_NOP68:243,OP_NOP69:244,OP_NOP70:245,OP_NOP71:246,OP_NOP72:247,OP_NOP73:248,OP_NOP77:252,OP_SMALLDATA:249,OP_SMALLINTEGER:250,OP_PUBKEYS:251,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};for(let e in ha)ha[ha[e]]=e;var z=ha,ga=class e{chunks;static fromASM(t){let n=[],r=t.split(` `),i=0;for(;i<r.length;){let e=r[i],t,a=0;if(e.startsWith(`OP_`)&&z[e]!==void 0&&(t=e,a=z[e]),e===`0`)a=0,n.push({op:a}),i+=1;else if(e===`-1`)a=z.OP_1NEGATE,n.push({op:a}),i+=1;else if(t===void 0){let e=r[i];e.length%2!=0&&(e=`0`+e);let t=F(e,`hex`);if(zr(t,`hex`)!==e)throw Error(`invalid hex string in script`);let o=t.length;o>=0&&o<z.OP_PUSHDATA1?a=o:o<2**8?a=z.OP_PUSHDATA1:o<2**16?a=z.OP_PUSHDATA2:o<2**32&&(a=z.OP_PUSHDATA4),n.push({data:t,op:a}),i+=1}else a===z.OP_PUSHDATA1||a===z.OP_PUSHDATA2||a===z.OP_PUSHDATA4?(n.push({data:F(r[i+2],`hex`),op:a}),i+=3):(n.push({op:a}),i+=1)}return new e(n)}static fromHex(t){if(t.length===0)return e.fromBinary([]);if(t.length%2!=0)throw Error(`There is an uneven number of characters in the string which suggests it is not hex encoded.`);if(!/^[0-9a-fA-F]+$/.test(t))throw Error(`Some elements in this string are not hex encoded.`);return e.fromBinary(F(t,`hex`))}static fromBinary(t){t=[...t];let n=[],r=0,i=new Kr(t);for(;!i.eof();){let e=i.readUInt8();if(e===z.OP_RETURN&&r===0){n.push({op:e,data:i.read()});break}e===z.OP_IF||e===z.OP_NOTIF||e===z.OP_VERIF||e===z.OP_VERNOTIF?r++:e===z.OP_ENDIF&&r--;let t=0,a=[];if(e>0&&e<z.OP_PUSHDATA1)t=e,n.push({data:i.read(t),op:e});else if(e===z.OP_PUSHDATA1){try{t=i.readUInt8(),a=i.read(t)}catch{i.read()}n.push({data:a,op:e})}else if(e===z.OP_PUSHDATA2){try{t=i.readUInt16LE(),a=i.read(t)}catch{i.read()}n.push({data:a,op:e})}else if(e===z.OP_PUSHDATA4){try{t=i.readUInt32LE(),a=i.read(t)}catch{i.read()}n.push({data:a,op:e})}else n.push({op:e})}return new e(n)}constructor(e=[]){this.chunks=e}toASM(){let e=``;for(let t=0;t<this.chunks.length;t++){let n=this.chunks[t];e+=this._chunkToString(n)}return e.slice(1)}toHex(){return zr(this.toBinary(),`hex`)}toBinary(){let e=new L;for(let t=0;t<this.chunks.length;t++){let n=this.chunks[t],r=n.op;if(e.writeUInt8(r),r===z.OP_RETURN&&n.data!=null){e.write(n.data);break}else n.data!=null&&(r<z.OP_PUSHDATA1?e.write(n.data):r===z.OP_PUSHDATA1?(e.writeUInt8(n.data.length),e.write(n.data)):r===z.OP_PUSHDATA2?(e.writeUInt16LE(n.data.length),e.write(n.data)):r===z.OP_PUSHDATA4&&(e.writeUInt32LE(n.data.length),e.write(n.data)))}return e.toArray()}writeScript(e){return this.chunks=this.chunks.concat(e.chunks),this}writeOpCode(e){return this.chunks.push({op:e}),this}setChunkOpCode(e,t){return this.chunks[e]={op:t},this}writeBn(e){if(e.cmpn(0)===z.OP_0)this.chunks.push({op:z.OP_0});else if(e.cmpn(-1)===0)this.chunks.push({op:z.OP_1NEGATE});else if(e.cmpn(1)>=0&&e.cmpn(16)<=0)this.chunks.push({op:e.toNumber()+z.OP_1-1});else{let t=e.toSm(`little`);this.writeBin(t)}return this}writeBin(e){let t,n=e.length>0?e:void 0;if(e.length>0&&e.length<z.OP_PUSHDATA1)t=e.length;else if(e.length===0)t=z.OP_0;else if(e.length<2**8)t=z.OP_PUSHDATA1;else if(e.length<2**16)t=z.OP_PUSHDATA2;else if(e.length<2**32)t=z.OP_PUSHDATA4;else throw Error(`You can't push that much data`);return this.chunks.push({data:n,op:t}),this}writeNumber(e){return this.writeBn(new N(e)),this}removeCodeseparators(){let e=[];for(let t=0;t<this.chunks.length;t++)this.chunks[t].op!==z.OP_CODESEPARATOR&&e.push(this.chunks[t]);return this.chunks=e,this}findAndDelete(t){let n=t.toHex();for(let t=0;t<this.chunks.length;t++){let r=new e([this.chunks[t]]).toHex();n===r&&this.chunks.splice(t,1)}return this}isPushOnly(){for(let e=0;e<this.chunks.length;e++)if(this.chunks[e].op>z.OP_16)return!1;return!0}isLockingScript(){throw Error(`Not implemented`)}isUnlockingScript(){throw Error(`Not implemented`)}_chunkToString(e){let t=e.op,n=``;if(e.data===void 0){let e=z[t];n=`${n} ${e}`}else n=`${n} ${P(e.data)}`;return n}},_a=class extends ga{isLockingScript(){return!0}isUnlockingScript(){return!1}},va=class extends ga{isLockingScript(){return!1}isUnlockingScript(){return!0}},ya=class extends Error{txid;outputIndex;context;programCounter;stackState;altStackState;ifStackState;stackMem;altStackMem;constructor(e){let t=e.stackState.map(e=>e!=null&&e.length!==void 0?P(e):e==null?`null/undef`:`INVALID_STACK_ITEM`).join(`, `),n=e.altStackState.map(e=>e!=null&&e.length!==void 0?P(e):e==null?`null/undef`:`INVALID_STACK_ITEM`).join(`, `),r=`Context: ${e.context}, PC: ${e.programCounter}`,i=`Stack: [${t}] (len: ${e.stackState.length}, mem: ${e.stackMem})`,a=`AltStack: [${n}] (len: ${e.altStackState.length}, mem: ${e.altStackMem})`,o=`IfStack: [${e.ifStackState.join(`, `)}]`,s=`Script evaluation error: ${e.message}\nTXID: ${e.txid}, OutputIdx: ${e.outputIndex}\n${r}\n${i}\n${a}\n${o}`;super(s),this.name=this.constructor.name,this.txid=e.txid,this.outputIndex=e.outputIndex,this.context=e.context,this.programCounter=e.programCounter,this.stackState=e.stackState.map(e=>e.slice()),this.altStackState=e.altStackState.map(e=>e.slice()),this.ifStackState=e.ifStackState.slice(),this.stackMem=e.stackMem,this.altStackMem=e.altStackMem}},ba=1024*1024*1024,xa=2**31-1,Sa=!0,Ca=Object.freeze(new N(-1).toScriptNum()),wa=Object.freeze(Array.from({length:17},(e,t)=>Object.freeze(new N(t).toScriptNum())));function Ta(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ea(e,t=2**53-1){return!(e.length>t||e.length>0&&!(e[e.length-1]&127)&&(e.length<=1||!(e[e.length-2]&128)))}function Da(e){if(e.length<9||e.length>73||e[0]!==48||e[1]!==e.length-3)return!1;let t=e[2],n=e[3];if(t!==2||n===0||5+n>=e.length)return!1;let r=4+n,i=e[r],a=e[r+1];if(i!==2||a===0||e[4]&128||n>1&&e[4]===0&&!(e[5]&128))return!1;let o=r+2;return!(e[o]&128||a>1&&e[o]===0&&!(e[o+1]&128)||n+a+7!==e.length)}function Oa(e){return e===z.OP_2MUL||e===z.OP_2DIV||e===z.OP_VERIF||e===z.OP_VERNOTIF||e===z.OP_VER}function ka(e){let t=e.data,n=e.op;return Array.isArray(t)?t.length===0?n===z.OP_0:t.length===1&&t[0]>=1&&t[0]<=16?n===z.OP_1+(t[0]-1):t.length===1&&t[0]===129?n===z.OP_1NEGATE:t.length<=75?n===t.length:t.length<=255?n===z.OP_PUSHDATA1:t.length<=65535?n===z.OP_PUSHDATA2:!0:!0}var Aa=class{sourceTXID;sourceOutputIndex;sourceSatoshis;lockingScript;transactionVersion;otherInputs;outputs;inputIndex;unlockingScript;inputSequence;lockTime;context;programCounter;lastCodeSeparator;stack;altStack;ifStack;memoryLimit;stackMem;altStackMem;constructor(e){this.sourceTXID=e.sourceTXID,this.sourceOutputIndex=e.sourceOutputIndex,this.sourceSatoshis=e.sourceSatoshis,this.lockingScript=e.lockingScript,this.transactionVersion=e.transactionVersion,this.otherInputs=e.otherInputs,this.outputs=e.outputs,this.inputIndex=e.inputIndex,this.unlockingScript=e.unlockingScript,this.inputSequence=e.inputSequence,this.lockTime=e.lockTime,this.memoryLimit=e.memoryLimit??32e6,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0,this.reset()}reset(){this.context=`UnlockingScript`,this.programCounter=0,this.lastCodeSeparator=null,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0}ensureStackMem(e){this.stackMem+e>this.memoryLimit&&this.scriptEvaluationError(`Stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`)}ensureAltStackMem(e){this.altStackMem+e>this.memoryLimit&&this.scriptEvaluationError(`Alt stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`)}pushStack(e){this.ensureStackMem(e.length),this.stack.push(e),this.stackMem+=e.length}pushStackCopy(e){this.ensureStackMem(e.length);let t=e.slice();this.stack.push(t),this.stackMem+=t.length}popStack(){this.stack.length===0&&this.scriptEvaluationError(`Attempted to pop from an empty stack.`);let e=this.stack.pop();return this.stackMem-=e.length,e}stackTop(e=-1){return(this.stack.length===0||this.stack.length<Math.abs(e)||e>=0&&e>=this.stack.length)&&this.scriptEvaluationError(`Stack underflow accessing element at index ${e}. Stack length is ${this.stack.length}.`),this.stack[this.stack.length+e]}pushAltStack(e){this.ensureAltStackMem(e.length),this.altStack.push(e),this.altStackMem+=e.length}popAltStack(){this.altStack.length===0&&this.scriptEvaluationError(`Attempted to pop from an empty alt stack.`);let e=this.altStack.pop();return this.altStackMem-=e.length,e}checkSignatureEncoding(e){if(e.length===0)return!0;if(!Da(e))return this.scriptEvaluationError(`The signature format is invalid.`),!1;try{let t=pa.fromChecksigFormat(e);if(!t.hasLowS())return this.scriptEvaluationError(`The signature must have a low S value.`),!1;if((t.scope&pa.SIGHASH_FORKID)===0)return this.scriptEvaluationError(`The signature must use SIGHASH_FORKID.`),!1}catch{return this.scriptEvaluationError(`The signature format is invalid.`),!1}return!0}checkPublicKeyEncoding(e){if(e.length===0)return this.scriptEvaluationError(`Public key is empty.`),!1;if(e.length<33)return this.scriptEvaluationError(`The public key is too short, it must be at least 33 bytes.`),!1;if(e[0]===4){if(e.length!==65)return this.scriptEvaluationError(`The non-compressed public key must be 65 bytes.`),!1}else if(e[0]===2||e[0]===3){if(e.length!==33)return this.scriptEvaluationError(`The compressed public key must be 33 bytes.`),!1}else return this.scriptEvaluationError(`The public key is in an unknown format.`),!1;try{Fi.fromDER(e)}catch{return this.scriptEvaluationError(`The public key is in an unknown format.`),!1}return!0}verifySignature(e,t,n){let r=pa.format({sourceTXID:this.sourceTXID,sourceOutputIndex:this.sourceOutputIndex,sourceSatoshis:this.sourceSatoshis,transactionVersion:this.transactionVersion,otherInputs:this.otherInputs,outputs:this.outputs,inputIndex:this.inputIndex,subscript:n,inputSequence:this.inputSequence,lockTime:this.lockTime,scope:e.scope}),i=new N(Pn(r));return Pi(i,e,t)}step(){if(this.stackMem>this.memoryLimit)return this.scriptEvaluationError(`Stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`),!1;if(this.altStackMem>this.memoryLimit)return this.scriptEvaluationError(`Alt stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`),!1;this.context===`UnlockingScript`&&this.programCounter>=this.unlockingScript.chunks.length&&(this.context=`LockingScript`,this.programCounter=0);let e=this.context===`UnlockingScript`?this.unlockingScript:this.lockingScript;if(this.programCounter>=e.chunks.length)return!1;let t=e.chunks[this.programCounter],n=t.op;n===void 0&&this.scriptEvaluationError(`Missing opcode in ${this.context} at pc=${this.programCounter}.`),Array.isArray(t.data)&&t.data.length>ba&&this.scriptEvaluationError(`Data push > ${ba} bytes (pc=${this.programCounter}).`);let r=!this.ifStack.includes(!1);if(r&&Oa(n)&&this.scriptEvaluationError(`This opcode is currently disabled. (Opcode: ${z[n]}, PC: ${this.programCounter})`),r&&n>=0&&n<=z.OP_PUSHDATA4)ka(t)||this.scriptEvaluationError(`This data is not minimally-encoded. (PC: ${this.programCounter})`),this.pushStack(Array.isArray(t.data)?t.data:[]);else if(r||n>=z.OP_IF&&n<=z.OP_ENDIF){let e,t,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D;switch(n){case z.OP_1NEGATE:this.pushStackCopy(Ca);break;case z.OP_0:this.pushStackCopy(wa[0]);break;case z.OP_1:case z.OP_2:case z.OP_3:case z.OP_4:case z.OP_5:case z.OP_6:case z.OP_7:case z.OP_8:case z.OP_9:case z.OP_10:case z.OP_11:case z.OP_12:case z.OP_13:case z.OP_14:case z.OP_15:case z.OP_16:p=n-(z.OP_1-1),this.pushStackCopy(wa[p]);break;case z.OP_NOP:case z.OP_NOP2:case z.OP_NOP3:case z.OP_NOP1:case z.OP_NOP4:case z.OP_NOP5:case z.OP_NOP6:case z.OP_NOP7:case z.OP_NOP8:case z.OP_NOP9:case z.OP_NOP10:case z.OP_NOP11:case z.OP_NOP12:case z.OP_NOP13:case z.OP_NOP14:case z.OP_NOP15:case z.OP_NOP16:case z.OP_NOP17:case z.OP_NOP18:case z.OP_NOP19:case z.OP_NOP20:case z.OP_NOP21:case z.OP_NOP22:case z.OP_NOP23:case z.OP_NOP24:case z.OP_NOP25:case z.OP_NOP26:case z.OP_NOP27:case z.OP_NOP28:case z.OP_NOP29:case z.OP_NOP30:case z.OP_NOP31:case z.OP_NOP32:case z.OP_NOP33:case z.OP_NOP34:case z.OP_NOP35:case z.OP_NOP36:case z.OP_NOP37:case z.OP_NOP38:case z.OP_NOP39:case z.OP_NOP40:case z.OP_NOP41:case z.OP_NOP42:case z.OP_NOP43:case z.OP_NOP44:case z.OP_NOP45:case z.OP_NOP46:case z.OP_NOP47:case z.OP_NOP48:case z.OP_NOP49:case z.OP_NOP50:case z.OP_NOP51:case z.OP_NOP52:case z.OP_NOP53:case z.OP_NOP54:case z.OP_NOP55:case z.OP_NOP56:case z.OP_NOP57:case z.OP_NOP58:case z.OP_NOP59:case z.OP_NOP60:case z.OP_NOP61:case z.OP_NOP62:case z.OP_NOP63:case z.OP_NOP64:case z.OP_NOP65:case z.OP_NOP66:case z.OP_NOP67:case z.OP_NOP68:case z.OP_NOP69:case z.OP_NOP70:case z.OP_NOP71:case z.OP_NOP72:case z.OP_NOP73:case z.OP_NOP77:break;case z.OP_IF:case z.OP_NOTIF:h=!1,r&&(this.stack.length<1&&this.scriptEvaluationError(`OP_IF and OP_NOTIF require at least one item on the stack when they are used!`),e=this.popStack(),h=this.castToBool(e),n===z.OP_NOTIF&&(h=!h)),this.ifStack.push(h);break;case z.OP_ELSE:this.ifStack.length===0&&this.scriptEvaluationError(`OP_ELSE requires a preceeding OP_IF.`),this.ifStack[this.ifStack.length-1]=!this.ifStack[this.ifStack.length-1];break;case z.OP_ENDIF:this.ifStack.length===0&&this.scriptEvaluationError(`OP_ENDIF requires a preceeding OP_IF.`),this.ifStack.pop();break;case z.OP_VERIFY:this.stack.length<1&&this.scriptEvaluationError(`OP_VERIFY requires at least one item to be on the stack.`),t=this.stackTop(),h=this.castToBool(t),h||this.scriptEvaluationError(`OP_VERIFY requires the top stack value to be truthy.`),this.popStack();break;case z.OP_RETURN:this.context===`UnlockingScript`?this.programCounter=this.unlockingScript.chunks.length:this.programCounter=this.lockingScript.chunks.length,this.ifStack=[],this.programCounter--;break;case z.OP_TOALTSTACK:this.stack.length<1&&this.scriptEvaluationError(`OP_TOALTSTACK requires at oeast one item to be on the stack.`),this.pushAltStack(this.popStack());break;case z.OP_FROMALTSTACK:this.altStack.length<1&&this.scriptEvaluationError(`OP_FROMALTSTACK requires at least one item to be on the stack.`),this.pushStack(this.popAltStack());break;case z.OP_2DROP:this.stack.length<2&&this.scriptEvaluationError(`OP_2DROP requires at least two items to be on the stack.`),this.popStack(),this.popStack();break;case z.OP_2DUP:this.stack.length<2&&this.scriptEvaluationError(`OP_2DUP requires at least two items to be on the stack.`),t=this.stackTop(-2),i=this.stackTop(-1),this.pushStackCopy(t),this.pushStackCopy(i);break;case z.OP_3DUP:this.stack.length<3&&this.scriptEvaluationError(`OP_3DUP requires at least three items to be on the stack.`),t=this.stackTop(-3),i=this.stackTop(-2),a=this.stackTop(-1),this.pushStackCopy(t),this.pushStackCopy(i),this.pushStackCopy(a);break;case z.OP_2OVER:this.stack.length<4&&this.scriptEvaluationError(`OP_2OVER requires at least four items to be on the stack.`),t=this.stackTop(-4),i=this.stackTop(-3),this.pushStackCopy(t),this.pushStackCopy(i);break;case z.OP_2ROT:{this.stack.length<6&&this.scriptEvaluationError(`OP_2ROT requires at least six items to be on the stack.`);let e=this.popStack(),t=this.popStack(),n=this.popStack(),r=this.popStack(),i=this.popStack(),a=this.popStack();this.pushStack(r),this.pushStack(n),this.pushStack(t),this.pushStack(e),this.pushStack(a),this.pushStack(i);break}case z.OP_2SWAP:{this.stack.length<4&&this.scriptEvaluationError(`OP_2SWAP requires at least four items to be on the stack.`);let e=this.popStack(),t=this.popStack(),n=this.popStack(),r=this.popStack();this.pushStack(t),this.pushStack(e),this.pushStack(r),this.pushStack(n);break}case z.OP_IFDUP:this.stack.length<1&&this.scriptEvaluationError(`OP_IFDUP requires at least one item to be on the stack.`),t=this.stackTop(),this.castToBool(t)&&this.pushStackCopy(t);break;case z.OP_DEPTH:this.pushStack(new N(this.stack.length).toScriptNum());break;case z.OP_DROP:this.stack.length<1&&this.scriptEvaluationError(`OP_DROP requires at least one item to be on the stack.`),this.popStack();break;case z.OP_DUP:this.stack.length<1&&this.scriptEvaluationError(`OP_DUP requires at least one item to be on the stack.`),this.pushStackCopy(this.stackTop());break;case z.OP_NIP:this.stack.length<2&&this.scriptEvaluationError(`OP_NIP requires at least two items to be on the stack.`),i=this.popStack(),this.popStack(),this.pushStack(i);break;case z.OP_OVER:this.stack.length<2&&this.scriptEvaluationError(`OP_OVER requires at least two items to be on the stack.`),this.pushStackCopy(this.stackTop(-2));break;case z.OP_PICK:case z.OP_ROLL:{this.stack.length<2&&this.scriptEvaluationError(`${z[n]} requires at least two items to be on the stack.`),l=N.fromScriptNum(this.popStack(),Sa),p=l.toNumber(),(p<0||p>=this.stack.length)&&this.scriptEvaluationError(`${z[n]} requires the top stack element to be 0 or a positive number less than the current size of the stack.`);let e=this.stack[this.stack.length-1-p];n===z.OP_ROLL?(this.stack.splice(this.stack.length-1-p,1),this.stackMem-=e.length,this.pushStack(e)):this.pushStackCopy(e);break}case z.OP_ROT:this.stack.length<3&&this.scriptEvaluationError(`OP_ROT requires at least three items to be on the stack.`),c=this.popStack(),s=this.popStack(),o=this.popStack(),this.pushStack(s),this.pushStack(c),this.pushStack(o);break;case z.OP_SWAP:this.stack.length<2&&this.scriptEvaluationError(`OP_SWAP requires at least two items to be on the stack.`),s=this.popStack(),o=this.popStack(),this.pushStack(s),this.pushStack(o);break;case z.OP_TUCK:this.stack.length<2&&this.scriptEvaluationError(`OP_TUCK requires at least two items to be on the stack.`),t=this.stackTop(-1),this.ensureStackMem(t.length),this.stack.splice(this.stack.length-2,0,t.slice()),this.stackMem+=t.length;break;case z.OP_SIZE:this.stack.length<1&&this.scriptEvaluationError(`OP_SIZE requires at least one item to be on the stack.`),this.pushStack(new N(this.stackTop().length).toScriptNum());break;case z.OP_AND:case z.OP_OR:case z.OP_XOR:{this.stack.length<2&&this.scriptEvaluationError(`${z[n]} requires at least two items on the stack.`),i=this.popStack(),t=this.popStack(),t.length!==i.length&&this.scriptEvaluationError(`${z[n]} requires the top two stack items to be the same size.`);let e=Array(t.length);for(let r=0;r<t.length;r++)n===z.OP_AND?e[r]=t[r]&i[r]:n===z.OP_OR?e[r]=t[r]|i[r]:e[r]=t[r]^i[r];this.pushStack(e);break}case z.OP_INVERT:{this.stack.length<1&&this.scriptEvaluationError(`OP_INVERT requires at least one item to be on the stack.`),e=this.popStack();let t=Array(e.length);for(let n=0;n<e.length;n++)t[n]=~e[n]&255;this.pushStack(t);break}case z.OP_LSHIFT:case z.OP_RSHIFT:{if(this.stack.length<2&&this.scriptEvaluationError(`${z[n]} requires at least two items to be on the stack.`),d=N.fromScriptNum(this.popStack(),Sa),t=this.popStack(),p=d.toNumber(),p<0&&this.scriptEvaluationError(`${z[n]} requires the top item on the stack not to be negative.`),t.length===0){this.pushStack([]);break}u=new N(t);let e;e=n===z.OP_LSHIFT?u.ushln(p):u.ushrn(p);let r=e.toArray(`le`,t.length);this.pushStack(r);break}case z.OP_EQUAL:case z.OP_EQUALVERIFY:this.stack.length<2&&this.scriptEvaluationError(`${z[n]} requires at least two items to be on the stack.`),i=this.popStack(),t=this.popStack(),h=Ta(t,i),this.pushStack(h?[1]:[]),n===z.OP_EQUALVERIFY&&(h||this.scriptEvaluationError(`OP_EQUALVERIFY requires the top two stack items to be equal.`),this.popStack());break;case z.OP_1ADD:case z.OP_1SUB:case z.OP_NEGATE:case z.OP_ABS:case z.OP_NOT:case z.OP_0NOTEQUAL:switch(this.stack.length<1&&this.scriptEvaluationError(`${z[n]} requires at least one item to be on the stack.`),l=N.fromScriptNum(this.popStack(),Sa),n){case z.OP_1ADD:l=l.add(new N(1));break;case z.OP_1SUB:l=l.sub(new N(1));break;case z.OP_NEGATE:l=l.neg();break;case z.OP_ABS:l.isNeg()&&(l=l.neg());break;case z.OP_NOT:l=new N(l.cmpn(0)===0?1:0);break;case z.OP_0NOTEQUAL:l=new N(l.cmpn(0)===0?0:1);break}this.pushStack(l.toScriptNum());break;case z.OP_ADD:case z.OP_SUB:case z.OP_MUL:case z.OP_DIV:case z.OP_MOD:case z.OP_BOOLAND:case z.OP_BOOLOR:case z.OP_NUMEQUAL:case z.OP_NUMEQUALVERIFY:case z.OP_NUMNOTEQUAL:case z.OP_LESSTHAN:case z.OP_GREATERTHAN:case z.OP_LESSTHANOREQUAL:case z.OP_GREATERTHANOREQUAL:case z.OP_MIN:case z.OP_MAX:{this.stack.length<2&&this.scriptEvaluationError(`${z[n]} requires at least two items to be on the stack.`),i=this.popStack(),t=this.popStack(),d=N.fromScriptNum(i,Sa),u=N.fromScriptNum(t,Sa);let e=0;switch(n){case z.OP_MUL:e=u.byteLength()+d.byteLength();break;case z.OP_ADD:case z.OP_SUB:e=Math.max(u.byteLength(),d.byteLength())+1;break;default:e=Math.max(u.byteLength(),d.byteLength())}this.ensureStackMem(e);let r=new N(0);switch(n){case z.OP_ADD:r=u.add(d);break;case z.OP_SUB:r=u.sub(d);break;case z.OP_MUL:r=u.mul(d);break;case z.OP_DIV:d.cmpn(0)===0&&this.scriptEvaluationError(`OP_DIV cannot divide by zero!`),r=u.div(d);break;case z.OP_MOD:d.cmpn(0)===0&&this.scriptEvaluationError(`OP_MOD cannot divide by zero!`),r=u.mod(d);break;case z.OP_BOOLAND:r=new N(u.cmpn(0)!==0&&d.cmpn(0)!==0?1:0);break;case z.OP_BOOLOR:r=new N(u.cmpn(0)!==0||d.cmpn(0)!==0?1:0);break;case z.OP_NUMEQUAL:r=new N(u.cmp(d)===0?1:0);break;case z.OP_NUMEQUALVERIFY:r=new N(u.cmp(d)===0?1:0);break;case z.OP_NUMNOTEQUAL:r=new N(u.cmp(d)===0?0:1);break;case z.OP_LESSTHAN:r=new N(u.cmp(d)<0?1:0);break;case z.OP_GREATERTHAN:r=new N(u.cmp(d)>0?1:0);break;case z.OP_LESSTHANOREQUAL:r=new N(u.cmp(d)<=0?1:0);break;case z.OP_GREATERTHANOREQUAL:r=new N(u.cmp(d)>=0?1:0);break;case z.OP_MIN:r=u.cmp(d)<0?u:d;break;case z.OP_MAX:r=u.cmp(d)>0?u:d;break}this.pushStack(r.toScriptNum()),n===z.OP_NUMEQUALVERIFY&&(this.castToBool(this.stackTop())||this.scriptEvaluationError(`OP_NUMEQUALVERIFY requires the top stack item to be truthy.`),this.popStack());break}case z.OP_WITHIN:this.stack.length<3&&this.scriptEvaluationError(`OP_WITHIN requires at least three items to be on the stack.`),f=N.fromScriptNum(this.popStack(),Sa),d=N.fromScriptNum(this.popStack(),Sa),u=N.fromScriptNum(this.popStack(),Sa),h=u.cmp(d)>=0&&u.cmp(f)<0,this.pushStack(h?[1]:[]);break;case z.OP_RIPEMD160:case z.OP_SHA1:case z.OP_SHA256:case z.OP_HASH160:case z.OP_HASH256:{this.stack.length<1&&this.scriptEvaluationError(`${z[n]} requires at least one item to be on the stack.`),e=this.popStack();let t=[];n===z.OP_RIPEMD160?t=An(e):n===z.OP_SHA1?t=jn(e):n===z.OP_SHA256?t=Mn(e):n===z.OP_HASH160?t=Fn(e):n===z.OP_HASH256&&(t=Pn(e)),this.pushStack(t);break}case z.OP_CODESEPARATOR:this.lastCodeSeparator=this.programCounter;break;case z.OP_CHECKSIG:case z.OP_CHECKSIGVERIFY:{this.stack.length<2&&this.scriptEvaluationError(`${z[n]} requires at least two items to be on the stack.`),y=this.popStack(),v=this.popStack(),(!this.checkSignatureEncoding(v)||!this.checkPublicKeyEncoding(y))&&this.scriptEvaluationError(`${z[n]} requires correct encoding for the public key and signature.`);let e=(this.context===`UnlockingScript`?this.unlockingScript:this.lockingScript).chunks.slice(this.lastCodeSeparator===null?0:this.lastCodeSeparator+1);if(_=new ga(e),_.findAndDelete(new ga().writeBin(v)),g=!1,v.length>0)try{b=pa.fromChecksigFormat(v),x=Fi.fromDER(y),g=this.verifySignature(b,x,_)}catch{g=!1}this.pushStack(g?[1]:[]),n===z.OP_CHECKSIGVERIFY&&(g||this.scriptEvaluationError(`OP_CHECKSIGVERIFY requires that a valid signature is provided.`),this.popStack());break}case z.OP_CHECKMULTISIG:case z.OP_CHECKMULTISIGVERIFY:{S=1,this.stack.length<S&&this.scriptEvaluationError(`${z[n]} requires at least 1 item for nKeys.`),T=N.fromScriptNum(this.stackTop(-S),Sa).toNumber(),(T<0||T>xa)&&this.scriptEvaluationError(`${z[n]} requires a key count between 0 and ${xa}.`),C=++S,S+=T,this.stack.length<S&&this.scriptEvaluationError(`${z[n]} stack too small for nKeys and keys. Need ${S}, have ${this.stack.length}.`),E=N.fromScriptNum(this.stackTop(-S),Sa).toNumber(),(E<0||E>T)&&this.scriptEvaluationError(`${z[n]} requires the number of signatures to be no greater than the number of keys.`),w=++S,S+=E,this.stack.length<S&&this.scriptEvaluationError(`${z[n]} stack too small for N, keys, M, sigs, and dummy. Need ${S}, have ${this.stack.length}.`);let e=(this.context===`UnlockingScript`?this.unlockingScript:this.lockingScript).chunks.slice(this.lastCodeSeparator===null?0:this.lastCodeSeparator+1);_=new ga(e);for(let e=0;e<E;e++)v=this.stackTop(-w-e),_.findAndDelete(new ga().writeBin(v));for(g=!0;g&&E>0;){if(T===0){g=!1;break}if(v=this.stackTop(-w),y=this.stackTop(-C),(!this.checkSignatureEncoding(v)||!this.checkPublicKeyEncoding(y))&&this.scriptEvaluationError(`${z[n]} requires correct encoding for the public key and signature.`),D=!1,v.length>0)try{b=pa.fromChecksigFormat(v),x=Fi.fromDER(y),D=this.verifySignature(b,x,_)}catch{D=!1}D&&(w++,E--),C++,T--,E>T&&(g=!1)}let t=1+N.fromScriptNum(this.stackTop(-1),!1).toNumber()+1+N.fromScriptNum(this.stackTop(-(1+N.fromScriptNum(this.stackTop(-1),!1).toNumber()+1)),!1).toNumber()+1-1;for(;t>0;)this.popStack(),t--;this.stack.length<1&&this.scriptEvaluationError(`${z[n]} requires an extra item (dummy) to be on the stack.`),this.popStack().length>0&&this.scriptEvaluationError(`${z[n]} requires the extra stack item (dummy) to be empty.`),this.pushStack(g?[1]:[]),n===z.OP_CHECKMULTISIGVERIFY&&(g||this.scriptEvaluationError(`OP_CHECKMULTISIGVERIFY requires that a sufficient number of valid signatures are provided.`),this.popStack());break}case z.OP_CAT:{this.stack.length<2&&this.scriptEvaluationError(`OP_CAT requires at least two items to be on the stack.`),i=this.popStack(),t=this.popStack();let e=t.concat(i);e.length>ba&&this.scriptEvaluationError(`It's not currently possible to push data larger than ${ba} bytes.`),this.pushStack(e);break}case z.OP_SPLIT:{this.stack.length<2&&this.scriptEvaluationError(`OP_SPLIT requires at least two items to be on the stack.`);let e=this.popStack(),t=this.popStack();p=N.fromScriptNum(e,Sa).toNumber(),(p<0||p>t.length)&&this.scriptEvaluationError(`OP_SPLIT requires the first stack item to be a non-negative number less than or equal to the size of the second-from-top stack item.`),this.pushStack(t.slice(0,p)),this.pushStack(t.slice(p));break}case z.OP_NUM2BIN:{this.stack.length<2&&this.scriptEvaluationError(`OP_NUM2BIN requires at least two items to be on the stack.`),m=N.fromScriptNum(this.popStack(),Sa).toNumber(),(m>ba||m<0)&&this.scriptEvaluationError(`It's not currently possible to push data larger than ${ba} bytes or negative size.`);let e=this.popStack();if(e=qr(e),e.length>m&&this.scriptEvaluationError(`OP_NUM2BIN requires that the size expressed in the top stack item is large enough to hold the value expressed in the second-from-top stack item.`),e.length===m){this.pushStack(e);break}let t=Array(m).fill(0),n=0;e.length>0&&(n=e[e.length-1]&128,e[e.length-1]&=127);for(let n=0;n<e.length;n++)t[n]=e[n];n!==0&&(t[m-1]|=128),this.pushStack(t);break}case z.OP_BIN2NUM:{this.stack.length<1&&this.scriptEvaluationError(`OP_BIN2NUM requires at least one item to be on the stack.`),t=this.popStack();let e=qr(t);Ea(e)||this.scriptEvaluationError(`OP_BIN2NUM requires that the resulting number is valid.`),this.pushStack(e);break}default:this.scriptEvaluationError(`Invalid opcode ${n} (pc=${this.programCounter}).`)}}return this.programCounter++,!0}validate(){for(this.unlockingScript.isPushOnly()||this.scriptEvaluationError(`Unlocking scripts can only contain push operations, and no other opcodes.`);this.step()&&!(this.context===`LockingScript`&&this.programCounter>=this.lockingScript.chunks.length););return this.ifStack.length>0&&this.scriptEvaluationError(`Every OP_IF, OP_NOTIF, or OP_ELSE must be terminated with OP_ENDIF prior to the end of the script.`),this.stack.length!==1&&this.scriptEvaluationError(`The clean stack rule requires exactly one item to be on the stack after script execution, found ${this.stack.length}.`),this.stack.length===0?this.scriptEvaluationError(`The top stack element must be truthy after script evaluation (stack is empty).`):this.castToBool(this.stackTop())||this.scriptEvaluationError(`The top stack element must be truthy after script evaluation.`),!0}castToBool(e){if(e.length===0)return!1;for(let t=0;t<e.length;t++)if(e[t]!==0)return!(t===e.length-1&&e[t]===128);return!1}scriptEvaluationError(e){throw new ya({message:e,txid:this.sourceTXID,outputIndex:this.sourceOutputIndex,context:this.context,programCounter:this.programCounter,stackState:this.stack,altStackState:this.altStack,ifStackState:this.ifStack,stackMem:this.stackMem,altStackMem:this.altStackMem})}};function ja(e){if(e==null)throw Error(`must have value`);return e}var Ma=class{lock(e){let t;if(typeof e==`string`){let n=Gr(e);if(n.prefix[0]!==0&&n.prefix[0]!==111)throw Error(`only P2PKH is supported`);t=n.data}else t=e;if(t.length!==20)throw Error(`P2PKH hash length must be 20 bytes`);return new _a([{op:z.OP_DUP},{op:z.OP_HASH160},{op:t.length,data:t},{op:z.OP_EQUALVERIFY},{op:z.OP_CHECKSIG}])}unlock(e,t=`all`,n=!1,r,i){return{sign:async(a,o)=>{let s=pa.SIGHASH_FORKID;t===`all`&&(s|=pa.SIGHASH_ALL),t===`none`&&(s|=pa.SIGHASH_NONE),t===`single`&&(s|=pa.SIGHASH_SINGLE),n&&(s|=pa.SIGHASH_ANYONECANPAY);let c=a.inputs[o],l=a.inputs.filter((e,t)=>t!==o),u=c.sourceTXID??c.sourceTransaction?.id(`hex`);if(u==null||u===void 0||u===``)throw Error(`The input sourceTXID or sourceTransaction is required for transaction signing.`);if(r||=c.sourceTransaction?.outputs[c.sourceOutputIndex].satoshis,r==null||r===void 0)throw Error(`The sourceSatoshis or input sourceTransaction is required for transaction signing.`);if(i||=c.sourceTransaction?.outputs[c.sourceOutputIndex].lockingScript,i==null)throw Error(`The lockingScript or input sourceTransaction is required for transaction signing.`);let d=pa.format({sourceTXID:u,sourceOutputIndex:ja(c.sourceOutputIndex),sourceSatoshis:r,transactionVersion:a.version,otherInputs:l,inputIndex:o,outputs:a.outputs,inputSequence:ja(c.sequence),subscript:i,lockTime:a.lockTime,scope:s}),f=e.sign(Mn(d)),p=new pa(f.r,f.s,s).toChecksigFormat(),m=e.toPublicKey().encode(!0);return new va([{op:p.length,data:p},{op:m.length,data:m}])},estimateLength:async()=>108}}},Na=class{type=`raw`;constructor(e=`raw`){this.type=e}lock(e){let t=[{op:z.OP_OVER},{op:z.OP_3},{op:z.OP_SPLIT},{op:z.OP_NIP},{op:z.OP_1},{op:z.OP_SPLIT},{op:z.OP_SWAP},{op:z.OP_SPLIT},{op:z.OP_DROP}];return this.type!==`raw`&&t.push({op:z[`OP_`+this.type]}),t.push({op:e.length,data:e}),t.push({op:z.OP_EQUALVERIFY}),t.push({op:z.OP_CHECKSIG}),new _a(t)}unlock(e,t,n=`all`,r=!1){return{sign:async(i,a)=>{t===void 0&&(t=Hi.fromRandom());let o=pa.SIGHASH_FORKID;n===`all`&&(o|=pa.SIGHASH_ALL),n===`none`&&(o|=pa.SIGHASH_NONE),n===`single`&&(o|=pa.SIGHASH_SINGLE),r&&(o|=pa.SIGHASH_ANYONECANPAY);let s=[...i.inputs],[c]=s.splice(a,1);if(typeof c.sourceTransaction!=`object`)throw Error(`The source transaction is needed for transaction signing.`);let l=pa.format({sourceTXID:c.sourceTransaction?.id(`hex`)??``,sourceOutputIndex:c.sourceOutputIndex??0,sourceSatoshis:c.sourceTransaction?.outputs[c.sourceOutputIndex]?.satoshis??0,transactionVersion:i.version,otherInputs:s,inputIndex:a,outputs:i.outputs,inputSequence:c.sequence??4294967295,subscript:c.sourceTransaction?.outputs[c.sourceOutputIndex]?.lockingScript??new ga,lockTime:i.lockTime,scope:o}),u=t.sign(Mn(l),void 0,!0,e),d=new pa(u.r,u.s,o).toChecksigFormat(),f=t.toPublicKey().encode(!0);return new va([{op:d.length,data:d},{op:f.length,data:f}])},estimateLength:async()=>108}}};function Pa(e){if(e==null)throw Error(`must have value`);return e}var Fa=e=>e.length===0||e.length===1&&e[0]===0?{op:0}:e.length===1&&e[0]>0&&e[0]<=16?{op:80+e[0]}:e.length===1&&e[0]===129?{op:79}:e.length<=75?{op:e.length,data:e}:e.length<=255?{op:76,data:e}:e.length<=65535?{op:77,data:e}:{op:78,data:e},Ia=class{wallet;originator;static decode(e){let t=Fi.fromString(P(Pa(e.chunks[0].data))),n=[];for(let t=2;t<e.chunks.length;t++){let r=e.chunks[t+1]?.op,i=e.chunks[t].data??[];if(i.length===0&&(e.chunks[t].op>=80&&e.chunks[t].op<=95?i=[e.chunks[t].op-80]:e.chunks[t].op===0?i=[0]:e.chunks[t].op===79&&(i=[129])),n.push(i),r===z.OP_DROP||r===z.OP_2DROP)break}return{fields:n,lockingPublicKey:t}}constructor(e,t){this.wallet=e,this.originator=t}async lock(e,t,n,r,i=!1,a=!0,o=`before`){let{publicKey:s}=await this.wallet.getPublicKey({protocolID:t,keyID:n,counterparty:r,forSelf:i},this.originator),c=[],l=[];if(c.push({op:s.length/2,data:F(s,`hex`)}),c.push({op:z.OP_CHECKSIG}),a){let i=e.reduce((e,t)=>[...e,...t],[]),{signature:a}=await this.wallet.createSignature({data:i,protocolID:t,keyID:n,counterparty:r},this.originator);e.push(a)}for(let t of e)l.push(Fa(t));let u=e.length;for(;u>1;)l.push({op:z.OP_2DROP}),u-=2;return u!==0&&l.push({op:z.OP_DROP}),o===`before`?new _a([...c,...l]):new _a([...l,...c])}unlock(e,t,n,r=`all`,i=!1,a,o){return{sign:async(s,c)=>{let l=pa.SIGHASH_FORKID;r===`all`&&(l|=pa.SIGHASH_ALL),r===`none`&&(l|=pa.SIGHASH_NONE),r===`single`&&(l|=pa.SIGHASH_SINGLE),i&&(l|=pa.SIGHASH_ANYONECANPAY);let u=s.inputs[c],d=s.inputs.filter((e,t)=>t!==c),f=u.sourceTXID??u.sourceTransaction?.id(`hex`);if(f==null||f===void 0)throw Error(`The input sourceTXID or sourceTransaction is required for transaction signing.`);if(a||=u.sourceTransaction?.outputs[u.sourceOutputIndex].satoshis,a==null||a===void 0)throw Error(`The sourceSatoshis or input sourceTransaction is required for transaction signing.`);if(o||=u.sourceTransaction?.outputs[u.sourceOutputIndex].lockingScript,o==null)throw Error(`The lockingScript or input sourceTransaction is required for transaction signing.`);let p=pa.format({sourceTXID:f,sourceOutputIndex:Pa(u.sourceOutputIndex),sourceSatoshis:a,transactionVersion:s.version,otherInputs:d,inputIndex:c,outputs:s.outputs,inputSequence:u.sequence??4294967295,subscript:o,lockTime:s.lockTime,scope:l}),m=Mn(p),{signature:h}=await this.wallet.createSignature({data:m,protocolID:e,keyID:t,counterparty:n},this.originator),g=Ti.fromDER([...h]),_=new pa(g.r,g.s,l).toChecksigFormat();return new va([{op:_.length,data:_}])},estimateLength:async()=>73}}},La=class{value;constructor(e){this.value=e}async computeFee(e){let t=e=>e>2**32?9:e>2**16?5:e>253?3:1,n=4;n+=t(e.inputs.length);for(let r=0;r<e.inputs.length;r++){let i=e.inputs[r];n+=40;let a;if(typeof i.unlockingScript==`object`)a=i.unlockingScript.toBinary().length;else if(typeof i.unlockingScriptTemplate==`object`)a=await i.unlockingScriptTemplate.estimateLength(e,r);else throw Error(`All inputs must have an unlocking script or an unlocking script template for sat/kb fee computation.`);n+=t(a),n+=a}n+=t(e.outputs.length);for(let r of e.outputs){n+=8;let e=r.lockingScript.toBinary().length;n+=t(e),n+=e}return n+=4,Math.ceil(n/1e3*this.value)}},Ra=class{https;constructor(e){this.https=e}async request(e,t){return await new Promise((n,r)=>{let i=this.https.request(e,t,e=>{let t=``;e.on(`data`,e=>{t+=e}),e.on(`end`,()=>{let r=e.statusCode>=200&&e.statusCode<=299,i=e.headers[`content-type`],a=t!==``&&typeof i==`string`&&i.startsWith(`application/json`)?JSON.parse(t):t;n({status:e.statusCode,statusText:e.statusMessage,ok:r,data:a})})});i.on(`error`,e=>{r(e)}),t.data!==null&&t.data!==void 0&&i.write(JSON.stringify(t.data)),i.end()})}},za=class{fetch;constructor(e){this.fetch=e}async request(e,t){let n={method:t.method,headers:t.headers,body:JSON.stringify(t.data)},r=await this.fetch(e,n),i=r.headers.get(`Content-Type`)?.startsWith(`application/json`)??!1?await r.json():await r.text();return{ok:r.ok,status:r.status,statusText:r.statusText,data:i}}};function Ba(){let e={async request(...e){throw Error(`No method available to perform HTTP request`)}};if(typeof window<`u`&&typeof window.fetch==`function`)return new za(window.fetch.bind(window));if(u!==void 0)try{let e=Ut();return new Ra(e)}catch{return e}else return e}function Va(){return`ts-sdk-${P(Ri(16))}`}var Ha=class{URL;apiKey;deploymentId;callbackUrl;callbackToken;headers;httpClient;constructor(e,t){if(this.URL=e,typeof t==`string`)this.apiKey=t,this.httpClient=Ba(),this.deploymentId=Va(),this.callbackToken=void 0,this.callbackUrl=void 0;else{let{apiKey:e,deploymentId:n,httpClient:r,callbackToken:i,callbackUrl:a,headers:o}=t??{};this.apiKey=e,this.httpClient=r??Ba(),this.deploymentId=n??Va(),this.callbackToken=i,this.callbackUrl=a,this.headers=o}}requestHeaders(){let e={"Content-Type":`application/json`,"XDeployment-ID":this.deploymentId};if(this.apiKey!=null&&this.apiKey!==``&&(e.Authorization=`Bearer ${this.apiKey}`),this.callbackUrl!=null&&this.callbackUrl!==``&&(e[`X-CallbackUrl`]=this.callbackUrl),this.callbackToken!=null&&this.callbackToken!==``&&(e[`X-CallbackToken`]=this.callbackToken),this.headers!=null)for(let t in this.headers)e[t]=this.headers[t];return e}async broadcast(e){let t;try{t=e.toHexEF()}catch(n){if(n.message===`All inputs must have source transactions when serializing to EF format`)t=e.toHex();else throw n}let n={method:`POST`,headers:this.requestHeaders(),data:{rawTx:t}};try{let e=await this.httpClient.request(`${this.URL}/v1/tx`,n);if(e.ok){let{txid:t,extraInfo:n,txStatus:r,competingTxs:i}=e.data,a={status:`success`,txid:t,message:`${r} ${n}`};return i!=null&&(a.competingTxs=i),a}else{let t=typeof e.status,n={status:`error`,code:t===`number`||t===`string`?e.status.toString():`ERR_UNKNOWN`,description:`Unknown error`},r=e.data;if(typeof r==`string`)try{r=JSON.parse(e.data)}catch{}return typeof r==`object`&&(r!==null&&(n.more=r),r!=null&&typeof r.txid==`string`&&(n.txid=r.txid),r!=null&&`detail`in r&&typeof r.detail==`string`&&(n.description=r.detail)),n}}catch(e){return{status:`error`,code:`500`,description:typeof e.message==`string`?e.message:`Internal Server Error`}}}async broadcastMany(e){let t=e.map(e=>{try{return{rawTx:e.toHexEF()}}catch(t){if(t.message===`All inputs must have source transactions when serializing to EF format`)return{rawTx:e.toHex()};throw t}}),n={method:`POST`,headers:this.requestHeaders(),data:t};try{return(await this.httpClient.request(`${this.URL}/v1/txs`,n)).data}catch(t){let n={status:`error`,code:`500`,description:typeof t.message==`string`?t.message:`Internal Server Error`};return e.map(()=>n)}}};function Ua(e=!1,t={}){return new Ha(e?`https://testnet.arc.gorillapool.io`:`https://arc.gorillapool.io`,t)}var Wa=class{network;apiKey;URL;httpClient;constructor(e=`main`,t={}){let{apiKey:n,httpClient:r}=t;this.network=e,this.URL=`https://api.whatsonchain.com/v1/bsv/${e}`,this.httpClient=r??Ba(),this.apiKey=n??``}async isValidRootForHeight(e,t){let n={method:`GET`,headers:this.getHttpHeaders()},r=await this.httpClient.request(`${this.URL}/block/${t}/header`,n);if(r.ok){let{merkleroot:t}=r.data;return t===e}else if(r.status===404)return!1;else throw Error(`Failed to verify merkleroot for height ${t} because of an error: ${JSON.stringify(r.data)} `)}async currentHeight(){try{let e={method:`GET`,headers:this.getHttpHeaders()},t=await this.httpClient.request(`${this.URL}/block/headers`,e);if(t.ok)return t.data[0].height;throw Error(`Failed to get current height because of an error: ${JSON.stringify(t.data)} `)}catch(e){throw Error(`Failed to get current height because of an error: ${e instanceof Error?e.message:String(e)}`)}}getHttpHeaders(){let e={Accept:`application/json`};return typeof this.apiKey==`string`&&this.apiKey.trim()!==``&&(e.Authorization=this.apiKey),e}};function Ga(){return new Wa}var Ka=class e{blockHeight;path;static fromHex(t){return e.fromBinary(F(t,`hex`))}static fromReader(t,n=!0){let r=t.readVarIntNum(),i=t.readUInt8(),a=Array(i).fill(null).map(()=>[]),o,s,c;for(let e=0;e<i;e++){for(c=t.readVarIntNum();c>0;){s=t.readVarIntNum(),o=t.readUInt8();let n={offset:s};o&1?n.duplicate=!0:(o&2&&(n.txid=!0),n.hash=P(t.read(32).reverse())),(!Array.isArray(a[e])||a[e].length===0)&&(a[e]=[]),a[e].push(n),c--}a[e].sort((e,t)=>e.offset-t.offset)}return new e(r,a,n)}static fromBinary(t){let n=new Kr(t);return e.fromReader(n)}static fromCoinbaseTxidAndHeight(t,n){return new e(n,[[{offset:0,hash:t,txid:!0}]])}constructor(e,t,n=!0){this.blockHeight=e,this.path=t;let r=Array(this.path.length).fill(0).map(()=>new Set);this.path.forEach((e,t)=>{if(e.length===0&&t===0)throw Error(`Empty level at height: ${t}`);let i=new Set;e.forEach(e=>{if(i.has(e.offset))throw Error(`Duplicate offset: ${e.offset}, at height: ${t}`);if(i.add(e.offset),t===0){if(e.duplicate!==!0)for(let t=1;t<this.path.length;t++)r[t].add(e.offset>>t^1)}else if(n&&!r[t].has(e.offset))throw Error(`Invalid offset: ${e.offset}, at height: ${t}, with legal offsets: ${Array.from(r[t]).join(`, `)}`)})});let i;this.path[0].forEach((e,t)=>{if(t===0&&(i=this.computeRoot(e.hash)),i!==this.computeRoot(e.hash))throw Error(`Mismatched roots`)})}toBinary(){let e=new L;e.writeVarIntNum(this.blockHeight);let t=this.path.length;e.writeUInt8(t);for(let n=0;n<t;n++){let t=Object.keys(this.path[n]).length;e.writeVarIntNum(t);for(let t of this.path[n]){e.writeVarIntNum(t.offset);let n=0;t?.duplicate===!0&&(n|=1),t?.txid!==void 0&&t.txid!==null&&(n|=2),e.writeUInt8(n),n&1||e.write(F(t.hash,`hex`).reverse())}}return e.toArray()}toHex(){return P(this.toBinary())}indexOf(e){let t=this.path[0].find(t=>t.hash===e);if(t==null)throw Error(`Transaction ID ${e} not found in the Merkle Path`);return t.offset}computeRoot(e){if(typeof e!=`string`){let t=this.path[0].find(e=>!!e?.hash);if(t==null)throw Error(`No valid leaf found in the Merkle Path`);e=t.hash}if(typeof e!=`string`)throw Error(`Transaction ID is undefined`);let t=this.indexOf(e);if(typeof t!=`number`)throw Error(`This proof does not contain the txid: ${e??`undefined`}`);let n=e=>P(Pn(F(e,`hex`).reverse()).reverse()),r=e;if(this.path.length===1&&this.path[0].length===1)return r;for(let e=0;e<this.path.length;e++){this.path[e];let i=t>>e^1,a=this.findOrComputeLeaf(e,i);if(typeof a!=`object`)throw Error(`Missing hash for index ${t} at height ${e}`);r=a.duplicate===!0?n((r??``)+(r??``)):i%2==0?n((r??``)+(a.hash??``)):n((a.hash??``)+(r??``))}return r}findOrComputeLeaf(e,t){let n=e=>P(Pn(F(e,`hex`).reverse()).reverse()),r=this.path[e].find(e=>e.offset===t);if(r!=null)return r;if(e===0)return;let i=e-1,a=t<<1,o=this.findOrComputeLeaf(i,a);if(o==null||o.hash==null||o.hash===``)return;let s=this.findOrComputeLeaf(i,a+1);if(s==null)return;let c;return c=s.duplicate===!0?n(o.hash+o.hash):n((s.hash??``)+(o.hash??``)),r={offset:t,hash:c},r}async verify(e,t){let n=this.computeRoot(e);if(this.indexOf(e)===0){let e=await t.currentHeight();if(this.blockHeight+100<e)return!1}return await t.isValidRootForHeight(n,this.blockHeight)}combine(e){if(this.blockHeight!==e.blockHeight)throw Error(`You cannot combine paths which do not have the same block height.`);let t=this.computeRoot(),n=e.computeRoot();if(t!==n)throw Error(`You cannot combine paths which do not have the same root.`);let r=[];for(let t=0;t<this.path.length;t++){r.push([]);for(let e=0;e<this.path[t].length;e++)r[t].push(this.path[t][e]);for(let n=0;n<e.path[t].length;n++)if(r[t].find(r=>r.offset===e.path[t][n].offset)===void 0)r[t].push(e.path[t][n]);else if(e.path[t][n]?.txid!==void 0&&e.path[t][n]?.txid!==null){let i=r[t].find(r=>r.offset===e.path[t][n].offset);i!=null&&(i.txid=!0)}}this.path=r,this.trim()}trim(){let e=(e,t)=>{(t.length===0||t.slice(-1)[0]!==e)&&t.push(e)},t=(e,t)=>{for(let n=e.length;n>=0;n--){let r=this.path[t].findIndex(t=>t.offset===e[n]);r>=0&&this.path[t].splice(r,1)}},n=t=>{let n=[];for(let r of t)e(r>>1,n);return n},r=[],i=[];for(let e=0;e<this.path.length;e++)this.path[e].sort((e,t)=>e.offset-t.offset);for(let t=0;t<this.path[0].length;t++){let n=this.path[0][t];if(n.txid===!0)e(n.offset>>1,r);else{let r=n.offset%2==1,a=this.path[0][t+(r?-1:1)];(a.txid===void 0||a.txid===null||!a.txid)&&e(a.offset,i)}}t(i,0);for(let e=1;e<this.path.length;e++)i=r,r=n(r),t(i,e)}},qa=class e{_bumpIndex;_tx;_rawTx;_txid;inputTxids=[];isValid=void 0;get bumpIndex(){return this._bumpIndex}set bumpIndex(e){this._bumpIndex=e,this.updateInputTxids()}get hasProof(){return this._bumpIndex!==void 0}get isTxidOnly(){return this._txid!==void 0&&this._txid!==null&&this._rawTx==null&&this._tx==null}get txid(){if(this._txid!==void 0&&this._txid!==null&&this._txid!==``)return this._txid;if(this._tx!=null)return this._txid=this._tx.id(`hex`),this._txid;if(this._rawTx!=null)return this._txid=P(Pn(this._rawTx)),this._txid;throw Error(`Internal`)}get tx(){if(this._tx!=null)return this._tx;if(this._rawTx!=null)return this._tx=eo.fromBinary(this._rawTx),this._tx}get rawTx(){if(this._rawTx!=null)return this._rawTx;if(this._tx!=null)return this._rawTx=this._tx.toBinary(),this._rawTx}constructor(e,t){typeof e==`string`?this._txid=e:Array.isArray(e)?this._rawTx=e:this._tx=e,this.bumpIndex=t,this.updateInputTxids()}static fromTx(t,n){return new e(t,n)}static fromRawTx(t,n){return new e(t,n)}static fromTxid(t,n){return new e(t,n)}updateInputTxids(){if(this.hasProof||this.tx==null)this.inputTxids=[];else{let e={};for(let t of this.tx.inputs)t.sourceTXID!==void 0&&t.sourceTXID!==null&&t.sourceTXID!==``&&(e[t.sourceTXID]=!0);this.inputTxids=Object.keys(e)}}toWriter(e,t){let n=t=>{e.writeUInt8(t)},r=()=>{if(this._txid==null)throw Error(`Transaction ID (_txid) is undefined`);e.writeReverse(F(this._txid,`hex`))},i=()=>{if(this._rawTx!=null)e.write(this._rawTx);else if(this._tx!=null)e.write(this._tx.toBinary());else throw Error(`a valid serialized Transaction is expected`)};t===4022206466?this.isTxidOnly?(n(Qa.TXID_ONLY),r()):this.bumpIndex===void 0?(n(Qa.RAWTX),i()):(n(Qa.RAWTX_AND_BUMP_INDEX),e.writeVarIntNum(this.bumpIndex),i()):(i(),this.bumpIndex===void 0?n(Qa.RAWTX):(n(Qa.RAWTX_AND_BUMP_INDEX),e.writeVarIntNum(this.bumpIndex)))}static fromReader(t,n){let r,i,a;if(n===4022206466){let n=t.readUInt8();n===Qa.TXID_ONLY?a=e.fromTxid(P(t.readReverse(32))):(n===Qa.RAWTX_AND_BUMP_INDEX&&(i=t.readVarIntNum()),r=eo.fromReader(t),a=e.fromTx(r,i))}else r=eo.fromReader(t),i=t.readUInt8()===0?void 0:t.readVarIntNum(),a=e.fromTx(r,i);return a}};function Ja(e){if(e==null)throw Error(`Expected a valid value, but got undefined.`);return e}const Ya=4022206465,Xa=4022206466,Za=16843009;var Qa;(function(e){e[e.RAWTX=0]=`RAWTX`,e[e.RAWTX_AND_BUMP_INDEX=1]=`RAWTX_AND_BUMP_INDEX`,e[e.TXID_ONLY=2]=`TXID_ONLY`})(Qa||={});var $a=class e{bumps=[];txs=[];version=Xa;atomicTxid=void 0;constructor(e=Xa){this.version=e}findTxid(e){return this.txs.find(t=>t.txid===e)}makeTxidOnly(e){let t=this.txs.findIndex(t=>t.txid===e);if(t===-1)return;let n=this.txs[t];return n.isTxidOnly?n:(this.txs.splice(t,1),n=this.mergeTxidOnly(e),n)}findBump(e){return this.bumps.find(t=>t.path[0].some(t=>t.hash===e))}findTransactionForSigning(e){let t=this.findTxid(e);if(!(t==null||t.tx==null)){for(let e of t.tx.inputs)if(e.sourceTransaction==null){let t=this.findTxid(Ja(e.sourceTXID));t!=null&&(e.sourceTransaction=t.tx)}return t.tx}}findAtomicTransaction(e){let t=this.findTxid(e);if(t==null||t.tx==null)return;let n=(e,t)=>{let r=e.findBump(t.id(`hex`));if(r!=null)t.merklePath=r;else for(let r of t.inputs){if(r.sourceTransaction==null){let t=e.findTxid(Ja(r.sourceTXID));t!=null&&(r.sourceTransaction=t.tx)}if(r.sourceTransaction!=null){let t=e.findBump(r.sourceTransaction.id(`hex`));t==null?n(e,r.sourceTransaction):r.sourceTransaction.merklePath=t}}};return n(this,t.tx),t.tx}mergeBump(e){let t;for(let n=0;n<this.bumps.length;n++){let r=this.bumps[n];if(r===e)return n;if(r.blockHeight===e.blockHeight){let i=r.computeRoot(),a=e.computeRoot();if(i===a){r.combine(e),t=n;break}}}t===void 0&&(t=this.bumps.length,this.bumps.push(e));let n=this.bumps[t];for(let e of this.txs){let r=e.txid;if(e.bumpIndex==null){for(let i of n.path[0])if(i.hash===r){e.bumpIndex=t,i.txid=!0;break}}}return t}mergeRawTx(e,t){let n=new qa(e,t);return this.removeExistingTxid(n.txid),this.txs.push(n),this.tryToValidateBumpIndex(n),n}mergeTransaction(e){let t=e.id(`hex`);this.removeExistingTxid(t);let n;e.merklePath!=null&&(n=this.mergeBump(e.merklePath));let r=new qa(e,n);if(this.txs.push(r),this.tryToValidateBumpIndex(r),n=r.bumpIndex,n===void 0)for(let t of e.inputs)t.sourceTransaction!=null&&this.mergeTransaction(t.sourceTransaction);return r}removeExistingTxid(e){let t=this.txs.findIndex(t=>t.txid===e);t>=0&&this.txs.splice(t,1)}mergeTxidOnly(e){let t=this.txs.find(t=>t.txid===e);return t??(t=new qa(e),this.txs.push(t),this.tryToValidateBumpIndex(t)),t}mergeBeefTx(e){let t=this.findTxid(e.txid);if(e.isTxidOnly&&t==null?t=this.mergeTxidOnly(e.txid):e._tx!=null&&(t==null||t.isTxidOnly)?t=this.mergeTransaction(e._tx):e._rawTx!=null&&(t==null||t.isTxidOnly)&&(t=this.mergeRawTx(e._rawTx)),t==null)throw Error(`Failed to merge BeefTx for txid: ${e.txid}`);return t}mergeBeef(t){let n=Array.isArray(t)?e.fromBinary(t):t;for(let e of n.bumps)this.mergeBump(e);for(let e of n.txs)this.mergeBeefTx(e)}isValid(e){return this.verifyValid(e).valid}async verify(e,t){let n=this.verifyValid(t);if(!n.valid)return!1;for(let t of Object.keys(n.roots))if(!await e.isValidRootForHeight(n.roots[t],Number(t)))return!1;return!0}verifyValid(e){let t={valid:!1,roots:{}},n=this.sortTxs();if(n.missingInputs.length>0||n.notValid.length>0||n.txidOnly.length>0&&e!==!0||n.withMissingInputs.length>0)return t;let r={};for(let n of this.txs)if(n.isTxidOnly){if(e!==!0)return t;r[n.txid]=!0}let i=(e,n)=>{let r=e.computeRoot(n);return(t.roots[e.blockHeight]===void 0||t.roots[e.blockHeight]===``)&&(t.roots[e.blockHeight]=r),t.roots[e.blockHeight]===r};for(let e of this.bumps)for(let n of e.path[0])if(n.txid===!0&&typeof n.hash==`string`&&n.hash.length>0&&(r[n.hash]=!0,!i(e,n.hash)))return t;for(let e of this.txs)if(e.bumpIndex!==void 0&&this.bumps[e.bumpIndex].path[0].find(t=>t.hash===e.txid)==null)return t;for(let e of this.txs){for(let n of e.inputTxids)if(!r[n])return t;r[e.txid]=!0}return t.valid=!0,t}toWriter(e){e.writeUInt32LE(this.version),e.writeVarIntNum(this.bumps.length);for(let t of this.bumps)e.write(t.toBinary());e.writeVarIntNum(this.txs.length);for(let t of this.txs)t.toWriter(e,this.version)}toBinary(){this.sortTxs();let e=new L;return this.toWriter(e),e.toArray()}toBinaryAtomic(e){this.sortTxs();let t=this.findTxid(e);if(t==null)throw Error(`${e} does not exist in this Beef`);let n=this.txs[this.txs.length-1]===t?this:this.clone();if(n!==this){let t=this.txs.findIndex(t=>t.txid===e);n.txs.splice(t+1)}let r=new L;return r.writeUInt32LE(Za),r.writeReverse(F(e,`hex`)),n.toWriter(r),r.toArray()}toHex(){return P(this.toBinary())}static fromReader(t){let n=t.readUInt32LE(),r;if(n===16843009&&(r=P(t.readReverse(32)),n=t.readUInt32LE()),n!==4022206465&&n!==4022206466)throw Error(`Serialized BEEF must start with ${Ya} or ${Xa} but starts with ${n}`);let i=new e(n),a=t.readVarIntNum();for(let e=0;e<a;e++){let e=Ka.fromReader(t,!1);i.bumps.push(e)}let o=t.readVarIntNum();for(let e=0;e<o;e++){let e=qa.fromReader(t,n);i.txs.push(e)}return i.atomicTxid=r,i}static fromBinary(t){let n=new Kr(t);return e.fromReader(n)}static fromString(t,n=`hex`){let r=F(t,n),i=new Kr(r);return e.fromReader(i)}tryToValidateBumpIndex(e){if(e.bumpIndex!==void 0)return!0;let t=e.txid;for(let n=0;n<this.bumps.length;n++){let r=this.bumps[n].path[0].findIndex(e=>e.hash===t);if(r>=0)return e.bumpIndex=n,this.bumps[n].path[0][r].txid=!0,!0}return!1}sortTxs(){let e={},t={},n=[],r=[],i=[];for(let a of this.txs)t[a.txid]=a,a.isValid=a.hasProof,a.isValid?(e[a.txid]=!0,r.push(a)):a.isTxidOnly&&a.inputTxids.length===0?(e[a.txid]=!0,i.push(a)):n.push(a);let a={},o=[],s=n;n=[];for(let e of s){let r=!1;for(let n of e.inputTxids)t[n]===void 0&&(a[n]=!0,r=!0);r?o.push(e):n.push(e)}for(;n.length>0;){let t=n;n=[];for(let i of t)i.inputTxids.every(t=>e[t])?(e[i.txid]=!0,r.push(i)):n.push(i);if(t.length===n.length)break}let c=n;return this.txs=o.concat(c).concat(i).concat(r),{missingInputs:Object.keys(a),notValid:c.map(e=>e.txid),valid:Object.keys(e),withMissingInputs:o.map(e=>e.txid),txidOnly:i.map(e=>e.txid)}}clone(){let t=new e;return t.version=this.version,t.bumps=Array.from(this.bumps),t.txs=Array.from(this.txs),t}trimKnownTxids(e){for(let t=0;t<this.txs.length;){let n=this.txs[t];n.isTxidOnly&&e.includes(n.txid)?this.txs.splice(t,1):t++}}getValidTxids(){return this.sortTxs().valid}toLogString(){let e=``;e+=`BEEF with ${this.bumps.length} BUMPS and ${this.txs.length} Transactions, isValid ${this.isValid().toString()}\n`;let t=-1;for(let n of this.bumps)t++,e+=`  BUMP ${t}\n    block: ${n.blockHeight}\n    txids: [\n${n.path[0].filter(e=>e.txid===!0).map(e=>`      '${e.hash??``}'`).join(`,
`)}\n    ]\n`;t=-1;for(let n of this.txs)t++,e+=`  TX ${t}\n    txid: ${n.txid}\n`,n.bumpIndex!==void 0&&(e+=`    bumpIndex: ${n.bumpIndex}\n`),n.isTxidOnly?e+=`    txidOnly
`:e+=`    rawTx length=${n.rawTx?.length??0}\n`,n.inputTxids.length>0&&(e+=`    inputs: [\n${n.inputTxids.map(e=>`      '${e}'`).join(`,
`)}\n    ]\n`);return e}addComputedLeaves(){let e=e=>P(Pn(F(e,`hex`).reverse()).reverse());for(let t of this.bumps)for(let n=1;n<t.path.length;n++)for(let r of t.path[n-1])if(typeof r.hash==`string`&&!(r.offset&1)){let i=t.path[n-1].find(e=>e.offset===r.offset+1),a=r.offset>>1;i!==void 0&&typeof i.hash==`string`&&t.path[n].every(e=>e.offset!==a)&&t.path[n].push({offset:a,hash:e(i.hash+r.hash)})}}},eo=class e{version;inputs;outputs;lockTime;metadata;merklePath;cachedHash;static addPathOrInputs(e,t,n){if(typeof e.pathIndex==`number`){let t=n[e.pathIndex];if(typeof t!=`object`)throw Error(`Invalid merkle path index found in BEEF!`);e.tx.merklePath=t}else for(let r of e.tx.inputs){if(r.sourceTXID===void 0)throw Error(`Input sourceTXID is undefined`);let e=t[r.sourceTXID];if(typeof e!=`object`)throw Error(`Reference to unknown TXID in BEEF: ${r.sourceTXID??`undefined`}`);r.sourceTransaction=e.tx,this.addPathOrInputs(e,t,n)}}static fromBEEF(t,n){let{tx:r}=e.fromAnyBeef(t,n);return r}static fromAtomicBEEF(t){let{tx:n,txid:r,beef:i}=e.fromAnyBeef(t);if(r!==i.atomicTxid)throw i.atomicTxid==null?Error(`beef must conform to BRC-95 and must contain the subject txid.`):Error(`Transaction with TXID ${i.atomicTxid} not found in BEEF data.`);return n}static fromAnyBeef(e,t){let n=$a.fromBinary(e);if(n.txs.length<1)throw Error(`beef must include at least one transaction.`);let r=t??n.atomicTxid??n.txs.slice(-1)[0].txid,i=n.findAtomicTransaction(r);if(i==null)throw t==null?Error(`beef does not contain transaction for atomic txid.`):Error(`Transaction with TXID ${r} not found in BEEF data.`);return{tx:i,beef:n,txid:r}}static fromEF(t){let n=new Kr(t),r=n.readUInt32LE();if(P(n.read(6))!==`0000000000ef`)throw Error(`Invalid EF marker`);let i=n.readVarIntNum(),a=[];for(let t=0;t<i;t++){let t=P(n.readReverse(32)),r=n.readUInt32LE(),i=n.readVarIntNum(),o=n.read(i),s=va.fromBinary(o),c=n.readUInt32LE(),l=n.readUInt64LEBn().toNumber(),u=n.readVarIntNum(),d=n.read(u),f=_a.fromBinary(d),p=new e(void 0,[],[],void 0);p.outputs=Array(r+1).fill(null),p.outputs[r]={satoshis:l,lockingScript:f},a.push({sourceTransaction:p,sourceTXID:t,sourceOutputIndex:r,unlockingScript:s,sequence:c})}let o=n.readVarIntNum(),s=[];for(let e=0;e<o;e++){let e=n.readUInt64LEBn().toNumber(),t=n.readVarIntNum(),r=n.read(t),i=_a.fromBinary(r);s.push({satoshis:e,lockingScript:i})}let c=n.readUInt32LE();return new e(r,a,s,c)}static parseScriptOffsets(e){let t=new Kr(e),n=[],r=[];t.pos+=4;let i=t.readVarIntNum();for(let e=0;e<i;e++){t.pos+=36;let r=t.readVarIntNum();n.push({vin:e,offset:t.pos,length:r}),t.pos+=r+4}let a=t.readVarIntNum();for(let e=0;e<a;e++){t.pos+=8;let n=t.readVarIntNum();r.push({vout:e,offset:t.pos,length:n}),t.pos+=n}return{inputs:n,outputs:r}}static fromReader(t){let n=t.readUInt32LE(),r=t.readVarIntNum(),i=[];for(let e=0;e<r;e++){let e=P(t.readReverse(32)),n=t.readUInt32LE(),r=t.readVarIntNum(),a=t.read(r),o=va.fromBinary(a),s=t.readUInt32LE();i.push({sourceTXID:e,sourceOutputIndex:n,unlockingScript:o,sequence:s})}let a=t.readVarIntNum(),o=[];for(let e=0;e<a;e++){let e=t.readUInt64LEBn().toNumber(),n=t.readVarIntNum(),r=t.read(n),i=_a.fromBinary(r);o.push({satoshis:e,lockingScript:i})}let s=t.readUInt32LE();return new e(n,i,o,s)}static fromBinary(t){let n=new Kr(t);return e.fromReader(n)}static fromHex(t){return e.fromBinary(F(t,`hex`))}static fromHexEF(t){return e.fromEF(F(t,`hex`))}static fromHexBEEF(t,n){return e.fromBEEF(F(t,`hex`),n)}constructor(e=1,t=[],n=[],r=0,i=new Map,a){this.version=e,this.inputs=t,this.outputs=n,this.lockTime=r,this.metadata=i,this.merklePath=a}addInput(e){if(e.sourceTXID===void 0&&e.sourceTransaction===void 0)throw Error(`A reference to an an input transaction is required. If the input transaction itself cannot be referenced, its TXID must still be provided.`);e.sequence===void 0&&(e.sequence=4294967295),this.cachedHash=void 0,this.inputs.push(e)}addOutput(e){if(this.cachedHash=void 0,e.change!==!0){if(e.satoshis===void 0)throw Error(`either satoshis must be defined or change must be set to true`);if(e.satoshis<0)throw Error(`satoshis must be a positive integer or zero`)}if(e.lockingScript==null)throw Error(`lockingScript must be defined`);this.outputs.push(e)}addP2PKHOutput(e,t){let n=new Ma().lock(e);if(t===void 0)return this.addOutput({lockingScript:n,change:!0});this.addOutput({lockingScript:n,satoshis:t})}updateMetadata(e){this.metadata={...this.metadata,...e}}async fee(e=new La(1),t=`equal`){if(this.cachedHash=void 0,typeof e==`number`){let t=e;e={computeFee:async()=>t}}let n=await e.computeFee(this),r=this.calculateChange(n);if(r<=0){this.outputs=this.outputs.filter(e=>e.change!==!0);return}this.distributeChange(r,t)}calculateChange(e){let t=0;for(let e of this.inputs){if(typeof e.sourceTransaction!=`object`)throw Error(`Source transactions are required for all inputs during fee computation`);t+=e.sourceTransaction.outputs[e.sourceOutputIndex].satoshis??0}t-=e;for(let e of this.outputs)e.change!==!0&&e.satoshis!==void 0&&(t-=e.satoshis);return t}distributeChange(e,t){let n=0,r=this.outputs.filter(e=>e.change);if(t===`random`?n=this.distributeRandomChange(e,r):t===`equal`&&(n=this.distributeEqualChange(e,r)),n<e){let t=this.outputs[this.outputs.length-1];t.satoshis===void 0?t.satoshis=e-n:t.satoshis+=e-n}}distributeRandomChange(e,t){let n=0,r=e,i=Array(t.length).fill(1);r-=t.length,n+=t.length;for(let e=0;e<t.length-1;e++){let t=this.benfordNumber(0,r);i[e]=i[e]+t,n+=t,r-=t}for(let e of this.outputs)e.change===!0&&(e.satoshis=i.shift());return n}distributeEqualChange(e,t){let n=0,r=Math.floor(e/t.length);for(let e of t)n+=r,e.satoshis=r;return n}benfordNumber(e,t){let n=Math.floor(Math.random()*9)+1;return Math.floor(e+(t-e)*Math.log10(1+1/n)/Math.log10(10))}getFee(){let e=0;for(let t of this.inputs){if(typeof t.sourceTransaction!=`object`)throw Error(`Source transactions or sourceSatoshis are required for all inputs to calculate fee`);e+=t.sourceTransaction.outputs[t.sourceOutputIndex].satoshis??0}let t=0;for(let e of this.outputs)t+=e.satoshis??0;return e-t}async sign(){this.cachedHash=void 0;for(let e of this.outputs)if(e.satoshis===void 0)throw e.change===!0?Error(`There are still change outputs with uncomputed amounts. Use the fee() method to compute the change amounts and transaction fees prior to signing.`):Error(`One or more transaction outputs is missing an amount. Ensure all output amounts are provided before signing.`);let e=await Promise.all(this.inputs.map(async(e,t)=>typeof this.inputs[t].unlockingScriptTemplate==`object`?await this.inputs[t]?.unlockingScriptTemplate?.sign(this,t):await Promise.resolve(void 0)));for(let t=0,n=this.inputs.length;t<n;t++)typeof this.inputs[t].unlockingScriptTemplate==`object`&&(this.inputs[t].unlockingScript=e[t])}async broadcast(e=Ua()){return await e.broadcast(this)}toBinary(){let e=new L;e.writeUInt32LE(this.version),e.writeVarIntNum(this.inputs.length);for(let t of this.inputs){if(t.sourceTXID===void 0)if(t.sourceTransaction!=null)e.write(t.sourceTransaction.hash());else throw Error(`sourceTransaction is undefined`);else e.writeReverse(F(t.sourceTXID,`hex`));if(e.writeUInt32LE(t.sourceOutputIndex),t.unlockingScript==null)throw Error(`unlockingScript is undefined`);let n=t.unlockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n),e.writeUInt32LE(t.sequence??0)}e.writeVarIntNum(this.outputs.length);for(let t of this.outputs){e.writeUInt64LE(t.satoshis??0);let n=t.lockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n)}return e.writeUInt32LE(this.lockTime),e.toArray()}toEF(){let e=new L;e.writeUInt32LE(this.version),e.write([0,0,0,0,0,239]),e.writeVarIntNum(this.inputs.length);for(let t of this.inputs){if(t.sourceTransaction===void 0)throw Error(`All inputs must have source transactions when serializing to EF format`);if(t.sourceTXID===void 0?e.write(t.sourceTransaction.hash()):e.write(F(t.sourceTXID,`hex`).reverse()),e.writeUInt32LE(t.sourceOutputIndex),t.unlockingScript==null)throw Error(`unlockingScript is undefined`);let n=t.unlockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n),e.writeUInt32LE(t.sequence??0),e.writeUInt64LE(t.sourceTransaction.outputs[t.sourceOutputIndex].satoshis??0);let r=t.sourceTransaction.outputs[t.sourceOutputIndex].lockingScript.toBinary();e.writeVarIntNum(r.length),e.write(r)}e.writeVarIntNum(this.outputs.length);for(let t of this.outputs){e.writeUInt64LE(t.satoshis??0);let n=t.lockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n)}return e.writeUInt32LE(this.lockTime),e.toArray()}toHexEF(){return P(this.toEF())}toHex(){return P(this.toBinary())}toHexBEEF(){return P(this.toBEEF())}toHexAtomicBEEF(){return P(this.toAtomicBEEF())}hash(e){let t;return this.cachedHash==null?(t=Pn(this.toBinary()),this.cachedHash=t):t=this.cachedHash,e===`hex`?P(t):t}id(e){let t=[...this.hash()];return t.reverse(),e===`hex`?P(t):t}async verify(t=Ga(),n,r){let i=new Set,a=[this];for(;a.length>0;){let o=a.shift(),s=o?.id(`hex`)??``;if(s!=null&&s!==``&&i.has(s))continue;if(typeof o?.merklePath==`object`){if(t===`scripts only`){s!=null&&i.add(s);continue}else if(await o.merklePath.verify(s,t)){i.add(s);continue}}if(n!==void 0){if(o===void 0)throw Error(`Transaction is undefined`);let t=e.fromEF(o.toEF());if(delete t.outputs[0].satoshis,t.outputs[0].change=!0,await t.fee(n),o.getFee()<t.getFee())throw Error(`Verification failed because the transaction ${s} has an insufficient fee and has not been mined.`)}let c=0;if(o===void 0)throw Error(`Transaction is undefined`);for(let e=0;e<o.inputs.length;e++){let t=o.inputs[e];if(typeof t.sourceTransaction!=`object`)throw Error(`Verification failed because the input at index ${e} of transaction ${s} is missing an associated source transaction. This source transaction is required for transaction verification because there is no merkle proof for the transaction spending a UTXO it contains.`);if(typeof t.unlockingScript!=`object`)throw Error(`Verification failed because the input at index ${e} of transaction ${s} is missing an associated unlocking script. This script is required for transaction verification because there is no merkle proof for the transaction spending the UTXO.`);let n=t.sourceTransaction.outputs[t.sourceOutputIndex];c+=n.satoshis??0;let l=t.sourceTransaction.id(`hex`);i.has(l)||a.push(t.sourceTransaction);let u=o.inputs.filter((t,n)=>n!==e);if(t.sourceTXID===void 0&&(t.sourceTXID=l),!new Aa({sourceTXID:t.sourceTXID,sourceOutputIndex:t.sourceOutputIndex,lockingScript:n.lockingScript,sourceSatoshis:n.satoshis??0,transactionVersion:o.version,otherInputs:u,unlockingScript:t.unlockingScript,inputSequence:t.sequence??0,inputIndex:e,outputs:o.outputs,lockTime:o.lockTime,memoryLimit:r}).validate())return!1}let l=0;for(let e of o.outputs){if(typeof e.satoshis!=`number`)throw Error(`Every output must have a defined amount during transaction verification.`);l+=e.satoshis}if(l>c)return!1;i.add(s)}return!0}toBEEF(e){let t=new L;t.writeUInt32LE(Ya);let n=[],r=[],i=t=>{let a={tx:t},o=typeof t.merklePath==`object`;if(o){let e=!1;for(let r=0;r<n.length;r++){if(n[r]===t.merklePath){a.pathIndex=r,e=!0;break}if(t.merklePath!==null&&t.merklePath!==void 0&&n[r].blockHeight===t.merklePath.blockHeight){let i=n[r].computeRoot(),o=t.merklePath.computeRoot();if(i===o){n[r].combine(t.merklePath),a.pathIndex=r,e=!0;break}}}e||(a.pathIndex=n.length,t.merklePath!==null&&t.merklePath!==void 0&&n.push(t.merklePath))}if(r.some(e=>e.tx.id(`hex`)===t.id(`hex`))||r.unshift(a),!o)for(let n=0;n<t.inputs.length;n++){let r=t.inputs[n];if(typeof r.sourceTransaction==`object`)i(r.sourceTransaction);else if(e===!1)throw Error(`A required source transaction is missing!`)}};i(this),t.writeVarIntNum(n.length);for(let e of n)t.write(e.toBinary());t.writeVarIntNum(r.length);for(let e of r)t.write(e.tx.toBinary()),typeof e.pathIndex==`number`?(t.writeUInt8(1),t.writeVarIntNum(e.pathIndex)):t.writeUInt8(0);return t.toArray()}toAtomicBEEF(e){let t=new L;t.writeUInt32LE(16843009),t.write(this.hash());let n=this.toBEEF(e);return t.write(n),t.toArray()}};function to(e){return e.status===`success`}function no(e){return e.status===`error`}var ro=class extends $a{knownTo={};constructor(e){if(super(),e!=null)for(let t of e)this.addParty(t)}isParty(e){return Object.keys(this.knownTo).includes(e)}addParty(e){if(this.isParty(e))throw Error(`Party ${e} already exists.`);this.knownTo[e]={}}getKnownTxidsForParty(e){let t=this.knownTo[e];if(t===void 0)throw Error(`Party ${e} is unknown.`);return Object.keys(t)}getTrimmedBeefForParty(e){let t=this.getKnownTxidsForParty(e),n=this.clone();return n.trimKnownTxids(t),n}addKnownTxidsForParty(e,t){this.isParty(e)||this.addParty(e);let n=this.knownTo[e];for(let e of t)n[e]=!0,this.mergeTxidOnly(e)}mergeBeefFromParty(e,t){let n=Array.isArray(t)?$a.fromBinary(t):t,r=n.getValidTxids();this.mergeBeef(n),this.addKnownTxidsForParty(e,r)}},io=class{network;URL;httpClient;constructor(e=`main`,t=Ba()){this.network=e,this.URL=`https://api.whatsonchain.com/v1/bsv/${e}/tx/raw`,this.httpClient=t}async broadcast(e){let t=e.toHex(),n={method:`POST`,headers:{"Content-Type":`application/json`,Accept:`text/plain`},data:{txhex:t}};try{let e=await this.httpClient.request(this.URL,n);return e.ok?{status:`success`,txid:e.data,message:`broadcast successful`}:{status:`error`,code:e.status.toString()??`ERR_UNKNOWN`,description:e.data??`Unknown error`}}catch(e){return{status:`error`,code:`500`,description:typeof e.message==`string`?e.message:`Internal Server Error`}}}},ao=class{https;constructor(e){this.https=e}async request(e,t){return await new Promise((n,r)=>{let i=this.https.request(e,t,e=>{let t=``;e.on(`data`,e=>{t+=e}),e.on(`end`,()=>{let r=e.statusCode>=200&&e.statusCode<=299,i=e.headers[`content-type`],a=t!==``&&typeof i==`string`&&i.startsWith(`application/json`)?JSON.parse(t):t;n({status:e.statusCode,statusText:e.statusMessage,ok:r,data:a})})});i.on(`error`,e=>{r(e)}),t.data!==null&&t.data!==void 0&&i.write(Buffer.from(t.data)),i.end()})}},oo=class{fetch;constructor(e){this.fetch=e}async request(e,t){let n={method:t.method,headers:t.headers,body:t.data},r=await this.fetch(e,n),i=await r.text();return{ok:r.ok,status:r.status,statusText:r.statusText,data:i}}};function so(){let e={async request(...e){throw Error(`No method available to perform HTTP request`)}};if(typeof window<`u`&&typeof window.fetch==`function`)return new oo(window.fetch.bind(window));if(u!==void 0)try{let e=Ut();return new ao(e)}catch{return e}else return e}var co=class{URL;httpClient;constructor(e,t=so()){this.URL=e,this.httpClient=t}async broadcast(e){let t=e.toEF(),n={method:`POST`,headers:{"Content-Type":`application/octet-stream`},data:new Blob([new Uint8Array(t)])};try{let t=await this.httpClient.request(this.URL,n);return t.ok?{status:`success`,txid:e.id(`hex`),message:`broadcast successful`}:{status:`error`,code:t.status.toString()??`ERR_UNKNOWN`,description:t.data??`Unknown error`}}catch(e){return{status:`error`,code:`500`,description:typeof e.message==`string`?e.message:`Internal Server Error`}}}},lo=class{baseUrl;httpClient;apiKey;constructor(e,t={}){let{httpClient:n,apiKey:r}=t;this.baseUrl=e,this.httpClient=n??Ba(),this.apiKey=r??``}async isValidRootForHeight(e,t){let n={method:`POST`,headers:{"Content-Type":`application/json`,Accept:`application/json`,Authorization:`Bearer ${this.apiKey}`},data:[{blockHeight:t,merkleRoot:e}]};try{let e=await this.httpClient.request(`${this.baseUrl}/api/v1/chain/merkleroot/verify`,n);if(e.ok)return e.data.confirmationState===`CONFIRMED`;throw Error(`Failed to verify merkleroot for height ${t} because of an error: ${JSON.stringify(e.data)}`)}catch(e){throw Error(`Failed to verify merkleroot for height ${t} because of an error: ${e instanceof Error?e.message:String(e)}`)}}async currentHeight(){let e={method:`GET`,headers:{Accept:`application/json`,Authorization:`Bearer ${this.apiKey}`}};try{let t=await this.httpClient.request(`${this.baseUrl}/api/v1/chain/tip/longest`,e);if(t.ok&&t.data&&typeof t.data.height==`number`)return t.data.height;throw Error(`Failed to get current height because of an error: ${JSON.stringify(t.data)}`)}catch(e){throw Error(`Failed to get current height because of an error: ${e instanceof Error?e.message:String(e)}`)}}},uo=s({sign:()=>po,verify:()=>mo}),fo=`42423301`;const po=(e,t,n)=>{let r=typeof n!=`object`;if(r){let e=new wi,t=new Hi(1),r=e.g.mul(t);n=new Fi(r.x,r.y)}let i=Ri(32),a=`2-message signing-${Br(i)}`,o=t.deriveChild(n,a).sign(e).toDER(),s=t.toPublicKey().encode(!0);return[...F(fo,`hex`),...s,...r?[0]:n.encode(!0),...i,...o]},mo=(e,t,n)=>{let r=new Kr(t),i=P(r.read(4));if(i!==fo)throw Error(`Message version mismatch: Expected ${fo}, received ${i}`);let a=Fi.fromString(P(r.read(33))),[o]=r.read(1);if(o===0)n=new Hi(1);else{let e=r.read(32),t=P([o,...e]);if(typeof n!=`object`)throw Error(`This signature can only be verified with knowledge of a specific private key. The associated public key is: ${t}`);let i=n.toPublicKey().encode(!0,`hex`);if(t!==i)throw Error(`The recipient public key is ${i} but the signature requres the recipient to have public key ${t}`)}let s=Br(r.read(32)),c=P(r.read(r.bin.length-r.pos)),l=Ti.fromDER(c,`hex`),u=`2-message signing-${s}`;return a.deriveChild(n,u).verify(e,l)};var ho=s({decrypt:()=>vo,encrypt:()=>_o}),go=`42421033`;const _o=(e,t,n)=>{let r=Ri(32),i=`2-message encryption-${Br(r)}`,a=t.deriveChild(n,i),o=n.deriveChild(t,i),s=a.deriveSharedSecret(o),c=new fa(s.encode(!0).slice(1)).encrypt(e),l=t.toPublicKey().encode(!0);return[...F(go,`hex`),...l,...n.encode(!0),...r,...c]},vo=(e,t)=>{let n=new Kr(e),r=P(n.read(4));if(r!==go)throw Error(`Message version mismatch: Expected ${go}, received ${r}`);let i=Fi.fromString(P(n.read(33))),a=P(n.read(33)),o=t.toPublicKey().encode(!0,`hex`);if(a!==o)throw Error(`The encrypted message expects a recipient public key of ${a}, but the provided key is ${o}`);let s=Br(n.read(32)),c=n.read(n.bin.length-n.pos),l=`2-message encryption-${s}`,u=i.deriveChild(t,l),d=t.deriveChild(i,l),f=u.deriveSharedSecret(d);return new fa(f.encode(!0).slice(1)).decrypt(c)};var yo=s({magicHash:()=>xo,sign:()=>So,verify:()=>Co}),bo=`Bitcoin Signed Message:
`;const xo=e=>{let t=new L;t.writeVarIntNum(24),t.write(F(bo,`utf8`)),t.writeVarIntNum(e.length),t.write(e);let n=t.toArray();return Pn(n)},So=(e,t,n=`base64`)=>{let r=xo(e),i=Ni(new N(r),t,!0);if(n===`raw`)return i;let a=new N(r),o=i.CalculateRecoveryFactor(t.toPublicKey(),a);return i.toCompact(o,!0,`base64`)},Co=(e,t,n)=>{let r=xo(e);return Pi(new N(r),t,n)};var wo=class e{versionBytesNum;depth;parentFingerPrint;childIndex;chainCode;privKey;pubKey;constants={pubKey:76067358,privKey:76066276};constructor(e,t,n,r,i,a,o){this.versionBytesNum=e,this.depth=t,this.parentFingerPrint=n,this.childIndex=r,this.chainCode=i,this.privKey=a,this.pubKey=o}fromRandom(){return this.versionBytesNum=this.constants.privKey,this.depth=0,this.parentFingerPrint=[0,0,0,0],this.childIndex=0,this.chainCode=Ri(32),this.privKey=Hi.fromRandom(),this.pubKey=this.privKey.toPublicKey(),this}static fromRandom(){return new this().fromRandom()}static fromString(e){return new this().fromString(e)}fromString(e){let t=Gr(e);return this.fromBinary([...t.prefix,...t.data])}static fromSeed(e){return new this().fromSeed(e)}fromSeed(e){if(e.length<128/8)throw Error(`Need more than 128 bits of entropy`);if(e.length>512/8)throw Error(`More than 512 bits of entropy is nonstandard`);let t=Ln(F(`Bitcoin seed`,`utf8`),e);return this.depth=0,this.parentFingerPrint=[0,0,0,0],this.childIndex=0,this.chainCode=t.slice(32,64),this.versionBytesNum=this.constants.privKey,this.privKey=new Hi(t.slice(0,32)),this.pubKey=this.privKey.toPublicKey(),this}static fromBinary(e){return new this().fromBinary(e)}fromBinary(e){if(e.length!==78)throw Error(`incorrect bip32 data length`);let t=new Kr(e);this.versionBytesNum=t.readUInt32BE(),this.depth=t.readUInt8(),this.parentFingerPrint=t.read(4),this.childIndex=t.readUInt32BE(),this.chainCode=t.read(32);let n=t.read(33),r=this.versionBytesNum===this.constants.privKey,i=this.versionBytesNum===this.constants.pubKey;if(r&&n[0]===0)this.privKey=new Hi(n.slice(1,33)),this.pubKey=this.privKey.toPublicKey();else if(i&&(n[0]===2||n[0]===3))this.pubKey=Fi.fromString(P(n));else throw Error(`Invalid key`);return this}toString(){let e=this.toBinary();return Wr(e,[])}derive(e){if(e===`m`)return this;let t=e.split(`/`),n=this;for(let[e,r]of t.entries()){if(e===0){if(r!==`m`)throw Error(`invalid path`);continue}if(parseInt(r.replace(`'`,``),10).toString()!==r.replace(`'`,``))throw Error(`invalid path`);let t=r.length>1&&r[r.length-1]===`'`,i=parseInt(t?r.slice(0,r.length-1):r,10)&2147483647;t&&(i+=2147483648),n=n.deriveChild(i)}return n}deriveChild(t){if(typeof t!=`number`)throw Error(`i must be a number`);let n=[];n.push(t>>24&255),n.push(t>>16&255),n.push(t>>8&255),n.push(t&255);let r=[...n],i=(t&2147483648)!=0,a=this.versionBytesNum===this.constants.privKey;if(i&&(this.privKey===null||this.privKey===void 0||!a))throw Error(`Cannot do private key derivation without private key`);let o=null;if(this.privKey!==null&&this.privKey!==void 0){let t=null;t=i?[0,...this.privKey.toArray(`be`,32),...r]:[...this.pubKey.encode(!0),...r];let n=Ln(this.chainCode,t),a=new N(n.slice(0,32)),s=n.slice(32,64),c=a.add(this.privKey).mod(new wi().n);o=new e,o.chainCode=s,o.privKey=new Hi(c.toArray()),o.pubKey=o.privKey.toPublicKey()}else{let t=[...this.pubKey.encode(!0),...r],n=Ln(this.chainCode,t),i=new N(n.slice(0,32)),a=n.slice(32,64),s=new wi().g.mul(i),c=this.pubKey,l=s.add(c),u=new Fi(l.x,l.y);o=new e,o.chainCode=a,o.pubKey=u}return o.childIndex=t,o.parentFingerPrint=Fn(this.pubKey.encode(!0)).slice(0,4),o.versionBytesNum=this.versionBytesNum,o.depth=this.depth+1,o}toPublic(){let t=new e(this.versionBytesNum,this.depth,this.parentFingerPrint,this.childIndex,this.chainCode,this.privKey,this.pubKey);return t.versionBytesNum=this.constants.pubKey,t.privKey=void 0,t}toBinary(){let e=this.versionBytesNum===this.constants.privKey,t=this.versionBytesNum===this.constants.pubKey;if(e)return new L().writeUInt32BE(this.versionBytesNum).writeUInt8(this.depth).write(this.parentFingerPrint).writeUInt32BE(this.childIndex).write(this.chainCode).writeUInt8(0).write(this.privKey.toArray(`be`,32)).toArray();if(t)return new L().writeUInt32BE(this.versionBytesNum).writeUInt8(this.depth).write(this.parentFingerPrint).writeUInt32BE(this.childIndex).write(this.chainCode).write(this.pubKey.encode(!0)).toArray();throw Error(`bip32: invalid versionBytesNum byte`)}isPrivate(){return this.versionBytesNum===this.constants.privKey}};const To={value:`abandon.ability.able.about.above.absent.absorb.abstract.absurd.abuse.access.accident.account.accuse.achieve.acid.acoustic.acquire.across.act.action.actor.actress.actual.adapt.add.addict.address.adjust.admit.adult.advance.advice.aerobic.affair.afford.afraid.again.age.agent.agree.ahead.aim.air.airport.aisle.alarm.album.alcohol.alert.alien.all.alley.allow.almost.alone.alpha.already.also.alter.always.amateur.amazing.among.amount.amused.analyst.anchor.ancient.anger.angle.angry.animal.ankle.announce.annual.another.answer.antenna.antique.anxiety.any.apart.apology.appear.apple.approve.april.arch.arctic.area.arena.argue.arm.armed.armor.army.around.arrange.arrest.arrive.arrow.art.artefact.artist.artwork.ask.aspect.assault.asset.assist.assume.asthma.athlete.atom.attack.attend.attitude.attract.auction.audit.august.aunt.author.auto.autumn.average.avocado.avoid.awake.aware.away.awesome.awful.awkward.axis.baby.bachelor.bacon.badge.bag.balance.balcony.ball.bamboo.banana.banner.bar.barely.bargain.barrel.base.basic.basket.battle.beach.bean.beauty.because.become.beef.before.begin.behave.behind.believe.below.belt.bench.benefit.best.betray.better.between.beyond.bicycle.bid.bike.bind.biology.bird.birth.bitter.black.blade.blame.blanket.blast.bleak.bless.blind.blood.blossom.blouse.blue.blur.blush.board.boat.body.boil.bomb.bone.bonus.book.boost.border.boring.borrow.boss.bottom.bounce.box.boy.bracket.brain.brand.brass.brave.bread.breeze.brick.bridge.brief.bright.bring.brisk.broccoli.broken.bronze.broom.brother.brown.brush.bubble.buddy.budget.buffalo.build.bulb.bulk.bullet.bundle.bunker.burden.burger.burst.bus.business.busy.butter.buyer.buzz.cabbage.cabin.cable.cactus.cage.cake.call.calm.camera.camp.can.canal.cancel.candy.cannon.canoe.canvas.canyon.capable.capital.captain.car.carbon.card.cargo.carpet.carry.cart.case.cash.casino.castle.casual.cat.catalog.catch.category.cattle.caught.cause.caution.cave.ceiling.celery.cement.census.century.cereal.certain.chair.chalk.champion.change.chaos.chapter.charge.chase.chat.cheap.check.cheese.chef.cherry.chest.chicken.chief.child.chimney.choice.choose.chronic.chuckle.chunk.churn.cigar.cinnamon.circle.citizen.city.civil.claim.clap.clarify.claw.clay.clean.clerk.clever.click.client.cliff.climb.clinic.clip.clock.clog.close.cloth.cloud.clown.club.clump.cluster.clutch.coach.coast.coconut.code.coffee.coil.coin.collect.color.column.combine.come.comfort.comic.common.company.concert.conduct.confirm.congress.connect.consider.control.convince.cook.cool.copper.copy.coral.core.corn.correct.cost.cotton.couch.country.couple.course.cousin.cover.coyote.crack.cradle.craft.cram.crane.crash.crater.crawl.crazy.cream.credit.creek.crew.cricket.crime.crisp.critic.crop.cross.crouch.crowd.crucial.cruel.cruise.crumble.crunch.crush.cry.crystal.cube.culture.cup.cupboard.curious.current.curtain.curve.cushion.custom.cute.cycle.dad.damage.damp.dance.danger.daring.dash.daughter.dawn.day.deal.debate.debris.decade.december.decide.decline.decorate.decrease.deer.defense.define.defy.degree.delay.deliver.demand.demise.denial.dentist.deny.depart.depend.deposit.depth.deputy.derive.describe.desert.design.desk.despair.destroy.detail.detect.develop.device.devote.diagram.dial.diamond.diary.dice.diesel.diet.differ.digital.dignity.dilemma.dinner.dinosaur.direct.dirt.disagree.discover.disease.dish.dismiss.disorder.display.distance.divert.divide.divorce.dizzy.doctor.document.dog.doll.dolphin.domain.donate.donkey.donor.door.dose.double.dove.draft.dragon.drama.drastic.draw.dream.dress.drift.drill.drink.drip.drive.drop.drum.dry.duck.dumb.dune.during.dust.dutch.duty.dwarf.dynamic.eager.eagle.early.earn.earth.easily.east.easy.echo.ecology.economy.edge.edit.educate.effort.egg.eight.either.elbow.elder.electric.elegant.element.elephant.elevator.elite.else.embark.embody.embrace.emerge.emotion.employ.empower.empty.enable.enact.end.endless.endorse.enemy.energy.enforce.engage.engine.enhance.enjoy.enlist.enough.enrich.enroll.ensure.enter.entire.entry.envelope.episode.equal.equip.era.erase.erode.erosion.error.erupt.escape.essay.essence.estate.eternal.ethics.evidence.evil.evoke.evolve.exact.example.excess.exchange.excite.exclude.excuse.execute.exercise.exhaust.exhibit.exile.exist.exit.exotic.expand.expect.expire.explain.expose.express.extend.extra.eye.eyebrow.fabric.face.faculty.fade.faint.faith.fall.false.fame.family.famous.fan.fancy.fantasy.farm.fashion.fat.fatal.father.fatigue.fault.favorite.feature.february.federal.fee.feed.feel.female.fence.festival.fetch.fever.few.fiber.fiction.field.figure.file.film.filter.final.find.fine.finger.finish.fire.firm.first.fiscal.fish.fit.fitness.fix.flag.flame.flash.flat.flavor.flee.flight.flip.float.flock.floor.flower.fluid.flush.fly.foam.focus.fog.foil.fold.follow.food.foot.force.forest.forget.fork.fortune.forum.forward.fossil.foster.found.fox.fragile.frame.frequent.fresh.friend.fringe.frog.front.frost.frown.frozen.fruit.fuel.fun.funny.furnace.fury.future.gadget.gain.galaxy.gallery.game.gap.garage.garbage.garden.garlic.garment.gas.gasp.gate.gather.gauge.gaze.general.genius.genre.gentle.genuine.gesture.ghost.giant.gift.giggle.ginger.giraffe.girl.give.glad.glance.glare.glass.glide.glimpse.globe.gloom.glory.glove.glow.glue.goat.goddess.gold.good.goose.gorilla.gospel.gossip.govern.gown.grab.grace.grain.grant.grape.grass.gravity.great.green.grid.grief.grit.grocery.group.grow.grunt.guard.guess.guide.guilt.guitar.gun.gym.habit.hair.half.hammer.hamster.hand.happy.harbor.hard.harsh.harvest.hat.have.hawk.hazard.head.health.heart.heavy.hedgehog.height.hello.helmet.help.hen.hero.hidden.high.hill.hint.hip.hire.history.hobby.hockey.hold.hole.holiday.hollow.home.honey.hood.hope.horn.horror.horse.hospital.host.hotel.hour.hover.hub.huge.human.humble.humor.hundred.hungry.hunt.hurdle.hurry.hurt.husband.hybrid.ice.icon.idea.identify.idle.ignore.ill.illegal.illness.image.imitate.immense.immune.impact.impose.improve.impulse.inch.include.income.increase.index.indicate.indoor.industry.infant.inflict.inform.inhale.inherit.initial.inject.injury.inmate.inner.innocent.input.inquiry.insane.insect.inside.inspire.install.intact.interest.into.invest.invite.involve.iron.island.isolate.issue.item.ivory.jacket.jaguar.jar.jazz.jealous.jeans.jelly.jewel.job.join.joke.journey.joy.judge.juice.jump.jungle.junior.junk.just.kangaroo.keen.keep.ketchup.key.kick.kid.kidney.kind.kingdom.kiss.kit.kitchen.kite.kitten.kiwi.knee.knife.knock.know.lab.label.labor.ladder.lady.lake.lamp.language.laptop.large.later.latin.laugh.laundry.lava.law.lawn.lawsuit.layer.lazy.leader.leaf.learn.leave.lecture.left.leg.legal.legend.leisure.lemon.lend.length.lens.leopard.lesson.letter.level.liar.liberty.library.license.life.lift.light.like.limb.limit.link.lion.liquid.list.little.live.lizard.load.loan.lobster.local.lock.logic.lonely.long.loop.lottery.loud.lounge.love.loyal.lucky.luggage.lumber.lunar.lunch.luxury.lyrics.machine.mad.magic.magnet.maid.mail.main.major.make.mammal.man.manage.mandate.mango.mansion.manual.maple.marble.march.margin.marine.market.marriage.mask.mass.master.match.material.math.matrix.matter.maximum.maze.meadow.mean.measure.meat.mechanic.medal.media.melody.melt.member.memory.mention.menu.mercy.merge.merit.merry.mesh.message.metal.method.middle.midnight.milk.million.mimic.mind.minimum.minor.minute.miracle.mirror.misery.miss.mistake.mix.mixed.mixture.mobile.model.modify.mom.moment.monitor.monkey.monster.month.moon.moral.more.morning.mosquito.mother.motion.motor.mountain.mouse.move.movie.much.muffin.mule.multiply.muscle.museum.mushroom.music.must.mutual.myself.mystery.myth.naive.name.napkin.narrow.nasty.nation.nature.near.neck.need.negative.neglect.neither.nephew.nerve.nest.net.network.neutral.never.news.next.nice.night.noble.noise.nominee.noodle.normal.north.nose.notable.note.nothing.notice.novel.now.nuclear.number.nurse.nut.oak.obey.object.oblige.obscure.observe.obtain.obvious.occur.ocean.october.odor.off.offer.office.often.oil.okay.old.olive.olympic.omit.once.one.onion.online.only.open.opera.opinion.oppose.option.orange.orbit.orchard.order.ordinary.organ.orient.original.orphan.ostrich.other.outdoor.outer.output.outside.oval.oven.over.own.owner.oxygen.oyster.ozone.pact.paddle.page.pair.palace.palm.panda.panel.panic.panther.paper.parade.parent.park.parrot.party.pass.patch.path.patient.patrol.pattern.pause.pave.payment.peace.peanut.pear.peasant.pelican.pen.penalty.pencil.people.pepper.perfect.permit.person.pet.phone.photo.phrase.physical.piano.picnic.picture.piece.pig.pigeon.pill.pilot.pink.pioneer.pipe.pistol.pitch.pizza.place.planet.plastic.plate.play.please.pledge.pluck.plug.plunge.poem.poet.point.polar.pole.police.pond.pony.pool.popular.portion.position.possible.post.potato.pottery.poverty.powder.power.practice.praise.predict.prefer.prepare.present.pretty.prevent.price.pride.primary.print.priority.prison.private.prize.problem.process.produce.profit.program.project.promote.proof.property.prosper.protect.proud.provide.public.pudding.pull.pulp.pulse.pumpkin.punch.pupil.puppy.purchase.purity.purpose.purse.push.put.puzzle.pyramid.quality.quantum.quarter.question.quick.quit.quiz.quote.rabbit.raccoon.race.rack.radar.radio.rail.rain.raise.rally.ramp.ranch.random.range.rapid.rare.rate.rather.raven.raw.razor.ready.real.reason.rebel.rebuild.recall.receive.recipe.record.recycle.reduce.reflect.reform.refuse.region.regret.regular.reject.relax.release.relief.rely.remain.remember.remind.remove.render.renew.rent.reopen.repair.repeat.replace.report.require.rescue.resemble.resist.resource.response.result.retire.retreat.return.reunion.reveal.review.reward.rhythm.rib.ribbon.rice.rich.ride.ridge.rifle.right.rigid.ring.riot.ripple.risk.ritual.rival.river.road.roast.robot.robust.rocket.romance.roof.rookie.room.rose.rotate.rough.round.route.royal.rubber.rude.rug.rule.run.runway.rural.sad.saddle.sadness.safe.sail.salad.salmon.salon.salt.salute.same.sample.sand.satisfy.satoshi.sauce.sausage.save.say.scale.scan.scare.scatter.scene.scheme.school.science.scissors.scorpion.scout.scrap.screen.script.scrub.sea.search.season.seat.second.secret.section.security.seed.seek.segment.select.sell.seminar.senior.sense.sentence.series.service.session.settle.setup.seven.shadow.shaft.shallow.share.shed.shell.sheriff.shield.shift.shine.ship.shiver.shock.shoe.shoot.shop.short.shoulder.shove.shrimp.shrug.shuffle.shy.sibling.sick.side.siege.sight.sign.silent.silk.silly.silver.similar.simple.since.sing.siren.sister.situate.six.size.skate.sketch.ski.skill.skin.skirt.skull.slab.slam.sleep.slender.slice.slide.slight.slim.slogan.slot.slow.slush.small.smart.smile.smoke.smooth.snack.snake.snap.sniff.snow.soap.soccer.social.sock.soda.soft.solar.soldier.solid.solution.solve.someone.song.soon.sorry.sort.soul.sound.soup.source.south.space.spare.spatial.spawn.speak.special.speed.spell.spend.sphere.spice.spider.spike.spin.spirit.split.spoil.sponsor.spoon.sport.spot.spray.spread.spring.spy.square.squeeze.squirrel.stable.stadium.staff.stage.stairs.stamp.stand.start.state.stay.steak.steel.stem.step.stereo.stick.still.sting.stock.stomach.stone.stool.story.stove.strategy.street.strike.strong.struggle.student.stuff.stumble.style.subject.submit.subway.success.such.sudden.suffer.sugar.suggest.suit.summer.sun.sunny.sunset.super.supply.supreme.sure.surface.surge.surprise.surround.survey.suspect.sustain.swallow.swamp.swap.swarm.swear.sweet.swift.swim.swing.switch.sword.symbol.symptom.syrup.system.table.tackle.tag.tail.talent.talk.tank.tape.target.task.taste.tattoo.taxi.teach.team.tell.ten.tenant.tennis.tent.term.test.text.thank.that.theme.then.theory.there.they.thing.this.thought.three.thrive.throw.thumb.thunder.ticket.tide.tiger.tilt.timber.time.tiny.tip.tired.tissue.title.toast.tobacco.today.toddler.toe.together.toilet.token.tomato.tomorrow.tone.tongue.tonight.tool.tooth.top.topic.topple.torch.tornado.tortoise.toss.total.tourist.toward.tower.town.toy.track.trade.traffic.tragic.train.transfer.trap.trash.travel.tray.treat.tree.trend.trial.tribe.trick.trigger.trim.trip.trophy.trouble.truck.true.truly.trumpet.trust.truth.try.tube.tuition.tumble.tuna.tunnel.turkey.turn.turtle.twelve.twenty.twice.twin.twist.two.type.typical.ugly.umbrella.unable.unaware.uncle.uncover.under.undo.unfair.unfold.unhappy.uniform.unique.unit.universe.unknown.unlock.until.unusual.unveil.update.upgrade.uphold.upon.upper.upset.urban.urge.usage.use.used.useful.useless.usual.utility.vacant.vacuum.vague.valid.valley.valve.van.vanish.vapor.various.vast.vault.vehicle.velvet.vendor.venture.venue.verb.verify.version.very.vessel.veteran.viable.vibrant.vicious.victory.video.view.village.vintage.violin.virtual.virus.visa.visit.visual.vital.vivid.vocal.voice.void.volcano.volume.vote.voyage.wage.wagon.wait.walk.wall.walnut.want.warfare.warm.warrior.wash.wasp.waste.water.wave.way.wealth.weapon.wear.weasel.weather.web.wedding.weekend.weird.welcome.west.wet.whale.what.wheat.wheel.when.where.whip.whisper.wide.width.wife.wild.will.win.window.wine.wing.wink.winner.winter.wire.wisdom.wise.wish.witness.wolf.woman.wonder.wood.wool.word.work.world.worry.worth.wrap.wreck.wrestle.wrist.write.wrong.yard.year.yellow.you.young.youth.zebra.zero.zone.zoo`.split(`.`),space:` `};var Eo=class e{mnemonic;seed;Wordlist;constructor(e,t,n=To){this.mnemonic=e??``,this.seed=t??[],this.Wordlist=n}toBinary(){let e=new L;if(this.mnemonic!==``){let t=F(this.mnemonic,`utf8`);e.writeVarIntNum(t.length),e.write(t)}else e.writeVarIntNum(0);return this.seed.length>0?(e.writeVarIntNum(this.seed.length),e.write(this.seed)):e.writeVarIntNum(0),e.toArray()}fromBinary(e){let t=new Kr(e),n=t.readVarIntNum();n>0&&(this.mnemonic=zr(t.read(n),`utf8`));let r=t.readVarIntNum();return r>0&&(this.seed=t.read(r)),this}fromRandom(e){if((e==null||isNaN(e)||e===0)&&(e=128),e%32!=0)throw Error(`bits must be multiple of 32`);if(e<128)throw Error(`bits must be at least 128`);let t=Ri(e/8);return this.entropy2Mnemonic(t),this.mnemonic2Seed(),this}static fromRandom(e){return new this().fromRandom(e)}fromEntropy(e){return this.entropy2Mnemonic(e),this}static fromEntropy(e){return new this().fromEntropy(e)}fromString(e){return this.mnemonic=e,this}static fromString(e){return new this().fromString(e)}toString(){return this.mnemonic}toSeed(e){return this.mnemonic2Seed(e),this.seed}entropy2Mnemonic(e){if(e.length<128/8)throw Error(`Entropy is less than 128 bits. It must be 128 bits or more.`);let t=Mn(e),n=``,r=e.length*8;for(let t=0;t<e.length;t++)n+=(`00000000`+e[t].toString(2)).slice(-8);let i=t[0].toString(2);if(i=(`00000000`+i).slice(-8).slice(0,r/32),n+=i,n.length%11!=0)throw Error(`internal error - entropy not an even multiple of 11 bits - `+n.length.toString());let a=``;for(let e=0;e<n.length/11;e++){a!==``&&(a+=this.Wordlist.space);let t=parseInt(n.slice(e*11,(e+1)*11),2);a+=this.Wordlist.value[t]}return this.mnemonic=a,this}check(){let e=this.mnemonic.split(this.Wordlist.space),t=``;for(let n=0;n<e.length;n++){let r=this.Wordlist.value.indexOf(e[n]);if(r<0)return!1;t+=(`00000000000`+r.toString(2)).slice(-11)}if(t.length%11!=0)throw Error(`internal error - entropy not an even multiple of 11 bits - `+t.length.toString());let n=t.length/33,r=t.slice(-n),i=t.slice(0,t.length-n),a=[];for(let e=0;e<i.length/8;e++)a.push(parseInt(t.slice(e*8,(e+1)*8),2));let o=Mn(a.slice(0,i.length/8))[0].toString(2);return o=(`00000000`+o).slice(-8).slice(0,n),o===r}mnemonic2Seed(e=``){let t=this.mnemonic;if(!this.check())throw Error(`Mnemonic does not pass the check - was the mnemonic typed incorrectly? Are there extra spaces?`);if(typeof e!=`string`)throw Error(`passphrase must be a string or undefined`);t=t.normalize(`NFKD`),e=e.normalize(`NFKD`);let n=F(t,`utf8`),r=[...F(`mnemonic`,`utf8`),...F(e,`utf8`)];return this.seed=Nr(n,r,2048,64,`sha512`),this}isValid(e=``){let t;try{this.mnemonic2Seed(e),t=!0}catch{t=!1}return t}static isValid(t,n=``){return new e(t).isValid(n)}};function Do(e){this._tables[0][0][0]===0&&this._precompute();let t,n,r,i=this._tables[0][4],a=this._tables[1],o=e.length,s=1;if(o!==4&&o!==6&&o!==8)throw Error(`invalid aes key size`);this._key=[n=e.slice(0),r=[]];let c;for(c=o;c<4*o+28;c++)t=n[c-1],(c%o===0||o===8&&c%o===4)&&(t=i[t>>>24]<<24^i[t>>16&255]<<16^i[t>>8&255]<<8^i[t&255],c%o===0&&(t=t<<8^t>>>24^s<<24,s=s<<1^(s>>7)*283)),n[c]=n[c-o]^t;for(let e=0;c>0;e++,c--)t=n[e&3?c:c-4],c<=4||e<4?r[e]=t:r[e]=a[0][i[t>>>24]]^a[1][i[t>>16&255]]^a[2][i[t>>8&255]]^a[3][i[t&255]]}Do.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]],_precompute:function(){let e=this._tables[0],t=this._tables[1],n=e[4],r=t[4],i,a,o,s=new Uint8Array(256),c=new Uint8Array(256),l,u,d,f,p,m;for(i=0;i<256;i++)c[(s[i]=i<<1^(i>>7)*283)^i]=i;for(a=o=0;n[a]===0;a^=l===0?1:l,o=c[o]===0?1:c[o])for(f=o^o<<1^o<<2^o<<3^o<<4,f=f>>8^f&255^99,n[a]=f,r[f]=a,d=s[u=s[l=s[a]]],m=d*16843009^u*65537^l*257^a*16843008,p=s[f]*257^f*16843008,i=0;i<4;i++)e[i][a]=p=p<<24^p>>>8,t[i][f]=m=m<<24^m>>>8},_crypt:function(e,t){if(e.length!==4)throw Error(`invalid aes block size`);let n=this._key[t],r=e[0]^n[0],i=e[t===1?3:1]^n[1],a=e[2]^n[2],o=e[t===1?1:3]^n[3],s,c,l,u=n.length/4-2,d,f=4,p=new Uint32Array(4),m=this._tables[t],h=m[0],g=m[1],_=m[2],v=m[3],y=m[4];for(d=0;d<u;d++)s=h[r>>>24]^g[i>>16&255]^_[a>>8&255]^v[o&255]^n[f],c=h[i>>>24]^g[a>>16&255]^_[o>>8&255]^v[r&255]^n[f+1],l=h[a>>>24]^g[o>>16&255]^_[r>>8&255]^v[i&255]^n[f+2],o=h[o>>>24]^g[r>>16&255]^_[i>>8&255]^v[a&255]^n[f+3],f+=4,r=s,i=c,a=l;for(d=0;d<4;d++)p[t===1?3&-d:d]=y[r>>>24]<<24^y[i>>16&255]<<16^y[a>>8&255]<<8^y[o&255]^n[f++],s=r,r=i,i=a,a=o,o=s;return p}};var Oo=class e{static encrypt(t,n){let r=e.buf2Words(n),i=e.buf2Words(t),a=new Do(r).encrypt(i);return e.words2Buf(a)}static decrypt(t,n){let r=e.buf2Words(t),i=e.buf2Words(n),a=new Do(i).decrypt(r);return e.words2Buf(a)}static buf2Words(e){if(e.length%4!=0)throw Error(`buf length must be a multiple of 4`);let t=[];for(let n=0;n<e.length/4;n++){let r=e[n*4]*16777216+(e[n*4+1]<<16|e[n*4+2]<<8|e[n*4+3]);t.push(r)}return t}static words2Buf(e){let t=Array(e.length*4);for(let n=0;n<e.length;n++){let r=e[n];t[n*4]=r>>>24&255,t[n*4+1]=r>>>16&255,t[n*4+2]=r>>>8&255,t[n*4+3]=r&255}return t}},ko=class e{static buf2BlocksBuf(t,n){let r=n/8,i=[];for(let a=0;a<=t.length/r;a++){let o=t.slice(a*r,a*r+r);o.length<n&&(o=e.pkcs7Pad(o,n)),i.push(o)}return i}static blockBufs2Buf(t){let n=t[t.length-1];return n=e.pkcs7Unpad(n),t[t.length-1]=n,t.flat()}static encrypt(t,n,r,i){let a=n.length*8,o=e.buf2BlocksBuf(t,a);return e.encryptBlocks(o,n,r,i).flat()}static decrypt(t,n,r,i){let a=n.length,o=[];for(let e=0;e<t.length/a;e++)o.push(t.slice(e*a,e*a+a));let s=e.decryptBlocks(o,n,r,i);return e.blockBufs2Buf(s)}static encryptBlock(t,n,r,i){let a=e.xorBufs(t,n);return r.encrypt(a,i)}static decryptBlock(t,n,r,i){let a=r.decrypt(t,i);return e.xorBufs(a,n)}static encryptBlocks(t,n,r,i){let a=[];for(let o=0;o<t.length;o++){let s=t[o],c=e.encryptBlock(s,n,r,i);a.push(c),n=c}return a}static decryptBlocks(t,n,r,i){let a=[];for(let o=0;o<t.length;o++){let s=t[o],c=e.decryptBlock(s,n,r,i);a.push(c),n=s}return a}static pkcs7Pad(e,t){let n=t/8-e.length,r=Array(n);return r.fill(n),[...e,...r]}static pkcs7Unpad(e){let t=e[e.length-1],n=e.slice(e.length-t,e.length),r=Array(t);if(r.fill(t),P(n)!==P(r))throw Error(`invalid padding`);return e.slice(0,e.length-t)}static xorBufs(e,t){if(e.length!==t.length)throw Error(`bufs must have the same length`);let n=Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}},Ao=class{static encrypt(e,t,n,r=!0){n??=Ri(128/8);let i=ko.encrypt(e,n,Oo,t);return r?[...n,...i]:[...i]}static decrypt(e,t,n){if(n==null){n=e.slice(0,128/8);let r=e.slice(128/8);return ko.decrypt(r,n,Oo,t)}else{let r=e;return ko.decrypt(r,n,Oo,t)}}},jo=class e{static ivkEkM(e,t){let n=e,r=t.mul(n),i=new Fi(r.x,r.y).encode(!0),a=Nn(i);return{iv:a.slice(0,16),kE:a.slice(16,32),kM:a.slice(32,64)}}static electrumEncrypt(t,n,r,i=!1){let a=null;r??=Hi.fromRandom(),i||(a=r.toPublicKey().encode(!0));let{iv:o,kE:s,kM:c}=e.ivkEkM(r,n),l=Ao.encrypt(t,s,o,!1),u=F(`BIE1`,`utf8`),d;d=a!=null&&a.length>0?[...u,...a,...l]:[...u,...l];let f=In(c,d);return[...d,...f]}static electrumDecrypt(t,n,r){let i=t.slice(0,4);if(zr(i,`utf8`)!==`BIE1`)throw Error(`Invalid Magic`);let a=4,o=null;if(t.length-a-32>=33){let e=t[a];e===2||e===3?(o=t.slice(a,a+33),a+=33):e===4&&(o=t.slice(a,a+65),a+=65)}if(o!==null)r??=Fi.fromString(P(o));else if(r==null)throw Error(`Sender public key is required`);let{iv:s,kE:c,kM:l}=e.ivkEkM(n,r),u=t.slice(a,t.length-32),d=t.slice(t.length-32,t.length),f=In(l,t.slice(0,t.length-32));if(P(d)!==P(f))throw Error(`Invalid checksum`);return Ao.decrypt(u,c,s)}static bitcoreEncrypt(e,t,n,r){n??=Hi.fromRandom(),r??=Ri(16);let i=n,a=n.toPublicKey().encode(!0),o=t.mul(i).getX().toArray(`be`,32),s=Nn(o),c=s.slice(0,32),l=s.slice(32,64),u=Ao.encrypt(e,c,r),d=In(l,[...u]);return[...a,...u,...d]}static bitcoreDecrypt(e,t){let n=t,r=Fi.fromString(P(e.slice(0,33))).mul(n);if(r.eq(new Si(0,0)))throw Error(`P equals 0`);let i=r.getX().toArray(`be`,32),a=Nn(i),o=a.slice(0,32),s=a.slice(32,64),c=e.slice(33,e.length-32),l=e.slice(e.length-32,e.length),u=In(s,c);if(P(l)!==P(u))throw Error(`Invalid checksum`);return[...Ao.decrypt(c,o)]}};function Mo(e,t){let n=new eo(0,[],[],0);return n.outputs=Array(e.vout+1).fill(null),n.outputs[e.vout]={satoshis:e.satoshis,lockingScript:_a.fromHex(e.script)},{sourceTransaction:n,sourceTXID:e.txid,sourceOutputIndex:e.vout,unlockingScriptTemplate:t,sequence:4294967295}}var No=class{static generate(e,t){let n=this.withDefaultOptions(t),r=this.getCounter(n.timestamp,n.period);return Po(e,r,n)}static validate(e,t,n){let r=this.withDefaultValidateOptions(n);if(t=t.trim(),t.length!==r.digits)return!1;let i=this.getCounter(r.timestamp,r.period),a=[i];for(let e=1;e<=r.skew;e++)a.push(i+e),a.push(i-e);for(let n of a)if(t===Po(e,n,r))return!0;return!1}static getCounter(e,t){let n=Math.floor(e/1e3);return Math.floor(n/t)}static withDefaultOptions(e){return{digits:2,algorithm:`SHA-1`,period:30,timestamp:Date.now(),...e}}static withDefaultValidateOptions(e){return{skew:1,...this.withDefaultOptions(e)}}};function Po(e,t,n){let r=new N(t).toArray(`be`,8),i=Fo(e,r,n.algorithm).digest(),a=i[i.length-1]&15,o=i.slice(a,a+4);return(new N(o).toNumber()&2147483647).toString().slice(-n.digits)}function Fo(e,t,n){switch(n){case`SHA-1`:return new On(e).update(t);case`SHA-256`:return new Dn(e).update(t);case`SHA-512`:return new kn(e).update(t);default:throw Error(`unsupported HMAC algorithm`)}}var Io;(function(e){e[e.Silent=0]=`Silent`,e[e.App=1]=`App`,e[e.Counterparty=2]=`Counterparty`})(Io||={});var Lo=class{cacheSharedSecret;retrieveCachedSharedSecret;rootKey;identityKey;anyone;constructor(e,t,n){this.cacheSharedSecret=t,this.retrieveCachedSharedSecret=n,this.anyone=new Hi(1).toPublicKey(),e===`anyone`?this.rootKey=new Hi(1):this.rootKey=e,this.identityKey=this.rootKey.toPublicKey().toString()}derivePublicKey(e,t,n,r=!1){return n=this.normalizeCounterparty(n),r?this.rootKey.deriveChild(n,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret).toPublicKey():n.deriveChild(this.rootKey,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}derivePrivateKey(e,t,n){return n=this.normalizeCounterparty(n),this.rootKey.deriveChild(n,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}deriveSymmetricKey(e,t,n){n=n===`anyone`?this.anyone:this.normalizeCounterparty(n);let r=this.derivePublicKey(e,t,n),i=this.derivePrivateKey(e,t,n);return new fa(i.deriveSharedSecret(r)?.x?.toArray()??[])}revealCounterpartySecret(e){if(e===`self`)throw Error(`Counterparty secrets cannot be revealed for counterparty=self.`);e=this.normalizeCounterparty(e);let t=this.rootKey.toPublicKey(),n=this.rootKey.deriveChild(t,`test`).toHex(),r=this.rootKey.deriveChild(e,`test`).toHex();if(n===r)throw Error(`Counterparty secrets cannot be revealed for counterparty=self.`);return this.rootKey.deriveSharedSecret(e).encode(!0)}revealSpecificSecret(e,t,n){e=this.normalizeCounterparty(e);let r=this.rootKey.deriveSharedSecret(e),i=F(this.computeInvoiceNumber(t,n),`utf8`);return In(r.encode(!0),i)}normalizeCounterparty(e){if(e==null)throw Error(`counterparty must be self, anyone or a public key!`);return e===`self`?this.rootKey.toPublicKey():e===`anyone`?new Hi(1).toPublicKey():typeof e==`string`?Fi.fromString(e):e}computeInvoiceNumber(e,t){let n=e[0];if(!Number.isInteger(n)||n<0||n>2)throw Error(`Protocol security level must be 0, 1, or 2`);let r=e[1].toLowerCase().trim();if(t.length>800)throw Error(`Key IDs must be 800 characters or less`);if(t.length<1)throw Error(`Key IDs must be 1 character or more`);if(r.length>400)if(r.startsWith(`specific linkage revelation `)){if(r.length>430)throw Error(`Specific linkage revelation protocol names must be 430 characters or less`)}else throw Error(`Protocol names must be 400 characters or less`);if(r.length<5)throw Error(`Protocol names must be 5 characters or more`);if(r.includes(`  `))throw Error(`Protocol names cannot contain multiple consecutive spaces ("  ")`);if(!/^[a-z0-9 ]+$/g.test(r))throw Error(`Protocol names can only contain letters, numbers and spaces`);if(r.endsWith(` protocol`))throw Error(`No need to end your protocol name with " protocol"`);return`${n}-${r}-${t}`}},Ro=class{keyDeriver;cache;maxCacheSize;rootKey;identityKey;constructor(e,t){e===`anyone`?this.rootKey=new Hi(1):this.rootKey=e,this.keyDeriver=new Lo(this.rootKey,(e,t,n)=>{this.cacheSet(`${e.toString()}-${t.toString()}`,n)},(e,t)=>this.cacheGet(`${e.toString()}-${t.toString()}`)),this.identityKey=this.rootKey.toPublicKey().toString(),this.cache=new Map;let n=t?.maxCacheSize;this.maxCacheSize=n!=null&&!isNaN(n)&&n>0?n:1e3}derivePublicKey(e,t,n,r=!1){let i=this.generateCacheKey(`derivePublicKey`,e,t,n,r);if(this.cache.has(i)){let e=this.cacheGet(i);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let a=this.keyDeriver.derivePublicKey(e,t,n,r);return this.cacheSet(i,a),a}}derivePrivateKey(e,t,n){let r=this.generateCacheKey(`derivePrivateKey`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.derivePrivateKey(e,t,n);return this.cacheSet(r,i),i}}deriveSymmetricKey(e,t,n){let r=this.generateCacheKey(`deriveSymmetricKey`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.deriveSymmetricKey(e,t,n);return this.cacheSet(r,i),i}}revealCounterpartySecret(e){let t=this.generateCacheKey(`revealCounterpartySecret`,e);if(this.cache.has(t)){let e=this.cacheGet(t);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let n=this.keyDeriver.revealCounterpartySecret(e);return this.cacheSet(t,n),n}}revealSpecificSecret(e,t,n){let r=this.generateCacheKey(`revealSpecificSecret`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.revealSpecificSecret(e,t,n);return this.cacheSet(r,i),i}}generateCacheKey(e,...t){let n=t.map(e=>this.serializeArgument(e)).join(`|`);return`${e}|${n}`}serializeArgument(e){return e instanceof Fi||e instanceof Hi?e.toString():Array.isArray(e)?e.map(e=>this.serializeArgument(e)).join(`,`):typeof e==`object`&&e?JSON.stringify(e):String(e)}cacheGet(e){let t=this.cache.get(e);return this.cache.delete(e),t!==void 0&&this.cache.set(e,t),t}cacheSet(e,t){if(this.cache.size>=this.maxCacheSize){let e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}},zo=class{keyDeriver;constructor(e){typeof e.identityKey!=`string`&&(e=new Ro(e)),this.keyDeriver=e}async getPublicKey(e){if(e.identityKey){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}else{if(e.protocolID==null||e.keyID==null||e.keyID===``)throw Error(`protocolID and keyID are required if identityKey is false or undefined.`);return{publicKey:(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePublicKey(e.protocolID,e.keyID,e.counterparty??`self`,e.forSelf).toString()}}}async revealCounterpartyKeyLinkage(e){let{publicKey:t}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let n=this.keyDeriver.revealCounterpartySecret(e.counterparty),r=new ma().generateProof(this.keyDeriver.rootKey,this.keyDeriver.rootKey.toPublicKey(),Fi.fromString(e.counterparty),Si.fromDER(n)),i=[...r.R.encode(!0),...r.SPrime.encode(!0),...r.z.toArray()],a=new Date().toISOString(),{ciphertext:o}=await this.encrypt({plaintext:n,protocolID:[2,`counterparty linkage revelation`],keyID:a,counterparty:e.verifier}),{ciphertext:s}=await this.encrypt({plaintext:i,protocolID:[2,`counterparty linkage revelation`],keyID:a,counterparty:e.verifier});return{prover:t,verifier:e.verifier,counterparty:e.counterparty,revelationTime:a,encryptedLinkage:o,encryptedLinkageProof:s}}async revealSpecificKeyLinkage(e){let{publicKey:t}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let n=this.keyDeriver.revealSpecificSecret(e.counterparty,e.protocolID,e.keyID),{ciphertext:r}=await this.encrypt({plaintext:n,protocolID:[2,`specific linkage revelation ${e.protocolID[0]} ${e.protocolID[1]}`],keyID:e.keyID,counterparty:e.verifier}),{ciphertext:i}=await this.encrypt({plaintext:[0],protocolID:[2,`specific linkage revelation ${e.protocolID[0]} ${e.protocolID[1]}`],keyID:e.keyID,counterparty:e.verifier});return{prover:t,verifier:e.verifier,counterparty:e.counterparty,protocolID:e.protocolID,keyID:e.keyID,encryptedLinkage:r,encryptedLinkageProof:i,proofType:0}}async encrypt(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{ciphertext:this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`).encrypt(e.plaintext)}}async decrypt(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{plaintext:this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`).decrypt(e.ciphertext)}}async createHmac(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let t=this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`);return{hmac:In(t.toArray(),e.data)}}async verifyHmac(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let t=this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`),n=In(t.toArray(),e.data).toString()===e.hmac.toString();if(!n){let e=Error(`HMAC is not valid`);throw e.code=`ERR_INVALID_HMAC`,e}return{valid:n}}async createSignature(e){if(e.hashToDirectlySign==null&&e.data==null)throw Error(`args.data or args.hashToDirectlySign must be valid`);let t=e.hashToDirectlySign??Mn(e.data??[]),n=(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePrivateKey(e.protocolID,e.keyID,e.counterparty??`anyone`);return{signature:Ni(new N(t),n,!0).toDER()}}async verifySignature(e){if(e.hashToDirectlyVerify==null&&e.data==null)throw Error(`args.data or args.hashToDirectlyVerify must be valid`);let t=e.hashToDirectlyVerify??Mn(e.data??[]),n=(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePublicKey(e.protocolID,e.keyID,e.counterparty??`self`,e.forSelf),r=Pi(new N(t),Ti.fromDER(e.signature),n);if(!r){let e=Error(`Signature is not valid`);throw e.code=`ERR_INVALID_SIGNATURE`,e}return{valid:r}}},Bo=class{CWI;constructor(){if(typeof window!=`object`)throw Error(`The window.CWI substrate requires a global window object.`);if(typeof window.CWI!=`object`)throw Error(`The window.CWI interface does not appear to be bound to the window object.`);this.CWI=window.CWI}async createAction(e,t){return await this.CWI.createAction(e,t)}async signAction(e,t){return await this.CWI.signAction(e,t)}async abortAction(e,t){return await this.CWI.abortAction(e,t)}async listActions(e,t){return await this.CWI.listActions(e,t)}async internalizeAction(e,t){return await this.CWI.internalizeAction(e,t)}async listOutputs(e,t){return await this.CWI.listOutputs(e,t)}async relinquishOutput(e,t){return await this.CWI.relinquishOutput(e,t)}async getPublicKey(e,t){return await this.CWI.getPublicKey(e,t)}async revealCounterpartyKeyLinkage(e,t){return await this.CWI.revealCounterpartyKeyLinkage(e,t)}async revealSpecificKeyLinkage(e,t){return await this.CWI.revealSpecificKeyLinkage(e,t)}async encrypt(e,t){return await this.CWI.encrypt(e,t)}async decrypt(e,t){return await this.CWI.decrypt(e,t)}async createHmac(e,t){return await this.CWI.createHmac(e,t)}async verifyHmac(e,t){return await this.CWI.verifyHmac(e,t)}async createSignature(e,t){return await this.CWI.createSignature(e,t)}async verifySignature(e,t){return await this.CWI.verifySignature(e,t)}async acquireCertificate(e,t){return await this.CWI.acquireCertificate(e,t)}async listCertificates(e,t){return await this.CWI.listCertificates(e,t)}async proveCertificate(e,t){return await this.CWI.proveCertificate(e,t)}async relinquishCertificate(e,t){return await this.CWI.relinquishCertificate(e,t)}async discoverByIdentityKey(e,t){return await this.CWI.discoverByIdentityKey(e,t)}async discoverByAttributes(e,t){return await this.CWI.discoverByAttributes(e,t)}async isAuthenticated(e,t){return await this.CWI.isAuthenticated(e,t)}async waitForAuthentication(e,t){return await this.CWI.waitForAuthentication(e,t)}async getHeight(e,t){return await this.CWI.getHeight(e,t)}async getHeaderForHeight(e,t){return await this.CWI.getHeaderForHeight(e,t)}async getNetwork(e,t){return await this.CWI.getNetwork(e,t)}async getVersion(e,t){return await this.CWI.getVersion(e,t)}},Vo=class extends Error{code;isError=!0;constructor(e,t=1,n){super(e),this.code=t,this.name=this.constructor.name,n!=null&&n!==``?this.stack=n:Error.captureStackTrace(this,this.constructor)}},Ho;(function(e){e[e.unknownError=1]=`unknownError`,e[e.unsupportedAction=2]=`unsupportedAction`,e[e.invalidHmac=3]=`invalidHmac`,e[e.invalidSignature=4]=`invalidSignature`,e[e.reviewActions=5]=`reviewActions`})(Ho||={});var Uo=Vo,Wo=class{domain;constructor(e=`*`){if(typeof window!=`object`)throw Error(`The XDM substrate requires a global window object.`);if(typeof window.postMessage!=`function`)throw Error(`The window object does not seem to support postMessage calls.`);this.domain=e}async invoke(e,t){return await new Promise((n,r)=>{let i=Br(Ri(12)),a=e=>{if(!(e.data.type!==`CWI`||!e.isTrusted||e.data.id!==i||e.data.isInvocation===!0))if(typeof window.removeEventListener==`function`&&window.removeEventListener(`message`,a),e.data.status===`error`){let t=new Vo(e.data.description,e.data.code);r(t)}else n(e.data.result)};window.addEventListener(`message`,a),window.parent.postMessage({type:`CWI`,isInvocation:!0,id:i,call:e,args:t},this.domain)})}async createAction(e){return await this.invoke(`createAction`,e)}async signAction(e){return await this.invoke(`signAction`,e)}async abortAction(e){return await this.invoke(`abortAction`,e)}async listActions(e){return await this.invoke(`listActions`,e)}async internalizeAction(e){return await this.invoke(`internalizeAction`,e)}async listOutputs(e){return await this.invoke(`listOutputs`,e)}async relinquishOutput(e){return await this.invoke(`relinquishOutput`,e)}async getPublicKey(e){return await this.invoke(`getPublicKey`,e)}async revealCounterpartyKeyLinkage(e){return await this.invoke(`revealCounterpartyKeyLinkage`,e)}async revealSpecificKeyLinkage(e){return await this.invoke(`revealSpecificKeyLinkage`,e)}async encrypt(e){return await this.invoke(`encrypt`,e)}async decrypt(e){return await this.invoke(`decrypt`,e)}async createHmac(e){return await this.invoke(`createHmac`,e)}async verifyHmac(e){return await this.invoke(`verifyHmac`,e)}async createSignature(e){return await this.invoke(`createSignature`,e)}async verifySignature(e){return await this.invoke(`verifySignature`,e)}async acquireCertificate(e){return await this.invoke(`acquireCertificate`,e)}async listCertificates(e){return await this.invoke(`listCertificates`,e)}async proveCertificate(e){return await this.invoke(`proveCertificate`,e)}async relinquishCertificate(e){return await this.invoke(`relinquishCertificate`,e)}async discoverByIdentityKey(e){return await this.invoke(`discoverByIdentityKey`,e)}async discoverByAttributes(e){return await this.invoke(`discoverByAttributes`,e)}async isAuthenticated(e){return await this.invoke(`isAuthenticated`,e)}async waitForAuthentication(e){return await this.invoke(`waitForAuthentication`,e)}async getHeight(e){return await this.invoke(`getHeight`,e)}async getHeaderForHeight(e){return await this.invoke(`getHeaderForHeight`,e)}async getNetwork(e){return await this.invoke(`getNetwork`,e)}async getVersion(e){return await this.invoke(`getVersion`,e)}},Go=class e{type;serialNumber;subject;certifier;revocationOutpoint;fields;signature;constructor(e,t,n,r,i,a,o){this.type=e,this.serialNumber=t,this.subject=n,this.certifier=r,this.revocationOutpoint=i,this.fields=a,this.signature=o}toBinary(e=!0){let t=new L,n=F(this.type,`base64`);t.write(n);let r=F(this.serialNumber,`base64`);t.write(r);let i=F(this.subject,`hex`);t.write(i);let a=F(this.certifier,`hex`);t.write(a);let[o,s]=this.revocationOutpoint.split(`.`),c=F(o,`hex`);t.write(c),t.writeVarIntNum(Number(s));let l=Object.keys(this.fields).sort();t.writeVarIntNum(l.length);for(let e of l){let n=this.fields[e],r=F(e,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=F(n,`utf8`);t.writeVarIntNum(i.length),t.write(i)}if(e&&(this.signature??``).length>0){let e=F(this.signature,`hex`);t.write(e)}return t.toArray()}static fromBinary(t){let n=new Kr(t),r=n.read(32),i=Br(r),a=n.read(32),o=Br(a),s=n.read(33),c=P(s),l=n.read(33),u=P(l),d=n.read(32),f=P(d),p=n.readVarIntNum(),m=`${f}.${p}`,h=n.readVarIntNum(),g={};for(let e=0;e<h;e++){let e=n.readVarIntNum(),t=n.read(e),r=I(t),i=n.readVarIntNum(),a=n.read(i);g[r]=I(a)}let _;if(!n.eof()){let e=n.read();_=Ti.fromDER(e).toString(`hex`)}return new e(i,o,c,u,m,g,_)}async verify(){let e=new zo(`anyone`),t=this.toBinary(!1),n=this.signature??``,{valid:r}=await e.verifySignature({signature:F(n,`hex`),data:t,protocolID:[2,`certificate signature`],keyID:`${this.type} ${this.serialNumber}`,counterparty:this.certifier});return r}async sign(e){if(this.signature!=null&&this.signature.length>0)throw Error(`Certificate has already been signed! Signature present: ${this.signature}`);this.certifier=(await e.getPublicKey({identityKey:!0})).publicKey;let t=this.toBinary(!1),{signature:n}=await e.createSignature({data:t,protocolID:[2,`certificate signature`],keyID:`${this.type} ${this.serialNumber}`});this.signature=P(n)}static getCertificateFieldEncryptionDetails(e,t){return{protocolID:[2,`certificate field encryption`],keyID:t?`${t} ${e}`:e}}},Ko;(function(e){e[e.createAction=1]=`createAction`,e[e.signAction=2]=`signAction`,e[e.abortAction=3]=`abortAction`,e[e.listActions=4]=`listActions`,e[e.internalizeAction=5]=`internalizeAction`,e[e.listOutputs=6]=`listOutputs`,e[e.relinquishOutput=7]=`relinquishOutput`,e[e.getPublicKey=8]=`getPublicKey`,e[e.revealCounterpartyKeyLinkage=9]=`revealCounterpartyKeyLinkage`,e[e.revealSpecificKeyLinkage=10]=`revealSpecificKeyLinkage`,e[e.encrypt=11]=`encrypt`,e[e.decrypt=12]=`decrypt`,e[e.createHmac=13]=`createHmac`,e[e.verifyHmac=14]=`verifyHmac`,e[e.createSignature=15]=`createSignature`,e[e.verifySignature=16]=`verifySignature`,e[e.acquireCertificate=17]=`acquireCertificate`,e[e.listCertificates=18]=`listCertificates`,e[e.proveCertificate=19]=`proveCertificate`,e[e.relinquishCertificate=20]=`relinquishCertificate`,e[e.discoverByIdentityKey=21]=`discoverByIdentityKey`,e[e.discoverByAttributes=22]=`discoverByAttributes`,e[e.isAuthenticated=23]=`isAuthenticated`,e[e.waitForAuthentication=24]=`waitForAuthentication`,e[e.getHeight=25]=`getHeight`,e[e.getHeaderForHeight=26]=`getHeaderForHeight`,e[e.getNetwork=27]=`getNetwork`,e[e.getVersion=28]=`getVersion`})(Ko||={});var qo=Ko,Jo=class{wire;constructor(e){this.wire=e}async transmit(e,t=``,n=[]){let r=new L;r.writeUInt8(qo[e]);let i=F(t,`utf8`);r.writeUInt8(i.length),r.write(i),n.length>0&&r.write(n);let a=r.toArray(),o=await this.wire.transmitToWallet(a),s=new Kr(o),c=s.readUInt8();if(c===0)return s.read();{let e=s.readVarIntNum(),t=s.read(e),n=I(t),r=s.readVarIntNum(),i=s.read(r),a=I(i);throw new Vo(n,c,a)}}async createAction(e,t){let n=new L,r=F(e.description,`utf8`);if(n.writeVarIntNum(r.length),n.write(r),e.inputBEEF==null?n.writeVarIntNum(-1):(n.writeVarIntNum(e.inputBEEF.length),n.write(e.inputBEEF)),e.inputs!=null){n.writeVarIntNum(e.inputs.length);for(let t of e.inputs){if(n.write(this.encodeOutpoint(t.outpoint)),t.unlockingScript!=null&&t.unlockingScript!==``){let e=F(t.unlockingScript,`hex`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1),n.writeVarIntNum(t.unlockingScriptLength??0);let e=F(t.inputDescription,`utf8`);n.writeVarIntNum(e.length),n.write(e),typeof t.sequenceNumber==`number`?n.writeVarIntNum(t.sequenceNumber):n.writeVarIntNum(-1)}}else n.writeVarIntNum(-1);if(e.outputs!=null){n.writeVarIntNum(e.outputs.length);for(let t of e.outputs){let e=F(t.lockingScript,`hex`);n.writeVarIntNum(e.length),n.write(e),n.writeVarIntNum(t.satoshis);let r=F(t.outputDescription,`utf8`);if(n.writeVarIntNum(r.length),n.write(r),t.basket!=null&&t.basket!==``){let e=F(t.basket,`utf8`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1);if(t.customInstructions!=null&&t.customInstructions!==``){let e=F(t.customInstructions,`utf8`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1);if(t.tags!=null){n.writeVarIntNum(t.tags.length);for(let e of t.tags){let t=F(e,`utf8`);n.writeVarIntNum(t.length),n.write(t)}}else n.writeVarIntNum(-1)}}else n.writeVarIntNum(-1);if(typeof e.lockTime==`number`?n.writeVarIntNum(e.lockTime):n.writeVarIntNum(-1),typeof e.version==`number`?n.writeVarIntNum(e.version):n.writeVarIntNum(-1),e.labels!=null){n.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=F(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}}else n.writeVarIntNum(-1);if(e.options!=null){if(n.writeInt8(1),typeof e.options.signAndProcess==`boolean`?n.writeInt8(e.options.signAndProcess?1:0):n.writeInt8(-1),typeof e.options.acceptDelayedBroadcast==`boolean`?n.writeInt8(e.options.acceptDelayedBroadcast?1:0):n.writeInt8(-1),e.options.trustSelf===`known`?n.writeInt8(1):n.writeInt8(-1),e.options.knownTxids!=null){n.writeVarIntNum(e.options.knownTxids.length);for(let t of e.options.knownTxids){let e=F(t,`hex`);n.write(e)}}else n.writeVarIntNum(-1);if(typeof e.options.returnTXIDOnly==`boolean`?n.writeInt8(e.options.returnTXIDOnly?1:0):n.writeInt8(-1),typeof e.options.noSend==`boolean`?n.writeInt8(e.options.noSend?1:0):n.writeInt8(-1),e.options.noSendChange!=null){n.writeVarIntNum(e.options.noSendChange.length);for(let t of e.options.noSendChange)n.write(this.encodeOutpoint(t))}else n.writeVarIntNum(-1);if(e.options.sendWith!=null){n.writeVarIntNum(e.options.sendWith.length);for(let t of e.options.sendWith){let e=F(t,`hex`);n.write(e)}}else n.writeVarIntNum(-1);typeof e.options.randomizeOutputs==`boolean`?n.writeInt8(e.options.randomizeOutputs?1:0):n.writeInt8(-1)}else n.writeInt8(0);let i=await this.transmit(`createAction`,t,n.toArray()),a=new Kr(i),o={};if(a.readInt8()===1){let e=a.read(32);o.txid=P(e)}if(a.readInt8()===1){let e=a.readVarIntNum();o.tx=a.read(e)}let s=a.readVarIntNum();if(s>=0){o.noSendChange=[];for(let e=0;e<s;e++){let e=this.readOutpoint(a);o.noSendChange.push(e)}}let c=a.readVarIntNum();if(c>=0){o.sendWithResults=[];for(let e=0;e<c;e++){let e=a.read(32),t=P(e),n=a.readInt8(),r=`unproven`;n===1?r=`unproven`:n===2?r=`sending`:n===3&&(r=`failed`),o.sendWithResults.push({txid:t,status:r})}}if(a.readInt8()===1){let e=a.readVarIntNum(),t=a.read(e),n=a.readVarIntNum(),r=a.read(n);o.signableTransaction={tx:t,reference:Br(r)}}return o}async signAction(e,t){let n=new L,r=Object.keys(e.spends);n.writeVarIntNum(r.length);for(let t of r){n.writeVarIntNum(Number(t));let r=e.spends[Number(t)],i=F(r.unlockingScript,`hex`);n.writeVarIntNum(i.length),n.write(i),typeof r.sequenceNumber==`number`?n.writeVarIntNum(r.sequenceNumber):n.writeVarIntNum(-1)}let i=F(e.reference,`base64`);if(n.writeVarIntNum(i.length),n.write(i),e.options!=null)if(n.writeInt8(1),typeof e.options.acceptDelayedBroadcast==`boolean`?n.writeInt8(e.options.acceptDelayedBroadcast?1:0):n.writeInt8(-1),typeof e.options.returnTXIDOnly==`boolean`?n.writeInt8(e.options.returnTXIDOnly?1:0):n.writeInt8(-1),typeof e.options.noSend==`boolean`?n.writeInt8(e.options.noSend?1:0):n.writeInt8(-1),e.options.sendWith!=null){n.writeVarIntNum(e.options.sendWith.length);for(let t of e.options.sendWith){let e=F(t,`hex`);n.write(e)}}else n.writeVarIntNum(-1);else n.writeInt8(0);let a=await this.transmit(`signAction`,t,n.toArray()),o=new Kr(a),s={};if(o.readInt8()===1){let e=o.read(32);s.txid=P(e)}if(o.readInt8()===1){let e=o.readVarIntNum();s.tx=o.read(e)}let c=o.readVarIntNum();if(c>=0){s.sendWithResults=[];for(let e=0;e<c;e++){let e=o.read(32),t=P(e),n=o.readInt8(),r=`unproven`;n===1?r=`unproven`:n===2?r=`sending`:n===3&&(r=`failed`),s.sendWithResults.push({txid:t,status:r})}}return s}async abortAction(e,t){return await this.transmit(`abortAction`,t,F(e.reference,`base64`)),{aborted:!0}}async listActions(e,t){let n=new L;n.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=F(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}e.labelQueryMode===`any`?n.writeInt8(1):e.labelQueryMode===`all`?n.writeInt8(2):n.writeInt8(-1);let r=[e.includeLabels,e.includeInputs,e.includeInputSourceLockingScripts,e.includeInputUnlockingScripts,e.includeOutputs,e.includeOutputLockingScripts];for(let e of r)typeof e==`boolean`?n.writeInt8(e?1:0):n.writeInt8(-1);typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let i=await this.transmit(`listActions`,t,n.toArray()),a=new Kr(i),o=a.readVarIntNum(),s=[];for(let e=0;e<o;e++){let e=a.read(32),t=P(e),n=a.readVarIntNum(),r=a.readInt8(),i;switch(r){case 1:i=`completed`;break;case 2:i=`unprocessed`;break;case 3:i=`sending`;break;case 4:i=`unproven`;break;case 5:i=`unsigned`;break;case 6:i=`nosend`;break;case 7:i=`nonfinal`;break;case 8:i=`failed`;break;default:throw Error(`Unknown status code: ${r}`)}let o=a.readInt8()===1,c=a.readVarIntNum(),l=a.read(c),u=I(l),d={txid:t,satoshis:n,status:i,isOutgoing:o,description:u,version:0,lockTime:0},f=a.readVarIntNum();if(f>=0){d.labels=[];for(let e=0;e<f;e++){let e=a.readVarIntNum(),t=a.read(e);d.labels.push(I(t))}}d.version=a.readVarIntNum(),d.lockTime=a.readVarIntNum();let p=a.readVarIntNum();if(p>=0){d.inputs=[];for(let e=0;e<p;e++){let e=this.readOutpoint(a),t=a.readVarIntNum(),n=a.readVarIntNum(),r;if(n>=0){let e=a.read(n);r=P(e)}let i=a.readVarIntNum(),o;if(i>=0){let e=a.read(i);o=P(e)}let s=a.readVarIntNum(),c=a.read(s),l=I(c),u=a.readVarIntNum();d.inputs.push({sourceOutpoint:e,sourceSatoshis:t,sourceLockingScript:r,unlockingScript:o,inputDescription:l,sequenceNumber:u})}}let m=a.readVarIntNum();if(m>=0){d.outputs=[];for(let e=0;e<m;e++){let e=a.readVarIntNum(),t=a.readVarIntNum(),n=a.readVarIntNum(),r;if(n>=0){let e=a.read(n);r=P(e)}let i=a.readInt8()===1,o=a.readVarIntNum(),s=a.read(o),c=I(s),l=a.readVarIntNum(),u;if(l>=0){let e=a.read(l);u=I(e)}let f=a.readVarIntNum(),p=[];if(f>=0)for(let e=0;e<f;e++){let e=a.readVarIntNum(),t=a.read(e);p.push(I(t))}let m=a.readVarIntNum(),h;if(m>=0){let e=a.read(m);h=I(e)}d.outputs.push({outputIndex:e,satoshis:t,lockingScript:r,spendable:i,outputDescription:c,basket:u,tags:p,customInstructions:h})}}s.push(d)}return{totalActions:o,actions:s}}async internalizeAction(e,t){let n=new L;n.writeVarIntNum(e.tx.length),n.write(e.tx),n.writeVarIntNum(e.outputs.length);for(let t of e.outputs)if(n.writeVarIntNum(t.outputIndex),t.protocol===`wallet payment`){if(t.paymentRemittance==null)throw Error(`Payment remittance is required for wallet payment`);n.writeUInt8(1),n.write(F(t.paymentRemittance.senderIdentityKey,`hex`));let e=F(t.paymentRemittance.derivationPrefix,`base64`);n.writeVarIntNum(e.length),n.write(e);let r=F(t.paymentRemittance.derivationSuffix,`base64`);n.writeVarIntNum(r.length),n.write(r)}else{n.writeUInt8(2);let e=F(t.insertionRemittance?.basket,`utf8`);if(n.writeVarIntNum(e.length),n.write(e),typeof t.insertionRemittance?.customInstructions==`string`&&t.insertionRemittance.customInstructions!==``){let e=F(t.insertionRemittance.customInstructions,`utf8`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1);if(typeof t.insertionRemittance?.tags==`object`){n.writeVarIntNum(t.insertionRemittance.tags.length);for(let e of t.insertionRemittance.tags){let t=F(e,`utf8`);n.writeVarIntNum(t.length),n.write(t)}}else n.writeVarIntNum(0)}if(typeof e.labels==`object`){n.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=F(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}}else n.writeVarIntNum(-1);let r=F(e.description);return n.writeVarIntNum(r.length),n.write(r),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),await this.transmit(`internalizeAction`,t,n.toArray()),{accepted:!0}}async listOutputs(e,t){let n=new L,r=F(e.basket,`utf8`);if(n.writeVarIntNum(r.length),n.write(r),typeof e.tags==`object`){n.writeVarIntNum(e.tags.length);for(let t of e.tags){let e=F(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}}else n.writeVarIntNum(0);e.tagQueryMode===`all`?n.writeInt8(1):e.tagQueryMode===`any`?n.writeInt8(2):n.writeInt8(-1),e.include===`locking scripts`?n.writeInt8(1):e.include===`entire transactions`?n.writeInt8(2):n.writeInt8(-1),typeof e.includeCustomInstructions==`boolean`?n.writeInt8(e.includeCustomInstructions?1:0):n.writeInt8(-1),typeof e.includeTags==`boolean`?n.writeInt8(e.includeTags?1:0):n.writeInt8(-1),typeof e.includeLabels==`boolean`?n.writeInt8(e.includeLabels?1:0):n.writeInt8(-1),typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let i=await this.transmit(`listOutputs`,t,n.toArray()),a=new Kr(i),o=a.readVarIntNum(),s=a.readVarIntNum(),c;s>=0&&(c=a.read(s));let l=[];for(let e=0;e<o;e++){let e=this.readOutpoint(a),t=a.readVarIntNum(),n={spendable:!0,outpoint:e,satoshis:t},r=a.readVarIntNum();r>=0&&(n.lockingScript=P(a.read(r)));let i=a.readVarIntNum();i>=0&&(n.customInstructions=I(a.read(i)));let o=a.readVarIntNum();if(o!==-1){let e=[];for(let t=0;t<o;t++){let t=a.readVarIntNum();e.push(I(a.read(t)))}n.tags=e}let s=a.readVarIntNum();if(s!==-1){let e=[];for(let t=0;t<s;t++){let t=a.readVarIntNum();e.push(I(a.read(t)))}n.labels=e}l.push(n)}return{totalOutputs:o,BEEF:c,outputs:l}}async relinquishOutput(e,t){let n=new L,r=F(e.basket,`utf8`);return n.writeVarIntNum(r.length),n.write(r),n.write(this.encodeOutpoint(e.output)),await this.transmit(`relinquishOutput`,t,n.toArray()),{relinquished:!0}}encodeOutpoint(e){let t=new L,[n,r]=e.split(`.`);return t.write(F(n,`hex`)),t.writeVarIntNum(Number(r)),t.toArray()}readOutpoint(e){let t=P(e.read(32)),n=e.readVarIntNum();return`${t}.${n}`}async getPublicKey(e,t){let n=new L;n.writeUInt8(e.identityKey?1:0),e.identityKey?n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason)):(n.write(this.encodeKeyRelatedParams(e.protocolID??=[Io.Silent,`default`],e.keyID??=``,e.counterparty,e.privileged,e.privilegedReason)),typeof e.forSelf==`boolean`?n.writeInt8(e.forSelf?1:0):n.writeInt8(-1)),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let r=await this.transmit(`getPublicKey`,t,n.toArray());return{publicKey:P(r)}}async revealCounterpartyKeyLinkage(e,t){let n=new L;n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason)),n.write(F(e.counterparty,`hex`)),n.write(F(e.verifier,`hex`));let r=await this.transmit(`revealCounterpartyKeyLinkage`,t,n.toArray()),i=new Kr(r),a=P(i.read(33)),o=P(i.read(33)),s=P(i.read(33)),c=i.readVarIntNum(),l=I(i.read(c)),u=i.readVarIntNum(),d=i.read(u),f=i.readVarIntNum(),p=i.read(f);return{prover:a,verifier:o,counterparty:s,revelationTime:l,encryptedLinkage:d,encryptedLinkageProof:p}}async revealSpecificKeyLinkage(e,t){let n=new L;n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.write(F(e.verifier,`hex`));let r=await this.transmit(`revealSpecificKeyLinkage`,t,n.toArray()),i=new Kr(r),a=P(i.read(33)),o=P(i.read(33)),s=P(i.read(33)),c=i.readUInt8(),l=i.readVarIntNum(),u=I(i.read(l)),d=i.readVarIntNum(),f=I(i.read(d)),p=i.readVarIntNum(),m=i.read(p),h=i.readVarIntNum(),g=i.read(h),_=i.readUInt8();return{prover:a,verifier:o,counterparty:s,protocolID:[c,u],keyID:f,encryptedLinkage:m,encryptedLinkageProof:g,proofType:_}}async encrypt(e,t){let n=new L;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.writeVarIntNum(e.plaintext.length),n.write(e.plaintext),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{ciphertext:await this.transmit(`encrypt`,t,n.toArray())}}async decrypt(e,t){let n=new L;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.writeVarIntNum(e.ciphertext.length),n.write(e.ciphertext),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{plaintext:await this.transmit(`decrypt`,t,n.toArray())}}async createHmac(e,t){let n=new L;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.writeVarIntNum(e.data.length),n.write(e.data),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{hmac:await this.transmit(`createHmac`,t,n.toArray())}}async verifyHmac(e,t){let n=new L;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.write(e.hmac),n.writeVarIntNum(e.data.length),n.write(e.data),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),await this.transmit(`verifyHmac`,t,n.toArray()),{valid:!0}}async createSignature(e,t){let n=new L;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),typeof e.data==`object`?(n.writeUInt8(1),n.writeVarIntNum(e.data.length),n.write(e.data)):(n.writeUInt8(2),n.write(e.hashToDirectlySign??=[])),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{signature:await this.transmit(`createSignature`,t,n.toArray())}}async verifySignature(e,t){let n=new L;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),typeof e.forSelf==`boolean`?n.writeInt8(e.forSelf?1:0):n.writeInt8(-1),n.writeVarIntNum(e.signature.length),n.write(e.signature),typeof e.data==`object`?(n.writeUInt8(1),n.writeVarIntNum(e.data.length),n.write(e.data)):(n.writeUInt8(2),n.write(e.hashToDirectlyVerify??[])),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),await this.transmit(`verifySignature`,t,n.toArray()),{valid:!0}}encodeKeyRelatedParams(e,t,n,r,i){let a=new L;a.writeUInt8(e[0]);let o=F(e[1],`utf8`);a.writeVarIntNum(o.length),a.write(o);let s=F(t,`utf8`);return a.writeVarIntNum(s.length),a.write(s),typeof n==`string`?n===`self`?a.writeUInt8(11):n===`anyone`?a.writeUInt8(12):a.write(F(n,`hex`)):a.writeUInt8(0),a.write(this.encodePrivilegedParams(r,i)),a.toArray()}async acquireCertificate(e,t){let n=new L;n.write(F(e.type,`base64`)),n.write(F(e.certifier,`hex`));let r=Object.entries(e.fields);n.writeVarIntNum(r.length);for(let[e,t]of r){let r=F(e,`utf8`),i=F(t,`utf8`);n.writeVarIntNum(r.length),n.write(r),n.writeVarIntNum(i.length),n.write(i)}if(n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason)),n.writeUInt8(e.acquisitionProtocol===`direct`?1:2),e.acquisitionProtocol===`direct`){n.write(F(e.serialNumber,`base64`)),n.write(this.encodeOutpoint(e.revocationOutpoint??``));let t=F(e.signature,`hex`);n.writeVarIntNum(t.length),n.write(t);let r=e.keyringRevealer===`certifier`?[11]:F(e.keyringRevealer,`hex`);n.write(r);let i=Object.keys(e.keyringForSubject??{});n.writeVarIntNum(i.length);for(let t=0;t<i.length;t++){let r=F(i[t],`utf8`);n.writeVarIntNum(r.length),n.write(r);let a=F(e.keyringForSubject?.[i[t]],`base64`);n.writeVarIntNum(a.length),n.write(a)}}else{let t=F(e.certifierUrl,`utf8`);n.writeVarIntNum(t.length),n.write(t)}let i=await this.transmit(`acquireCertificate`,t,n.toArray()),a=Go.fromBinary(i);return{...a,signature:a.signature}}encodePrivilegedParams(e,t){let n=new L;if(typeof e==`boolean`?n.writeInt8(e?1:0):n.writeInt8(-1),typeof t==`string`){let e=F(t,`utf8`);n.writeInt8(e.length),n.write(e)}else n.writeInt8(-1);return n.toArray()}async listCertificates(e,t){let n=new L;n.writeVarIntNum(e.certifiers.length);for(let t=0;t<e.certifiers.length;t++)n.write(F(e.certifiers[t],`hex`));n.writeVarIntNum(e.types.length);for(let t=0;t<e.types.length;t++)n.write(F(e.types[t],`base64`));typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason));let r=await this.transmit(`listCertificates`,t,n.toArray()),i=new Kr(r),a=i.readVarIntNum(),o=[];for(let e=0;e<a;e++){let e=i.readVarIntNum(),t=i.read(e),n=Go.fromBinary(t);o.push({...n,signature:n.signature})}return{totalCertificates:a,certificates:o}}async proveCertificate(e,t){let n=new L,r=F(e.certificate.type,`base64`);n.write(r);let i=F(e.certificate.subject,`hex`);n.write(i);let a=F(e.certificate.serialNumber,`base64`);n.write(a);let o=F(e.certificate.certifier,`hex`);n.write(o);let s=this.encodeOutpoint(e.certificate.revocationOutpoint??``);n.write(s);let c=F(e.certificate.signature,`hex`);n.writeVarIntNum(c.length),n.write(c);let l=Object.entries(e.certificate.fields??{});n.writeVarIntNum(l.length);for(let[e,t]of l){let r=F(e,`utf8`),i=F(t,`utf8`);n.writeVarIntNum(r.length),n.write(r),n.writeVarIntNum(i.length),n.write(i)}n.writeVarIntNum(e.fieldsToReveal.length);for(let t of e.fieldsToReveal){let e=F(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}n.write(F(e.verifier,`hex`)),n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason));let u=await this.transmit(`proveCertificate`,t,n.toArray()),d=new Kr(u),f=d.readVarIntNum(),p={};for(let e=0;e<f;e++){let e=d.readVarIntNum(),t=I(d.read(e)),n=d.readVarIntNum();p[t]=Br(d.read(n))}return{keyringForVerifier:p}}async relinquishCertificate(e,t){let n=new L,r=F(e.type,`base64`);n.write(r);let i=F(e.serialNumber,`base64`);n.write(i);let a=F(e.certifier,`hex`);return n.write(a),await this.transmit(`relinquishCertificate`,t,n.toArray()),{relinquished:!0}}parseDiscoveryResult(e){let t=new Kr(e),n=t.readVarIntNum(),r=[];for(let e=0;e<n;e++){let e=t.readVarIntNum(),n=t.read(e),i=Go.fromBinary(n),a=t.readVarIntNum(),o=I(t.read(a)),s=t.readVarIntNum(),c=I(t.read(s)),l=t.readVarIntNum(),u=I(t.read(l)),d=t.readUInt8(),f={},p=t.readVarIntNum();for(let e=0;e<p;e++){let e=t.readVarIntNum(),n=I(t.read(e)),r=t.readVarIntNum();f[n]=t.read(r)}let m={},h=t.readVarIntNum();for(let e=0;e<h;e++){let e=t.readVarIntNum(),n=I(t.read(e)),r=t.readVarIntNum();m[n]=I(t.read(r))}r.push({...i,signature:i.signature,certifierInfo:{iconUrl:c,name:o,description:u,trust:d},publiclyRevealedKeyring:f,decryptedFields:m})}return{totalCertificates:n,certificates:r}}async discoverByIdentityKey(e,t){let n=new L;n.write(F(e.identityKey,`hex`)),typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let r=await this.transmit(`discoverByIdentityKey`,t,n.toArray());return this.parseDiscoveryResult(r)}async discoverByAttributes(e,t){let n=new L,r=Object.keys(e.attributes);n.writeVarIntNum(r.length);for(let t=0;t<r.length;t++)n.writeVarIntNum(r[t].length),n.write(F(r[t],`utf8`)),n.writeVarIntNum(e.attributes[r[t]].length),n.write(F(e.attributes[r[t]],`utf8`));typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let i=await this.transmit(`discoverByAttributes`,t,n.toArray());return this.parseDiscoveryResult(i)}async isAuthenticated(e,t){return{authenticated:(await this.transmit(`isAuthenticated`,t))[0]===1}}async waitForAuthentication(e,t){return await this.transmit(`waitForAuthentication`,t),{authenticated:!0}}async getHeight(e,t){let n=await this.transmit(`getHeight`,t);return{height:new Kr(n).readVarIntNum()}}async getHeaderForHeight(e,t){let n=new L;n.writeVarIntNum(e.height);let r=await this.transmit(`getHeaderForHeight`,t,n.toArray());return{header:P(r)}}async getNetwork(e,t){return{network:(await this.transmit(`getNetwork`,t))[0]===0?`mainnet`:`testnet`}}async getVersion(e,t){let n=await this.transmit(`getVersion`,t);return{version:I(n)}}},Yo=class{baseUrl;httpClient;originator;constructor(e,t=`http://localhost:3301`,n=fetch){this.baseUrl=t,this.httpClient=n,this.originator=e}async transmitToWallet(e){let t=new Kr(e),n=t.readUInt8(),r=qo[n];if(r===void 0||r===``)throw Error(`Invalid call code: ${n}`);let i=t.readUInt8(),a;if(i>0){let e=t.read(i);a=I(e)}let o=t.read(),s=await(await fetch(`${this.baseUrl}/${r}`,{method:`POST`,headers:{"Content-Type":`application/octet-stream`,Origin:a??``},body:new Uint8Array(o)})).arrayBuffer();return Array.from(new Uint8Array(s))}},Xo=class extends Error{reviewActionResults;sendWithResults;txid;tx;noSendChange;code;isError=!0;constructor(e,t,n,r,i){super(`Undelayed createAction or signAction results require review.`),this.reviewActionResults=e,this.sendWithResults=t,this.txid=n,this.tx=r,this.noSendChange=i,this.code=5,this.name=this.constructor.name}},Zo=Xo;function Qo(e,t=`http`){if(/^[a-z][a-z0-9+.-]*:\/\//i.test(e))try{return new URL(e).origin}catch{}try{return new URL(`${t}://${e}`).origin}catch{throw Error(`Invalid originator value: ${e}`)}}var $o=class{baseUrl;httpClient;originator;api;constructor(e,t=`http://localhost:3321`,n=fetch){this.baseUrl=t,this.originator=e,this.httpClient=n;let r=typeof window<`u`&&typeof document<`u`&&window?.origin!==`file://`;this.api=async(e,t)=>{let i=!r&&this.originator?Qo(this.originator,`http`):void 0;!r&&i===void 0&&console.error(`Originator is required in Node.js environments`);let a=await await n(`${this.baseUrl}/${e}`,{method:`POST`,headers:{Accept:`application/json`,"Content-Type":`application/json`,...i?{Origin:i}:{},...i?{Originator:i}:{}},body:JSON.stringify(t)}),o=await a.json();if(!a.ok){if(a.status===400&&o.isError&&o.code===5)throw new Xo(o.reviewActionResults,o.sendWithResults,o.txid,o.tx,o.noSendChange);{let n={call:e,args:t,message:o.message??`HTTP Client error ${a.status}`};throw Error(JSON.stringify(n))}}return o}}async createAction(e){return await this.api(`createAction`,e)}async signAction(e){return await this.api(`signAction`,e)}async abortAction(e){return await this.api(`abortAction`,e)}async listActions(e){return await this.api(`listActions`,e)}async internalizeAction(e){return await this.api(`internalizeAction`,e)}async listOutputs(e){return await this.api(`listOutputs`,e)}async relinquishOutput(e){return await this.api(`relinquishOutput`,e)}async getPublicKey(e){return await this.api(`getPublicKey`,e)}async revealCounterpartyKeyLinkage(e){return await this.api(`revealCounterpartyKeyLinkage`,e)}async revealSpecificKeyLinkage(e){return await this.api(`revealSpecificKeyLinkage`,e)}async encrypt(e){return await this.api(`encrypt`,e)}async decrypt(e){return await this.api(`decrypt`,e)}async createHmac(e){return await this.api(`createHmac`,e)}async verifyHmac(e){return await this.api(`verifyHmac`,e)}async createSignature(e){return await this.api(`createSignature`,e)}async verifySignature(e){return await this.api(`verifySignature`,e)}async acquireCertificate(e){return await this.api(`acquireCertificate`,e)}async listCertificates(e){return await this.api(`listCertificates`,e)}async proveCertificate(e){return await this.api(`proveCertificate`,e)}async relinquishCertificate(e){return await this.api(`relinquishCertificate`,e)}async discoverByIdentityKey(e){return await this.api(`discoverByIdentityKey`,e)}async discoverByAttributes(e){return await this.api(`discoverByAttributes`,e)}async isAuthenticated(e){return await this.api(`isAuthenticated`,e)}async waitForAuthentication(e){return await this.api(`waitForAuthentication`,e)}async getHeight(e){return await this.api(`getHeight`,e)}async getHeaderForHeight(e){return await this.api(`getHeaderForHeight`,e)}async getNetwork(e){return await this.api(`getNetwork`,e)}async getVersion(e){return await this.api(`getVersion`,e)}},es=class{domain;constructor(e=`*`){if(typeof window!=`object`)throw Error(`The XDM substrate requires a global window object.`);if(!window.hasOwnProperty(`ReactNativeWebView`))throw Error(`The window object does not have a ReactNativeWebView property.`);if(typeof window.ReactNativeWebView.postMessage!=`function`)throw Error(`The window.ReactNativeWebView property does not seem to support postMessage calls.`);this.domain=e}async invoke(e,t){return await new Promise((n,r)=>{let i=Br(Ri(12)),a=e=>{let t=JSON.parse(e.data);if(!(t.type!==`CWI`||t.id!==i||t.isInvocation===!0))if(typeof window.removeEventListener==`function`&&window.removeEventListener(`message`,a),t.status===`error`){let e=new Vo(t.description,t.code);r(e)}else n(t.result)};window.addEventListener(`message`,a),window.ReactNativeWebView.postMessage(JSON.stringify({type:`CWI`,isInvocation:!0,id:i,call:e,args:t}))})}async createAction(e){return await this.invoke(`createAction`,e)}async signAction(e){return await this.invoke(`signAction`,e)}async abortAction(e){return await this.invoke(`abortAction`,e)}async listActions(e){return await this.invoke(`listActions`,e)}async internalizeAction(e){return await this.invoke(`internalizeAction`,e)}async listOutputs(e){return await this.invoke(`listOutputs`,e)}async relinquishOutput(e){return await this.invoke(`relinquishOutput`,e)}async getPublicKey(e){return await this.invoke(`getPublicKey`,e)}async revealCounterpartyKeyLinkage(e){return await this.invoke(`revealCounterpartyKeyLinkage`,e)}async revealSpecificKeyLinkage(e){return await this.invoke(`revealSpecificKeyLinkage`,e)}async encrypt(e){return await this.invoke(`encrypt`,e)}async decrypt(e){return await this.invoke(`decrypt`,e)}async createHmac(e){return await this.invoke(`createHmac`,e)}async verifyHmac(e){return await this.invoke(`verifyHmac`,e)}async createSignature(e){return await this.invoke(`createSignature`,e)}async verifySignature(e){return await this.invoke(`verifySignature`,e)}async acquireCertificate(e){return await this.invoke(`acquireCertificate`,e)}async listCertificates(e){return await this.invoke(`listCertificates`,e)}async proveCertificate(e){return await this.invoke(`proveCertificate`,e)}async relinquishCertificate(e){return await this.invoke(`relinquishCertificate`,e)}async discoverByIdentityKey(e){return await this.invoke(`discoverByIdentityKey`,e)}async discoverByAttributes(e){return await this.invoke(`discoverByAttributes`,e)}async isAuthenticated(e){return await this.invoke(`isAuthenticated`,e)}async waitForAuthentication(e){return await this.invoke(`waitForAuthentication`,e)}async getHeight(e){return await this.invoke(`getHeight`,e)}async getHeaderForHeight(e){return await this.invoke(`getHeaderForHeight`,e)}async getNetwork(e){return await this.invoke(`getNetwork`,e)}async getVersion(e){return await this.invoke(`getVersion`,e)}},ts=200,ns=class{substrate;originator;constructor(e=`auto`,t){e===`Cicada`&&(e=new Jo(new Yo(t))),e===`window.CWI`&&(e=new Bo),e===`XDM`&&(e=new Wo),e===`json-api`&&(e=new $o(t)),e===`react-native`&&(e=new es(t)),this.substrate=e,this.originator=t}async connectToSubstrate(){if(typeof this.substrate==`object`)return;let e,t=async t=>{let n;if(n=typeof t==`number`?await Promise.race([e.getVersion({}),new Promise((e,n)=>setTimeout(()=>n(Error(`Timed out.`)),t))]):await e.getVersion({}),typeof n!=`object`||typeof n.version!=`string`)throw Error(`Failed to use substrate.`)};try{e=new Bo,await t(),this.substrate=e}catch{try{e=new Wo,await t(ts),this.substrate=e}catch{try{e=new Jo(new Yo(this.originator)),await t(),this.substrate=e}catch{try{e=new $o(this.originator),await t(),this.substrate=e}catch{try{e=new es(this.originator),await t(),this.substrate=e}catch{throw Error(`No wallet available over any communication substrate. Install a BSV wallet today!`)}}}}}}async createAction(e){return await this.connectToSubstrate(),await this.substrate.createAction(e,this.originator)}async signAction(e){return await this.connectToSubstrate(),await this.substrate.signAction(e,this.originator)}async abortAction(e){return await this.connectToSubstrate(),await this.substrate.abortAction(e,this.originator)}async listActions(e){return await this.connectToSubstrate(),await this.substrate.listActions(e,this.originator)}async internalizeAction(e){return await this.connectToSubstrate(),await this.substrate.internalizeAction(e,this.originator)}async listOutputs(e){return await this.connectToSubstrate(),await this.substrate.listOutputs(e,this.originator)}async relinquishOutput(e){return await this.connectToSubstrate(),await this.substrate.relinquishOutput(e,this.originator)}async getPublicKey(e){return await this.connectToSubstrate(),await this.substrate.getPublicKey(e,this.originator)}async revealCounterpartyKeyLinkage(e){return await this.connectToSubstrate(),await this.substrate.revealCounterpartyKeyLinkage(e,this.originator)}async revealSpecificKeyLinkage(e){return await this.connectToSubstrate(),await this.substrate.revealSpecificKeyLinkage(e,this.originator)}async encrypt(e){return await this.connectToSubstrate(),await this.substrate.encrypt(e,this.originator)}async decrypt(e){return await this.connectToSubstrate(),await this.substrate.decrypt(e,this.originator)}async createHmac(e){return await this.connectToSubstrate(),await this.substrate.createHmac(e,this.originator)}async verifyHmac(e){return await this.connectToSubstrate(),await this.substrate.verifyHmac(e,this.originator)}async createSignature(e){return await this.connectToSubstrate(),await this.substrate.createSignature(e,this.originator)}async verifySignature(e){return await this.connectToSubstrate(),await this.substrate.verifySignature(e,this.originator)}async acquireCertificate(e){return await this.connectToSubstrate(),await this.substrate.acquireCertificate(e,this.originator)}async listCertificates(e){return await this.connectToSubstrate(),await this.substrate.listCertificates(e,this.originator)}async proveCertificate(e){return await this.connectToSubstrate(),await this.substrate.proveCertificate(e,this.originator)}async relinquishCertificate(e){return await this.connectToSubstrate(),await this.substrate.relinquishCertificate(e,this.originator)}async discoverByIdentityKey(e){return await this.connectToSubstrate(),await this.substrate.discoverByIdentityKey(e,this.originator)}async discoverByAttributes(e){return await this.connectToSubstrate(),await this.substrate.discoverByAttributes(e,this.originator)}async isAuthenticated(e={}){return await this.connectToSubstrate(),await this.substrate.isAuthenticated(e,this.originator)}async waitForAuthentication(e={}){return await this.connectToSubstrate(),await this.substrate.waitForAuthentication(e,this.originator)}async getHeight(e={}){return await this.connectToSubstrate(),await this.substrate.getHeight(e,this.originator)}async getHeaderForHeight(e){return await this.connectToSubstrate(),await this.substrate.getHeaderForHeight(e,this.originator)}async getNetwork(e={}){return await this.connectToSubstrate(),await this.substrate.getNetwork(e,this.originator)}async getVersion(e={}){return await this.connectToSubstrate(),await this.substrate.getVersion(e,this.originator)}},rs=class{wallet;constructor(e){this.wallet=e}decodeOutpoint(e){let t=e.read(32),n=P(t),r=e.readVarIntNum();return`${n}.${r}`}encodeOutpoint(e){let t=new L,[n,r]=e.split(`.`);return t.write(F(n,`hex`)),t.writeVarIntNum(Number(r)),t.toArray()}async transmitToWallet(e){let t=new Kr(e);try{let e=t.readUInt8(),n=qo[e];if(n===void 0||n===``)throw Error(`Invalid call code: ${e}`);let r=t.readUInt8(),i=t.read(r),a=I(i),o=t;switch(n){case`createAction`:{let e={},t=o.readVarIntNum(),n=o.read(t);e.description=I(n);let r=o.readVarIntNum();r>=0?e.inputBEEF=o.read(r):e.inputBEEF=void 0;let i=o.readVarIntNum();if(i>=0){e.inputs=[];for(let t=0;t<i;t++){let t={};t.outpoint=this.decodeOutpoint(o);let n=o.readVarIntNum();if(n>=0){let e=o.read(n);t.unlockingScript=P(e)}else t.unlockingScript=void 0,t.unlockingScriptLength=o.readVarIntNum();let r=o.readVarIntNum(),i=o.read(r);t.inputDescription=I(i);let a=o.readVarIntNum();a>=0?t.sequenceNumber=a:t.sequenceNumber=void 0,e.inputs.push(t)}}else e.inputs=void 0;let s=o.readVarIntNum();if(s>=0){e.outputs=[];for(let t=0;t<s;t++){let t={},n=o.readVarIntNum(),r=o.read(n);t.lockingScript=P(r),t.satoshis=o.readVarIntNum();let i=o.readVarIntNum(),a=o.read(i);t.outputDescription=I(a);let s=o.readVarIntNum();if(s>=0){let e=o.read(s);t.basket=I(e)}else t.basket=void 0;let c=o.readVarIntNum();if(c>=0){let e=o.read(c);t.customInstructions=I(e)}else t.customInstructions=void 0;let l=o.readVarIntNum();if(l>=0){t.tags=[];for(let e=0;e<l;e++){let e=o.readVarIntNum(),n=o.read(e),r=I(n);t.tags.push(r)}}else t.tags=void 0;e.outputs.push(t)}}else e.outputs=void 0;let c=o.readVarIntNum();c>=0?e.lockTime=c:e.lockTime=void 0;let l=o.readVarIntNum();l>=0?e.version=l:e.version=void 0;let u=o.readVarIntNum();if(u>=0){e.labels=[];for(let t=0;t<u;t++){let t=o.readVarIntNum(),n=o.read(t),r=I(n);e.labels.push(r)}}else e.labels=void 0;if(o.readInt8()===1){e.options={};let t=o.readInt8();t===-1?e.options.signAndProcess=void 0:e.options.signAndProcess=t===1;let n=o.readInt8();n===-1?e.options.acceptDelayedBroadcast=void 0:e.options.acceptDelayedBroadcast=n===1;let r=o.readInt8();r===-1?e.options.trustSelf=void 0:r===1&&(e.options.trustSelf=`known`);let i=o.readVarIntNum();if(i>=0){e.options.knownTxids=[];for(let t=0;t<i;t++){let t=o.read(32),n=P(t);e.options.knownTxids.push(n)}}else e.options.knownTxids=void 0;let a=o.readInt8();a===-1?e.options.returnTXIDOnly=void 0:e.options.returnTXIDOnly=a===1;let s=o.readInt8();s===-1?e.options.noSend=void 0:e.options.noSend=s===1;let c=o.readVarIntNum();if(c>=0){e.options.noSendChange=[];for(let t=0;t<c;t++){let t=this.decodeOutpoint(o);e.options.noSendChange.push(t)}}else e.options.noSendChange=void 0;let l=o.readVarIntNum();if(l>=0){e.options.sendWith=[];for(let t=0;t<l;t++){let t=o.read(32),n=P(t);e.options.sendWith.push(n)}}else e.options.sendWith=void 0;let u=o.readInt8();u===-1?e.options.randomizeOutputs=void 0:e.options.randomizeOutputs=u===1}else e.options=void 0;let d=await this.wallet.createAction(e,a),f=new L;if(d.txid!=null&&d.txid!==``?(f.writeInt8(1),f.write(F(d.txid,`hex`))):f.writeInt8(0),d.tx==null?f.writeInt8(0):(f.writeInt8(1),f.writeVarIntNum(d.tx.length),f.write(d.tx)),d.noSendChange!=null){f.writeVarIntNum(d.noSendChange.length);for(let e of d.noSendChange)f.write(this.encodeOutpoint(e))}else f.writeVarIntNum(-1);if(d.sendWithResults!=null){f.writeVarIntNum(d.sendWithResults.length);for(let e of d.sendWithResults){f.write(F(e.txid,`hex`));let t;e.status===`unproven`?t=1:e.status===`sending`?t=2:e.status===`failed`&&(t=3),f.writeInt8(t)}}else f.writeVarIntNum(-1);if(d.signableTransaction!=null){f.writeInt8(1),f.writeVarIntNum(d.signableTransaction.tx.length),f.write(d.signableTransaction.tx);let e=F(d.signableTransaction.reference,`base64`);f.writeVarIntNum(e.length),f.write(e)}else f.writeInt8(0);let p=new L;return p.writeUInt8(0),p.write(f.toArray()),p.toArray()}case`signAction`:{let e={},t=o.readVarIntNum();e.spends={};for(let n=0;n<t;n++){let t=o.readVarIntNum(),n={},r=o.readVarIntNum(),i=o.read(r);n.unlockingScript=P(i);let a=o.readVarIntNum();a>=0?n.sequenceNumber=a:n.sequenceNumber=void 0,e.spends[t]=n}let n=o.readVarIntNum(),r=o.read(n);if(e.reference=Br(r),o.readInt8()===1){e.options={};let t=o.readInt8();t===-1?e.options.acceptDelayedBroadcast=void 0:e.options.acceptDelayedBroadcast=t===1;let n=o.readInt8();n===-1?e.options.returnTXIDOnly=void 0:e.options.returnTXIDOnly=n===1;let r=o.readInt8();r===-1?e.options.noSend=void 0:e.options.noSend=r===1;let i=o.readVarIntNum();if(i>=0){e.options.sendWith=[];for(let t=0;t<i;t++){let t=o.read(32),n=P(t);e.options.sendWith.push(n)}}else e.options.sendWith=void 0}else e.options=void 0;let i=await this.wallet.signAction(e,a),s=new L;if(i.txid!=null&&i.txid!==``?(s.writeInt8(1),s.write(F(i.txid,`hex`))):s.writeInt8(0),i.tx==null?s.writeInt8(0):(s.writeInt8(1),s.writeVarIntNum(i.tx.length),s.write(i.tx)),i.sendWithResults!=null){s.writeVarIntNum(i.sendWithResults.length);for(let e of i.sendWithResults){s.write(F(e.txid,`hex`));let t;e.status===`unproven`?t=1:e.status===`sending`?t=2:e.status===`failed`&&(t=3),s.writeInt8(t)}}else s.writeVarIntNum(-1);let c=new L;return c.writeUInt8(0),c.write(s.toArray()),c.toArray()}case`abortAction`:{let e=o.read(),t=Br(e);await this.wallet.abortAction({reference:t},a);let n=new L;return n.writeUInt8(0),n.toArray()}case`listActions`:{let e={},t=o.readVarIntNum();e.labels=[];for(let n=0;n<t;n++){let t=o.readVarIntNum(),n=o.read(t);e.labels.push(I(n))}let n=o.readInt8();n===-1?e.labelQueryMode=void 0:n===1?e.labelQueryMode=`any`:n===2&&(e.labelQueryMode=`all`);for(let t of[`includeLabels`,`includeInputs`,`includeInputSourceLockingScripts`,`includeInputUnlockingScripts`,`includeOutputs`,`includeOutputLockingScripts`]){let n=o.readInt8();n===-1?e[t]=void 0:e[t]=n===1}let r=o.readVarIntNum();r>=0?e.limit=r:e.limit=void 0;let i=o.readVarIntNum();i>=0?e.offset=i:e.offset=void 0;let s=o.readInt8();s>=0?e.seekPermission=s===1:e.seekPermission=void 0;let c=await this.wallet.listActions(e,a),l=new L;l.writeVarIntNum(c.totalActions);for(let e of c.actions){l.write(F(e.txid,`hex`)),l.writeVarIntNum(e.satoshis);let t;switch(e.status){case`completed`:t=1;break;case`unprocessed`:t=2;break;case`sending`:t=3;break;case`unproven`:t=4;break;case`unsigned`:t=5;break;case`nosend`:t=6;break;case`nonfinal`:t=7;break;case`failed`:t=8;break;default:t=-1;break}l.writeInt8(t),l.writeInt8(e.isOutgoing?1:0);let n=F(e.description,`utf8`);if(l.writeVarIntNum(n.length),l.write(n),e.labels!==void 0){l.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=F(t,`utf8`);l.writeVarIntNum(e.length),l.write(e)}}else l.writeVarIntNum(-1);if(l.writeVarIntNum(e.version),l.writeVarIntNum(e.lockTime),e.inputs!==void 0){l.writeVarIntNum(e.inputs.length);for(let t of e.inputs){if(l.write(this.encodeOutpoint(t.sourceOutpoint)),l.writeVarIntNum(t.sourceSatoshis),t.sourceLockingScript!==void 0){let e=F(t.sourceLockingScript,`hex`);l.writeVarIntNum(e.length),l.write(e)}else l.writeVarIntNum(-1);if(t.unlockingScript!==void 0){let e=F(t.unlockingScript,`hex`);l.writeVarIntNum(e.length),l.write(e)}else l.writeVarIntNum(-1);let e=F(t.inputDescription,`utf8`);l.writeVarIntNum(e.length),l.write(e),l.writeVarIntNum(t.sequenceNumber)}}else l.writeVarIntNum(-1);if(e.outputs!==void 0){l.writeVarIntNum(e.outputs.length);for(let t of e.outputs){if(l.writeVarIntNum(t.outputIndex),l.writeVarIntNum(t.satoshis),t.lockingScript!==void 0){let e=F(t.lockingScript,`hex`);l.writeVarIntNum(e.length),l.write(e)}else l.writeVarIntNum(-1);l.writeInt8(t.spendable?1:0);let e=F(t.outputDescription,`utf8`);if(l.writeVarIntNum(e.length),l.write(e),t.basket!==void 0){let e=F(t.basket,`utf8`);l.writeVarIntNum(e.length),l.write(e)}else l.writeVarIntNum(-1);if(t.tags!==void 0){l.writeVarIntNum(t.tags.length);for(let e of t.tags){let t=F(e,`utf8`);l.writeVarIntNum(t.length),l.write(t)}}else l.writeVarIntNum(-1);if(t.customInstructions!==void 0){let e=F(t.customInstructions,`utf8`);l.writeVarIntNum(e.length),l.write(e)}else l.writeVarIntNum(-1)}}else l.writeVarIntNum(-1)}let u=new L;return u.writeUInt8(0),u.write(l.toArray()),u.toArray()}case`internalizeAction`:{let e={},t=o.readVarIntNum();e.tx=o.read(t);let n=o.readVarIntNum();e.outputs=[];for(let t=0;t<n;t++){let t={};t.outputIndex=o.readVarIntNum();let n=o.readUInt8();if(n===1){t.protocol=`wallet payment`,t.paymentRemittance={};let e=o.read(33);t.paymentRemittance.senderIdentityKey=P(e);let n=o.readVarIntNum(),r=o.read(n);t.paymentRemittance.derivationPrefix=Br(r);let i=o.readVarIntNum(),a=o.read(i);t.paymentRemittance.derivationSuffix=Br(a)}else if(n===2){t.protocol=`basket insertion`,t.insertionRemittance={};let e=o.readVarIntNum(),n=o.read(e);t.insertionRemittance.basket=I(n);let r=o.readVarIntNum();if(r>=0){let e=o.read(r);t.insertionRemittance.customInstructions=I(e)}let i=o.readVarIntNum();if(i>0){t.insertionRemittance.tags=[];for(let e=0;e<i;e++){let e=o.readVarIntNum(),n=o.read(e);t.insertionRemittance.tags.push(I(n))}}else t.insertionRemittance.tags=[]}e.outputs.push(t)}let r=o.readVarIntNum();if(r>=0){e.labels=[];for(let t=0;t<r;t++){let t=o.readVarIntNum();e.labels.push(I(o.read(t)))}}let i=o.readVarIntNum();e.description=I(o.read(i));let s=o.readInt8();s>=0?e.seekPermission=s===1:e.seekPermission=void 0,await this.wallet.internalizeAction(e,a);let c=new L;return c.writeUInt8(0),c.toArray()}case`listOutputs`:{let e={},t=o.readVarIntNum(),n=o.read(t);e.basket=I(n);let r=o.readVarIntNum();if(r>0){e.tags=[];for(let t=0;t<r;t++){let t=o.readVarIntNum(),n=o.read(t);e.tags.push(I(n))}}else e.tags=void 0;let i=o.readInt8();i===1?e.tagQueryMode=`all`:i===2?e.tagQueryMode=`any`:e.tagQueryMode=void 0;let s=o.readInt8();s===1?e.include=`locking scripts`:s===2?e.include=`entire transactions`:e.include=void 0;let c=o.readInt8();c===-1?e.includeCustomInstructions=void 0:e.includeCustomInstructions=c===1;let l=o.readInt8();l===-1?e.includeTags=void 0:e.includeTags=l===1;let u=o.readInt8();u===-1?e.includeLabels=void 0:e.includeLabels=u===1;let d=o.readVarIntNum();d>=0?e.limit=d:e.limit=void 0;let f=o.readVarIntNum();f>=0?e.offset=f:e.offset=void 0;let p=o.readInt8();p>=0?e.seekPermission=p===1:e.seekPermission=void 0;let m=await this.wallet.listOutputs(e,a),h=new L;h.writeVarIntNum(m.totalOutputs),m.BEEF==null?h.writeVarIntNum(-1):(h.writeVarIntNum(m.BEEF.length),h.write(m.BEEF));for(let e of m.outputs){if(h.write(this.encodeOutpoint(e.outpoint)),h.writeVarIntNum(e.satoshis),e.lockingScript!==void 0){let t=F(e.lockingScript,`hex`);h.writeVarIntNum(t.length),h.write(t)}else h.writeVarIntNum(-1);if(e.customInstructions!==void 0){let t=F(e.customInstructions,`utf8`);h.writeVarIntNum(t.length),h.write(t)}else h.writeVarIntNum(-1);if(e.tags!==void 0){h.writeVarIntNum(e.tags.length);for(let t of e.tags){let e=F(t,`utf8`);h.writeVarIntNum(e.length),h.write(e)}}else h.writeVarIntNum(-1);if(e.labels!==void 0){h.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=F(t,`utf8`);h.writeVarIntNum(e.length),h.write(e)}}else h.writeVarIntNum(-1)}let g=new L;return g.writeUInt8(0),g.write(h.toArray()),g.toArray()}case`relinquishOutput`:{let e={},t=o.readVarIntNum(),n=o.read(t);e.basket=I(n),e.output=this.decodeOutpoint(o),await this.wallet.relinquishOutput(e,a);let r=new L;return r.writeUInt8(0),r.toArray()}case`getPublicKey`:{let e={};if(e.identityKey=o.readUInt8()===1,e.identityKey!==!0){e.protocolID=this.decodeProtocolID(o),e.keyID=this.decodeString(o),e.counterparty=this.decodeCounterparty(o);let t=o.readInt8();t===-1?e.privileged=void 0:e.privileged=t===1;let n=o.readInt8();if(n!==-1){let t=o.read(n);e.privilegedReason=I(t)}else e.privilegedReason=void 0;let r=o.readInt8();r===-1?e.forSelf=void 0:e.forSelf=r===1}else{let t=o.readInt8();t===-1?e.privileged=void 0:e.privileged=t===1;let n=o.readInt8();if(n!==-1){let t=o.read(n);e.privilegedReason=I(t)}else e.privilegedReason=void 0}let t=o.readInt8();t>=0?e.seekPermission=t===1:e.seekPermission=void 0;let n=await this.wallet.getPublicKey(e,a),r=new L;r.writeUInt8(0);let i=F(n.publicKey,`hex`);return r.write(i),r.toArray()}case`encrypt`:{let e=this.decodeKeyRelatedParams(o),t=o.readVarIntNum();e.plaintext=o.read(t);let n=o.readInt8();n>=0?e.seekPermission=n===1:e.seekPermission=void 0;let r=await this.wallet.encrypt(e,a),i=new L;return i.writeUInt8(0),i.write(r.ciphertext),i.toArray()}case`decrypt`:{let e=this.decodeKeyRelatedParams(o),t=o.readVarIntNum();e.ciphertext=o.read(t);let n=o.readInt8();n>=0?e.seekPermission=n===1:e.seekPermission=void 0;let r=await this.wallet.decrypt(e,a),i=new L;return i.writeUInt8(0),i.write(r.plaintext),i.toArray()}case`createHmac`:{let e=this.decodeKeyRelatedParams(o),t=o.readVarIntNum();e.data=o.read(t);let n=o.readInt8();n>=0?e.seekPermission=n===1:e.seekPermission=void 0;let r=await this.wallet.createHmac(e,a),i=new L;return i.writeUInt8(0),i.write(r.hmac),i.toArray()}case`verifyHmac`:{let e=this.decodeKeyRelatedParams(o);e.hmac=o.read(32);let t=o.readVarIntNum();e.data=o.read(t);let n=o.readInt8();n>=0?e.seekPermission=n===1:e.seekPermission=void 0,await this.wallet.verifyHmac(e,a);let r=new L;return r.writeUInt8(0),r.toArray()}case`createSignature`:{let e=this.decodeKeyRelatedParams(o),t=o.readUInt8();if(t===1){let t=o.readVarIntNum();e.data=o.read(t)}else t===2&&(e.hashToDirectlySign=o.read(32));let n=o.readInt8();n>=0?e.seekPermission=n===1:e.seekPermission=void 0;let r=await this.wallet.createSignature(e,a),i=new L;return i.writeUInt8(0),i.write(r.signature),i.toArray()}case`verifySignature`:{let e=this.decodeKeyRelatedParams(o),t=o.readInt8();t===-1?e.forSelf=void 0:e.forSelf=t===1;let n=o.readVarIntNum();e.signature=o.read(n);let r=o.readUInt8();if(r===1){let t=o.readVarIntNum();e.data=o.read(t)}else r===2&&(e.hashToDirectlyVerify=o.read(32));let i=o.readInt8();i>=0?e.seekPermission=i===1:e.seekPermission=void 0,await this.wallet.verifySignature(e,a);let s=new L;return s.writeUInt8(0),s.toArray()}case`isAuthenticated`:{let e=await this.wallet.isAuthenticated({},a),t=new L;return t.writeUInt8(0),t.writeUInt8(e.authenticated?1:0),t.toArray()}case`waitForAuthentication`:{await this.wallet.waitForAuthentication({},a);let e=new L;return e.writeUInt8(0),e.toArray()}case`getHeight`:{let e=await this.wallet.getHeight({},a),t=new L;return t.writeUInt8(0),t.writeVarIntNum(e.height),t.toArray()}case`getHeaderForHeight`:{let e={};e.height=o.readVarIntNum();let t=await this.wallet.getHeaderForHeight(e,a),n=new L;n.writeUInt8(0);let r=F(t.header,`hex`);return n.write(r),n.toArray()}case`getNetwork`:{let e=await this.wallet.getNetwork({},a),t=new L;return t.writeUInt8(0),t.writeUInt8(e.network===`mainnet`?0:1),t.toArray()}case`getVersion`:{let e=await this.wallet.getVersion({},a),t=new L;t.writeUInt8(0);let n=F(e.version,`utf8`);return t.write(n),t.toArray()}case`revealCounterpartyKeyLinkage`:{let e={},t=o.readInt8();t===-1?e.privileged=void 0:e.privileged=t===1;let n=o.readInt8();if(n===-1)e.privilegedReason=void 0;else{let t=o.read(n);e.privilegedReason=I(t)}let r=o.read(33);e.counterparty=P(r);let i=o.read(33);e.verifier=P(i);let s=await this.wallet.revealCounterpartyKeyLinkage(e,a),c=new L;c.write(F(s.prover,`hex`)),c.write(F(s.verifier,`hex`)),c.write(F(s.counterparty,`hex`));let l=F(s.revelationTime,`utf8`);c.writeVarIntNum(l.length),c.write(l),c.writeVarIntNum(s.encryptedLinkage.length),c.write(s.encryptedLinkage),c.writeVarIntNum(s.encryptedLinkageProof.length),c.write(s.encryptedLinkageProof);let u=new L;return u.writeUInt8(0),u.write(c.toArray()),u.toArray()}case`revealSpecificKeyLinkage`:{let e=this.decodeKeyRelatedParams(o),t=o.read(33);e.verifier=P(t);let n=await this.wallet.revealSpecificKeyLinkage(e,a),r=new L;r.write(F(n.prover,`hex`)),r.write(F(n.verifier,`hex`)),r.write(F(n.counterparty,`hex`)),r.writeUInt8(n.protocolID[0]);let i=F(n.protocolID[1],`utf8`);r.writeVarIntNum(i.length),r.write(i);let s=F(n.keyID,`utf8`);r.writeVarIntNum(s.length),r.write(s),r.writeVarIntNum(n.encryptedLinkage.length),r.write(n.encryptedLinkage),r.writeVarIntNum(n.encryptedLinkageProof.length),r.write(n.encryptedLinkageProof),r.writeUInt8(n.proofType);let c=new L;return c.writeUInt8(0),c.write(r.toArray()),c.toArray()}case`acquireCertificate`:{let e={},t=o.read(32);e.type=Br(t);let n=o.read(33);e.certifier=P(n);let r=o.readVarIntNum();e.fields={};for(let t=0;t<r;t++){let t=o.readVarIntNum(),n=o.read(t),r=I(n),i=o.readVarIntNum(),a=o.read(i),s=I(a);e.fields[r]=s}let i=o.readInt8();i===-1?e.privileged=void 0:e.privileged=i===1;let s=o.readInt8();if(s===-1)e.privilegedReason=void 0;else{let t=o.read(s);e.privilegedReason=I(t)}if(e.acquisitionProtocol=o.readUInt8()===1?`direct`:`issuance`,e.acquisitionProtocol===`direct`){let t=o.read(32);e.serialNumber=Br(t),e.revocationOutpoint=this.decodeOutpoint(o);let n=o.readVarIntNum(),r=o.read(n);e.signature=P(r);let i=o.readUInt8();if(i===11)e.keyringRevealer=`certifier`;else{let t=[i].concat(o.read(32));e.keyringRevealer=P(t)}let a=o.readVarIntNum();e.keyringForSubject={};for(let t=0;t<a;t++){let t=o.readVarIntNum(),n=o.read(t),r=I(n),i=o.readVarIntNum(),a=o.read(i),s=Br(a);e.keyringForSubject[r]=s}}else{let t=o.readVarIntNum(),n=o.read(t);e.certifierUrl=I(n)}let c=await this.wallet.acquireCertificate(e,a),l=new Go(c.type,c.serialNumber,c.subject,c.certifier,c.revocationOutpoint,c.fields,c.signature).toBinary(),u=new L;return u.writeUInt8(0),u.write(l),u.toArray()}case`listCertificates`:{let e={},t=o.readVarIntNum();e.certifiers=[];for(let n=0;n<t;n++){let t=o.read(33);e.certifiers.push(P(t))}let n=o.readVarIntNum();e.types=[];for(let t=0;t<n;t++){let t=o.read(32);e.types.push(Br(t))}let r=o.readVarIntNum();r>=0?e.limit=r:e.limit=void 0;let i=o.readVarIntNum();i>=0?e.offset=i:e.offset=void 0;let s=o.readInt8();s===-1?e.privileged=void 0:e.privileged=s===1;let c=o.readInt8();if(c===-1)e.privilegedReason=void 0;else{let t=o.read(c);e.privilegedReason=I(t)}let l=await this.wallet.listCertificates(e,a),u=new L;u.writeVarIntNum(l.totalCertificates);for(let e of l.certificates){let t=new Go(e.type,e.serialNumber,e.subject,e.certifier,e.revocationOutpoint,e.fields,e.signature).toBinary();u.writeVarIntNum(t.length),u.write(t)}let d=new L;return d.writeUInt8(0),d.write(u.toArray()),d.toArray()}case`proveCertificate`:{let e={},t={},n=o.read(32);t.type=Br(n);let r=o.read(33);t.subject=P(r);let i=o.read(32);t.serialNumber=Br(i);let s=o.read(33);t.certifier=P(s),t.revocationOutpoint=this.decodeOutpoint(o);let c=o.readVarIntNum(),l=o.read(c);t.signature=P(l);let u=o.readVarIntNum();t.fields={};for(let e=0;e<u;e++){let e=o.readVarIntNum(),n=o.read(e),r=I(n),i=o.readVarIntNum(),a=o.read(i),s=I(a);t.fields[r]=s}e.certificate=t;let d=o.readVarIntNum();e.fieldsToReveal=[];for(let t=0;t<d;t++){let t=o.readVarIntNum(),n=o.read(t),r=I(n);e.fieldsToReveal.push(r)}let f=o.read(33);e.verifier=P(f);let p=o.readInt8();p===-1?e.privileged=void 0:e.privileged=p===1;let m=o.readInt8();if(m===-1)e.privilegedReason=void 0;else{let t=o.read(m);e.privilegedReason=I(t)}let h=await this.wallet.proveCertificate(e,a),g=new L,_=Object.entries(h.keyringForVerifier);g.writeVarIntNum(_.length);for(let[e,t]of _){let n=F(e,`utf8`);g.writeVarIntNum(n.length),g.write(n);let r=F(t,`base64`);g.writeVarIntNum(r.length),g.write(r)}let v=new L;return v.writeUInt8(0),v.write(g.toArray()),v.toArray()}case`relinquishCertificate`:{let e={},t=o.read(32);e.type=Br(t);let n=o.read(32);e.serialNumber=Br(n);let r=o.read(33);e.certifier=P(r),await this.wallet.relinquishCertificate(e,a);let i=new L;return i.writeUInt8(0),i.toArray()}case`discoverByIdentityKey`:{let e={},t=o.read(33);e.identityKey=P(t);let n=o.readVarIntNum();n>=0?e.limit=n:e.limit=void 0;let r=o.readVarIntNum();r>=0?e.offset=r:e.offset=void 0;let i=o.readInt8();i>=0?e.seekPermission=i===1:e.seekPermission=void 0;let s=await this.wallet.discoverByIdentityKey(e,a),c=this.serializeDiscoveryResult(s),l=new L;return l.writeUInt8(0),l.write(c),l.toArray()}case`discoverByAttributes`:{let e={},t=o.readVarIntNum();e.attributes={};for(let n=0;n<t;n++){let t=o.readVarIntNum(),n=o.read(t),r=I(n),i=o.readVarIntNum(),a=o.read(i),s=I(a);e.attributes[r]=s}let n=o.readVarIntNum();n>=0?e.limit=n:e.limit=void 0;let r=o.readVarIntNum();r>=0?e.offset=r:e.offset=void 0;let i=o.readInt8();i>=0?e.seekPermission=i===1:e.seekPermission=void 0;let s=await this.wallet.discoverByAttributes(e,a),c=this.serializeDiscoveryResult(s),l=new L;return l.writeUInt8(0),l.write(c),l.toArray()}default:throw Error(`Method ${n} not implemented`)}}catch(e){let t=new L;t.writeUInt8(typeof e.code==`number`?e.code:1);let n=typeof e.message==`string`?e.message:`Unknown error`,r=F(n,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=typeof e.stack==`string`?e.stack:``,a=F(i,`utf8`);return t.writeVarIntNum(a.length),t.write(a),t.toArray()}}decodeProtocolID(e){let t=e.readUInt8(),n=e.readVarIntNum(),r=e.read(n),i=I(r);return[t,i]}decodeString(e){let t=e.readVarIntNum(),n=e.read(t);return I(n)}decodeCounterparty(e){let t=e.readUInt8();if(t===11)return`self`;if(t===12)return`anyone`;if(t!==0){let n=e.read(32);return P([t,...n])}}serializeDiscoveryResult(e){let t=new L;t.writeVarIntNum(e.totalCertificates);for(let n of e.certificates){let e=new Go(n.type,n.serialNumber,n.subject,n.certifier,n.revocationOutpoint,n.fields,n.signature).toBinary();t.writeVarIntNum(e.length),t.write(e);let r=F(n.certifierInfo.name,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=F(n.certifierInfo.iconUrl,`utf8`);t.writeVarIntNum(i.length),t.write(i);let a=F(n.certifierInfo.description,`utf8`);t.writeVarIntNum(a.length),t.write(a),t.writeUInt8(n.certifierInfo.trust);let o=Object.entries(n.publiclyRevealedKeyring);t.writeVarIntNum(o.length);for(let[e,n]of o){let r=F(e,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=F(n,`base64`);t.writeVarIntNum(i.length),t.write(i)}let s=Object.entries(n.decryptedFields);t.writeVarIntNum(s.length);for(let[e,n]of s){let r=F(e,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=F(n,`utf8`);t.writeVarIntNum(i.length),t.write(i)}}return t.toArray()}decodeKeyRelatedParams(e){let t={};t.protocolID=this.decodeProtocolID(e);let n=e.readVarIntNum(),r=e.read(n);t.keyID=I(r),t.counterparty=this.decodeCounterparty(e);let i=e.readInt8();i===-1?t.privileged=void 0:t.privileged=i===1;let a=e.readInt8();if(a===-1)t.privilegedReason=void 0;else{let n=e.read(a);t.privilegedReason=I(n)}return t}},os=class e extends Go{masterKeyring;constructor(e,t,n,r,i,a,o,s){super(e,t,n,r,i,a,s);for(let e of Object.keys(a))if(o[e]===void 0||o[e]===``)throw Error(`Master keyring must contain a value for every field. Missing or empty key for field: "${e}".`);this.masterKeyring=o}static async createCertificateFields(e,t,n,r,i){let a={},o={};for(let[s,c]of Object.entries(n)){let n=fa.fromRandom(),l=n.encrypt(F(c,`utf8`));a[s]=Br(l);let{ciphertext:u}=await e.encrypt({plaintext:n.toArray(),...Go.getCertificateFieldEncryptionDetails(s),counterparty:t,privileged:r,privilegedReason:i});o[s]=Br(u)}return{certificateFields:a,masterKeyring:o}}static async createKeyringForVerifier(e,t,n,r,i,a,o,s,c){if(!Array.isArray(i))throw Error(`fieldsToReveal must be an array of strings`);let l={};for(let u of i){if(r[u]===void 0||r[u]===null||r[u]===``)throw Error(`Fields to reveal must be a subset of the certificate fields. Missing the "${u}" field.`);let i=(await this.decryptField(e,a,u,r[u],t,s,c)).fieldRevelationKey,{ciphertext:d}=await e.encrypt({plaintext:i,...Go.getCertificateFieldEncryptionDetails(u,o),counterparty:n,privileged:s,privilegedReason:c});l[u]=Br(d)}return l}static async issueCertificateForSubject(t,n,r,i,a=async e=>`Certificate revocation not tracked.`,o){let s=o??Br(Ri(32)),{certificateFields:c,masterKeyring:l}=await this.createCertificateFields(t,n,r),u=await a(s),d=new e(i,s,n,(await t.getPublicKey({identityKey:!0})).publicKey,u,c,l);return await d.sign(t),d}static async decryptFields(e,t,n,r,i,a){if(t==null||Object.keys(t).length===0)throw Error(`A MasterCertificate must have a valid masterKeyring!`);try{let o={};for(let s of Object.keys(n))o[s]=(await this.decryptField(e,t,s,n[s],r,i,a)).decryptedFieldValue;return o}catch{throw Error(`Failed to decrypt all master certificate fields.`)}}static async decryptField(e,t,n,r,i,a,o){if(t==null||Object.keys(t).length===0)throw Error(`A MasterCertificate must have a valid masterKeyring!`);try{let{plaintext:s}=await e.decrypt({ciphertext:F(t[n],`base64`),...Go.getCertificateFieldEncryptionDetails(n),counterparty:i,privileged:a,privilegedReason:o}),c=new fa(s).decrypt(F(r,`base64`));return{fieldRevelationKey:s,decryptedFieldValue:I(c)}}catch{throw Error(`Failed to decrypt certificate field!`)}}},ss=class e extends Go{keyring;decryptedFields;constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,r,i,a,s),this.keyring=o,this.decryptedFields=c}static fromCertificate(t,n){return new e(t.type,t.serialNumber,t.subject,t.certifier,t.revocationOutpoint,t.fields,n,t.signature)}async decryptFields(e,t,n){if(this.keyring==null||Object.keys(this.keyring).length===0)throw Error(`A keyring is required to decrypt certificate fields for the verifier.`);try{let r={};for(let i in this.keyring){let{plaintext:a}=await e.decrypt({ciphertext:F(this.keyring[i],`base64`),...Go.getCertificateFieldEncryptionDetails(i,this.serialNumber),counterparty:this.subject,privileged:t,privilegedReason:n}),o=new fa(a).decrypt(F(this.fields[i],`base64`));r[i]=I(o)}return r}catch(e){throw Error(`Failed to decrypt selectively revealed certificate fields using keyring: ${String(e instanceof Error?e.message:e)}`)}}},cs=class extends zo{keyDeriver;constructor(e){if(super(e),e instanceof Lo)this.keyDeriver=e;else if(typeof e==`string`||e instanceof Hi)this.keyDeriver=new Ro(e);else throw Error(`Invalid key deriver provided`)}async isAuthenticated(){throw Error(`not implemented`)}async waitForAuthentication(){throw Error(`not implemented`)}async getNetwork(){throw Error(`not implemented`)}async getVersion(){throw Error(`not implemented`)}async getPublicKey(e){if(e.privileged===!0)throw Error(`no privilege support`);if(e.identityKey===!0){if(this.keyDeriver===null||this.keyDeriver===void 0)throw Error(`keyDeriver is not initialized`);return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}else{if(e.protocolID==null||typeof e.keyID!=`string`||e.keyID.trim()===``)throw Error(`protocolID and keyID are required if identityKey is false or undefined.`);if(this.keyDeriver===null||this.keyDeriver===void 0)throw Error(`keyDeriver is not initialized`);return{publicKey:this.keyDeriver.derivePublicKey(e.protocolID,e.keyID,typeof e.counterparty==`string`&&e.counterparty.trim()!==``?e.counterparty:`self`,!!e.forSelf).toString()}}}async createAction(){throw Error(`not implemented`)}async signAction(){throw Error(`not implemented`)}async abortAction(){throw Error(`not implemented`)}async listActions(){throw Error(`not implemented`)}async internalizeAction(){throw Error(`not implemented`)}async listOutputs(){throw Error(`not implemented`)}async relinquishOutput(){throw Error(`not implemented`)}async acquireCertificate(){throw Error(`not implemented`)}async listCertificates(){throw Error(`not implemented`)}async proveCertificate(){throw Error(`not implemented`)}async relinquishCertificate(){throw Error(`not implemented`)}async discoverByIdentityKey(){throw Error(`not implemented`)}async discoverByAttributes(){throw Error(`not implemented`)}async getHeight(){throw Error(`not implemented`)}async getHeaderForHeight(){throw Error(`not implemented`)}},ls=class{sessionNonceToSession;identityKeyToNonces;constructor(){this.sessionNonceToSession=new Map,this.identityKeyToNonces=new Map}addSession(e){if(typeof e.sessionNonce!=`string`)throw Error(`Invalid session: sessionNonce is required to add a session.`);if(this.sessionNonceToSession.set(e.sessionNonce,e),typeof e.peerIdentityKey==`string`){let t=this.identityKeyToNonces.get(e.peerIdentityKey);t??(t=new Set,this.identityKeyToNonces.set(e.peerIdentityKey,t)),t.add(e.sessionNonce)}}updateSession(e){this.removeSession(e),this.addSession(e)}getSession(e){let t=this.sessionNonceToSession.get(e);if(t!=null)return t;let n=this.identityKeyToNonces.get(e);if(n==null||n.size===0)return;let r;for(let e of n){let t=this.sessionNonceToSession.get(e);t!=null&&(r==null||(t.lastUpdate??0)>(r.lastUpdate??0))&&(r=t)}return r}removeSession(e){if(typeof e.sessionNonce==`string`&&this.sessionNonceToSession.delete(e.sessionNonce),typeof e.peerIdentityKey==`string`){let t=this.identityKeyToNonces.get(e.peerIdentityKey);t!=null&&(t.delete(e.sessionNonce??``),t.size===0&&this.identityKeyToNonces.delete(e.peerIdentityKey))}}hasSession(e){if(this.sessionNonceToSession.has(e))return!0;let t=this.identityKeyToNonces.get(e);return t!=null&&t.size>0}};async function us(e,t,n=`self`){let r=F(e,`base64`),i=r.slice(0,16),a=r.slice(16),{valid:o}=await t.verifyHmac({data:i,hmac:a,protocolID:[2,`server hmac`],keyID:I(i),counterparty:n});return o}async function ds(e,t=`self`){let n=Ri(16),{hmac:r}=await e.createHmac({protocolID:[2,`server hmac`],keyID:I(n),data:n,counterparty:t}),i=[...n,...r];return Br(i)}const fs=async(e,t,n)=>{let r=await e.listCertificates({certifiers:t.certifiers,types:Object.keys(t.types)});return await Promise.all(r.certificates.map(async r=>{let{keyringForVerifier:i}=await e.proveCertificate({certificate:r,fieldsToReveal:t.types[r.type],verifier:n});return new ss(r.type,r.serialNumber,r.subject,r.certifier,r.revocationOutpoint,r.fields,i,r.signature)}))},ps=async(e,t,n)=>{if(t.certificates==null||t.certificates.length===0)throw Error(`No certificates were provided in the AuthMessage.`);await Promise.all(t.certificates.map(async r=>{if(r.subject!==t.identityKey)throw Error(`The subject of one of your certificates ("${r.subject}") is not the same as the request sender ("${t.identityKey}").`);let i=new ss(r.type,r.serialNumber,r.subject,r.certifier,r.revocationOutpoint,r.fields,r.keyring,r.signature);if(!await i.verify())throw Error(`The signature for the certificate with serial number ${i.serialNumber} is invalid!`);if(n!=null){let{certifiers:e,types:t}=n;if(!e.includes(i.certifier))throw Error(`Certificate with serial number ${i.serialNumber} has an unrequested certifier: ${i.certifier}`);if(t[i.type]==null)throw Error(`Certificate with type ${i.type} was not requested`)}await i.decryptFields(e)}))};var ms=`0.1`,hs=class{sessionManager;transport;wallet;certificatesToRequest;onGeneralMessageReceivedCallbacks=new Map;onCertificatesReceivedCallbacks=new Map;onCertificateRequestReceivedCallbacks=new Map;onInitialResponseReceivedCallbacks=new Map;callbackIdCounter=0;autoPersistLastSession=!0;lastInteractedWithPeer;constructor(e,t,n,r,i){this.wallet=e,this.transport=t,this.certificatesToRequest=n??{certifiers:[],types:{}},this.transport.onData(this.handleIncomingMessage.bind(this)).catch(e=>{throw e}),this.sessionManager=r??new ls,i===!1?this.autoPersistLastSession=!1:this.autoPersistLastSession=!0}async toPeer(e,t,n){this.autoPersistLastSession&&typeof this.lastInteractedWithPeer==`string`&&typeof t!=`string`&&(t=this.lastInteractedWithPeer);let r=await this.getAuthenticatedSession(t,n),i=Br(Ri(32)),{signature:a}=await this.wallet.createSignature({data:e,protocolID:[2,`auth message signature`],keyID:`${i} ${r.peerNonce??``}`,counterparty:r.peerIdentityKey}),o={version:ms,messageType:`general`,identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,nonce:i,yourNonce:r.peerNonce,payload:e,signature:a};r.lastUpdate=Date.now(),this.sessionManager.updateSession(r);try{await this.transport.send(o)}catch(e){let t=Error(`Failed to send message to peer ${r.peerIdentityKey??`unknown`}: ${String(e.message)}`);throw t.stack=e.stack,t}}async requestCertificates(e,t,n=1e4){this.autoPersistLastSession&&typeof this.lastInteractedWithPeer==`string`&&typeof t!=`string`&&(t=this.lastInteractedWithPeer);let r=await this.getAuthenticatedSession(t,n),i=Br(Ri(32)),{signature:a}=await this.wallet.createSignature({data:F(JSON.stringify(e),`utf8`),protocolID:[2,`auth message signature`],keyID:`${i} ${r.peerNonce??``}`,counterparty:r.peerIdentityKey}),o={version:ms,messageType:`certificateRequest`,identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,nonce:i,initialNonce:r.sessionNonce,yourNonce:r.peerNonce,requestedCertificates:e,signature:a};r.lastUpdate=Date.now(),this.sessionManager.updateSession(r);try{await this.transport.send(o)}catch(e){throw Error(`Failed to send certificate request message to peer ${r.peerIdentityKey??`unknown`}: ${String(e.message)}`)}}async getAuthenticatedSession(e,t){if(this.transport===void 0)throw Error(`Peer transport is not connected!`);let n;if(typeof e==`string`&&(n=this.sessionManager.getSession(e)),n==null||!n.isAuthenticated){let r=await this.initiateHandshake(e,t);if(n=this.sessionManager.getSession(r),n==null||!n.isAuthenticated)throw Error(`Unable to establish mutual authentication with peer!`)}return n}listenForGeneralMessages(e){let t=this.callbackIdCounter++;return this.onGeneralMessageReceivedCallbacks.set(t,e),t}stopListeningForGeneralMessages(e){this.onGeneralMessageReceivedCallbacks.delete(e)}listenForCertificatesReceived(e){let t=this.callbackIdCounter++;return this.onCertificatesReceivedCallbacks.set(t,e),t}stopListeningForCertificatesReceived(e){this.onCertificatesReceivedCallbacks.delete(e)}listenForCertificatesRequested(e){let t=this.callbackIdCounter++;return this.onCertificateRequestReceivedCallbacks.set(t,e),t}stopListeningForCertificatesRequested(e){this.onCertificateRequestReceivedCallbacks.delete(e)}async initiateHandshake(e,t=1e4){let n=await ds(this.wallet),r=Date.now();this.sessionManager.addSession({isAuthenticated:!1,sessionNonce:n,peerIdentityKey:e,lastUpdate:r});let i={version:ms,messageType:`initialRequest`,identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,initialNonce:n,requestedCertificates:this.certificatesToRequest};return await this.transport.send(i),await this.waitForInitialResponse(n,t)}async waitForInitialResponse(e,t=1e4){return await new Promise((n,r)=>{let i=this.listenForInitialResponse(e,e=>{clearTimeout(a),this.stopListeningForInitialResponses(i),n(e)}),a=setTimeout(()=>{this.stopListeningForInitialResponses(i),r(Error(`Initial response timed out.`))},t)})}listenForInitialResponse(e,t){let n=this.callbackIdCounter++;return this.onInitialResponseReceivedCallbacks.set(n,{callback:t,sessionNonce:e}),n}stopListeningForInitialResponses(e){this.onInitialResponseReceivedCallbacks.delete(e)}async handleIncomingMessage(e){if(typeof e.version!=`string`||e.version!==ms)throw Error(`Invalid or unsupported message auth version! Received: ${e.version}, expected: ${ms}`);switch(e.messageType){case`initialRequest`:await this.processInitialRequest(e);break;case`initialResponse`:await this.processInitialResponse(e);break;case`certificateRequest`:await this.processCertificateRequest(e);break;case`certificateResponse`:await this.processCertificateResponse(e);break;case`general`:await this.processGeneralMessage(e);break;default:throw Error(`Unknown message type of ${String(e.messageType)} from ${String(e.identityKey)}`)}}async processInitialRequest(e){if(typeof e.identityKey!=`string`||typeof e.initialNonce!=`string`||e.initialNonce===``)throw Error(`Missing required fields in initialRequest message.`);let t=await ds(this.wallet),n=Date.now();this.sessionManager.addSession({isAuthenticated:!0,sessionNonce:t,peerNonce:e.initialNonce,peerIdentityKey:e.identityKey,lastUpdate:n});let r;e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0&&(this.onCertificateRequestReceivedCallbacks.size>0?this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)}):r=await fs(this.wallet,e.requestedCertificates,e.identityKey));let{signature:i}=await this.wallet.createSignature({data:F(e.initialNonce+t,`base64`),protocolID:[2,`auth message signature`],keyID:`${e.initialNonce} ${t}`,counterparty:e.identityKey}),a={version:ms,messageType:`initialResponse`,identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,initialNonce:t,yourNonce:e.initialNonce,certificates:r,requestedCertificates:this.certificatesToRequest,signature:i};this.lastInteractedWithPeer===void 0&&(this.lastInteractedWithPeer=e.identityKey),await this.transport.send(a)}async processInitialResponse(e){if(!await us(e.yourNonce,this.wallet))throw Error(`Initial response nonce verification failed from peer: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Peer session not found for peer: ${e.identityKey}`);let n=F((t.sessionNonce??``)+(e.initialNonce??``),`base64`),{valid:r}=await this.wallet.verifySignature({data:n,signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${t.sessionNonce??``} ${e.initialNonce??``}`,counterparty:e.identityKey});if(!r)throw Error(`Unable to verify initial response signature for peer: ${e.identityKey}`);if(t.peerNonce=e.initialNonce,t.peerIdentityKey=e.identityKey,t.isAuthenticated=!0,t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),this.certificatesToRequest?.certifiers?.length>0&&e.certificates?.length>0&&(await ps(this.wallet,e,this.certificatesToRequest),this.onCertificatesReceivedCallbacks.forEach(t=>t(e.identityKey,e.certificates))),this.lastInteractedWithPeer=e.identityKey,this.onInitialResponseReceivedCallbacks.forEach(e=>{e.sessionNonce===t.sessionNonce&&e.callback(t.sessionNonce)}),e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)});else{let t=await fs(this.wallet,e.requestedCertificates,e.identityKey);await this.sendCertificateResponse(e.identityKey,t)}}async processCertificateRequest(e){if(!await us(e.yourNonce,this.wallet))throw Error(`Unable to verify nonce for certificate request message from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:F(JSON.stringify(e.requestedCertificates),`utf8`),signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:t.peerIdentityKey});if(!n)throw Error(`Invalid signature in certificate request message from ${t.peerIdentityKey}`);if(t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)});else{let t=await fs(this.wallet,e.requestedCertificates,e.identityKey);await this.sendCertificateResponse(e.identityKey,t)}}async sendCertificateResponse(e,t){let n=await this.getAuthenticatedSession(e),r=Br(Ri(32)),{signature:i}=await this.wallet.createSignature({data:F(JSON.stringify(t),`utf8`),protocolID:[2,`auth message signature`],keyID:`${r} ${n.peerNonce??``}`,counterparty:n.peerIdentityKey}),a={version:ms,messageType:`certificateResponse`,identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,nonce:r,initialNonce:n.sessionNonce,yourNonce:n.peerNonce,certificates:t,signature:i};n.lastUpdate=Date.now(),this.sessionManager.updateSession(n);try{await this.transport.send(a)}catch(e){let t=e instanceof Error?e.message:String(e);throw Error(`Failed to send certificate response message to peer ${n.peerIdentityKey??`unknown`}: ${t}`)}}async processCertificateResponse(e){if(!await us(e.yourNonce,this.wallet))throw Error(`Unable to verify nonce for certificate response from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:F(JSON.stringify(e.certificates),`utf8`),signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:e.identityKey});if(!n)throw Error(`Unable to verify certificate response signature for peer: ${e.identityKey}`);await ps(this.wallet,e,e.requestedCertificates),this.onCertificatesReceivedCallbacks.forEach(t=>{t(e.identityKey,e.certificates??[])}),t.lastUpdate=Date.now(),this.sessionManager.updateSession(t)}async processGeneralMessage(e){if(!await us(e.yourNonce,this.wallet))throw Error(`Unable to verify nonce for general message from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:e.payload,signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:t.peerIdentityKey});if(!n)throw Error(`Invalid signature in generalMessage from ${t.peerIdentityKey}`);t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),this.lastInteractedWithPeer=e.identityKey,this.onGeneralMessageReceivedCallbacks.forEach(t=>{t(e.identityKey,e.payload??[])})}},gs=typeof window<`u`?fetch.bind(window):fetch,_s=class{onDataCallback;fetchClient;baseUrl;constructor(e,t=gs){this.fetchClient=t,this.baseUrl=e}async send(e){if(this.onDataCallback==null)throw Error(`Listen before you start speaking. God gave you two ears and one mouth for a reason.`);if(e.messageType!==`general`)return await new Promise((t,n)=>{(async()=>{try{let n=this.fetchClient(`${this.baseUrl}/.well-known/auth`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(e)});e.messageType!==`initialRequest`&&t();let r=await n;if(r.ok&&this.onDataCallback!=null){let e=await r.json();this.onDataCallback(e)}else throw Error(`HTTP server failed to authenticate`);e.messageType===`initialRequest`&&t()}catch(e){n(e)}})()});{let t=this.deserializeRequestPayload(e.payload),n=`${this.baseUrl}${t.urlPostfix}`,r=t;if(typeof t.headers!=`object`&&(r.headers={}),r.headers[`x-bsv-auth-version`]=e.version,r.headers[`x-bsv-auth-identity-key`]=e.identityKey,r.headers[`x-bsv-auth-nonce`]=e.nonce,r.headers[`x-bsv-auth-your-nonce`]=e.yourNonce,r.headers[`x-bsv-auth-signature`]=P(e.signature),r.headers[`x-bsv-auth-request-id`]=t.requestId,r.body!=null){let e=r.headers;if(e[`content-type`]==null)throw Error(`Content-Type header is required for requests with a body.`);let t=String(e[`content-type`]??``);t.includes(`application/json`)||t.includes(`application/x-www-form-urlencoded`)||t.includes(`text/plain`)?r.body=I(r.body):r.body=new Uint8Array(r.body)}let i=await this.fetchClient(n,{method:r.method,headers:r.headers,body:r.body});if(i.status===500&&i.headers.get(`x-bsv-auth-request-id`)==null&&i.headers.get(`x-bsv-auth-requested-certificates`)==null){let e=await i.json();throw Error(`HTTP ${i.status} - ${JSON.stringify(e)}`)}let a=await i.arrayBuffer(),o=new L;i.headers.get(`x-bsv-auth-request-id`)!=null&&o.write(F(i.headers.get(`x-bsv-auth-request-id`),`base64`)),o.writeVarIntNum(i.status);let s=[];i.headers.forEach((e,t)=>{let n=t.toLowerCase();(n.startsWith(`x-bsv-`)||n===`authorization`)&&!n.startsWith(`x-bsv-auth`)&&s.push([n,e])}),s.sort(([e],[t])=>e.localeCompare(t)),o.writeVarIntNum(s.length);for(let e=0;e<s.length;e++){let t=F(s[e][0],`utf8`);o.writeVarIntNum(t.length),o.write(t);let n=F(s[e][1],`utf8`);o.writeVarIntNum(n.length),o.write(n)}if(a!=null){let e=Array.from(new Uint8Array(a));o.writeVarIntNum(e.length),o.write(e)}else o.writeVarIntNum(-1);let c={version:i.headers.get(`x-bsv-auth-version`),messageType:i.headers.get(`x-bsv-auth-message-type`)===`certificateRequest`?`certificateRequest`:`general`,identityKey:i.headers.get(`x-bsv-auth-identity-key`),nonce:i.headers.get(`x-bsv-auth-nonce`),yourNonce:i.headers.get(`x-bsv-auth-your-nonce`),requestedCertificates:JSON.parse(i.headers.get(`x-bsv-auth-requested-certificates`)),payload:o.toArray(),signature:F(i.headers.get(`x-bsv-auth-signature`),`hex`)};if(c.version==null)throw Error(`HTTP server failed to authenticate`);this.onDataCallback(c)}}async onData(e){this.onDataCallback=t=>{e(t)}}deserializeRequestPayload(e){let t=new Kr(e),n=Br(t.read(32)),r=t.readVarIntNum(),i=`GET`;r>0&&(i=I(t.read(r)));let a=t.readVarIntNum(),o=``;a>0&&(o=I(t.read(a)));let s=t.readVarIntNum(),c=``;s>0&&(c=I(t.read(s)));let l={},u=t.readVarIntNum();if(u>0)for(let e=0;e<u;e++){let e=t.readVarIntNum(),n=t.read(e),r=I(n),i=t.readVarIntNum(),a=t.read(i);l[r]=I(a)}let d,f=t.readVarIntNum();return f>0&&(d=t.read(f)),{urlPostfix:o+c,method:i,headers:l,body:d,requestId:n}}},vs=`1.0`,ys=class{sessionManager;wallet;callbacks={};certificatesReceived=[];requestedCertificates;peers={};constructor(e,t,n){this.wallet=e,this.requestedCertificates=t,this.sessionManager=n||new ls}async fetch(e,t={}){if(typeof t.retryCounter==`number`){if(t.retryCounter<=0)throw Error(`Request failed after maximum number of retries.`);t.retryCounter--}let n=await new Promise((async(n,r)=>{try{let{method:i=`GET`,headers:a={},body:o}=t,s=new URL(e),c=s.origin,l;if(this.peers[c]===void 0){let e=new _s(c);l={peer:new hs(this.wallet,e,this.requestedCertificates,this.sessionManager),pendingCertificateRequests:[]},this.peers[c]=l,this.peers[c].peer.listenForCertificatesReceived((e,t)=>{this.certificatesReceived.push(...t)}),this.peers[c].peer.listenForCertificatesRequested((async(e,t)=>{try{this.peers[c].pendingCertificateRequests.push(!0);let n=await fs(this.wallet,t,e);await this.peers[c].peer.sendCertificateResponse(e,n)}finally{await new Promise(e=>setTimeout(e,500)),this.peers[c].pendingCertificateRequests.shift()}}))}else{if(this.peers[c].supportsMutualAuth===!1){try{let r=await this.handleFetchAndValidate(e,t,this.peers[c]);n(r)}catch(e){r(e)}return}l=this.peers[c]}let u=Ri(32),d=Br(u),f=await this.serializeRequest(i,a,o,s,u);this.callbacks[d]={resolve:n,reject:r};let p=l.peer.listenForGeneralMessages((e,t)=>{let n=new Kr(t);if(Br(n.read(32))!==d)return;l.peer.stopListeningForGeneralMessages(p),this.peers[c].identityKey=e,this.peers[c].supportsMutualAuth=!0;let r=n.readVarIntNum(),i={},a=n.readVarIntNum();if(a>0)for(let e=0;e<a;e++){let e=n.readVarIntNum(),t=n.read(e),r=I(t),a=n.readVarIntNum(),o=n.read(a);i[r]=I(o)}i[`x-bsv-auth-identity-key`]=e;let o,s=n.readVarIntNum();s>0&&(o=n.read(s));let u=new Response(o?new Uint8Array(o):null,{status:r,statusText:`${r}`,headers:new Headers(i)});this.callbacks[d].resolve(u),delete this.callbacks[d]});l.pendingCertificateRequests.length>0&&await new Promise(e=>{setInterval(()=>{l.pendingCertificateRequests.length===0&&e()},100)}),await l.peer.toPeer(f.toArray(),l.identityKey).catch(async i=>{if(i.message.includes(`Session not found for nonce`)){delete this.peers[c],t.retryCounter??=3;let r=await this.fetch(e,t);n(r);return}if(i.message.includes(`HTTP server failed to authenticate`))try{let r=await this.handleFetchAndValidate(e,t,l);n(r);return}catch(e){r(e)}else r(i)})}catch(e){r(e)}}));return n.status===402?await this.handlePaymentAndRetry(e,t,n):n}async sendCertificateRequest(e,t){let n=new URL(e).origin,r;if(this.peers[n]!==void 0)r={peer:this.peers[n].peer};else{let e=new _s(n);r={peer:new hs(this.wallet,e,this.requestedCertificates,this.sessionManager)},this.peers[n]=r}return await new Promise((async(e,n)=>{let i=r.peer.listenForCertificatesReceived((t,n)=>{r.peer.stopListeningForCertificatesReceived(i),this.certificatesReceived.push(...n),e(n)});try{await r.peer.requestCertificates(t,r.identityKey)}catch(e){r.peer.stopListeningForCertificatesReceived(i),n(e)}}))}consumeReceivedCertificates(){return this.certificatesReceived.splice(0)}async serializeRequest(e,t,n,r,i){let a=new L;if(a.write(i),a.writeVarIntNum(e.length),a.write(F(e)),r.pathname.length>0){let e=F(r.pathname);a.writeVarIntNum(e.length),a.write(e)}else a.writeVarIntNum(-1);if(r.search.length>0){let e=F(r.search);a.writeVarIntNum(e.length),a.write(e)}else a.writeVarIntNum(-1);let o=[];for(let[e,n]of Object.entries(t))if(e=e.toLowerCase(),e.startsWith(`x-bsv-`)||e===`authorization`){if(e.startsWith(`x-bsv-auth`))throw Error(`No BSV auth headers allowed here!`);o.push([e,n])}else if(e.startsWith(`content-type`))n=n.split(`;`)[0].trim(),o.push([e,n]);else throw Error(`Unsupported header in the simplified fetch implementation. Only content-type, authorization, and x-bsv-* headers are supported.`);o.sort(([e],[t])=>e.localeCompare(t)),a.writeVarIntNum(o.length);for(let e=0;e<o.length;e++){let t=F(o[e][0],`utf8`);a.writeVarIntNum(t.length),a.write(t);let n=F(o[e][1],`utf8`);a.writeVarIntNum(n.length),a.write(n)}if([`POST`,`PUT`,`PATCH`,`DELETE`].includes(e.toUpperCase())&&n===void 0){let e=o.find(([e])=>e===`content-type`);n=e&&e[1].includes(`application/json`)?`{}`:``}if(n){let e=await this.normalizeBodyToNumberArray(n);a.writeVarIntNum(e.length),a.write(e)}else a.writeVarIntNum(-1);return a}async handleFetchAndValidate(e,t,n){let r=await fetch(e,t);if(r.headers.forEach(e=>{if(e.toLocaleLowerCase().startsWith(`x-bsv`))throw Error(`The server is trying to claim it has been authenticated when it has not!`)}),r.ok)return n.supportsMutualAuth=!1,r;throw Error(`Request failed with status: ${r.status}`)}async handlePaymentAndRetry(e,t={},n){let r=n.headers.get(`x-bsv-payment-version`);if(!r||r!==vs)throw Error(`Unsupported x-bsv-payment-version response header. Client version: ${vs}, Server version: ${r}`);let i=n.headers.get(`x-bsv-payment-satoshis-required`);if(!i)throw Error(`Missing x-bsv-payment-satoshis-required response header.`);let a=parseInt(i);if(isNaN(a)||a<=0)throw Error(`Invalid x-bsv-payment-satoshis-required response header value.`);let o=n.headers.get(`x-bsv-auth-identity-key`);if(!o)throw Error(`Missing x-bsv-auth-identity-key response header.`);let s=n.headers.get(`x-bsv-payment-derivation-prefix`);if(typeof s!=`string`||s.length<1)throw Error(`Missing x-bsv-payment-derivation-prefix response header.`);let c=await ds(this.wallet),{publicKey:l}=await this.wallet.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${s} ${c}`,counterparty:o}),u=new Ma().lock(Fi.fromString(l).toAddress()).toHex(),{tx:d}=await this.wallet.createAction({description:`Payment for request to ${new URL(e).origin}`,outputs:[{satoshis:a,lockingScript:u,customInstructions:JSON.stringify({derivationPrefix:s,derivationSuffix:c,payee:o}),outputDescription:`HTTP request payment`}],options:{randomizeOutputs:!1}});return t.headers=t.headers||{},t.headers[`x-bsv-payment`]=JSON.stringify({derivationPrefix:s,derivationSuffix:c,transaction:Br(d)}),t.retryCounter??=3,this.fetch(e,t)}async normalizeBodyToNumberArray(e){if(e==null)return[];if(typeof e==`object`)return F(JSON.stringify(e,`utf8`));if(Array.isArray(e)&&e.every(e=>typeof e==`number`))return e;if(typeof e==`string`)return F(e,`utf8`);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)){let t=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer);return Array.from(t)}if(e instanceof Blob){let t=await e.arrayBuffer();return Array.from(new Uint8Array(t))}if(e instanceof FormData){let t=[];e.forEach((e,n)=>{t.push([n,e.toString()])});let n=new URLSearchParams(t).toString();return F(n,`utf8`)}if(e instanceof URLSearchParams)return F(e.toString(),`utf8`);throw e instanceof ReadableStream?Error(`ReadableStream cannot be directly converted to number[].`):Error(`Unsupported body type in this SimplifiedFetch implementation.`)}},bs=class{pushDrop;static decode(e){let t=Ia.decode(e);if(t.fields.length<4)throw Error(`Invalid SHIP/SLAP advertisement!`);let n=I(t.fields[0]);if(n!==`SHIP`&&n!==`SLAP`)throw Error(`Invalid protocol type!`);let r=P(t.fields[1]),i=I(t.fields[2]),a=I(t.fields[3]);return{protocol:n,identityKey:r,domain:i,topicOrService:a}}constructor(e){this.pushDrop=new Ia(e)}async lock(e,t,n){let{publicKey:r}=await this.pushDrop.wallet.getPublicKey({identityKey:!0});return await this.pushDrop.lock([F(e,`utf8`),F(r,`hex`),F(t,`utf8`),F(n,`utf8`)],[2,e===`SHIP`?`Service Host Interconnect`:`Service Lookup Availability`],`1`,`self`)}unlock(e){return this.pushDrop.unlock([2,e===`SHIP`?`Service Host Interconnect`:`Service Lookup Availability`],`1`,`self`)}};const xs=[`https://overlay-us-1.bsvb.tech`,`https://overlay-eu-1.bsvb.tech`,`https://overlay-ap-1.bsvb.tech`,`https://users.bapp.dev`],Ss=[`https://testnet-users.bapp.dev`];var Cs=5e3,ws=class{fetchClient;allowHTTP;constructor(e=fetch,t=!1){this.fetchClient=e,this.allowHTTP=t}async lookup(e,t,n=5e3){if(!e.startsWith(`https:`)&&!this.allowHTTP)throw Error(`HTTPS facilitator can only use URLs that start with "https:"`);let r=new Promise((e,t)=>setTimeout(()=>t(Error(`Request timed out`)),n)),i=fetch(`${e}/lookup`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({service:t.service,query:t.query})}),a=await Promise.race([i,r]);if(a.ok)return await a.json();throw Error(`Failed to facilitate lookup`)}},Ts=class{facilitator;slapTrackers;hostOverrides;additionalHosts;networkPreset;constructor(e={}){this.networkPreset=e.networkPreset??`mainnet`,this.facilitator=e.facilitator??new ws(void 0,this.networkPreset===`local`),this.slapTrackers=e.slapTrackers??(this.networkPreset===`mainnet`?xs:Ss),this.hostOverrides=e.hostOverrides??{},this.additionalHosts=e.additionalHosts??{}}async query(e,t){let n=[];if(n=e.service===`ls_slap`?this.networkPreset===`local`?[`http://localhost:8080`]:this.slapTrackers:this.hostOverrides[e.service]==null?this.networkPreset===`local`?[`http://localhost:8080`]:await this.findCompetentHosts(e.service):this.hostOverrides[e.service],this.additionalHosts[e.service]?.length>0&&(n=[...n,...this.additionalHosts[e.service]]),n.length<1)throw Error(`No competent ${this.networkPreset} hosts found by the SLAP trackers for lookup service: ${e.service}`);let r=(await Promise.allSettled(n.map(async n=>await this.facilitator.lookup(n,e,t)))).filter(e=>e.status===`fulfilled`).map(e=>e.value);if(r.length===0)throw Error(`No successful responses from any hosts`);let i=new Map;for(let e of r)if(e.type===`output-list`)try{for(let t of e.outputs)try{let e=`${eo.fromBEEF(t.beef).id(`hex`)}.${t.outputIndex}`;i.set(e,t)}catch{continue}}catch{}return{type:`output-list`,outputs:Array.from(i.values())}}async findCompetentHosts(e){let t={service:`ls_slap`,query:{service:e}},n=await Promise.allSettled(this.slapTrackers.map(async e=>await this.facilitator.lookup(e,t,Cs))),r=new Set;for(let t of n)if(t.status===`fulfilled`){let n=t.value;if(n.type!==`output-list`)continue;for(let t of n.outputs)try{let n=eo.fromBEEF(t.beef).outputs[t.outputIndex].lockingScript,i=bs.decode(n);if(i.topicOrService!==e||i.protocol!==`SLAP`)continue;r.add(i.domain)}catch{continue}}else continue;return[...r]}},Es=5e3,Ds=class{httpClient;allowHTTP;constructor(e=fetch,t=!1){this.httpClient=e,this.allowHTTP=t}async send(e,t){if(!e.startsWith(`https:`)&&!this.allowHTTP)throw Error(`HTTPS facilitator can only use URLs that start with "https:"`);let n={"Content-Type":`application/octet-stream`,"X-Topics":JSON.stringify(t.topics)},r;if(Array.isArray(t.offChainValues)){n[`x-includes-off-chain-values`]=`true`;let e=new L;e.writeVarIntNum(t.beef.length),e.write(t.beef),e.write(t.offChainValues),r=new Uint8Array(e.toArray())}else r=new Uint8Array(t.beef);let i=await fetch(`${e}/submit`,{method:`POST`,headers:n,body:r});if(i.ok)return await i.json();throw Error(`Failed to facilitate broadcast`)}},Os=class{topics;facilitator;resolver;requireAcknowledgmentFromAllHostsForTopics;requireAcknowledgmentFromAnyHostForTopics;requireAcknowledgmentFromSpecificHostsForTopics;networkPreset;constructor(e,t={}){if(e.length===0)throw Error(`At least one topic is required for broadcast.`);if(e.some(e=>!e.startsWith(`tm_`)))throw Error(`Every topic must start with "tm_".`);this.topics=e,this.networkPreset=t.networkPreset??`mainnet`,this.facilitator=t.facilitator??new Ds(void 0,this.networkPreset===`local`),this.resolver=t.resolver??new Ts({networkPreset:this.networkPreset}),this.requireAcknowledgmentFromAllHostsForTopics=t.requireAcknowledgmentFromAllHostsForTopics??[],this.requireAcknowledgmentFromAnyHostForTopics=t.requireAcknowledgmentFromAnyHostForTopics??`all`,this.requireAcknowledgmentFromSpecificHostsForTopics=t.requireAcknowledgmentFromSpecificHostsForTopics??{}}async broadcast(e){let t,n=e.metadata.get(`OffChainValues`);try{t=e.toBEEF()}catch{throw Error(`Transactions sent via SHIP to Overlay Services must be serializable to BEEF format.`)}let r=await this.findInterestedHosts();if(Object.keys(r).length===0)return{status:`error`,code:`ERR_NO_HOSTS_INTERESTED`,description:`No ${this.networkPreset} hosts are interested in receiving this transaction.`};let i=Object.entries(r).map(async([e,r])=>{try{let i=await this.facilitator.send(e,{beef:t,offChainValues:n,topics:[...r]});if(i==null||Object.keys(i).length===0)throw Error(`Steak has no topics.`);return{host:e,success:!0,steak:i}}catch(t){return console.error(t),{host:e,success:!1,error:t}}}),a=(await Promise.all(i)).filter(e=>e.success);if(a.length===0)return{status:`error`,code:`ERR_ALL_HOSTS_REJECTED`,description:`All ${this.networkPreset} topical hosts have rejected the transaction.`};let o={};for(let e of a){let t=e.host,n=e.steak,r=new Set;for(let[e,t]of Object.entries(n)){let n=t.outputsToAdmit,i=t.coinsToRetain,a=t.coinsRemoved;(n?.length>0||i?.length>0||a?.length>0)&&r.add(e)}o[t]=r}let s,c;if(this.requireAcknowledgmentFromAllHostsForTopics===`all`?(s=this.topics,c=`all`):this.requireAcknowledgmentFromAllHostsForTopics===`any`?(s=this.topics,c=`any`):Array.isArray(this.requireAcknowledgmentFromAllHostsForTopics)?(s=this.requireAcknowledgmentFromAllHostsForTopics,c=`all`):(s=this.topics,c=`all`),s.length>0&&!this.checkAcknowledgmentFromAllHosts(o,s,c))return{status:`error`,code:`ERR_REQUIRE_ACK_FROM_ALL_HOSTS_FAILED`,description:`Not all hosts acknowledged the required topics.`};let l,u;return this.requireAcknowledgmentFromAnyHostForTopics===`all`?(l=this.topics,u=`all`):this.requireAcknowledgmentFromAnyHostForTopics===`any`?(l=this.topics,u=`any`):Array.isArray(this.requireAcknowledgmentFromAnyHostForTopics)?(l=this.requireAcknowledgmentFromAnyHostForTopics,u=`all`):(l=[],u=`all`),l.length>0&&!this.checkAcknowledgmentFromAnyHost(o,l,u)?{status:`error`,code:`ERR_REQUIRE_ACK_FROM_ANY_HOST_FAILED`,description:`No host acknowledged the required topics.`}:Object.keys(this.requireAcknowledgmentFromSpecificHostsForTopics).length>0&&!this.checkAcknowledgmentFromSpecificHosts(o,this.requireAcknowledgmentFromSpecificHostsForTopics)?{status:`error`,code:`ERR_REQUIRE_ACK_FROM_SPECIFIC_HOSTS_FAILED`,description:`Specific hosts did not acknowledge the required topics.`}:{status:`success`,txid:e.id(`hex`),message:`Sent to ${a.length} Overlay Services ${a.length===1?`host`:`hosts`}.`}}checkAcknowledgmentFromAllHosts(e,t,n){for(let r of Object.values(e))if(n===`all`){for(let e of t)if(!r.has(e))return!1}else if(n===`any`){let e=!1;for(let n of t)if(r.has(n)){e=!0;break}if(!e)return!1}return!0}checkAcknowledgmentFromAnyHost(e,t,n){if(n===`all`){for(let n of Object.values(e)){let e=!0;for(let r of t)if(!n.has(r)){e=!1;break}if(e)return!0}return!1}else{for(let n of Object.values(e))for(let e of t)if(n.has(e))return!0;return!1}}checkAcknowledgmentFromSpecificHosts(e,t){for(let[n,r]of Object.entries(t)){let t=e[n];if(t==null)return!1;let i,a;if(r===`all`||r===`any`)a=r,i=this.topics;else if(Array.isArray(r))i=r,a=`all`;else continue;if(a===`all`){for(let e of i)if(!t.has(e))return!1}else if(a===`any`){let e=!1;for(let n of i)if(t.has(n)){e=!0;break}if(!e)return!1}}return!0}async findInterestedHosts(){if(this.networkPreset===`local`){let e=new Set;for(let t=0;t<this.topics.length;t++)e.add(this.topics[t]);return{"http://localhost:8080":e}}let e={},t=await this.resolver.query({service:`ls_ship`,query:{topics:this.topics}},Es);if(t.type!==`output-list`)throw Error(`SHIP answer is not an output list.`);for(let n of t.outputs)try{let t=eo.fromBEEF(n.beef).outputs[n.outputIndex].lockingScript,r=bs.decode(t);if(!this.topics.includes(r.topicOrService)||r.protocol!==`SHIP`)continue;e[r.domain]===void 0&&(e[r.domain]=new Set),e[r.domain].add(r.topicOrService)}catch{continue}return e}},ks=s({getHashFromURL:()=>Ns,getURLForFile:()=>Ms,getURLForHash:()=>js,isValidURL:()=>Ps,normalizeURL:()=>As});const As=e=>(e.toLowerCase().startsWith(`uhrp:`)&&(e=e.slice(5)),e.startsWith(`//`)&&(e=e.slice(2)),e),js=e=>{if(e.length!==32)throw Error(`Hash length must be 32 bytes (sha256)`);return Wr(e,F(`ce00`,`hex`))},Ms=e=>{let t=Mn(e);return js(t)},Ns=e=>{e=As(e);let{data:t,prefix:n}=Gr(e,void 0,2);if(t.length!==32)throw Error(`Invalid length!`);if(P(n)!==`ce00`)throw Error(`Bad prefix`);return t},Ps=e=>{try{return Ns(e),!0}catch{return!1}};var Fs=class{authFetch;baseURL;constructor(e){this.baseURL=e.storageURL,this.authFetch=new ys(e.wallet)}async getUploadInfo(e,t){let n=`${this.baseURL}/upload`,r={fileSize:e,retentionPeriod:t},i=await this.authFetch.fetch(n,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(r)});if(!i.ok)throw Error(`Upload info request failed: HTTP ${i.status}`);let a=await i.json();if(a.status===`error`)throw Error(`Upload route returned an error.`);return{uploadURL:a.uploadURL,requiredHeaders:a.requiredHeaders,amount:a.amount}}async uploadFile(e,t,n){let r=Uint8Array.from(t.data),i=await fetch(e,{method:`PUT`,body:r,headers:{"Content-Type":t.type,...n}});if(!i.ok)throw Error(`File upload failed: HTTP ${i.status}`);return{published:!0,uhrpURL:await Ms(t.data)}}async publishFile(e){let{file:t,retentionPeriod:n}=e,r=t.data.length,{uploadURL:i,requiredHeaders:a}=await this.getUploadInfo(r,n);return await this.uploadFile(i,t,a)}async findFile(e){let t=new URL(`${this.baseURL}/find`);t.searchParams.set(`uhrpUrl`,e);let n=await this.authFetch.fetch(t.toString(),{method:`GET`});if(!n.ok)throw Error(`findFile request failed: HTTP ${n.status}`);let r=await n.json();if(r.status===`error`){let e=r.code??`unknown-code`,t=r.description??`no-description`;throw Error(`findFile returned an error: ${e} - ${t}`)}return r.data}async listUploads(){let e=`${this.baseURL}/list`,t=await this.authFetch.fetch(e,{method:`GET`});if(!t.ok)throw Error(`listUploads request failed: HTTP ${t.status}`);let n=await t.json();if(n.status===`error`){let e=n.code??`unknown-code`,t=n.description??`no-description`;throw Error(`listUploads returned an error: ${e} - ${t}`)}return n.uploads}async renewFile(e,t){let n=`${this.baseURL}/renew`,r={uhrpUrl:e,additionalMinutes:t},i=await this.authFetch.fetch(n,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(r)});if(!i.ok)throw Error(`renewFile request failed: HTTP ${i.status}`);let a=await i.json();if(a.status===`error`){let e=a.code??`unknown-code`,t=a.description??`no-description`;throw Error(`renewFile returned an error: ${e} - ${t}`)}return{status:a.status,prevExpiryTime:a.prevExpiryTime,newExpiryTime:a.newExpiryTime,amount:a.amount}}},Is=class{networkPreset=`mainnet`;constructor(e){this.networkPreset=e?.networkPreset}async resolve(e){let t=await new Ts({networkPreset:this.networkPreset}).query({service:`ls_uhrp`,query:{uhrpUrl:e}});if(t.type!==`output-list`)throw Error(`Lookup answer must be an output list`);let n=[],r=Math.floor(Date.now()/1e3);for(let e=0;e<t.outputs.length;e++){let i=eo.fromBEEF(t.outputs[e].beef),{fields:a}=Ia.decode(i.outputs[t.outputs[e].outputIndex].lockingScript);new Kr(a[3]).readVarIntNum()<r||n.push(I(a[2]))}return n}async download(e){if(!Ps(e))throw Error(`Invalid parameter UHRP url`);let t=Ns(e),n=await this.resolve(e);if(!Array.isArray(n)||n.length===0)throw Error(`No one currently hosts this file!`);for(let e=0;e<n.length;e++)try{let r=await fetch(n[e],{method:`GET`});if(!r.ok||r.status>=400)continue;let i=await r.arrayBuffer(),a=[...new Uint8Array(i)],o=Mn(a);for(let e=0;e<o.length;++e)if(o[e]!==t[e])throw Error(`Value of content does not match hash of the url given`);return{data:a,mimeType:r.headers.get(`Content-Type`)}}catch{continue}throw Error(`Unable to download content from ${e}`)}};const Ls={name:`Unknown Identity`,avatarURL:`XUUB8bbn9fEthk15Ge3zTQXypUShfC94vFjp65v7u5CQ8qkpxzst`,identityKey:``,abbreviatedKey:``,badgeIconURL:`XUUV39HVPkpmMzYNTx7rpKzJvXfeiVyQWg2vfSpjBAuhunTCA9uG`,badgeLabel:`Not verified by anyone you trust.`,badgeClickURL:`https://projectbabbage.com/docs/unknown-identity`},Rs={protocolID:[1,`identity`],keyID:`1`,tokenAmount:1,outputIndex:0},zs={identiCert:`z40BOInXkI8m7f/wBrv4MJ09bZfzZbTj2fJqCtONqCY=`,discordCert:`2TgqRC35B1zehGmB21xveZNc7i5iqHc0uxMb+1NMPW4=`,phoneCert:`mffUklUzxbHr65xLohn0hRL0Tq2GjW1GYF/OPfzqJ6A=`,xCert:`vdDWvftf1H+5+ZprUw123kjHlywH+v20aPQTuXgMpNc=`,registrant:`YoPsbfR6YQczjzPdHCoGC7nJsOdPQR50+SYqcWpJ0y0=`,emailCert:`exOl3KM0dIJ04EW5pZgbZmPag6MdJXd3/a1enmUU/BA=`,anyone:`mfkOMfLDQmrr3SBxBQ5WeE+6Hy3VJRFq6w4A5Ljtlis=`,self:`Hkge6X5JRxt1cWXtHLCrSTg6dCVTxjQJJ48iOYd7n3g=`,coolCert:`AGfk/WrT1eBDXpz3mcw386Zww2HmqcIn3uY6x4Af1eo=`};var Bs=class e{options;originator;authClient;wallet;constructor(e,t=Rs,n){this.options=t,this.originator=n,this.wallet=e??new ns,this.authClient=new ys(this.wallet)}async publiclyRevealAttributes(e,t){if(Object.keys(e.fields).length===0)throw Error(`Public reveal failed: Certificate has no fields to reveal!`);if(t.length===0)throw Error(`Public reveal failed: You must reveal at least one field!`);try{await new Go(e.type,e.serialNumber,e.subject,e.certifier,e.revocationOutpoint,e.fields,e.signature).verify()}catch{throw Error(`Public reveal failed: Certificate verification failed!`)}let{keyringForVerifier:n}=await this.wallet.proveCertificate({certificate:e,fieldsToReveal:t,verifier:new Hi(1).toPublicKey().toString()}),r=await new Ia(this.wallet).lock([F(JSON.stringify({...e,keyring:n}))],this.options.protocolID,this.options.keyID,`anyone`,!0,!0),{tx:i}=await this.wallet.createAction({description:`Create a new Identity Token`,outputs:[{satoshis:this.options.tokenAmount,lockingScript:r.toHex(),outputDescription:`Identity Token`}],options:{randomizeOutputs:!1}});if(i!==void 0)return await new Os([`tm_identity`],{networkPreset:(await this.wallet.getNetwork({})).network}).broadcast(eo.fromAtomicBEEF(i));throw Error(`Public reveal failed: failed to create action!`)}async resolveByIdentityKey(t){let{certificates:n}=await this.wallet.discoverByIdentityKey(t,this.originator);return n.map(t=>e.parseIdentity(t))}async resolveByAttributes(t){let{certificates:n}=await this.wallet.discoverByAttributes(t,this.originator);return n.map(t=>e.parseIdentity(t))}static parseIdentity(e){let{type:t,decryptedFields:n,certifierInfo:r}=e,i,a,o,s,c;switch(t){case zs.xCert:i=n.userName,a=n.profilePhoto,o=`X account certified by ${r.name}`,s=r.iconUrl,c=`https://socialcert.net`;break;case zs.discordCert:i=n.userName,a=n.profilePhoto,o=`Discord account certified by ${r.name}`,s=r.iconUrl,c=`https://socialcert.net`;break;case zs.emailCert:i=n.email,a=`XUTZxep7BBghAJbSBwTjNfmcsDdRFs5EaGEgkESGSgjJVYgMEizu`,o=`Email certified by ${r.name}`,s=r.iconUrl,c=`https://socialcert.net`;break;case zs.phoneCert:i=n.phoneNumber,a=`XUTLxtX3ELNUwRhLwL7kWNGbdnFM8WG2eSLv84J7654oH8HaJWrU`,o=`Phone certified by ${r.name}`,s=r.iconUrl,c=`https://socialcert.net`;break;case zs.identiCert:i=`${n.firstName} ${n.lastName}`,a=n.profilePhoto,o=`Government ID certified by ${r.name}`,s=r.iconUrl,c=`https://identicert.me`;break;case zs.registrant:i=n.name,a=n.icon,o=`Entity certified by ${r.name}`,s=r.iconUrl,c=`https://projectbabbage.com/docs/registrant`;break;case zs.coolCert:i=n.cool===`true`?`Cool Person!`:`Not cool!`;break;case zs.anyone:i=`Anyone`,a=`XUT4bpQ6cpBaXi1oMzZsXfpkWGbtp2JTUYAoN7PzhStFJ6wLfoeR`,o=`Represents the ability for anyone to access this information.`,s=`XUUV39HVPkpmMzYNTx7rpKzJvXfeiVyQWg2vfSpjBAuhunTCA9uG`,c=`https://projectbabbage.com/docs/anyone-identity`;break;case zs.self:i=`You`,a=`XUT9jHGk2qace148jeCX5rDsMftkSGYKmigLwU2PLLBc7Hm63VYR`,o=`Represents your ability to access this information.`,s=`XUUV39HVPkpmMzYNTx7rpKzJvXfeiVyQWg2vfSpjBAuhunTCA9uG`,c=`https://projectbabbage.com/docs/self-identity`;break;default:i=Ls.name,a=n.profilePhoto,o=Ls.badgeLabel,s=Ls.badgeIconURL,c=Ls.badgeClickURL;break}return{name:i,avatarURL:a,abbreviatedKey:e.subject.length>0?`${e.subject.substring(0,10)}...`:``,identityKey:e.subject,badgeIconURL:s,badgeLabel:o,badgeClickURL:c}}},Vs=1,Hs=class{wallet;network;constructor(e=new ns){this.wallet=e}async registerDefinition(e){let t=(await this.wallet.getPublicKey({identityKey:!0})).publicKey,n=new Ia(this.wallet),r=this.buildPushDropFields(e,t),i=this.mapDefinitionTypeToWalletProtocol(e.definitionType),a=await n.lock(r,i,`1`,`anyone`,!0),{tx:o}=await this.wallet.createAction({description:`Register a new ${e.definitionType} item`,outputs:[{satoshis:Vs,lockingScript:a.toHex(),outputDescription:`New ${e.definitionType} registration token`,basket:this.mapDefinitionTypeToBasketName(e.definitionType)}],options:{randomizeOutputs:!1}});if(o===void 0)throw Error(`Failed to create ${e.definitionType} registration transaction!`);return await new Os([this.mapDefinitionTypeToTopic(e.definitionType)],{networkPreset:this.network??=(await this.wallet.getNetwork({})).network}).broadcast(eo.fromAtomicBEEF(o))}async resolve(e,t){let n=new Ts,r=this.mapDefinitionTypeToServiceName(e),i=await n.query({service:r,query:t});if(i.type!==`output-list`)return[];let a=[];for(let t of i.outputs)try{let n=eo.fromBEEF(t.beef).outputs[t.outputIndex].lockingScript,r=await this.parseLockingScript(e,n);a.push(r)}catch{}return a}async listOwnRegistryEntries(e){let t=this.mapDefinitionTypeToBasketName(e),{outputs:n,BEEF:r}=await this.wallet.listOutputs({basket:t,include:`entire transactions`}),i=[];for(let t of n)if(t.spendable)try{let[n,a]=t.outpoint.split(`.`),o=eo.fromBEEF(r).outputs[a].lockingScript,s=await this.parseLockingScript(e,o);i.push({...s,txid:n,outputIndex:Number(a),satoshis:t.satoshis,lockingScript:o.toHex(),beef:r})}catch{}return i}async revokeOwnRegistryEntry(e){if(e.txid===void 0||e.outputIndex===void 0||e.lockingScript===void 0)throw Error(`Invalid registry record. Missing txid, outputIndex, or lockingScript.`);let t=(await this.wallet.getPublicKey({identityKey:!0})).publicKey;if(e.registryOperator!==t)throw Error(`This registry token does not belong to the current wallet.`);let n=e.definitionType===`basket`?e.basketID:e.definitionType===`protocol`?e.name:e.definitionType===`certificate`?e.name===void 0?e.type:e.name:`unknown`,r=`${e.txid}.${e.outputIndex}`,{signableTransaction:i}=await this.wallet.createAction({description:`Revoke ${e.definitionType} item: ${n}`,inputBEEF:e.beef,inputs:[{outpoint:r,unlockingScriptLength:73,inputDescription:`Revoking ${e.definitionType} token`}]});if(i===void 0)throw Error(`Failed to create signable transaction.`);let a=eo.fromBEEF(i.tx),o=await(await new Ia(this.wallet).unlock(this.mapDefinitionTypeToWalletProtocol(e.definitionType),`1`,`anyone`,`all`,!1,e.satoshis,_a.fromHex(e.lockingScript))).sign(a,e.outputIndex),{tx:s}=await this.wallet.signAction({reference:i.reference,spends:{[e.outputIndex]:{unlockingScript:o.toHex()}},options:{acceptDelayedBroadcast:!1}});if(s===void 0)throw Error(`Failed to finalize the transaction signature.`);return await new Os([this.mapDefinitionTypeToTopic(e.definitionType)],{networkPreset:this.network??=(await this.wallet.getNetwork({})).network}).broadcast(eo.fromAtomicBEEF(s))}buildPushDropFields(e,t){let n;switch(e.definitionType){case`basket`:n=[e.basketID,e.name,e.iconURL,e.description,e.documentationURL];break;case`protocol`:n=[JSON.stringify(e.protocolID),e.name,e.iconURL,e.description,e.documentationURL];break;case`certificate`:n=[e.type,e.name,e.iconURL,e.description,e.documentationURL,JSON.stringify(e.fields)];break;default:throw Error(`Unsupported definition type`)}return n.push(t),n.map(e=>F(e))}async parseLockingScript(e,t){let n=Ia.decode(t);if(n.fields.length===0)throw Error(`Not a valid registry pushdrop script.`);let r,i;switch(e){case`basket`:{if(n.fields.length!==7)throw Error(`Unexpected field count for basket type.`);let[e,t,a,o,s,c]=n.fields;r=I(c),i={definitionType:`basket`,basketID:I(e),name:I(t),iconURL:I(a),description:I(o),documentationURL:I(s)};break}case`protocol`:{if(n.fields.length!==7)throw Error(`Unexpected field count for protocol type.`);let[e,t,a,o,s,c]=n.fields;r=I(c),i={definitionType:`protocol`,protocolID:Us(I(e)),name:I(t),iconURL:I(a),description:I(o),documentationURL:I(s)};break}case`certificate`:{if(n.fields.length!==8)throw Error(`Unexpected field count for certificate type.`);let[e,t,a,o,s,c,l]=n.fields;r=I(l);let u={};try{u=JSON.parse(I(c))}catch{}i={definitionType:`certificate`,type:I(e),name:I(t),iconURL:I(a),description:I(o),documentationURL:I(s),fields:u};break}default:throw Error(`Unsupported definition type: ${e}`)}return{...i,registryOperator:r}}mapDefinitionTypeToWalletProtocol(e){switch(e){case`basket`:return[1,`basketmap`];case`protocol`:return[1,`protomap`];case`certificate`:return[1,`certmap`];default:throw Error(`Unknown definition type: ${e}`)}}mapDefinitionTypeToBasketName(e){switch(e){case`basket`:return`basketmap`;case`protocol`:return`protomap`;case`certificate`:return`certmap`;default:throw Error(`Unknown definition type: ${e}`)}}mapDefinitionTypeToTopic(e){switch(e){case`basket`:return`tm_basketmap`;case`protocol`:return`tm_protomap`;case`certificate`:return`tm_certmap`;default:throw Error(`Unknown definition type: ${e}`)}}mapDefinitionTypeToServiceName(e){switch(e){case`basket`:return`ls_basketmap`;case`protocol`:return`ls_protomap`;case`certificate`:return`ls_certmap`;default:throw Error(`Unknown definition type: ${e}`)}}};function Us(e){let t=JSON.parse(e);if(!Array.isArray(t)||t.length!==2)throw Error(`Invalid wallet protocol format.`);let[n,r]=t;if(![0,1,2].includes(n))throw Error(`Invalid security level.`);if(typeof r!=`string`)throw Error(`Invalid protocolID`);return[n,r]}var Ws=class{wallet;context;encrypt;originator;acceptDelayedBroadcast=!1;keyLocks=new Map;constructor(e=new ns,t=`kvstore default`,n=!0,r,i=!1){if(typeof t!=`string`||t.length<1)throw Error(`A context in which to operate is required.`);this.wallet=e,this.context=t,this.encrypt=n,this.originator=r,this.acceptDelayedBroadcast=i}async queueOperationOnKey(e){let t=this.keyLocks.get(e);t??(t=[],this.keyLocks.set(e,t));let n=()=>{},r=new Promise(e=>{n=e,t?.push(e)});return t.length===1&&n(),await r,t}finishOperationOnKey(e,t){t.shift(),t.length>0&&t[0]()}getProtocol(e){return{protocolID:[2,this.context],keyID:e}}async getOutputs(e,t){return await this.wallet.listOutputs({basket:this.context,tags:[e],tagQueryMode:`all`,include:`entire transactions`,limit:t})}async get(e,t=void 0){let n=await this.queueOperationOnKey(e);try{return(await this.lookupValue(e,t,5)).value}finally{this.finishOperationOnKey(e,n)}}getLockingScript(e,t){let[n,r]=e.outpoint.split(`.`),i=t.findTxid(n)?.tx;if(i==null)throw Error(`beef must contain txid ${n}`);return i.outputs[Number(r)].lockingScript}async lookupValue(e,t,n){let r=await this.getOutputs(e,n),i={value:t,outpoint:void 0,lor:r},{outputs:a}=r;if(a.length===0)return i;let o=a.slice(-1)[0];i.outpoint=o.outpoint;let s;try{if(r.BEEF===void 0)throw Error(`entire transactions listOutputs option must return valid BEEF`);let e=this.getLockingScript(o,$a.fromBinary(r.BEEF)),t=Ia.decode(e);if(t.fields.length<1||t.fields.length>2)throw Error(`Invalid token.`);s=t.fields[0]}catch{throw Error(`Invalid value found. You need to call set to collapse the corrupted state (or relinquish the corrupted ${a[0].outpoint} output from the ${this.context} basket) before you can get this value again.`)}if(!this.encrypt)i.value=I(s);else{let{plaintext:t}=await this.wallet.decrypt({...this.getProtocol(e),ciphertext:s});i.value=I(t)}return i}getInputs(e){let t=[];for(let n=0;n<e.length;n++)t.push({outpoint:e[n].outpoint,unlockingScriptLength:74,inputDescription:`Previous key-value token`});return t}async getSpends(e,t,n,r){let i=this.getProtocol(e),a=eo.fromAtomicBEEF(r),o={};for(let e=0;e<t.length;e++)o[e]={unlockingScript:(await n.unlock(i.protocolID,i.keyID,`self`).sign(a,e)).toHex()};return o}async set(e,t){let n=await this.queueOperationOnKey(e);try{let n=await this.lookupValue(e,void 0,10);if(n.value===t){if(n.outpoint===void 0)throw Error(`outpoint must be valid when value is valid and unchanged`);return n.outpoint}let r=this.getProtocol(e),i=F(t,`utf8`);if(this.encrypt){let{ciphertext:e}=await this.wallet.encrypt({...r,plaintext:i});i=e}let a=new Ia(this.wallet,this.originator),o=await a.lock([i],r.protocolID,r.keyID,`self`),{outputs:s,BEEF:c}=n.lor,l;try{let t=this.getInputs(s),{txid:n,signableTransaction:r}=await this.wallet.createAction({description:`Update ${e} in ${this.context}`,inputBEEF:c,inputs:t,outputs:[{basket:this.context,tags:[e],lockingScript:o.toHex(),satoshis:1,outputDescription:`Key-value token`}],options:{acceptDelayedBroadcast:this.acceptDelayedBroadcast,randomizeOutputs:!1}});if(s.length>0&&typeof r!=`object`)throw Error(`Wallet did not return a signable transaction when expected.`);if(r==null)l=`${n}.0`;else{let t=await this.getSpends(e,s,a,r.tx),{txid:n}=await this.wallet.signAction({reference:r.reference,spends:t});l=`${n}.0`}}catch{throw Error(`There are ${s.length} outputs with tag ${e} that cannot be unlocked.`)}return l}finally{this.finishOperationOnKey(e,n)}}async remove(e){let t=await this.queueOperationOnKey(e);try{let t=[];for(;;){let{outputs:n,BEEF:r,totalOutputs:i}=await this.getOutputs(e);if(n.length>0){let a=new Ia(this.wallet,this.originator);try{let i=this.getInputs(n),{signableTransaction:o}=await this.wallet.createAction({description:`Remove ${e} in ${this.context}`,inputBEEF:r,inputs:i,options:{acceptDelayedBroadcast:this.acceptDelayedBroadcast}});if(typeof o!=`object`)throw Error(`Wallet did not return a signable transaction when expected.`);let s=await this.getSpends(e,n,a,o.tx),{txid:c}=await this.wallet.signAction({reference:o.reference,spends:s});if(c===void 0)throw Error(`signAction must return a valid txid`);t.push(c)}catch{throw Error(`There are ${i} outputs with tag ${e} that cannot be unlocked.`)}}if(n.length===i)break}return t}finally{this.finishOperationOnKey(e,t)}}},Gs=e=>({BASE_URL:`/`,DEV:!1,MODE:`production`,PROD:!0,SSR:!1})[e];const Ks={BSV_NETWORK:Gs(`VITE_BSV_NETWORK`)||Gs(`BSV_NETWORK`)||`main`,EXPLORER_URL:Gs(`VITE_EXPLORER_PRIMARY_URL`)||Gs(`NEXT_PUBLIC_EXPLORER_PRIMARY_URL`)||`https://api.whatsonchain.com`,WALLET_SUBSTRATE:Gs(`VITE_WALLET_SUBSTRATE`)||Gs(`WALLET_SUBSTRATE`)||`auto`,METANET_DESKTOP_ORIGIN:Gs(`VITE_DESKTOP_ORIGIN`)||Gs(`NUKENOTE_DESKTOP_ORIGIN`)||`http://localhost:3321`,OVERLAY_ENDPOINT:Gs(`VITE_OVERLAY_ENDPOINT`)||Gs(`NUKENOTE_OVERLAY_ENDPOINT`)||``,HELPER_CACHE_ENDPOINT:Gs(`VITE_HELPER_CACHE_ENDPOINT`)||Gs(`NUKENOTE_HELPER_CACHE_ENDPOINT`)||``,MESSAGE_BOX_WS_URL:Gs(`VITE_MESSAGE_BOX_WS_URL`)||Gs(`NUKENOTE_MESSAGE_BOX_WS_URL`)||``,MESSAGE_BOX_APP_ID:Gs(`VITE_MESSAGE_BOX_APP_ID`)||Gs(`NUKENOTE_MESSAGE_BOX_APP_ID`)||``,MESSAGE_BOX_APP_SECRET:Gs(`VITE_MESSAGE_BOX_APP_SECRET`)||Gs(`NUKENOTE_MESSAGE_BOX_APP_SECRET`)||``,REMOTE_MESSAGING_API_URL:Gs(`VITE_REMOTE_MESSAGING_API_URL`)||Gs(`NUKENOTE_REMOTE_MESSAGING_API_URL`)||``,REMOTE_MESSAGING_ENABLED:(()=>{let e=Gs(`VITE_REMOTE_MESSAGING_ENABLED`)??Gs(`NUKENOTE_REMOTE_MESSAGING_ENABLED`)??``;return typeof e==`string`&&e.trim()!==``?![`false`,`0`,`no`,`off`].includes(e.trim().toLowerCase()):!1})(),DONATION_IDENTITY_KEY:Gs(`VITE_DONATION_IDENTITY_KEY`)||Gs(`NUKENOTE_DONATION_IDENTITY_KEY`)||``,DEBUG_VERBOSE:(()=>{let e=Gs(`VITE_DEBUG_VERBOSE`)??Gs(`NUKENOTE_DEBUG_VERBOSE`)??``;return typeof e==`string`&&e.trim()!==``?[`true`,`1`,`yes`,`on`].includes(e.trim().toLowerCase()):!1})(),STORAGE_PROVIDER:`ipfs`,ENCRYPTION_ALGORITHM:`AES-256-GCM`,APP_NAME:`Nullify`,APP_VERSION:`1.0.0`,APP_DESCRIPTION:`Nullify: self-destructing access tokens on the BSV blockchain`,THEME:{buttons:{primary:`bg-yellow-300 text-gray-800 dark:bg-yellow-200 dark:text-gray-900`,danger:`bg-red-500 text-white`,outline:`border-2 border-gray-300 text-gray-700`},input:`border-2 border-gray-300 dark:border-gray-700 focus:ring-cyan-500 focus:border-cyan-500`,card:`bg-gray-100 dark:bg-gray-900 border-2 border-black`}};var qs=(Ks.METANET_DESKTOP_ORIGIN||`http://localhost:3321`).replace(/\/$/,``);try{new URL(qs).host}catch{qs.replace(/^https?:\/\//,``)}`${qs}`;const Js=[`createAction`,`getPublicKey`,`wrapDataKey`,`acquireCertificate`,`listCertificates`,`proveCertificate`,`relinquishCertificate`,`discoverByAttributes`,`discoverByIdentityKey`,`findCertificates`,`waitForAuthentication`];var Ys=`modulepreload`,Xs=function(e){return`/`+e},Zs={};const Qs=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=document.getElementsByTagName(`link`),i=document.querySelector(`meta[property=csp-nonce]`),a=i?.nonce||i?.getAttribute(`nonce`);function o(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:`fulfilled`,value:e}),e=>({status:`rejected`,reason:e}))))}r=o(t.map(t=>{if(t=Xs(t,n),t in Zs)return;Zs[t]=!0;let r=t.endsWith(`.css`),i=r?`[rel="stylesheet"]`:``;if(n)for(let n=e.length-1;n>=0;n--){let i=e[n];if(i.href===t&&(!r||i.rel===`stylesheet`))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;let o=document.createElement(`link`);if(o.rel=r?`stylesheet`:Ys,r||(o.as=`script`),o.crossOrigin=``,o.href=t,a&&o.setAttribute(`nonce`,a),document.head.appendChild(o),r)return new Promise((e,n)=>{o.addEventListener(`load`,e),o.addEventListener(`error`,()=>n(Error(`Unable to preload CSS for ${t}`)))})}))}function i(e){let t=new Event(`vite:preloadError`,{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(let e of t||[])e.status===`rejected`&&i(e.reason);return e().catch(i)})};var $s=!1,ec=(...e)=>{console.log(...e)};async function tc(e){if($s)return;let t=Date.now();try{if(ec(`[getWallet] Warming up wallet with getPublicKey probe...`),await e.getPublicKey({identityKey:!0}),ec(`[getWallet] Wallet connectivity verified in`,Date.now()-t,`ms`),typeof e.listActions==`function`){ec(`[getWallet] Refreshing wallet UTXO cache via listActions...`);try{await e.listActions({limit:1}),ec(`[getWallet] UTXO cache refresh complete in`,Date.now()-t,`ms`)}catch(e){ec(`[getWallet] listActions warmup skipped:`,e.message)}}$s=!0,ec(`[getWallet] Wallet warmup complete in`,Date.now()-t,`ms`)}catch(e){console.warn(`[getWallet] Wallet warmup probe failed:`,e.message)}}async function nc({autoConnect:e=!0}={}){let t=sc.getStatus();if(t.isConnected&&t.wallet)return ec(`[getWallet] Returning connected wallet:`,{type:t.walletType,clientType:t.wallet?.constructor?.name,substrate:t.wallet?.substrate}),await tc(t.wallet),{type:t.walletType,client:t.wallet};if(!e)throw Error(`Wallet is not connected. Please connect via the wallet panel.`);try{let e=await sc.initialize(Ks.WALLET_SUBSTRATE||`auto`);return ec(`[getWallet] Initialized wallet:`,{type:e.walletType,clientType:e.wallet?.constructor?.name,substrate:e.wallet?.substrate}),await tc(e.wallet),{type:e.walletType,client:e.wallet}}catch(e){let t=e?.message||`Unknown wallet initialization error`;throw Error(`Unable to connect to wallet: ${t}`)}}function rc(){$s=!1}async function ic(){let e=sc.getStatus();if(!e.isConnected||!e.wallet)return console.warn(`[forceUtxoRefresh] Wallet not connected`),!1;let t=e.wallet,n=Date.now();try{if(typeof t.listActions==`function`)return console.log(`[forceUtxoRefresh] Refreshing wallet UTXO cache...`),await t.listActions({limit:1}),console.log(`[forceUtxoRefresh] UTXO cache refresh complete in`,Date.now()-n,`ms`),!0}catch(e){console.warn(`[forceUtxoRefresh] Failed:`,e.message)}return!1}function ac(e){return!e||typeof e!=`object`?null:e.txid||e.result&&e.result.txid||e.transactionId||e.id||null}const oc=new class{constructor(){this.wallet=null,this.identityKey=null,this.walletType=null,this.network=null,this.version=null}async initialize(e=Ks.WALLET_SUBSTRATE){try{if(e===`brc7`){let e=await this.tryBRC7Wallet();if(e)return e}if(e===`json-api`||e===`auto`){let e=await this.tryJsonApiWallet();if(e)return e}if(e===`auto`){let e=await this.tryBRC7Wallet();if(e)return e}if(e===`brc6`||e===`auto`){let e=await this.tryBRC6Wallet();if(e)return e}if(e===`brc7`){let e=await this.tryBRC6Wallet();if(e)return e}throw Error(`No compatible wallet detected`)}catch(e){throw console.error(`Wallet bootstrap failed:`,e),e?.message&&/No BSV wallet detected|BRC-6 bridge unavailable/i.test(e.message)?e:Error(`Wallet initialization failed: ${e.message}`)}}async tryJsonApiWallet(){try{let e=(Ks.METANET_DESKTOP_ORIGIN||`http://localhost:3321`).replace(/\/$/,``),t;try{t=new URL(e).host}catch{t=e.replace(/^https?:\/\//,``)}console.log(`[walletBootstrap] Attempting JSON-API connection (Metanet Desktop on `+t+`)`);let n=new ns(`json-api`,t),r=await n.getPublicKey({identityKey:!0}),i=r.publicKey||r.identityKey||r;return console.log(`[walletBootstrap] JSON-API connected successfully:`,{identityKey:i}),this.wallet=n,this.identityKey=i,this.walletType=`json-api`,this.network=null,this.version=null,{wallet:n,identityKey:i,walletType:`json-api`,network:null,version:null}}catch(e){return console.warn(`JSON-API wallet connection failed:`,e.message),null}}async tryBRC7Wallet(){try{if(console.log(`[walletBootstrap] Attempting BRC-7 connection...`),console.log(`[walletBootstrap] window.CWI exists?`,typeof window<`u`&&!!window.CWI),typeof window<`u`&&window.CWI){console.log(`[walletBootstrap] Detected BRC-7 window-injected wallet`),console.log(`[walletBootstrap] window.CWI.wrapDataKey exists?`,typeof window.CWI.wrapDataKey==`function`);let e=new ns(`window://cwi`);console.log(`[walletBootstrap] WalletClient created, getting public key...`),typeof window.CWI.wrapDataKey==`function`&&typeof e.wrapDataKey!=`function`&&(console.log(`[walletBootstrap] Manually adding wrapDataKey to WalletClient`),e.wrapDataKey=e=>window.CWI.wrapDataKey(e));let t=await e.getPublicKey({identityKey:!0}),n=t.publicKey||t.identityKey||t;return console.log(`[walletBootstrap] Got identity key:`,n),this.wallet=e,this.identityKey=n,this.walletType=`brc7`,this.network=null,this.version=null,console.log(`[walletBootstrap] BRC-7 connection successful!`),{wallet:e,identityKey:n,walletType:`brc7`,network:null,version:null}}return console.log(`[walletBootstrap] BRC-7 connection failed - no wallet available`),null}catch(e){return console.error(`[walletBootstrap] BRC-7 wallet connection error:`,e),null}}async tryBRC6Wallet(){try{console.log(`[walletBootstrap] Attempting BRC-6 XDM wallet connection`);let e=new ns(`xdm://parent`),t=await e.getPublicKey({identityKey:!0}),n=t.publicKey||t.identityKey||t;return this.wallet=e,this.identityKey=n,this.walletType=`brc6`,this.network=null,this.version=null,{wallet:e,identityKey:n,walletType:`brc6`,network:null,version:null}}catch(e){console.warn(`BRC-6 wallet connection failed:`,e.message);let t=e?.message||``;if(/connection refused|ECONNREFUSED|fetch failed/i.test(t))throw Error(`BRC-6 bridge unavailable. Start Metanet Desktop on this machine and ensure its wallet interface is enabled, or choose a different wallet substrate.`);if(/No wallet available over any communication substrate/i.test(t))throw Error(`No BSV wallet detected. Install and run Metanet Desktop (https://getmetanet.com/#desktop), then try connecting again.`);return null}}getStatus(){return{isConnected:!!this.wallet,walletType:this.walletType,identityKey:this.identityKey,wallet:this.wallet,network:this.network,version:this.version}}async disconnect(){if(this.wallet)try{await this.wallet.disconnect?.()}catch(e){console.warn(`Wallet disconnect warning:`,e.message)}this.wallet=null,this.identityKey=null,this.walletType=null,this.network=null,this.version=null,rc()}async checkCapabilities(){if(!this.wallet)return{supported:!1,features:[]};try{let e=[`createAction`,`getPublicKey`],t=new Set;if(this.walletType===`json-api`&&Js.forEach(e=>t.add(e)),typeof this.wallet.getCapabilities==`function`)try{let e=await this.wallet.getCapabilities();Array.isArray(e)&&e.forEach(e=>t.add(e))}catch(e){console.warn(`wallet.getCapabilities call failed`,e?.message||e)}e.forEach(e=>{let n=typeof this.wallet[e]==`function`;console.log(`[walletBootstrap] Checking ${e}: ${n?`FOUND`:`MISSING`}`),n&&t.add(e)});let n=e.filter(e=>!t.has(e));return console.log(`[walletBootstrap] Capability check complete:`,{supported:n.length===0,features:Array.from(t),missing:n}),{supported:n.length===0,features:Array.from(t),missing:n,wrapDataKey:t.has(`wrapDataKey`)}}catch(e){return console.warn(`Capability check failed:`,e.message),{supported:!1,features:[],error:e.message}}}};var sc=oc,B=class e{static zeros=`.0.00.000.0000.00000.000000.0000000.00000000.000000000.0000000000.00000000000.000000000000.0000000000000.00000000000000.000000000000000.0000000000000000.00000000000000000.000000000000000000.0000000000000000000.00000000000000000000.000000000000000000000.0000000000000000000000.00000000000000000000000.000000000000000000000000.0000000000000000000000000`.split(`.`);static groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];static groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];static wordSize=26;static WORD_SIZE_BIGINT=BigInt(e.wordSize);static WORD_MASK=(1n<<e.WORD_SIZE_BIGINT)-1n;static MAX_SAFE_INTEGER_BIGINT=BigInt(2**53-1);static MIN_SAFE_INTEGER_BIGINT=BigInt(-(2**53-1));static MAX_IMULN_ARG=67108863;static MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT=(1n<<53n)-1n;_magnitude;_sign;_nominalWordLength;red;get negative(){return this._sign}set negative(e){this.assert(e===0||e===1,`Negative property must be 0 or 1`);let t=e===1?1:0;this._magnitude===0n?this._sign=0:this._sign=t}get _computedWordsArray(){if(this._magnitude===0n)return[0];let t=[],n=this._magnitude;for(;n>0n;)t.push(Number(n&e.WORD_MASK)),n>>=e.WORD_SIZE_BIGINT;return t.length>0?t:[0]}get words(){let e=this._computedWordsArray;if(this._nominalWordLength<=e.length)return e;let t=Array(this._nominalWordLength).fill(0);for(let n=0;n<e.length;n++)t[n]=e[n];return t}set words(t){let n=this._sign,r=0n,i=t.length>0?t.length:1;for(let n=i-1;n>=0;n--){let i=t[n]===void 0?0:t[n];r=r<<e.WORD_SIZE_BIGINT|BigInt(i&Number(e.WORD_MASK))}this._magnitude=r,this._sign=n,this._nominalWordLength=i,this.normSign()}get length(){return Math.max(1,this._nominalWordLength)}static isBN(t){return t instanceof e?!0:typeof t==`object`&&!!t&&t.constructor?.wordSize===e.wordSize&&Array.isArray(t.words)}static max(e,t){return e.cmp(t)>0?e:t}static min(e,t){return e.cmp(t)<0?e:t}constructor(e=0,t=10,n=`be`){if(this._magnitude=0n,this._sign=0,this._nominalWordLength=1,this.red=null,e===void 0&&(e=0),e===null){this._initializeState(0n,0);return}if(typeof e==`bigint`){this._initializeState(e<0n?-e:e,e<0n?1:0),this.normSign();return}let r=t,i=n;if((t===`le`||t===`be`)&&(i=t,r=10),typeof e==`number`){this.initNumber(e,i);return}if(Array.isArray(e)){this.initArray(e,i);return}if(typeof e==`string`){r===`hex`&&(r=16),this.assert(typeof r==`number`&&r===(r|0)&&r>=2&&r<=36,`Base must be an integer between 2 and 36`);let t=e.toString().replace(/\s+/g,``),n=0,a=0;t.startsWith(`-`)?(n++,a=1):t.startsWith(`+`)&&n++;let o=t.substring(n);if(o.length===0){this._initializeState(0n,a===1&&t.startsWith(`-`)?1:0),this.normSign();return}if(r===16){let e;if(i===`le`){let e=[],t=o;t.length%2!=0&&(t=`0`+t);for(let n=0;n<t.length;n+=2){let r=t.substring(n,n+2),i=parseInt(r,16);if(isNaN(i))throw Error(`Invalid character in `+t);e.push(i)}this.initArray(e,`le`),this._sign=a,this.normSign();return}else try{e=BigInt(`0x`+o)}catch{throw Error(`Invalid character in `+o)}this._initializeState(e,a),this.normSign()}else try{if(this._parseBaseString(o,r),this._sign=a,this.normSign(),i===`le`){let e=this._sign;this.initArray(this.toArray(`be`),`le`),this._sign=e,this.normSign()}}catch(e){let t=e;throw t.message.includes(`Invalid character in string`)||t.message.includes(`Invalid digit for base`)||t.message.startsWith(`Invalid character:`)?Error(`Invalid character`):t}}else e===0?this._initializeState(0n,0):this.assert(!1,`Unsupported input type for BigNumber constructor`)}_bigIntToStringInBase(e,t){if(e===0n)return`0`;if(t<2||t>36)throw Error(`Base must be between 2 and 36`);let n=``,r=e>0n?e:-e,i=BigInt(t);for(;r>0n;)n=`0123456789abcdefghijklmnopqrstuvwxyz`[Number(r%i)]+n,r/=i;return n}_parseBaseString(t,n){if(t.length===0){this._magnitude=0n,this._finishInitialization();return}this._magnitude=0n;let r=BigInt(n),i=e.groupSizes[n],a=BigInt(e.groupBases[n]);(i===0||a===0n)&&(i=Math.floor(Math.log(67108863)/Math.log(n)),i===0&&(i=1),a=r**BigInt(i));let o=0,s=t.length,c=s%i;if(c===0&&s>0&&(c=i),c>0){let e=t.substring(o,o+c);this._magnitude=BigInt(this._parseBaseWord(e,n)),o+=c}for(;o<s;){let e=t.substring(o,o+i),r=BigInt(this._parseBaseWord(e,n));this._magnitude=this._magnitude*a+r,o+=i}this._finishInitialization()}_parseBaseWord(e,t){let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r),a;if(i>=48&&i<=57)a=i-48;else if(i>=65&&i<=90)a=i-65+10;else if(i>=97&&i<=122)a=i-97+10;else throw Error(`Invalid character: `+e[r]);if(a>=t)throw Error(`Invalid character`);n=n*t+a}return n}_initializeState(e,t){this._magnitude=e,this._sign=e===0n?0:t,this._finishInitialization()}_finishInitialization(){if(this._magnitude===0n)this._nominalWordLength=1,this._sign=0;else{let t=this._magnitude.toString(2).length;this._nominalWordLength=Math.max(1,Math.ceil(t/e.wordSize))}}assert(e,t=`Assertion failed`){if(!e)throw Error(t)}initNumber(t,n=`be`){if(this.assert(BigInt(Math.abs(t))<=e.MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT,`The number is larger than 2 ^ 53 (unsafe)`),this.assert(t%1==0,`Number must be an integer for BigNumber conversion`),this._initializeState(BigInt(Math.abs(t)),t<0?1:0),n===`le`){let e=this._sign,t=this.toArray(`be`);this.initArray(t,`le`),this._sign=e,this.normSign()}return this}initArray(e,t){if(e.length===0)return this._initializeState(0n,0),this;let n=0n;if(t===`be`)for(let t=0;t<e.length;t++)n=n<<8n|BigInt(e[t]&255);else for(let t=e.length-1;t>=0;t--)n=n<<8n|BigInt(e[t]&255);return this._initializeState(n,0),this}copy(e){e._magnitude=this._magnitude,e._sign=this._sign,e._nominalWordLength=this._nominalWordLength,e.red=this.red}static move(e,t){e._magnitude=t._magnitude,e._sign=t._sign,e._nominalWordLength=t._nominalWordLength,e.red=t.red}clone(){let t=new e(0n);return this.copy(t),t}expand(e){return this.assert(e>=0,`Expand size must be non-negative`),this._nominalWordLength=Math.max(this._nominalWordLength,e,1),this}strip(){return this._finishInitialization(),this.normSign()}normSign(){return this._magnitude===0n&&(this._sign=0),this}inspect(){return(this.red===null?`<BN: `:`<BN-R: `)+this.toString(16)+`>`}_getMinimalHex(){return this._magnitude===0n?`0`:this._magnitude.toString(16)}toString(e=10,t=1){if(e===16||e===`hex`){let e=this._getMinimalHex();if(t>1)for(e!==`0`&&e.length%2!=0&&(e=`0`+e);e.length%t!==0;)e=`0`+e;return(this.isNeg()?`-`:``)+e}if(typeof e!=`number`||e<2||e>36||e%1!=0)throw Error(`Base should be an integer between 2 and 36`);return this.toBaseString(e,t)}toBaseString(t,n){if(this._magnitude===0n){let e=`0`;if(n>1)for(;e.length<n;)e=`0`+e;return e}let r=e.groupSizes[t],i=BigInt(e.groupBases[t]);(r===0||i===0n)&&(r=Math.floor(Math.log(2**53-1)/Math.log(t)),r===0&&(r=1),i=BigInt(t)**BigInt(r));let a=``,o=this._magnitude;for(;o>0n;){let n=o%i;o/=i;let s=this._bigIntToStringInBase(n,t);if(o>0n){let t=r-s.length;a=t>0&&t<e.zeros.length?e.zeros[t]+s+a:t>0?`0`.repeat(t)+s+a:s+a}else a=s+a}if(n>0)for(;a.length<n;)a=`0`+a;return(this._sign===1?`-`:``)+a}toNumber(){let t=this._getSignedValue();if(t>e.MAX_SAFE_INTEGER_BIGINT||t<e.MIN_SAFE_INTEGER_BIGINT)throw Error(`Number can only safely store up to 53 bits`);return Number(t)}toJSON(){let e=this._getMinimalHex();return(this.isNeg()?`-`:``)+e}toArrayLikeGeneric(e,t){let n=this._magnitude,r=t?0:e.length-1,i=t?1:-1;for(let t=0;t<e.length;++t){if(n===0n&&r>=0&&r<e.length)e[r]=0;else if(r>=0&&r<e.length)e[r]=Number(n&255n);else break;n>>=8n,r+=i}}toArray(e=`be`,t){this.strip();let n=this.byteLength(),r=t??Math.max(1,n);this.assert(n<=r,`byte array longer than desired length`),this.assert(r>0,`Requested array length <= 0`);let i=Array(r).fill(0);return this._magnitude===0n&&r>0?i:this._magnitude===0n&&r===0?[]:(this.toArrayLikeGeneric(i,e===`le`),i)}bitLength(){return this._magnitude===0n?0:this._magnitude.toString(2).length}static toBitArray(e){let t=e.bitLength();if(t===0)return[];let n=Array(t),r=e._magnitude;for(let e=0;e<t;e++)n[e]=(r>>BigInt(e)&1n)==0n?0:1;return n}toBitArray(){return e.toBitArray(this)}zeroBits(){if(this._magnitude===0n)return 0;let e=0,t=this._magnitude;for(;(t&1n)==0n&&t!==0n;)e++,t>>=1n;return e}byteLength(){return this._magnitude===0n?0:Math.ceil(this.bitLength()/8)}_getSignedValue(){return this._sign===1?-this._magnitude:this._magnitude}_setValueFromSigned(e){e<0n?(this._magnitude=-e,this._sign=1):(this._magnitude=e,this._sign=0),this._finishInitialization(),this.normSign()}toTwos(t){this.assert(t>=0);let n=BigInt(t),r=this._getSignedValue();this._sign===1&&this._magnitude!==0n&&(r=(1n<<n)+r);let i=(1n<<n)-1n;r&=i;let a=new e(0n);return a._initializeState(r,0),a}fromTwos(t){this.assert(t>=0);let n=BigInt(t),r=this._magnitude;if(t>0&&(r>>n-1n&1n)!=0n&&this._sign===0){let t=r-(1n<<n),i=new e(0n);return i._setValueFromSigned(t),i}return this.clone()}isNeg(){return this._sign===1&&this._magnitude!==0n}neg(){return this.clone().ineg()}ineg(){return this._magnitude!==0n&&(this._sign=this._sign===1?0:1),this}_iuop(e,t){let n=t(this._magnitude,e._magnitude),r=t===((e,t)=>e^t),i=this._nominalWordLength;return r&&(i=Math.max(this.length,e.length)),this._magnitude=n,this._finishInitialization(),r&&(this._nominalWordLength=Math.max(this._nominalWordLength,i)),this.strip()}iuor(e){return this._iuop(e,(e,t)=>e|t)}iuand(e){return this._iuop(e,(e,t)=>e&t)}iuxor(e){return this._iuop(e,(e,t)=>e^t)}_iop(e,t){return this.assert(this._sign===0&&e._sign===0),this._iuop(e,t)}ior(e){return this._iop(e,(e,t)=>e|t)}iand(e){return this._iop(e,(e,t)=>e&t)}ixor(e){return this._iop(e,(e,t)=>e^t)}_uop_new(e,t){return this.length>=e.length?this.clone()[t](e):e.clone()[t](this)}or(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuor`)}uor(e){return this._uop_new(e,`iuor`)}and(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuand`)}uand(e){return this._uop_new(e,`iuand`)}xor(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuxor`)}uxor(e){return this._uop_new(e,`iuxor`)}inotn(t){this.assert(typeof t==`number`&&t>=0);let n=(1n<<BigInt(t))-1n;this._magnitude=~this._magnitude&n;let r=t===0?1:Math.ceil(t/e.wordSize);return this._nominalWordLength=Math.max(1,r),this.strip(),this._nominalWordLength=Math.max(this._nominalWordLength,Math.max(1,r)),this}notn(e){return this.clone().inotn(e)}setn(t,n){this.assert(typeof t==`number`&&t>=0);let r=BigInt(t);n===1||n===!0?this._magnitude|=1n<<r:this._magnitude&=~(1n<<r);let i=Math.floor(t/e.wordSize)+1;return this._nominalWordLength=Math.max(this._nominalWordLength,i),this._finishInitialization(),this.strip()}iadd(e){return this._setValueFromSigned(this._getSignedValue()+e._getSignedValue()),this}add(t){let n=new e(0n);return n._setValueFromSigned(this._getSignedValue()+t._getSignedValue()),n}isub(e){return this._setValueFromSigned(this._getSignedValue()-e._getSignedValue()),this}sub(t){let n=new e(0n);return n._setValueFromSigned(this._getSignedValue()-t._getSignedValue()),n}mul(t){let n=new e(0n);return n._magnitude=this._magnitude*t._magnitude,n._sign=n._magnitude===0n?0:this._sign^t._sign,n._nominalWordLength=this.length+t.length,n.red=null,n.normSign()}imul(e){return this._magnitude*=e._magnitude,this._sign=this._magnitude===0n?0:this._sign^e._sign,this._nominalWordLength=this.length+e.length,this.red=null,this.normSign()}imuln(t){return this.assert(typeof t==`number`,`Assertion failed`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Assertion failed`),this._setValueFromSigned(this._getSignedValue()*BigInt(t)),this}muln(e){return this.clone().imuln(e)}sqr(){let t=new e(0n);return t._magnitude=this._magnitude*this._magnitude,t._sign=0,t._nominalWordLength=this.length*2,t.red=null,t}isqr(){return this._magnitude*=this._magnitude,this._sign=0,this._nominalWordLength=this.length*2,this.red=null,this}pow(t){if(this.assert(t._sign===0,`Exponent for pow must be non-negative`),t.isZero())return new e(1n);let n=new e(1n),r=this.clone(),i=t.clone(),a=r.isNeg(),o=i.isOdd();for(a&&r.ineg();!i.isZero();)i.isOdd()&&n.imul(r),r.isqr(),i.iushrn(1);return a&&o&&n.ineg(),n}iushln(e){return this.assert(typeof e==`number`&&e>=0),e===0?this:(this._magnitude<<=BigInt(e),this._finishInitialization(),this.strip())}ishln(e){return this.assert(this._sign===0,`ishln requires positive number`),this.iushln(e)}iushrn(e,t,n){if(this.assert(typeof e==`number`&&e>=0),e===0)return n?._initializeState(0n,0),this;if(n!=null){let t=(1n<<BigInt(e))-1n,r=this._magnitude&t;n._initializeState(r,0)}return this._magnitude>>=BigInt(e),this._finishInitialization(),this.strip()}ishrn(e,t,n){return this.assert(this._sign===0,`ishrn requires positive number`),this.iushrn(e,t,n)}shln(e){return this.clone().ishln(e)}ushln(e){return this.clone().iushln(e)}shrn(e){return this.clone().ishrn(e)}ushrn(e){return this.clone().iushrn(e)}testn(e){return this.assert(typeof e==`number`&&e>=0),(this._magnitude>>BigInt(e)&1n)!=0n}imaskn(t){this.assert(typeof t==`number`&&t>=0),this.assert(this._sign===0,`imaskn works only with positive numbers`);let n=BigInt(t),r=n===0n?0n:(1n<<n)-1n;this._magnitude&=r;let i=t===0?1:Math.max(1,Math.ceil(t/e.wordSize));return this._nominalWordLength=i,this._finishInitialization(),this._nominalWordLength=Math.max(this._nominalWordLength,i),this.strip()}maskn(e){return this.clone().imaskn(e)}iaddn(t){return this.assert(typeof t==`number`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`num is too large`),this._setValueFromSigned(this._getSignedValue()+BigInt(t)),this}_iaddn(e){return this.iaddn(e)}isubn(t){return this.assert(typeof t==`number`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Assertion failed`),this._setValueFromSigned(this._getSignedValue()-BigInt(t)),this}addn(e){return this.clone().iaddn(e)}subn(e){return this.clone().isubn(e)}iabs(){return this._sign=0,this}abs(){return this.clone().iabs()}divmod(t,n,r){if(this.assert(!t.isZero(),`Division by zero`),this.isZero()){let t=new e(0n);return{div:n===`mod`?null:t,mod:n===`div`?null:t}}let i=this._getSignedValue(),a=t._getSignedValue(),o=null,s=null;n!==`mod`&&(o=i/a),n!==`div`&&(s=i%a,r===!0&&s<0n&&(s+=a<0n?-a:a));let c=o===null?null:new e(0n);c!==null&&o!==null&&c._setValueFromSigned(o);let l=s===null?null:new e(0n);return l!==null&&s!==null&&l._setValueFromSigned(s),{div:c,mod:l}}div(e){return this.divmod(e,`div`,!1).div}mod(e){return this.divmod(e,`mod`,!1).mod}umod(e){return this.divmod(e,`mod`,!0).mod}divRound(t){this.assert(!t.isZero());let n=this._getSignedValue(),r=t._getSignedValue(),i=n/r,a=n%r;if(a===0n){let t=new e(0n);return t._setValueFromSigned(i),t}let o=a<0n?-a:a,s=r<0n?-r:r;o*2n>=s&&(n>0n&&r>0n||n<0n&&r<0n?i+=1n:i-=1n);let c=new e(0n);return c._setValueFromSigned(i),c}modrn(e){this.assert(e!==0,`Division by zero in modrn`);let t=BigInt(Math.abs(e));if(t===0n)throw Error(`Division by zero in modrn`);let n=this._magnitude%t;return e<0?Number(-n):Number(n)}idivn(t){return this.assert(t!==0),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`num is too large`),this._setValueFromSigned(this._getSignedValue()/BigInt(t)),this}divn(e){return this.clone().idivn(e)}egcd(t){this.assert(t._sign===0,`p must not be negative`),this.assert(!t.isZero(),`p must not be zero`);let n=this._getSignedValue(),r=t._magnitude,i=1n,a=0n,o=0n,s=1n;for(;r!==0n;){let e=n/r,t=r;r=n%r,n=t,t=a,a=i-e*a,i=t,t=s,s=o-e*s,o=t}let c=new e(0n);c._setValueFromSigned(i);let l=new e(0n);l._setValueFromSigned(o);let u=new e(0n);return u._initializeState(n<0n?-n:n,0),{a:c,b:l,gcd:u}}gcd(t){let n=this._magnitude,r=t._magnitude;if(n===0n){let t=new e(0n);return t._setValueFromSigned(r),t.iabs()}if(r===0n){let t=new e(0n);return t._setValueFromSigned(n),t.iabs()}for(;r!==0n;){let e=n%r;n=r,r=e}let i=new e(0n);return i._initializeState(n,0),i}invm(e){this.assert(!e.isZero()&&e._sign===0,`Modulus for invm must be positive and non-zero`);let t=this.egcd(e);if(!t.gcd.eqn(1))throw Error(`Inverse does not exist (numbers are not coprime).`);return t.a.umod(e)}isEven(){return this._magnitude%2n==0n}isOdd(){return this._magnitude%2n==1n}andln(e){return this.assert(e>=0),Number(this._magnitude&BigInt(e))}bincn(e){this.assert(typeof e==`number`&&e>=0);let t=1n<<BigInt(e);return this._setValueFromSigned(this._getSignedValue()+t),this}isZero(){return this._magnitude===0n}cmpn(t){this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Number is too big`);let n=this._getSignedValue(),r=BigInt(t);return n<r?-1:n>r?1:0}cmp(e){let t=this._getSignedValue(),n=e._getSignedValue();return t<n?-1:t>n?1:0}ucmp(e){return this._magnitude<e._magnitude?-1:this._magnitude>e._magnitude?1:0}gtn(e){return this.cmpn(e)===1}gt(e){return this.cmp(e)===1}gten(e){return this.cmpn(e)>=0}gte(e){return this.cmp(e)>=0}ltn(e){return this.cmpn(e)===-1}lt(e){return this.cmp(e)===-1}lten(e){return this.cmpn(e)<=0}lte(e){return this.cmp(e)<=0}eqn(e){return this.cmpn(e)===0}eq(e){return this.cmp(e)===0}toRed(e){return this.assert(this.red==null,`Already a number in reduction context`),this.assert(this._sign===0,`toRed works only with positives`),e.convertTo(this).forceRed(e)}fromRed(){return this.assert(this.red,`fromRed works only with numbers in reduction context`),this.red.convertFrom(this)}forceRed(e){return this.red=e,this}redAdd(e){return this.assert(this.red,`redAdd works only with red numbers`),this.red.add(this,e)}redIAdd(e){return this.assert(this.red,`redIAdd works only with red numbers`),this.red.iadd(this,e)}redSub(e){return this.assert(this.red,`redSub works only with red numbers`),this.red.sub(this,e)}redISub(e){return this.assert(this.red,`redISub works only with red numbers`),this.red.isub(this,e)}redShl(e){return this.assert(this.red,`redShl works only with red numbers`),this.red.shl(this,e)}redMul(e){return this.assert(this.red,`redMul works only with red numbers`),this.red.verify2(this,e),this.red.mul(this,e)}redIMul(e){return this.assert(this.red,`redIMul works only with red numbers`),this.red.verify2(this,e),this.red.imul(this,e)}redSqr(){return this.assert(this.red,`redSqr works only with red numbers`),this.red.verify1(this),this.red.sqr(this)}redISqr(){return this.assert(this.red,`redISqr works only with red numbers`),this.red.verify1(this),this.red.isqr(this)}redSqrt(){return this.assert(this.red,`redSqrt works only with red numbers`),this.red.verify1(this),this.red.sqrt(this)}redInvm(){return this.assert(this.red,`redInvm works only with red numbers`),this.red.verify1(this),this.red.invm(this)}redNeg(){return this.assert(this.red,`redNeg works only with red numbers`),this.red.verify1(this),this.red.neg(this)}redPow(e){return this.assert(this.red!=null&&e.red==null,`redPow(normalNum)`),this.red.verify1(this),this.red.pow(this,e)}static fromHex(t,n){let r=`be`;return(n===`little`||n===`le`)&&(r=`le`),new e(t,16,r)}toHex(e=0){if(this.isZero()&&e===0)return``;let t=this._getMinimalHex();t!==`0`&&t.length%2!=0&&(t=`0`+t);let n=e*2;for(;t.length<n;)t=`0`+t;return(this.isNeg()?`-`:``)+t}static fromJSON(t){return new e(t,16)}static fromNumber(t){return new e(t)}static fromString(t,n){return new e(t,n)}static fromSm(t,n=`big`){if(t.length===0)return new e(0n);let r=0,i=``;if(n===`little`){let e=t.length-1,n=t[e];n&128&&(r=1,n&=127),i+=(n<16?`0`:``)+n.toString(16);for(let n=e-1;n>=0;n--){let e=t[n];i+=(e<16?`0`:``)+e.toString(16)}}else{let e=t[0];e&128&&(r=1,e&=127),i+=(e<16?`0`:``)+e.toString(16);for(let e=1;e<t.length;e++){let n=t[e];i+=(n<16?`0`:``)+n.toString(16)}}let a=i===``?0n:BigInt(`0x`+i),o=new e(0n);return o._initializeState(a,r),o}toSm(e=`big`){if(this._magnitude===0n)return this._sign===1?[128]:[];let t=this._getMinimalHex();t.length%2!=0&&(t=`0`+t);let n=t.length/2,r=Array(n);for(let e=0,n=0;e<t.length;e+=2)r[n++]=parseInt(t.slice(e,e+2),16);return this._sign===1?r[0]&128?r.unshift(128):r[0]|=128:r[0]&128&&r.unshift(0),e===`little`?r.reverse():r}static fromBits(t,n=!1){let r=t>>>24,i=t&8388607,a=(t&8388608)!=0;if(n&&a)throw Error(`negative bit set`);if(r===0&&i===0){if(a&&n)throw Error(`negative bit set for zero value`);return new e(0n)}let o=new e(i);return r<=3?o.iushrn((3-r)*8):o.iushln((r-3)*8),a&&o.ineg(),o}toBits(){if(this.strip(),this.isZero()&&!this.isNeg())return 0;let e=this.isNeg(),t=this.abs(),n=t.toArray(`be`),r=0;for(;r<n.length-1&&n[r]===0;)r++;n=n.slice(r);let i=n.length;i===0&&!t.isZero()&&(n=[0],i=1),t.isZero()&&(i=0,n=[]);let a;if(i===0)a=0;else if(i<=3){a=0;for(let e=0;e<i;e++)a=a<<8|n[e]}else a=n[0]<<16|n[1]<<8|n[2];a&8388608&&i<=255&&(a>>>=8,i++);let o=i<<24|a;return e&&(o|=8388608),o>>>0}static fromScriptNum(t,n=!1,r){if(r!==void 0&&t.length>r)throw Error(`script number overflow`);if(t.length===0)return new e(0n);if(n&&!(t[t.length-1]&127)&&(t.length<=1||!(t[t.length-2]&128)))throw Error(`non-minimally encoded script number`);return e.fromSm(t,`little`)}toScriptNum(){return this.toSm(`little`)}_invmp(t){this.assert(t._sign===0,`p must not be negative for _invmp`),this.assert(!t.isZero(),`p must not be zero for _invmp`);let n=this.umod(t)._magnitude,r=t._magnitude,i=1n,a=0n,o=t._magnitude;for(;n>1n&&r>1n;){let e=0;for(;(n>>BigInt(e)&1n)==0n;)e++;if(e>0){n>>=BigInt(e);for(let t=0;t<e;++t)(i&1n)!=0n&&(i+=o),i>>=1n}let t=0;for(;(r>>BigInt(t)&1n)==0n;)t++;if(t>0){r>>=BigInt(t);for(let e=0;e<t;++e)(a&1n)!=0n&&(a+=o),a>>=1n}n>=r?(n-=r,i-=a):(r-=n,a-=i)}let s;if(n===1n)s=i;else if(r===1n)s=a;else if(n===0n&&r===1n)s=a;else if(r===0n&&n===1n)s=i;else throw Error(`_invmp: GCD is not 1, inverse does not exist. aVal=`+n+`, bVal=`+r);s%=o,s<0n&&(s+=o);let c=new e(0n);return c._initializeState(s,0),c}mulTo(e,t){return t._magnitude=this._magnitude*e._magnitude,t._sign=t._magnitude===0n?0:this._sign^e._sign,t._nominalWordLength=this.length+e.length,t.red=null,t.normSign(),t}},cc=class{name;p;k;n;tmp;constructor(e,t){this.name=e,this.p=new B(t,16),this.n=this.p.bitLength(),this.k=new B(BigInt(1)).iushln(this.n).isub(this.p),this.tmp=this._tmp()}_tmp(){let e=new B(BigInt(0)),t=Math.ceil(this.n/B.wordSize);return e.expand(Math.max(1,t)),e}ireduce(e){let t=e,n;do this.split(t,this.tmp),this.imulK(t),t.iadd(this.tmp),n=t.bitLength();while(n>this.n);let r=n<this.n?-1:t.ucmp(this.p);return r===0?t.words=[0]:r>0&&t.isub(this.p),t.strip(),t}split(e,t){e.iushrn(this.n,0,t)}imulK(e){return e.imul(this.k)}},lc=class extends cc{constructor(){super(`k256`,`ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f`)}split(e,t){let n=4194303,r=e.words,i=e.length,a=Math.min(i,9),o=Array(a+(i>9?1:0)).fill(0);for(let e=0;e<a;e++)o[e]=r[e];let s=a;if(i<=9){let n=Array(s);for(let e=0;e<s;++e)n[e]=o[e];t.words=n,e.words=[0];return}let c=r[9];o[s++]=c&n;let l=Array(s);for(let e=0;e<s;++e)l[e]=o[e];t.words=l;let u=Array(Math.max(1,i-9)).fill(0),d=0;for(let e=10;e<i;e++){let t=r[e]|0;d<u.length&&(u[d++]=(t&n)<<4|c>>>22),c=t}c>>>=22,d<u.length?u[d++]=c:c!==0&&u.length;let f=Array(d);for(let e=0;e<d;++e)f[e]=u[e];e.words=f}imulK(e){let t=e.words,n=e.length,r=n+2,i=Array(r).fill(0);for(let e=0;e<n;e++)i[e]=t[e];let a=0;for(let e=0;e<r;e++){let t=i[e]|0;a+=t*977,i[e]=a&67108863,a=t*64+(a/67108864|0)}return e.words=i,e}},uc=class{prime;m;constructor(e){if(e===`k256`){let e=new lc;this.m=e.p,this.prime=e}else this.assert(e.gtn(1),`modulus must be greater than 1`),this.m=e,this.prime=null}assert(e,t=`Assertion failed`){if(!e)throw Error(t)}verify1(e){this.assert(e.negative===0,`red works only with positives`),this.assert(e.red,`red works only with red numbers`)}verify2(e,t){this.assert((e.negative|t.negative)===0,`red works only with positives`),this.assert(e.red!=null&&e.red===t.red,`red works only with red numbers`)}imod(e){return this.prime==null?(B.move(e,e.umod(this.m).forceRed(this)),e):this.prime.ireduce(e).forceRed(this)}neg(e){return e.isZero()?e.clone():this.m.sub(e).forceRed(this)}add(e,t){this.verify2(e,t);let n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n.forceRed(this)}iadd(e,t){this.verify2(e,t);let n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n}sub(e,t){this.verify2(e,t);let n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n.forceRed(this)}isub(e,t){this.verify2(e,t);let n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n}shl(e,t){return this.verify1(e),this.imod(e.ushln(t))}imul(e,t){return this.verify2(e,t),this.imod(e.imul(t))}mul(e,t){return this.verify2(e,t),this.imod(e.mul(t))}isqr(e){return this.imul(e,e.clone())}sqr(e){return this.mul(e,e)}sqrt(e){if(e.isZero())return e.clone();let t=this.m.andln(3);if(this.assert(t%2==1),t===3){let t=this.m.add(new B(1)).iushrn(2);return this.pow(e,t)}let n=this.m.subn(1),r=0;for(;!n.isZero()&&n.andln(1)===0;)r++,n.iushrn(1);this.assert(!n.isZero());let i=new B(1).toRed(this),a=i.redNeg(),o=this.m.subn(1).iushrn(1),s=this.m.bitLength(),c=new B(2*s*s).toRed(this);for(;this.pow(c,o).cmp(a)!==0;)c.redIAdd(a);let l=this.pow(c,n),u=this.pow(e,n.addn(1).iushrn(1)),d=this.pow(e,n),f=r;for(;d.cmp(i)!==0;){let e=d,t=0;for(;e.cmp(i)!==0;t++)e=e.redSqr();this.assert(t<f);let n=this.pow(l,new B(1).iushln(f-t-1));u=u.redMul(n),l=n.redSqr(),d=d.redMul(l),f=t}return u}invm(e){let t=e._invmp(this.m);return t.negative===0?this.imod(t):(t.negative=0,this.imod(t).redNeg())}pow(e,t){if(t.isZero())return new B(1).toRed(this);if(t.cmpn(1)===0)return e.clone();let n=Array(16);n[0]=new B(1).toRed(this),n[1]=e;let r=2;for(;r<n.length;r++)n[r]=this.mul(n[r-1],e);let i=n[0],a=0,o=0,s=t.bitLength()%26;for(s===0&&(s=26),r=t.length-1;r>=0;r--){let e=t.words[r];for(let t=s-1;t>=0;t--){let s=e>>t&1;if(i!==n[0]&&(i=this.sqr(i)),s===0&&a===0){o=0;continue}a<<=1,a|=s,o++,!(o!==4&&(r!==0||t!==0))&&(i=this.mul(i,n[a]),o=0,a=0)}s=26}return i}convertTo(e){let t=e.umod(this.m);return t===e?t.clone():t}convertFrom(e){let t=e.clone();return t.red=null,t}},dc=class extends uc{shift;r;r2;rinv;minv;constructor(e){super(e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new B(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}convertTo(e){return this.imod(e.ushln(this.shift))}convertFrom(e){let t=this.imod(e.mul(this.rinv));return t.red=null,t}imul(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;let n=e.imul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a.forceRed(this)}mul(e,t){if(e.isZero()||t.isZero())return new B(0).forceRed(this);let n=e.mul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a.forceRed(this)}invm(e){return this.imod(e._invmp(this.m).mul(this.r2)).forceRed(this)}},fc=class{curve;type;precomputed;constructor(e){this.curve=new zu,this.type=e,this.precomputed=null}},pc=class e extends fc{x;y;z;zOne;constructor(e,t,n){super(`jacobian`),e===null&&t===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new B(0)):(B.isBN(e)||(e=new B(e,16)),this.x=e,B.isBN(t)||(t=new B(t,16)),this.y=t,B.isBN(n)||(n=new B(n,16)),this.z=n),this.x.red??(this.x=this.x.toRed(this.curve.red)),this.y.red??(this.y=this.y.toRed(this.curve.red)),this.z.red??(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}toP(){if(this.isInfinity())return new Lu(null,null);let e=this.z.redInvm(),t=e.redSqr(),n=this.x.redMul(t),r=this.y.redMul(t).redMul(e);return new Lu(n,r)}neg(){return new e(this.x,this.y.redNeg(),this.z)}add(t){if(this.isInfinity())return t;if(t.isInfinity())return this;let n=t.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(n),a=t.x.redMul(r),o=this.y.redMul(n.redMul(t.z)),s=t.y.redMul(r.redMul(this.z)),c=i.redSub(a),l=o.redSub(s);if(c.cmpn(0)===0)return l.cmpn(0)===0?this.dbl():new e(null,null,null);let u=c.redSqr(),d=u.redMul(c),f=i.redMul(u),p=l.redSqr().redIAdd(d).redISub(f).redISub(f),m=l.redMul(f.redISub(p)).redISub(o.redMul(d)),h=this.z.redMul(t.z).redMul(c);return new e(p,m,h)}mixedAdd(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;if(t.x===null||t.y===null)throw Error(`Point coordinates cannot be null`);let n=this.z.redSqr(),r=this.x,i=t.x.redMul(n),a=this.y,o=t.y.redMul(n).redMul(this.z),s=r.redSub(i),c=a.redSub(o);if(s.cmpn(0)===0)return c.cmpn(0)===0?this.dbl():new e(null,null,null);let l=s.redSqr(),u=l.redMul(s),d=r.redMul(l),f=c.redSqr().redIAdd(u).redISub(d).redISub(d),p=c.redMul(d.redISub(f)).redISub(a.redMul(u)),m=this.z.redMul(s);return new e(f,p,m)}dblp(e){if(e===0||this.isInfinity())return this;if(e===void 0)return this.dbl();let t=this;for(let n=0;n<e;n++)t=t.dbl();return t}dbl(){if(this.isInfinity())return this;let t,n,r;if(this.zOne){let e=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(e).redISub(a);o=o.redIAdd(o);let s=e.redAdd(e).redIAdd(e),c=s.redSqr().redISub(o).redISub(o),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),t=c,n=s.redMul(o.redISub(c)).redISub(l),r=this.y.redAdd(this.y)}else{let e=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(e).redISub(a);o=o.redIAdd(o);let s=e.redAdd(e).redIAdd(e),c=s.redSqr(),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),t=c.redISub(o).redISub(o),n=s.redMul(o.redISub(t)).redISub(l),r=this.y.redMul(this.z),r=r.redIAdd(r)}return new e(t,n,r)}eq(e){if(e.type===`affine`)return this.eq(e.toJ());if(this===e)return!0;let t=this.z.redSqr();e=e;let n=e.z.redSqr();if(this.x.redMul(n).redISub(e.x.redMul(t)).cmpn(0)!==0)return!1;let r=t.redMul(this.z),i=n.redMul(e.z);return this.y.redMul(i).redISub(e.y.redMul(r)).cmpn(0)===0}eqXToP(e){let t=this.z.redSqr(),n=e.toRed(this.curve?.red).redMul(t);if(this.x.cmp(n)===0)return!0;let r=e.clone();if(this.curve===null||this.curve.redN==null)throw Error(`Curve or redN is not initialized.`);let i=this.curve.redN.redMul(t);for(;r.cmp(this.curve.p)<0;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(n.redIAdd(i),this.x.cmp(n)===0)return!0}return!1}inspect(){return this.isInfinity()?`<EC JPoint Infinity>`:`<EC JPoint x: `+this.x.toString(16,2)+` y: `+this.y.toString(16,2)+` z: `+this.z.toString(16,2)+`>`}isInfinity(){return this.z.cmpn(0)===0}},mc=(e,t=`Hash assertion failed`)=>{if(!e)throw Error(t)},hc=class{pending;pendingTotal;blockSize;outSize;endian;_delta8;_delta32;padLength;hmacStrength;constructor(e,t,n,r){this.pending=null,this.pendingTotal=0,this.blockSize=e,this.outSize=t,this.hmacStrength=n,this.padLength=r/8,this.endian=`big`,this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}_update(e,t){throw Error(`Not implemented`)}_digest(){throw Error(`Not implemented`)}_digestHex(){throw Error(`Not implemented`)}update(e,t){if(e=_c(e,t),this.pending==null?this.pending=e:this.pending=this.pending.concat(e),this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;let t=e.length%this._delta8;this.pending=e.slice(e.length-t,e.length),this.pending.length===0&&(this.pending=null),e=Sc(e,0,e.length-t,this.endian);for(let t=0;t<e.length;t+=this._delta32)this._update(e,t)}return this}digest(){return this.update(this._pad()),mc(this.pending===null),this._digest()}digestHex(){return this.update(this._pad()),mc(this.pending===null),this._digestHex()}_pad(){let e=this.pendingTotal,t=this._delta8,n=t-(e+this.padLength)%t,r=Array(n+this.padLength);r[0]=128;let i;for(i=1;i<n;i++)r[i]=0;e<<=3;let a;if(this.endian===`big`){for(a=8;a<this.padLength;a++)r[i++]=0;r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=e>>>24&255,r[i++]=e>>>16&255,r[i++]=e>>>8&255,r[i++]=e&255}else for(r[i++]=e&255,r[i++]=e>>>8&255,r[i++]=e>>>16&255,r[i++]=e>>>24&255,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,a=8;a<this.padLength;a++)r[i++]=0;return r}};function gc(e,t){return(e.charCodeAt(t)&64512)!=55296||t<0||t+1>=e.length?!1:(e.charCodeAt(t+1)&64512)==56320}function _c(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];let n=[];if(typeof e==`string`)if(t!==`hex`){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?n[t++]=i:i<2048?(n[t++]=i>>6|192,n[t++]=i&63|128):gc(e,r)?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),n[t++]=i>>18|240,n[t++]=i>>12&63|128,n[t++]=i>>6&63|128,n[t++]=i&63|128):(n[t++]=i>>12|224,n[t++]=i>>6&63|128,n[t++]=i&63|128)}}else{e=e.replace(/[^a-z0-9]+/gi,``),e.length%2!=0&&(e=`0`+e);for(let t=0;t<e.length;t+=2)n.push(parseInt(e[t]+e[t+1],16))}else{e=e;for(let t=0;t<e.length;t++)n[t]=e[t]|0}return n}function vc(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(e&255)<<24)>>>0}function yc(e,t){let n=``;for(let r=0;r<e.length;r++){let i=e[r];t===`little`&&(i=vc(i)),n+=bc(i.toString(16))}return n}function bc(e){return e.length===7?`0`+e:e.length===6?`00`+e:e.length===5?`000`+e:e.length===4?`0000`+e:e.length===3?`00000`+e:e.length===2?`000000`+e:e.length===1?`0000000`+e:e}function xc(e){let t=``;for(let n of e)t+=n.toString(16).padStart(2,`0`);return t}function Sc(e,t,n,r){let i=n-t;mc(i%4==0);let a=Array(i/4);for(let n=0,i=t;n<a.length;n++,i+=4){let t;t=r===`big`?e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]:e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i],a[n]=t>>>0}return a}function Cc(e,t){let n=Array(e.length*4);for(let r=0,i=0;r<e.length;r++,i+=4){let a=e[r];t===`big`?(n[i]=a>>>24,n[i+1]=a>>>16&255,n[i+2]=a>>>8&255,n[i+3]=a&255):(n[i+3]=a>>>24,n[i+2]=a>>>16&255,n[i+1]=a>>>8&255,n[i]=a&255)}return n}function wc(e,t){return e>>>t|e<<32-t}function Tc(e,t){return e<<t|e>>>32-t}function Ec(e,t){return e+t>>>0}function Dc(e,t,n){return e+t+n>>>0}function Oc(e,t,n,r){return e+t+n+r>>>0}function kc(e,t,n,r,i){return e+t+n+r+i>>>0}function Ac(e,t,n,r){return e===0?jc(t,n,r):e===1||e===3?Nc(t,n,r):e===2?Mc(t,n,r):0}function jc(e,t,n){return e&t^~e&n}function Mc(e,t,n){return e&t^e&n^t&n}function Nc(e,t,n){return e^t^n}function Pc(e){return wc(e,2)^wc(e,13)^wc(e,22)}function Fc(e){return wc(e,6)^wc(e,11)^wc(e,25)}function Ic(e){return wc(e,7)^wc(e,18)^e>>>3}function Lc(e){return wc(e,17)^wc(e,19)^e>>>10}var V=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],Rc=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],zc=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],Bc=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function Vc(e,t,n,r){return e<=15?t^n^r:e<=31?t&n|~t&r:e<=47?(t|~n)^r:e<=63?t&r|n&~r:t^(n|~r)}function Hc(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function Uc(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var Wc=class extends hc{h;constructor(){super(512,160,192,64),this.endian=`little`,this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian=`little`}_update(e,t){let n=this.h[0],r=this.h[1],i=this.h[2],a=this.h[3],o=this.h[4],s=n,c=r,l=i,u=a,d=o,f;for(let p=0;p<80;p++)f=Ec(Tc(Oc(n,Vc(p,r,i,a),e[V[p]+t],Hc(p)),zc[p]),o),n=o,o=a,a=Tc(i,10),i=r,r=f,f=Ec(Tc(Oc(s,Vc(79-p,c,l,u),e[Rc[p]+t],Uc(p)),Bc[p]),d),s=d,d=u,u=Tc(l,10),l=c,c=f;f=Dc(this.h[1],i,u),this.h[1]=Dc(this.h[2],a,d),this.h[2]=Dc(this.h[3],o,s),this.h[3]=Dc(this.h[4],n,c),this.h[4]=Dc(this.h[0],r,l),this.h[0]=f}_digest(){return Cc(this.h,`little`)}_digestHex(){return yc(this.h,`little`)}},Gc=class{h;constructor(){this.h=new Il}update(e,t){let n=Uint8Array.from(_c(e,t));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return xc(this.h.digest())}},Kc=class extends hc{h;W;k;constructor(){super(512,160,80,64),this.k=[1518500249,1859775393,2400959708,3395469782],this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=Array(80)}_update(e,t){let n=this.W;t===void 0&&(t=0);let r;for(r=0;r<16;r++)n[r]=e[t+r];for(;r<n.length;r++)n[r]=Tc(n[r-3]^n[r-8]^n[r-14]^n[r-16],1);let i=this.h[0],a=this.h[1],o=this.h[2],s=this.h[3],c=this.h[4];for(r=0;r<n.length;r++){let e=~~(r/20),t=kc(Tc(i,5),Ac(e,a,o,s),c,n[r],this.k[e]);c=s,s=o,o=Tc(a,30),a=i,i=t}this.h[0]=Ec(this.h[0],i),this.h[1]=Ec(this.h[1],a),this.h[2]=Ec(this.h[2],o),this.h[3]=Ec(this.h[3],s),this.h[4]=Ec(this.h[4],c)}_digest(){return Cc(this.h,`big`)}_digestHex(){return yc(this.h,`big`)}},qc=class{h;blockSize=64;outSize=32;constructor(e){let t=Uint8Array.from(_c(e,`hex`));this.h=new Kl(Ll,t)}update(e,t){return this.h.update(Uint8Array.from(_c(e,t))),this}digest(){return Array.from(this.h.digest())}digestHex(){return xc(this.h.digest())}},Jc=class{h;blockSize=128;outSize=32;constructor(e){let t=Uint8Array.from(_c(e,`hex`));this.h=new Kl(Gl,t)}update(e,t){return this.h.update(Uint8Array.from(_c(e,t))),this}digest(){return Array.from(this.h.digest())}digestHex(){return xc(this.h.digest())}};const Yc=(e,t)=>new Wc().update(e,t).digest(),Xc=(e,t)=>new Kc().update(e,t).digest(),Zc=(e,t)=>new Gc().update(e,t).digest(),Qc=(e,t)=>{let n=new Gc().update(e,t).digest();return new Gc().update(n).digest()},$c=(e,t)=>{let n=new Gc().update(e,t).digest();return new Wc().update(n).digest()},el=(e,t,n)=>new qc(e).update(t,n).digest(),tl=(e,t,n)=>new Jc(e).update(t,n).digest();function nl(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function rl(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got ${e}`)}function il(e,...t){if(!nl(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length)){let n=t.join(`,`);throw Error(`Uint8Array expected of length ${n}, got length=${e.length}`)}}function al(e){if(typeof e!=`function`||typeof e.create!=`function`)throw Error(`Hash should be wrapped by utils.createHasher`);rl(e.outputLen),rl(e.blockLen)}function ol(e,t=!0){if(e.destroyed===!0)throw Error(`Hash instance has been destroyed`);if(t&&e.finished===!0)throw Error(`Hash#digest() has already been called`)}function sl(e,t){il(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least ${n}`)}function cl(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ll(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function ul(e){return typeof e==`string`&&(e=dl(e)),il(e),e}function dl(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}var fl=class{};function pl(e){let t=t=>e().update(ul(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}var ml=BigInt(2**32-1),hl=BigInt(32);function gl(e,t=!1){return t?{h:Number(e&ml),l:Number(e>>hl&ml)}:{h:Number(e>>hl&ml)|0,l:Number(e&ml)|0}}function _l(e,t=!1){let n=e.length,r=new Uint32Array(n),i=new Uint32Array(n);for(let a=0;a<n;a++){let{h:n,l:o}=gl(e[a],t);r[a]=n,i[a]=o}return[r,i]}var vl=(e,t,n)=>e>>>n,yl=(e,t,n)=>e<<32-n|t>>>n,bl=(e,t,n)=>e>>>n|t<<32-n,xl=(e,t,n)=>e<<32-n|t>>>n,Sl=(e,t,n)=>e<<64-n|t>>>n-32,Cl=(e,t,n)=>e>>>n-32|t<<64-n;function wl(e,t,n,r){let i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}var Tl=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),El=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,Dl=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),Ol=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,kl=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),Al=(e,t,n,r,i,a)=>t+n+r+i+a+(e/2**32|0)|0,jl=class extends fl{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=ll(this.buffer)}update(e){ol(this),e=ul(e),il(e);let{view:t,buffer:n,blockLen:r}=this,i=e.length;for(let a=0;a<i;){let o=Math.min(r-this.pos,i-a);if(o===r){let t=ll(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ol(this),sl(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,cl(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;Ml(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=ll(e),s=this.outputLen;if(s%4!=0)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.destroyed=a,e.finished=i,e.length=r,e.pos=o,r%t!==0&&e.buffer.set(n),e}clone(){return this._cloneInto()}};function Ml(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}var Nl=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pl=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Fl=new Uint32Array(64),Il=class extends jl{A=Nl[0]|0;B=Nl[1]|0;C=Nl[2]|0;D=Nl[3]|0;E=Nl[4]|0;F=Nl[5]|0;G=Nl[6]|0;H=Nl[7]|0;constructor(e=32){super(64,e,8,!1)}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)Fl[n]=e.getUint32(t);for(let e=16;e<64;e++){let t=Fl[e-15],n=Fl[e-2],r=Ic(t),i=Lc(n);Fl[e]=Ec(Ec(r,Fl[e-7]),Ec(i,Fl[e-16]))}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=kc(l,Fc(o),jc(o,s,c),Pl[e],Fl[e]),u=Ec(Pc(n),Mc(n,r,i));l=c,c=s,s=o,o=Ec(a,t),a=i,i=r,r=n,n=Ec(t,u)}this.A=Ec(this.A,n),this.B=Ec(this.B,r),this.C=Ec(this.C,i),this.D=Ec(this.D,a),this.E=Ec(this.E,o),this.F=Ec(this.F,s),this.G=Ec(this.G,c),this.H=Ec(this.H,l)}roundClean(){cl(Fl)}destroy(){cl(this.buffer),this.set(0,0,0,0,0,0,0,0)}},Ll=pl(()=>new Il),Rl=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),zl=(()=>_l(`0x428a2f98d728ae22.0x7137449123ef65cd.0xb5c0fbcfec4d3b2f.0xe9b5dba58189dbbc.0x3956c25bf348b538.0x59f111f1b605d019.0x923f82a4af194f9b.0xab1c5ed5da6d8118.0xd807aa98a3030242.0x12835b0145706fbe.0x243185be4ee4b28c.0x550c7dc3d5ffb4e2.0x72be5d74f27b896f.0x80deb1fe3b1696b1.0x9bdc06a725c71235.0xc19bf174cf692694.0xe49b69c19ef14ad2.0xefbe4786384f25e3.0x0fc19dc68b8cd5b5.0x240ca1cc77ac9c65.0x2de92c6f592b0275.0x4a7484aa6ea6e483.0x5cb0a9dcbd41fbd4.0x76f988da831153b5.0x983e5152ee66dfab.0xa831c66d2db43210.0xb00327c898fb213f.0xbf597fc7beef0ee4.0xc6e00bf33da88fc2.0xd5a79147930aa725.0x06ca6351e003826f.0x142929670a0e6e70.0x27b70a8546d22ffc.0x2e1b21385c26c926.0x4d2c6dfc5ac42aed.0x53380d139d95b3df.0x650a73548baf63de.0x766a0abb3c77b2a8.0x81c2c92e47edaee6.0x92722c851482353b.0xa2bfe8a14cf10364.0xa81a664bbc423001.0xc24b8b70d0f89791.0xc76c51a30654be30.0xd192e819d6ef5218.0xd69906245565a910.0xf40e35855771202a.0x106aa07032bbd1b8.0x19a4c116b8d2d0c8.0x1e376c085141ab53.0x2748774cdf8eeb99.0x34b0bcb5e19b48a8.0x391c0cb3c5c95a63.0x4ed8aa4ae3418acb.0x5b9cca4f7763e373.0x682e6ff3d6b2b8a3.0x748f82ee5defb2fc.0x78a5636f43172f60.0x84c87814a1f0ab72.0x8cc702081a6439ec.0x90befffa23631e28.0xa4506cebde82bde9.0xbef9a3f7b2c67915.0xc67178f2e372532b.0xca273eceea26619c.0xd186b8c721c0c207.0xeada7dd6cde0eb1e.0xf57d4f7fee6ed178.0x06f067aa72176fba.0x0a637dc5a2c898a6.0x113f9804bef90dae.0x1b710b35131c471b.0x28db77f523047d84.0x32caab7b40c72493.0x3c9ebe0a15c9bebc.0x431d67c49c100d4c.0x4cc5d4becb3e42b6.0x597f299cfc657e2a.0x5fcb6fab3ad6faec.0x6c44198c4a475817`.split(`.`).map(e=>BigInt(e))))(),Bl=(()=>zl[0])(),Vl=(()=>zl[1])(),Hl=new Uint32Array(80),Ul=new Uint32Array(80),Wl=class extends jl{Ah=Rl[0]|0;Al=Rl[1]|0;Bh=Rl[2]|0;Bl=Rl[3]|0;Ch=Rl[4]|0;Cl=Rl[5]|0;Dh=Rl[6]|0;Dl=Rl[7]|0;Eh=Rl[8]|0;El=Rl[9]|0;Fh=Rl[10]|0;Fl=Rl[11]|0;Gh=Rl[12]|0;Gl=Rl[13]|0;Hh=Rl[14]|0;Hl=Rl[15]|0;constructor(e=64){super(128,e,16,!1)}get(){let{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:a,Dh:o,Dl:s,Eh:c,El:l,Fh:u,Fl:d,Gh:f,Gl:p,Hh:m,Hl:h}=this;return[e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h]}set(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=r|0,this.Ch=i|0,this.Cl=a|0,this.Dh=o|0,this.Dl=s|0,this.Eh=c|0,this.El=l|0,this.Fh=u|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=m|0,this.Hl=h|0}process(e,t){for(let n=0;n<16;n++,t+=4)Hl[n]=e.getUint32(t),Ul[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=Hl[e-15]|0,n=Ul[e-15]|0,r=bl(t,n,1)^bl(t,n,8)^vl(t,n,7),i=xl(t,n,1)^xl(t,n,8)^yl(t,n,7),a=Hl[e-2]|0,o=Ul[e-2]|0,s=bl(a,o,19)^Sl(a,o,61)^vl(a,o,6),c=xl(a,o,19)^Cl(a,o,61)^yl(a,o,6),l=Dl(i,c,Ul[e-7],Ul[e-16]);Hl[e]=Ol(l,r,s,Hl[e-7],Hl[e-16])|0,Ul[e]=l|0}let{Ah:n,Al:r,Bh:i,Bl:a,Ch:o,Cl:s,Dh:c,Dl:l,Eh:u,El:d,Fh:f,Fl:p,Gh:m,Gl:h,Hh:g,Hl:_}=this;for(let e=0;e<80;e++){let t=bl(u,d,14)^bl(u,d,18)^Sl(u,d,41),v=xl(u,d,14)^xl(u,d,18)^Cl(u,d,41),y=u&f^~u&m,b=d&p^~d&h,x=kl(_,v,b,Vl[e],Ul[e]),S=Al(x,g,t,y,Bl[e],Hl[e]),C=x|0,w=bl(n,r,28)^Sl(n,r,34)^Sl(n,r,39),T=xl(n,r,28)^Cl(n,r,34)^Cl(n,r,39),E=n&i^n&o^i&o,D=r&a^r&s^a&s;g=m|0,_=h|0,m=f|0,h=p|0,f=u|0,p=d|0,{h:u,l:d}=wl(c|0,l|0,S|0,C|0),c=o|0,l=s|0,o=i|0,s=a|0,i=n|0,a=r|0;let O=Tl(T,D,C);n=El(O,w,E,S),r=O|0}({h:n,l:r}=wl(n,r,this.Ah,this.Al)),{h:i,l:a}=wl(i,a,this.Bh,this.Bl),{h:o,l:s}=wl(o,s,this.Ch,this.Cl),{h:c,l}=wl(c,l,this.Dh,this.Dl),{h:u,l:d}=wl(u,d,this.Eh,this.El),{h:f,l:p}=wl(f,p,this.Fh,this.Fl),{h:m,l:h}=wl(m,h,this.Gh,this.Gl),{h:g,l:_}=wl(g,_,this.Hh,this.Hl),this.set(n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_)}roundClean(){cl(Hl,Ul)}destroy(){cl(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Gl=pl(()=>new Wl),Kl=class extends fl{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){super(),al(e);let n=ul(t);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),cl(i)}update(e){return ol(this),this.iHash.update(e),this}digestInto(e){ol(this),il(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash??void 0),e.iHash=n._cloneInto(e.iHash??void 0),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ql=(e,t,n)=>new Kl(e,t).update(n).digest();ql.create=(e,t)=>new Kl(e,t);const Jl=e=>e.length%2==1?`0`+e:e,H=e=>{let t=``;for(let n of e)t+=Jl(n.toString(16));return t},U=(e,t)=>{if(Array.isArray(e))return e.slice();if(e===void 0)return[];if(typeof e!=`string`)return Array.from(e,e=>e|0);switch(t){case`hex`:return Yl(e);case`base64`:return Xl(e);default:return Zl(e)}};var Yl=e=>{e=e.replace(/[^a-z0-9]+/gi,``),e.length%2!=0&&(e=`0`+e);let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e[n]+e[n+1],16));return t},Xl=e=>{let t=[],n=0,r=0;for(let i of e.replace(/=+$/,``))n=n<<6|`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`.indexOf(i),r+=6,r>=8&&(r-=8,t.push(n>>r&255),n&=(1<<r)-1);return t};function Zl(e){let t=[];for(let n=0;n<e.length;n++){let r=e.codePointAt(n);if(r===void 0)throw Error(`Index out of range: ${n}`);let i=r;i>65535?n++:i>=55296&&i<=57343&&(i=65533),i<=127?t.push(i):i<=2047?t.push(192|i>>6,128|i&63):i<=65535?t.push(224|i>>12,128|i>>6&63,128|i&63):t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}return t}const W=e=>{let t=``,n=0;for(let r=0;r<e.length;r++){let i=e[r];if(n>0){n--;continue}if(i<=127)t+=String.fromCharCode(i);else if(i>=192&&i<=223){let a=e[r+1];n=1;let o=(i&31)<<6|a&63;t+=String.fromCharCode(o)}else if(i>=224&&i<=239){let a=e[r+1],o=e[r+2];n=2;let s=(i&15)<<12|(a&63)<<6|o&63;t+=String.fromCharCode(s)}else if(i>=240&&i<=247){let a=e[r+1],o=e[r+2],s=e[r+3];n=3;let c=(i&7)<<18|(a&63)<<12|(o&63)<<6|s&63,l=55296+(c-65536>>10),u=56320+(c-65536&1023);t+=String.fromCharCode(l,u)}}return t},Ql=(e,t)=>{switch(t){case`hex`:return H(e);case`utf8`:return W(e);default:return e}};function $l(e){let t=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,n=``,r;for(r=0;r<e.length;r+=3){let i=e[r],a=r+1<e.length?e[r+1]:0,o=r+2<e.length?e[r+2]:0,s=i>>2,c=(i&3)<<4|a>>4,l=(a&15)<<2|o>>6,u=o&63;n+=t.charAt(s)+t.charAt(c),n+=r+1<e.length?t.charAt(l):`=`,n+=r+2<e.length?t.charAt(u):`=`}return n}var eu=`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`;const tu=e=>{if(e===``||typeof e!=`string`)throw Error(`Expected base58 string but got ${e}`);let t=e.match(/[IOl0]/gmu);if(t!==null)throw Error(`Invalid base58 character ${t.join(``)}`);let n=e.match(/^1+/gmu),r=n===null?0:n[0].length,i=(e.length-r)*(Math.log(58)/Math.log(256))+1>>>0;return[...new Uint8Array([...new Uint8Array(r),...(e.match(/./gmu)??[]).map(e=>eu.indexOf(e)).reduce((e,t)=>(e=e.map(e=>{let n=e*58+t;return t=n>>8,n}),e),new Uint8Array(i)).reverse().filter((e=>t=>e||=t)(!1))])]},nu=e=>{let t=Array(256).fill(-1);for(let e=0;e<58;++e)t[eu.charCodeAt(e)]=e;let n=[];for(let r of e){let e=r;for(let r=0;r<n.length;++r){let i=(t[n[r]]<<8)+e;n[r]=eu.charCodeAt(i%58),e=i/58|0}for(;e!==0;)n.push(eu.charCodeAt(e%58)),e=e/58|0}for(let t of e)if(t!==0)break;else n.push(49);return n.reverse(),String.fromCharCode(...n)},ru=(e,t=[0])=>{let n=Qc([...t,...e]);return n=[...t,...e,...n.slice(0,4)],nu(n)},iu=(e,t,n=1)=>{let r=tu(e),i=r.slice(0,n),a=r.slice(n,-4),o=[...i,...a];return o=Qc(o),r.slice(-4).forEach((e,t)=>{if(e!==o[t])throw Error(`Invalid checksum`)}),t===`hex`&&(i=H(i),a=H(a)),{prefix:i,data:a}};var au=class e{bufs;length;constructor(e){this.bufs=e===void 0?[]:e,this.length=0;for(let e of this.bufs)this.length+=e.length}getLength(){return this.length}toArray(){let e=this.length,t=Array(e),n=0;for(let e of this.bufs)for(let r of e)t[n++]=r;return t}write(e){return this.bufs.push(e),this.length+=e.length,this}writeReverse(e){let t=Array(e.length);for(let n=0;n<t.length;n++)t[n]=e[e.length-1-n];return this.bufs.push(t),this.length+=t.length,this}writeUInt8(e){let t=[,];return t[0]=e,this.write(t),this}writeInt8(e){let t=[,];return t[0]=e&255,this.write(t),this}writeUInt16BE(e){let t=[e>>8&255,e&255];return this.bufs.push(t),this.length+=2,this}writeInt16BE(e){return this.writeUInt16BE(e&65535)}writeUInt16LE(e){let t=[e&255,e>>8&255];return this.bufs.push(t),this.length+=2,this}writeInt16LE(e){return this.writeUInt16LE(e&65535)}writeUInt32BE(e){let t=[e>>24&255,e>>16&255,e>>8&255,e&255];return this.bufs.push(t),this.length+=4,this}writeInt32BE(e){return this.writeUInt32BE(e>>>0)}writeUInt32LE(e){let t=[e&255,e>>8&255,e>>16&255,e>>24&255];return this.bufs.push(t),this.length+=4,this}writeInt32LE(e){return this.writeUInt32LE(e>>>0)}writeUInt64BEBn(e){let t=e.toArray(`be`,8);return this.write(t),this}writeUInt64LEBn(e){let t=e.toArray(`be`,8);return this.writeReverse(t),this}writeUInt64LE(e){let t=new B(e).toArray(`be`,8);return this.writeReverse(t),this}writeVarIntNum(t){let n=e.varIntNum(t);return this.write(n),this}writeVarIntBn(t){let n=e.varIntBn(t);return this.write(n),this}static varIntNum(e){let t;if(e<0)return this.varIntBn(new B(e));if(e<253)t=[e];else if(e<65536)t=[253,e&255,e>>8&255];else if(e<4294967296)t=[254,e&255,e>>8&255,e>>16&255,e>>24&255];else{let n=e&4294967295,r=Math.floor(e/4294967296)&4294967295;t=[255,n&255,n>>8&255,n>>16&255,n>>24&255,r&255,r>>8&255,r>>16&255,r>>24&255]}return t}static varIntBn(t){let n;if(t.isNeg()&&(t=t.add(lu)),t.ltn(253))n=[t.toNumber()];else if(t.ltn(65536)){let e=t.toNumber();n=[253,e&255,e>>8&255]}else if(t.lt(new B(4294967296))){let e=t.toNumber();n=[254,e&255,e>>8&255,e>>16&255,e>>24&255]}else{let r=new e;r.writeUInt8(255),r.writeUInt64LEBn(t),n=r.toArray()}return n}},ou=class{bin;pos;length;constructor(e=[],t=0){this.bin=e,this.pos=t,this.length=e.length}eof(){return this.pos>=this.length}read(e=this.length){let t=this.pos,n=this.pos+e;return this.pos=n,this.bin.slice(t,n)}readReverse(e=this.length){let t=Array(e);for(let n=0;n<e;n++)t[n]=this.bin[this.pos+e-1-n];return this.pos+=e,t}readUInt8(){let e=this.bin[this.pos];return this.pos+=1,e}readInt8(){let e=this.bin[this.pos];return this.pos+=1,e&128?e-256:e}readUInt16BE(){let e=this.bin[this.pos]<<8|this.bin[this.pos+1];return this.pos+=2,e}readInt16BE(){let e=this.readUInt16BE();return e&32768?e-65536:e}readUInt16LE(){let e=this.bin[this.pos]|this.bin[this.pos+1]<<8;return this.pos+=2,e}readInt16LE(){let e=this.readUInt16LE();return e&32768?e-65536:e}readUInt32BE(){let e=this.bin[this.pos]*16777216+(this.bin[this.pos+1]<<16|this.bin[this.pos+2]<<8|this.bin[this.pos+3]);return this.pos+=4,e}readInt32BE(){let e=this.readUInt32BE();return e&2147483648?e-4294967296:e}readUInt32LE(){let e=(this.bin[this.pos]|this.bin[this.pos+1]<<8|this.bin[this.pos+2]<<16|this.bin[this.pos+3]<<24)>>>0;return this.pos+=4,e}readInt32LE(){let e=this.readUInt32LE();return e&2147483648?e-4294967296:e}readUInt64BEBn(){let e=this.bin.slice(this.pos,this.pos+8),t=new B(e);return this.pos+=8,t}readUInt64LEBn(){let e=this.readReverse(8);return new B(e)}readInt64LEBn(){let e=this.readReverse(8),t=new B(e);return t.gte(cu)&&(t=t.sub(lu)),t}readVarIntNum(e=!0){let t=this.readUInt8(),n;switch(t){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:if(n=e?this.readInt64LEBn():this.readUInt64LEBn(),n.lte(new B(2).pow(new B(53))))return n.toNumber();throw Error(`number too large to retain precision - use readVarIntBn`);default:return t}}readVarInt(){switch(this.bin[this.pos]){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}}readVarIntBn(){let e=this.readUInt8();switch(e){case 253:return new B(this.readUInt16LE());case 254:return new B(this.readUInt32LE());case 255:return this.readUInt64LEBn();default:return new B(e)}}};const su=e=>{if(e.length===0)return e;let t=e[e.length-1];if(t&127)return e;if(e.length===1)return[];if(e[e.length-2]&128)return e;for(let n=e.length-1;n>0;n--)if(e[n-1]!==0)return e[n-1]&128?(e[n]=t,e.slice(0,n+1)):(e[n-1]|=t,e.slice(0,n));return[]};var cu=new B(2).pow(new B(63)),lu=new B(2).pow(new B(64));function uu(e,t=`Expected a valid value, but got undefined or null.`){if(e==null)throw Error(t);return e}const du=0n,fu=1n,pu=2n,mu=115792089237316195423570985008687907853269984665640564039457584007908834671663n,hu=115792089237316195423570985008687907852837564279074904382605163141518161494337n,gu=(1n<<256n)-1n;function _u(e){let t=e>>256n;return e=(e&gu)+(t<<32n)+t*977n,t=e>>256n,e=(e&gu)+(t<<32n)+t*977n,e>=115792089237316195423570985008687907853269984665640564039457584007908834671663n&&(e-=mu),e}const vu=e=>_u((e%mu+mu)%mu),yu=(e,t)=>e>=t?e-t:mu-(t-e),G=(e,t)=>_u(e*t),bu=(e,t)=>_u(e+t),xu=e=>{let t=fu,n=du,r=vu(e),i=mu;for(;r>fu;){let e=i/r;[t,n]=[n-t*e,t],[r,i]=[i-r*e,r]}return vu(t)},Su=e=>G(e,e),Cu=(e,t)=>{let n=fu;e=vu(e);let r=t;for(;r>du;)(r&1n)==1n&&(n=G(n,e)),e=G(e,e),r>>=fu;return n},wu=mu+1n>>2n,Tu=e=>{let t=Cu(e,wu);return G(t,t)===vu(e)?t:null};var Eu=e=>B.isBN(e)?BigInt(`0x`+e.toString(16)):typeof e==`string`?BigInt(`0x`+e):Array.isArray(e)?BigInt(`0x`+H(e)):BigInt(e);const Du=BigInt(`0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798`),Ou=BigInt(`0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8`);var ku=new Map;const Au=e=>{let{X:t,Y:n,Z:r}=e;if(n===0n)return{X:du,Y:fu,Z:du};let i=G(n,n),a=G(4n,G(t,i)),o=G(3n,G(t,t)),s=yu(G(o,o),G(pu,a)),c=yu(G(o,yu(a,s)),G(8n,G(i,i))),l=G(pu,G(n,r));return{X:s,Y:c,Z:l}},ju=(e,t)=>{if(e.Z===0n)return t;if(t.Z===0n)return e;let n=G(e.Z,e.Z),r=G(t.Z,t.Z),i=G(e.X,r),a=G(t.X,n),o=G(e.Y,G(r,t.Z)),s=G(t.Y,G(n,e.Z)),c=yu(a,i),l=yu(s,o);if(c===0n)return l===0n?Au(e):{X:du,Y:fu,Z:du};let u=G(c,c),d=G(c,u),f=G(i,u),p=yu(yu(G(l,l),d),G(pu,f)),m=yu(G(l,yu(f,p)),G(o,d)),h=G(c,G(e.Z,t.Z));return{X:p,Y:m,Z:h}},Mu=e=>e.Z===0n?e:{X:e.X,Y:mu-e.Y,Z:e.Z},Nu=(e,t,n=5)=>{let r=`${n}:${t.x.toString(16)}:${t.y.toString(16)}`,i=ku.get(r),a;if(i===void 0){let e=1<<n-1;i=Array(e),a={X:t.x,Y:t.y,Z:fu},i[0]=a;let o=Au(a);for(let t=1;t<e;t++)i[t]=ju(i[t-1],o);ku.set(r,i)}else a=i[0];let o=[],s=1n<<BigInt(n),c=s>>1n,l=e;for(;l>0n;)if((l&1n)==0n)o.push(0),l>>=fu;else{let e=l&s-1n;e>c&&(e-=s),o.push(Number(e)),l-=e,l>>=fu}let u={X:du,Y:fu,Z:du};for(let e=o.length-1;e>=0;e--){u=Au(u);let t=o[e];if(t!==0){let e=Math.abs(t)>>1,n=t>0?i[e]:Mu(i[e]);u=ju(u,n)}}return u},Pu=e=>{let t=e%hu;return t<0n&&(t+=hu),t},Fu=(e,t)=>Pu(e*t),Iu=e=>{let t=1n,n=0n,r=Pu(e),i=hu;for(;r>1n;){let e=i/r;[t,n]=[n-t*e,t],[r,i]=[i-r*e,r]}return Pu(t)};var Lu=class e extends fc{x;y;inf;static fromDER(t){if((t[0]===4||t[0]===6||t[0]===7)&&t.length-1==64){if(t[0]===6){if(t[t.length-1]%2!=0)throw Error(`Point string value is wrong length`)}else if(t[0]===7&&t[t.length-1]%2!=1)throw Error(`Point string value is wrong length`);return new e(t.slice(1,33),t.slice(33,65))}else if((t[0]===2||t[0]===3)&&t.length-1==32)return e.fromX(t.slice(1,33),t[0]===3);throw Error(`Unknown point format`)}static fromString(t){let n=U(t,`hex`);return e.fromDER(n)}static fromX(t,n){let r=Eu(t);r=vu(r);let i=bu(G(Su(r),r),7n),a=Tu(i);if(a===null)throw Error(`Invalid point`);let o=a;(o&1n)!=(n?1n:0n)&&(o=yu(mu,o));let s=new B(r.toString(16),16),c=new B(o.toString(16),16);return new e(s,c)}static fromJSON(t,n){typeof t==`string`&&(t=JSON.parse(t));let r=new e(t[0],t[1],n);if(typeof t[2]!=`object`)return r;let i=t=>new e(t[0],t[1],n),a=t[2];return r.precomputed={beta:null,doubles:typeof a.doubles==`object`&&a.doubles!==null?{step:a.doubles.step,points:[r].concat(a.doubles.points.map(i))}:void 0,naf:typeof a.naf==`object`&&a.naf!==null?{wnd:a.naf.wnd,points:[r].concat(a.naf.points.map(i))}:void 0},r}constructor(e,t,n=!0){super(`affine`),this.precomputed=null,e===null&&t===null?(this.x=null,this.y=null,this.inf=!0):(B.isBN(e)||(e=new B(e,16)),this.x=e,B.isBN(t)||(t=new B(t,16)),this.y=t,n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red===null&&(this.x=this.x.toRed(this.curve.red)),this.y.red===null&&(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}validate(){return this.curve.validate(this)}encode(e=!0,t){let n=this.curve.p.byteLength(),r=this.getX().toArray(`be`,n),i;return i=e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray(`be`,n)),t===`hex`?H(i):i}toString(){return this.encode(!0,`hex`)}toJSON(){return this.precomputed==null?[this.x,this.y]:[this.x,this.y,typeof this.precomputed==`object`&&this.precomputed!==null?{doubles:this.precomputed.doubles==null?void 0:{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf==null?void 0:{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}:void 0]}inspect(){return this.isInfinity()?`<EC Point Infinity>`:`<EC Point x: `+(this.x?.fromRed()?.toString(16,2)??`undefined`)+` y: `+(this.y?.fromRed()?.toString(16,2)??`undefined`)+`>`}isInfinity(){return this.inf}add(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t)||this.x?.cmp(t.x??new B(0))===0)return new e(null,null);let n={X:BigInt(`0x`+this.x.fromRed().toString(16)),Y:BigInt(`0x`+this.y.fromRed().toString(16)),Z:fu},r={X:BigInt(`0x`+t.x.fromRed().toString(16)),Y:BigInt(`0x`+t.y.fromRed().toString(16)),Z:fu},i=ju(n,r);if(i.Z===0n)return new e(null,null);let a=xu(i.Z),o=G(a,a),s=G(i.X,o),c=G(i.Y,G(o,a));return new e(s.toString(16),c.toString(16))}dbl(){if(this.inf)return this;if(this.x===null||this.y===null)throw Error(`Point coordinates cannot be null`);let t=BigInt(`0x`+this.x.fromRed().toString(16)),n=BigInt(`0x`+this.y.fromRed().toString(16));if(n===0n)return new e(null,null);let r=Au({X:t,Y:n,Z:fu}),i=xu(r.Z),a=G(i,i),o=G(r.X,a),s=G(r.Y,G(a,i));return new e(o.toString(16),s.toString(16))}getX(){return(this.x??new B(0)).fromRed()}getY(){return(this.y??new B(0)).fromRed()}mul(t){if(B.isBN(t)||(t=new B(t,16)),t=t,this.inf)return this;let n=BigInt(`0x`+t.toString(16)),r=n<du;if(r&&(n=-n),n=vu(n),n===0n)return new e(null,null);if(this.x===null||this.y===null)throw Error(`Point coordinates cannot be null`);let i,a;this===this.curve.g?(i=Du,a=Ou):(i=BigInt(`0x`+this.x.fromRed().toString(16)),a=BigInt(`0x`+this.y.fromRed().toString(16)));let o=Nu(n,{x:i,y:a});if(o.Z===0n)return new e(null,null);let s=xu(o.Z),c=G(s,s),l=G(o.X,c),u=G(o.Y,G(c,s)),d=new B(l.toString(16),16),f=new B(u.toString(16),16),p=new e(d,f);return r?p.neg():p}mulAdd(e,t,n){let r=[this,t],i=[e,n];return this._endoWnafMulAdd(r,i)}jmulAdd(e,t,n){let r=[this,t],i=[e,n];return this._endoWnafMulAdd(r,i,!0)}eq(e){return this===e||this.inf===e.inf&&(this.inf||(this.x??new B(0)).cmp(e.x??new B(0))===0&&(this.y??new B(0)).cmp(e.y??new B(0))===0)}neg(t){if(this.inf)return this;let n=new e(this.x,(this.y??new B(0)).redNeg());if(t===!0&&this.precomputed!=null){let e=this.precomputed;n.precomputed={naf:e.naf==null?void 0:{wnd:e.naf.wnd,points:e.naf.points.map(e=>e.neg())},doubles:e.doubles==null?void 0:{step:e.doubles.step,points:e.doubles.points.map(e=>e.neg())},beta:void 0}}return n}dblp(e){let t=this;for(let n=0;n<e;n++)t=t.dbl();return t}toJ(){return this.inf?new pc(null,null,null):new pc(this.x,this.y,this.curve.one)}_getBeta(){if(typeof this.curve.endo!=`object`)return;let t=this.precomputed;if(typeof t==`object`&&t&&typeof t.beta==`object`&&t.beta!==null)return t.beta;let n=new e((this.x??new B(0)).redMul(this.curve.endo.beta),this.y);if(t!=null){let r=this.curve,i=t=>{if(t.x===null)throw Error(`p.x is null`);if(r.endo===void 0||r.endo===null)throw Error(`curve.endo is undefined`);return new e(t.x.redMul(r.endo.beta),t.y)};t.beta=n,n.precomputed={beta:null,naf:t.naf==null?void 0:{wnd:t.naf.wnd,points:t.naf.points.map(i)},doubles:t.doubles==null?void 0:{step:t.doubles.step,points:t.doubles.points.map(i)}}}return n}_fixedNafMul(e){if(typeof this.precomputed!=`object`||this.precomputed===null)throw Error(`_fixedNafMul requires precomputed values for the point`);let t=this._getDoubles(),n=this.curve.getNAF(e,1,this.curve._bitLength),r=(1<<t.step+1)-(t.step%2==0?2:1);r/=3;let i=[];for(let e=0;e<n.length;e+=t.step){let r=0;for(let i=e+t.step-1;i>=e;i--)r=(r<<1)+n[i];i.push(r)}let a=new pc(null,null,null),o=new pc(null,null,null);for(let e=r;e>0;e--){for(let n=0;n<i.length;n++){let r=i[n];r===e?o=o.mixedAdd(t.points[n]):r===-e&&(o=o.mixedAdd(t.points[n].neg()))}a=a.add(o)}return a.toP()}_wnafMulAdd(e,t,n,r,i){let a=this.curve._wnafT1.map(e=>e.toNumber()),o=this.curve._wnafT2.map(()=>[]),s=this.curve._wnafT3.map(()=>[]),c=0;for(let n=0;n<r;n++){let r=t[n]._getNAFPoints(e);a[n]=r.wnd,o[n]=r.points}for(let e=r-1;e>=1;e-=2){let r=e-1,i=e;if(a[r]!==1||a[i]!==1){s[r]=this.curve.getNAF(n[r],a[r],this.curve._bitLength),s[i]=this.curve.getNAF(n[i],a[i],this.curve._bitLength),c=Math.max(s[r].length,c),c=Math.max(s[i].length,c);continue}let l=[t[r],null,null,t[i]];(t[r].y??new B(0)).cmp(t[i].y??new B(0))===0?(l[1]=t[r].add(t[i]),l[2]=t[r].toJ().mixedAdd(t[i].neg())):(t[r].y??new B(0)).cmp((t[i].y??new B(0)).redNeg())===0?(l[1]=t[r].toJ().mixedAdd(t[i]),l[2]=t[r].add(t[i].neg())):(l[1]=t[r].toJ().mixedAdd(t[i]),l[2]=t[r].toJ().mixedAdd(t[i].neg()));let u=[-3,-1,-5,-7,0,7,5,1,3],d=this.curve.getJSF(n[r],n[i]);c=Math.max(d[0].length,c),s[r]=Array(c),s[i]=Array(c);for(let e=0;e<c;e++){let t=d[0][e]|0,n=d[1][e]|0;s[r][e]=u[(t+1)*3+(n+1)],s[i][e]=0,o[r]=l}}let l=new pc(null,null,null),u=this.curve._wnafT4;for(let e=c;e>=0;e--){let t=0;for(;e>=0;){let n=!0;for(let t=0;t<r;t++)u[t]=new B(typeof s[t][e]==`number`?s[t][e]:0),u[t].isZero()||(n=!1);if(!n)break;t++,e--}if(e>=0&&t++,l=l.dblp(t),e<0)break;let n=new B(1),i=new B(2);for(let e=0;e<r;e++){let t=u[e],r;t.cmpn(0)!==0&&(r=t.isNeg()?o[e][t.neg().sub(n).div(i).toNumber()].neg():o[e][t.sub(n).div(i).toNumber()],l=r.type===`affine`?l.mixedAdd(r):l.add(r))}}for(let e=0;e<r;e++)o[e]=[];return i===!0?l:l.toP()}_endoWnafMulAdd(t,n,r){let i=Array(t.length*2),a=Array(t.length*2),o;for(o=0;o<t.length;o++){let r=this.curve._endoSplit(n[o]),s=t[o],c=s._getBeta()??new e(null,null);r.k1.negative!==0&&(r.k1.ineg(),s=s.neg(!0)),r.k2.negative!==0&&(r.k2.ineg(),c=c.neg(!0)),i[o*2]=s,i[o*2+1]=c,a[o*2]=r.k1,a[o*2+1]=r.k2}let s=this._wnafMulAdd(1,i,a,o*2,r);for(let e=0;e<o*2;e++)i[e]=null,a[e]=null;return s}_hasDoubles(e){if(this.precomputed==null)return!1;let t=this.precomputed.doubles;return typeof t==`object`?t.points.length>=Math.ceil((e.bitLength()+1)/t.step):!1}_getDoubles(e,t){if(typeof this.precomputed==`object`&&this.precomputed!==null&&typeof this.precomputed.doubles==`object`&&this.precomputed.doubles!==null)return this.precomputed.doubles;let n=[this],r=this;for(let i=0;i<(t??0);i+=e??1){for(let t=0;t<(e??1);t++)r=r.dbl();n.push(r)}return{step:e??1,points:n}}_getNAFPoints(e){if(typeof this.precomputed==`object`&&this.precomputed!==null&&typeof this.precomputed.naf==`object`&&this.precomputed.naf!==null)return this.precomputed.naf;let t=[this],n=(1<<e)-1,r=n===1?null:this.dbl();for(let e=1;e<n;e++)r!==null&&(t[e]=t[e-1].add(r));return{wnd:e,points:t}}},Ru,zu=class e{p;red;redN;zero;one;two;g;n;a;b;tinv;zeroA;threeA;endo;_endoWnafT1;_endoWnafT2;_wnafT1;_wnafT2;_wnafT3;_wnafT4;_bitLength;static assert(e,t=`Elliptic curve assertion failed`){if(!e)throw Error(t)}getNAF(e,t,n){let r=Array(Math.max(e.bitLength(),n)+1);r.fill(0);let i=1<<t+1,a=e.clone();for(let e=0;e<r.length;e++){let t,n=a.andln(i-1);a.isOdd()?(t=n>(i>>1)-1?(i>>1)-n:n,a.isubn(t)):t=0,r[e]=t,a.iushrn(1)}return r}getJSF(e,t){let n=[[],[]];e=e.clone(),t=t.clone();let r=0,i=0;for(;e.cmpn(-r)>0||t.cmpn(-i)>0;){let a=e.andln(3)+r&3,o=t.andln(3)+i&3;a===3&&(a=-1),o===3&&(o=-1);let s;if(!(a&1))s=0;else{let t=e.andln(7)+r&7;s=(t===3||t===5)&&o===2?-a:a}n[0].push(s);let c;if(!(o&1))c=0;else{let e=t.andln(7)+i&7;c=(e===3||e===5)&&a===2?-o:o}n[1].push(c),2*r===s+1&&(r=1-r),2*i===c+1&&(i=1-i),e.iushrn(1),t.iushrn(1)}return n}static cachedProperty(e,t,n){let r=`_`+t;e.prototype[t]=function(){return this[r]===void 0?this[r]=n.call(this):this[r]}}static parseBytes(e){return typeof e==`string`?U(e,`hex`):e}static intFromLE(e){return new B(e,`hex`,`le`)}constructor(){if(Ru!==void 0)return Ru;Ru=this;let e={prime:`k256`,p:`ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f`,a:`0`,b:`7`,n:`ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141`,h:`1`,beta:`7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee`,lambda:`5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72`,basis:[{a:`3086d221a7d46bcde86c90e49284eb15`,b:`-e4437ed6010e88286f547fa90abfe4c3`},{a:`114ca50f7a8e2f3f657c1108d9d44cfd8`,b:`3086d221a7d46bcde86c90e49284eb15`}],gRed:!1,g:[`79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798`,`483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8`,{doubles:{step:4,points:[[`e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a`,`f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821`],[`8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508`,`11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf`],[`175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739`,`d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695`],[`363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640`,`4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9`],[`8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c`,`4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36`],[`723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda`,`96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f`],[`eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa`,`5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999`],[`100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0`,`cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09`],[`e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d`,`9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d`],[`feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d`,`e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088`],[`da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1`,`9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d`],[`53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0`,`5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8`],[`8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047`,`10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a`],[`385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862`,`283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453`],[`6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7`,`7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160`],[`3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd`,`56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0`],[`85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83`,`7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6`],[`948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a`,`53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589`],[`6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8`,`bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17`],[`e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d`,`4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda`],[`e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725`,`7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd`],[`213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754`,`4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2`],[`4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c`,`17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6`],[`fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6`,`6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f`],[`76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39`,`c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01`],[`c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891`,`893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3`],[`d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b`,`febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f`],[`b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03`,`2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7`],[`e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d`,`eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78`],[`a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070`,`7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1`],[`90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4`,`e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150`],[`8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da`,`662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82`],[`e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11`,`1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc`],[`8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e`,`efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b`],[`e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41`,`2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51`],[`b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef`,`67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45`],[`d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8`,`db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120`],[`324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d`,`648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84`],[`4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96`,`35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d`],[`9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd`,`ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d`],[`6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5`,`9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8`],[`a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266`,`40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8`],[`7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71`,`34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac`],[`928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac`,`c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f`],[`85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751`,`1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962`],[`ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e`,`493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907`],[`827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241`,`c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec`],[`eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3`,`be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d`],[`e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f`,`4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414`],[`1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19`,`aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd`],[`146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be`,`b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0`],[`fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9`,`6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811`],[`da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2`,`8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1`],[`a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13`,`7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c`],[`174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c`,`ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73`],[`959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba`,`2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd`],[`d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151`,`e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405`],[`64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073`,`d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589`],[`8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458`,`38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e`],[`13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b`,`69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27`],[`bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366`,`d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1`],[`8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa`,`40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482`],[`8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0`,`620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945`],[`dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787`,`7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573`],[`f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e`,`ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82`]]},naf:{wnd:7,points:[[`f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9`,`388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672`],[`2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4`,`d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6`],[`5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc`,`6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da`],[`acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe`,`cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37`],[`774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb`,`d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b`],[`f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8`,`ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81`],[`d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e`,`581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58`],[`defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34`,`4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77`],[`2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c`,`85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a`],[`352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5`,`321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c`],[`2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f`,`2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67`],[`9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714`,`73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402`],[`daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729`,`a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55`],[`c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db`,`2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482`],[`6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4`,`e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82`],[`1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5`,`b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396`],[`605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479`,`2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49`],[`62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d`,`80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf`],[`80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f`,`1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a`],[`7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb`,`d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7`],[`d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9`,`eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933`],[`49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963`,`758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a`],[`77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74`,`958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6`],[`f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530`,`e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37`],[`463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b`,`5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e`],[`f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247`,`cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6`],[`caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1`,`cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476`],[`2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120`,`4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40`],[`7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435`,`91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61`],[`754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18`,`673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683`],[`e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8`,`59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5`],[`186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb`,`3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b`],[`df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f`,`55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417`],[`5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143`,`efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868`],[`290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba`,`e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a`],[`af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45`,`f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6`],[`766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a`,`744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996`],[`59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e`,`c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e`],[`f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8`,`e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d`],[`7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c`,`30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2`],[`948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519`,`e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e`],[`7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab`,`100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437`],[`3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca`,`ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311`],[`d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf`,`8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4`],[`1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610`,`68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575`],[`733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4`,`f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d`],[`15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c`,`d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d`],[`a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940`,`edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629`],[`e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980`,`a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06`],[`311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3`,`66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374`],[`34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf`,`9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee`],[`f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63`,`4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1`],[`d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448`,`fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b`],[`32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf`,`5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661`],[`7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5`,`8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6`],[`ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6`,`8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e`],[`16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5`,`5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d`],[`eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99`,`f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc`],[`78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51`,`f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4`],[`494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5`,`42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c`],[`a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5`,`204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b`],[`c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997`,`4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913`],[`841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881`,`73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154`],[`5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5`,`39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865`],[`36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66`,`d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc`],[`336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726`,`ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224`],[`8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede`,`6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e`],[`1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94`,`60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6`],[`85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31`,`3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511`],[`29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51`,`b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b`],[`a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252`,`ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2`],[`4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5`,`cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c`],[`d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b`,`6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3`],[`ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4`,`322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d`],[`af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f`,`6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700`],[`e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889`,`2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4`],[`591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246`,`b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196`],[`11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984`,`998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4`],[`3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a`,`b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257`],[`cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030`,`bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13`],[`c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197`,`6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096`],[`c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593`,`c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38`],[`a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef`,`21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f`],[`347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38`,`60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448`],[`da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a`,`49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a`],[`c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111`,`5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4`],[`4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502`,`7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437`],[`3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea`,`be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7`],[`cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26`,`8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d`],[`b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986`,`39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a`],[`d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e`,`62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54`],[`48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4`,`25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77`],[`dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda`,`ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517`],[`6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859`,`cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10`],[`e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f`,`f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125`],[`eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c`,`6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e`],[`13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942`,`fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1`],[`ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a`,`1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2`],[`b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80`,`5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423`],[`ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d`,`438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8`],[`8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1`,`cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758`],[`52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63`,`c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375`],[`e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352`,`6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d`],[`7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193`,`ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec`],[`5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00`,`9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0`],[`32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58`,`ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c`],[`e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7`,`d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4`],[`8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8`,`c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f`],[`4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e`,`67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649`],[`3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d`,`cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826`],[`674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b`,`299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5`],[`d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f`,`f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87`],[`30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6`,`462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b`],[`be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297`,`62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc`],[`93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a`,`7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c`],[`b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c`,`ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f`],[`d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52`,`4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a`],[`d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb`,`bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46`],[`463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065`,`bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f`],[`7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917`,`603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03`],[`74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9`,`cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08`],[`30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3`,`553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8`],[`9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57`,`712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373`],[`176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66`,`ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3`],[`75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8`,`9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8`],[`809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721`,`9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1`],[`1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180`,`4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9`]]}}]};this.p=new B(e.p,16),this.red=new uc(e.prime),this.zero=new B(0).toRed(this.red),this.one=new B(1).toRed(this.red),this.two=new B(2).toRed(this.red),this.n=new B(e.n,16),this.g=Lu.fromJSON(e.g,e.gRed),this._wnafT1=[,,,,],this._wnafT2=[,,,,],this._wnafT3=[,,,,],this._wnafT4=[,,,,],this._bitLength=this.n.bitLength(),this.redN=this.n.toRed(this.red),this.a=new B(e.a,16).toRed(this.red),this.b=new B(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=[,,,,],this._endoWnafT2=[,,,,]}_getEndomorphism(t){if(!this.zeroA||this.p.modrn(3)!==1)return;let n,r;if(t.beta!==void 0)n=new B(t.beta,16).toRed(this.red);else{let e=this._getEndoRoots(this.p);if(e===null)throw Error(`Failed to get endomorphism roots for beta.`);n=e[0].cmp(e[1])<0?e[0]:e[1],n=n.toRed(this.red)}if(t.lambda!==void 0)r=new B(t.lambda,16);else{let t=this._getEndoRoots(this.n);if(t===null)throw Error(`Failed to get endomorphism roots for lambda.`);if(this.g==null)throw Error(`Curve generator point (g) is not defined.`);let i=this.g.mul(t[0])?.x,a=this.g.x==null?void 0:this.g.x.redMul(n);if(i!=null&&a!=null&&i.cmp(a)===0)r=t[0];else{if(r=t[1],this.g==null)throw Error(`Curve generator point (g) is not defined.`);let i=this.g.mul(r)?.x,a=this.g.x==null?void 0:this.g.x.redMul(n);if(i==null||a==null)throw Error(`Lambda computation failed: g.mul(lambda).x or g.x.redMul(beta) is undefined.`);e.assert(i.cmp(a)===0,`Lambda selection does not match computed beta.`)}}let i;return i=typeof t.basis==`object`&&t.basis!==null?t.basis.map(function(e){return{a:new B(e.a,16),b:new B(e.b,16)}}):this._getEndoBasis(r),{beta:n,lambda:r,basis:i}}_getEndoRoots(e){let t=e===this.p?this.red:new dc(e),n=new B(2).toRed(t).redInvm(),r=n.redNeg(),i=new B(3).toRed(t).redNeg().redSqrt().redMul(n),a=r.redAdd(i).fromRed(),o=r.redSub(i).fromRed();return[a,o]}_getEndoBasis(e){let t=this.n.ushrn(Math.floor(this.n.bitLength()/2)),n=e,r=this.n.clone(),i=new B(1),a=new B(0),o=new B(0),s=new B(1),c,l,u,d,f,p,m=new B(0),h=0,g=new B(0),_=new B(0);for(;n.cmpn(0)!==0;){let e=r.div(n);g=r.sub(e.mul(n)),_=o.sub(e.mul(i));let f=s.sub(e.mul(a));if(u===void 0&&g.cmp(t)<0)c=m.neg(),l=i,u=g.neg(),d=_;else if(u!==void 0&&++h===2)break;m=g,r=n,n=g,o=i,i=_,s=a,a=f}if(c===void 0||l===void 0||u===void 0||d===void 0)throw Error(`Failed to compute Endo Basis values`);f=g.neg(),p=_;let v=u.sqr().add(d.sqr());return f.sqr().add(p.sqr()).cmp(v)>=0&&(f=c,p=l),u.negative!==0&&(u=u.neg(),d=d.neg()),f.negative!==0&&(f=f.neg(),p=p.neg()),[{a:u,b:d},{a:f,b:p}]}_endoSplit(e){if(this.endo==null)throw Error(`Endomorphism is not defined.`);let t=this.endo.basis,n=t[0],r=t[1],i=r.b.mul(e).divRound(this.n),a=n.b.neg().mul(e).divRound(this.n),o=i.mul(n.a),s=a.mul(r.a),c=i.mul(n.b),l=a.mul(r.b),u=e.sub(o).sub(s),d=c.add(l).neg();return{k1:u,k2:d}}validate(e){if(e.inf)return!0;let t=e.x,n=e.y;if(t===null||n===null)throw Error(`Point coordinates cannot be null`);let r=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(r).redIAdd(this.b);return n.redSqr().redISub(i).cmpn(0)===0}},Bu=class e{r;s;static fromDER(t,n){let r=(e,t)=>{let n=e[t.place++];if(n&128)throw Error(`Invalid DER entity length`);return n};class i{place;constructor(){this.place=0}}t=U(t,n);let a=new i;if(t[a.place++]!==48)throw Error(`Signature DER must start with 0x30`);if(r(t,a)+a.place!==t.length||t[a.place++]!==2)throw Error(`Signature DER invalid`);let o=r(t,a),s=t.slice(a.place,o+a.place);if(a.place+=o,t[a.place++]!==2)throw Error(`Signature DER invalid`);let c=r(t,a);if(t.length!==c+a.place)throw Error(`Invalid R-length in signature DER`);let l=t.slice(a.place,c+a.place);if(s[0]===0)if(s[1]&128)s=s.slice(1);else throw Error(`Invalid R-value in signature DER`);if(l[0]===0)if(l[1]&128)l=l.slice(1);else throw Error(`Invalid S-value in signature DER`);return new e(new B(s),new B(l))}static fromCompact(t,n){if(t=U(t,n),t.length!==65)throw Error(`Invalid Compact Signature`);let r=t[0];if(r<27||r>=35)throw Error(`Invalid Compact Byte`);return new e(new B(t.slice(1,33)),new B(t.slice(33,65)))}constructor(e,t){this.r=e,this.s=t}verify(e,t,n){let r=new B(Zc(e,n),16);return Ju(r,this,t)}toString(e){return this.toDER(e)}toDER(e){let t=(e,t)=>{if(t<128)e.push(t);else throw Error(`len must be < 0x80`)},n=e=>{let t=0,n=e.length-1;for(;e[t]===0&&!(e[t+1]&128)&&t<n;)t++;return t===0?e:e.slice(t)},r=this.r.toArray(),i=this.s.toArray();for(r[0]&128&&(r=[0].concat(r)),i[0]&128&&(i=[0].concat(i)),r=n(r),i=n(i);i[0]===0&&!(i[1]&128);)i=i.slice(1);let a=[2];t(a,r.length),a=a.concat(r),a.push(2),t(a,i.length);let o=a.concat(i),s=[48];return t(s,o.length),s=s.concat(o),e===`hex`?H(s):e===`base64`?$l(s):s}toCompact(e,t,n){if(e<0||e>3)throw Error(`Invalid recovery param`);if(typeof t!=`boolean`)throw Error(`Invalid compressed param`);let r=27+e;t&&(r+=4);let i=[r];return i=i.concat(this.r.toArray(`be`,32)),i=i.concat(this.s.toArray(`be`,32)),n===`hex`?H(i):n===`base64`?$l(i):i}RecoverPublicKey(e,t){let n=this.r,r=this.s,i=(e&1)!=0,a=e>>1,o=new zu,s=o.n,c=o.g,l=a===0?n:n.add(s),u=Lu.fromX(l,i);if(!u.mul(s).isInfinity())throw Error(`nR is not at infinity`);let d=t.neg().umod(s),f=n.invm(s),p=f.mul(r).umod(s),m=f.mul(d).umod(s),h=c.mul(m).add(u.mul(p)),g=new Yu(h);return g.validate(),g}CalculateRecoveryFactor(e,t){for(let n=0;n<4;n++){let r;try{r=this.RecoverPublicKey(n,t)}catch{continue}if(e.eq(r))return n}throw Error(`Unable to find valid recovery factor`)}},Vu=class{K;V;constructor(e,t){if(e=U(e,`hex`),t=U(t,`hex`),e.length<32)throw Error(`Not enough entropy. Minimum is 256 bits`);let n=e.concat(t);this.K=Array(32),this.V=Array(32);for(let e=0;e<32;e++)this.K[e]=0,this.V[e]=1;this.update(n)}hmac(){return new qc(this.K)}update(e){let t=this.hmac().update(this.V).update([0]);e!==void 0&&(t=t.update(e)),this.K=t.digest(),this.V=this.hmac().update(this.V).digest(),e!==void 0&&(this.K=this.hmac().update(this.V).update([1]).update(e).digest(),this.V=this.hmac().update(this.V).digest())}generate(e){let t=[];for(;t.length<e;)this.V=this.hmac().update(this.V).digest(),t=t.concat(this.V);let n=t.slice(0,e);return this.update(),H(n)}};function Hu(e,t,n=new zu){let r=e.byteLength()*8-n.n.bitLength();return r>0&&e.iushrn(r),t===null&&e.cmp(n.n)>=0?e.sub(n.n):e}var Uu=new zu,Wu=Uu.n.byteLength(),Gu=Uu.n.subn(1),Ku=hu>>1n;const qu=(e,t,n=!1,r)=>{e=Hu(e);let i=BigInt(`0x`+e.toString(16)),a=BigInt(`0x`+t.toString(16)),o=t.toArray(`be`,Wu),s=e.toArray(`be`,Wu),c=new Vu(o,s);for(let e=0;;e++){let t=typeof r==`function`?r(e):B.isBN(r)?r:new B(c.generate(Wu),16);if(t==null)throw Error(`k is undefined`);if(t=Hu(t,!0),t.cmpn(1)<=0||t.cmp(Gu)>=0){if(B.isBN(r))throw Error(`Invalid fixed custom K value (must be >1 and <N1)`);continue}let o=BigInt(`0x`+t.toString(16)),s=Nu(o,{x:Du,y:Ou});if(s.Z===0n){if(B.isBN(r))throw Error(`Invalid fixed custom K value (kG at infinity)`);continue}let l=xu(s.Z),u=G(l,l),d=G(s.X,u),f=Pu(d);if(f===0n){if(B.isBN(r))throw Error(`Invalid fixed custom K value (r == 0)`);continue}let p=Iu(o),m=Fu(f,a),h=Pu(i+m),g=Fu(p,h);if(g===0n){if(B.isBN(r))throw Error(`Invalid fixed custom K value (s == 0)`);continue}n&&g>Ku&&(g=hu-g);let _=new B(f.toString(16),16),v=new B(g.toString(16),16);return new Bu(_,v)}},Ju=(e,t,n)=>{let r=BigInt(`0x`+e.toString(16));if(n.x==null||n.y==null)throw Error(`Invalid public key: missing coordinates.`);let i={x:BigInt(`0x`+n.x.toString(16)),y:BigInt(`0x`+n.y.toString(16))},{r:a,s:o}={r:BigInt(`0x`+t.r.toString(16)),s:BigInt(`0x`+t.s.toString(16))},s=r;if(a<=0n||a>=115792089237316195423570985008687907852837564279074904382605163141518161494337n||o<=0n||o>=115792089237316195423570985008687907852837564279074904382605163141518161494337n)return!1;let c=Iu(o);if(c===0n)return!1;let l=Fu(s,c),u=Fu(a,c),d=Nu(l,{x:Du,y:Ou}),f=Nu(u,i),p=ju(d,f);if(p.Z===0n)return!1;let m=xu(p.Z),h=G(m,m),g=G(p.X,h);return Pu(g)===a};var Yu=class e extends Lu{static fromPrivateKey(t){let n=new zu().g.mul(t);return new e(n.x,n.y)}static fromString(t){let n=Lu.fromString(t);return new e(n.x,n.y)}static fromDER(t){let n=Lu.fromDER(t);return new e(n.x,n.y)}constructor(e,t=null,n=!0){if(e instanceof Lu)super(e.getX(),e.getY());else{if(t===null&&n&&typeof e==`string`&&(e.length===66||e.length===130))throw Error(`You are using the "new PublicKey()" constructor with a DER hex string. You need to use "PublicKey.fromString()" instead.`);super(e,t,n)}}deriveSharedSecret(e){if(!this.validate())throw Error(`Public key not valid for ECDH secret derivation`);return this.mul(e)}verify(e,t,n){let r=new B(Zc(e,n),16);return Ju(r,t,this)}toDER(e){return e===`hex`?this.encode(!0,e):this.encode(!0)}toHash(e){let t=$c(this.encode(!0));return e===`hex`?H(t):t}toAddress(e=[0]){if(typeof e==`string`)if(e===`testnet`||e===`test`)e=[111];else if(e===`mainnet`||e===`main`)e=[0];else throw Error(`Invalid prefix ${e}`);return ru(this.toHash(),e)}deriveChild(t,n,r,i){let a;if(typeof i==`function`){let e=i(t,this);e===void 0?(a=this.deriveSharedSecret(t),typeof r==`function`&&r(t,this,a)):a=e}else a=this.deriveSharedSecret(t);let o=U(n,`utf8`),s=el(a.encode(!0),o),c=new zu().g.mul(new B(s)),l=this.add(c);return new e(l.x,l.y)}static fromMsgHashAndCompactSignature(e,t,n){let r=U(t,n);if(r.length!==65)throw Error(`Invalid Compact Signature`);let i=r[0];if(i<27||i>=35)throw Error(`Invalid Compact Byte`);let a=r[0]-27;return a>3&&(a-=4),new Bu(new B(r.slice(1,33)),new B(r.slice(33,65))).RecoverPublicKey(a,e)}},Xu=class{_rand;getRandomValues(e,t){let n=new Uint8Array(t);return e.crypto.getRandomValues(n),Array.from(n)}constructor(){let e=()=>{throw Error(`No secure random number generator is available in this environment.`)};if(this._rand=e,typeof globalThis<`u`&&typeof globalThis.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(globalThis,e);return}if(typeof process<`u`&&process.release?.name===`node`)try{let e=Ut();if(typeof e.randomBytes==`function`){this._rand=t=>Array.from(e.randomBytes(t));return}}catch{}if(typeof self<`u`&&typeof self.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(self,e);return}if(typeof window<`u`&&typeof window.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(window,e);return}if(typeof navigator<`u`&&navigator.product===`ReactNative`)try{if(u(`react-native-get-random-values`),typeof globalThis.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(globalThis,e);return}}catch{this._rand=()=>{throw Error(`React Native detected but crypto is not available. Please install and import "react-native-get-random-values" at the top of your entry file:
npm install react-native-get-random-values
Then add: import "react-native-get-random-values" to your index.js/App.js`)};return}this._rand=e}generate(e){return this._rand(e)}},Zu=null,Qu=e=>(Zu??=new Xu,Zu.generate(e)),$u=class e{x;y;constructor(e,t){let n=new zu().p;this.x=e.umod(n),this.y=t.umod(n)}toString(){return nu(this.x.toArray())+`.`+nu(this.y.toArray())}static fromString(t){let[n,r]=t.split(`.`);return new e(new B(tu(n)),new B(tu(r)))}},ed=class e{points;threshold;constructor(e,t){this.points=e,this.threshold=t??e.length}static fromPrivateKey(t,n){let r=new zu().p,i=[new $u(new B(0),new B(t.toArray()))];for(let e=1;e<n;e++){let e=new B(Qu(32)).umod(r),t=new B(Qu(32)).umod(r);i.push(new $u(e,t))}return new e(i)}valueAt(e){let t=new zu().p,n=new B(0);for(let r=0;r<this.threshold;r++){let i=this.points[r].y;for(let n=0;n<this.threshold;n++)if(r!==n){let a=this.points[n].x,o=this.points[r].x,s=e.sub(a).umod(t),c=o.sub(a).umod(t).invm(t),l=s.mul(c).umod(t);i=i.mul(l).umod(t)}n=n.add(i).umod(t)}return n}},td=class e{points;threshold;integrity;constructor(e,t,n){this.points=e,this.threshold=t,this.integrity=n}static fromBackupFormat(t){let n=0,r=``,i=t.map((e,t)=>{let i=e.split(`.`);if(i.length!==4)throw Error(`Invalid share format in share `+t.toString()+`. Expected format: "x.y.t.i" - received `+e);let[a,o,s,c]=i;if(s===void 0)throw Error(`Threshold not found in share `+t.toString());if(c===void 0)throw Error(`Integrity not found in share `+t.toString());let l=parseInt(s);if(t!==0&&n!==l)throw Error(`Threshold mismatch in share `+t.toString());if(t!==0&&r!==c)throw Error(`Integrity mismatch in share `+t.toString());return n=l,r=c,$u.fromString([a,o].join(`.`))});return new e(i,n,r)}toBackupFormat(){return this.points.map(e=>e.toString()+`.`+this.threshold.toString()+`.`+this.integrity)}},nd=class e extends B{static fromRandom(){return new e(Qu(32))}static fromString(t,n=`hex`){return new e(super.fromString(t,n).toArray())}static fromHex(t){return new e(super.fromHex(t,`big`))}static fromWif(t,n=1){let r=iu(t,void 0,n);if(r.data.length!==33)throw Error(`Invalid WIF length`);if(r.data[32]!==1)throw Error(`Invalid WIF padding`);return new e(r.data.slice(0,32))}constructor(e=0,t=10,n=`be`,r=`apply`){if(e instanceof B?(super(),e.copy(this)):super(e,t,n),r!==`nocheck`){let e=this.checkInField();if(!e.inField){if(r===`error`)throw Error(`Input is out of field`);B.move(this,e.modN)}}}checkInField(){let e=new zu,t=this.mod(e.n);return{inField:this.cmp(t)===0,modN:t}}isValid(){return this.checkInField().inField}sign(e,t,n=!0,r){let i=new B(Zc(e,t),16);return qu(i,this,n,r)}verify(e,t,n){let r=new B(Zc(e,n),16);return Ju(r,t,this.toPublicKey())}toPublicKey(){let e=new zu().g.mul(this);return new Yu(e.x,e.y)}toWif(e=[128]){if(!this.isValid())throw Error(`Value is out of field`);return ru([...this.toArray(`be`,32),1],e)}toAddress(e=[0]){return this.toPublicKey().toAddress(e)}toHex(){return super.toHex(32)}toString(e=`hex`,t=64){return super.toString(e,t)}deriveSharedSecret(e){if(!e.validate())throw Error(`Public key not valid for ECDH secret derivation`);return e.mul(this)}deriveChild(t,n,r,i){let a;if(typeof i==`function`){let e=i(this,t);e===void 0?(a=this.deriveSharedSecret(t),typeof r==`function`&&r(this,t,a)):a=e}else a=this.deriveSharedSecret(t);let o=U(n,`utf8`),s=el(a.encode(!0),o),c=new zu;return new e(this.add(new B(s)).mod(c.n).toArray())}toKeyShares(e,t){if(typeof e!=`number`||typeof t!=`number`)throw Error(`threshold and totalShares must be numbers`);if(e<2)throw Error(`threshold must be at least 2`);if(t<2)throw Error(`totalShares must be at least 2`);if(e>t)throw Error(`threshold should be less than or equal to totalShares`);let n=ed.fromPrivateKey(this,e),r=[],i=new Set,a=new zu,o=Qu(64);for(let e=0;e<t;e++){let t,s=0;do{let n=[e,s,...Qu(32)],r=tl(o,n);if(t=new B(r).umod(a.p),s++,s>5)throw Error(`Failed to generate unique x coordinate after 5 attempts`)}while(t.isZero()||i.has(t.toString()));i.add(t.toString());let c=n.valueAt(t);r.push(new $u(t,c))}let s=this.toPublicKey().toHash(`hex`).slice(0,8);return new td(r,e,s)}toBackupShares(e,t){return this.toKeyShares(e,t).toBackupFormat()}static fromBackupShares(t){return e.fromKeyShares(td.fromBackupFormat(t))}static fromKeyShares(t){let{points:n,threshold:r,integrity:i}=t;if(r<2)throw Error(`threshold must be at least 2`);if(n.length<r)throw Error(`At least ${r} shares are required to reconstruct the private key`);for(let e=0;e<r;e++)for(let t=e+1;t<r;t++)if(n[e].x.eq(n[t].x))throw Error(`Duplicate share detected, each must be unique.`);let a=new ed(n,r),o=new e(a.valueAt(new B(0)).toArray());if(o.toPublicKey().toHash(`hex`).slice(0,8)!==i)throw Error(`Integrity hash mismatch`);return o}},rd=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),id=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]].map(e=>new Uint8Array(e)),ad=new Uint8Array(256),od=new Uint8Array(256);for(let e=0;e<256;e++){let t=(e<<1^(e&128?27:0))&255;ad[e]=t,od[e]=t^e}function sd(e,t,n){for(let r=0;r<4;r++){let i=t[n+r];for(let t=0;t<4;t++)e[t][r]^=i[t]}}function cd(e){for(let t=0;t<4;t++)for(let n=0;n<4;n++)e[t][n]=rd[e[t][n]]}function ld(e){for(let t=0;t<4;t++)e[t]=rd[e[t]]}function ud(e){let t=e[0];e[0]=e[1],e[1]=e[2],e[2]=e[3],e[3]=t}function dd(e){let t=e[1][0];e[1][0]=e[1][1],e[1][1]=e[1][2],e[1][2]=e[1][3],e[1][3]=t,t=e[2][0];let n=e[2][1];e[2][0]=e[2][2],e[2][1]=e[2][3],e[2][2]=t,e[2][3]=n,t=e[3][3],e[3][3]=e[3][2],e[3][2]=e[3][1],e[3][1]=e[3][0],e[3][0]=t}function fd(e){for(let t=0;t<4;t++){let n=e[0][t],r=e[1][t],i=e[2][t],a=e[3][t];e[0][t]=ad[n]^od[r]^i^a,e[1][t]=n^ad[r]^od[i]^a,e[2][t]=n^r^ad[i]^od[a],e[3][t]=od[n]^r^i^ad[a]}}function pd(e,t){let n=t.length/4,r=[];for(let e=0;e<t.length;e++)e%4==0&&r.push([]),r[e>>2].push(t[e]);for(let t=n;t<4*e;t++){r[t]=[];let e=r[t-1].slice();if(t%n===0){ud(e),ld(e);let r=id[t/n];for(let t=0;t<4;t++)e[t]^=r[t]}else n>6&&t%n===4&&ld(e);for(let i=0;i<4;i++)r[t][i]=r[t-n][i]^e[i]}return r}function md(e,t){let n,r,i,a,o=[[],[],[],[]],s=[],c=Array.from(t);if(c.length<=16){for(;c.length<16;)c.unshift(0);a=11}else if(c.length<=24){for(;c.length<24;)c.unshift(0);a=13}else if(t.length<=32){for(;c.length<32;)c.unshift(0);a=15}else throw Error(`Illegal key length: `+String(t.length));let l=pd(a,c);for(let t=0;t<4;t++)o[0][t]=e[t*4],o[1][t]=e[t*4+1],o[2][t]=e[t*4+2],o[3][t]=e[t*4+3];for(sd(o,l,0),i=1;i<a;i++)cd(o),dd(o),i+1<a&&fd(o),sd(o,l,i*4);for(n=0;n<4;n++)for(r=0;r<4;r++)s.push(o[r][n]);return s}const hd=function(e){return[(e&4278190080)>>>24,(e&16711680)>>16,(e&65280)>>8,e&255]};var gd=function(e){return Array(e).fill(0)},_d=[225].concat(gd(15)),vd=function(e,t){for(let n=0;n<e.length;n++)e[n]^=t[n]};const yd=function(e){let t,n=0,r=0;for(t=0;t<e.length;t++)r=n,n=e[t]&1,e[t]=e[t]>>1,r!==0&&(e[t]=e[t]|128);return e},bd=function(e,t){let n=t.slice(),r=gd(16);for(let t=0;t<16;t++)for(let i=7;i>=0;i--)e[t]&1<<i&&vd(r,n),n[15]&1?(yd(n),vd(n,_d)):yd(n);return r},xd=function(e){let t,n=e.slice();for(t=15;t!==11&&(n[t]=n[t]+1,n[t]===256);t--)n[t]=0;return n};function Sd(e,t){let n=gd(16);for(let r=0;r<e.length;r+=16){let i=n.slice();for(let t=0;t<16;t++)i[t]^=e[r+t]??0;n=bd(i,t)}return n}function Cd(e,t,n){if(e.length===0)return[];let r=Array(e.length),i=t,a=0,o=Math.ceil(e.length/16);for(let t=0;t<o;t++){let s=md(i,n),c=Math.min(16,e.length-a);for(let t=0;t<c;t++)r[a]=e[a]^s[t],a++;t+1<o&&(i=xd(i))}return r}function wd(e,t,n,r){let i,a,o=md(gd(16),r);i=[...n],n.length===12?i=i.concat(gd(3)).concat([1]):(n.length%16!=0&&(i=i.concat(gd(16-n.length%16))),i=i.concat(gd(8)),i=Sd(i.concat(gd(4)).concat(hd(n.length*8)),o));let s=Cd(e,xd(i),r);return a=t.slice(),t.length===0?a=a.concat(gd(16)):t.length%16!=0&&(a=a.concat(gd(16-t.length%16))),a=a.concat(s),s.length===0?a=a.concat(gd(16)):s.length%16!=0&&(a=a.concat(gd(16-s.length%16))),a=a.concat(gd(4)).concat(hd(t.length*8)).concat(gd(4)).concat(hd(s.length*8)),{result:s,authenticationTag:Cd(Sd(a,o),i,r)}}function Td(e,t,n,r,i){let a,o,s=md(gd(16),i);a=[...n],n.length===12?a=a.concat(gd(3)).concat([1]):(n.length%16!=0&&(a=a.concat(gd(16-n.length%16))),a=a.concat(gd(8)),a=Sd(a.concat(gd(4)).concat(hd(n.length*8)),s));let c=Cd(e,xd(a),i);return o=t.slice(),t.length===0?o=o.concat(gd(16)):t.length%16!=0&&(o=o.concat(gd(16-t.length%16))),o=o.concat(e),e.length===0?o=o.concat(gd(16)):e.length%16!=0&&(o=o.concat(gd(16-e.length%16))),o=o.concat(gd(4)).concat(hd(t.length*8)).concat(gd(4)).concat(hd(e.length*8)),Cd(Sd(o,s),a,i).join()===r.join()?c:null}var Ed=class e extends B{static fromRandom(){return new e(Qu(32))}encrypt(e,t){let n=Qu(32);e=U(e,t);let{result:r,authenticationTag:i}=wd(e,[],n,this.toArray(`be`,32));return Ql([...n,...r,...i],t)}decrypt(e,t){e=U(e,t);let n=e.slice(0,32),r=e.slice(32),i=r.slice(-16),a=r.slice(0,-16),o=Td(a,[],n,i,this.toArray());if(o===null)throw Error(`Decryption failed!`);return Ql(o,t)}},Dd=class e extends Bu{static SIGHASH_ALL=1;static SIGHASH_NONE=2;static SIGHASH_SINGLE=3;static SIGHASH_FORKID=64;static SIGHASH_ANYONECANPAY=128;scope;static format(t){let n={sourceTXID:t.sourceTXID,sourceOutputIndex:t.sourceOutputIndex,sequence:t.inputSequence},r=[...t.otherInputs];r.splice(t.inputIndex,0,n);let i=()=>{let e=new au;for(let t of r){if(t.sourceTXID===void 0){if(t.sourceTransaction==null)throw Error(`Missing sourceTransaction for input`);e.write(t.sourceTransaction.hash())}else e.writeReverse(U(t.sourceTXID,`hex`));e.writeUInt32LE(t.sourceOutputIndex)}let t=e.toArray();return Qc(t)},a=()=>{let e=new au;for(let t of r){let n=t.sequence??4294967295;e.writeUInt32LE(n)}let t=e.toArray();return Qc(t)};function o(e){let n=new au;if(e===void 0)for(let e of t.outputs){let t=e.satoshis??0;n.writeUInt64LE(t);let r=e.lockingScript?.toBinary()??[];n.writeVarIntNum(r.length),n.write(r)}else{let r=t.outputs[e];if(r===void 0)throw Error(`Output at index ${e} does not exist`);let i=r.satoshis??0;n.writeUInt64LE(i);let a=r.lockingScript?.toBinary()??[];n.writeVarIntNum(a.length),n.write(a)}let r=n.toArray();return Qc(r)}let s=Array(32).fill(0),c=Array(32).fill(0),l=Array(32).fill(0);(t.scope&e.SIGHASH_ANYONECANPAY)===0&&(s=i()),(t.scope&e.SIGHASH_ANYONECANPAY)===0&&(t.scope&31)!==e.SIGHASH_SINGLE&&(t.scope&31)!==e.SIGHASH_NONE&&(c=a()),(t.scope&31)!==e.SIGHASH_SINGLE&&(t.scope&31)!==e.SIGHASH_NONE?l=o():(t.scope&31)===e.SIGHASH_SINGLE&&t.inputIndex<t.outputs.length&&(l=o(t.inputIndex));let u=new au;u.writeInt32LE(t.transactionVersion),u.write(s),u.write(c),u.writeReverse(U(t.sourceTXID,`hex`)),u.writeUInt32LE(t.sourceOutputIndex);let d=t.subscript.toBinary();u.writeVarIntNum(d.length),u.write(d),u.writeUInt64LE(t.sourceSatoshis);let f=n.sequence;return u.writeUInt32LE(f),u.write(l),u.writeUInt32LE(t.lockTime),u.writeUInt32LE(t.scope>>>0),u.toArray()}static fromChecksigFormat(t){if(t.length===0){let t=new B(1),n=new B(1);return new e(t,n,1)}let n=t[t.length-1],r=t.slice(0,t.length-1),i=Bu.fromDER(r);return new e(i.r,i.s,n)}constructor(e,t,n){super(e,t),this.scope=n}hasLowS(){return!(this.s.ltn(1)||this.s.gt(new B(`7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0`,`hex`)))}toChecksigFormat(){return[...this.toDER(),this.scope]}},Od=class{curve;constructor(){this.curve=new zu}generateProof(e,t,n,r){let i=nd.fromRandom(),a=i.toPublicKey(),o=n.mul(i),s=this.computeChallenge(t,n,r,o,a),c=i.add(s.mul(e)).umod(this.curve.n);return{R:a,SPrime:o,z:c}}verifyProof(e,t,n,r){let{R:i,SPrime:a,z:o}=r,s=this.computeChallenge(e,t,n,a,i),c=this.curve.g.mul(o),l=i.add(e.mul(s));if(!c.eq(l))return!1;let u=t.mul(o),d=a.add(n.mul(s));return!!u.eq(d)}computeChallenge(e,t,n,r,i){let a=[...e.encode(!0),...t.encode(!0),...n.encode(!0),...r.encode(!0),...i.encode(!0)],o=Zc(a);return new B(o).umod(this.curve.n)}},kd={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_SPLIT:127,OP_LEFT:128,OP_NUM2BIN:128,OP_RIGHT:129,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_NOP11:186,OP_NOP12:187,OP_NOP13:188,OP_NOP14:189,OP_NOP15:190,OP_NOP16:191,OP_NOP17:192,OP_NOP18:193,OP_NOP19:194,OP_NOP20:195,OP_NOP21:196,OP_NOP22:197,OP_NOP23:198,OP_NOP24:199,OP_NOP25:200,OP_NOP26:201,OP_NOP27:202,OP_NOP28:203,OP_NOP29:204,OP_NOP30:205,OP_NOP31:206,OP_NOP32:207,OP_NOP33:208,OP_NOP34:209,OP_NOP35:210,OP_NOP36:211,OP_NOP37:212,OP_NOP38:213,OP_NOP39:214,OP_NOP40:215,OP_NOP41:216,OP_NOP42:217,OP_NOP43:218,OP_NOP44:219,OP_NOP45:220,OP_NOP46:221,OP_NOP47:222,OP_NOP48:223,OP_NOP49:224,OP_NOP50:225,OP_NOP51:226,OP_NOP52:227,OP_NOP53:228,OP_NOP54:229,OP_NOP55:230,OP_NOP56:231,OP_NOP57:232,OP_NOP58:233,OP_NOP59:234,OP_NOP60:235,OP_NOP61:236,OP_NOP62:237,OP_NOP63:238,OP_NOP64:239,OP_NOP65:240,OP_NOP66:241,OP_NOP67:242,OP_NOP68:243,OP_NOP69:244,OP_NOP70:245,OP_NOP71:246,OP_NOP72:247,OP_NOP73:248,OP_NOP77:252,OP_SMALLDATA:249,OP_SMALLINTEGER:250,OP_PUBKEYS:251,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};for(let e in kd)kd[kd[e]]=e;var K=kd,Ad=class e{chunks;static fromASM(t){let n=[],r=t.split(` `),i=0;for(;i<r.length;){let e=r[i],t,a=0;if(e.startsWith(`OP_`)&&K[e]!==void 0&&(t=e,a=K[e]),e===`0`)a=0,n.push({op:a}),i+=1;else if(e===`-1`)a=K.OP_1NEGATE,n.push({op:a}),i+=1;else if(t===void 0){let e=r[i];e.length%2!=0&&(e=`0`+e);let t=U(e,`hex`);if(Ql(t,`hex`)!==e)throw Error(`invalid hex string in script`);let o=t.length;o>=0&&o<K.OP_PUSHDATA1?a=o:o<2**8?a=K.OP_PUSHDATA1:o<2**16?a=K.OP_PUSHDATA2:o<2**32&&(a=K.OP_PUSHDATA4),n.push({data:t,op:a}),i+=1}else a===K.OP_PUSHDATA1||a===K.OP_PUSHDATA2||a===K.OP_PUSHDATA4?(n.push({data:U(r[i+2],`hex`),op:a}),i+=3):(n.push({op:a}),i+=1)}return new e(n)}static fromHex(t){if(t.length===0)return e.fromBinary([]);if(t.length%2!=0)throw Error(`There is an uneven number of characters in the string which suggests it is not hex encoded.`);if(!/^[0-9a-fA-F]+$/.test(t))throw Error(`Some elements in this string are not hex encoded.`);return e.fromBinary(U(t,`hex`))}static fromBinary(t){t=[...t];let n=[],r=0,i=new ou(t);for(;!i.eof();){let e=i.readUInt8();if(e===K.OP_RETURN&&r===0){n.push({op:e,data:i.read()});break}e===K.OP_IF||e===K.OP_NOTIF||e===K.OP_VERIF||e===K.OP_VERNOTIF?r++:e===K.OP_ENDIF&&r--;let t=0,a=[];if(e>0&&e<K.OP_PUSHDATA1)t=e,n.push({data:i.read(t),op:e});else if(e===K.OP_PUSHDATA1){try{t=i.readUInt8(),a=i.read(t)}catch{i.read()}n.push({data:a,op:e})}else if(e===K.OP_PUSHDATA2){try{t=i.readUInt16LE(),a=i.read(t)}catch{i.read()}n.push({data:a,op:e})}else if(e===K.OP_PUSHDATA4){try{t=i.readUInt32LE(),a=i.read(t)}catch{i.read()}n.push({data:a,op:e})}else n.push({op:e})}return new e(n)}constructor(e=[]){this.chunks=e}toASM(){let e=``;for(let t=0;t<this.chunks.length;t++){let n=this.chunks[t];e+=this._chunkToString(n)}return e.slice(1)}toHex(){return Ql(this.toBinary(),`hex`)}toBinary(){let e=new au;for(let t=0;t<this.chunks.length;t++){let n=this.chunks[t],r=n.op;if(e.writeUInt8(r),r===K.OP_RETURN&&n.data!=null){e.write(n.data);break}else n.data!=null&&(r<K.OP_PUSHDATA1?e.write(n.data):r===K.OP_PUSHDATA1?(e.writeUInt8(n.data.length),e.write(n.data)):r===K.OP_PUSHDATA2?(e.writeUInt16LE(n.data.length),e.write(n.data)):r===K.OP_PUSHDATA4&&(e.writeUInt32LE(n.data.length),e.write(n.data)))}return e.toArray()}writeScript(e){return this.chunks=this.chunks.concat(e.chunks),this}writeOpCode(e){return this.chunks.push({op:e}),this}setChunkOpCode(e,t){return this.chunks[e]={op:t},this}writeBn(e){if(e.cmpn(0)===K.OP_0)this.chunks.push({op:K.OP_0});else if(e.cmpn(-1)===0)this.chunks.push({op:K.OP_1NEGATE});else if(e.cmpn(1)>=0&&e.cmpn(16)<=0)this.chunks.push({op:e.toNumber()+K.OP_1-1});else{let t=e.toSm(`little`);this.writeBin(t)}return this}writeBin(e){let t,n=e.length>0?e:void 0;if(e.length>0&&e.length<K.OP_PUSHDATA1)t=e.length;else if(e.length===0)t=K.OP_0;else if(e.length<2**8)t=K.OP_PUSHDATA1;else if(e.length<2**16)t=K.OP_PUSHDATA2;else if(e.length<2**32)t=K.OP_PUSHDATA4;else throw Error(`You can't push that much data`);return this.chunks.push({data:n,op:t}),this}writeNumber(e){return this.writeBn(new B(e)),this}removeCodeseparators(){let e=[];for(let t=0;t<this.chunks.length;t++)this.chunks[t].op!==K.OP_CODESEPARATOR&&e.push(this.chunks[t]);return this.chunks=e,this}findAndDelete(t){let n=t.toHex();for(let t=0;t<this.chunks.length;t++){let r=new e([this.chunks[t]]).toHex();n===r&&this.chunks.splice(t,1)}return this}isPushOnly(){for(let e=0;e<this.chunks.length;e++)if(this.chunks[e].op>K.OP_16)return!1;return!0}isLockingScript(){throw Error(`Not implemented`)}isUnlockingScript(){throw Error(`Not implemented`)}_chunkToString(e){let t=e.op,n=``;if(e.data===void 0){let e=K[t];n=`${n} ${e}`}else n=`${n} ${H(e.data)}`;return n}},jd=class extends Ad{isLockingScript(){return!0}isUnlockingScript(){return!1}},Md=class extends Ad{isLockingScript(){return!1}isUnlockingScript(){return!0}},Nd=class extends Error{txid;outputIndex;context;programCounter;stackState;altStackState;ifStackState;stackMem;altStackMem;constructor(e){let t=e.stackState.map(e=>e!=null&&e.length!==void 0?H(e):e==null?`null/undef`:`INVALID_STACK_ITEM`).join(`, `),n=e.altStackState.map(e=>e!=null&&e.length!==void 0?H(e):e==null?`null/undef`:`INVALID_STACK_ITEM`).join(`, `),r=`Context: ${e.context}, PC: ${e.programCounter}`,i=`Stack: [${t}] (len: ${e.stackState.length}, mem: ${e.stackMem})`,a=`AltStack: [${n}] (len: ${e.altStackState.length}, mem: ${e.altStackMem})`,o=`IfStack: [${e.ifStackState.join(`, `)}]`,s=`Script evaluation error: ${e.message}\nTXID: ${e.txid}, OutputIdx: ${e.outputIndex}\n${r}\n${i}\n${a}\n${o}`;super(s),this.name=this.constructor.name,this.txid=e.txid,this.outputIndex=e.outputIndex,this.context=e.context,this.programCounter=e.programCounter,this.stackState=e.stackState.map(e=>e.slice()),this.altStackState=e.altStackState.map(e=>e.slice()),this.ifStackState=e.ifStackState.slice(),this.stackMem=e.stackMem,this.altStackMem=e.altStackMem}},Pd=1024*1024*1024,Fd=2**31-1,Id=!0,Ld=Object.freeze(new B(-1).toScriptNum()),Rd=Object.freeze(Array.from({length:17},(e,t)=>Object.freeze(new B(t).toScriptNum())));function zd(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Bd(e,t=2**53-1){return!(e.length>t||e.length>0&&!(e[e.length-1]&127)&&(e.length<=1||!(e[e.length-2]&128)))}function Vd(e){if(e.length<9||e.length>73||e[0]!==48||e[1]!==e.length-3)return!1;let t=e[2],n=e[3];if(t!==2||n===0||5+n>=e.length)return!1;let r=4+n,i=e[r],a=e[r+1];if(i!==2||a===0||e[4]&128||n>1&&e[4]===0&&!(e[5]&128))return!1;let o=r+2;return!(e[o]&128||a>1&&e[o]===0&&!(e[o+1]&128)||n+a+7!==e.length)}function Hd(e){return e===K.OP_2MUL||e===K.OP_2DIV||e===K.OP_VERIF||e===K.OP_VERNOTIF||e===K.OP_VER}function Ud(e){let t=e.data,n=e.op;return Array.isArray(t)?t.length===0?n===K.OP_0:t.length===1&&t[0]>=1&&t[0]<=16?n===K.OP_1+(t[0]-1):t.length===1&&t[0]===129?n===K.OP_1NEGATE:t.length<=75?n===t.length:t.length<=255?n===K.OP_PUSHDATA1:t.length<=65535?n===K.OP_PUSHDATA2:!0:!0}var Wd=class{sourceTXID;sourceOutputIndex;sourceSatoshis;lockingScript;transactionVersion;otherInputs;outputs;inputIndex;unlockingScript;inputSequence;lockTime;context;programCounter;lastCodeSeparator;stack;altStack;ifStack;memoryLimit;stackMem;altStackMem;constructor(e){this.sourceTXID=e.sourceTXID,this.sourceOutputIndex=e.sourceOutputIndex,this.sourceSatoshis=e.sourceSatoshis,this.lockingScript=e.lockingScript,this.transactionVersion=e.transactionVersion,this.otherInputs=e.otherInputs,this.outputs=e.outputs,this.inputIndex=e.inputIndex,this.unlockingScript=e.unlockingScript,this.inputSequence=e.inputSequence,this.lockTime=e.lockTime,this.memoryLimit=e.memoryLimit??32e6,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0,this.reset()}reset(){this.context=`UnlockingScript`,this.programCounter=0,this.lastCodeSeparator=null,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0}ensureStackMem(e){this.stackMem+e>this.memoryLimit&&this.scriptEvaluationError(`Stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`)}ensureAltStackMem(e){this.altStackMem+e>this.memoryLimit&&this.scriptEvaluationError(`Alt stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`)}pushStack(e){this.ensureStackMem(e.length),this.stack.push(e),this.stackMem+=e.length}pushStackCopy(e){this.ensureStackMem(e.length);let t=e.slice();this.stack.push(t),this.stackMem+=t.length}popStack(){this.stack.length===0&&this.scriptEvaluationError(`Attempted to pop from an empty stack.`);let e=this.stack.pop();return this.stackMem-=e.length,e}stackTop(e=-1){return(this.stack.length===0||this.stack.length<Math.abs(e)||e>=0&&e>=this.stack.length)&&this.scriptEvaluationError(`Stack underflow accessing element at index ${e}. Stack length is ${this.stack.length}.`),this.stack[this.stack.length+e]}pushAltStack(e){this.ensureAltStackMem(e.length),this.altStack.push(e),this.altStackMem+=e.length}popAltStack(){this.altStack.length===0&&this.scriptEvaluationError(`Attempted to pop from an empty alt stack.`);let e=this.altStack.pop();return this.altStackMem-=e.length,e}checkSignatureEncoding(e){if(e.length===0)return!0;if(!Vd(e))return this.scriptEvaluationError(`The signature format is invalid.`),!1;try{let t=Dd.fromChecksigFormat(e);if(!t.hasLowS())return this.scriptEvaluationError(`The signature must have a low S value.`),!1;if((t.scope&Dd.SIGHASH_FORKID)===0)return this.scriptEvaluationError(`The signature must use SIGHASH_FORKID.`),!1}catch{return this.scriptEvaluationError(`The signature format is invalid.`),!1}return!0}checkPublicKeyEncoding(e){if(e.length===0)return this.scriptEvaluationError(`Public key is empty.`),!1;if(e.length<33)return this.scriptEvaluationError(`The public key is too short, it must be at least 33 bytes.`),!1;if(e[0]===4){if(e.length!==65)return this.scriptEvaluationError(`The non-compressed public key must be 65 bytes.`),!1}else if(e[0]===2||e[0]===3){if(e.length!==33)return this.scriptEvaluationError(`The compressed public key must be 33 bytes.`),!1}else return this.scriptEvaluationError(`The public key is in an unknown format.`),!1;try{Yu.fromDER(e)}catch{return this.scriptEvaluationError(`The public key is in an unknown format.`),!1}return!0}verifySignature(e,t,n){let r=Dd.format({sourceTXID:this.sourceTXID,sourceOutputIndex:this.sourceOutputIndex,sourceSatoshis:this.sourceSatoshis,transactionVersion:this.transactionVersion,otherInputs:this.otherInputs,outputs:this.outputs,inputIndex:this.inputIndex,subscript:n,inputSequence:this.inputSequence,lockTime:this.lockTime,scope:e.scope}),i=new B(Qc(r));return Ju(i,e,t)}step(){if(this.stackMem>this.memoryLimit)return this.scriptEvaluationError(`Stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`),!1;if(this.altStackMem>this.memoryLimit)return this.scriptEvaluationError(`Alt stack memory usage has exceeded `+String(this.memoryLimit)+` bytes`),!1;this.context===`UnlockingScript`&&this.programCounter>=this.unlockingScript.chunks.length&&(this.context=`LockingScript`,this.programCounter=0);let e=this.context===`UnlockingScript`?this.unlockingScript:this.lockingScript;if(this.programCounter>=e.chunks.length)return!1;let t=e.chunks[this.programCounter],n=t.op;n===void 0&&this.scriptEvaluationError(`Missing opcode in ${this.context} at pc=${this.programCounter}.`),Array.isArray(t.data)&&t.data.length>Pd&&this.scriptEvaluationError(`Data push > ${Pd} bytes (pc=${this.programCounter}).`);let r=!this.ifStack.includes(!1);if(r&&Hd(n)&&this.scriptEvaluationError(`This opcode is currently disabled. (Opcode: ${K[n]}, PC: ${this.programCounter})`),r&&n>=0&&n<=K.OP_PUSHDATA4)Ud(t)||this.scriptEvaluationError(`This data is not minimally-encoded. (PC: ${this.programCounter})`),this.pushStack(Array.isArray(t.data)?t.data:[]);else if(r||n>=K.OP_IF&&n<=K.OP_ENDIF){let e,t,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D;switch(n){case K.OP_1NEGATE:this.pushStackCopy(Ld);break;case K.OP_0:this.pushStackCopy(Rd[0]);break;case K.OP_1:case K.OP_2:case K.OP_3:case K.OP_4:case K.OP_5:case K.OP_6:case K.OP_7:case K.OP_8:case K.OP_9:case K.OP_10:case K.OP_11:case K.OP_12:case K.OP_13:case K.OP_14:case K.OP_15:case K.OP_16:p=n-(K.OP_1-1),this.pushStackCopy(Rd[p]);break;case K.OP_NOP:case K.OP_NOP2:case K.OP_NOP3:case K.OP_NOP1:case K.OP_NOP4:case K.OP_NOP5:case K.OP_NOP6:case K.OP_NOP7:case K.OP_NOP8:case K.OP_NOP9:case K.OP_NOP10:case K.OP_NOP11:case K.OP_NOP12:case K.OP_NOP13:case K.OP_NOP14:case K.OP_NOP15:case K.OP_NOP16:case K.OP_NOP17:case K.OP_NOP18:case K.OP_NOP19:case K.OP_NOP20:case K.OP_NOP21:case K.OP_NOP22:case K.OP_NOP23:case K.OP_NOP24:case K.OP_NOP25:case K.OP_NOP26:case K.OP_NOP27:case K.OP_NOP28:case K.OP_NOP29:case K.OP_NOP30:case K.OP_NOP31:case K.OP_NOP32:case K.OP_NOP33:case K.OP_NOP34:case K.OP_NOP35:case K.OP_NOP36:case K.OP_NOP37:case K.OP_NOP38:case K.OP_NOP39:case K.OP_NOP40:case K.OP_NOP41:case K.OP_NOP42:case K.OP_NOP43:case K.OP_NOP44:case K.OP_NOP45:case K.OP_NOP46:case K.OP_NOP47:case K.OP_NOP48:case K.OP_NOP49:case K.OP_NOP50:case K.OP_NOP51:case K.OP_NOP52:case K.OP_NOP53:case K.OP_NOP54:case K.OP_NOP55:case K.OP_NOP56:case K.OP_NOP57:case K.OP_NOP58:case K.OP_NOP59:case K.OP_NOP60:case K.OP_NOP61:case K.OP_NOP62:case K.OP_NOP63:case K.OP_NOP64:case K.OP_NOP65:case K.OP_NOP66:case K.OP_NOP67:case K.OP_NOP68:case K.OP_NOP69:case K.OP_NOP70:case K.OP_NOP71:case K.OP_NOP72:case K.OP_NOP73:case K.OP_NOP77:break;case K.OP_IF:case K.OP_NOTIF:h=!1,r&&(this.stack.length<1&&this.scriptEvaluationError(`OP_IF and OP_NOTIF require at least one item on the stack when they are used!`),e=this.popStack(),h=this.castToBool(e),n===K.OP_NOTIF&&(h=!h)),this.ifStack.push(h);break;case K.OP_ELSE:this.ifStack.length===0&&this.scriptEvaluationError(`OP_ELSE requires a preceeding OP_IF.`),this.ifStack[this.ifStack.length-1]=!this.ifStack[this.ifStack.length-1];break;case K.OP_ENDIF:this.ifStack.length===0&&this.scriptEvaluationError(`OP_ENDIF requires a preceeding OP_IF.`),this.ifStack.pop();break;case K.OP_VERIFY:this.stack.length<1&&this.scriptEvaluationError(`OP_VERIFY requires at least one item to be on the stack.`),t=this.stackTop(),h=this.castToBool(t),h||this.scriptEvaluationError(`OP_VERIFY requires the top stack value to be truthy.`),this.popStack();break;case K.OP_RETURN:this.context===`UnlockingScript`?this.programCounter=this.unlockingScript.chunks.length:this.programCounter=this.lockingScript.chunks.length,this.ifStack=[],this.programCounter--;break;case K.OP_TOALTSTACK:this.stack.length<1&&this.scriptEvaluationError(`OP_TOALTSTACK requires at oeast one item to be on the stack.`),this.pushAltStack(this.popStack());break;case K.OP_FROMALTSTACK:this.altStack.length<1&&this.scriptEvaluationError(`OP_FROMALTSTACK requires at least one item to be on the stack.`),this.pushStack(this.popAltStack());break;case K.OP_2DROP:this.stack.length<2&&this.scriptEvaluationError(`OP_2DROP requires at least two items to be on the stack.`),this.popStack(),this.popStack();break;case K.OP_2DUP:this.stack.length<2&&this.scriptEvaluationError(`OP_2DUP requires at least two items to be on the stack.`),t=this.stackTop(-2),i=this.stackTop(-1),this.pushStackCopy(t),this.pushStackCopy(i);break;case K.OP_3DUP:this.stack.length<3&&this.scriptEvaluationError(`OP_3DUP requires at least three items to be on the stack.`),t=this.stackTop(-3),i=this.stackTop(-2),a=this.stackTop(-1),this.pushStackCopy(t),this.pushStackCopy(i),this.pushStackCopy(a);break;case K.OP_2OVER:this.stack.length<4&&this.scriptEvaluationError(`OP_2OVER requires at least four items to be on the stack.`),t=this.stackTop(-4),i=this.stackTop(-3),this.pushStackCopy(t),this.pushStackCopy(i);break;case K.OP_2ROT:{this.stack.length<6&&this.scriptEvaluationError(`OP_2ROT requires at least six items to be on the stack.`);let e=this.popStack(),t=this.popStack(),n=this.popStack(),r=this.popStack(),i=this.popStack(),a=this.popStack();this.pushStack(r),this.pushStack(n),this.pushStack(t),this.pushStack(e),this.pushStack(a),this.pushStack(i);break}case K.OP_2SWAP:{this.stack.length<4&&this.scriptEvaluationError(`OP_2SWAP requires at least four items to be on the stack.`);let e=this.popStack(),t=this.popStack(),n=this.popStack(),r=this.popStack();this.pushStack(t),this.pushStack(e),this.pushStack(r),this.pushStack(n);break}case K.OP_IFDUP:this.stack.length<1&&this.scriptEvaluationError(`OP_IFDUP requires at least one item to be on the stack.`),t=this.stackTop(),this.castToBool(t)&&this.pushStackCopy(t);break;case K.OP_DEPTH:this.pushStack(new B(this.stack.length).toScriptNum());break;case K.OP_DROP:this.stack.length<1&&this.scriptEvaluationError(`OP_DROP requires at least one item to be on the stack.`),this.popStack();break;case K.OP_DUP:this.stack.length<1&&this.scriptEvaluationError(`OP_DUP requires at least one item to be on the stack.`),this.pushStackCopy(this.stackTop());break;case K.OP_NIP:this.stack.length<2&&this.scriptEvaluationError(`OP_NIP requires at least two items to be on the stack.`),i=this.popStack(),this.popStack(),this.pushStack(i);break;case K.OP_OVER:this.stack.length<2&&this.scriptEvaluationError(`OP_OVER requires at least two items to be on the stack.`),this.pushStackCopy(this.stackTop(-2));break;case K.OP_PICK:case K.OP_ROLL:{this.stack.length<2&&this.scriptEvaluationError(`${K[n]} requires at least two items to be on the stack.`),l=B.fromScriptNum(this.popStack(),Id),p=l.toNumber(),(p<0||p>=this.stack.length)&&this.scriptEvaluationError(`${K[n]} requires the top stack element to be 0 or a positive number less than the current size of the stack.`);let e=this.stack[this.stack.length-1-p];n===K.OP_ROLL?(this.stack.splice(this.stack.length-1-p,1),this.stackMem-=e.length,this.pushStack(e)):this.pushStackCopy(e);break}case K.OP_ROT:this.stack.length<3&&this.scriptEvaluationError(`OP_ROT requires at least three items to be on the stack.`),c=this.popStack(),s=this.popStack(),o=this.popStack(),this.pushStack(s),this.pushStack(c),this.pushStack(o);break;case K.OP_SWAP:this.stack.length<2&&this.scriptEvaluationError(`OP_SWAP requires at least two items to be on the stack.`),s=this.popStack(),o=this.popStack(),this.pushStack(s),this.pushStack(o);break;case K.OP_TUCK:this.stack.length<2&&this.scriptEvaluationError(`OP_TUCK requires at least two items to be on the stack.`),t=this.stackTop(-1),this.ensureStackMem(t.length),this.stack.splice(this.stack.length-2,0,t.slice()),this.stackMem+=t.length;break;case K.OP_SIZE:this.stack.length<1&&this.scriptEvaluationError(`OP_SIZE requires at least one item to be on the stack.`),this.pushStack(new B(this.stackTop().length).toScriptNum());break;case K.OP_AND:case K.OP_OR:case K.OP_XOR:{this.stack.length<2&&this.scriptEvaluationError(`${K[n]} requires at least two items on the stack.`),i=this.popStack(),t=this.popStack(),t.length!==i.length&&this.scriptEvaluationError(`${K[n]} requires the top two stack items to be the same size.`);let e=Array(t.length);for(let r=0;r<t.length;r++)n===K.OP_AND?e[r]=t[r]&i[r]:n===K.OP_OR?e[r]=t[r]|i[r]:e[r]=t[r]^i[r];this.pushStack(e);break}case K.OP_INVERT:{this.stack.length<1&&this.scriptEvaluationError(`OP_INVERT requires at least one item to be on the stack.`),e=this.popStack();let t=Array(e.length);for(let n=0;n<e.length;n++)t[n]=~e[n]&255;this.pushStack(t);break}case K.OP_LSHIFT:case K.OP_RSHIFT:{if(this.stack.length<2&&this.scriptEvaluationError(`${K[n]} requires at least two items to be on the stack.`),d=B.fromScriptNum(this.popStack(),Id),t=this.popStack(),p=d.toNumber(),p<0&&this.scriptEvaluationError(`${K[n]} requires the top item on the stack not to be negative.`),t.length===0){this.pushStack([]);break}u=new B(t);let e;e=n===K.OP_LSHIFT?u.ushln(p):u.ushrn(p);let r=e.toArray(`le`,t.length);this.pushStack(r);break}case K.OP_EQUAL:case K.OP_EQUALVERIFY:this.stack.length<2&&this.scriptEvaluationError(`${K[n]} requires at least two items to be on the stack.`),i=this.popStack(),t=this.popStack(),h=zd(t,i),this.pushStack(h?[1]:[]),n===K.OP_EQUALVERIFY&&(h||this.scriptEvaluationError(`OP_EQUALVERIFY requires the top two stack items to be equal.`),this.popStack());break;case K.OP_1ADD:case K.OP_1SUB:case K.OP_NEGATE:case K.OP_ABS:case K.OP_NOT:case K.OP_0NOTEQUAL:switch(this.stack.length<1&&this.scriptEvaluationError(`${K[n]} requires at least one item to be on the stack.`),l=B.fromScriptNum(this.popStack(),Id),n){case K.OP_1ADD:l=l.add(new B(1));break;case K.OP_1SUB:l=l.sub(new B(1));break;case K.OP_NEGATE:l=l.neg();break;case K.OP_ABS:l.isNeg()&&(l=l.neg());break;case K.OP_NOT:l=new B(l.cmpn(0)===0?1:0);break;case K.OP_0NOTEQUAL:l=new B(l.cmpn(0)===0?0:1);break}this.pushStack(l.toScriptNum());break;case K.OP_ADD:case K.OP_SUB:case K.OP_MUL:case K.OP_DIV:case K.OP_MOD:case K.OP_BOOLAND:case K.OP_BOOLOR:case K.OP_NUMEQUAL:case K.OP_NUMEQUALVERIFY:case K.OP_NUMNOTEQUAL:case K.OP_LESSTHAN:case K.OP_GREATERTHAN:case K.OP_LESSTHANOREQUAL:case K.OP_GREATERTHANOREQUAL:case K.OP_MIN:case K.OP_MAX:{this.stack.length<2&&this.scriptEvaluationError(`${K[n]} requires at least two items to be on the stack.`),i=this.popStack(),t=this.popStack(),d=B.fromScriptNum(i,Id),u=B.fromScriptNum(t,Id);let e=0;switch(n){case K.OP_MUL:e=u.byteLength()+d.byteLength();break;case K.OP_ADD:case K.OP_SUB:e=Math.max(u.byteLength(),d.byteLength())+1;break;default:e=Math.max(u.byteLength(),d.byteLength())}this.ensureStackMem(e);let r=new B(0);switch(n){case K.OP_ADD:r=u.add(d);break;case K.OP_SUB:r=u.sub(d);break;case K.OP_MUL:r=u.mul(d);break;case K.OP_DIV:d.cmpn(0)===0&&this.scriptEvaluationError(`OP_DIV cannot divide by zero!`),r=u.div(d);break;case K.OP_MOD:d.cmpn(0)===0&&this.scriptEvaluationError(`OP_MOD cannot divide by zero!`),r=u.mod(d);break;case K.OP_BOOLAND:r=new B(u.cmpn(0)!==0&&d.cmpn(0)!==0?1:0);break;case K.OP_BOOLOR:r=new B(u.cmpn(0)!==0||d.cmpn(0)!==0?1:0);break;case K.OP_NUMEQUAL:r=new B(u.cmp(d)===0?1:0);break;case K.OP_NUMEQUALVERIFY:r=new B(u.cmp(d)===0?1:0);break;case K.OP_NUMNOTEQUAL:r=new B(u.cmp(d)===0?0:1);break;case K.OP_LESSTHAN:r=new B(u.cmp(d)<0?1:0);break;case K.OP_GREATERTHAN:r=new B(u.cmp(d)>0?1:0);break;case K.OP_LESSTHANOREQUAL:r=new B(u.cmp(d)<=0?1:0);break;case K.OP_GREATERTHANOREQUAL:r=new B(u.cmp(d)>=0?1:0);break;case K.OP_MIN:r=u.cmp(d)<0?u:d;break;case K.OP_MAX:r=u.cmp(d)>0?u:d;break}this.pushStack(r.toScriptNum()),n===K.OP_NUMEQUALVERIFY&&(this.castToBool(this.stackTop())||this.scriptEvaluationError(`OP_NUMEQUALVERIFY requires the top stack item to be truthy.`),this.popStack());break}case K.OP_WITHIN:this.stack.length<3&&this.scriptEvaluationError(`OP_WITHIN requires at least three items to be on the stack.`),f=B.fromScriptNum(this.popStack(),Id),d=B.fromScriptNum(this.popStack(),Id),u=B.fromScriptNum(this.popStack(),Id),h=u.cmp(d)>=0&&u.cmp(f)<0,this.pushStack(h?[1]:[]);break;case K.OP_RIPEMD160:case K.OP_SHA1:case K.OP_SHA256:case K.OP_HASH160:case K.OP_HASH256:{this.stack.length<1&&this.scriptEvaluationError(`${K[n]} requires at least one item to be on the stack.`),e=this.popStack();let t=[];n===K.OP_RIPEMD160?t=Yc(e):n===K.OP_SHA1?t=Xc(e):n===K.OP_SHA256?t=Zc(e):n===K.OP_HASH160?t=$c(e):n===K.OP_HASH256&&(t=Qc(e)),this.pushStack(t);break}case K.OP_CODESEPARATOR:this.lastCodeSeparator=this.programCounter;break;case K.OP_CHECKSIG:case K.OP_CHECKSIGVERIFY:{this.stack.length<2&&this.scriptEvaluationError(`${K[n]} requires at least two items to be on the stack.`),y=this.popStack(),v=this.popStack(),(!this.checkSignatureEncoding(v)||!this.checkPublicKeyEncoding(y))&&this.scriptEvaluationError(`${K[n]} requires correct encoding for the public key and signature.`);let e=(this.context===`UnlockingScript`?this.unlockingScript:this.lockingScript).chunks.slice(this.lastCodeSeparator===null?0:this.lastCodeSeparator+1);if(_=new Ad(e),_.findAndDelete(new Ad().writeBin(v)),g=!1,v.length>0)try{b=Dd.fromChecksigFormat(v),x=Yu.fromDER(y),g=this.verifySignature(b,x,_)}catch{g=!1}this.pushStack(g?[1]:[]),n===K.OP_CHECKSIGVERIFY&&(g||this.scriptEvaluationError(`OP_CHECKSIGVERIFY requires that a valid signature is provided.`),this.popStack());break}case K.OP_CHECKMULTISIG:case K.OP_CHECKMULTISIGVERIFY:{S=1,this.stack.length<S&&this.scriptEvaluationError(`${K[n]} requires at least 1 item for nKeys.`),T=B.fromScriptNum(this.stackTop(-S),Id).toNumber(),(T<0||T>Fd)&&this.scriptEvaluationError(`${K[n]} requires a key count between 0 and ${Fd}.`),C=++S,S+=T,this.stack.length<S&&this.scriptEvaluationError(`${K[n]} stack too small for nKeys and keys. Need ${S}, have ${this.stack.length}.`),E=B.fromScriptNum(this.stackTop(-S),Id).toNumber(),(E<0||E>T)&&this.scriptEvaluationError(`${K[n]} requires the number of signatures to be no greater than the number of keys.`),w=++S,S+=E,this.stack.length<S&&this.scriptEvaluationError(`${K[n]} stack too small for N, keys, M, sigs, and dummy. Need ${S}, have ${this.stack.length}.`);let e=(this.context===`UnlockingScript`?this.unlockingScript:this.lockingScript).chunks.slice(this.lastCodeSeparator===null?0:this.lastCodeSeparator+1);_=new Ad(e);for(let e=0;e<E;e++)v=this.stackTop(-w-e),_.findAndDelete(new Ad().writeBin(v));for(g=!0;g&&E>0;){if(T===0){g=!1;break}if(v=this.stackTop(-w),y=this.stackTop(-C),(!this.checkSignatureEncoding(v)||!this.checkPublicKeyEncoding(y))&&this.scriptEvaluationError(`${K[n]} requires correct encoding for the public key and signature.`),D=!1,v.length>0)try{b=Dd.fromChecksigFormat(v),x=Yu.fromDER(y),D=this.verifySignature(b,x,_)}catch{D=!1}D&&(w++,E--),C++,T--,E>T&&(g=!1)}let t=1+B.fromScriptNum(this.stackTop(-1),!1).toNumber()+1+B.fromScriptNum(this.stackTop(-(1+B.fromScriptNum(this.stackTop(-1),!1).toNumber()+1)),!1).toNumber()+1-1;for(;t>0;)this.popStack(),t--;this.stack.length<1&&this.scriptEvaluationError(`${K[n]} requires an extra item (dummy) to be on the stack.`),this.popStack().length>0&&this.scriptEvaluationError(`${K[n]} requires the extra stack item (dummy) to be empty.`),this.pushStack(g?[1]:[]),n===K.OP_CHECKMULTISIGVERIFY&&(g||this.scriptEvaluationError(`OP_CHECKMULTISIGVERIFY requires that a sufficient number of valid signatures are provided.`),this.popStack());break}case K.OP_CAT:{this.stack.length<2&&this.scriptEvaluationError(`OP_CAT requires at least two items to be on the stack.`),i=this.popStack(),t=this.popStack();let e=t.concat(i);e.length>Pd&&this.scriptEvaluationError(`It's not currently possible to push data larger than ${Pd} bytes.`),this.pushStack(e);break}case K.OP_SPLIT:{this.stack.length<2&&this.scriptEvaluationError(`OP_SPLIT requires at least two items to be on the stack.`);let e=this.popStack(),t=this.popStack();p=B.fromScriptNum(e,Id).toNumber(),(p<0||p>t.length)&&this.scriptEvaluationError(`OP_SPLIT requires the first stack item to be a non-negative number less than or equal to the size of the second-from-top stack item.`),this.pushStack(t.slice(0,p)),this.pushStack(t.slice(p));break}case K.OP_NUM2BIN:{this.stack.length<2&&this.scriptEvaluationError(`OP_NUM2BIN requires at least two items to be on the stack.`),m=B.fromScriptNum(this.popStack(),Id).toNumber(),(m>Pd||m<0)&&this.scriptEvaluationError(`It's not currently possible to push data larger than ${Pd} bytes or negative size.`);let e=this.popStack();if(e=su(e),e.length>m&&this.scriptEvaluationError(`OP_NUM2BIN requires that the size expressed in the top stack item is large enough to hold the value expressed in the second-from-top stack item.`),e.length===m){this.pushStack(e);break}let t=Array(m).fill(0),n=0;e.length>0&&(n=e[e.length-1]&128,e[e.length-1]&=127);for(let n=0;n<e.length;n++)t[n]=e[n];n!==0&&(t[m-1]|=128),this.pushStack(t);break}case K.OP_BIN2NUM:{this.stack.length<1&&this.scriptEvaluationError(`OP_BIN2NUM requires at least one item to be on the stack.`),t=this.popStack();let e=su(t);Bd(e)||this.scriptEvaluationError(`OP_BIN2NUM requires that the resulting number is valid.`),this.pushStack(e);break}default:this.scriptEvaluationError(`Invalid opcode ${n} (pc=${this.programCounter}).`)}}return this.programCounter++,!0}validate(){for(this.unlockingScript.isPushOnly()||this.scriptEvaluationError(`Unlocking scripts can only contain push operations, and no other opcodes.`);this.step()&&!(this.context===`LockingScript`&&this.programCounter>=this.lockingScript.chunks.length););return this.ifStack.length>0&&this.scriptEvaluationError(`Every OP_IF, OP_NOTIF, or OP_ELSE must be terminated with OP_ENDIF prior to the end of the script.`),this.stack.length!==1&&this.scriptEvaluationError(`The clean stack rule requires exactly one item to be on the stack after script execution, found ${this.stack.length}.`),this.stack.length===0?this.scriptEvaluationError(`The top stack element must be truthy after script evaluation (stack is empty).`):this.castToBool(this.stackTop())||this.scriptEvaluationError(`The top stack element must be truthy after script evaluation.`),!0}castToBool(e){if(e.length===0)return!1;for(let t=0;t<e.length;t++)if(e[t]!==0)return!(t===e.length-1&&e[t]===128);return!1}scriptEvaluationError(e){throw new Nd({message:e,txid:this.sourceTXID,outputIndex:this.sourceOutputIndex,context:this.context,programCounter:this.programCounter,stackState:this.stack,altStackState:this.altStack,ifStackState:this.ifStack,stackMem:this.stackMem,altStackMem:this.altStackMem})}},Gd=class{lock(e){let t;if(typeof e==`string`){let n=iu(e);if(n.prefix[0]!==0&&n.prefix[0]!==111)throw Error(`only P2PKH is supported`);t=n.data}else t=e;if(t.length!==20)throw Error(`P2PKH hash length must be 20 bytes`);return new jd([{op:K.OP_DUP},{op:K.OP_HASH160},{op:t.length,data:t},{op:K.OP_EQUALVERIFY},{op:K.OP_CHECKSIG}])}unlock(e,t=`all`,n=!1,r,i){return{sign:async(a,o)=>{let s=Dd.SIGHASH_FORKID;t===`all`&&(s|=Dd.SIGHASH_ALL),t===`none`&&(s|=Dd.SIGHASH_NONE),t===`single`&&(s|=Dd.SIGHASH_SINGLE),n&&(s|=Dd.SIGHASH_ANYONECANPAY);let c=a.inputs[o],l=a.inputs.filter((e,t)=>t!==o),u=c.sourceTXID??c.sourceTransaction?.id(`hex`);if(u==null||u===void 0||u===``)throw Error(`The input sourceTXID or sourceTransaction is required for transaction signing.`);if(r||=c.sourceTransaction?.outputs[c.sourceOutputIndex].satoshis,r==null||r===void 0)throw Error(`The sourceSatoshis or input sourceTransaction is required for transaction signing.`);if(i||=c.sourceTransaction?.outputs[c.sourceOutputIndex].lockingScript,i==null)throw Error(`The lockingScript or input sourceTransaction is required for transaction signing.`);let d=Dd.format({sourceTXID:u,sourceOutputIndex:uu(c.sourceOutputIndex,`input.sourceOutputIndex must have value`),sourceSatoshis:r,transactionVersion:a.version,otherInputs:l,inputIndex:o,outputs:a.outputs,inputSequence:uu(c.sequence,`input.sequence must have value`),subscript:i,lockTime:a.lockTime,scope:s}),f=e.sign(Zc(d)),p=new Dd(f.r,f.s,s).toChecksigFormat(),m=e.toPublicKey().encode(!0);return new Md([{op:p.length,data:p},{op:m.length,data:m}])},estimateLength:async()=>108}}},Kd=e=>e.length===0||e.length===1&&e[0]===0?{op:0}:e.length===1&&e[0]>0&&e[0]<=16?{op:80+e[0]}:e.length===1&&e[0]===129?{op:79}:e.length<=75?{op:e.length,data:e}:e.length<=255?{op:76,data:e}:e.length<=65535?{op:77,data:e}:{op:78,data:e},qd=class{wallet;originator;static decode(e){let t=Yu.fromString(H(uu(e.chunks[0].data,`script.chunks[0].data must have value`))),n=[];for(let t=2;t<e.chunks.length;t++){let r=e.chunks[t+1]?.op,i=e.chunks[t].data??[];if(i.length===0&&(e.chunks[t].op>=80&&e.chunks[t].op<=95?i=[e.chunks[t].op-80]:e.chunks[t].op===0?i=[0]:e.chunks[t].op===79&&(i=[129])),n.push(i),r===K.OP_DROP||r===K.OP_2DROP)break}return{fields:n,lockingPublicKey:t}}constructor(e,t){this.wallet=e,this.originator=t}async lock(e,t,n,r,i=!1,a=!0,o=`before`){let{publicKey:s}=await this.wallet.getPublicKey({protocolID:t,keyID:n,counterparty:r,forSelf:i},this.originator),c=[],l=[];if(c.push({op:s.length/2,data:U(s,`hex`)}),c.push({op:K.OP_CHECKSIG}),a){let i=e.reduce((e,t)=>[...e,...t],[]),{signature:a}=await this.wallet.createSignature({data:i,protocolID:t,keyID:n,counterparty:r},this.originator);e.push(a)}for(let t of e)l.push(Kd(t));let u=e.length;for(;u>1;)l.push({op:K.OP_2DROP}),u-=2;return u!==0&&l.push({op:K.OP_DROP}),o===`before`?new jd([...c,...l]):new jd([...l,...c])}unlock(e,t,n,r=`all`,i=!1,a,o){return{sign:async(s,c)=>{let l=Dd.SIGHASH_FORKID;r===`all`&&(l|=Dd.SIGHASH_ALL),r===`none`&&(l|=Dd.SIGHASH_NONE),r===`single`&&(l|=Dd.SIGHASH_SINGLE),i&&(l|=Dd.SIGHASH_ANYONECANPAY);let u=s.inputs[c],d=s.inputs.filter((e,t)=>t!==c),f=u.sourceTXID??u.sourceTransaction?.id(`hex`);if(f==null||f===void 0)throw Error(`The input sourceTXID or sourceTransaction is required for transaction signing.`);if(a||=u.sourceTransaction?.outputs[u.sourceOutputIndex].satoshis,a==null||a===void 0)throw Error(`The sourceSatoshis or input sourceTransaction is required for transaction signing.`);if(o||=u.sourceTransaction?.outputs[u.sourceOutputIndex].lockingScript,o==null)throw Error(`The lockingScript or input sourceTransaction is required for transaction signing.`);let p=Dd.format({sourceTXID:f,sourceOutputIndex:uu(u.sourceOutputIndex,`input.sourceOutputIndex must have value`),sourceSatoshis:a,transactionVersion:s.version,otherInputs:d,inputIndex:c,outputs:s.outputs,inputSequence:u.sequence??4294967295,subscript:o,lockTime:s.lockTime,scope:l}),m=Zc(p),{signature:h}=await this.wallet.createSignature({data:m,protocolID:e,keyID:t,counterparty:n},this.originator),g=Bu.fromDER([...h]),_=new Dd(g.r,g.s,l).toChecksigFormat();return new Md([{op:_.length,data:_}])},estimateLength:async()=>73}}},Jd=class{value;constructor(e){this.value=e}async computeFee(e){let t=e=>e>2**32?9:e>2**16?5:e>253?3:1,n=4;n+=t(e.inputs.length);for(let r=0;r<e.inputs.length;r++){let i=e.inputs[r];n+=40;let a;if(typeof i.unlockingScript==`object`)a=i.unlockingScript.toBinary().length;else if(typeof i.unlockingScriptTemplate==`object`)a=await i.unlockingScriptTemplate.estimateLength(e,r);else throw Error(`All inputs must have an unlocking script or an unlocking script template for sat/kb fee computation.`);n+=t(a),n+=a}n+=t(e.outputs.length);for(let r of e.outputs){n+=8;let e=r.lockingScript.toBinary().length;n+=t(e),n+=e}return n+=4,Math.ceil(n/1e3*this.value)}},Yd=class e extends Jd{static ARC_POLICY_URL=`https://arc.gorillapool.io/v1/policy`;static instance=null;cachedRate=null;cacheTimestamp=0;cacheValidityMs;constructor(e=300*1e3){super(100),this.cacheValidityMs=e}static getInstance(t=300*1e3){return e.instance||=new e(t),e.instance}async fetchFeeRate(){let t=Date.now();if(this.cachedRate!==null&&t-this.cacheTimestamp<this.cacheValidityMs)return this.cachedRate;try{let n=await fetch(e.ARC_POLICY_URL);if(!n.ok)throw Error(`HTTP ${n.status}: ${n.statusText}`);let r=await n.json();if(!r.policy?.miningFee||typeof r.policy.miningFee.satoshis!=`number`||typeof r.policy.miningFee.bytes!=`number`)throw Error(`Invalid policy response format`);let i=r.policy.miningFee.satoshis/r.policy.miningFee.bytes*1e3;return this.cachedRate=i,this.cacheTimestamp=t,i}catch(e){return this.cachedRate===null?(console.warn(`Failed to fetch live fee rate, using default 100 sat/kb:`,e),100):(console.warn(`Failed to fetch live fee rate, using cached value:`,e),this.cachedRate)}}async computeFee(e){return this.value=await this.fetchFeeRate(),super.computeFee(e)}},Xd=class{https;constructor(e){this.https=e}async request(e,t){return await new Promise((n,r)=>{let i=this.https.request(e,t,e=>{let t=``;e.on(`data`,e=>{t+=e}),e.on(`end`,()=>{let r=e.statusCode>=200&&e.statusCode<=299,i=e.headers[`content-type`],a=t!==``&&typeof i==`string`&&i.startsWith(`application/json`)?JSON.parse(t):t;n({status:e.statusCode,statusText:e.statusMessage,ok:r,data:a})})});i.on(`error`,e=>{r(e)}),t.data!==null&&t.data!==void 0&&i.write(JSON.stringify(t.data)),i.end()})}},Zd=class{fetch;constructor(e){this.fetch=e}async request(e,t){let n={method:t.method,headers:t.headers,body:JSON.stringify(t.data)},r=await this.fetch(e,n),i=r.headers.get(`Content-Type`)?.startsWith(`application/json`)??!1?await r.json():await r.text();return{ok:r.ok,status:r.status,statusText:r.statusText,data:i}}};function Qd(){let e={async request(...e){throw Error(`No method available to perform HTTP request`)}};if(typeof window<`u`&&typeof window.fetch==`function`)return new Zd(window.fetch.bind(window));if(u!==void 0)try{let e=Ut();return new Xd(e)}catch{return e}else return e}function $d(){return`ts-sdk-${H(Qu(16))}`}var ef=class{URL;apiKey;deploymentId;callbackUrl;callbackToken;headers;httpClient;constructor(e,t){if(this.URL=e,typeof t==`string`)this.apiKey=t,this.httpClient=Qd(),this.deploymentId=$d(),this.callbackToken=void 0,this.callbackUrl=void 0;else{let{apiKey:e,deploymentId:n,httpClient:r,callbackToken:i,callbackUrl:a,headers:o}=t??{};this.apiKey=e,this.httpClient=r??Qd(),this.deploymentId=n??$d(),this.callbackToken=i,this.callbackUrl=a,this.headers=o}}requestHeaders(){let e={"Content-Type":`application/json`,"XDeployment-ID":this.deploymentId};if(this.apiKey!=null&&this.apiKey!==``&&(e.Authorization=`Bearer ${this.apiKey}`),this.callbackUrl!=null&&this.callbackUrl!==``&&(e[`X-CallbackUrl`]=this.callbackUrl),this.callbackToken!=null&&this.callbackToken!==``&&(e[`X-CallbackToken`]=this.callbackToken),this.headers!=null)for(let t in this.headers)e[t]=this.headers[t];return e}async broadcast(e){let t;try{t=e.toHexEF()}catch(n){if(n.message===`All inputs must have source transactions when serializing to EF format`)t=e.toHex();else throw n}let n={method:`POST`,headers:this.requestHeaders(),data:{rawTx:t}};try{let e=await this.httpClient.request(`${this.URL}/v1/tx`,n);if(e.ok){let{txid:t,extraInfo:n,txStatus:r,competingTxs:i}=e.data,a={status:`success`,txid:t,message:`${r} ${n}`};return i!=null&&(a.competingTxs=i),a}else{let t=typeof e.status,n={status:`error`,code:t===`number`||t===`string`?e.status.toString():`ERR_UNKNOWN`,description:`Unknown error`},r=e.data;if(typeof r==`string`)try{r=JSON.parse(e.data)}catch{}return typeof r==`object`&&(r!==null&&(n.more=r),r!=null&&typeof r.txid==`string`&&(n.txid=r.txid),r!=null&&`detail`in r&&typeof r.detail==`string`&&(n.description=r.detail)),n}}catch(e){return{status:`error`,code:`500`,description:typeof e.message==`string`?e.message:`Internal Server Error`}}}async broadcastMany(e){let t=e.map(e=>{try{return{rawTx:e.toHexEF()}}catch(t){if(t.message===`All inputs must have source transactions when serializing to EF format`)return{rawTx:e.toHex()};throw t}}),n={method:`POST`,headers:this.requestHeaders(),data:t};try{return(await this.httpClient.request(`${this.URL}/v1/txs`,n)).data}catch(t){let n={status:`error`,code:`500`,description:typeof t.message==`string`?t.message:`Internal Server Error`};return e.map(()=>n)}}};function tf(e=!1,t={}){return new ef(e?`https://testnet.arc.gorillapool.io`:`https://arc.gorillapool.io`,t)}var nf=class{network;apiKey;URL;httpClient;constructor(e=`main`,t={}){let{apiKey:n,httpClient:r}=t;this.network=e,this.URL=`https://api.whatsonchain.com/v1/bsv/${e}`,this.httpClient=r??Qd(),this.apiKey=n??``}async isValidRootForHeight(e,t){let n={method:`GET`,headers:this.getHttpHeaders()},r=await this.httpClient.request(`${this.URL}/block/${t}/header`,n);if(r.ok){let{merkleroot:t}=r.data;return t===e}else if(r.status===404)return!1;else throw Error(`Failed to verify merkleroot for height ${t} because of an error: ${JSON.stringify(r.data)} `)}async currentHeight(){try{let e={method:`GET`,headers:this.getHttpHeaders()},t=await this.httpClient.request(`${this.URL}/block/headers`,e);if(t.ok)return t.data[0].height;throw Error(`Failed to get current height because of an error: ${JSON.stringify(t.data)} `)}catch(e){throw Error(`Failed to get current height because of an error: ${e instanceof Error?e.message:String(e)}`)}}getHttpHeaders(){let e={Accept:`application/json`};return typeof this.apiKey==`string`&&this.apiKey.trim()!==``&&(e.Authorization=this.apiKey),e}};function rf(){return new nf}var af=class e{blockHeight;path;static fromHex(t){return e.fromBinary(U(t,`hex`))}static fromReader(t,n=!0){let r=t.readVarIntNum(),i=t.readUInt8(),a=Array(i).fill(null).map(()=>[]),o,s,c;for(let e=0;e<i;e++){for(c=t.readVarIntNum();c>0;){s=t.readVarIntNum(),o=t.readUInt8();let n={offset:s};o&1?n.duplicate=!0:(o&2&&(n.txid=!0),n.hash=H(t.read(32).reverse())),(!Array.isArray(a[e])||a[e].length===0)&&(a[e]=[]),a[e].push(n),c--}a[e].sort((e,t)=>e.offset-t.offset)}return new e(r,a,n)}static fromBinary(t){let n=new ou(t);return e.fromReader(n)}static fromCoinbaseTxidAndHeight(t,n){return new e(n,[[{offset:0,hash:t,txid:!0}]])}constructor(e,t,n=!0){this.blockHeight=e,this.path=t;let r=Array(this.path.length).fill(0).map(()=>new Set);this.path.forEach((e,t)=>{if(e.length===0&&t===0)throw Error(`Empty level at height: ${t}`);let i=new Set;e.forEach(e=>{if(i.has(e.offset))throw Error(`Duplicate offset: ${e.offset}, at height: ${t}`);if(i.add(e.offset),t===0){if(e.duplicate!==!0)for(let t=1;t<this.path.length;t++)r[t].add(e.offset>>t^1)}else if(n&&!r[t].has(e.offset))throw Error(`Invalid offset: ${e.offset}, at height: ${t}, with legal offsets: ${Array.from(r[t]).join(`, `)}`)})});let i;this.path[0].forEach((e,t)=>{if(t===0&&(i=this.computeRoot(e.hash)),i!==this.computeRoot(e.hash))throw Error(`Mismatched roots`)})}toBinary(){let e=new au;e.writeVarIntNum(this.blockHeight);let t=this.path.length;e.writeUInt8(t);for(let n=0;n<t;n++){let t=Object.keys(this.path[n]).length;e.writeVarIntNum(t);for(let t of this.path[n]){e.writeVarIntNum(t.offset);let n=0;t?.duplicate===!0&&(n|=1),t?.txid!==void 0&&t.txid!==null&&(n|=2),e.writeUInt8(n),n&1||e.write(U(t.hash,`hex`).reverse())}}return e.toArray()}toHex(){return H(this.toBinary())}indexOf(e){let t=this.path[0].find(t=>t.hash===e);if(t==null)throw Error(`Transaction ID ${e} not found in the Merkle Path`);return t.offset}computeRoot(e){if(typeof e!=`string`){let t=this.path[0].find(e=>!!e?.hash);if(t==null)throw Error(`No valid leaf found in the Merkle Path`);e=t.hash}if(typeof e!=`string`)throw Error(`Transaction ID is undefined`);let t=this.indexOf(e);if(typeof t!=`number`)throw Error(`This proof does not contain the txid: ${e??`undefined`}`);let n=e=>H(Qc(U(e,`hex`).reverse()).reverse()),r=e;if(this.path.length===1&&this.path[0].length===1)return r;for(let e=0;e<this.path.length;e++){this.path[e];let i=t>>e^1,a=this.findOrComputeLeaf(e,i);if(typeof a!=`object`)throw Error(`Missing hash for index ${t} at height ${e}`);r=a.duplicate===!0?n((r??``)+(r??``)):i%2==0?n((r??``)+(a.hash??``)):n((a.hash??``)+(r??``))}return r}findOrComputeLeaf(e,t){let n=e=>H(Qc(U(e,`hex`).reverse()).reverse()),r=this.path[e].find(e=>e.offset===t);if(r!=null)return r;if(e===0)return;let i=e-1,a=t<<1,o=this.findOrComputeLeaf(i,a);if(o==null||o.hash==null||o.hash===``)return;let s=this.findOrComputeLeaf(i,a+1);if(s==null)return;let c;return c=s.duplicate===!0?n(o.hash+o.hash):n((s.hash??``)+(o.hash??``)),r={offset:t,hash:c},r}async verify(e,t){let n=this.computeRoot(e);if(this.indexOf(e)===0){let e=await t.currentHeight();if(this.blockHeight+100<e)return!1}return await t.isValidRootForHeight(n,this.blockHeight)}combine(e){if(this.blockHeight!==e.blockHeight)throw Error(`You cannot combine paths which do not have the same block height.`);let t=this.computeRoot(),n=e.computeRoot();if(t!==n)throw Error(`You cannot combine paths which do not have the same root.`);let r=[];for(let t=0;t<this.path.length;t++){r.push([]);for(let e=0;e<this.path[t].length;e++)r[t].push(this.path[t][e]);for(let n=0;n<e.path[t].length;n++)if(r[t].find(r=>r.offset===e.path[t][n].offset)===void 0)r[t].push(e.path[t][n]);else if(e.path[t][n]?.txid!==void 0&&e.path[t][n]?.txid!==null){let i=r[t].find(r=>r.offset===e.path[t][n].offset);i!=null&&(i.txid=!0)}}this.path=r,this.trim()}trim(){let e=(e,t)=>{(t.length===0||t.slice(-1)[0]!==e)&&t.push(e)},t=(e,t)=>{for(let n=e.length;n>=0;n--){let r=this.path[t].findIndex(t=>t.offset===e[n]);r>=0&&this.path[t].splice(r,1)}},n=t=>{let n=[];for(let r of t)e(r>>1,n);return n},r=[],i=[];for(let e=0;e<this.path.length;e++)this.path[e].sort((e,t)=>e.offset-t.offset);for(let t=0;t<this.path[0].length;t++){let n=this.path[0][t];if(n.txid===!0)e(n.offset>>1,r);else{let r=n.offset%2==1,a=this.path[0][t+(r?-1:1)];(a.txid===void 0||a.txid===null||!a.txid)&&e(a.offset,i)}}t(i,0);for(let e=1;e<this.path.length;e++)i=r,r=n(r),t(i,e)}},sf=class e{_bumpIndex;_tx;_rawTx;_txid;inputTxids=[];isValid=void 0;get bumpIndex(){return this._bumpIndex}set bumpIndex(e){this._bumpIndex=e,this.updateInputTxids()}get hasProof(){return this._bumpIndex!==void 0}get isTxidOnly(){return this._txid!==void 0&&this._txid!==null&&this._rawTx==null&&this._tx==null}get txid(){if(this._txid!==void 0&&this._txid!==null&&this._txid!==``)return this._txid;if(this._tx!=null)return this._txid=this._tx.id(`hex`),this._txid;if(this._rawTx!=null)return this._txid=H(Qc(this._rawTx)),this._txid;throw Error(`Internal`)}get tx(){if(this._tx!=null)return this._tx;if(this._rawTx!=null)return this._tx=pf.fromBinary(this._rawTx),this._tx}get rawTx(){if(this._rawTx!=null)return this._rawTx;if(this._tx!=null)return this._rawTx=this._tx.toBinary(),this._rawTx}constructor(e,t){typeof e==`string`?this._txid=e:Array.isArray(e)?this._rawTx=e:this._tx=e,this.bumpIndex=t,this.updateInputTxids()}static fromTx(t,n){return new e(t,n)}static fromRawTx(t,n){return new e(t,n)}static fromTxid(t,n){return new e(t,n)}updateInputTxids(){if(this.hasProof||this.tx==null)this.inputTxids=[];else{let e={};for(let t of this.tx.inputs)t.sourceTXID!==void 0&&t.sourceTXID!==null&&t.sourceTXID!==``&&(e[t.sourceTXID]=!0);this.inputTxids=Object.keys(e)}}toWriter(e,t){let n=t=>{e.writeUInt8(t)},r=()=>{if(this._txid==null)throw Error(`Transaction ID (_txid) is undefined`);e.writeReverse(U(this._txid,`hex`))},i=()=>{if(this._rawTx!=null)e.write(this._rawTx);else if(this._tx!=null)e.write(this._tx.toBinary());else throw Error(`a valid serialized Transaction is expected`)};t===4022206466?this.isTxidOnly?(n(uf.TXID_ONLY),r()):this.bumpIndex===void 0?(n(uf.RAWTX),i()):(n(uf.RAWTX_AND_BUMP_INDEX),e.writeVarIntNum(this.bumpIndex),i()):(i(),this.bumpIndex===void 0?n(uf.RAWTX):(n(uf.RAWTX_AND_BUMP_INDEX),e.writeVarIntNum(this.bumpIndex)))}static fromReader(t,n){let r,i,a;if(n===4022206466){let n=t.readUInt8();n===uf.TXID_ONLY?a=e.fromTxid(H(t.readReverse(32))):(n===uf.RAWTX_AND_BUMP_INDEX&&(i=t.readVarIntNum()),r=pf.fromReader(t),a=e.fromTx(r,i))}else r=pf.fromReader(t),i=t.readUInt8()===0?void 0:t.readVarIntNum(),a=e.fromTx(r,i);return a}};const cf=4022206465,lf=4022206466;var uf;(function(e){e[e.RAWTX=0]=`RAWTX`,e[e.RAWTX_AND_BUMP_INDEX=1]=`RAWTX_AND_BUMP_INDEX`,e[e.TXID_ONLY=2]=`TXID_ONLY`})(uf||={});var df=class e{bumps=[];txs=[];version=lf;atomicTxid=void 0;txidIndex=void 0;constructor(e=lf){this.version=e}findTxid(e){return this.ensureTxidIndex().get(e)}ensureTxidIndex(){if(this.txidIndex==null){this.txidIndex=new Map;for(let e of this.txs)this.txidIndex.set(e.txid,e)}return this.txidIndex}deleteFromIndex(e){this.txidIndex?.delete(e)}addToIndex(e){this.txidIndex?.set(e.txid,e)}makeTxidOnly(e){let t=this.txs.findIndex(t=>t.txid===e);if(t===-1)return;let n=this.txs[t];return n.isTxidOnly?n:(this.deleteFromIndex(e),this.txs.splice(t,1),n=this.mergeTxidOnly(e),n)}findBump(e){return this.bumps.find(t=>t.path[0].some(t=>t.hash===e))}findTransactionForSigning(e){let t=this.findTxid(e);if(!(t==null||t.tx==null)){for(let e of t.tx.inputs)if(e.sourceTransaction==null){let t=this.findTxid(uu(e.sourceTXID,`sourceTXID must be valid`));t!=null&&(e.sourceTransaction=t.tx)}return t.tx}}findAtomicTransaction(e){let t=this.findTxid(e);if(t==null||t.tx==null)return;let n=(e,t)=>{let r=e.findBump(t.id(`hex`));if(r!=null)t.merklePath=r;else for(let r of t.inputs){if(r.sourceTransaction==null){let t=e.findTxid(uu(r.sourceTXID,`sourceTXID must be valid`));t!=null&&(r.sourceTransaction=t.tx)}if(r.sourceTransaction!=null){let t=e.findBump(r.sourceTransaction.id(`hex`));t==null?n(e,r.sourceTransaction):r.sourceTransaction.merklePath=t}}};return n(this,t.tx),t.tx}mergeBump(e){let t;for(let n=0;n<this.bumps.length;n++){let r=this.bumps[n];if(r===e)return n;if(r.blockHeight===e.blockHeight){let i=r.computeRoot(),a=e.computeRoot();if(i===a){r.combine(e),t=n;break}}}t===void 0&&(t=this.bumps.length,this.bumps.push(e));let n=this.bumps[t];for(let e of this.txs){let r=e.txid;if(e.bumpIndex==null){for(let i of n.path[0])if(i.hash===r){e.bumpIndex=t,i.txid=!0;break}}}return t}mergeRawTx(e,t){let n=new sf(e,t);return this.removeExistingTxid(n.txid),this.txs.push(n),this.addToIndex(n),this.tryToValidateBumpIndex(n),n}mergeTransaction(e){let t=e.id(`hex`);this.removeExistingTxid(t);let n;e.merklePath!=null&&(n=this.mergeBump(e.merklePath));let r=new sf(e,n);if(this.txs.push(r),this.addToIndex(r),this.tryToValidateBumpIndex(r),n=r.bumpIndex,n===void 0)for(let t of e.inputs)t.sourceTransaction!=null&&this.mergeTransaction(t.sourceTransaction);return r}removeExistingTxid(e){let t=this.txs.findIndex(t=>t.txid===e);t>=0&&(this.deleteFromIndex(e),this.txs.splice(t,1))}mergeTxidOnly(e){let t=this.findTxid(e);return t??(t=new sf(e),this.txs.push(t),this.addToIndex(t),this.tryToValidateBumpIndex(t)),t}mergeBeefTx(e){let t=this.findTxid(e.txid);if(e.isTxidOnly&&t==null?t=this.mergeTxidOnly(e.txid):e._tx!=null&&(t==null||t.isTxidOnly)?t=this.mergeTransaction(e._tx):e._rawTx!=null&&(t==null||t.isTxidOnly)&&(t=this.mergeRawTx(e._rawTx)),t==null)throw Error(`Failed to merge BeefTx for txid: ${e.txid}`);return t}mergeBeef(t){let n=Array.isArray(t)?e.fromBinary(t):t;for(let e of n.bumps)this.mergeBump(e);for(let e of n.txs)this.mergeBeefTx(e)}isValid(e){return this.verifyValid(e).valid}async verify(e,t){let n=this.verifyValid(t);if(!n.valid)return!1;for(let t of Object.keys(n.roots))if(!await e.isValidRootForHeight(n.roots[t],Number(t)))return!1;return!0}verifyValid(e){let t={valid:!1,roots:{}},n=this.sortTxs();if(n.missingInputs.length>0||n.notValid.length>0||n.txidOnly.length>0&&e!==!0||n.withMissingInputs.length>0)return t;let r={};for(let n of this.txs)if(n.isTxidOnly){if(e!==!0)return t;r[n.txid]=!0}let i=(e,n)=>{let r=e.computeRoot(n);return(t.roots[e.blockHeight]===void 0||t.roots[e.blockHeight]===``)&&(t.roots[e.blockHeight]=r),t.roots[e.blockHeight]===r};for(let e of this.bumps)for(let n of e.path[0])if(n.txid===!0&&typeof n.hash==`string`&&n.hash.length>0&&(r[n.hash]=!0,!i(e,n.hash)))return t;for(let e of this.txs)if(e.bumpIndex!==void 0&&this.bumps[e.bumpIndex].path[0].find(t=>t.hash===e.txid)==null)return t;for(let e of this.txs){for(let n of e.inputTxids)if(!r[n])return t;r[e.txid]=!0}return t.valid=!0,t}toWriter(e){e.writeUInt32LE(this.version),e.writeVarIntNum(this.bumps.length);for(let t of this.bumps)e.write(t.toBinary());e.writeVarIntNum(this.txs.length);for(let t of this.txs)t.toWriter(e,this.version)}toBinary(){this.sortTxs();let e=new au;return this.toWriter(e),e.toArray()}toBinaryAtomic(e){this.sortTxs();let t=this.findTxid(e);if(t==null)throw Error(`${e} does not exist in this Beef`);let n=this.txs[this.txs.length-1]===t?this:this.clone();if(n!==this){let t=this.txs.findIndex(t=>t.txid===e);n.txs.splice(t+1)}let r=new au;return r.writeUInt32LE(16843009),r.writeReverse(U(e,`hex`)),n.toWriter(r),r.toArray()}toHex(){return H(this.toBinary())}static fromReader(t){let n=t.readUInt32LE(),r;if(n===16843009&&(r=H(t.readReverse(32)),n=t.readUInt32LE()),n!==4022206465&&n!==4022206466)throw Error(`Serialized BEEF must start with ${cf} or ${lf} but starts with ${n}`);let i=new e(n),a=t.readVarIntNum();for(let e=0;e<a;e++){let e=af.fromReader(t,!1);i.bumps.push(e)}let o=t.readVarIntNum();for(let e=0;e<o;e++){let e=sf.fromReader(t,n);i.txs.push(e)}return i.atomicTxid=r,i}static fromBinary(t){let n=new ou(t);return e.fromReader(n)}static fromString(t,n=`hex`){let r=U(t,n),i=new ou(r);return e.fromReader(i)}tryToValidateBumpIndex(e){if(e.bumpIndex!==void 0)return!0;let t=e.txid;for(let n=0;n<this.bumps.length;n++){let r=this.bumps[n].path[0].findIndex(e=>e.hash===t);if(r>=0)return e.bumpIndex=n,this.bumps[n].path[0][r].txid=!0,!0}return!1}sortTxs(){let e={},t={},n=[],r=[],i=[];for(let a of this.txs)t[a.txid]=a,a.isValid=a.hasProof,a.isValid?(e[a.txid]=!0,r.push(a)):a.isTxidOnly&&a.inputTxids.length===0?(e[a.txid]=!0,i.push(a)):n.push(a);let a={},o=[],s=n;n=[];for(let e of s){let r=!1;for(let n of e.inputTxids)t[n]===void 0&&(a[n]=!0,r=!0);r?o.push(e):n.push(e)}for(;n.length>0;){let t=n;n=[];for(let i of t)i.inputTxids.every(t=>e[t])?(e[i.txid]=!0,r.push(i)):n.push(i);if(t.length===n.length)break}let c=n;return this.txs=o.concat(c).concat(i).concat(r),{missingInputs:Object.keys(a),notValid:c.map(e=>e.txid),valid:Object.keys(e),withMissingInputs:o.map(e=>e.txid),txidOnly:i.map(e=>e.txid)}}clone(){let t=new e;return t.version=this.version,t.bumps=Array.from(this.bumps),t.txs=Array.from(this.txs),t.txidIndex=void 0,t}trimKnownTxids(e){for(let t=0;t<this.txs.length;){let n=this.txs[t];n.isTxidOnly&&e.includes(n.txid)?(this.deleteFromIndex(n.txid),this.txs.splice(t,1)):t++}}getValidTxids(){return this.sortTxs().valid}toLogString(){let e=``;e+=`BEEF with ${this.bumps.length} BUMPS and ${this.txs.length} Transactions, isValid ${this.isValid().toString()}\n`;let t=-1;for(let n of this.bumps)t++,e+=`  BUMP ${t}\n    block: ${n.blockHeight}\n    txids: [\n${n.path[0].filter(e=>e.txid===!0).map(e=>`      '${e.hash??``}'`).join(`,
`)}\n    ]\n`;t=-1;for(let n of this.txs)t++,e+=`  TX ${t}\n    txid: ${n.txid}\n`,n.bumpIndex!==void 0&&(e+=`    bumpIndex: ${n.bumpIndex}\n`),n.isTxidOnly?e+=`    txidOnly
`:e+=`    rawTx length=${n.rawTx?.length??0}\n`,n.inputTxids.length>0&&(e+=`    inputs: [\n${n.inputTxids.map(e=>`      '${e}'`).join(`,
`)}\n    ]\n`);return e}addComputedLeaves(){let e=e=>H(Qc(U(e,`hex`).reverse()).reverse());for(let t of this.bumps)for(let n=1;n<t.path.length;n++)for(let r of t.path[n-1])if(typeof r.hash==`string`&&!(r.offset&1)){let i=t.path[n-1].find(e=>e.offset===r.offset+1),a=r.offset>>1;i!==void 0&&typeof i.hash==`string`&&t.path[n].every(e=>e.offset!==a)&&t.path[n].push({offset:a,hash:e(i.hash+r.hash)})}}},ff=df,pf=class e{version;inputs;outputs;lockTime;metadata;merklePath;cachedHash;static addPathOrInputs(e,t,n){if(typeof e.pathIndex==`number`){let t=n[e.pathIndex];if(typeof t!=`object`)throw Error(`Invalid merkle path index found in BEEF!`);e.tx.merklePath=t}else for(let r of e.tx.inputs){if(r.sourceTXID===void 0)throw Error(`Input sourceTXID is undefined`);let e=t[r.sourceTXID];if(typeof e!=`object`)throw Error(`Reference to unknown TXID in BEEF: ${r.sourceTXID??`undefined`}`);r.sourceTransaction=e.tx,this.addPathOrInputs(e,t,n)}}static fromBEEF(t,n){let{tx:r}=e.fromAnyBeef(t,n);return r}static fromAtomicBEEF(t){let{tx:n,txid:r,beef:i}=e.fromAnyBeef(t);if(r!==i.atomicTxid)throw i.atomicTxid==null?Error(`beef must conform to BRC-95 and must contain the subject txid.`):Error(`Transaction with TXID ${i.atomicTxid} not found in BEEF data.`);return n}static fromAnyBeef(e,t){let n=df.fromBinary(e);if(n.txs.length<1)throw Error(`beef must include at least one transaction.`);let r=t??n.atomicTxid??n.txs.slice(-1)[0].txid,i=n.findAtomicTransaction(r);if(i==null)throw t==null?Error(`beef does not contain transaction for atomic txid.`):Error(`Transaction with TXID ${r} not found in BEEF data.`);return{tx:i,beef:n,txid:r}}static fromEF(t){let n=new ou(t),r=n.readUInt32LE();if(H(n.read(6))!==`0000000000ef`)throw Error(`Invalid EF marker`);let i=n.readVarIntNum(),a=[];for(let t=0;t<i;t++){let t=H(n.readReverse(32)),r=n.readUInt32LE(),i=n.readVarIntNum(),o=n.read(i),s=Md.fromBinary(o),c=n.readUInt32LE(),l=n.readUInt64LEBn().toNumber(),u=n.readVarIntNum(),d=n.read(u),f=jd.fromBinary(d),p=new e(void 0,[],[],void 0);p.outputs=Array(r+1).fill(null),p.outputs[r]={satoshis:l,lockingScript:f},a.push({sourceTransaction:p,sourceTXID:t,sourceOutputIndex:r,unlockingScript:s,sequence:c})}let o=n.readVarIntNum(),s=[];for(let e=0;e<o;e++){let e=n.readUInt64LEBn().toNumber(),t=n.readVarIntNum(),r=n.read(t),i=jd.fromBinary(r);s.push({satoshis:e,lockingScript:i})}let c=n.readUInt32LE();return new e(r,a,s,c)}static parseScriptOffsets(e){let t=new ou(e),n=[],r=[];t.pos+=4;let i=t.readVarIntNum();for(let e=0;e<i;e++){t.pos+=36;let r=t.readVarIntNum();n.push({vin:e,offset:t.pos,length:r}),t.pos+=r+4}let a=t.readVarIntNum();for(let e=0;e<a;e++){t.pos+=8;let n=t.readVarIntNum();r.push({vout:e,offset:t.pos,length:n}),t.pos+=n}return{inputs:n,outputs:r}}static fromReader(t){let n=t.readUInt32LE(),r=t.readVarIntNum(),i=[];for(let e=0;e<r;e++){let e=H(t.readReverse(32)),n=t.readUInt32LE(),r=t.readVarIntNum(),a=t.read(r),o=Md.fromBinary(a),s=t.readUInt32LE();i.push({sourceTXID:e,sourceOutputIndex:n,unlockingScript:o,sequence:s})}let a=t.readVarIntNum(),o=[];for(let e=0;e<a;e++){let e=t.readUInt64LEBn().toNumber(),n=t.readVarIntNum(),r=t.read(n),i=jd.fromBinary(r);o.push({satoshis:e,lockingScript:i})}let s=t.readUInt32LE();return new e(n,i,o,s)}static fromBinary(t){let n=new ou(t);return e.fromReader(n)}static fromHex(t){return e.fromBinary(U(t,`hex`))}static fromHexEF(t){return e.fromEF(U(t,`hex`))}static fromHexBEEF(t,n){return e.fromBEEF(U(t,`hex`),n)}constructor(e=1,t=[],n=[],r=0,i=new Map,a){this.version=e,this.inputs=t,this.outputs=n,this.lockTime=r,this.metadata=i,this.merklePath=a}addInput(e){if(e.sourceTXID===void 0&&e.sourceTransaction===void 0)throw Error(`A reference to an an input transaction is required. If the input transaction itself cannot be referenced, its TXID must still be provided.`);e.sequence===void 0&&(e.sequence=4294967295),this.cachedHash=void 0,this.inputs.push(e)}addOutput(e){if(this.cachedHash=void 0,e.change!==!0){if(e.satoshis===void 0)throw Error(`either satoshis must be defined or change must be set to true`);if(e.satoshis<0)throw Error(`satoshis must be a positive integer or zero`)}if(e.lockingScript==null)throw Error(`lockingScript must be defined`);this.outputs.push(e)}addP2PKHOutput(e,t){let n=new Gd().lock(e);if(t===void 0)return this.addOutput({lockingScript:n,change:!0});this.addOutput({lockingScript:n,satoshis:t})}updateMetadata(e){this.metadata={...this.metadata,...e}}async fee(e=Yd.getInstance(),t=`equal`){if(this.cachedHash=void 0,typeof e==`number`){let t=e;e={computeFee:async()=>t}}let n=await e.computeFee(this),r=this.calculateChange(n);if(r<=0){this.outputs=this.outputs.filter(e=>e.change!==!0);return}this.distributeChange(r,t)}calculateChange(e){let t=0;for(let e of this.inputs){if(typeof e.sourceTransaction!=`object`)throw Error(`Source transactions are required for all inputs during fee computation`);t+=e.sourceTransaction.outputs[e.sourceOutputIndex].satoshis??0}t-=e;for(let e of this.outputs)e.change!==!0&&e.satoshis!==void 0&&(t-=e.satoshis);return t}distributeChange(e,t){let n=0,r=this.outputs.filter(e=>e.change);if(t===`random`?n=this.distributeRandomChange(e,r):t===`equal`&&(n=this.distributeEqualChange(e,r)),n<e){let t=this.outputs[this.outputs.length-1];t.satoshis===void 0?t.satoshis=e-n:t.satoshis+=e-n}}distributeRandomChange(e,t){let n=0,r=e,i=Array(t.length).fill(1);r-=t.length,n+=t.length;for(let e=0;e<t.length-1;e++){let t=this.benfordNumber(0,r);i[e]=i[e]+t,n+=t,r-=t}for(let e of this.outputs)e.change===!0&&(e.satoshis=i.shift());return n}distributeEqualChange(e,t){let n=0,r=Math.floor(e/t.length);for(let e of t)n+=r,e.satoshis=r;return n}benfordNumber(e,t){let n=Math.floor(Math.random()*9)+1;return Math.floor(e+(t-e)*Math.log10(1+1/n)/Math.log10(10))}getFee(){let e=0;for(let t of this.inputs){if(typeof t.sourceTransaction!=`object`)throw Error(`Source transactions or sourceSatoshis are required for all inputs to calculate fee`);e+=t.sourceTransaction.outputs[t.sourceOutputIndex].satoshis??0}let t=0;for(let e of this.outputs)t+=e.satoshis??0;return e-t}async sign(){this.cachedHash=void 0;for(let e of this.outputs)if(e.satoshis===void 0)throw e.change===!0?Error(`There are still change outputs with uncomputed amounts. Use the fee() method to compute the change amounts and transaction fees prior to signing.`):Error(`One or more transaction outputs is missing an amount. Ensure all output amounts are provided before signing.`);let e=await Promise.all(this.inputs.map(async(e,t)=>typeof this.inputs[t].unlockingScriptTemplate==`object`?await this.inputs[t]?.unlockingScriptTemplate?.sign(this,t):await Promise.resolve(void 0)));for(let t=0,n=this.inputs.length;t<n;t++)typeof this.inputs[t].unlockingScriptTemplate==`object`&&(this.inputs[t].unlockingScript=e[t])}async broadcast(e=tf()){return await e.broadcast(this)}toBinary(){let e=new au;e.writeUInt32LE(this.version),e.writeVarIntNum(this.inputs.length);for(let t of this.inputs){if(t.sourceTXID===void 0)if(t.sourceTransaction!=null)e.write(t.sourceTransaction.hash());else throw Error(`sourceTransaction is undefined`);else e.writeReverse(U(t.sourceTXID,`hex`));if(e.writeUInt32LE(t.sourceOutputIndex),t.unlockingScript==null)throw Error(`unlockingScript is undefined`);let n=t.unlockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n),e.writeUInt32LE(t.sequence??4294967295)}e.writeVarIntNum(this.outputs.length);for(let t of this.outputs){e.writeUInt64LE(t.satoshis??0);let n=t.lockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n)}return e.writeUInt32LE(this.lockTime),e.toArray()}toEF(){let e=new au;e.writeUInt32LE(this.version),e.write([0,0,0,0,0,239]),e.writeVarIntNum(this.inputs.length);for(let t of this.inputs){if(t.sourceTransaction===void 0)throw Error(`All inputs must have source transactions when serializing to EF format`);if(t.sourceTXID===void 0?e.write(t.sourceTransaction.hash()):e.write(U(t.sourceTXID,`hex`).reverse()),e.writeUInt32LE(t.sourceOutputIndex),t.unlockingScript==null)throw Error(`unlockingScript is undefined`);let n=t.unlockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n),e.writeUInt32LE(t.sequence??4294967295),e.writeUInt64LE(t.sourceTransaction.outputs[t.sourceOutputIndex].satoshis??0);let r=t.sourceTransaction.outputs[t.sourceOutputIndex].lockingScript.toBinary();e.writeVarIntNum(r.length),e.write(r)}e.writeVarIntNum(this.outputs.length);for(let t of this.outputs){e.writeUInt64LE(t.satoshis??0);let n=t.lockingScript.toBinary();e.writeVarIntNum(n.length),e.write(n)}return e.writeUInt32LE(this.lockTime),e.toArray()}toHexEF(){return H(this.toEF())}toHex(){return H(this.toBinary())}toHexBEEF(){return H(this.toBEEF())}toHexAtomicBEEF(){return H(this.toAtomicBEEF())}hash(e){let t;return this.cachedHash==null?(t=Qc(this.toBinary()),this.cachedHash=t):t=this.cachedHash,e===`hex`?H(t):t}id(e){let t=[...this.hash()];return t.reverse(),e===`hex`?H(t):t}async verify(t=rf(),n,r){let i=new Set,a=[this];for(;a.length>0;){let o=a.shift(),s=o?.id(`hex`)??``;if(s!=null&&s!==``&&i.has(s))continue;if(typeof o?.merklePath==`object`)if(t===`scripts only`){s!=null&&i.add(s);continue}else if(await o.merklePath.verify(s,t)){i.add(s);continue}else throw Error(`Invalid merkle path for transaction ${s}`);if(n!==void 0){if(o===void 0)throw Error(`Transaction is undefined`);let t=e.fromEF(o.toEF());if(delete t.outputs[0].satoshis,t.outputs[0].change=!0,await t.fee(n),o.getFee()<t.getFee())throw Error(`Verification failed because the transaction ${s} has an insufficient fee and has not been mined.`)}let c=0;if(o===void 0)throw Error(`Transaction is undefined`);for(let e=0;e<o.inputs.length;e++){let t=o.inputs[e];if(typeof t.sourceTransaction!=`object`)throw Error(`Verification failed because the input at index ${e} of transaction ${s} is missing an associated source transaction. This source transaction is required for transaction verification because there is no merkle proof for the transaction spending a UTXO it contains.`);if(typeof t.unlockingScript!=`object`)throw Error(`Verification failed because the input at index ${e} of transaction ${s} is missing an associated unlocking script. This script is required for transaction verification because there is no merkle proof for the transaction spending the UTXO.`);let n=t.sourceTransaction.outputs[t.sourceOutputIndex];c+=n.satoshis??0;let l=t.sourceTransaction.id(`hex`);i.has(l)||a.push(t.sourceTransaction);let u=o.inputs.filter((t,n)=>n!==e);if(t.sourceTXID===void 0&&(t.sourceTXID=l),!new Wd({sourceTXID:t.sourceTXID,sourceOutputIndex:t.sourceOutputIndex,lockingScript:n.lockingScript,sourceSatoshis:n.satoshis??0,transactionVersion:o.version,otherInputs:u,unlockingScript:t.unlockingScript,inputSequence:t.sequence??4294967295,inputIndex:e,outputs:o.outputs,lockTime:o.lockTime,memoryLimit:r}).validate())return!1}let l=0;for(let e of o.outputs){if(typeof e.satoshis!=`number`)throw Error(`Every output must have a defined amount during transaction verification.`);l+=e.satoshis}if(l>c)return!1;i.add(s)}return!0}toBEEF(e){let t=new au;t.writeUInt32LE(cf);let n=[],r=new Map,i=new Map,a=[],o=new Set,s=e=>{let t=r.get(e);if(t!==void 0)return t;let a=`${e.blockHeight}:${e.computeRoot()}`,o=i.get(a);if(o!==void 0)return n[o].combine(e),r.set(e,o),o;let s=n.length;return n.push(e),r.set(e,s),i.set(a,s),s},c=t=>{let n=t.id(`hex`);if(o.has(n))return;let r={tx:t},i=t.merklePath,l=typeof i==`object`;if(l&&i!=null&&(r.pathIndex=s(i)),!l)for(let n=t.inputs.length-1;n>=0;n--){let r=t.inputs[n];if(typeof r.sourceTransaction==`object`)c(r.sourceTransaction);else if(e===!1)throw Error(`A required source transaction is missing!`)}o.add(n),a.push(r)};c(this),t.writeVarIntNum(n.length);for(let e of n)t.write(e.toBinary());t.writeVarIntNum(a.length);for(let e of a)t.write(e.tx.toBinary()),typeof e.pathIndex==`number`?(t.writeUInt8(1),t.writeVarIntNum(e.pathIndex)):t.writeUInt8(0);return t.toArray()}toAtomicBEEF(e){let t=new au;t.writeUInt32LE(16843009),t.write(this.hash());let n=this.toBEEF(e);return t.write(n),t.toArray()}};function mf(e){this._tables[0][0][0]===0&&this._precompute();let t,n,r,i=this._tables[0][4],a=this._tables[1],o=e.length,s=1;if(o!==4&&o!==6&&o!==8)throw Error(`invalid aes key size`);this._key=[n=e.slice(0),r=[]];let c;for(c=o;c<4*o+28;c++)t=n[c-1],(c%o===0||o===8&&c%o===4)&&(t=i[t>>>24]<<24^i[t>>16&255]<<16^i[t>>8&255]<<8^i[t&255],c%o===0&&(t=t<<8^t>>>24^s<<24,s=s<<1^(s>>7)*283)),n[c]=n[c-o]^t;for(let e=0;c>0;e++,c--)t=n[e&3?c:c-4],c<=4||e<4?r[e]=t:r[e]=a[0][i[t>>>24]]^a[1][i[t>>16&255]]^a[2][i[t>>8&255]]^a[3][i[t&255]]}mf.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]],_precompute:function(){let e=this._tables[0],t=this._tables[1],n=e[4],r=t[4],i,a,o,s=new Uint8Array(256),c=new Uint8Array(256),l,u,d,f,p,m;for(i=0;i<256;i++)c[(s[i]=i<<1^(i>>7)*283)^i]=i;for(a=o=0;n[a]===0;a^=l===0?1:l,o=c[o]===0?1:c[o])for(f=o^o<<1^o<<2^o<<3^o<<4,f=f>>8^f&255^99,n[a]=f,r[f]=a,d=s[u=s[l=s[a]]],m=d*16843009^u*65537^l*257^a*16843008,p=s[f]*257^f*16843008,i=0;i<4;i++)e[i][a]=p=p<<24^p>>>8,t[i][f]=m=m<<24^m>>>8},_crypt:function(e,t){if(e.length!==4)throw Error(`invalid aes block size`);let n=this._key[t],r=e[0]^n[0],i=e[t===1?3:1]^n[1],a=e[2]^n[2],o=e[t===1?1:3]^n[3],s,c,l,u=n.length/4-2,d,f=4,p=new Uint32Array(4),m=this._tables[t],h=m[0],g=m[1],_=m[2],v=m[3],y=m[4];for(d=0;d<u;d++)s=h[r>>>24]^g[i>>16&255]^_[a>>8&255]^v[o&255]^n[f],c=h[i>>>24]^g[a>>16&255]^_[o>>8&255]^v[r&255]^n[f+1],l=h[a>>>24]^g[o>>16&255]^_[r>>8&255]^v[i&255]^n[f+2],o=h[o>>>24]^g[r>>16&255]^_[i>>8&255]^v[a&255]^n[f+3],f+=4,r=s,i=c,a=l;for(d=0;d<4;d++)p[t===1?3&-d:d]=y[r>>>24]<<24^y[i>>16&255]<<16^y[a>>8&255]<<8^y[o&255]^n[f++],s=r,r=i,i=a,a=o,o=s;return p}};var hf;(function(e){e[e.Silent=0]=`Silent`,e[e.App=1]=`App`,e[e.Counterparty=2]=`Counterparty`})(hf||={});var gf=class{cacheSharedSecret;retrieveCachedSharedSecret;rootKey;identityKey;anyone;constructor(e,t,n){this.cacheSharedSecret=t,this.retrieveCachedSharedSecret=n,this.anyone=new nd(1).toPublicKey(),e===`anyone`?this.rootKey=new nd(1):this.rootKey=e,this.identityKey=this.rootKey.toPublicKey().toString()}derivePublicKey(e,t,n,r=!1){return n=this.normalizeCounterparty(n),r?this.rootKey.deriveChild(n,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret).toPublicKey():n.deriveChild(this.rootKey,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}derivePrivateKey(e,t,n){return n=this.normalizeCounterparty(n),this.rootKey.deriveChild(n,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}deriveSymmetricKey(e,t,n){n=n===`anyone`?this.anyone:this.normalizeCounterparty(n);let r=this.derivePublicKey(e,t,n),i=this.derivePrivateKey(e,t,n);return new Ed(i.deriveSharedSecret(r)?.x?.toArray()??[])}revealCounterpartySecret(e){if(e===`self`)throw Error(`Counterparty secrets cannot be revealed for counterparty=self.`);e=this.normalizeCounterparty(e);let t=this.rootKey.toPublicKey(),n=this.rootKey.deriveChild(t,`test`).toHex(),r=this.rootKey.deriveChild(e,`test`).toHex();if(n===r)throw Error(`Counterparty secrets cannot be revealed for counterparty=self.`);return this.rootKey.deriveSharedSecret(e).encode(!0)}revealSpecificSecret(e,t,n){e=this.normalizeCounterparty(e);let r=this.rootKey.deriveSharedSecret(e),i=U(this.computeInvoiceNumber(t,n),`utf8`);return el(r.encode(!0),i)}normalizeCounterparty(e){if(e==null)throw Error(`counterparty must be self, anyone or a public key!`);return e===`self`?this.rootKey.toPublicKey():e===`anyone`?new nd(1).toPublicKey():typeof e==`string`?Yu.fromString(e):e}computeInvoiceNumber(e,t){let n=e[0];if(!Number.isInteger(n)||n<0||n>2)throw Error(`Protocol security level must be 0, 1, or 2`);let r=e[1].toLowerCase().trim();if(t.length>800)throw Error(`Key IDs must be 800 characters or less`);if(t.length<1)throw Error(`Key IDs must be 1 character or more`);if(r.length>400)if(r.startsWith(`specific linkage revelation `)){if(r.length>430)throw Error(`Specific linkage revelation protocol names must be 430 characters or less`)}else throw Error(`Protocol names must be 400 characters or less`);if(r.length<5)throw Error(`Protocol names must be 5 characters or more`);if(r.includes(`  `))throw Error(`Protocol names cannot contain multiple consecutive spaces ("  ")`);if(!/^[a-z0-9 ]+$/g.test(r))throw Error(`Protocol names can only contain letters, numbers and spaces`);if(r.endsWith(` protocol`))throw Error(`No need to end your protocol name with " protocol"`);return`${n}-${r}-${t}`}},_f=class{keyDeriver;cache;maxCacheSize;rootKey;identityKey;constructor(e,t){e===`anyone`?this.rootKey=new nd(1):this.rootKey=e,this.keyDeriver=new gf(this.rootKey,(e,t,n)=>{this.cacheSet(`${e.toString()}-${t.toString()}`,n)},(e,t)=>this.cacheGet(`${e.toString()}-${t.toString()}`)),this.identityKey=this.rootKey.toPublicKey().toString(),this.cache=new Map;let n=t?.maxCacheSize;this.maxCacheSize=n!=null&&!isNaN(n)&&n>0?n:1e3}derivePublicKey(e,t,n,r=!1){let i=this.generateCacheKey(`derivePublicKey`,e,t,n,r);if(this.cache.has(i)){let e=this.cacheGet(i);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let a=this.keyDeriver.derivePublicKey(e,t,n,r);return this.cacheSet(i,a),a}}derivePrivateKey(e,t,n){let r=this.generateCacheKey(`derivePrivateKey`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.derivePrivateKey(e,t,n);return this.cacheSet(r,i),i}}deriveSymmetricKey(e,t,n){let r=this.generateCacheKey(`deriveSymmetricKey`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.deriveSymmetricKey(e,t,n);return this.cacheSet(r,i),i}}revealCounterpartySecret(e){let t=this.generateCacheKey(`revealCounterpartySecret`,e);if(this.cache.has(t)){let e=this.cacheGet(t);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let n=this.keyDeriver.revealCounterpartySecret(e);return this.cacheSet(t,n),n}}revealSpecificSecret(e,t,n){let r=this.generateCacheKey(`revealSpecificSecret`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.revealSpecificSecret(e,t,n);return this.cacheSet(r,i),i}}generateCacheKey(e,...t){let n=t.map(e=>this.serializeArgument(e)).join(`|`);return`${e}|${n}`}serializeArgument(e){return e instanceof Yu||e instanceof nd?e.toString():Array.isArray(e)?e.map(e=>this.serializeArgument(e)).join(`,`):typeof e==`object`&&e?JSON.stringify(e):String(e)}cacheGet(e){let t=this.cache.get(e);return this.cache.delete(e),t!==void 0&&this.cache.set(e,t),t}cacheSet(e,t){if(this.cache.size>=this.maxCacheSize){let e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}},vf=class{keyDeriver;constructor(e){typeof e.identityKey!=`string`&&(e=new _f(e)),this.keyDeriver=e}async getPublicKey(e){if(e.identityKey){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}else{if(e.protocolID==null||e.keyID==null||e.keyID===``)throw Error(`protocolID and keyID are required if identityKey is false or undefined.`);return{publicKey:(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePublicKey(e.protocolID,e.keyID,e.counterparty??`self`,e.forSelf).toString()}}}async revealCounterpartyKeyLinkage(e){let{publicKey:t}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let n=this.keyDeriver.revealCounterpartySecret(e.counterparty),r=new Od().generateProof(this.keyDeriver.rootKey,this.keyDeriver.rootKey.toPublicKey(),Yu.fromString(e.counterparty),Lu.fromDER(n)),i=[...r.R.encode(!0),...r.SPrime.encode(!0),...r.z.toArray()],a=new Date().toISOString(),{ciphertext:o}=await this.encrypt({plaintext:n,protocolID:[2,`counterparty linkage revelation`],keyID:a,counterparty:e.verifier}),{ciphertext:s}=await this.encrypt({plaintext:i,protocolID:[2,`counterparty linkage revelation`],keyID:a,counterparty:e.verifier});return{prover:t,verifier:e.verifier,counterparty:e.counterparty,revelationTime:a,encryptedLinkage:o,encryptedLinkageProof:s}}async revealSpecificKeyLinkage(e){let{publicKey:t}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let n=this.keyDeriver.revealSpecificSecret(e.counterparty,e.protocolID,e.keyID),{ciphertext:r}=await this.encrypt({plaintext:n,protocolID:[2,`specific linkage revelation ${e.protocolID[0]} ${e.protocolID[1]}`],keyID:e.keyID,counterparty:e.verifier}),{ciphertext:i}=await this.encrypt({plaintext:[0],protocolID:[2,`specific linkage revelation ${e.protocolID[0]} ${e.protocolID[1]}`],keyID:e.keyID,counterparty:e.verifier});return{prover:t,verifier:e.verifier,counterparty:e.counterparty,protocolID:e.protocolID,keyID:e.keyID,encryptedLinkage:r,encryptedLinkageProof:i,proofType:0}}async encrypt(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{ciphertext:this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`).encrypt(e.plaintext)}}async decrypt(e,t){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{plaintext:this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`).decrypt(e.ciphertext)}}async createHmac(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let t=this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`);return{hmac:el(t.toArray(),e.data)}}async verifyHmac(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let t=this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`),n=el(t.toArray(),e.data).toString()===e.hmac.toString();if(!n){let e=Error(`HMAC is not valid`);throw e.code=`ERR_INVALID_HMAC`,e}return{valid:n}}async createSignature(e){if(e.hashToDirectlySign==null&&e.data==null)throw Error(`args.data or args.hashToDirectlySign must be valid`);let t=e.hashToDirectlySign??Zc(e.data??[]),n=(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePrivateKey(e.protocolID,e.keyID,e.counterparty??`anyone`);return{signature:qu(new B(t),n,!0).toDER()}}async verifySignature(e){if(e.hashToDirectlyVerify==null&&e.data==null)throw Error(`args.data or args.hashToDirectlyVerify must be valid`);let t=e.hashToDirectlyVerify??Zc(e.data??[]),n=(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePublicKey(e.protocolID,e.keyID,e.counterparty??`self`,e.forSelf),r=Ju(new B(t),Bu.fromDER(e.signature),n);if(!r){let e=Error(`Signature is not valid`);throw e.code=`ERR_INVALID_SIGNATURE`,e}return{valid:r}}},yf=class{CWI;constructor(){if(typeof window!=`object`)throw Error(`The window.CWI substrate requires a global window object.`);if(typeof window.CWI!=`object`)throw Error(`The window.CWI interface does not appear to be bound to the window object.`);this.CWI=window.CWI}async createAction(e,t){return await this.CWI.createAction(e,t)}async signAction(e,t){return await this.CWI.signAction(e,t)}async abortAction(e,t){return await this.CWI.abortAction(e,t)}async listActions(e,t){return await this.CWI.listActions(e,t)}async internalizeAction(e,t){return await this.CWI.internalizeAction(e,t)}async listOutputs(e,t){return await this.CWI.listOutputs(e,t)}async relinquishOutput(e,t){return await this.CWI.relinquishOutput(e,t)}async getPublicKey(e,t){return await this.CWI.getPublicKey(e,t)}async revealCounterpartyKeyLinkage(e,t){return await this.CWI.revealCounterpartyKeyLinkage(e,t)}async revealSpecificKeyLinkage(e,t){return await this.CWI.revealSpecificKeyLinkage(e,t)}async encrypt(e,t){return await this.CWI.encrypt(e,t)}async decrypt(e,t){return await this.CWI.decrypt(e,t)}async createHmac(e,t){return await this.CWI.createHmac(e,t)}async verifyHmac(e,t){return await this.CWI.verifyHmac(e,t)}async createSignature(e,t){return await this.CWI.createSignature(e,t)}async verifySignature(e,t){return await this.CWI.verifySignature(e,t)}async acquireCertificate(e,t){return await this.CWI.acquireCertificate(e,t)}async listCertificates(e,t){return await this.CWI.listCertificates(e,t)}async proveCertificate(e,t){return await this.CWI.proveCertificate(e,t)}async relinquishCertificate(e,t){return await this.CWI.relinquishCertificate(e,t)}async discoverByIdentityKey(e,t){return await this.CWI.discoverByIdentityKey(e,t)}async discoverByAttributes(e,t){return await this.CWI.discoverByAttributes(e,t)}async isAuthenticated(e,t){return await this.CWI.isAuthenticated(e,t)}async waitForAuthentication(e,t){return await this.CWI.waitForAuthentication(e,t)}async getHeight(e,t){return await this.CWI.getHeight(e,t)}async getHeaderForHeight(e,t){return await this.CWI.getHeaderForHeight(e,t)}async getNetwork(e,t){return await this.CWI.getNetwork(e,t)}async getVersion(e,t){return await this.CWI.getVersion(e,t)}},bf=class extends Error{code;isError=!0;constructor(e,t=1,n){super(e),this.code=t,this.name=this.constructor.name,n!=null&&n!==``?this.stack=n:Error.captureStackTrace(this,this.constructor)}static unknownToJson(e){let t;return typeof e.constructor.name==`string`&&String(e.constructor.name).startsWith(`WERR_`)?(t={name:e.constructor.name,message:e.message,isError:!0},t.name===`WERR_REVIEW_ACTIONS`?(t.reviewActionResults=e.reviewActionResults,t.sendWithResults=e.sendWithResults,t.txid=e.txid,t.tx=e.tx,t.noSendChange=e.noSendChange,t.code=5):t.name===`WERR_INVALID_PARAMETER`?(t.parameter=e.parameter,t.code=6):t.name===`WERR_INSUFFICIENT_FUNDS`&&(t.totalSatoshisNeeded=e.totalSatoshisNeeded,t.moreSatoshisNeeded=e.moreSatoshisNeeded,t.code=7)):t=e instanceof Error?{name:e.constructor.name,message:e.message,isError:!0}:{name:`WERR_UNKNOWN`,message:String(e),isError:!0},JSON.stringify(t)}},xf;(function(e){e[e.unknownError=1]=`unknownError`,e[e.unsupportedAction=2]=`unsupportedAction`,e[e.invalidHmac=3]=`invalidHmac`,e[e.invalidSignature=4]=`invalidSignature`,e[e.reviewActions=5]=`reviewActions`,e[e.invalidParameter=6]=`invalidParameter`,e[e.insufficientFunds=7]=`insufficientFunds`})(xf||={});var Sf=class{domain;constructor(e=`*`){if(typeof window!=`object`)throw Error(`The XDM substrate requires a global window object.`);if(typeof window.postMessage!=`function`)throw Error(`The window object does not seem to support postMessage calls.`);this.domain=e}async invoke(e,t){return await new Promise((n,r)=>{let i=$l(Qu(12)),a=e=>{if(!(e.data.type!==`CWI`||!e.isTrusted||e.data.id!==i||e.data.isInvocation===!0))if(typeof window.removeEventListener==`function`&&window.removeEventListener(`message`,a),e.data.status===`error`){let t=new bf(e.data.description,e.data.code);r(t)}else n(e.data.result)};window.addEventListener(`message`,a),window.parent.postMessage({type:`CWI`,isInvocation:!0,id:i,call:e,args:t},this.domain)})}async createAction(e){return await this.invoke(`createAction`,e)}async signAction(e){return await this.invoke(`signAction`,e)}async abortAction(e){return await this.invoke(`abortAction`,e)}async listActions(e){return await this.invoke(`listActions`,e)}async internalizeAction(e){return await this.invoke(`internalizeAction`,e)}async listOutputs(e){return await this.invoke(`listOutputs`,e)}async relinquishOutput(e){return await this.invoke(`relinquishOutput`,e)}async getPublicKey(e){return await this.invoke(`getPublicKey`,e)}async revealCounterpartyKeyLinkage(e){return await this.invoke(`revealCounterpartyKeyLinkage`,e)}async revealSpecificKeyLinkage(e){return await this.invoke(`revealSpecificKeyLinkage`,e)}async encrypt(e){return await this.invoke(`encrypt`,e)}async decrypt(e){return await this.invoke(`decrypt`,e)}async createHmac(e){return await this.invoke(`createHmac`,e)}async verifyHmac(e){return await this.invoke(`verifyHmac`,e)}async createSignature(e){return await this.invoke(`createSignature`,e)}async verifySignature(e){return await this.invoke(`verifySignature`,e)}async acquireCertificate(e){return await this.invoke(`acquireCertificate`,e)}async listCertificates(e){return await this.invoke(`listCertificates`,e)}async proveCertificate(e){return await this.invoke(`proveCertificate`,e)}async relinquishCertificate(e){return await this.invoke(`relinquishCertificate`,e)}async discoverByIdentityKey(e){return await this.invoke(`discoverByIdentityKey`,e)}async discoverByAttributes(e){return await this.invoke(`discoverByAttributes`,e)}async isAuthenticated(e){return await this.invoke(`isAuthenticated`,e)}async waitForAuthentication(e){return await this.invoke(`waitForAuthentication`,e)}async getHeight(e){return await this.invoke(`getHeight`,e)}async getHeaderForHeight(e){return await this.invoke(`getHeaderForHeight`,e)}async getNetwork(e){return await this.invoke(`getNetwork`,e)}async getVersion(e){return await this.invoke(`getVersion`,e)}},Cf=class e{type;serialNumber;subject;certifier;revocationOutpoint;fields;signature;constructor(e,t,n,r,i,a,o){this.type=e,this.serialNumber=t,this.subject=n,this.certifier=r,this.revocationOutpoint=i,this.fields=a,this.signature=o}toBinary(e=!0){let t=new au,n=U(this.type,`base64`);t.write(n);let r=U(this.serialNumber,`base64`);t.write(r);let i=U(this.subject,`hex`);t.write(i);let a=U(this.certifier,`hex`);t.write(a);let[o,s]=this.revocationOutpoint.split(`.`),c=U(o,`hex`);t.write(c),t.writeVarIntNum(Number(s));let l=Object.keys(this.fields).sort();t.writeVarIntNum(l.length);for(let e of l){let n=this.fields[e],r=U(e,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=U(n,`utf8`);t.writeVarIntNum(i.length),t.write(i)}if(e&&(this.signature??``).length>0){let e=U(this.signature,`hex`);t.write(e)}return t.toArray()}static fromBinary(t){let n=new ou(t),r=n.read(32),i=$l(r),a=n.read(32),o=$l(a),s=n.read(33),c=H(s),l=n.read(33),u=H(l),d=n.read(32),f=H(d),p=n.readVarIntNum(),m=`${f}.${p}`,h=n.readVarIntNum(),g={};for(let e=0;e<h;e++){let e=n.readVarIntNum(),t=n.read(e),r=W(t),i=n.readVarIntNum(),a=n.read(i);g[r]=W(a)}let _;if(!n.eof()){let e=n.read();_=Bu.fromDER(e).toString(`hex`)}return new e(i,o,c,u,m,g,_)}async verify(){let e=new vf(`anyone`),t=this.toBinary(!1),n=this.signature??``,{valid:r}=await e.verifySignature({signature:U(n,`hex`),data:t,protocolID:[2,`certificate signature`],keyID:`${this.type} ${this.serialNumber}`,counterparty:this.certifier});return r}async sign(e){if(this.signature!=null&&this.signature.length>0)throw Error(`Certificate has already been signed! Signature present: ${this.signature}`);this.certifier=(await e.getPublicKey({identityKey:!0})).publicKey;let t=this.toBinary(!1),{signature:n}=await e.createSignature({data:t,protocolID:[2,`certificate signature`],keyID:`${this.type} ${this.serialNumber}`});this.signature=H(n)}static getCertificateFieldEncryptionDetails(e,t){return{protocolID:[2,`certificate field encryption`],keyID:t?`${t} ${e}`:e}}},wf;(function(e){e[e.createAction=1]=`createAction`,e[e.signAction=2]=`signAction`,e[e.abortAction=3]=`abortAction`,e[e.listActions=4]=`listActions`,e[e.internalizeAction=5]=`internalizeAction`,e[e.listOutputs=6]=`listOutputs`,e[e.relinquishOutput=7]=`relinquishOutput`,e[e.getPublicKey=8]=`getPublicKey`,e[e.revealCounterpartyKeyLinkage=9]=`revealCounterpartyKeyLinkage`,e[e.revealSpecificKeyLinkage=10]=`revealSpecificKeyLinkage`,e[e.encrypt=11]=`encrypt`,e[e.decrypt=12]=`decrypt`,e[e.createHmac=13]=`createHmac`,e[e.verifyHmac=14]=`verifyHmac`,e[e.createSignature=15]=`createSignature`,e[e.verifySignature=16]=`verifySignature`,e[e.acquireCertificate=17]=`acquireCertificate`,e[e.listCertificates=18]=`listCertificates`,e[e.proveCertificate=19]=`proveCertificate`,e[e.relinquishCertificate=20]=`relinquishCertificate`,e[e.discoverByIdentityKey=21]=`discoverByIdentityKey`,e[e.discoverByAttributes=22]=`discoverByAttributes`,e[e.isAuthenticated=23]=`isAuthenticated`,e[e.waitForAuthentication=24]=`waitForAuthentication`,e[e.getHeight=25]=`getHeight`,e[e.getHeaderForHeight=26]=`getHeaderForHeight`,e[e.getNetwork=27]=`getNetwork`,e[e.getVersion=28]=`getVersion`})(wf||={});var Tf=wf,Ef=class{wire;constructor(e){this.wire=e}async transmit(e,t=``,n=[]){let r=new au;r.writeUInt8(Tf[e]);let i=U(t,`utf8`);r.writeUInt8(i.length),r.write(i),n.length>0&&r.write(n);let a=r.toArray(),o=await this.wire.transmitToWallet(a),s=new ou(o),c=s.readUInt8();if(c===0)return s.read();{let e=s.readVarIntNum(),t=s.read(e),n=W(t),r=s.readVarIntNum(),i=s.read(r),a=W(i);throw new bf(n,c,a)}}async createAction(e,t){let n=new au,r=U(e.description,`utf8`);if(n.writeVarIntNum(r.length),n.write(r),e.inputBEEF==null?n.writeVarIntNum(-1):(n.writeVarIntNum(e.inputBEEF.length),n.write(e.inputBEEF)),e.inputs!=null){n.writeVarIntNum(e.inputs.length);for(let t of e.inputs){if(n.write(this.encodeOutpoint(t.outpoint)),t.unlockingScript!=null&&t.unlockingScript!==``){let e=U(t.unlockingScript,`hex`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1),n.writeVarIntNum(t.unlockingScriptLength??0);let e=U(t.inputDescription,`utf8`);n.writeVarIntNum(e.length),n.write(e),typeof t.sequenceNumber==`number`?n.writeVarIntNum(t.sequenceNumber):n.writeVarIntNum(-1)}}else n.writeVarIntNum(-1);if(e.outputs!=null){n.writeVarIntNum(e.outputs.length);for(let t of e.outputs){let e=U(t.lockingScript,`hex`);n.writeVarIntNum(e.length),n.write(e),n.writeVarIntNum(t.satoshis);let r=U(t.outputDescription,`utf8`);if(n.writeVarIntNum(r.length),n.write(r),t.basket!=null&&t.basket!==``){let e=U(t.basket,`utf8`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1);if(t.customInstructions!=null&&t.customInstructions!==``){let e=U(t.customInstructions,`utf8`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1);if(t.tags!=null){n.writeVarIntNum(t.tags.length);for(let e of t.tags){let t=U(e,`utf8`);n.writeVarIntNum(t.length),n.write(t)}}else n.writeVarIntNum(-1)}}else n.writeVarIntNum(-1);if(typeof e.lockTime==`number`?n.writeVarIntNum(e.lockTime):n.writeVarIntNum(-1),typeof e.version==`number`?n.writeVarIntNum(e.version):n.writeVarIntNum(-1),e.labels!=null){n.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=U(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}}else n.writeVarIntNum(-1);if(e.options!=null){if(n.writeInt8(1),typeof e.options.signAndProcess==`boolean`?n.writeInt8(e.options.signAndProcess?1:0):n.writeInt8(-1),typeof e.options.acceptDelayedBroadcast==`boolean`?n.writeInt8(e.options.acceptDelayedBroadcast?1:0):n.writeInt8(-1),e.options.trustSelf===`known`?n.writeInt8(1):n.writeInt8(-1),e.options.knownTxids!=null){n.writeVarIntNum(e.options.knownTxids.length);for(let t of e.options.knownTxids){let e=U(t,`hex`);n.write(e)}}else n.writeVarIntNum(-1);if(typeof e.options.returnTXIDOnly==`boolean`?n.writeInt8(e.options.returnTXIDOnly?1:0):n.writeInt8(-1),typeof e.options.noSend==`boolean`?n.writeInt8(e.options.noSend?1:0):n.writeInt8(-1),e.options.noSendChange!=null){n.writeVarIntNum(e.options.noSendChange.length);for(let t of e.options.noSendChange)n.write(this.encodeOutpoint(t))}else n.writeVarIntNum(-1);if(e.options.sendWith!=null){n.writeVarIntNum(e.options.sendWith.length);for(let t of e.options.sendWith){let e=U(t,`hex`);n.write(e)}}else n.writeVarIntNum(-1);typeof e.options.randomizeOutputs==`boolean`?n.writeInt8(e.options.randomizeOutputs?1:0):n.writeInt8(-1)}else n.writeInt8(0);let i=await this.transmit(`createAction`,t,n.toArray()),a=new ou(i),o={};if(a.readInt8()===1){let e=a.read(32);o.txid=H(e)}if(a.readInt8()===1){let e=a.readVarIntNum();o.tx=a.read(e)}let s=a.readVarIntNum();if(s>=0){o.noSendChange=[];for(let e=0;e<s;e++){let e=this.readOutpoint(a);o.noSendChange.push(e)}}let c=a.readVarIntNum();if(c>=0){o.sendWithResults=[];for(let e=0;e<c;e++){let e=a.read(32),t=H(e),n=a.readInt8(),r=`unproven`;n===1?r=`unproven`:n===2?r=`sending`:n===3&&(r=`failed`),o.sendWithResults.push({txid:t,status:r})}}if(a.readInt8()===1){let e=a.readVarIntNum(),t=a.read(e),n=a.readVarIntNum(),r=a.read(n);o.signableTransaction={tx:t,reference:$l(r)}}return o}async signAction(e,t){let n=new au,r=Object.keys(e.spends);n.writeVarIntNum(r.length);for(let t of r){n.writeVarIntNum(Number(t));let r=e.spends[Number(t)],i=U(r.unlockingScript,`hex`);n.writeVarIntNum(i.length),n.write(i),typeof r.sequenceNumber==`number`?n.writeVarIntNum(r.sequenceNumber):n.writeVarIntNum(-1)}let i=U(e.reference,`base64`);if(n.writeVarIntNum(i.length),n.write(i),e.options!=null)if(n.writeInt8(1),typeof e.options.acceptDelayedBroadcast==`boolean`?n.writeInt8(e.options.acceptDelayedBroadcast?1:0):n.writeInt8(-1),typeof e.options.returnTXIDOnly==`boolean`?n.writeInt8(e.options.returnTXIDOnly?1:0):n.writeInt8(-1),typeof e.options.noSend==`boolean`?n.writeInt8(e.options.noSend?1:0):n.writeInt8(-1),e.options.sendWith!=null){n.writeVarIntNum(e.options.sendWith.length);for(let t of e.options.sendWith){let e=U(t,`hex`);n.write(e)}}else n.writeVarIntNum(-1);else n.writeInt8(0);let a=await this.transmit(`signAction`,t,n.toArray()),o=new ou(a),s={};if(o.readInt8()===1){let e=o.read(32);s.txid=H(e)}if(o.readInt8()===1){let e=o.readVarIntNum();s.tx=o.read(e)}let c=o.readVarIntNum();if(c>=0){s.sendWithResults=[];for(let e=0;e<c;e++){let e=o.read(32),t=H(e),n=o.readInt8(),r=`unproven`;n===1?r=`unproven`:n===2?r=`sending`:n===3&&(r=`failed`),s.sendWithResults.push({txid:t,status:r})}}return s}async abortAction(e,t){return await this.transmit(`abortAction`,t,U(e.reference,`base64`)),{aborted:!0}}async listActions(e,t){let n=new au;n.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=U(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}e.labelQueryMode===`any`?n.writeInt8(1):e.labelQueryMode===`all`?n.writeInt8(2):n.writeInt8(-1);let r=[e.includeLabels,e.includeInputs,e.includeInputSourceLockingScripts,e.includeInputUnlockingScripts,e.includeOutputs,e.includeOutputLockingScripts];for(let e of r)typeof e==`boolean`?n.writeInt8(e?1:0):n.writeInt8(-1);typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let i=await this.transmit(`listActions`,t,n.toArray()),a=new ou(i),o=a.readVarIntNum(),s=[];for(let e=0;e<o;e++){let e=a.read(32),t=H(e),n=a.readVarIntNum(),r=a.readInt8(),i;switch(r){case 1:i=`completed`;break;case 2:i=`unprocessed`;break;case 3:i=`sending`;break;case 4:i=`unproven`;break;case 5:i=`unsigned`;break;case 6:i=`nosend`;break;case 7:i=`nonfinal`;break;case 8:i=`failed`;break;default:throw Error(`Unknown status code: ${r}`)}let o=a.readInt8()===1,c=a.readVarIntNum(),l=a.read(c),u=W(l),d={txid:t,satoshis:n,status:i,isOutgoing:o,description:u,version:0,lockTime:0},f=a.readVarIntNum();if(f>=0){d.labels=[];for(let e=0;e<f;e++){let e=a.readVarIntNum(),t=a.read(e);d.labels.push(W(t))}}d.version=a.readVarIntNum(),d.lockTime=a.readVarIntNum();let p=a.readVarIntNum();if(p>=0){d.inputs=[];for(let e=0;e<p;e++){let e=this.readOutpoint(a),t=a.readVarIntNum(),n=a.readVarIntNum(),r;if(n>=0){let e=a.read(n);r=H(e)}let i=a.readVarIntNum(),o;if(i>=0){let e=a.read(i);o=H(e)}let s=a.readVarIntNum(),c=a.read(s),l=W(c),u=a.readVarIntNum();d.inputs.push({sourceOutpoint:e,sourceSatoshis:t,sourceLockingScript:r,unlockingScript:o,inputDescription:l,sequenceNumber:u})}}let m=a.readVarIntNum();if(m>=0){d.outputs=[];for(let e=0;e<m;e++){let e=a.readVarIntNum(),t=a.readVarIntNum(),n=a.readVarIntNum(),r;if(n>=0){let e=a.read(n);r=H(e)}let i=a.readInt8()===1,o=a.readVarIntNum(),s=a.read(o),c=W(s),l=a.readVarIntNum(),u;if(l>=0){let e=a.read(l);u=W(e)}let f=a.readVarIntNum(),p=[];if(f>=0)for(let e=0;e<f;e++){let e=a.readVarIntNum(),t=a.read(e);p.push(W(t))}let m=a.readVarIntNum(),h;if(m>=0){let e=a.read(m);h=W(e)}d.outputs.push({outputIndex:e,satoshis:t,lockingScript:r,spendable:i,outputDescription:c,basket:u,tags:p,customInstructions:h})}}s.push(d)}return{totalActions:o,actions:s}}async internalizeAction(e,t){let n=new au;n.writeVarIntNum(e.tx.length),n.write(e.tx),n.writeVarIntNum(e.outputs.length);for(let t of e.outputs)if(n.writeVarIntNum(t.outputIndex),t.protocol===`wallet payment`){if(t.paymentRemittance==null)throw Error(`Payment remittance is required for wallet payment`);n.writeUInt8(1),n.write(U(t.paymentRemittance.senderIdentityKey,`hex`));let e=U(t.paymentRemittance.derivationPrefix,`base64`);n.writeVarIntNum(e.length),n.write(e);let r=U(t.paymentRemittance.derivationSuffix,`base64`);n.writeVarIntNum(r.length),n.write(r)}else{n.writeUInt8(2);let e=U(t.insertionRemittance?.basket,`utf8`);if(n.writeVarIntNum(e.length),n.write(e),typeof t.insertionRemittance?.customInstructions==`string`&&t.insertionRemittance.customInstructions!==``){let e=U(t.insertionRemittance.customInstructions,`utf8`);n.writeVarIntNum(e.length),n.write(e)}else n.writeVarIntNum(-1);if(typeof t.insertionRemittance?.tags==`object`){n.writeVarIntNum(t.insertionRemittance.tags.length);for(let e of t.insertionRemittance.tags){let t=U(e,`utf8`);n.writeVarIntNum(t.length),n.write(t)}}else n.writeVarIntNum(0)}if(typeof e.labels==`object`){n.writeVarIntNum(e.labels.length);for(let t of e.labels){let e=U(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}}else n.writeVarIntNum(-1);let r=U(e.description);return n.writeVarIntNum(r.length),n.write(r),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),await this.transmit(`internalizeAction`,t,n.toArray()),{accepted:!0}}async listOutputs(e,t){let n=new au,r=U(e.basket,`utf8`);if(n.writeVarIntNum(r.length),n.write(r),typeof e.tags==`object`){n.writeVarIntNum(e.tags.length);for(let t of e.tags){let e=U(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}}else n.writeVarIntNum(0);e.tagQueryMode===`all`?n.writeInt8(1):e.tagQueryMode===`any`?n.writeInt8(2):n.writeInt8(-1),e.include===`locking scripts`?n.writeInt8(1):e.include===`entire transactions`?n.writeInt8(2):n.writeInt8(-1),typeof e.includeCustomInstructions==`boolean`?n.writeInt8(e.includeCustomInstructions?1:0):n.writeInt8(-1),typeof e.includeTags==`boolean`?n.writeInt8(e.includeTags?1:0):n.writeInt8(-1),typeof e.includeLabels==`boolean`?n.writeInt8(e.includeLabels?1:0):n.writeInt8(-1),typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let i=await this.transmit(`listOutputs`,t,n.toArray()),a=new ou(i),o=a.readVarIntNum(),s=a.readVarIntNum(),c;s>=0&&(c=a.read(s));let l=[];for(let e=0;e<o;e++){let e=this.readOutpoint(a),t=a.readVarIntNum(),n={spendable:!0,outpoint:e,satoshis:t},r=a.readVarIntNum();r>=0&&(n.lockingScript=H(a.read(r)));let i=a.readVarIntNum();i>=0&&(n.customInstructions=W(a.read(i)));let o=a.readVarIntNum();if(o!==-1){let e=[];for(let t=0;t<o;t++){let t=a.readVarIntNum();e.push(W(a.read(t)))}n.tags=e}let s=a.readVarIntNum();if(s!==-1){let e=[];for(let t=0;t<s;t++){let t=a.readVarIntNum();e.push(W(a.read(t)))}n.labels=e}l.push(n)}return{totalOutputs:o,BEEF:c,outputs:l}}async relinquishOutput(e,t){let n=new au,r=U(e.basket,`utf8`);return n.writeVarIntNum(r.length),n.write(r),n.write(this.encodeOutpoint(e.output)),await this.transmit(`relinquishOutput`,t,n.toArray()),{relinquished:!0}}encodeOutpoint(e){let t=new au,[n,r]=e.split(`.`);return t.write(U(n,`hex`)),t.writeVarIntNum(Number(r)),t.toArray()}readOutpoint(e){let t=H(e.read(32)),n=e.readVarIntNum();return`${t}.${n}`}async getPublicKey(e,t){let n=new au;n.writeUInt8(e.identityKey?1:0),e.identityKey?n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason)):(n.write(this.encodeKeyRelatedParams(e.protocolID??=[hf.Silent,`default`],e.keyID??=``,e.counterparty,e.privileged,e.privilegedReason)),typeof e.forSelf==`boolean`?n.writeInt8(e.forSelf?1:0):n.writeInt8(-1)),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let r=await this.transmit(`getPublicKey`,t,n.toArray());return{publicKey:H(r)}}async revealCounterpartyKeyLinkage(e,t){let n=new au;n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason)),n.write(U(e.counterparty,`hex`)),n.write(U(e.verifier,`hex`));let r=await this.transmit(`revealCounterpartyKeyLinkage`,t,n.toArray()),i=new ou(r),a=H(i.read(33)),o=H(i.read(33)),s=H(i.read(33)),c=i.readVarIntNum(),l=W(i.read(c)),u=i.readVarIntNum(),d=i.read(u),f=i.readVarIntNum(),p=i.read(f);return{prover:a,verifier:o,counterparty:s,revelationTime:l,encryptedLinkage:d,encryptedLinkageProof:p}}async revealSpecificKeyLinkage(e,t){let n=new au;n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.write(U(e.verifier,`hex`));let r=await this.transmit(`revealSpecificKeyLinkage`,t,n.toArray()),i=new ou(r),a=H(i.read(33)),o=H(i.read(33)),s=H(i.read(33)),c=i.readUInt8(),l=i.readVarIntNum(),u=W(i.read(l)),d=i.readVarIntNum(),f=W(i.read(d)),p=i.readVarIntNum(),m=i.read(p),h=i.readVarIntNum(),g=i.read(h),_=i.readUInt8();return{prover:a,verifier:o,counterparty:s,protocolID:[c,u],keyID:f,encryptedLinkage:m,encryptedLinkageProof:g,proofType:_}}async encrypt(e,t){let n=new au;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.writeVarIntNum(e.plaintext.length),n.write(e.plaintext),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{ciphertext:await this.transmit(`encrypt`,t,n.toArray())}}async decrypt(e,t){let n=new au;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.writeVarIntNum(e.ciphertext.length),n.write(e.ciphertext),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{plaintext:await this.transmit(`decrypt`,t,n.toArray())}}async createHmac(e,t){let n=new au;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.writeVarIntNum(e.data.length),n.write(e.data),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{hmac:await this.transmit(`createHmac`,t,n.toArray())}}async verifyHmac(e,t){let n=new au;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),n.write(e.hmac),n.writeVarIntNum(e.data.length),n.write(e.data),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),await this.transmit(`verifyHmac`,t,n.toArray()),{valid:!0}}async createSignature(e,t){let n=new au;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),typeof e.data==`object`?(n.writeUInt8(1),n.writeVarIntNum(e.data.length),n.write(e.data)):(n.writeUInt8(2),n.write(e.hashToDirectlySign??=[])),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),{signature:await this.transmit(`createSignature`,t,n.toArray())}}async verifySignature(e,t){let n=new au;return n.write(this.encodeKeyRelatedParams(e.protocolID,e.keyID,e.counterparty,e.privileged,e.privilegedReason)),typeof e.forSelf==`boolean`?n.writeInt8(e.forSelf?1:0):n.writeInt8(-1),n.writeVarIntNum(e.signature.length),n.write(e.signature),typeof e.data==`object`?(n.writeUInt8(1),n.writeVarIntNum(e.data.length),n.write(e.data)):(n.writeUInt8(2),n.write(e.hashToDirectlyVerify??[])),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1),await this.transmit(`verifySignature`,t,n.toArray()),{valid:!0}}encodeKeyRelatedParams(e,t,n,r,i){let a=new au;a.writeUInt8(e[0]);let o=U(e[1],`utf8`);a.writeVarIntNum(o.length),a.write(o);let s=U(t,`utf8`);return a.writeVarIntNum(s.length),a.write(s),typeof n==`string`?n===`self`?a.writeUInt8(11):n===`anyone`?a.writeUInt8(12):a.write(U(n,`hex`)):a.writeUInt8(0),a.write(this.encodePrivilegedParams(r,i)),a.toArray()}async acquireCertificate(e,t){let n=new au;n.write(U(e.type,`base64`)),n.write(U(e.certifier,`hex`));let r=Object.entries(e.fields);n.writeVarIntNum(r.length);for(let[e,t]of r){let r=U(e,`utf8`),i=U(t,`utf8`);n.writeVarIntNum(r.length),n.write(r),n.writeVarIntNum(i.length),n.write(i)}if(n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason)),n.writeUInt8(e.acquisitionProtocol===`direct`?1:2),e.acquisitionProtocol===`direct`){n.write(U(e.serialNumber,`base64`)),n.write(this.encodeOutpoint(e.revocationOutpoint??``));let t=U(e.signature,`hex`);n.writeVarIntNum(t.length),n.write(t);let r=e.keyringRevealer===`certifier`?[11]:U(e.keyringRevealer,`hex`);n.write(r);let i=Object.keys(e.keyringForSubject??{});n.writeVarIntNum(i.length);for(let t=0;t<i.length;t++){let r=U(i[t],`utf8`);n.writeVarIntNum(r.length),n.write(r);let a=U(e.keyringForSubject?.[i[t]],`base64`);n.writeVarIntNum(a.length),n.write(a)}}else{let t=U(e.certifierUrl,`utf8`);n.writeVarIntNum(t.length),n.write(t)}let i=await this.transmit(`acquireCertificate`,t,n.toArray()),a=Cf.fromBinary(i);return{...a,signature:a.signature}}encodePrivilegedParams(e,t){let n=new au;if(typeof e==`boolean`?n.writeInt8(e?1:0):n.writeInt8(-1),typeof t==`string`){let e=U(t,`utf8`);n.writeInt8(e.length),n.write(e)}else n.writeInt8(-1);return n.toArray()}async listCertificates(e,t){let n=new au;n.writeVarIntNum(e.certifiers.length);for(let t=0;t<e.certifiers.length;t++)n.write(U(e.certifiers[t],`hex`));n.writeVarIntNum(e.types.length);for(let t=0;t<e.types.length;t++)n.write(U(e.types[t],`base64`));typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason));let r=await this.transmit(`listCertificates`,t,n.toArray()),i=new ou(r),a=i.readVarIntNum(),o=[];for(let e=0;e<a;e++){let e=i.readVarIntNum(),t=i.read(e),n=Cf.fromBinary(t),r={};if(i.readInt8()===1){let e=i.readVarIntNum();for(let t=0;t<e;t++){let e=i.readVarIntNum(),t=W(i.read(e)),n=i.readVarIntNum();r[t]=$l(i.read(n))}}let a=i.readVarIntNum(),s;a>0&&(s=W(i.read(a))),o.push({...n,signature:n.signature,keyring:r,verifier:s})}return{totalCertificates:a,certificates:o}}async proveCertificate(e,t){let n=new au,r=U(e.certificate.type,`base64`);n.write(r);let i=U(e.certificate.subject,`hex`);n.write(i);let a=U(e.certificate.serialNumber,`base64`);n.write(a);let o=U(e.certificate.certifier,`hex`);n.write(o);let s=this.encodeOutpoint(e.certificate.revocationOutpoint??``);n.write(s);let c=U(e.certificate.signature,`hex`);n.writeVarIntNum(c.length),n.write(c);let l=Object.entries(e.certificate.fields??{});n.writeVarIntNum(l.length);for(let[e,t]of l){let r=U(e,`utf8`),i=U(t,`utf8`);n.writeVarIntNum(r.length),n.write(r),n.writeVarIntNum(i.length),n.write(i)}n.writeVarIntNum(e.fieldsToReveal.length);for(let t of e.fieldsToReveal){let e=U(t,`utf8`);n.writeVarIntNum(e.length),n.write(e)}n.write(U(e.verifier,`hex`)),n.write(this.encodePrivilegedParams(e.privileged,e.privilegedReason));let u=await this.transmit(`proveCertificate`,t,n.toArray()),d=new ou(u),f=d.readVarIntNum(),p={};for(let e=0;e<f;e++){let e=d.readVarIntNum(),t=W(d.read(e)),n=d.readVarIntNum();p[t]=$l(d.read(n))}return{keyringForVerifier:p}}async relinquishCertificate(e,t){let n=new au,r=U(e.type,`base64`);n.write(r);let i=U(e.serialNumber,`base64`);n.write(i);let a=U(e.certifier,`hex`);return n.write(a),await this.transmit(`relinquishCertificate`,t,n.toArray()),{relinquished:!0}}parseDiscoveryResult(e){let t=new ou(e),n=t.readVarIntNum(),r=[];for(let e=0;e<n;e++){let e=t.readVarIntNum(),n=t.read(e),i=Cf.fromBinary(n),a=t.readVarIntNum(),o=W(t.read(a)),s=t.readVarIntNum(),c=W(t.read(s)),l=t.readVarIntNum(),u=W(t.read(l)),d=t.readUInt8(),f={},p=t.readVarIntNum();for(let e=0;e<p;e++){let e=t.readVarIntNum(),n=W(t.read(e)),r=t.readVarIntNum();f[n]=t.read(r)}let m={},h=t.readVarIntNum();for(let e=0;e<h;e++){let e=t.readVarIntNum(),n=W(t.read(e)),r=t.readVarIntNum();m[n]=W(t.read(r))}r.push({...i,signature:i.signature,certifierInfo:{iconUrl:c,name:o,description:u,trust:d},publiclyRevealedKeyring:f,decryptedFields:m})}return{totalCertificates:n,certificates:r}}async discoverByIdentityKey(e,t){let n=new au;n.write(U(e.identityKey,`hex`)),typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let r=await this.transmit(`discoverByIdentityKey`,t,n.toArray());return this.parseDiscoveryResult(r)}async discoverByAttributes(e,t){let n=new au,r=Object.keys(e.attributes);n.writeVarIntNum(r.length);for(let t=0;t<r.length;t++)n.writeVarIntNum(r[t].length),n.write(U(r[t],`utf8`)),n.writeVarIntNum(e.attributes[r[t]].length),n.write(U(e.attributes[r[t]],`utf8`));typeof e.limit==`number`?n.writeVarIntNum(e.limit):n.writeVarIntNum(-1),typeof e.offset==`number`?n.writeVarIntNum(e.offset):n.writeVarIntNum(-1),n.writeInt8(typeof e.seekPermission==`boolean`?e.seekPermission?1:0:-1);let i=await this.transmit(`discoverByAttributes`,t,n.toArray());return this.parseDiscoveryResult(i)}async isAuthenticated(e,t){return{authenticated:(await this.transmit(`isAuthenticated`,t))[0]===1}}async waitForAuthentication(e,t){return await this.transmit(`waitForAuthentication`,t),{authenticated:!0}}async getHeight(e,t){let n=await this.transmit(`getHeight`,t);return{height:new ou(n).readVarIntNum()}}async getHeaderForHeight(e,t){let n=new au;n.writeVarIntNum(e.height);let r=await this.transmit(`getHeaderForHeight`,t,n.toArray());return{header:H(r)}}async getNetwork(e,t){return{network:(await this.transmit(`getNetwork`,t))[0]===0?`mainnet`:`testnet`}}async getVersion(e,t){let n=await this.transmit(`getVersion`,t);return{version:W(n)}}},Df=class{baseUrl;httpClient;originator;constructor(e,t=`http://localhost:3301`,n=fetch){this.baseUrl=t,this.httpClient=n,this.originator=e}async transmitToWallet(e){let t=new ou(e),n=t.readUInt8(),r=Tf[n];if(r===void 0||r===``)throw Error(`Invalid call code: ${n}`);let i=t.readUInt8(),a;if(i>0){let e=t.read(i);a=W(e)}let o=t.read(),s=await(await fetch(`${this.baseUrl}/${r}`,{method:`POST`,headers:{"Content-Type":`application/octet-stream`,Origin:a??``},body:new Uint8Array(o)})).arrayBuffer();return Array.from(new Uint8Array(s))}},Of=class extends Error{reviewActionResults;sendWithResults;txid;tx;noSendChange;code;isError=!0;constructor(e,t,n,r,i){super(`Undelayed createAction or signAction results require review.`),this.reviewActionResults=e,this.sendWithResults=t,this.txid=n,this.tx=r,this.noSendChange=i,this.code=5,this.name=this.constructor.name}},kf=class extends Error{parameter;code;isError=!0;constructor(e,t){super(`The ${e} parameter must be ${t??`valid.`}`),this.parameter=e,this.code=6,this.name=this.constructor.name}},q=kf;function Af(e,t=`http`){if(/^[a-z][a-z0-9+.-]*:\/\//i.test(e))try{return new URL(e).origin}catch{}try{return new URL(`${t}://${e}`).origin}catch{throw Error(`Invalid originator value: ${e}`)}}var jf=class extends Error{totalSatoshisNeeded;moreSatoshisNeeded;code;isError=!0;constructor(e,t){super(`Insufficient funds in the available inputs to cover the cost of the required outputs and the transaction fee (${t} more satoshis are needed, for a total of ${e}), plus whatever would be required in order to pay the fee to unlock and spend the outputs used to provide the additional satoshis.`),this.totalSatoshisNeeded=e,this.moreSatoshisNeeded=t,this.code=7,this.name=this.constructor.name}},Mf=class{baseUrl;httpClient;originator;api;constructor(e,t=`http://localhost:3321`,n=fetch){this.baseUrl=t,this.originator=e,this.httpClient=n;let r=typeof window<`u`&&typeof document<`u`&&window?.origin!==`file://`;this.api=async(e,t)=>{let i=!r&&this.originator?Af(this.originator,`http`):void 0;!r&&i===void 0&&console.error(`Originator is required in Node.js environments`);let a=await await n(`${this.baseUrl}/${e}`,{method:`POST`,headers:{Accept:`application/json`,"Content-Type":`application/json`,...i?{Origin:i}:{},...i?{Originator:i}:{}},body:JSON.stringify(t)}),o=await a.json();if(!a.ok){if(a.status===400&&o.isError){let e;switch(o.code){case 5:e=new Of(o.reviewActionResults,o.sendWithResults,o.txid,o.tx,o.noSendChange);break;case 6:e=new kf(o.parameter),e.message=o.message;break;case 7:e=new jf(o.totalSatoshisNeeded,o.moreSatoshisNeeded);break;default:break}if(e)throw e}let n={call:e,args:t,message:o.message??`HTTP Client error ${a.status}`};throw Error(JSON.stringify(n))}return o}}async createAction(e){return await this.api(`createAction`,e)}async signAction(e){return await this.api(`signAction`,e)}async abortAction(e){return await this.api(`abortAction`,e)}async listActions(e){return await this.api(`listActions`,e)}async internalizeAction(e){return await this.api(`internalizeAction`,e)}async listOutputs(e){return await this.api(`listOutputs`,e)}async relinquishOutput(e){return await this.api(`relinquishOutput`,e)}async getPublicKey(e){return await this.api(`getPublicKey`,e)}async revealCounterpartyKeyLinkage(e){return await this.api(`revealCounterpartyKeyLinkage`,e)}async revealSpecificKeyLinkage(e){return await this.api(`revealSpecificKeyLinkage`,e)}async encrypt(e){return await this.api(`encrypt`,e)}async decrypt(e){return await this.api(`decrypt`,e)}async createHmac(e){return await this.api(`createHmac`,e)}async verifyHmac(e){return await this.api(`verifyHmac`,e)}async createSignature(e){return await this.api(`createSignature`,e)}async verifySignature(e){return await this.api(`verifySignature`,e)}async acquireCertificate(e){return await this.api(`acquireCertificate`,e)}async listCertificates(e){return await this.api(`listCertificates`,e)}async proveCertificate(e){return await this.api(`proveCertificate`,e)}async relinquishCertificate(e){return await this.api(`relinquishCertificate`,e)}async discoverByIdentityKey(e){return await this.api(`discoverByIdentityKey`,e)}async discoverByAttributes(e){return await this.api(`discoverByAttributes`,e)}async isAuthenticated(e){return await this.api(`isAuthenticated`,e)}async waitForAuthentication(e){return await this.api(`waitForAuthentication`,e)}async getHeight(e){return await this.api(`getHeight`,e)}async getHeaderForHeight(e){return await this.api(`getHeaderForHeight`,e)}async getNetwork(e){return await this.api(`getNetwork`,e)}async getVersion(e){return await this.api(`getVersion`,e)}},Nf=class{domain;constructor(e=`*`){if(typeof window!=`object`)throw Error(`The XDM substrate requires a global window object.`);if(!window.hasOwnProperty(`ReactNativeWebView`))throw Error(`The window object does not have a ReactNativeWebView property.`);if(typeof window.ReactNativeWebView.postMessage!=`function`)throw Error(`The window.ReactNativeWebView property does not seem to support postMessage calls.`);this.domain=e}async invoke(e,t){return await new Promise((n,r)=>{let i=$l(Qu(12)),a=e=>{let t=JSON.parse(e.data);if(!(t.type!==`CWI`||t.id!==i||t.isInvocation===!0))if(typeof window.removeEventListener==`function`&&window.removeEventListener(`message`,a),t.status===`error`){let e=new bf(t.description,t.code);r(e)}else n(t.result)};window.addEventListener(`message`,a),window.ReactNativeWebView.postMessage(JSON.stringify({type:`CWI`,isInvocation:!0,id:i,call:e,args:t}))})}async createAction(e){return await this.invoke(`createAction`,e)}async signAction(e){return await this.invoke(`signAction`,e)}async abortAction(e){return await this.invoke(`abortAction`,e)}async listActions(e){return await this.invoke(`listActions`,e)}async internalizeAction(e){return await this.invoke(`internalizeAction`,e)}async listOutputs(e){return await this.invoke(`listOutputs`,e)}async relinquishOutput(e){return await this.invoke(`relinquishOutput`,e)}async getPublicKey(e){return await this.invoke(`getPublicKey`,e)}async revealCounterpartyKeyLinkage(e){return await this.invoke(`revealCounterpartyKeyLinkage`,e)}async revealSpecificKeyLinkage(e){return await this.invoke(`revealSpecificKeyLinkage`,e)}async encrypt(e){return await this.invoke(`encrypt`,e)}async decrypt(e){return await this.invoke(`decrypt`,e)}async createHmac(e){return await this.invoke(`createHmac`,e)}async verifyHmac(e){return await this.invoke(`verifyHmac`,e)}async createSignature(e){return await this.invoke(`createSignature`,e)}async verifySignature(e){return await this.invoke(`verifySignature`,e)}async acquireCertificate(e){return await this.invoke(`acquireCertificate`,e)}async listCertificates(e){return await this.invoke(`listCertificates`,e)}async proveCertificate(e){return await this.invoke(`proveCertificate`,e)}async relinquishCertificate(e){return await this.invoke(`relinquishCertificate`,e)}async discoverByIdentityKey(e){return await this.invoke(`discoverByIdentityKey`,e)}async discoverByAttributes(e){return await this.invoke(`discoverByAttributes`,e)}async isAuthenticated(e){return await this.invoke(`isAuthenticated`,e)}async waitForAuthentication(e){return await this.invoke(`waitForAuthentication`,e)}async getHeight(e){return await this.invoke(`getHeight`,e)}async getHeaderForHeight(e){return await this.invoke(`getHeaderForHeight`,e)}async getNetwork(e){return await this.invoke(`getNetwork`,e)}async getVersion(e){return await this.invoke(`getVersion`,e)}};function Pf(e){let[t,n]=e.split(`.`);return{txid:t,vout:Number(n)}}function Ff(e){return e??!0}function If(e){return e??!1}function Lf(e){return e??0}function Rf(e){return e??4294967295}function zf(e){return e??1}function Bf(e){return e??[]}function Vf(e,t,n,r){if(e!==void 0)return Gf(e,t,n,r)}function Hf(e,t,n){if(e===void 0||!Number.isInteger(e)||e<0||e>0x775f05a074000)throw new q(t,`a valid number of satoshis`);if(n!==void 0&&e<n)throw new q(t,`at least ${n} satoshis.`);return e}function Uf(e,t,n,r,i){if(e===void 0){if(n!==void 0)return n;throw new q(t,`a valid integer`)}if(!Number.isInteger(e))throw new q(t,`an integer`);if(e=Number(e),r!==void 0&&e<r)throw new q(t,`at least ${r} length.`);if(i!==void 0&&e>i)throw new q(t,`no more than ${i} length.`);return e}function Wf(e,t){return Uf(e,t,0,0)}function Gf(e,t,n,r){let i=U(e,`utf8`).length;if(n!==void 0&&i<n)throw new q(t,`at least ${n} length.`);if(r!==void 0&&i>r)throw new q(t,`no more than ${r} length.`);return e}function Kf(e){if(e!==void 0)return qf(e)}function qf(e){return Xf(e,`basket`,1,300)}function Jf(e){return Xf(e,`label`,1,300)}function Yf(e){return Xf(e,`tag`,1,300)}function Xf(e,t,n,r){e=e.trim().toLowerCase();let i=U(e,`utf8`).length;if(n!==void 0&&i<n)throw new q(t,`at least ${n} length.`);if(r!==void 0&&i>r)throw new q(t,`no more than ${r} length.`);return e}function Zf(e,t,n,r){if(e!==void 0)return Qf(e,t,n,r)}function Qf(e,t,n,r){if(e=e.trim(),e.length===0)throw new q(t,`valid base64 string`);let i=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(!(r>=65&&r<=90)&&!(r>=97&&r<=122)&&!(r>=48&&r<=57)&&r!==43&&r!==47){if(r===61){if(n<e.length-2)throw new q(t,`valid base64 string`);i++;continue}throw new q(t,`valid base64 string`)}}if(i>2||i>0&&e.length%4!=0)throw new q(t,`valid base64 string`);let a=e.length%4;if(a!==0&&a!==4-i)throw new q(t,`valid base64 string`);let o=e.length-i,s=Math.floor(o*3/4);if(n!==void 0&&s<n)throw new q(t,`at least ${n} bytes`);if(r!==void 0&&s>r)throw new q(t,`no more than ${r} bytes`);return e}function $f(e,t,n,r){if(e!==void 0)return ep(e,t,n,r)}function ep(e,t,n,r){if(e=e.trim().toLowerCase(),e.length%2==1)throw new q(t,`even length, not ${e.length}.`);if(!/^[0-9A-Fa-f]+$/.test(e))throw new q(t,`hexadecimal string.`);if(n!==void 0&&e.length<n)throw new q(t,`at least ${n} length.`);if(r!==void 0&&e.length>r)throw new q(t,`no more than ${r} length.`);return e}function tp(e){if(e.unlockingScript===void 0&&e.unlockingScriptLength===void 0)throw new q(`unlockingScript, unlockingScriptLength`,`at least one valid value.`);let t=$f(e.unlockingScript,`unlockingScript`),n=e.unlockingScriptLength??(t==null?0:t.length/2);if(t&&n!==t.length/2)throw new q(`unlockingScriptLength`,`length unlockingScript if both valid.`);return{outpoint:Pf(e.outpoint),inputDescription:Gf(e.inputDescription,`inputDescription`,5,2e3),unlockingScript:t,unlockingScriptLength:n,sequenceNumber:Rf(e.sequenceNumber)}}function np(e){return{lockingScript:ep(e.lockingScript,`lockingScript`),satoshis:Hf(e.satoshis,`satoshis`),outputDescription:Gf(e.outputDescription,`outputDescription`,5,2e3),basket:Kf(e.basket),customInstructions:e.customInstructions,tags:Bf(e.tags).map(e=>Yf(e))}}function rp(e){let t=e??{};return{signAndProcess:Ff(t.signAndProcess),acceptDelayedBroadcast:Ff(t.acceptDelayedBroadcast),knownTxids:Bf(t.knownTxids),returnTXIDOnly:If(t.returnTXIDOnly),noSend:If(t.noSend),noSendChange:Bf(t.noSendChange).map(e=>Pf(e)),sendWith:Bf(t.sendWith),randomizeOutputs:Ff(t.randomizeOutputs)}}function ip(e){let t={description:Gf(e.description,`description`,5,2e3),inputBEEF:e.inputBEEF,inputs:Bf(e.inputs).map(e=>tp(e)),outputs:Bf(e.outputs).map(e=>np(e)),lockTime:Lf(e.lockTime),version:zf(e.version),labels:Bf(e.labels?.map(e=>Jf(e))),options:rp(e.options),isSendWith:!1,isDelayed:!1,isNoSend:!1,isNewTx:!1,isRemixChange:!1,isSignAction:!1,randomVals:void 0,includeAllSourceTransactions:!1,isTestWerrReviewActions:!1};return t.isTestWerrReviewActions=t.labels.includes(Op),t.isSendWith=t.options.sendWith.length>0,t.isRemixChange=!t.isSendWith&&t.inputs.length===0&&t.outputs.length===0,t.isNewTx=t.isRemixChange||t.inputs.length>0||t.outputs.length>0,t.isSignAction=t.isNewTx&&(!t.options.signAndProcess||t.inputs.some(e=>e.unlockingScript===void 0)),t.isDelayed=t.options.acceptDelayedBroadcast,t.isNoSend=t.options.noSend,t}function ap(e){let t=e??{};return{acceptDelayedBroadcast:Ff(t.acceptDelayedBroadcast),returnTXIDOnly:If(t.returnTXIDOnly),noSend:If(t.noSend),sendWith:Bf(t.sendWith)}}function op(e){let t={spends:e.spends,reference:e.reference,options:ap(e.options),isSendWith:!1,isDelayed:!1,isNoSend:!1,isNewTx:!0,isRemixChange:!1,isTestWerrReviewActions:!1};return t.isSendWith=t.options.sendWith.length>0,t.isDelayed=t.options.acceptDelayedBroadcast,t.isNoSend=t.options.noSend,t}function sp(e){return{reference:Qf(e.reference,`reference`)}}function cp(e){if(e!==void 0)return{derivationPrefix:Qf(e.derivationPrefix,`derivationPrefix`),derivationSuffix:Qf(e.derivationSuffix,`derivationSuffix`),senderIdentityKey:ep(e.senderIdentityKey,`senderIdentityKey`)}}function lp(e){if(e!==void 0)return{basket:qf(e.basket),customInstructions:Vf(e.customInstructions,`customInstructions`,0,1e3),tags:Bf(e.tags).map(e=>Yf(e))}}function up(e){if(e.protocol!==`basket insertion`&&e.protocol!==`wallet payment`)throw new q(`protocol`,`'basket insertion' or 'wallet payment'`);return{outputIndex:Wf(e.outputIndex,`outputIndex`),protocol:e.protocol,paymentRemittance:cp(e.paymentRemittance),insertionRemittance:lp(e.insertionRemittance)}}function dp(e){let t={tx:e.tx,outputs:e.outputs.map(e=>up(e)),description:Gf(e.description,`description`,5,2e3),labels:(e.labels==null?[]:e.labels).map(e=>Jf(e)),seekPermission:Ff(e.seekPermission)};try{if(ff.fromBinary(t.tx).txs.length<1)throw new q(`tx`,`at least one transaction to internalize an output from`)}catch{throw new q(`tx`,`valid with at least one transaction to internalize an output from`)}if(t.outputs.length<1)throw new q(`outputs`,`at least one output to internalize from the transaction`);return t}function fp(e,t){if(e!==void 0)return pp(e,t)}function pp(e,t){let n=e.split(`.`);if(n.length!==2||!Number.isInteger(Number(n[1])))throw new q(t,`txid as hex string and numeric output index joined with '.'`);let r=ep(n[0],`${t} txid`,void 0,64),i=Wf(Number(n[1]),`${t} vout`);return`${r}.${i}`}function mp(e){return{basket:qf(e.basket),output:pp(e.output,`output`)}}function hp(e){return{type:Qf(e.type,`type`),serialNumber:Qf(e.serialNumber,`serialNumber`),certifier:ep(e.certifier,`certifier`)}}function gp(e){return{certifiers:Bf(e.certifiers.map(e=>ep(e.trim(),`certifiers`))),types:Bf(e.types.map(e=>Qf(e.trim(),`types`))),limit:Uf(e.limit,`limit`,10,1,1e4),offset:Wf(Lf(e.offset),`offset`),privileged:If(e.privileged),privilegedReason:Vf(e.privilegedReason,`privilegedReason`,5,50),partial:void 0}}function _p(e){for(let t of Object.keys(e))Gf(t,`field name`,1,50);return e}function vp(e,t){return e===`certifier`?e:ep(e,t)}function yp(e,t){for(let n of Object.keys(e))Gf(n,`${t} field name`,1,50),Qf(e[n],`${t} field value`);return e}function bp(e){if(e.acquisitionProtocol!==`issuance`)throw Error(`Only acquire certificate via issuance requests allowed here.`);if(e.serialNumber)throw new q(`serialNumber`,`valid when acquisitionProtocol is "direct"`);if(e.signature)throw new q(`signature`,`valid when acquisitionProtocol is "direct"`);if(e.revocationOutpoint)throw new q(`revocationOutpoint`,`valid when acquisitionProtocol is "direct"`);if(e.keyringRevealer)throw new q(`keyringRevealer`,`valid when acquisitionProtocol is "direct"`);if(e.keyringForSubject!=null)throw new q(`keyringForSubject`,`valid when acquisitionProtocol is "direct"`);if(!e.certifierUrl)throw new q(`certifierUrl`,`valid when acquisitionProtocol is "issuance"`);if(e.privileged&&!e.privilegedReason)throw new q(`privilegedReason`,`valid when 'privileged' is true `);return{type:Qf(e.type,`type`),certifier:ep(e.certifier,`certifier`),certifierUrl:e.certifierUrl,fields:_p(e.fields),privileged:If(e.privileged),privilegedReason:Vf(e.privilegedReason,`privilegedReason`,5,50),subject:``}}function xp(e){if(e.acquisitionProtocol!==`direct`)throw Error(`Only acquire direct certificate requests allowed here.`);if(!e.serialNumber)throw new q(`serialNumber`,`valid when acquisitionProtocol is "direct"`);if(!e.signature)throw new q(`signature`,`valid when acquisitionProtocol is "direct"`);if(!e.revocationOutpoint)throw new q(`revocationOutpoint`,`valid when acquisitionProtocol is "direct"`);if(!e.keyringRevealer)throw new q(`keyringRevealer`,`valid when acquisitionProtocol is "direct"`);if(e.keyringForSubject==null)throw new q(`keyringForSubject`,`valid when acquisitionProtocol is "direct"`);if(e.privileged&&!e.privilegedReason)throw new q(`privilegedReason`,`valid when 'privileged' is true `);return{type:Qf(e.type,`type`),serialNumber:Qf(e.serialNumber,`serialNumber`),certifier:ep(e.certifier,`certifier`),revocationOutpoint:pp(e.revocationOutpoint,`revocationOutpoint`),fields:_p(e.fields),signature:ep(e.signature,`signature`),keyringRevealer:vp(e.keyringRevealer,`keyringRevealer`),keyringForSubject:yp(e.keyringForSubject,`keyringForSubject`),privileged:If(e.privileged),privilegedReason:Vf(e.privilegedReason,`privilegedReason`,5,50),subject:``}}function Sp(e){if(e.privileged&&!e.privilegedReason)throw new q(`privilegedReason`,`valid when 'privileged' is true `);return{type:Zf(e.certificate.type,`certificate.type`),serialNumber:Zf(e.certificate.serialNumber,`certificate.serialNumber`),certifier:$f(e.certificate.certifier,`certificate.certifier`),subject:$f(e.certificate.subject,`certificate.subject`),revocationOutpoint:fp(e.certificate.revocationOutpoint,`certificate.revocationOutpoint`),signature:$f(e.certificate.signature,`certificate.signature`),fieldsToReveal:Bf(e.fieldsToReveal).map(e=>Gf(e,`fieldsToReveal ${e}`,1,50)),verifier:ep(e.verifier,`verifier`),privileged:If(e.privileged),privilegedReason:Vf(e.privilegedReason,`privilegedReason`,5,50)}}function Cp(e){return{identityKey:ep(e.identityKey,`identityKey`,66,66),limit:Uf(e.limit,`limit`,10,1,1e4),offset:Wf(Lf(e.offset),`offset`),seekPermission:If(e.seekPermission)}}function wp(e){for(let t of Object.keys(e))Gf(t,`field name ${t}`,1,50);return e}function Tp(e){return{attributes:wp(e.attributes),limit:Uf(e.limit,`limit`,10,1,1e4),offset:Wf(Lf(e.offset),`offset`),seekPermission:If(e.seekPermission)}}function Ep(e){let t;if(e.tagQueryMode===void 0||e.tagQueryMode===`any`)t=`any`;else if(e.tagQueryMode===`all`)t=`all`;else throw new q(`tagQueryMode`,`undefined, 'any', or 'all'`);return{basket:Gf(e.basket,`basket`,1,300),tags:(e.tags==null?[]:e.tags).map(e=>Gf(e,`tag`,1,300)),tagQueryMode:t,includeLockingScripts:e.include===`locking scripts`,includeTransactions:e.include===`entire transactions`,includeCustomInstructions:If(e.includeCustomInstructions),includeTags:If(e.includeTags),includeLabels:If(e.includeLabels),limit:Uf(e.limit,`limit`,10,1,1e4),offset:Uf(e.offset,`offset`,0,void 0,void 0),seekPermission:Ff(e.seekPermission),knownTxids:[]}}function Dp(e){let t;if(e.labelQueryMode===void 0||e.labelQueryMode===`any`)t=`any`;else if(e.labelQueryMode===`all`)t=`all`;else throw new q(`labelQueryMode`,`undefined, 'any', or 'all'`);return{labels:(e.labels==null?[]:e.labels).map(e=>Jf(e)),labelQueryMode:t,includeLabels:If(e.includeLabels),includeInputs:If(e.includeInputs),includeInputSourceLockingScripts:If(e.includeInputSourceLockingScripts),includeInputUnlockingScripts:If(e.includeInputUnlockingScripts),includeOutputs:If(e.includeOutputs),includeOutputLockingScripts:If(e.includeOutputLockingScripts),limit:Uf(e.limit,`limit`,10,1,1e4),offset:Uf(e.offset,`offset`,0,0),seekPermission:Ff(e.seekPermission)}}const Op=`a496e747fc3ad5fabdd4ae8f91184e71f87539bd3d962aa2548942faaaf0047a`;var kp=200,Ap=class{substrate;originator;constructor(e=`auto`,t){e===`Cicada`&&(e=new Ef(new Df(t))),e===`window.CWI`&&(e=new yf),e===`XDM`&&(e=new Sf),e===`json-api`&&(e=new Mf(t)),e===`react-native`&&(e=new Nf(t)),e===`secure-json-api`&&(e=new Mf(t,`https://localhost:2121`)),this.substrate=e,this.originator=t}async connectToSubstrate(){if(typeof this.substrate==`object`)return;let e=async(e,t)=>{try{let n=e(),r;return r=typeof t==`number`?await Promise.race([n.getVersion({}),new Promise((e,n)=>setTimeout(()=>n(Error(`Timed out.`)),t))]):await n.getVersion({}),typeof r!=`object`||typeof r.version!=`string`?{success:!1}:{success:!0,sub:n}}catch{return{success:!1}}},t=[e(()=>new yf),e(()=>new Mf(this.originator,`https://localhost:2121`)),e(()=>new Mf(this.originator)),e(()=>new Nf(this.originator)),e(()=>new Ef(new Df(this.originator)))],n=(await Promise.allSettled(t)).filter(e=>e.status===`fulfilled`&&e.value.success&&e.value.sub!==void 0).map(e=>e.value.sub);if(n.length>0){this.substrate=n[0];return}let r=await e(()=>new Sf,kp);if(r.success&&r.sub!==void 0)this.substrate=r.sub;else throw Error(`No wallet available over any communication substrate. Install a BSV wallet today!`)}async createAction(e){return ip(e),await this.connectToSubstrate(),await this.substrate.createAction(e,this.originator)}async signAction(e){return op(e),await this.connectToSubstrate(),await this.substrate.signAction(e,this.originator)}async abortAction(e){return sp(e),await this.connectToSubstrate(),await this.substrate.abortAction(e,this.originator)}async listActions(e){return Dp(e),await this.connectToSubstrate(),await this.substrate.listActions(e,this.originator)}async internalizeAction(e){return dp(e),await this.connectToSubstrate(),await this.substrate.internalizeAction(e,this.originator)}async listOutputs(e){return Ep(e),await this.connectToSubstrate(),await this.substrate.listOutputs(e,this.originator)}async relinquishOutput(e){return mp(e),await this.connectToSubstrate(),await this.substrate.relinquishOutput(e,this.originator)}async getPublicKey(e){return await this.connectToSubstrate(),await this.substrate.getPublicKey(e,this.originator)}async revealCounterpartyKeyLinkage(e){return await this.connectToSubstrate(),await this.substrate.revealCounterpartyKeyLinkage(e,this.originator)}async revealSpecificKeyLinkage(e){return await this.connectToSubstrate(),await this.substrate.revealSpecificKeyLinkage(e,this.originator)}async encrypt(e){return await this.connectToSubstrate(),await this.substrate.encrypt(e,this.originator)}async decrypt(e){return await this.connectToSubstrate(),await this.substrate.decrypt(e,this.originator)}async createHmac(e){return await this.connectToSubstrate(),await this.substrate.createHmac(e,this.originator)}async verifyHmac(e){return await this.connectToSubstrate(),await this.substrate.verifyHmac(e,this.originator)}async createSignature(e){return await this.connectToSubstrate(),await this.substrate.createSignature(e,this.originator)}async verifySignature(e){return await this.connectToSubstrate(),await this.substrate.verifySignature(e,this.originator)}async acquireCertificate(e){if(e.acquisitionProtocol===`direct`)xp(e);else if(e.acquisitionProtocol===`issuance`)bp(e);else throw new kf(`acquisitionProtocol`,`valid. ${String(e.acquisitionProtocol)} is unrecognized.`);return await this.connectToSubstrate(),await this.substrate.acquireCertificate(e,this.originator)}async listCertificates(e){return gp(e),await this.connectToSubstrate(),await this.substrate.listCertificates(e,this.originator)}async proveCertificate(e){return Sp(e),await this.connectToSubstrate(),await this.substrate.proveCertificate(e,this.originator)}async relinquishCertificate(e){return hp(e),await this.connectToSubstrate(),await this.substrate.relinquishCertificate(e,this.originator)}async discoverByIdentityKey(e){return Cp(e),await this.connectToSubstrate(),await this.substrate.discoverByIdentityKey(e,this.originator)}async discoverByAttributes(e){return Tp(e),await this.connectToSubstrate(),await this.substrate.discoverByAttributes(e,this.originator)}async isAuthenticated(e={}){return await this.connectToSubstrate(),await this.substrate.isAuthenticated(e,this.originator)}async waitForAuthentication(e={}){return await this.connectToSubstrate(),await this.substrate.waitForAuthentication(e,this.originator)}async getHeight(e={}){return await this.connectToSubstrate(),await this.substrate.getHeight(e,this.originator)}async getHeaderForHeight(e){return await this.connectToSubstrate(),await this.substrate.getHeaderForHeight(e,this.originator)}async getNetwork(e={}){return await this.connectToSubstrate(),await this.substrate.getNetwork(e,this.originator)}async getVersion(e={}){return await this.connectToSubstrate(),await this.substrate.getVersion(e,this.originator)}},jp=class e extends Cf{keyring;decryptedFields;constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,r,i,a,s),this.keyring=o,this.decryptedFields=c}static fromCertificate(t,n){return new e(t.type,t.serialNumber,t.subject,t.certifier,t.revocationOutpoint,t.fields,n,t.signature)}async decryptFields(e,t,n,r){if(this.keyring==null||Object.keys(this.keyring).length===0)throw Error(`A keyring is required to decrypt certificate fields for the verifier.`);try{let i={};for(let a in this.keyring){let{plaintext:o}=await e.decrypt({ciphertext:U(this.keyring[a],`base64`),...Cf.getCertificateFieldEncryptionDetails(a,this.serialNumber),counterparty:this.subject,privileged:t,privilegedReason:n},r),s=new Ed(o).decrypt(U(this.fields[a],`base64`));i[a]=W(s)}return i}catch(e){throw Error(`Failed to decrypt selectively revealed certificate fields using keyring: ${String(e instanceof Error?e.message:e)}`)}}},Mp=class{sessionNonceToSession;identityKeyToNonces;constructor(){this.sessionNonceToSession=new Map,this.identityKeyToNonces=new Map}addSession(e){if(typeof e.sessionNonce!=`string`)throw Error(`Invalid session: sessionNonce is required to add a session.`);if(this.sessionNonceToSession.set(e.sessionNonce,e),typeof e.peerIdentityKey==`string`){let t=this.identityKeyToNonces.get(e.peerIdentityKey);t??(t=new Set,this.identityKeyToNonces.set(e.peerIdentityKey,t)),t.add(e.sessionNonce)}}updateSession(e){this.removeSession(e),this.addSession(e)}getSession(e){let t=this.sessionNonceToSession.get(e);if(t!=null)return t;let n=this.identityKeyToNonces.get(e);if(n==null||n.size===0)return;let r;for(let e of n){let t=this.sessionNonceToSession.get(e);t!=null&&(r==null||(t.lastUpdate??0)>(r.lastUpdate??0))&&(r=t)}return r}removeSession(e){if(typeof e.sessionNonce==`string`&&this.sessionNonceToSession.delete(e.sessionNonce),typeof e.peerIdentityKey==`string`){let t=this.identityKeyToNonces.get(e.peerIdentityKey);t!=null&&(t.delete(e.sessionNonce??``),t.size===0&&this.identityKeyToNonces.delete(e.peerIdentityKey))}}hasSession(e){if(this.sessionNonceToSession.has(e))return!0;let t=this.identityKeyToNonces.get(e);return t!=null&&t.size>0}};async function Np(e,t,n=`self`,r){let i=U(e,`base64`),a=i.slice(0,16),o=i.slice(16),{valid:s}=await t.verifyHmac({data:a,hmac:o,protocolID:[2,`server hmac`],keyID:W(a),counterparty:n},r);return s}async function Pp(e,t=`self`,n){let r=Qu(16),{hmac:i}=await e.createHmac({protocolID:[2,`server hmac`],keyID:W(r),data:r,counterparty:t},n),a=[...r,...i];return $l(a)}const Fp=async(e,t,n,r)=>{let i=await e.listCertificates({certifiers:t.certifiers,types:Object.keys(t.types)},r);return await Promise.all(i.certificates.map(async i=>{let{keyringForVerifier:a}=await e.proveCertificate({certificate:i,fieldsToReveal:t.types[i.type],verifier:n},r);return new jp(i.type,i.serialNumber,i.subject,i.certifier,i.revocationOutpoint,i.fields,a,i.signature)}))},Ip=async(e,t,n,r)=>{if(t.certificates==null||t.certificates.length===0)throw Error(`No certificates were provided in the AuthMessage.`);await Promise.all(t.certificates.map(async i=>{if(i.subject!==t.identityKey)throw Error(`The subject of one of your certificates ("${i.subject}") is not the same as the request sender ("${t.identityKey}").`);let a=new jp(i.type,i.serialNumber,i.subject,i.certifier,i.revocationOutpoint,i.fields,i.keyring,i.signature);if(!await a.verify())throw Error(`The signature for the certificate with serial number ${a.serialNumber} is invalid!`);if(n!=null){let{certifiers:e,types:t}=n;if(!e.includes(a.certifier))throw Error(`Certificate with serial number ${a.serialNumber} has an unrequested certifier: ${a.certifier}`);if(t[a.type]==null)throw Error(`Certificate with type ${a.type} was not requested`)}await a.decryptFields(e,void 0,void 0,r)}))};var Lp=`0.1`,Rp=class{sessionManager;transport;wallet;certificatesToRequest;onGeneralMessageReceivedCallbacks=new Map;onCertificatesReceivedCallbacks=new Map;onCertificateRequestReceivedCallbacks=new Map;onInitialResponseReceivedCallbacks=new Map;callbackIdCounter=0;autoPersistLastSession=!0;lastInteractedWithPeer;originator;constructor(e,t,n,r,i,a){this.wallet=e,this.originator=a,this.transport=t,this.certificatesToRequest=n??{certifiers:[],types:{}},this.transport.onData(this.handleIncomingMessage.bind(this)).catch(e=>{throw e}),this.sessionManager=r??new Mp,i===!1?this.autoPersistLastSession=!1:this.autoPersistLastSession=!0}async toPeer(e,t,n){this.autoPersistLastSession&&typeof this.lastInteractedWithPeer==`string`&&typeof t!=`string`&&(t=this.lastInteractedWithPeer);let r=await this.getAuthenticatedSession(t,n),i=$l(Qu(32)),{signature:a}=await this.wallet.createSignature({data:e,protocolID:[2,`auth message signature`],keyID:`${i} ${r.peerNonce??``}`,counterparty:r.peerIdentityKey},this.originator),o={version:Lp,messageType:`general`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,nonce:i,yourNonce:r.peerNonce,payload:e,signature:a};r.lastUpdate=Date.now(),this.sessionManager.updateSession(r);try{await this.transport.send(o)}catch(e){this.propagateTransportError(r.peerIdentityKey,e)}}async requestCertificates(e,t,n=1e4){this.autoPersistLastSession&&typeof this.lastInteractedWithPeer==`string`&&typeof t!=`string`&&(t=this.lastInteractedWithPeer);let r=await this.getAuthenticatedSession(t,n),i=$l(Qu(32)),{signature:a}=await this.wallet.createSignature({data:U(JSON.stringify(e),`utf8`),protocolID:[2,`auth message signature`],keyID:`${i} ${r.peerNonce??``}`,counterparty:r.peerIdentityKey},this.originator),o={version:Lp,messageType:`certificateRequest`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,nonce:i,initialNonce:r.sessionNonce,yourNonce:r.peerNonce,requestedCertificates:e,signature:a};r.lastUpdate=Date.now(),this.sessionManager.updateSession(r);try{await this.transport.send(o)}catch(e){this.propagateTransportError(r.peerIdentityKey,e)}}async getAuthenticatedSession(e,t){if(this.transport===void 0)throw Error(`Peer transport is not connected!`);let n;if(typeof e==`string`&&(n=this.sessionManager.getSession(e)),n==null||!n.isAuthenticated){let r=await this.initiateHandshake(e,t);if(n=this.sessionManager.getSession(r),n==null||!n.isAuthenticated)throw Error(`Unable to establish mutual authentication with peer!`)}return n}listenForGeneralMessages(e){let t=this.callbackIdCounter++;return this.onGeneralMessageReceivedCallbacks.set(t,e),t}stopListeningForGeneralMessages(e){this.onGeneralMessageReceivedCallbacks.delete(e)}listenForCertificatesReceived(e){let t=this.callbackIdCounter++;return this.onCertificatesReceivedCallbacks.set(t,e),t}stopListeningForCertificatesReceived(e){this.onCertificatesReceivedCallbacks.delete(e)}listenForCertificatesRequested(e){let t=this.callbackIdCounter++;return this.onCertificateRequestReceivedCallbacks.set(t,e),t}stopListeningForCertificatesRequested(e){this.onCertificateRequestReceivedCallbacks.delete(e)}async initiateHandshake(e,t=1e4){let n=await Pp(this.wallet,void 0,this.originator),r=Date.now();this.sessionManager.addSession({isAuthenticated:!1,sessionNonce:n,peerIdentityKey:e,lastUpdate:r});let i={version:Lp,messageType:`initialRequest`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,initialNonce:n,requestedCertificates:this.certificatesToRequest};return await this.transport.send(i),await this.waitForInitialResponse(n,t)}async waitForInitialResponse(e,t=1e4){return await new Promise((n,r)=>{let i=this.listenForInitialResponse(e,e=>{clearTimeout(a),this.stopListeningForInitialResponses(i),n(e)}),a=setTimeout(()=>{this.stopListeningForInitialResponses(i),r(Error(`Initial response timed out.`))},t)})}listenForInitialResponse(e,t){let n=this.callbackIdCounter++;return this.onInitialResponseReceivedCallbacks.set(n,{callback:t,sessionNonce:e}),n}stopListeningForInitialResponses(e){this.onInitialResponseReceivedCallbacks.delete(e)}propagateTransportError(e,t){if(t instanceof Error){if(e!=null){let n=t.details;typeof n==`object`&&n?n.peerIdentityKey??=e:t.details={peerIdentityKey:e}}throw t}let n=`Failed to send message to peer ${e??`unknown`}: ${String(t)}`;throw Error(n)}async handleIncomingMessage(e){if(typeof e.version!=`string`||e.version!==Lp)throw Error(`Invalid or unsupported message auth version! Received: ${e.version}, expected: ${Lp}`);switch(e.messageType){case`initialRequest`:await this.processInitialRequest(e);break;case`initialResponse`:await this.processInitialResponse(e);break;case`certificateRequest`:await this.processCertificateRequest(e);break;case`certificateResponse`:await this.processCertificateResponse(e);break;case`general`:await this.processGeneralMessage(e);break;default:throw Error(`Unknown message type of ${String(e.messageType)} from ${String(e.identityKey)}`)}}async processInitialRequest(e){if(typeof e.identityKey!=`string`||typeof e.initialNonce!=`string`||e.initialNonce===``)throw Error(`Missing required fields in initialRequest message.`);let t=await Pp(this.wallet,void 0,this.originator),n=Date.now();this.sessionManager.addSession({isAuthenticated:!0,sessionNonce:t,peerNonce:e.initialNonce,peerIdentityKey:e.identityKey,lastUpdate:n});let r;e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0&&(this.onCertificateRequestReceivedCallbacks.size>0?this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)}):r=await Fp(this.wallet,e.requestedCertificates,e.identityKey,this.originator));let{signature:i}=await this.wallet.createSignature({data:U(e.initialNonce+t,`base64`),protocolID:[2,`auth message signature`],keyID:`${e.initialNonce} ${t}`,counterparty:e.identityKey},this.originator),a={version:Lp,messageType:`initialResponse`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,initialNonce:t,yourNonce:e.initialNonce,certificates:r,requestedCertificates:this.certificatesToRequest,signature:i};this.lastInteractedWithPeer===void 0&&(this.lastInteractedWithPeer=e.identityKey),await this.transport.send(a)}async processInitialResponse(e){if(!await Np(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Initial response nonce verification failed from peer: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Peer session not found for peer: ${e.identityKey}`);let n=U((t.sessionNonce??``)+(e.initialNonce??``),`base64`),{valid:r}=await this.wallet.verifySignature({data:n,signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${t.sessionNonce??``} ${e.initialNonce??``}`,counterparty:e.identityKey},this.originator);if(!r)throw Error(`Unable to verify initial response signature for peer: ${e.identityKey}`);if(t.peerNonce=e.initialNonce,t.peerIdentityKey=e.identityKey,t.isAuthenticated=!0,t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),this.certificatesToRequest?.certifiers?.length>0&&e.certificates?.length>0&&(await Ip(this.wallet,e,this.certificatesToRequest,this.originator),this.onCertificatesReceivedCallbacks.forEach(t=>t(e.identityKey,e.certificates))),this.lastInteractedWithPeer=e.identityKey,this.onInitialResponseReceivedCallbacks.forEach(e=>{e.sessionNonce===t.sessionNonce&&e.callback(t.sessionNonce)}),e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)});else{let t=await Fp(this.wallet,e.requestedCertificates,e.identityKey,this.originator);await this.sendCertificateResponse(e.identityKey,t)}}async processCertificateRequest(e){if(!await Np(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Unable to verify nonce for certificate request message from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:U(JSON.stringify(e.requestedCertificates),`utf8`),signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:t.peerIdentityKey},this.originator);if(!n)throw Error(`Invalid signature in certificate request message from ${t.peerIdentityKey}`);if(t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)});else{let t=await Fp(this.wallet,e.requestedCertificates,e.identityKey,this.originator);await this.sendCertificateResponse(e.identityKey,t)}}async sendCertificateResponse(e,t){let n=await this.getAuthenticatedSession(e),r=$l(Qu(32)),{signature:i}=await this.wallet.createSignature({data:U(JSON.stringify(t),`utf8`),protocolID:[2,`auth message signature`],keyID:`${r} ${n.peerNonce??``}`,counterparty:n.peerIdentityKey},this.originator),a={version:Lp,messageType:`certificateResponse`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,nonce:r,initialNonce:n.sessionNonce,yourNonce:n.peerNonce,certificates:t,signature:i};n.lastUpdate=Date.now(),this.sessionManager.updateSession(n);try{await this.transport.send(a)}catch(e){this.propagateTransportError(n.peerIdentityKey,e)}}async processCertificateResponse(e){if(!await Np(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Unable to verify nonce for certificate response from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:U(JSON.stringify(e.certificates),`utf8`),signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:e.identityKey},this.originator);if(!n)throw Error(`Unable to verify certificate response signature for peer: ${e.identityKey}`);await Ip(this.wallet,e,e.requestedCertificates,this.originator),this.onCertificatesReceivedCallbacks.forEach(t=>{t(e.identityKey,e.certificates??[])}),t.lastUpdate=Date.now(),this.sessionManager.updateSession(t)}async processGeneralMessage(e){if(!await Np(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Unable to verify nonce for general message from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:e.payload,signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:t.peerIdentityKey},this.originator);if(!n)throw Error(`Invalid signature in generalMessage from ${t.peerIdentityKey}`);t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),this.lastInteractedWithPeer=e.identityKey,this.onGeneralMessageReceivedCallbacks.forEach(t=>{t(e.identityKey,e.payload??[])})}},zp=typeof globalThis<`u`&&typeof globalThis.fetch==`function`?globalThis.fetch.bind(globalThis):fetch,Bp=class{onDataCallback;fetchClient;baseUrl;constructor(e,t=zp){if(typeof t!=`function`)throw Error(`SimplifiedFetchTransport requires a fetch implementation. In environments without fetch, provide a polyfill or custom implementation.`);this.fetchClient=t,this.baseUrl=e}async send(e){if(this.onDataCallback==null)throw Error(`Listen before you start speaking. God gave you two ears and one mouth for a reason.`);if(e.messageType!==`general`)return await new Promise((t,n)=>{(async()=>{try{let n=`${this.baseUrl}/.well-known/auth`,r=(async()=>{try{return await this.fetchClient(n,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(e)})}catch(e){throw this.createNetworkError(n,e)}})();e.messageType!==`initialRequest`&&t();let i=await r;if(!i.ok){let e=Array.from(new Uint8Array(await i.arrayBuffer()));throw this.createUnauthenticatedResponseError(n,i,e)}if(this.onDataCallback!=null){let e=await i.json();this.onDataCallback(e)}e.messageType===`initialRequest`&&t()}catch(e){n(e)}})()});{let t=this.deserializeRequestPayload(e.payload),n=`${this.baseUrl}${t.urlPostfix}`,r=t;if(typeof t.headers!=`object`&&(r.headers={}),r.headers[`x-bsv-auth-version`]=e.version,r.headers[`x-bsv-auth-identity-key`]=e.identityKey,r.headers[`x-bsv-auth-nonce`]=e.nonce,r.headers[`x-bsv-auth-your-nonce`]=e.yourNonce,r.headers[`x-bsv-auth-signature`]=H(e.signature),r.headers[`x-bsv-auth-request-id`]=t.requestId,r.body!=null){let e=r.headers;if(e[`content-type`]==null)throw Error(`Content-Type header is required for requests with a body.`);let t=String(e[`content-type`]??``);t.includes(`application/json`)||t.includes(`application/x-www-form-urlencoded`)||t.includes(`text/plain`)?r.body=W(r.body):r.body=new Uint8Array(r.body)}let i;try{i=await this.fetchClient(n,{method:r.method,headers:r.headers,body:r.body})}catch(e){throw this.createNetworkError(n,e)}let a=await i.arrayBuffer(),o=Array.from(new Uint8Array(a)),s=[`x-bsv-auth-version`,`x-bsv-auth-identity-key`,`x-bsv-auth-signature`].filter(e=>{let t=i.headers.get(e);return t==null||t.trim().length===0});if(s.length>0)throw this.createUnauthenticatedResponseError(n,i,o,s);let c=i.headers.get(`x-bsv-auth-requested-certificates`),l;if(c!=null)try{l=JSON.parse(c)}catch(e){throw this.createMalformedHeaderError(n,`x-bsv-auth-requested-certificates`,c,e)}let u=new au;i.headers.get(`x-bsv-auth-request-id`)!=null&&u.write(U(i.headers.get(`x-bsv-auth-request-id`),`base64`)),u.writeVarIntNum(i.status);let d=[];i.headers.forEach((e,t)=>{let n=t.toLowerCase();(n.startsWith(`x-bsv-`)||n===`authorization`)&&!n.startsWith(`x-bsv-auth`)&&d.push([n,e])}),d.sort(([e],[t])=>e.localeCompare(t)),u.writeVarIntNum(d.length);for(let e=0;e<d.length;e++){let t=U(d[e][0],`utf8`);u.writeVarIntNum(t.length),u.write(t);let n=U(d[e][1],`utf8`);u.writeVarIntNum(n.length),u.write(n)}u.writeVarIntNum(o.length),o.length>0&&u.write(o);let f={version:i.headers.get(`x-bsv-auth-version`),messageType:i.headers.get(`x-bsv-auth-message-type`)===`certificateRequest`?`certificateRequest`:`general`,identityKey:i.headers.get(`x-bsv-auth-identity-key`),nonce:i.headers.get(`x-bsv-auth-nonce`)??void 0,yourNonce:i.headers.get(`x-bsv-auth-your-nonce`)??void 0,requestedCertificates:l,payload:u.toArray(),signature:U(i.headers.get(`x-bsv-auth-signature`),`hex`)};if(f.version==null)throw this.createUnauthenticatedResponseError(n,i,o);this.onDataCallback(f)}}async onData(e){this.onDataCallback=t=>{e(t)}}createNetworkError(e,t){let n=`Network error while sending authenticated request to ${e}`;if(t instanceof Error){let e=Error(`${n}: ${t.message}`);return e.stack=t.stack,e.cause=t,e}return Error(`${n}: ${String(t)}`)}createUnauthenticatedResponseError(e,t,n,r=[]){let i=(t.statusText??``).trim(),a=i.length>0?`${t.status} ${i}`:`${t.status}`,o=r.length>0?`missing headers: ${r.join(`, `)}`:`response lacked required BSV auth headers`,s=this.getBodyPreview(n,t.headers.get(`content-type`)),c=[`Received HTTP ${a} from ${e} without valid BSV authentication (${o})`];s!=null&&c.push(`body preview: ${s}`);let l=Error(c.join(` - `));return l.details={url:e,status:t.status,statusText:t.statusText,missingHeaders:r,bodyPreview:s},l}createMalformedHeaderError(e,t,n,r){let i=`Failed to parse ${t} returned by ${e}: ${n}`;if(r instanceof Error){let e=Error(`${i}. ${r.message}`);return e.stack=r.stack,e.cause=r,e}return Error(`${i}. ${String(r)}`)}getBodyPreview(e,t){if(e.length===0)return;let n=1024,r=e.length>n,i=r?e.slice(0,n):e,a=this.isTextualContent(t,i),o;if(a)try{o=W(i)}catch{o=this.formatBinaryPreview(i,r)}else o=this.formatBinaryPreview(i,r);return o.length>512&&(o=`${o.slice(0,512)}`),r&&(o=`${o} (truncated)`),o}isTextualContent(e,t){if(t.length===0)return!1;if(e!=null){let t=e.toLowerCase();if([`application/json`,`application/problem+json`,`application/xml`,`application/xhtml+xml`,`application/javascript`,`application/ecmascript`,`application/x-www-form-urlencoded`,`text/`].some(e=>t.includes(e))||t.includes(`charset=`))return!0}return t.reduce((e,t)=>t===9||t===10||t===13||t>=32&&t<=126?e+1:e,0)/t.length>.8}formatBinaryPreview(e,t){return`0x${e.map(e=>e.toString(16).padStart(2,`0`)).join(``)}${t?``:``}`}deserializeRequestPayload(e){let t=new ou(e),n=$l(t.read(32)),r=t.readVarIntNum(),i=`GET`;r>0&&(i=W(t.read(r)));let a=t.readVarIntNum(),o=``;a>0&&(o=W(t.read(a)));let s=t.readVarIntNum(),c=``;s>0&&(c=W(t.read(s)));let l={},u=t.readVarIntNum();if(u>0)for(let e=0;e<u;e++){let e=t.readVarIntNum(),n=t.read(e),r=W(n),i=t.readVarIntNum(),a=t.read(i);l[r]=W(a)}let d,f=t.readVarIntNum();return f>0&&(d=t.read(f)),{urlPostfix:o+c,method:i,headers:l,body:d,requestId:n}}},Vp=`1.0`,Hp=class{sessionManager;wallet;callbacks={};certificatesReceived=[];requestedCertificates;originator;peers={};constructor(e,t,n,r){this.wallet=e,this.requestedCertificates=t,this.sessionManager=n??new Mp,this.originator=r}async fetch(e,t={}){if(typeof t.retryCounter==`number`){if(t.retryCounter<=0)throw Error(`Request failed after maximum number of retries.`);t.retryCounter--}let n=await new Promise((async(n,r)=>{try{let{method:i=`GET`,headers:a={},body:o}=t,s=new URL(e),c=s.origin,l;if(this.peers[c]===void 0){let e=new Bp(c);l={peer:new Rp(this.wallet,e,this.requestedCertificates,this.sessionManager,void 0,this.originator),pendingCertificateRequests:[]},this.peers[c]=l,this.peers[c].peer.listenForCertificatesReceived((e,t)=>{this.certificatesReceived.push(...t)}),this.peers[c].peer.listenForCertificatesRequested((async(e,t)=>{try{this.peers[c].pendingCertificateRequests.push(!0);let n=await Fp(this.wallet,t,e,this.originator);await this.peers[c].peer.sendCertificateResponse(e,n)}finally{await new Promise(e=>setTimeout(e,500)),this.peers[c].pendingCertificateRequests.shift()}}))}else{if(this.peers[c].supportsMutualAuth===!1){try{let r=await this.handleFetchAndValidate(e,t,this.peers[c]);n(r)}catch(e){r(e)}return}l=this.peers[c]}let u=Qu(32),d=$l(u),f=await this.serializeRequest(i,a,o,s,u);this.callbacks[d]={resolve:n,reject:r};let p=l.peer.listenForGeneralMessages((e,t)=>{let n=new ou(t);if($l(n.read(32))!==d)return;l.peer.stopListeningForGeneralMessages(p),this.peers[c].identityKey=e,this.peers[c].supportsMutualAuth=!0;let r=n.readVarIntNum(),i={},a=n.readVarIntNum();if(a>0)for(let e=0;e<a;e++){let e=n.readVarIntNum(),t=n.read(e),r=W(t),a=n.readVarIntNum(),o=n.read(a);i[r]=W(o)}i[`x-bsv-auth-identity-key`]=e;let o,s=n.readVarIntNum();s>0&&(o=n.read(s));let u=new Response(o?new Uint8Array(o):null,{status:r,statusText:`${r}`,headers:new Headers(i)});this.callbacks[d].resolve(u),delete this.callbacks[d]});l.pendingCertificateRequests.length>0&&await new Promise(e=>{setInterval(()=>{l.pendingCertificateRequests.length===0&&e()},100)}),await l.peer.toPeer(f.toArray(),l.identityKey).catch(async i=>{if(i.message.includes(`Session not found for nonce`)){delete this.peers[c],t.retryCounter??=3;let r=await this.fetch(e,t);n(r);return}if(i.message.includes(`HTTP server failed to authenticate`))try{let r=await this.handleFetchAndValidate(e,t,l);n(r);return}catch(e){r(e)}else r(i)})}catch(e){r(e)}}));return n.status===402?await this.handlePaymentAndRetry(e,t,n):n}async sendCertificateRequest(e,t){let n=new URL(e).origin,r;if(this.peers[n]!==void 0)r={peer:this.peers[n].peer};else{let e=new Bp(n);r={peer:new Rp(this.wallet,e,this.requestedCertificates,this.sessionManager,this.originator)},this.peers[n]=r}return await new Promise((async(e,n)=>{let i=r.peer.listenForCertificatesReceived((t,n)=>{r.peer.stopListeningForCertificatesReceived(i),this.certificatesReceived.push(...n),e(n)});try{await r.peer.requestCertificates(t,r.identityKey)}catch(e){r.peer.stopListeningForCertificatesReceived(i),n(e)}}))}consumeReceivedCertificates(){return this.certificatesReceived.splice(0)}async serializeRequest(e,t,n,r,i){let a=new au;if(a.write(i),a.writeVarIntNum(e.length),a.write(U(e)),r.pathname.length>0){let e=U(r.pathname);a.writeVarIntNum(e.length),a.write(e)}else a.writeVarIntNum(-1);if(r.search.length>0){let e=U(r.search);a.writeVarIntNum(e.length),a.write(e)}else a.writeVarIntNum(-1);let o=[];for(let[e,n]of Object.entries(t))if(e=e.toLowerCase(),e.startsWith(`x-bsv-`)||e===`authorization`){if(e.startsWith(`x-bsv-auth`))throw Error(`No BSV auth headers allowed here!`);o.push([e,n])}else if(e.startsWith(`content-type`))n=n.split(`;`)[0].trim(),o.push([e,n]);else throw Error(`Unsupported header in the simplified fetch implementation. Only content-type, authorization, and x-bsv-* headers are supported.`);o.sort(([e],[t])=>e.localeCompare(t)),a.writeVarIntNum(o.length);for(let e=0;e<o.length;e++){let t=U(o[e][0],`utf8`);a.writeVarIntNum(t.length),a.write(t);let n=U(o[e][1],`utf8`);a.writeVarIntNum(n.length),a.write(n)}if([`POST`,`PUT`,`PATCH`,`DELETE`].includes(e.toUpperCase())&&n===void 0){let e=o.find(([e])=>e===`content-type`);n=e&&e[1].includes(`application/json`)?`{}`:``}if(n){let e=await this.normalizeBodyToNumberArray(n);a.writeVarIntNum(e.length),a.write(e)}else a.writeVarIntNum(-1);return a}async handleFetchAndValidate(e,t,n){let r=await fetch(e,t);if(r.headers.forEach(e=>{if(e.toLocaleLowerCase().startsWith(`x-bsv`))throw Error(`The server is trying to claim it has been authenticated when it has not!`)}),r.ok)return n.supportsMutualAuth=!1,r;throw Error(`Request failed with status: ${r.status}`)}async handlePaymentAndRetry(e,t={},n){let r=n.headers.get(`x-bsv-payment-version`);if(!r||r!==Vp)throw Error(`Unsupported x-bsv-payment-version response header. Client version: ${Vp}, Server version: ${r}`);let i=n.headers.get(`x-bsv-payment-satoshis-required`);if(!i)throw Error(`Missing x-bsv-payment-satoshis-required response header.`);let a=parseInt(i);if(isNaN(a)||a<=0)throw Error(`Invalid x-bsv-payment-satoshis-required response header value.`);let o=n.headers.get(`x-bsv-auth-identity-key`);if(typeof o!=`string`)throw Error(`Missing x-bsv-auth-identity-key response header.`);let s=n.headers.get(`x-bsv-payment-derivation-prefix`);if(typeof s!=`string`||s.length<1)throw Error(`Missing x-bsv-payment-derivation-prefix response header.`);let c=t.paymentContext;if(c==null?c=await this.createPaymentContext(e,t,a,o,s):this.isPaymentContextCompatible(c,a,o,s)||(this.logPaymentAttempt(`warn`,`Server adjusted payment requirements; regenerating transaction`,this.composePaymentLogDetails(e,c)),c=await this.createPaymentContext(e,t,a,o,s)),c.attempts>=c.maxAttempts)throw this.buildPaymentFailureError(e,c,Error(`Maximum payment attempts exceeded before retrying`));let l={...t.headers??{}};l[`x-bsv-payment`]=JSON.stringify({derivationPrefix:c.derivationPrefix,derivationSuffix:c.derivationSuffix,transaction:c.transactionBase64});let u={...t,headers:l,paymentContext:c};typeof u.retryCounter!=`number`&&(u.retryCounter=3);let d=c.attempts+1,f=c.maxAttempts;c.attempts=d;let p=this.composePaymentLogDetails(e,c);this.logPaymentAttempt(`warn`,`Attempting paid request (${d}/${f})`,p);try{let t=await this.fetch(e,u);return this.logPaymentAttempt(`info`,`Paid request attempt ${d} succeeded`,p),t}catch(t){let r=this.createPaymentErrorEntry(c.attempts,t);if(c.errors.push(r),this.logPaymentAttempt(`error`,`Paid request attempt ${d} failed`,{...p,error:{message:r.message,stack:r.stack}}),c.attempts>=c.maxAttempts)throw this.buildPaymentFailureError(e,c,t);let i=this.getPaymentRetryDelay(c.attempts);return await this.wait(i),this.handlePaymentAndRetry(e,u,n)}}isPaymentContextCompatible(e,t,n,r){return e.satoshisRequired===t&&e.serverIdentityKey===n&&e.derivationPrefix===r}async createPaymentContext(e,t,n,r,i){let a=await Pp(this.wallet,void 0,this.originator),{publicKey:o}=await this.wallet.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${i} ${a}`,counterparty:r},this.originator),s=new Gd().lock(Yu.fromString(o).toAddress()).toHex(),{tx:c}=await this.wallet.createAction({description:`Payment for request to ${new URL(e).origin}`,outputs:[{satoshis:n,lockingScript:s,customInstructions:JSON.stringify({derivationPrefix:i,derivationSuffix:a,payee:r}),outputDescription:`HTTP request payment`}],options:{randomizeOutputs:!1}},this.originator),{publicKey:l}=await this.wallet.getPublicKey({identityKey:!0},this.originator);return{satoshisRequired:n,transactionBase64:$l(c),derivationPrefix:i,derivationSuffix:a,serverIdentityKey:r,clientIdentityKey:l,attempts:0,maxAttempts:this.getMaxPaymentAttempts(t),errors:[],requestSummary:this.buildPaymentRequestSummary(e,t)}}getMaxPaymentAttempts(e){let t=typeof e.paymentRetryAttempts==`number`?e.paymentRetryAttempts:void 0;return typeof t==`number`&&t>0?Math.floor(t):3}buildPaymentRequestSummary(e,t){let n={...t.headers??{}},r=typeof t.method==`string`?t.method.toUpperCase():`GET`,i=this.describeRequestBodyForLogging(t.body);return{url:e,method:r,headers:n,bodyType:i.type,bodyByteLength:i.byteLength}}describeRequestBodyForLogging(e){if(e==null)return{type:`none`,byteLength:0};if(typeof e==`string`)return{type:`string`,byteLength:U(e,`utf8`).length};if(Array.isArray(e))return e.every(e=>typeof e==`number`)?{type:`number[]`,byteLength:e.length}:{type:`array`,byteLength:e.length};if(typeof ArrayBuffer<`u`&&e instanceof ArrayBuffer)return{type:`ArrayBuffer`,byteLength:e.byteLength};if(typeof ArrayBuffer<`u`&&ArrayBuffer.isView(e))return{type:e.constructor==null?`TypedArray`:e.constructor.name,byteLength:e.byteLength};if(typeof Blob<`u`&&e instanceof Blob)return{type:`Blob`,byteLength:e.size};if(typeof FormData<`u`&&e instanceof FormData)return{type:`FormData`,byteLength:0};if(typeof URLSearchParams<`u`&&e instanceof URLSearchParams){let t=e.toString();return{type:`URLSearchParams`,byteLength:U(t,`utf8`).length}}if(typeof ReadableStream<`u`&&e instanceof ReadableStream)return{type:`ReadableStream`,byteLength:0};try{let t=JSON.stringify(e);if(typeof t==`string`)return{type:`object`,byteLength:U(t,`utf8`).length}}catch{}return{type:typeof e,byteLength:0}}composePaymentLogDetails(e,t){return{url:e,request:t.requestSummary,payment:{satoshis:t.satoshisRequired,transactionBase64:t.transactionBase64,derivationPrefix:t.derivationPrefix,derivationSuffix:t.derivationSuffix,serverIdentityKey:t.serverIdentityKey,clientIdentityKey:t.clientIdentityKey},attempts:{used:t.attempts,max:t.maxAttempts},errors:t.errors}}logPaymentAttempt(e,t,n){let r=`[AuthFetch][Payment]`;e===`error`?console.error(`${r} ${t}`,n):e===`warn`?console.warn(`${r} ${t}`,n):typeof console.info==`function`?console.info(`${r} ${t}`,n):console.log(`${r} ${t}`,n)}createPaymentErrorEntry(e,t){let n={attempt:e,timestamp:new Date().toISOString(),message:``,stack:void 0};return t instanceof Error?(n.message=t.message,n.stack=t.stack??void 0):n.message=String(t),n}getPaymentRetryDelay(e){return 250*Math.min(e,5)}async wait(e){e<=0||await new Promise(t=>setTimeout(t,e))}buildPaymentFailureError(e,t,n){let r=`Paid request to ${e} failed after ${t.attempts}/${t.maxAttempts} attempts. Sent ${t.satoshisRequired} satoshis to ${t.serverIdentityKey}.`,i=Error(r);return i.details={request:t.requestSummary,payment:{satoshis:t.satoshisRequired,transactionBase64:t.transactionBase64,derivationPrefix:t.derivationPrefix,derivationSuffix:t.derivationSuffix,serverIdentityKey:t.serverIdentityKey,clientIdentityKey:t.clientIdentityKey},attempts:{used:t.attempts,max:t.maxAttempts},errors:t.errors},n instanceof Error&&(i.cause=n),i}async normalizeBodyToNumberArray(e){if(e==null)return[];if(typeof e==`object`)return U(JSON.stringify(e,`utf8`));if(Array.isArray(e)&&e.every(e=>typeof e==`number`))return e;if(typeof e==`string`)return U(e,`utf8`);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)){let t=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer);return Array.from(t)}if(e instanceof Blob){let t=await e.arrayBuffer();return Array.from(new Uint8Array(t))}if(e instanceof FormData){let t=[];e.forEach((e,n)=>{t.push([n,e.toString()])});let n=new URLSearchParams(t).toString();return U(n,`utf8`)}if(e instanceof URLSearchParams)return U(e.toString(),`utf8`);throw e instanceof ReadableStream?Error(`ReadableStream cannot be directly converted to number[].`):Error(`Unsupported body type in this SimplifiedFetch implementation.`)}},Up=class{pushDrop;static decode(e){let t=qd.decode(e);if(t.fields.length<4)throw Error(`Invalid SHIP/SLAP advertisement!`);let n=W(t.fields[0]);if(n!==`SHIP`&&n!==`SLAP`)throw Error(`Invalid protocol type!`);let r=H(t.fields[1]),i=W(t.fields[2]),a=W(t.fields[3]);return{protocol:n,identityKey:r,domain:i,topicOrService:a}}constructor(e){this.pushDrop=new qd(e)}async lock(e,t,n){let{publicKey:r}=await this.pushDrop.wallet.getPublicKey({identityKey:!0});return await this.pushDrop.lock([U(e,`utf8`),U(r,`hex`),U(t,`utf8`),U(n,`utf8`)],[2,e===`SHIP`?`Service Host Interconnect`:`Service Lookup Availability`],`1`,`self`)}unlock(e){return this.pushDrop.unlock([2,e===`SHIP`?`Service Host Interconnect`:`Service Lookup Availability`],`1`,`self`)}},Wp=typeof globalThis<`u`&&typeof globalThis.fetch==`function`?globalThis.fetch.bind(globalThis):fetch;const Gp=[`https://overlay-us-1.bsvb.tech`,`https://overlay-eu-1.bsvb.tech`,`https://overlay-ap-1.bsvb.tech`,`https://users.bapp.dev`],Kp=[`https://testnet-users.bapp.dev`];var qp=5e3,Jp=class{fetchClient;allowHTTP;constructor(e=Wp,t=!1){if(typeof e!=`function`)throw Error(`HTTPSOverlayLookupFacilitator requires a fetch implementation. In environments without fetch, provide a polyfill or custom implementation.`);this.fetchClient=e,this.allowHTTP=t}async lookup(e,t,n=5e3){if(!e.startsWith(`https:`)&&!this.allowHTTP)throw Error(`HTTPS facilitator can only use URLs that start with "https:"`);let r=typeof AbortController<`u`?new AbortController:void 0,i=setTimeout(()=>{try{r?.abort()}catch{}},n);try{let n={method:`POST`,headers:{"Content-Type":`application/json`,"X-Aggregation":`yes`},body:JSON.stringify({service:t.service,query:t.query}),signal:r?.signal},i=await this.fetchClient(`${e}/lookup`,n);if(!i.ok)throw Error(`Failed to facilitate lookup (HTTP ${i.status})`);if(i.headers.get(`content-type`)===`application/octet-stream`){let e=await i.arrayBuffer(),t=new ou([...new Uint8Array(e)]),n=t.readVarIntNum(),r=[];for(let e=0;e<n;e++){let e=H(t.read(32)),n=t.readVarIntNum(),i=t.readVarIntNum(),a;i>0&&(a=t.read(i)),r.push({txid:e,outputIndex:n,context:a})}let a=t.read();return{type:`output-list`,outputs:r.map(e=>({outputIndex:e.outputIndex,context:e.context,beef:pf.fromBEEF(a,e.txid).toBEEF()}))}}else return await i.json()}catch(e){throw e?.name===`AbortError`?Error(`Request timed out`):e}finally{clearTimeout(i)}}},Yp=class{facilitator;slapTrackers;hostOverrides;additionalHosts;networkPreset;hostsCache;hostsInFlight;hostsTtlMs;hostsMaxEntries;txMemo;txMemoTtlMs;constructor(e={}){this.networkPreset=e.networkPreset??`mainnet`,this.facilitator=e.facilitator??new Jp(void 0,this.networkPreset===`local`),this.slapTrackers=e.slapTrackers??(this.networkPreset===`mainnet`?Gp:Kp);let t=e.hostOverrides??{};this.assertValidOverrideServices(t),this.hostOverrides=t,this.additionalHosts=e.additionalHosts??{},this.hostsTtlMs=e.cache?.hostsTtlMs??300*1e3,this.hostsMaxEntries=e.cache?.hostsMaxEntries??128,this.txMemoTtlMs=e.cache?.txMemoTtlMs??600*1e3,this.hostsCache=new Map,this.hostsInFlight=new Map,this.txMemo=new Map}async query(e,t){let n=[];if(n=e.service===`ls_slap`?this.networkPreset===`local`?[`http://localhost:8080`]:this.slapTrackers:this.hostOverrides[e.service]==null?this.networkPreset===`local`?[`http://localhost:8080`]:await this.getCompetentHostsCached(e.service):this.hostOverrides[e.service],this.additionalHosts[e.service]?.length>0){let t=this.additionalHosts[e.service],r=new Set(n);for(let e of t)r.has(e)||n.push(e)}if(n.length<1)throw Error(`No competent ${this.networkPreset} hosts found by the SLAP trackers for lookup service: ${e.service}`);let r=await Promise.allSettled(n.map(async n=>await this.facilitator.lookup(n,e,t))),i=new Map,a=e=>typeof e==`object`?e.join(`,`):``;for(let e of r){if(e.status!==`fulfilled`)continue;let t=e.value;if(!(t?.type!==`output-list`||!Array.isArray(t.outputs)))for(let e of t.outputs){let t=a(e.beef),n=this.txMemo.get(t),r=Date.now();if(typeof n!=`object`||!n||n.expiresAt<=r)try{n={txId:pf.fromBEEF(e.beef).id(`hex`),expiresAt:r+this.txMemoTtlMs},this.txMemo.size>4096&&this.evictOldest(this.txMemo),this.txMemo.set(t,n)}catch{continue}let o=`${n.txId}.${e.outputIndex}`;i.set(o,e)}}return{type:`output-list`,outputs:Array.from(i.values())}}async getCompetentHostsCached(e){let t=Date.now(),n=this.hostsCache.get(e);if(typeof n==`object`&&n.expiresAt>t)return n.hosts.slice();if(typeof n==`object`&&n.expiresAt<=t)return this.hostsInFlight.has(e)||this.hostsInFlight.set(e,this.refreshHosts(e).finally(()=>{this.hostsInFlight.delete(e)})),n.hosts.slice();if(this.hostsInFlight.has(e))try{let t=await this.hostsInFlight.get(e);if(typeof t!=`object`)throw Error(`Hosts is not defined.`);return t.slice()}catch{}let r=this.refreshHosts(e).finally(()=>{this.hostsInFlight.delete(e)});return this.hostsInFlight.set(e,r),(await r).slice()}async refreshHosts(e){let t=await this.findCompetentHosts(e),n=Date.now()+this.hostsTtlMs;if(!this.hostsCache.has(e)&&this.hostsCache.size>=this.hostsMaxEntries){let e=this.hostsCache.keys().next().value;e!==void 0&&this.hostsCache.delete(e)}return this.hostsCache.set(e,{hosts:t,expiresAt:n}),t}async findCompetentHosts(e){let t={service:`ls_slap`,query:{service:e}},n=await Promise.allSettled(this.slapTrackers.map(async e=>await this.facilitator.lookup(e,t,qp))),r=new Set;for(let t of n){if(t.status!==`fulfilled`)continue;let n=t.value;if(n.type===`output-list`)for(let t of n.outputs)try{let n=pf.fromBEEF(t.beef).outputs[t.outputIndex]?.lockingScript;if(typeof n!=`object`||!n)continue;let i=Up.decode(n);if(i.topicOrService!==e||i.protocol!==`SLAP`)continue;typeof i.domain==`string`&&i.domain.length>0&&r.add(i.domain)}catch{continue}}return[...r]}evictOldest(e){let t=e.keys().next().value;t!==void 0&&e.delete(t)}assertValidOverrideServices(e){for(let t of Object.keys(e))if(!t.startsWith(`ls_`))throw Error(`Host override service names must start with "ls_": ${t}`)}},Xp=5e3,Zp=class{httpClient;allowHTTP;constructor(e=fetch,t=!1){this.httpClient=e,this.allowHTTP=t}async send(e,t){if(!e.startsWith(`https:`)&&!this.allowHTTP)throw Error(`HTTPS facilitator can only use URLs that start with "https:"`);let n={"Content-Type":`application/octet-stream`,"X-Topics":JSON.stringify(t.topics)},r;if(Array.isArray(t.offChainValues)){n[`x-includes-off-chain-values`]=`true`;let e=new au;e.writeVarIntNum(t.beef.length),e.write(t.beef),e.write(t.offChainValues),r=new Uint8Array(e.toArray())}else r=new Uint8Array(t.beef);let i=await fetch(`${e}/submit`,{method:`POST`,headers:n,body:r});if(i.ok)return await i.json();throw Error(`Failed to facilitate broadcast`)}},Qp=class{topics;facilitator;resolver;requireAcknowledgmentFromAllHostsForTopics;requireAcknowledgmentFromAnyHostForTopics;requireAcknowledgmentFromSpecificHostsForTopics;networkPreset;constructor(e,t={}){if(e.length===0)throw Error(`At least one topic is required for broadcast.`);if(e.some(e=>!e.startsWith(`tm_`)))throw Error(`Every topic must start with "tm_".`);this.topics=e,this.networkPreset=t.networkPreset??`mainnet`,this.facilitator=t.facilitator??new Zp(void 0,this.networkPreset===`local`),this.resolver=t.resolver??new Yp({networkPreset:this.networkPreset}),this.requireAcknowledgmentFromAllHostsForTopics=t.requireAcknowledgmentFromAllHostsForTopics??[],this.requireAcknowledgmentFromAnyHostForTopics=t.requireAcknowledgmentFromAnyHostForTopics??`all`,this.requireAcknowledgmentFromSpecificHostsForTopics=t.requireAcknowledgmentFromSpecificHostsForTopics??{}}async broadcast(e){let t,n=e.metadata.get(`OffChainValues`);try{t=e.toBEEF()}catch{throw Error(`Transactions sent via SHIP to Overlay Services must be serializable to BEEF format.`)}let r=await this.findInterestedHosts();if(Object.keys(r).length===0)return{status:`error`,code:`ERR_NO_HOSTS_INTERESTED`,description:`No ${this.networkPreset} hosts are interested in receiving this transaction.`};let i=Object.entries(r).map(async([e,r])=>{try{let i=await this.facilitator.send(e,{beef:t,offChainValues:n,topics:[...r]});if(i==null||Object.keys(i).length===0)throw Error(`Steak has no topics.`);return{host:e,success:!0,steak:i}}catch(t){return console.error(t),{host:e,success:!1,error:t}}}),a=(await Promise.all(i)).filter(e=>e.success);if(a.length===0)return{status:`error`,code:`ERR_ALL_HOSTS_REJECTED`,description:`All ${this.networkPreset} topical hosts have rejected the transaction.`};let o={};for(let e of a){let t=e.host,n=e.steak,r=new Set;for(let[e,t]of Object.entries(n)){let n=t.outputsToAdmit,i=t.coinsToRetain,a=t.coinsRemoved;(n?.length>0||i?.length>0||a?.length>0)&&r.add(e)}o[t]=r}let s,c;if(this.requireAcknowledgmentFromAllHostsForTopics===`all`?(s=this.topics,c=`all`):this.requireAcknowledgmentFromAllHostsForTopics===`any`?(s=this.topics,c=`any`):Array.isArray(this.requireAcknowledgmentFromAllHostsForTopics)?(s=this.requireAcknowledgmentFromAllHostsForTopics,c=`all`):(s=this.topics,c=`all`),s.length>0&&!this.checkAcknowledgmentFromAllHosts(o,s,c))return{status:`error`,code:`ERR_REQUIRE_ACK_FROM_ALL_HOSTS_FAILED`,description:`Not all hosts acknowledged the required topics.`};let l,u;return this.requireAcknowledgmentFromAnyHostForTopics===`all`?(l=this.topics,u=`all`):this.requireAcknowledgmentFromAnyHostForTopics===`any`?(l=this.topics,u=`any`):Array.isArray(this.requireAcknowledgmentFromAnyHostForTopics)?(l=this.requireAcknowledgmentFromAnyHostForTopics,u=`all`):(l=[],u=`all`),l.length>0&&!this.checkAcknowledgmentFromAnyHost(o,l,u)?{status:`error`,code:`ERR_REQUIRE_ACK_FROM_ANY_HOST_FAILED`,description:`No host acknowledged the required topics.`}:Object.keys(this.requireAcknowledgmentFromSpecificHostsForTopics).length>0&&!this.checkAcknowledgmentFromSpecificHosts(o,this.requireAcknowledgmentFromSpecificHostsForTopics)?{status:`error`,code:`ERR_REQUIRE_ACK_FROM_SPECIFIC_HOSTS_FAILED`,description:`Specific hosts did not acknowledge the required topics.`}:{status:`success`,txid:e.id(`hex`),message:`Sent to ${a.length} Overlay Services ${a.length===1?`host`:`hosts`}.`}}checkAcknowledgmentFromAllHosts(e,t,n){for(let r of Object.values(e))if(n===`all`){for(let e of t)if(!r.has(e))return!1}else if(n===`any`){let e=!1;for(let n of t)if(r.has(n)){e=!0;break}if(!e)return!1}return!0}checkAcknowledgmentFromAnyHost(e,t,n){if(n===`all`){for(let n of Object.values(e)){let e=!0;for(let r of t)if(!n.has(r)){e=!1;break}if(e)return!0}return!1}else{for(let n of Object.values(e))for(let e of t)if(n.has(e))return!0;return!1}}checkAcknowledgmentFromSpecificHosts(e,t){for(let[n,r]of Object.entries(t)){let t=e[n];if(t==null)return!1;let i,a;if(r===`all`||r===`any`)a=r,i=this.topics;else if(Array.isArray(r))i=r,a=`all`;else continue;if(a===`all`){for(let e of i)if(!t.has(e))return!1}else if(a===`any`){let e=!1;for(let n of i)if(t.has(n)){e=!0;break}if(!e)return!1}}return!0}async findInterestedHosts(){if(this.networkPreset===`local`){let e=new Set;for(let t=0;t<this.topics.length;t++)e.add(this.topics[t]);return{"http://localhost:8080":e}}let e={},t=await this.resolver.query({service:`ls_ship`,query:{topics:this.topics}},Xp);if(t.type!==`output-list`)throw Error(`SHIP answer is not an output list.`);for(let n of t.outputs)try{let t=pf.fromBEEF(n.beef).outputs[n.outputIndex].lockingScript,r=Up.decode(t);if(!this.topics.includes(r.topicOrService)||r.protocol!==`SHIP`)continue;e[r.domain]===void 0&&(e[r.domain]=new Set),e[r.domain].add(r.topicOrService)}catch{continue}return e}},$p=Object.create(null);$p.open=`0`,$p.close=`1`,$p.ping=`2`,$p.pong=`3`,$p.message=`4`,$p.upgrade=`5`,$p.noop=`6`;var em=Object.create(null);Object.keys($p).forEach(e=>{em[$p[e]]=e});var tm={type:`error`,data:`parser error`},nm=typeof Blob==`function`||typeof Blob<`u`&&Object.prototype.toString.call(Blob)===`[object BlobConstructor]`,rm=typeof ArrayBuffer==`function`,im=e=>typeof ArrayBuffer.isView==`function`?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,am=({type:e,data:t},n,r)=>nm&&t instanceof Blob?n?r(t):om(t,r):rm&&(t instanceof ArrayBuffer||im(t))?n?r(t):om(new Blob([t]),r):r($p[e]+(t||``)),om=(e,t)=>{let n=new FileReader;return n.onload=function(){let e=n.result.split(`,`)[1];t(`b`+(e||``))},n.readAsDataURL(e)};function sm(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var cm;function lm(e,t){if(nm&&e.data instanceof Blob)return e.data.arrayBuffer().then(sm).then(t);if(rm&&(e.data instanceof ArrayBuffer||im(e.data)))return t(sm(e.data));am(e,!1,e=>{cm||=new TextEncoder,t(cm.encode(e))})}var um=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,dm=typeof Uint8Array>`u`?[]:new Uint8Array(256);for(let e=0;e<64;e++)dm[um.charCodeAt(e)]=e;const fm=e=>{let t=e.length*.75,n=e.length,r,i=0,a,o,s,c;e[e.length-1]===`=`&&(t--,e[e.length-2]===`=`&&t--);let l=new ArrayBuffer(t),u=new Uint8Array(l);for(r=0;r<n;r+=4)a=dm[e.charCodeAt(r)],o=dm[e.charCodeAt(r+1)],s=dm[e.charCodeAt(r+2)],c=dm[e.charCodeAt(r+3)],u[i++]=a<<2|o>>4,u[i++]=(o&15)<<4|s>>2,u[i++]=(s&3)<<6|c&63;return l};var pm=typeof ArrayBuffer==`function`;const mm=(e,t)=>{if(typeof e!=`string`)return{type:`message`,data:gm(e,t)};let n=e.charAt(0);return n===`b`?{type:`message`,data:hm(e.substring(1),t)}:em[n]?e.length>1?{type:em[n],data:e.substring(1)}:{type:em[n]}:tm};var hm=(e,t)=>{if(pm){let n=fm(e);return gm(n,t)}else return{base64:!0,data:e}},gm=(e,t)=>{switch(t){case`blob`:return e instanceof Blob?e:new Blob([e]);case`arraybuffer`:default:return e instanceof ArrayBuffer?e:e.buffer}},_m=``,vm=(e,t)=>{let n=e.length,r=Array(n),i=0;e.forEach((e,a)=>{am(e,!1,e=>{r[a]=e,++i===n&&t(r.join(_m))})})},ym=(e,t)=>{let n=e.split(_m),r=[];for(let e=0;e<n.length;e++){let i=mm(n[e],t);if(r.push(i),i.type===`error`)break}return r};function bm(){return new TransformStream({transform(e,t){lm(e,n=>{let r=n.length,i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);let e=new DataView(i.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{i=new Uint8Array(9);let e=new DataView(i.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&typeof e.data!=`string`&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}var xm;function Sm(e){return e.reduce((e,t)=>e+t.length,0)}function Cm(e,t){if(e[0].length===t)return e.shift();let n=new Uint8Array(t),r=0;for(let i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function wm(e,t){xm||=new TextDecoder;let n=[],r=0,i=-1,a=!1;return new TransformStream({transform(o,s){for(n.push(o);;){if(r===0){if(Sm(n)<1)break;let e=Cm(n,1);a=(e[0]&128)==128,i=e[0]&127,r=i<126?3:i===126?1:2}else if(r===1){if(Sm(n)<2)break;let e=Cm(n,2);i=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(r===2){if(Sm(n)<8)break;let e=Cm(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),a=t.getUint32(0);if(a>2**21-1){s.enqueue(tm);break}i=a*2**32+t.getUint32(4),r=3}else{if(Sm(n)<i)break;let e=Cm(n,i);s.enqueue(mm(a?e:xm.decode(e),t)),r=0}if(i===0||i>e){s.enqueue(tm);break}}}})}function Tm(e){if(e)return Em(e)}function Em(e){for(var t in Tm.prototype)e[t]=Tm.prototype[t];return e}Tm.prototype.on=Tm.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[`$`+e]=this._callbacks[`$`+e]||[]).push(t),this},Tm.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Tm.prototype.off=Tm.prototype.removeListener=Tm.prototype.removeAllListeners=Tm.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks[`$`+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks[`$`+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks[`$`+e],this},Tm.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=Array(arguments.length-1),n=this._callbacks[`$`+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},Tm.prototype.emitReserved=Tm.prototype.emit,Tm.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[`$`+e]||[]},Tm.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Dm=(()=>typeof Promise==`function`&&typeof Promise.resolve==`function`?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Om=(()=>typeof self<`u`?self:typeof window<`u`?window:Function(`return this`)())();function km(e,...t){return t.reduce((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t),{})}var Am=Om.setTimeout,jm=Om.clearTimeout;function Mm(e,t){t.useNativeTimers?(e.setTimeoutFn=Am.bind(Om),e.clearTimeoutFn=jm.bind(Om)):(e.setTimeoutFn=Om.setTimeout.bind(Om),e.clearTimeoutFn=Om.clearTimeout.bind(Om))}var Nm=1.33;function Pm(e){return typeof e==`string`?Fm(e):Math.ceil((e.byteLength||e.size)*Nm)}function Fm(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function Im(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Lm(e){let t=``;for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+=`&`),t+=encodeURIComponent(n)+`=`+encodeURIComponent(e[n]));return t}function Rm(e){let t={},n=e.split(`&`);for(let e=0,r=n.length;e<r;e++){let r=n[e].split(`=`);t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}var zm=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type=`TransportError`}},Bm=class extends Tm{constructor(e){super(),this.writable=!1,Mm(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved(`error`,new zm(e,t,n)),this}open(){return this.readyState=`opening`,this.doOpen(),this}close(){return(this.readyState===`opening`||this.readyState===`open`)&&(this.doClose(),this.onClose()),this}send(e){this.readyState===`open`&&this.write(e)}onOpen(){this.readyState=`open`,this.writable=!0,super.emitReserved(`open`)}onData(e){let t=mm(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved(`packet`,e)}onClose(e){this.readyState=`closed`,super.emitReserved(`close`,e)}pause(e){}createUri(e,t={}){return e+`://`+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(`:`)===-1?e:`[`+e+`]`}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?`:`+this.opts.port:``}_query(e){let t=Lm(e);return t.length?`?`+t:``}},Vm=class extends Bm{constructor(){super(...arguments),this._polling=!1}get name(){return`polling`}doOpen(){this._poll()}pause(e){this.readyState=`pausing`;let t=()=>{this.readyState=`paused`,e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once(`pollComplete`,function(){--e||t()})),this.writable||(e++,this.once(`drain`,function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved(`poll`)}onData(e){ym(e,this.socket.binaryType).forEach(e=>{if(this.readyState===`opening`&&e.type===`open`&&this.onOpen(),e.type===`close`)return this.onClose({description:`transport closed by the server`}),!1;this.onPacket(e)}),this.readyState!==`closed`&&(this._polling=!1,this.emitReserved(`pollComplete`),this.readyState===`open`&&this._poll())}doClose(){let e=()=>{this.write([{type:`close`}])};this.readyState===`open`?e():this.once(`open`,e)}write(e){this.writable=!1,vm(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved(`drain`)})})}uri(){let e=this.opts.secure?`https`:`http`,t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Im()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}},Hm=!1;try{Hm=typeof XMLHttpRequest<`u`&&`withCredentials`in new XMLHttpRequest}catch{}const Um=Hm;function Wm(){}var Gm=class extends Vm{constructor(e){if(super(e),typeof location<`u`){let t=location.protocol===`https:`,n=location.port;n||=t?`443`:`80`,this.xd=typeof location<`u`&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){let n=this.request({method:`POST`,data:e});n.on(`success`,t),n.on(`error`,(e,t)=>{this.onError(`xhr post error`,e,t)})}doPoll(){let e=this.request();e.on(`data`,this.onData.bind(this)),e.on(`error`,(e,t)=>{this.onError(`xhr poll error`,e,t)}),this.pollXhr=e}},Km=class e extends Tm{constructor(e,t,n){super(),this.createRequest=e,Mm(this,n),this._opts=n,this._method=n.method||`GET`,this._uri=t,this._data=n.data===void 0?null:n.data,this._create()}_create(){var t;let n=km(this._opts,`agent`,`pfx`,`key`,`passphrase`,`cert`,`ca`,`ciphers`,`rejectUnauthorized`,`autoUnref`);n.xdomain=!!this._opts.xd;let r=this._xhr=this.createRequest(n);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders)for(let e in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this._opts.extraHeaders[e])}catch{}if(this._method===`POST`)try{r.setRequestHeader(`Content-type`,`text/plain;charset=UTF-8`)}catch{}try{r.setRequestHeader(`Accept`,`*/*`)}catch{}(t=this._opts.cookieJar)==null||t.addCookies(r),`withCredentials`in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var e;r.readyState===3&&((e=this._opts.cookieJar)==null||e.parseCookies(r.getResponseHeader(`set-cookie`))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status==`number`?r.status:0)},0))},r.send(this._data)}catch(e){this.setTimeoutFn(()=>{this._onError(e)},0);return}typeof document<`u`&&(this._index=e.requestsCount++,e.requests[this._index]=this)}_onError(e){this.emitReserved(`error`,e,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(this._xhr===void 0||this._xhr===null)){if(this._xhr.onreadystatechange=Wm,t)try{this._xhr.abort()}catch{}typeof document<`u`&&delete e.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved(`data`,e),this.emitReserved(`success`),this._cleanup())}abort(){this._cleanup()}};if(Km.requestsCount=0,Km.requests={},typeof document<`u`){if(typeof attachEvent==`function`)attachEvent(`onunload`,qm);else if(typeof addEventListener==`function`){let e=`onpagehide`in Om?`pagehide`:`unload`;addEventListener(e,qm,!1)}}function qm(){for(let e in Km.requests)Km.requests.hasOwnProperty(e)&&Km.requests[e].abort()}var Jm=(function(){let e=Xm({xdomain:!1});return e&&e.responseType!==null})(),Ym=class extends Gm{constructor(e){super(e);let t=e&&e.forceBase64;this.supportsBinary=Jm&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Km(Xm,this.uri(),e)}};function Xm(e){let t=e.xdomain;try{if(typeof XMLHttpRequest<`u`&&(!t||Um))return new XMLHttpRequest}catch{}if(!t)try{return new Om[[`Active`,`Object`].join(`X`)](`Microsoft.XMLHTTP`)}catch{}}var Zm=typeof navigator<`u`&&typeof navigator.product==`string`&&navigator.product.toLowerCase()===`reactnative`,Qm=class extends Bm{get name(){return`websocket`}doOpen(){let e=this.uri(),t=this.opts.protocols,n=Zm?{}:km(this.opts,`agent`,`perMessageDeflate`,`pfx`,`key`,`passphrase`,`cert`,`ca`,`ciphers`,`rejectUnauthorized`,`localAddress`,`protocolVersion`,`origin`,`maxPayload`,`family`,`checkServerIdentity`);this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(e){return this.emitReserved(`error`,e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:`websocket connection closed`,context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError(`websocket error`,e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],r=t===e.length-1;am(n,this.supportsBinary,e=>{try{this.doWrite(n,e)}catch{}r&&Dm(()=>{this.writable=!0,this.emitReserved(`drain`)},this.setTimeoutFn)})}}doClose(){this.ws!==void 0&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?`wss`:`ws`,t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Im()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},$m=Om.WebSocket||Om.MozWebSocket;const eh={websocket:class extends Qm{createSocket(e,t,n){return Zm?new $m(e,t,n):t?new $m(e,t):new $m(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends Bm{get name(){return`webtransport`}doOpen(){try{this._transport=new WebTransport(this.createUri(`https`),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved(`error`,e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError(`webtransport error`,e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=wm(2**53-1,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=bm();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();let i=()=>{n.read().then(({done:e,value:t})=>{e||(this.onPacket(t),i())}).catch(e=>{})};i();let a={type:`open`};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],r=t===e.length-1;this._writer.write(n).then(()=>{r&&Dm(()=>{this.writable=!0,this.emitReserved(`drain`)},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)==null||e.close()}},polling:Ym};var th=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,nh=[`source`,`protocol`,`authority`,`userInfo`,`user`,`password`,`host`,`port`,`relative`,`path`,`directory`,`file`,`query`,`anchor`];function rh(e){if(e.length>8e3)throw`URI too long`;let t=e,n=e.indexOf(`[`),r=e.indexOf(`]`);n!=-1&&r!=-1&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,`;`)+e.substring(r,e.length));let i=th.exec(e||``),a={},o=14;for(;o--;)a[nh[o]]=i[o]||``;return n!=-1&&r!=-1&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,`:`),a.authority=a.authority.replace(`[`,``).replace(`]`,``).replace(/;/g,`:`),a.ipv6uri=!0),a.pathNames=ih(a,a.path),a.queryKey=ah(a,a.query),a}function ih(e,t){let n=t.replace(/\/{2,9}/g,`/`).split(`/`);return(t.slice(0,1)==`/`||t.length===0)&&n.splice(0,1),t.slice(-1)==`/`&&n.splice(n.length-1,1),n}function ah(e,t){let n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,r){t&&(n[t]=r)}),n}var oh=typeof addEventListener==`function`&&typeof removeEventListener==`function`,sh=[];oh&&addEventListener(`offline`,()=>{sh.forEach(e=>e())},!1);var ch=class e extends Tm{constructor(e,t){if(super(),this.binaryType=`arraybuffer`,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e==`object`&&(t=e,e=null),e){let n=rh(e);t.hostname=n.host,t.secure=n.protocol===`https`||n.protocol===`wss`,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=rh(t.host).host);Mm(this,t),this.secure=t.secure==null?typeof location<`u`&&location.protocol===`https:`:t.secure,t.hostname&&!t.port&&(t.port=this.secure?`443`:`80`),this.hostname=t.hostname||(typeof location<`u`?location.hostname:`localhost`),this.port=t.port||(typeof location<`u`&&location.port?location.port:this.secure?`443`:`80`),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{let t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:`/engine.io`,agent:!1,withCredentials:!1,upgrade:!0,timestampParam:`t`,rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,``)+(this.opts.addTrailingSlash?`/`:``),typeof this.opts.query==`string`&&(this.opts.query=Rm(this.opts.query)),oh&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener(`beforeunload`,this._beforeunloadEventListener,!1)),this.hostname!==`localhost`&&(this._offlineEventListener=()=>{this._onClose(`transport close`,{description:`network connection lost`})},sh.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);let n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved(`error`,`No transports available`)},0);return}let t=this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&this.transports.indexOf(`websocket`)!==-1?`websocket`:this.transports[0];this.readyState=`opening`;let n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on(`drain`,this._onDrain.bind(this)).on(`packet`,this._onPacket.bind(this)).on(`error`,this._onError.bind(this)).on(`close`,e=>this._onClose(`transport close`,e))}onOpen(){this.readyState=`open`,e.priorWebsocketSuccess=this.transport.name===`websocket`,this.emitReserved(`open`),this.flush()}_onPacket(e){if(this.readyState===`opening`||this.readyState===`open`||this.readyState===`closing`)switch(this.emitReserved(`packet`,e),this.emitReserved(`heartbeat`),e.type){case`open`:this.onHandshake(JSON.parse(e.data));break;case`ping`:this._sendPacket(`pong`),this.emitReserved(`ping`),this.emitReserved(`pong`),this._resetPingTimeout();break;case`error`:let t=Error(`server error`);t.code=e.data,this._onError(t);break;case`message`:this.emitReserved(`data`,e.data),this.emitReserved(`message`,e.data);break}}onHandshake(e){this.emitReserved(`handshake`,e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!==`closed`&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose(`ping timeout`)},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved(`drain`):this.flush()}flush(){if(this.readyState!==`closed`&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved(`flush`)}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name===`polling`&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){let n=this.writeBuffer[t].data;if(n&&(e+=Pm(n)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Dm(()=>{this._onClose(`ping timeout`)},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket(`message`,e,t,n),this}send(e,t,n){return this._sendPacket(`message`,e,t,n),this}_sendPacket(e,t,n,r){if(typeof t==`function`&&(r=t,t=void 0),typeof n==`function`&&(r=n,n=null),this.readyState===`closing`||this.readyState===`closed`)return;n||={},n.compress=!1!==n.compress;let i={type:e,data:t,options:n};this.emitReserved(`packetCreate`,i),this.writeBuffer.push(i),r&&this.once(`flush`,r),this.flush()}close(){let e=()=>{this._onClose(`forced close`),this.transport.close()},t=()=>{this.off(`upgrade`,t),this.off(`upgradeError`,t),e()},n=()=>{this.once(`upgrade`,t),this.once(`upgradeError`,t)};return(this.readyState===`opening`||this.readyState===`open`)&&(this.readyState=`closing`,this.writeBuffer.length?this.once(`drain`,()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(t){if(e.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState===`opening`)return this.transports.shift(),this._open();this.emitReserved(`error`,t),this._onClose(`transport error`,t)}_onClose(e,t){if(this.readyState===`opening`||this.readyState===`open`||this.readyState===`closing`){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners(`close`),this.transport.close(),this.transport.removeAllListeners(),oh&&(this._beforeunloadEventListener&&removeEventListener(`beforeunload`,this._beforeunloadEventListener,!1),this._offlineEventListener)){let e=sh.indexOf(this._offlineEventListener);e!==-1&&sh.splice(e,1)}this.readyState=`closed`,this.id=null,this.emitReserved(`close`,e,t),this.writeBuffer=[],this._prevBufferLen=0}}};ch.protocol=4;var lh=class extends ch{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState===`open`&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;ch.priorWebsocketSuccess=!1;let r=()=>{n||(t.send([{type:`ping`,data:`probe`}]),t.once(`packet`,e=>{if(!n)if(e.type===`pong`&&e.data===`probe`){if(this.upgrading=!0,this.emitReserved(`upgrading`,t),!t)return;ch.priorWebsocketSuccess=t.name===`websocket`,this.transport.pause(()=>{n||this.readyState!==`closed`&&(l(),this.setTransport(t),t.send([{type:`upgrade`}]),this.emitReserved(`upgrade`,t),t=null,this.upgrading=!1,this.flush())})}else{let e=Error(`probe error`);e.transport=t.name,this.emitReserved(`upgradeError`,e)}}))};function i(){n||(n=!0,l(),t.close(),t=null)}let a=e=>{let n=Error(`probe error: `+e);n.transport=t.name,i(),this.emitReserved(`upgradeError`,n)};function o(){a(`transport closed`)}function s(){a(`socket closed`)}function c(e){t&&e.name!==t.name&&i()}let l=()=>{t.removeListener(`open`,r),t.removeListener(`error`,a),t.removeListener(`close`,o),this.off(`close`,s),this.off(`upgrading`,c)};t.once(`open`,r),t.once(`error`,a),t.once(`close`,o),this.once(`close`,s),this.once(`upgrading`,c),this._upgrades.indexOf(`webtransport`)!==-1&&e!==`webtransport`?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}},uh=class extends lh{constructor(e,t={}){let n=typeof e==`object`?e:t;(!n.transports||n.transports&&typeof n.transports[0]==`string`)&&(n.transports=(n.transports||[`polling`,`websocket`,`webtransport`]).map(e=>eh[e]).filter(e=>!!e)),super(e,n)}};uh.protocol;function dh(e,t=``,n){let r=e;n||=typeof location<`u`&&location,e??=n.protocol+`//`+n.host,typeof e==`string`&&(e.charAt(0)===`/`&&(e=e.charAt(1)===`/`?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=n===void 0?`https://`+e:n.protocol+`//`+e),r=rh(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port=`80`:/^(http|ws)s$/.test(r.protocol)&&(r.port=`443`)),r.path=r.path||`/`;let i=r.host.indexOf(`:`)===-1?r.host:`[`+r.host+`]`;return r.id=r.protocol+`://`+i+`:`+r.port+t,r.href=r.protocol+`://`+i+(n&&n.port===r.port?``:`:`+r.port),r}var fh=typeof ArrayBuffer==`function`,ph=e=>typeof ArrayBuffer.isView==`function`?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,mh=Object.prototype.toString,hh=typeof Blob==`function`||typeof Blob<`u`&&mh.call(Blob)===`[object BlobConstructor]`,gh=typeof File==`function`||typeof File<`u`&&mh.call(File)===`[object FileConstructor]`;function _h(e){return fh&&(e instanceof ArrayBuffer||ph(e))||hh&&e instanceof Blob||gh&&e instanceof File}function vh(e,t){if(!e||typeof e!=`object`)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(vh(e[t]))return!0;return!1}if(_h(e))return!0;if(e.toJSON&&typeof e.toJSON==`function`&&arguments.length===1)return vh(e.toJSON(),!0);for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&vh(e[t]))return!0;return!1}function yh(e){let t=[],n=e.data,r=e;return r.data=bh(n,t),r.attachments=t.length,{packet:r,buffers:t}}function bh(e,t){if(!e)return e;if(_h(e)){let n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){let n=Array(e.length);for(let r=0;r<e.length;r++)n[r]=bh(e[r],t);return n}else if(typeof e==`object`&&!(e instanceof Date)){let n={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=bh(e[r],t));return n}return e}function xh(e,t){return e.data=Sh(e.data,t),delete e.attachments,e}function Sh(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num==`number`&&e.num>=0&&e.num<t.length)return t[e.num];throw Error(`illegal attachments`)}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Sh(e[n],t);else if(typeof e==`object`)for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Sh(e[n],t));return e}var Ch=s({Decoder:()=>Oh,Encoder:()=>Eh,PacketType:()=>Th,protocol:()=>5}),wh=[`connect`,`connect_error`,`disconnect`,`disconnecting`,`newListener`,`removeListener`],Th;(function(e){e[e.CONNECT=0]=`CONNECT`,e[e.DISCONNECT=1]=`DISCONNECT`,e[e.EVENT=2]=`EVENT`,e[e.ACK=3]=`ACK`,e[e.CONNECT_ERROR=4]=`CONNECT_ERROR`,e[e.BINARY_EVENT=5]=`BINARY_EVENT`,e[e.BINARY_ACK=6]=`BINARY_ACK`})(Th||={});var Eh=class{constructor(e){this.replacer=e}encode(e){return(e.type===Th.EVENT||e.type===Th.ACK)&&vh(e)?this.encodeAsBinary({type:e.type===Th.EVENT?Th.BINARY_EVENT:Th.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=``+e.type;return(e.type===Th.BINARY_EVENT||e.type===Th.BINARY_ACK)&&(t+=e.attachments+`-`),e.nsp&&e.nsp!==`/`&&(t+=e.nsp+`,`),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=yh(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}};function Dh(e){return Object.prototype.toString.call(e)===`[object Object]`}var Oh=class e extends Tm{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e==`string`){if(this.reconstructor)throw Error(`got plaintext data when reconstructing a packet`);t=this.decodeString(e);let n=t.type===Th.BINARY_EVENT;n||t.type===Th.BINARY_ACK?(t.type=n?Th.EVENT:Th.ACK,this.reconstructor=new kh(t),t.attachments===0&&super.emitReserved(`decoded`,t)):super.emitReserved(`decoded`,t)}else if(_h(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved(`decoded`,t));else throw Error(`got binary data when not reconstructing a packet`);else throw Error(`Unknown type: `+e)}decodeString(t){let n=0,r={type:Number(t.charAt(0))};if(Th[r.type]===void 0)throw Error(`unknown packet type `+r.type);if(r.type===Th.BINARY_EVENT||r.type===Th.BINARY_ACK){let e=n+1;for(;t.charAt(++n)!==`-`&&n!=t.length;);let i=t.substring(e,n);if(i!=Number(i)||t.charAt(n)!==`-`)throw Error(`Illegal attachments`);r.attachments=Number(i)}if(t.charAt(n+1)===`/`){let e=n+1;for(;++n&&!(t.charAt(n)===`,`||n===t.length););r.nsp=t.substring(e,n)}else r.nsp=`/`;let i=t.charAt(n+1);if(i!==``&&Number(i)==i){let e=n+1;for(;++n;){let e=t.charAt(n);if(e==null||Number(e)!=e){--n;break}if(n===t.length)break}r.id=Number(t.substring(e,n+1))}if(t.charAt(++n)){let i=this.tryParse(t.substr(n));if(e.isPayloadValid(r.type,i))r.data=i;else throw Error(`invalid payload`)}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case Th.CONNECT:return Dh(t);case Th.DISCONNECT:return t===void 0;case Th.CONNECT_ERROR:return typeof t==`string`||Dh(t);case Th.EVENT:case Th.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]==`number`||typeof t[0]==`string`&&wh.indexOf(t[0])===-1);case Th.ACK:case Th.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&=(this.reconstructor.finishedReconstruction(),null)}},kh=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let e=xh(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Ah(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var jh=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Mh=class extends Tm{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Ah(e,`open`,this.onopen.bind(this)),Ah(e,`packet`,this.onpacket.bind(this)),Ah(e,`error`,this.onerror.bind(this)),Ah(e,`close`,this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState===`open`&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift(`message`),this.emit.apply(this,e),this}emit(e,...t){if(jh.hasOwnProperty(e))throw Error(`"`+e.toString()+`" is a reserved event name`);if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:Th.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]==`function`){let e=this.ids++,r=t.pop();this._registerAckCallback(e,r),n.id=e}let r=this.io.engine?.transport?.writable,i=this.connected&&!this.io.engine?._hasPingExpired();return this.flags.volatile&&!r||(i?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){let n=this.flags.timeout??this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}let r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,Error(`operation has timed out`))},n),i=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,e)};i.withError=!0,this.acks[e]=i}emitWithAck(e,...t){return new Promise((n,r)=>{let i=(e,t)=>e?r(e):n(t);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]==`function`&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...r)=>{if(n===this._queue[0])return e===null?(this._queue.shift(),t&&t(null,...r)):n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)),n.pending=!1,this._drainQueue()}),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth==`function`?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Th.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved(`connect_error`,e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved(`disconnect`,e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){let t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,Error(`socket has been disconnected`))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Th.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved(`connect_error`,Error(`It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)`));break;case Th.EVENT:case Th.BINARY_EVENT:this.onevent(e);break;case Th.ACK:case Th.BINARY_ACK:this.onack(e);break;case Th.DISCONNECT:this.ondisconnect();break;case Th.CONNECT_ERROR:this.destroy();let t=Error(e.data.message);t.data=e.data.data,this.emitReserved(`connect_error`,t);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]==`string`&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...r){n||(n=!0,t.packet({type:Th.ACK,id:e,data:r}))}}onack(e){let t=this.acks[e.id];typeof t==`function`&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved(`connect`),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose(`io server disconnect`)}destroy(){this.subs&&=(this.subs.forEach(e=>e()),void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Th.DISCONNECT}),this.destroy(),this.connected&&this.onclose(`io client disconnect`),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};function Nh(e){e||={},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Nh.prototype.duration=function(){var e=this.ms*this.factor**+ this.attempts++;if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0},Nh.prototype.reset=function(){this.attempts=0},Nh.prototype.setMin=function(e){this.ms=e},Nh.prototype.setMax=function(e){this.max=e},Nh.prototype.setJitter=function(e){this.jitter=e};var Ph=class extends Tm{constructor(e,t){super(),this.nsps={},this.subs=[],e&&typeof e==`object`&&(t=e,e=void 0),t||={},t.path=t.path||`/socket.io`,this.opts=t,Mm(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor??.5),this.backoff=new Nh({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState=`closed`,this.uri=e;let n=t.parser||Ch;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)==null||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)==null||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)==null||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf(`open`))return this;this.engine=new uh(this.uri,this.opts);let t=this.engine,n=this;this._readyState=`opening`,this.skipReconnect=!1;let r=Ah(t,`open`,function(){n.onopen(),e&&e()}),i=t=>{this.cleanup(),this._readyState=`closed`,this.emitReserved(`error`,t),e?e(t):this.maybeReconnectOnOpen()},a=Ah(t,`error`,i);if(!1!==this._timeout){let e=this._timeout,n=this.setTimeoutFn(()=>{r(),i(Error(`timeout`)),t.close()},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}return this.subs.push(r),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState=`open`,this.emitReserved(`open`);let e=this.engine;this.subs.push(Ah(e,`ping`,this.onping.bind(this)),Ah(e,`data`,this.ondata.bind(this)),Ah(e,`error`,this.onerror.bind(this)),Ah(e,`close`,this.onclose.bind(this)),Ah(this.decoder,`decoded`,this.ondecoded.bind(this)))}onping(){this.emitReserved(`ping`)}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose(`parse error`,e)}}ondecoded(e){Dm(()=>{this.emitReserved(`packet`,e)},this.setTimeoutFn)}onerror(e){this.emitReserved(`error`,e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Mh(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let e of t)if(this.nsps[e].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose(`forced close`)}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),(n=this.engine)==null||n.close(),this.backoff.reset(),this._readyState=`closed`,this.emitReserved(`close`,e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved(`reconnect_failed`),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved(`reconnect_attempt`,e.backoff.attempts),!e.skipReconnect&&e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved(`reconnect_error`,t)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved(`reconnect`,e)}},Fh={};function Ih(e,t){typeof e==`object`&&(t=e,e=void 0),t||={};let n=dh(e,t.path||`/socket.io`),r=n.source,i=n.id,a=n.path,o=Fh[i]&&a in Fh[i].nsps,s=t.forceNew||t[`force new connection`]||!1===t.multiplex||o,c;return s?c=new Ph(r,t):(Fh[i]||(Fh[i]=new Ph(r,t)),c=Fh[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(Ih,{Manager:Ph,Socket:Mh,io:Ih,connect:Ih});var J=class e{static zeros=`.0.00.000.0000.00000.000000.0000000.00000000.000000000.0000000000.00000000000.000000000000.0000000000000.00000000000000.000000000000000.0000000000000000.00000000000000000.000000000000000000.0000000000000000000.00000000000000000000.000000000000000000000.0000000000000000000000.00000000000000000000000.000000000000000000000000.0000000000000000000000000`.split(`.`);static groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];static groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];static wordSize=26;static WORD_SIZE_BIGINT=BigInt(e.wordSize);static WORD_MASK=(1n<<e.WORD_SIZE_BIGINT)-1n;static MAX_SAFE_INTEGER_BIGINT=BigInt(2**53-1);static MIN_SAFE_INTEGER_BIGINT=BigInt(-(2**53-1));static MAX_IMULN_ARG=67108863;static MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT=(1n<<53n)-1n;_magnitude;_sign;_nominalWordLength;red;get negative(){return this._sign}set negative(e){this.assert(e===0||e===1,`Negative property must be 0 or 1`);let t=e===1?1:0;this._magnitude===0n?this._sign=0:this._sign=t}get _computedWordsArray(){if(this._magnitude===0n)return[0];let t=[],n=this._magnitude;for(;n>0n;)t.push(Number(n&e.WORD_MASK)),n>>=e.WORD_SIZE_BIGINT;return t.length>0?t:[0]}get words(){let e=this._computedWordsArray;if(this._nominalWordLength<=e.length)return e;let t=Array(this._nominalWordLength).fill(0);for(let n=0;n<e.length;n++)t[n]=e[n];return t}set words(t){let n=this._sign,r=0n,i=t.length>0?t.length:1;for(let n=i-1;n>=0;n--){let i=t[n]===void 0?0:t[n];r=r<<e.WORD_SIZE_BIGINT|BigInt(i&Number(e.WORD_MASK))}this._magnitude=r,this._sign=n,this._nominalWordLength=i,this.normSign()}get length(){return Math.max(1,this._nominalWordLength)}static isBN(t){return t instanceof e?!0:typeof t==`object`&&!!t&&t.constructor?.wordSize===e.wordSize&&Array.isArray(t.words)}static max(e,t){return e.cmp(t)>0?e:t}static min(e,t){return e.cmp(t)<0?e:t}constructor(e=0,t=10,n=`be`){if(this._magnitude=0n,this._sign=0,this._nominalWordLength=1,this.red=null,e===void 0&&(e=0),e===null){this._initializeState(0n,0);return}if(typeof e==`bigint`){this._initializeState(e<0n?-e:e,e<0n?1:0),this.normSign();return}let r=t,i=n;if((t===`le`||t===`be`)&&(i=t,r=10),typeof e==`number`){this.initNumber(e,i);return}if(Array.isArray(e)){this.initArray(e,i);return}if(typeof e==`string`){r===`hex`&&(r=16),this.assert(typeof r==`number`&&r===(r|0)&&r>=2&&r<=36,`Base must be an integer between 2 and 36`);let t=e.toString().replace(/\s+/g,``),n=0,a=0;t.startsWith(`-`)?(n++,a=1):t.startsWith(`+`)&&n++;let o=t.substring(n);if(o.length===0){this._initializeState(0n,a===1&&t.startsWith(`-`)?1:0),this.normSign();return}if(r===16){let e;if(i===`le`){let e=[],t=o;t.length%2!=0&&(t=`0`+t);for(let n=0;n<t.length;n+=2){let r=t.substring(n,n+2),i=parseInt(r,16);if(isNaN(i))throw Error(`Invalid character in `+t);e.push(i)}this.initArray(e,`le`),this._sign=a,this.normSign();return}else try{e=BigInt(`0x`+o)}catch{throw Error(`Invalid character in `+o)}this._initializeState(e,a),this.normSign()}else try{if(this._parseBaseString(o,r),this._sign=a,this.normSign(),i===`le`){let e=this._sign;this.initArray(this.toArray(`be`),`le`),this._sign=e,this.normSign()}}catch(e){let t=e;throw t.message.includes(`Invalid character in string`)||t.message.includes(`Invalid digit for base`)||t.message.startsWith(`Invalid character:`)?Error(`Invalid character`):t}}else e===0?this._initializeState(0n,0):this.assert(!1,`Unsupported input type for BigNumber constructor`)}_bigIntToStringInBase(e,t){if(e===0n)return`0`;if(t<2||t>36)throw Error(`Base must be between 2 and 36`);let n=``,r=e>0n?e:-e,i=BigInt(t);for(;r>0n;)n=`0123456789abcdefghijklmnopqrstuvwxyz`[Number(r%i)]+n,r/=i;return n}_parseBaseString(t,n){if(t.length===0){this._magnitude=0n,this._finishInitialization();return}this._magnitude=0n;let r=BigInt(n),i=e.groupSizes[n],a=BigInt(e.groupBases[n]);(i===0||a===0n)&&(i=Math.floor(Math.log(67108863)/Math.log(n)),i===0&&(i=1),a=r**BigInt(i));let o=0,s=t.length,c=s%i;if(c===0&&s>0&&(c=i),c>0){let e=t.substring(o,o+c);this._magnitude=BigInt(this._parseBaseWord(e,n)),o+=c}for(;o<s;){let e=t.substring(o,o+i),r=BigInt(this._parseBaseWord(e,n));this._magnitude=this._magnitude*a+r,o+=i}this._finishInitialization()}_parseBaseWord(e,t){let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r),a;if(i>=48&&i<=57)a=i-48;else if(i>=65&&i<=90)a=i-65+10;else if(i>=97&&i<=122)a=i-97+10;else throw Error(`Invalid character: `+e[r]);if(a>=t)throw Error(`Invalid character`);n=n*t+a}return n}_initializeState(e,t){this._magnitude=e,this._sign=e===0n?0:t,this._finishInitialization()}_finishInitialization(){if(this._magnitude===0n)this._nominalWordLength=1,this._sign=0;else{let t=this._magnitude.toString(2).length;this._nominalWordLength=Math.max(1,Math.ceil(t/e.wordSize))}}assert(e,t=`Assertion failed`){if(!e)throw Error(t)}initNumber(t,n=`be`){if(this.assert(BigInt(Math.abs(t))<=e.MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT,`The number is larger than 2 ^ 53 (unsafe)`),this.assert(t%1==0,`Number must be an integer for BigNumber conversion`),this._initializeState(BigInt(Math.abs(t)),t<0?1:0),n===`le`){let e=this._sign,t=this.toArray(`be`);this.initArray(t,`le`),this._sign=e,this.normSign()}return this}initArray(e,t){if(e.length===0)return this._initializeState(0n,0),this;let n=0n;if(t===`be`)for(let t=0;t<e.length;t++)n=n<<8n|BigInt(e[t]&255);else for(let t=e.length-1;t>=0;t--)n=n<<8n|BigInt(e[t]&255);return this._initializeState(n,0),this}copy(e){e._magnitude=this._magnitude,e._sign=this._sign,e._nominalWordLength=this._nominalWordLength,e.red=this.red}static move(e,t){e._magnitude=t._magnitude,e._sign=t._sign,e._nominalWordLength=t._nominalWordLength,e.red=t.red}clone(){let t=new e(0n);return this.copy(t),t}expand(e){return this.assert(e>=0,`Expand size must be non-negative`),this._nominalWordLength=Math.max(this._nominalWordLength,e,1),this}strip(){return this._finishInitialization(),this.normSign()}normSign(){return this._magnitude===0n&&(this._sign=0),this}inspect(){return(this.red===null?`<BN: `:`<BN-R: `)+this.toString(16)+`>`}_getMinimalHex(){return this._magnitude===0n?`0`:this._magnitude.toString(16)}toString(e=10,t=1){if(e===16||e===`hex`){let e=this._getMinimalHex();if(t>1)for(e!==`0`&&e.length%2!=0&&(e=`0`+e);e.length%t!==0;)e=`0`+e;return(this.isNeg()?`-`:``)+e}if(typeof e!=`number`||e<2||e>36||e%1!=0)throw Error(`Base should be an integer between 2 and 36`);return this.toBaseString(e,t)}toBaseString(t,n){if(this._magnitude===0n){let e=`0`;if(n>1)for(;e.length<n;)e=`0`+e;return e}let r=e.groupSizes[t],i=BigInt(e.groupBases[t]);(r===0||i===0n)&&(r=Math.floor(Math.log(2**53-1)/Math.log(t)),r===0&&(r=1),i=BigInt(t)**BigInt(r));let a=``,o=this._magnitude;for(;o>0n;){let n=o%i;o/=i;let s=this._bigIntToStringInBase(n,t);if(o>0n){let t=r-s.length;a=t>0&&t<e.zeros.length?e.zeros[t]+s+a:t>0?`0`.repeat(t)+s+a:s+a}else a=s+a}if(n>0)for(;a.length<n;)a=`0`+a;return(this._sign===1?`-`:``)+a}toNumber(){let t=this._getSignedValue();if(t>e.MAX_SAFE_INTEGER_BIGINT||t<e.MIN_SAFE_INTEGER_BIGINT)throw Error(`Number can only safely store up to 53 bits`);return Number(t)}toJSON(){let e=this._getMinimalHex();return(this.isNeg()?`-`:``)+e}toArrayLikeGeneric(e,t){let n=this._magnitude,r=t?0:e.length-1,i=t?1:-1;for(let t=0;t<e.length;++t){if(n===0n&&r>=0&&r<e.length)e[r]=0;else if(r>=0&&r<e.length)e[r]=Number(n&255n);else break;n>>=8n,r+=i}}toArray(e=`be`,t){this.strip();let n=this.byteLength(),r=t??Math.max(1,n);this.assert(n<=r,`byte array longer than desired length`),this.assert(r>0,`Requested array length <= 0`);let i=Array(r).fill(0);return this._magnitude===0n&&r>0?i:this._magnitude===0n&&r===0?[]:(this.toArrayLikeGeneric(i,e===`le`),i)}bitLength(){return this._magnitude===0n?0:this._magnitude.toString(2).length}static toBitArray(e){let t=e.bitLength();if(t===0)return[];let n=Array(t),r=e._magnitude;for(let e=0;e<t;e++)n[e]=(r>>BigInt(e)&1n)==0n?0:1;return n}toBitArray(){return e.toBitArray(this)}zeroBits(){if(this._magnitude===0n)return 0;let e=0,t=this._magnitude;for(;(t&1n)==0n&&t!==0n;)e++,t>>=1n;return e}byteLength(){return this._magnitude===0n?0:Math.ceil(this.bitLength()/8)}_getSignedValue(){return this._sign===1?-this._magnitude:this._magnitude}_setValueFromSigned(e){e<0n?(this._magnitude=-e,this._sign=1):(this._magnitude=e,this._sign=0),this._finishInitialization(),this.normSign()}toTwos(t){this.assert(t>=0);let n=BigInt(t),r=this._getSignedValue();this._sign===1&&this._magnitude!==0n&&(r=(1n<<n)+r);let i=(1n<<n)-1n;r&=i;let a=new e(0n);return a._initializeState(r,0),a}fromTwos(t){this.assert(t>=0);let n=BigInt(t),r=this._magnitude;if(t>0&&(r>>n-1n&1n)!=0n&&this._sign===0){let t=r-(1n<<n),i=new e(0n);return i._setValueFromSigned(t),i}return this.clone()}isNeg(){return this._sign===1&&this._magnitude!==0n}neg(){return this.clone().ineg()}ineg(){return this._magnitude!==0n&&(this._sign=this._sign===1?0:1),this}_iuop(e,t){let n=t(this._magnitude,e._magnitude),r=t===((e,t)=>e^t),i=this._nominalWordLength;return r&&(i=Math.max(this.length,e.length)),this._magnitude=n,this._finishInitialization(),r&&(this._nominalWordLength=Math.max(this._nominalWordLength,i)),this.strip()}iuor(e){return this._iuop(e,(e,t)=>e|t)}iuand(e){return this._iuop(e,(e,t)=>e&t)}iuxor(e){return this._iuop(e,(e,t)=>e^t)}_iop(e,t){return this.assert(this._sign===0&&e._sign===0),this._iuop(e,t)}ior(e){return this._iop(e,(e,t)=>e|t)}iand(e){return this._iop(e,(e,t)=>e&t)}ixor(e){return this._iop(e,(e,t)=>e^t)}_uop_new(e,t){return this.length>=e.length?this.clone()[t](e):e.clone()[t](this)}or(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuor`)}uor(e){return this._uop_new(e,`iuor`)}and(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuand`)}uand(e){return this._uop_new(e,`iuand`)}xor(e){return this.assert(this._sign===0&&e._sign===0),this._uop_new(e,`iuxor`)}uxor(e){return this._uop_new(e,`iuxor`)}inotn(t){this.assert(typeof t==`number`&&t>=0);let n=(1n<<BigInt(t))-1n;this._magnitude=~this._magnitude&n;let r=t===0?1:Math.ceil(t/e.wordSize);return this._nominalWordLength=Math.max(1,r),this.strip(),this._nominalWordLength=Math.max(this._nominalWordLength,Math.max(1,r)),this}notn(e){return this.clone().inotn(e)}setn(t,n){this.assert(typeof t==`number`&&t>=0);let r=BigInt(t);n===1||n===!0?this._magnitude|=1n<<r:this._magnitude&=~(1n<<r);let i=Math.floor(t/e.wordSize)+1;return this._nominalWordLength=Math.max(this._nominalWordLength,i),this._finishInitialization(),this.strip()}iadd(e){return this._setValueFromSigned(this._getSignedValue()+e._getSignedValue()),this}add(t){let n=new e(0n);return n._setValueFromSigned(this._getSignedValue()+t._getSignedValue()),n}isub(e){return this._setValueFromSigned(this._getSignedValue()-e._getSignedValue()),this}sub(t){let n=new e(0n);return n._setValueFromSigned(this._getSignedValue()-t._getSignedValue()),n}mul(t){let n=new e(0n);return n._magnitude=this._magnitude*t._magnitude,n._sign=n._magnitude===0n?0:this._sign^t._sign,n._nominalWordLength=this.length+t.length,n.red=null,n.normSign()}imul(e){return this._magnitude*=e._magnitude,this._sign=this._magnitude===0n?0:this._sign^e._sign,this._nominalWordLength=this.length+e.length,this.red=null,this.normSign()}imuln(t){return this.assert(typeof t==`number`,`Assertion failed`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Assertion failed`),this._setValueFromSigned(this._getSignedValue()*BigInt(t)),this}muln(e){return this.clone().imuln(e)}sqr(){let t=new e(0n);return t._magnitude=this._magnitude*this._magnitude,t._sign=0,t._nominalWordLength=this.length*2,t.red=null,t}isqr(){return this._magnitude*=this._magnitude,this._sign=0,this._nominalWordLength=this.length*2,this.red=null,this}pow(t){if(this.assert(t._sign===0,`Exponent for pow must be non-negative`),t.isZero())return new e(1n);let n=new e(1n),r=this.clone(),i=t.clone(),a=r.isNeg(),o=i.isOdd();for(a&&r.ineg();!i.isZero();)i.isOdd()&&n.imul(r),r.isqr(),i.iushrn(1);return a&&o&&n.ineg(),n}iushln(e){return this.assert(typeof e==`number`&&e>=0),e===0?this:(this._magnitude<<=BigInt(e),this._finishInitialization(),this.strip())}ishln(e){return this.assert(this._sign===0,`ishln requires positive number`),this.iushln(e)}iushrn(e,t,n){if(this.assert(typeof e==`number`&&e>=0),e===0)return n?._initializeState(0n,0),this;if(n!=null){let t=(1n<<BigInt(e))-1n,r=this._magnitude&t;n._initializeState(r,0)}return this._magnitude>>=BigInt(e),this._finishInitialization(),this.strip()}ishrn(e,t,n){return this.assert(this._sign===0,`ishrn requires positive number`),this.iushrn(e,t,n)}shln(e){return this.clone().ishln(e)}ushln(e){return this.clone().iushln(e)}shrn(e){return this.clone().ishrn(e)}ushrn(e){return this.clone().iushrn(e)}testn(e){return this.assert(typeof e==`number`&&e>=0),(this._magnitude>>BigInt(e)&1n)!=0n}imaskn(t){this.assert(typeof t==`number`&&t>=0),this.assert(this._sign===0,`imaskn works only with positive numbers`);let n=BigInt(t),r=n===0n?0n:(1n<<n)-1n;this._magnitude&=r;let i=t===0?1:Math.max(1,Math.ceil(t/e.wordSize));return this._nominalWordLength=i,this._finishInitialization(),this._nominalWordLength=Math.max(this._nominalWordLength,i),this.strip()}maskn(e){return this.clone().imaskn(e)}iaddn(t){return this.assert(typeof t==`number`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`num is too large`),this._setValueFromSigned(this._getSignedValue()+BigInt(t)),this}_iaddn(e){return this.iaddn(e)}isubn(t){return this.assert(typeof t==`number`),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Assertion failed`),this._setValueFromSigned(this._getSignedValue()-BigInt(t)),this}addn(e){return this.clone().iaddn(e)}subn(e){return this.clone().isubn(e)}iabs(){return this._sign=0,this}abs(){return this.clone().iabs()}divmod(t,n,r){if(this.assert(!t.isZero(),`Division by zero`),this.isZero()){let t=new e(0n);return{div:n===`mod`?null:t,mod:n===`div`?null:t}}let i=this._getSignedValue(),a=t._getSignedValue(),o=null,s=null;n!==`mod`&&(o=i/a),n!==`div`&&(s=i%a,r===!0&&s<0n&&(s+=a<0n?-a:a));let c=o===null?null:new e(0n);c!==null&&o!==null&&c._setValueFromSigned(o);let l=s===null?null:new e(0n);return l!==null&&s!==null&&l._setValueFromSigned(s),{div:c,mod:l}}div(e){return this.divmod(e,`div`,!1).div}mod(e){return this.divmod(e,`mod`,!1).mod}umod(e){return this.divmod(e,`mod`,!0).mod}divRound(t){this.assert(!t.isZero());let n=this._getSignedValue(),r=t._getSignedValue(),i=n/r,a=n%r;if(a===0n){let t=new e(0n);return t._setValueFromSigned(i),t}let o=a<0n?-a:a,s=r<0n?-r:r;o*2n>=s&&(n>0n&&r>0n||n<0n&&r<0n?i+=1n:i-=1n);let c=new e(0n);return c._setValueFromSigned(i),c}modrn(e){this.assert(e!==0,`Division by zero in modrn`);let t=BigInt(Math.abs(e));if(t===0n)throw Error(`Division by zero in modrn`);let n=this._magnitude%t;return e<0?Number(-n):Number(n)}idivn(t){return this.assert(t!==0),this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`num is too large`),this._setValueFromSigned(this._getSignedValue()/BigInt(t)),this}divn(e){return this.clone().idivn(e)}egcd(t){this.assert(t._sign===0,`p must not be negative`),this.assert(!t.isZero(),`p must not be zero`);let n=this._getSignedValue(),r=t._magnitude,i=1n,a=0n,o=0n,s=1n;for(;r!==0n;){let e=n/r,t=r;r=n%r,n=t,t=a,a=i-e*a,i=t,t=s,s=o-e*s,o=t}let c=new e(0n);c._setValueFromSigned(i);let l=new e(0n);l._setValueFromSigned(o);let u=new e(0n);return u._initializeState(n<0n?-n:n,0),{a:c,b:l,gcd:u}}gcd(t){let n=this._magnitude,r=t._magnitude;if(n===0n){let t=new e(0n);return t._setValueFromSigned(r),t.iabs()}if(r===0n){let t=new e(0n);return t._setValueFromSigned(n),t.iabs()}for(;r!==0n;){let e=n%r;n=r,r=e}let i=new e(0n);return i._initializeState(n,0),i}invm(e){this.assert(!e.isZero()&&e._sign===0,`Modulus for invm must be positive and non-zero`);let t=this.egcd(e);if(!t.gcd.eqn(1))throw Error(`Inverse does not exist (numbers are not coprime).`);return t.a.umod(e)}isEven(){return this._magnitude%2n==0n}isOdd(){return this._magnitude%2n==1n}andln(e){return this.assert(e>=0),Number(this._magnitude&BigInt(e))}bincn(e){this.assert(typeof e==`number`&&e>=0);let t=1n<<BigInt(e);return this._setValueFromSigned(this._getSignedValue()+t),this}isZero(){return this._magnitude===0n}cmpn(t){this.assert(Math.abs(t)<=e.MAX_IMULN_ARG,`Number is too big`);let n=this._getSignedValue(),r=BigInt(t);return n<r?-1:n>r?1:0}cmp(e){let t=this._getSignedValue(),n=e._getSignedValue();return t<n?-1:t>n?1:0}ucmp(e){return this._magnitude<e._magnitude?-1:this._magnitude>e._magnitude?1:0}gtn(e){return this.cmpn(e)===1}gt(e){return this.cmp(e)===1}gten(e){return this.cmpn(e)>=0}gte(e){return this.cmp(e)>=0}ltn(e){return this.cmpn(e)===-1}lt(e){return this.cmp(e)===-1}lten(e){return this.cmpn(e)<=0}lte(e){return this.cmp(e)<=0}eqn(e){return this.cmpn(e)===0}eq(e){return this.cmp(e)===0}toRed(e){return this.assert(this.red==null,`Already a number in reduction context`),this.assert(this._sign===0,`toRed works only with positives`),e.convertTo(this).forceRed(e)}fromRed(){return this.assert(this.red,`fromRed works only with numbers in reduction context`),this.red.convertFrom(this)}forceRed(e){return this.red=e,this}redAdd(e){return this.assert(this.red,`redAdd works only with red numbers`),this.red.add(this,e)}redIAdd(e){return this.assert(this.red,`redIAdd works only with red numbers`),this.red.iadd(this,e)}redSub(e){return this.assert(this.red,`redSub works only with red numbers`),this.red.sub(this,e)}redISub(e){return this.assert(this.red,`redISub works only with red numbers`),this.red.isub(this,e)}redShl(e){return this.assert(this.red,`redShl works only with red numbers`),this.red.shl(this,e)}redMul(e){return this.assert(this.red,`redMul works only with red numbers`),this.red.verify2(this,e),this.red.mul(this,e)}redIMul(e){return this.assert(this.red,`redIMul works only with red numbers`),this.red.verify2(this,e),this.red.imul(this,e)}redSqr(){return this.assert(this.red,`redSqr works only with red numbers`),this.red.verify1(this),this.red.sqr(this)}redISqr(){return this.assert(this.red,`redISqr works only with red numbers`),this.red.verify1(this),this.red.isqr(this)}redSqrt(){return this.assert(this.red,`redSqrt works only with red numbers`),this.red.verify1(this),this.red.sqrt(this)}redInvm(){return this.assert(this.red,`redInvm works only with red numbers`),this.red.verify1(this),this.red.invm(this)}redNeg(){return this.assert(this.red,`redNeg works only with red numbers`),this.red.verify1(this),this.red.neg(this)}redPow(e){return this.assert(this.red!=null&&e.red==null,`redPow(normalNum)`),this.red.verify1(this),this.red.pow(this,e)}static fromHex(t,n){let r=`be`;return(n===`little`||n===`le`)&&(r=`le`),new e(t,16,r)}toHex(e=0){if(this.isZero()&&e===0)return``;let t=this._getMinimalHex();t!==`0`&&t.length%2!=0&&(t=`0`+t);let n=e*2;for(;t.length<n;)t=`0`+t;return(this.isNeg()?`-`:``)+t}static fromJSON(t){return new e(t,16)}static fromNumber(t){return new e(t)}static fromString(t,n){return new e(t,n)}static fromSm(t,n=`big`){if(t.length===0)return new e(0n);let r=0,i=``;if(n===`little`){let e=t.length-1,n=t[e];n&128&&(r=1,n&=127),i+=(n<16?`0`:``)+n.toString(16);for(let n=e-1;n>=0;n--){let e=t[n];i+=(e<16?`0`:``)+e.toString(16)}}else{let e=t[0];e&128&&(r=1,e&=127),i+=(e<16?`0`:``)+e.toString(16);for(let e=1;e<t.length;e++){let n=t[e];i+=(n<16?`0`:``)+n.toString(16)}}let a=i===``?0n:BigInt(`0x`+i),o=new e(0n);return o._initializeState(a,r),o}toSm(e=`big`){if(this._magnitude===0n)return this._sign===1?[128]:[];let t=this._getMinimalHex();t.length%2!=0&&(t=`0`+t);let n=t.length/2,r=Array(n);for(let e=0,n=0;e<t.length;e+=2)r[n++]=parseInt(t.slice(e,e+2),16);return this._sign===1?r[0]&128?r.unshift(128):r[0]|=128:r[0]&128&&r.unshift(0),e===`little`?r.reverse():r}static fromBits(t,n=!1){let r=t>>>24,i=t&8388607,a=(t&8388608)!=0;if(n&&a)throw Error(`negative bit set`);if(r===0&&i===0){if(a&&n)throw Error(`negative bit set for zero value`);return new e(0n)}let o=new e(i);return r<=3?o.iushrn((3-r)*8):o.iushln((r-3)*8),a&&o.ineg(),o}toBits(){if(this.strip(),this.isZero()&&!this.isNeg())return 0;let e=this.isNeg(),t=this.abs(),n=t.toArray(`be`),r=0;for(;r<n.length-1&&n[r]===0;)r++;n=n.slice(r);let i=n.length;i===0&&!t.isZero()&&(n=[0],i=1),t.isZero()&&(i=0,n=[]);let a;if(i===0)a=0;else if(i<=3){a=0;for(let e=0;e<i;e++)a=a<<8|n[e]}else a=n[0]<<16|n[1]<<8|n[2];a&8388608&&i<=255&&(a>>>=8,i++);let o=i<<24|a;return e&&(o|=8388608),o>>>0}static fromScriptNum(t,n=!1,r){if(r!==void 0&&t.length>r)throw Error(`script number overflow`);if(t.length===0)return new e(0n);if(n&&!(t[t.length-1]&127)&&(t.length<=1||!(t[t.length-2]&128)))throw Error(`non-minimally encoded script number`);return e.fromSm(t,`little`)}toScriptNum(){return this.toSm(`little`)}_invmp(t){this.assert(t._sign===0,`p must not be negative for _invmp`),this.assert(!t.isZero(),`p must not be zero for _invmp`);let n=this.umod(t)._magnitude,r=t._magnitude,i=1n,a=0n,o=t._magnitude;for(;n>1n&&r>1n;){let e=0;for(;(n>>BigInt(e)&1n)==0n;)e++;if(e>0){n>>=BigInt(e);for(let t=0;t<e;++t)(i&1n)!=0n&&(i+=o),i>>=1n}let t=0;for(;(r>>BigInt(t)&1n)==0n;)t++;if(t>0){r>>=BigInt(t);for(let e=0;e<t;++e)(a&1n)!=0n&&(a+=o),a>>=1n}n>=r?(n-=r,i-=a):(r-=n,a-=i)}let s;if(n===1n)s=i;else if(r===1n)s=a;else if(n===0n&&r===1n)s=a;else if(r===0n&&n===1n)s=i;else throw Error(`_invmp: GCD is not 1, inverse does not exist. aVal=`+n+`, bVal=`+r);s%=o,s<0n&&(s+=o);let c=new e(0n);return c._initializeState(s,0),c}mulTo(e,t){return t._magnitude=this._magnitude*e._magnitude,t._sign=t._magnitude===0n?0:this._sign^e._sign,t._nominalWordLength=this.length+e.length,t.red=null,t.normSign(),t}},Lh=class{name;p;k;n;tmp;constructor(e,t){this.name=e,this.p=new J(t,16),this.n=this.p.bitLength(),this.k=new J(BigInt(1)).iushln(this.n).isub(this.p),this.tmp=this._tmp()}_tmp(){let e=new J(BigInt(0)),t=Math.ceil(this.n/J.wordSize);return e.expand(Math.max(1,t)),e}ireduce(e){let t=e,n;do this.split(t,this.tmp),this.imulK(t),t.iadd(this.tmp),n=t.bitLength();while(n>this.n);let r=n<this.n?-1:t.ucmp(this.p);return r===0?t.words=[0]:r>0&&t.isub(this.p),t.strip(),t}split(e,t){e.iushrn(this.n,0,t)}imulK(e){return e.imul(this.k)}},Rh=class extends Lh{constructor(){super(`k256`,`ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f`)}split(e,t){let n=4194303,r=e.words,i=e.length,a=Math.min(i,9),o=Array(a+(i>9?1:0)).fill(0);for(let e=0;e<a;e++)o[e]=r[e];let s=a;if(i<=9){let n=Array(s);for(let e=0;e<s;++e)n[e]=o[e];t.words=n,e.words=[0];return}let c=r[9];o[s++]=c&n;let l=Array(s);for(let e=0;e<s;++e)l[e]=o[e];t.words=l;let u=Array(Math.max(1,i-9)).fill(0),d=0;for(let e=10;e<i;e++){let t=r[e]|0;d<u.length&&(u[d++]=(t&n)<<4|c>>>22),c=t}c>>>=22,d<u.length?u[d++]=c:c!==0&&u.length;let f=Array(d);for(let e=0;e<d;++e)f[e]=u[e];e.words=f}imulK(e){let t=e.words,n=e.length,r=n+2,i=Array(r).fill(0);for(let e=0;e<n;e++)i[e]=t[e];let a=0;for(let e=0;e<r;e++){let t=i[e]|0;a+=t*977,i[e]=a&67108863,a=t*64+(a/67108864|0)}return e.words=i,e}},zh=class{prime;m;constructor(e){if(e===`k256`){let e=new Rh;this.m=e.p,this.prime=e}else this.assert(e.gtn(1),`modulus must be greater than 1`),this.m=e,this.prime=null}assert(e,t=`Assertion failed`){if(!e)throw Error(t)}verify1(e){this.assert(e.negative===0,`red works only with positives`),this.assert(e.red,`red works only with red numbers`)}verify2(e,t){this.assert((e.negative|t.negative)===0,`red works only with positives`),this.assert(e.red!=null&&e.red===t.red,`red works only with red numbers`)}imod(e){return this.prime==null?(J.move(e,e.umod(this.m).forceRed(this)),e):this.prime.ireduce(e).forceRed(this)}neg(e){return e.isZero()?e.clone():this.m.sub(e).forceRed(this)}add(e,t){this.verify2(e,t);let n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n.forceRed(this)}iadd(e,t){this.verify2(e,t);let n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n}sub(e,t){this.verify2(e,t);let n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n.forceRed(this)}isub(e,t){this.verify2(e,t);let n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n}shl(e,t){return this.verify1(e),this.imod(e.ushln(t))}imul(e,t){return this.verify2(e,t),this.imod(e.imul(t))}mul(e,t){return this.verify2(e,t),this.imod(e.mul(t))}isqr(e){return this.imul(e,e.clone())}sqr(e){return this.mul(e,e)}sqrt(e){if(e.isZero())return e.clone();let t=this.m.andln(3);if(this.assert(t%2==1),t===3){let t=this.m.add(new J(1)).iushrn(2);return this.pow(e,t)}let n=this.m.subn(1),r=0;for(;!n.isZero()&&n.andln(1)===0;)r++,n.iushrn(1);this.assert(!n.isZero());let i=new J(1).toRed(this),a=i.redNeg(),o=this.m.subn(1).iushrn(1),s=this.m.bitLength(),c=new J(2*s*s).toRed(this);for(;this.pow(c,o).cmp(a)!==0;)c.redIAdd(a);let l=this.pow(c,n),u=this.pow(e,n.addn(1).iushrn(1)),d=this.pow(e,n),f=r;for(;d.cmp(i)!==0;){let e=d,t=0;for(;e.cmp(i)!==0;t++)e=e.redSqr();this.assert(t<f);let n=this.pow(l,new J(1).iushln(f-t-1));u=u.redMul(n),l=n.redSqr(),d=d.redMul(l),f=t}return u}invm(e){let t=e._invmp(this.m);return t.negative===0?this.imod(t):(t.negative=0,this.imod(t).redNeg())}pow(e,t){if(t.isZero())return new J(1).toRed(this);if(t.cmpn(1)===0)return e.clone();let n=Array(16);n[0]=new J(1).toRed(this),n[1]=e;let r=2;for(;r<n.length;r++)n[r]=this.mul(n[r-1],e);let i=n[0],a=0,o=0,s=t.bitLength()%26;for(s===0&&(s=26),r=t.length-1;r>=0;r--){let e=t.words[r];for(let t=s-1;t>=0;t--){let s=e>>t&1;if(i!==n[0]&&(i=this.sqr(i)),s===0&&a===0){o=0;continue}a<<=1,a|=s,o++,!(o!==4&&(r!==0||t!==0))&&(i=this.mul(i,n[a]),o=0,a=0)}s=26}return i}convertTo(e){let t=e.umod(this.m);return t===e?t.clone():t}convertFrom(e){let t=e.clone();return t.red=null,t}},Bh=class extends zh{shift;r;r2;rinv;minv;constructor(e){super(e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new J(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}convertTo(e){return this.imod(e.ushln(this.shift))}convertFrom(e){let t=this.imod(e.mul(this.rinv));return t.red=null,t}imul(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;let n=e.imul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a.forceRed(this)}mul(e,t){if(e.isZero()||t.isZero())return new J(0).forceRed(this);let n=e.mul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a.forceRed(this)}invm(e){return this.imod(e._invmp(this.m).mul(this.r2)).forceRed(this)}},Vh=class{curve;type;precomputed;constructor(e){this.curve=new dv,this.type=e,this.precomputed=null}},Hh=class e extends Vh{x;y;z;zOne;constructor(e,t,n){super(`jacobian`),e===null&&t===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new J(0)):(J.isBN(e)||(e=new J(e,16)),this.x=e,J.isBN(t)||(t=new J(t,16)),this.y=t,J.isBN(n)||(n=new J(n,16)),this.z=n),this.x.red??(this.x=this.x.toRed(this.curve.red)),this.y.red??(this.y=this.y.toRed(this.curve.red)),this.z.red??(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}toP(){if(this.isInfinity())return new lv(null,null);let e=this.z.redInvm(),t=e.redSqr(),n=this.x.redMul(t),r=this.y.redMul(t).redMul(e);return new lv(n,r)}neg(){return new e(this.x,this.y.redNeg(),this.z)}add(t){if(this.isInfinity())return t;if(t.isInfinity())return this;let n=t.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(n),a=t.x.redMul(r),o=this.y.redMul(n.redMul(t.z)),s=t.y.redMul(r.redMul(this.z)),c=i.redSub(a),l=o.redSub(s);if(c.cmpn(0)===0)return l.cmpn(0)===0?this.dbl():new e(null,null,null);let u=c.redSqr(),d=u.redMul(c),f=i.redMul(u),p=l.redSqr().redIAdd(d).redISub(f).redISub(f),m=l.redMul(f.redISub(p)).redISub(o.redMul(d)),h=this.z.redMul(t.z).redMul(c);return new e(p,m,h)}mixedAdd(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;if(t.x===null||t.y===null)throw Error(`Point coordinates cannot be null`);let n=this.z.redSqr(),r=this.x,i=t.x.redMul(n),a=this.y,o=t.y.redMul(n).redMul(this.z),s=r.redSub(i),c=a.redSub(o);if(s.cmpn(0)===0)return c.cmpn(0)===0?this.dbl():new e(null,null,null);let l=s.redSqr(),u=l.redMul(s),d=r.redMul(l),f=c.redSqr().redIAdd(u).redISub(d).redISub(d),p=c.redMul(d.redISub(f)).redISub(a.redMul(u)),m=this.z.redMul(s);return new e(f,p,m)}dblp(e){if(e===0||this.isInfinity())return this;if(e===void 0)return this.dbl();let t=this;for(let n=0;n<e;n++)t=t.dbl();return t}dbl(){if(this.isInfinity())return this;let t,n,r;if(this.zOne){let e=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(e).redISub(a);o=o.redIAdd(o);let s=e.redAdd(e).redIAdd(e),c=s.redSqr().redISub(o).redISub(o),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),t=c,n=s.redMul(o.redISub(c)).redISub(l),r=this.y.redAdd(this.y)}else{let e=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(e).redISub(a);o=o.redIAdd(o);let s=e.redAdd(e).redIAdd(e),c=s.redSqr(),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),t=c.redISub(o).redISub(o),n=s.redMul(o.redISub(t)).redISub(l),r=this.y.redMul(this.z),r=r.redIAdd(r)}return new e(t,n,r)}eq(e){if(e.type===`affine`)return this.eq(e.toJ());if(this===e)return!0;let t=this.z.redSqr();e=e;let n=e.z.redSqr();if(this.x.redMul(n).redISub(e.x.redMul(t)).cmpn(0)!==0)return!1;let r=t.redMul(this.z),i=n.redMul(e.z);return this.y.redMul(i).redISub(e.y.redMul(r)).cmpn(0)===0}eqXToP(e){let t=this.z.redSqr(),n=e.toRed(this.curve?.red).redMul(t);if(this.x.cmp(n)===0)return!0;let r=e.clone();if(this.curve===null||this.curve.redN==null)throw Error(`Curve or redN is not initialized.`);let i=this.curve.redN.redMul(t);for(;r.cmp(this.curve.p)<0;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(n.redIAdd(i),this.x.cmp(n)===0)return!0}return!1}inspect(){return this.isInfinity()?`<EC JPoint Infinity>`:`<EC JPoint x: `+this.x.toString(16,2)+` y: `+this.y.toString(16,2)+` z: `+this.z.toString(16,2)+`>`}isInfinity(){return this.z.cmpn(0)===0}},Uh=(e,t=`Hash assertion failed`)=>{if(!e)throw Error(t)},Wh=class{pending;pendingTotal;blockSize;outSize;endian;_delta8;_delta32;padLength;hmacStrength;constructor(e,t,n,r){this.pending=null,this.pendingTotal=0,this.blockSize=e,this.outSize=t,this.hmacStrength=n,this.padLength=r/8,this.endian=`big`,this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}_update(e,t){throw Error(`Not implemented`)}_digest(){throw Error(`Not implemented`)}_digestHex(){throw Error(`Not implemented`)}update(e,t){if(e=Kh(e,t),this.pending==null?this.pending=e:this.pending=this.pending.concat(e),this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;let t=e.length%this._delta8;this.pending=e.slice(e.length-t,e.length),this.pending.length===0&&(this.pending=null),e=Zh(e,0,e.length-t,this.endian);for(let t=0;t<e.length;t+=this._delta32)this._update(e,t)}return this}digest(){return this.update(this._pad()),Uh(this.pending===null),this._digest()}digestHex(){return this.update(this._pad()),Uh(this.pending===null),this._digestHex()}_pad(){let e=this.pendingTotal,t=this._delta8,n=t-(e+this.padLength)%t,r=Array(n+this.padLength);r[0]=128;let i;for(i=1;i<n;i++)r[i]=0;e<<=3;let a;if(this.endian===`big`){for(a=8;a<this.padLength;a++)r[i++]=0;r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=e>>>24&255,r[i++]=e>>>16&255,r[i++]=e>>>8&255,r[i++]=e&255}else for(r[i++]=e&255,r[i++]=e>>>8&255,r[i++]=e>>>16&255,r[i++]=e>>>24&255,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,a=8;a<this.padLength;a++)r[i++]=0;return r}};function Gh(e,t){return(e.charCodeAt(t)&64512)!=55296||t<0||t+1>=e.length?!1:(e.charCodeAt(t+1)&64512)==56320}function Kh(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];let n=[];if(typeof e==`string`)if(t!==`hex`){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?n[t++]=i:i<2048?(n[t++]=i>>6|192,n[t++]=i&63|128):Gh(e,r)?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),n[t++]=i>>18|240,n[t++]=i>>12&63|128,n[t++]=i>>6&63|128,n[t++]=i&63|128):(n[t++]=i>>12|224,n[t++]=i>>6&63|128,n[t++]=i&63|128)}}else{e=e.replace(/[^a-z0-9]+/gi,``),e.length%2!=0&&(e=`0`+e);for(let t=0;t<e.length;t+=2)n.push(parseInt(e[t]+e[t+1],16))}else{e=e;for(let t=0;t<e.length;t++)n[t]=e[t]|0}return n}function qh(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(e&255)<<24)>>>0}function Jh(e,t){let n=``;for(let r=0;r<e.length;r++){let i=e[r];t===`little`&&(i=qh(i)),n+=Yh(i.toString(16))}return n}function Yh(e){return e.length===7?`0`+e:e.length===6?`00`+e:e.length===5?`000`+e:e.length===4?`0000`+e:e.length===3?`00000`+e:e.length===2?`000000`+e:e.length===1?`0000000`+e:e}function Xh(e){let t=``;for(let n of e)t+=n.toString(16).padStart(2,`0`);return t}function Zh(e,t,n,r){let i=n-t;Uh(i%4==0);let a=Array(i/4);for(let n=0,i=t;n<a.length;n++,i+=4){let t;t=r===`big`?e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]:e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i],a[n]=t>>>0}return a}function Qh(e,t){let n=Array(e.length*4);for(let r=0,i=0;r<e.length;r++,i+=4){let a=e[r];t===`big`?(n[i]=a>>>24,n[i+1]=a>>>16&255,n[i+2]=a>>>8&255,n[i+3]=a&255):(n[i+3]=a>>>24,n[i+2]=a>>>16&255,n[i+1]=a>>>8&255,n[i]=a&255)}return n}function $h(e,t){return e>>>t|e<<32-t}function eg(e,t){return e<<t|e>>>32-t}function tg(e,t){return e+t>>>0}function ng(e,t,n){return e+t+n>>>0}function rg(e,t,n,r){return e+t+n+r>>>0}function ig(e,t,n,r,i){return e+t+n+r+i>>>0}function ag(e,t,n){return e&t^~e&n}function og(e,t,n){return e&t^e&n^t&n}function sg(e){return $h(e,2)^$h(e,13)^$h(e,22)}function cg(e){return $h(e,6)^$h(e,11)^$h(e,25)}function lg(e){return $h(e,7)^$h(e,18)^e>>>3}function ug(e){return $h(e,17)^$h(e,19)^e>>>10}var dg=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],fg=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],pg=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],mg=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function hg(e,t,n,r){return e<=15?t^n^r:e<=31?t&n|~t&r:e<=47?(t|~n)^r:e<=63?t&r|n&~r:t^(n|~r)}function gg(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function _g(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var vg=class extends Wh{h;constructor(){super(512,160,192,64),this.endian=`little`,this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian=`little`}_update(e,t){let n=this.h[0],r=this.h[1],i=this.h[2],a=this.h[3],o=this.h[4],s=n,c=r,l=i,u=a,d=o,f;for(let p=0;p<80;p++)f=tg(eg(rg(n,hg(p,r,i,a),e[dg[p]+t],gg(p)),pg[p]),o),n=o,o=a,a=eg(i,10),i=r,r=f,f=tg(eg(rg(s,hg(79-p,c,l,u),e[fg[p]+t],_g(p)),mg[p]),d),s=d,d=u,u=eg(l,10),l=c,c=f;f=ng(this.h[1],i,u),this.h[1]=ng(this.h[2],a,d),this.h[2]=ng(this.h[3],o,s),this.h[3]=ng(this.h[4],n,c),this.h[4]=ng(this.h[0],r,l),this.h[0]=f}_digest(){return Qh(this.h,`little`)}_digestHex(){return Jh(this.h,`little`)}},yg=class{h;constructor(){this.h=new s_}update(e,t){let n=Uint8Array.from(Kh(e,t));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return Xh(this.h.digest())}},bg=class{h;blockSize=64;outSize=32;constructor(e){let t=Uint8Array.from(Kh(e,`hex`));this.h=new __(c_,t)}update(e,t){return this.h.update(Uint8Array.from(Kh(e,t))),this}digest(){return Array.from(this.h.digest())}digestHex(){return Xh(this.h.digest())}},xg=class{h;blockSize=128;outSize=32;constructor(e){let t=Uint8Array.from(Kh(e,`hex`));this.h=new __(g_,t)}update(e,t){return this.h.update(Uint8Array.from(Kh(e,t))),this}digest(){return Array.from(this.h.digest())}digestHex(){return Xh(this.h.digest())}};const Sg=(e,t)=>new yg().update(e,t).digest(),Cg=(e,t)=>{let n=new yg().update(e,t).digest();return new yg().update(n).digest()},wg=(e,t)=>{let n=new yg().update(e,t).digest();return new vg().update(n).digest()},Tg=(e,t,n)=>new bg(e).update(t,n).digest(),Eg=(e,t,n)=>new xg(e).update(t,n).digest();function Dg(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function Og(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, got ${e}`)}function kg(e,...t){if(!Dg(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length)){let n=t.join(`,`);throw Error(`Uint8Array expected of length ${n}, got length=${e.length}`)}}function Ag(e){if(typeof e!=`function`||typeof e.create!=`function`)throw Error(`Hash should be wrapped by utils.createHasher`);Og(e.outputLen),Og(e.blockLen)}function jg(e,t=!0){if(e.destroyed===!0)throw Error(`Hash instance has been destroyed`);if(t&&e.finished===!0)throw Error(`Hash#digest() has already been called`)}function Mg(e,t){kg(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least ${n}`)}function Ng(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Pg(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Fg(e){return typeof e==`string`&&(e=Ig(e)),kg(e),e}function Ig(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}var Lg=class{};function Rg(e){let t=t=>e().update(Fg(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}var zg=BigInt(2**32-1),Bg=BigInt(32);function Vg(e,t=!1){return t?{h:Number(e&zg),l:Number(e>>Bg&zg)}:{h:Number(e>>Bg&zg)|0,l:Number(e&zg)|0}}function Hg(e,t=!1){let n=e.length,r=new Uint32Array(n),i=new Uint32Array(n);for(let a=0;a<n;a++){let{h:n,l:o}=Vg(e[a],t);r[a]=n,i[a]=o}return[r,i]}var Ug=(e,t,n)=>e>>>n,Wg=(e,t,n)=>e<<32-n|t>>>n,Gg=(e,t,n)=>e>>>n|t<<32-n,Kg=(e,t,n)=>e<<32-n|t>>>n,qg=(e,t,n)=>e<<64-n|t>>>n-32,Jg=(e,t,n)=>e>>>n-32|t<<64-n;function Yg(e,t,n,r){let i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}var Xg=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),Zg=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,Qg=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),$g=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,e_=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),t_=(e,t,n,r,i,a)=>t+n+r+i+a+(e/2**32|0)|0,n_=class extends Lg{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=Pg(this.buffer)}update(e){jg(this),e=Fg(e),kg(e);let{view:t,buffer:n,blockLen:r}=this,i=e.length;for(let a=0;a<i;){let o=Math.min(r-this.pos,i-a);if(o===r){let t=Pg(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){jg(this),Mg(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,Ng(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;r_(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=Pg(e),s=this.outputLen;if(s%4!=0)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.destroyed=a,e.finished=i,e.length=r,e.pos=o,r%t!==0&&e.buffer.set(n),e}clone(){return this._cloneInto()}};function r_(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}var i_=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),a_=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),o_=new Uint32Array(64),s_=class extends n_{A=i_[0]|0;B=i_[1]|0;C=i_[2]|0;D=i_[3]|0;E=i_[4]|0;F=i_[5]|0;G=i_[6]|0;H=i_[7]|0;constructor(e=32){super(64,e,8,!1)}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)o_[n]=e.getUint32(t);for(let e=16;e<64;e++){let t=o_[e-15],n=o_[e-2],r=lg(t),i=ug(n);o_[e]=tg(tg(r,o_[e-7]),tg(i,o_[e-16]))}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=ig(l,cg(o),ag(o,s,c),a_[e],o_[e]),u=tg(sg(n),og(n,r,i));l=c,c=s,s=o,o=tg(a,t),a=i,i=r,r=n,n=tg(t,u)}this.A=tg(this.A,n),this.B=tg(this.B,r),this.C=tg(this.C,i),this.D=tg(this.D,a),this.E=tg(this.E,o),this.F=tg(this.F,s),this.G=tg(this.G,c),this.H=tg(this.H,l)}roundClean(){Ng(o_)}destroy(){Ng(this.buffer),this.set(0,0,0,0,0,0,0,0)}},c_=Rg(()=>new s_),l_=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),u_=(()=>Hg(`0x428a2f98d728ae22.0x7137449123ef65cd.0xb5c0fbcfec4d3b2f.0xe9b5dba58189dbbc.0x3956c25bf348b538.0x59f111f1b605d019.0x923f82a4af194f9b.0xab1c5ed5da6d8118.0xd807aa98a3030242.0x12835b0145706fbe.0x243185be4ee4b28c.0x550c7dc3d5ffb4e2.0x72be5d74f27b896f.0x80deb1fe3b1696b1.0x9bdc06a725c71235.0xc19bf174cf692694.0xe49b69c19ef14ad2.0xefbe4786384f25e3.0x0fc19dc68b8cd5b5.0x240ca1cc77ac9c65.0x2de92c6f592b0275.0x4a7484aa6ea6e483.0x5cb0a9dcbd41fbd4.0x76f988da831153b5.0x983e5152ee66dfab.0xa831c66d2db43210.0xb00327c898fb213f.0xbf597fc7beef0ee4.0xc6e00bf33da88fc2.0xd5a79147930aa725.0x06ca6351e003826f.0x142929670a0e6e70.0x27b70a8546d22ffc.0x2e1b21385c26c926.0x4d2c6dfc5ac42aed.0x53380d139d95b3df.0x650a73548baf63de.0x766a0abb3c77b2a8.0x81c2c92e47edaee6.0x92722c851482353b.0xa2bfe8a14cf10364.0xa81a664bbc423001.0xc24b8b70d0f89791.0xc76c51a30654be30.0xd192e819d6ef5218.0xd69906245565a910.0xf40e35855771202a.0x106aa07032bbd1b8.0x19a4c116b8d2d0c8.0x1e376c085141ab53.0x2748774cdf8eeb99.0x34b0bcb5e19b48a8.0x391c0cb3c5c95a63.0x4ed8aa4ae3418acb.0x5b9cca4f7763e373.0x682e6ff3d6b2b8a3.0x748f82ee5defb2fc.0x78a5636f43172f60.0x84c87814a1f0ab72.0x8cc702081a6439ec.0x90befffa23631e28.0xa4506cebde82bde9.0xbef9a3f7b2c67915.0xc67178f2e372532b.0xca273eceea26619c.0xd186b8c721c0c207.0xeada7dd6cde0eb1e.0xf57d4f7fee6ed178.0x06f067aa72176fba.0x0a637dc5a2c898a6.0x113f9804bef90dae.0x1b710b35131c471b.0x28db77f523047d84.0x32caab7b40c72493.0x3c9ebe0a15c9bebc.0x431d67c49c100d4c.0x4cc5d4becb3e42b6.0x597f299cfc657e2a.0x5fcb6fab3ad6faec.0x6c44198c4a475817`.split(`.`).map(e=>BigInt(e))))(),d_=(()=>u_[0])(),f_=(()=>u_[1])(),p_=new Uint32Array(80),m_=new Uint32Array(80),h_=class extends n_{Ah=l_[0]|0;Al=l_[1]|0;Bh=l_[2]|0;Bl=l_[3]|0;Ch=l_[4]|0;Cl=l_[5]|0;Dh=l_[6]|0;Dl=l_[7]|0;Eh=l_[8]|0;El=l_[9]|0;Fh=l_[10]|0;Fl=l_[11]|0;Gh=l_[12]|0;Gl=l_[13]|0;Hh=l_[14]|0;Hl=l_[15]|0;constructor(e=64){super(128,e,16,!1)}get(){let{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:a,Dh:o,Dl:s,Eh:c,El:l,Fh:u,Fl:d,Gh:f,Gl:p,Hh:m,Hl:h}=this;return[e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h]}set(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=r|0,this.Ch=i|0,this.Cl=a|0,this.Dh=o|0,this.Dl=s|0,this.Eh=c|0,this.El=l|0,this.Fh=u|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=m|0,this.Hl=h|0}process(e,t){for(let n=0;n<16;n++,t+=4)p_[n]=e.getUint32(t),m_[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=p_[e-15]|0,n=m_[e-15]|0,r=Gg(t,n,1)^Gg(t,n,8)^Ug(t,n,7),i=Kg(t,n,1)^Kg(t,n,8)^Wg(t,n,7),a=p_[e-2]|0,o=m_[e-2]|0,s=Gg(a,o,19)^qg(a,o,61)^Ug(a,o,6),c=Kg(a,o,19)^Jg(a,o,61)^Wg(a,o,6),l=Qg(i,c,m_[e-7],m_[e-16]);p_[e]=$g(l,r,s,p_[e-7],p_[e-16])|0,m_[e]=l|0}let{Ah:n,Al:r,Bh:i,Bl:a,Ch:o,Cl:s,Dh:c,Dl:l,Eh:u,El:d,Fh:f,Fl:p,Gh:m,Gl:h,Hh:g,Hl:_}=this;for(let e=0;e<80;e++){let t=Gg(u,d,14)^Gg(u,d,18)^qg(u,d,41),v=Kg(u,d,14)^Kg(u,d,18)^Jg(u,d,41),y=u&f^~u&m,b=d&p^~d&h,x=e_(_,v,b,f_[e],m_[e]),S=t_(x,g,t,y,d_[e],p_[e]),C=x|0,w=Gg(n,r,28)^qg(n,r,34)^qg(n,r,39),T=Kg(n,r,28)^Jg(n,r,34)^Jg(n,r,39),E=n&i^n&o^i&o,D=r&a^r&s^a&s;g=m|0,_=h|0,m=f|0,h=p|0,f=u|0,p=d|0,{h:u,l:d}=Yg(c|0,l|0,S|0,C|0),c=o|0,l=s|0,o=i|0,s=a|0,i=n|0,a=r|0;let O=Xg(T,D,C);n=Zg(O,w,E,S),r=O|0}({h:n,l:r}=Yg(n,r,this.Ah,this.Al)),{h:i,l:a}=Yg(i,a,this.Bh,this.Bl),{h:o,l:s}=Yg(o,s,this.Ch,this.Cl),{h:c,l}=Yg(c,l,this.Dh,this.Dl),{h:u,l:d}=Yg(u,d,this.Eh,this.El),{h:f,l:p}=Yg(f,p,this.Fh,this.Fl),{h:m,l:h}=Yg(m,h,this.Gh,this.Gl),{h:g,l:_}=Yg(g,_,this.Hh,this.Hl),this.set(n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_)}roundClean(){Ng(p_,m_)}destroy(){Ng(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},g_=Rg(()=>new h_),__=class extends Lg{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){super(),Ag(e);let n=Fg(t);if(this.iHash=e.create(),typeof this.iHash.update!=`function`)throw Error(`Expected instance of class which extends utils.Hash`);this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),Ng(i)}update(e){return jg(this),this.iHash.update(e),this}digestInto(e){jg(this),kg(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:a,outputLen:o}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=a,e.outputLen=o,e.oHash=t._cloneInto(e.oHash??void 0),e.iHash=n._cloneInto(e.iHash??void 0),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},v_=(e,t,n)=>new __(e,t).update(n).digest();v_.create=(e,t)=>new __(e,t);const y_=e=>e.length%2==1?`0`+e:e,b_=e=>{let t=``;for(let n of e)t+=y_(n.toString(16));return t},x_=(e,t)=>{if(Array.isArray(e))return e.slice();if(e===void 0)return[];if(typeof e!=`string`)return Array.from(e,e=>e|0);switch(t){case`hex`:return S_(e);case`base64`:return C_(e);default:return w_(e)}};var S_=e=>{e=e.replace(/[^a-z0-9]+/gi,``),e.length%2!=0&&(e=`0`+e);let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e[n]+e[n+1],16));return t},C_=e=>{let t=[],n=0,r=0;for(let i of e.replace(/=+$/,``))n=n<<6|`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`.indexOf(i),r+=6,r>=8&&(r-=8,t.push(n>>r&255),n&=(1<<r)-1);return t};function w_(e){let t=[];for(let n=0;n<e.length;n++){let r=e.codePointAt(n);if(r===void 0)throw Error(`Index out of range: ${n}`);let i=r;i>65535?n++:i>=55296&&i<=57343&&(i=65533),i<=127?t.push(i):i<=2047?t.push(192|i>>6,128|i&63):i<=65535?t.push(224|i>>12,128|i>>6&63,128|i&63):t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}return t}const T_=e=>{let t=``,n=0;for(let r=0;r<e.length;r++){let i=e[r];if(n>0){n--;continue}if(i<=127)t+=String.fromCharCode(i);else if(i>=192&&i<=223){let a=e[r+1];n=1;let o=(i&31)<<6|a&63;t+=String.fromCharCode(o)}else if(i>=224&&i<=239){let a=e[r+1],o=e[r+2];n=2;let s=(i&15)<<12|(a&63)<<6|o&63;t+=String.fromCharCode(s)}else if(i>=240&&i<=247){let a=e[r+1],o=e[r+2],s=e[r+3];n=3;let c=(i&7)<<18|(a&63)<<12|(o&63)<<6|s&63,l=55296+(c-65536>>10),u=56320+(c-65536&1023);t+=String.fromCharCode(l,u)}}return t},E_=(e,t)=>{switch(t){case`hex`:return b_(e);case`utf8`:return T_(e);default:return e}};function D_(e){let t=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,n=``,r;for(r=0;r<e.length;r+=3){let i=e[r],a=r+1<e.length?e[r+1]:0,o=r+2<e.length?e[r+2]:0,s=i>>2,c=(i&3)<<4|a>>4,l=(a&15)<<2|o>>6,u=o&63;n+=t.charAt(s)+t.charAt(c),n+=r+1<e.length?t.charAt(l):`=`,n+=r+2<e.length?t.charAt(u):`=`}return n}var O_=`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`;const k_=e=>{if(e===``||typeof e!=`string`)throw Error(`Expected base58 string but got ${e}`);let t=e.match(/[IOl0]/gmu);if(t!==null)throw Error(`Invalid base58 character ${t.join(``)}`);let n=e.match(/^1+/gmu),r=n===null?0:n[0].length,i=(e.length-r)*(Math.log(58)/Math.log(256))+1>>>0;return[...new Uint8Array([...new Uint8Array(r),...(e.match(/./gmu)??[]).map(e=>O_.indexOf(e)).reduce((e,t)=>(e=e.map(e=>{let n=e*58+t;return t=n>>8,n}),e),new Uint8Array(i)).reverse().filter((e=>t=>e||=t)(!1))])]},A_=e=>{let t=Array(256).fill(-1);for(let e=0;e<58;++e)t[O_.charCodeAt(e)]=e;let n=[];for(let r of e){let e=r;for(let r=0;r<n.length;++r){let i=(t[n[r]]<<8)+e;n[r]=O_.charCodeAt(i%58),e=i/58|0}for(;e!==0;)n.push(O_.charCodeAt(e%58)),e=e/58|0}for(let t of e)if(t!==0)break;else n.push(49);return n.reverse(),String.fromCharCode(...n)},j_=(e,t=[0])=>{let n=Cg([...t,...e]);return n=[...t,...e,...n.slice(0,4)],A_(n)},M_=(e,t,n=1)=>{let r=k_(e),i=r.slice(0,n),a=r.slice(n,-4),o=[...i,...a];return o=Cg(o),r.slice(-4).forEach((e,t)=>{if(e!==o[t])throw Error(`Invalid checksum`)}),t===`hex`&&(i=b_(i),a=b_(a)),{prefix:i,data:a}};var N_=class e{bufs;length;constructor(e){this.bufs=e===void 0?[]:e,this.length=0;for(let e of this.bufs)this.length+=e.length}getLength(){return this.length}toArray(){let e=this.length,t=Array(e),n=0;for(let e of this.bufs)for(let r of e)t[n++]=r;return t}write(e){return this.bufs.push(e),this.length+=e.length,this}writeReverse(e){let t=Array(e.length);for(let n=0;n<t.length;n++)t[n]=e[e.length-1-n];return this.bufs.push(t),this.length+=t.length,this}writeUInt8(e){let t=[,];return t[0]=e,this.write(t),this}writeInt8(e){let t=[,];return t[0]=e&255,this.write(t),this}writeUInt16BE(e){let t=[e>>8&255,e&255];return this.bufs.push(t),this.length+=2,this}writeInt16BE(e){return this.writeUInt16BE(e&65535)}writeUInt16LE(e){let t=[e&255,e>>8&255];return this.bufs.push(t),this.length+=2,this}writeInt16LE(e){return this.writeUInt16LE(e&65535)}writeUInt32BE(e){let t=[e>>24&255,e>>16&255,e>>8&255,e&255];return this.bufs.push(t),this.length+=4,this}writeInt32BE(e){return this.writeUInt32BE(e>>>0)}writeUInt32LE(e){let t=[e&255,e>>8&255,e>>16&255,e>>24&255];return this.bufs.push(t),this.length+=4,this}writeInt32LE(e){return this.writeUInt32LE(e>>>0)}writeUInt64BEBn(e){let t=e.toArray(`be`,8);return this.write(t),this}writeUInt64LEBn(e){let t=e.toArray(`be`,8);return this.writeReverse(t),this}writeUInt64LE(e){let t=new J(e).toArray(`be`,8);return this.writeReverse(t),this}writeVarIntNum(t){let n=e.varIntNum(t);return this.write(n),this}writeVarIntBn(t){let n=e.varIntBn(t);return this.write(n),this}static varIntNum(e){let t;if(e<0)return this.varIntBn(new J(e));if(e<253)t=[e];else if(e<65536)t=[253,e&255,e>>8&255];else if(e<4294967296)t=[254,e&255,e>>8&255,e>>16&255,e>>24&255];else{let n=e&4294967295,r=Math.floor(e/4294967296)&4294967295;t=[255,n&255,n>>8&255,n>>16&255,n>>24&255,r&255,r>>8&255,r>>16&255,r>>24&255]}return t}static varIntBn(t){let n;if(t.isNeg()&&(t=t.add(I_)),t.ltn(253))n=[t.toNumber()];else if(t.ltn(65536)){let e=t.toNumber();n=[253,e&255,e>>8&255]}else if(t.lt(new J(4294967296))){let e=t.toNumber();n=[254,e&255,e>>8&255,e>>16&255,e>>24&255]}else{let r=new e;r.writeUInt8(255),r.writeUInt64LEBn(t),n=r.toArray()}return n}},P_=class{bin;pos;length;constructor(e=[],t=0){this.bin=e,this.pos=t,this.length=e.length}eof(){return this.pos>=this.length}read(e=this.length){let t=this.pos,n=this.pos+e;return this.pos=n,this.bin.slice(t,n)}readReverse(e=this.length){let t=Array(e);for(let n=0;n<e;n++)t[n]=this.bin[this.pos+e-1-n];return this.pos+=e,t}readUInt8(){let e=this.bin[this.pos];return this.pos+=1,e}readInt8(){let e=this.bin[this.pos];return this.pos+=1,e&128?e-256:e}readUInt16BE(){let e=this.bin[this.pos]<<8|this.bin[this.pos+1];return this.pos+=2,e}readInt16BE(){let e=this.readUInt16BE();return e&32768?e-65536:e}readUInt16LE(){let e=this.bin[this.pos]|this.bin[this.pos+1]<<8;return this.pos+=2,e}readInt16LE(){let e=this.readUInt16LE();return e&32768?e-65536:e}readUInt32BE(){let e=this.bin[this.pos]*16777216+(this.bin[this.pos+1]<<16|this.bin[this.pos+2]<<8|this.bin[this.pos+3]);return this.pos+=4,e}readInt32BE(){let e=this.readUInt32BE();return e&2147483648?e-4294967296:e}readUInt32LE(){let e=(this.bin[this.pos]|this.bin[this.pos+1]<<8|this.bin[this.pos+2]<<16|this.bin[this.pos+3]<<24)>>>0;return this.pos+=4,e}readInt32LE(){let e=this.readUInt32LE();return e&2147483648?e-4294967296:e}readUInt64BEBn(){let e=this.bin.slice(this.pos,this.pos+8),t=new J(e);return this.pos+=8,t}readUInt64LEBn(){let e=this.readReverse(8);return new J(e)}readInt64LEBn(){let e=this.readReverse(8),t=new J(e);return t.gte(F_)&&(t=t.sub(I_)),t}readVarIntNum(e=!0){let t=this.readUInt8(),n;switch(t){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:if(n=e?this.readInt64LEBn():this.readUInt64LEBn(),n.lte(new J(2).pow(new J(53))))return n.toNumber();throw Error(`number too large to retain precision - use readVarIntBn`);default:return t}}readVarInt(){switch(this.bin[this.pos]){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}}readVarIntBn(){let e=this.readUInt8();switch(e){case 253:return new J(this.readUInt16LE());case 254:return new J(this.readUInt32LE());case 255:return this.readUInt64LEBn();default:return new J(e)}}},F_=new J(2).pow(new J(63)),I_=new J(2).pow(new J(64));const L_=0n,R_=1n,z_=2n,B_=115792089237316195423570985008687907853269984665640564039457584007908834671663n,V_=115792089237316195423570985008687907852837564279074904382605163141518161494337n,H_=(1n<<256n)-1n;function U_(e){let t=e>>256n;return e=(e&H_)+(t<<32n)+t*977n,t=e>>256n,e=(e&H_)+(t<<32n)+t*977n,e>=115792089237316195423570985008687907853269984665640564039457584007908834671663n&&(e-=B_),e}const W_=e=>U_((e%B_+B_)%B_),G_=(e,t)=>e>=t?e-t:B_-(t-e),Y=(e,t)=>U_(e*t),K_=(e,t)=>U_(e+t),q_=e=>{let t=R_,n=L_,r=W_(e),i=B_;for(;r>R_;){let e=i/r;[t,n]=[n-t*e,t],[r,i]=[i-r*e,r]}return W_(t)},J_=e=>Y(e,e),Y_=(e,t)=>{let n=R_;e=W_(e);let r=t;for(;r>L_;)(r&1n)==1n&&(n=Y(n,e)),e=Y(e,e),r>>=R_;return n},X_=B_+1n>>2n,Z_=e=>{let t=Y_(e,X_);return Y(t,t)===W_(e)?t:null};var Q_=e=>J.isBN(e)?BigInt(`0x`+e.toString(16)):typeof e==`string`?BigInt(`0x`+e):Array.isArray(e)?BigInt(`0x`+b_(e)):BigInt(e);const $_=BigInt(`0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798`),ev=BigInt(`0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8`);var tv=new Map;const nv=e=>{let{X:t,Y:n,Z:r}=e;if(n===0n)return{X:L_,Y:R_,Z:L_};let i=Y(n,n),a=Y(4n,Y(t,i)),o=Y(3n,Y(t,t)),s=G_(Y(o,o),Y(z_,a)),c=G_(Y(o,G_(a,s)),Y(8n,Y(i,i))),l=Y(z_,Y(n,r));return{X:s,Y:c,Z:l}},rv=(e,t)=>{if(e.Z===0n)return t;if(t.Z===0n)return e;let n=Y(e.Z,e.Z),r=Y(t.Z,t.Z),i=Y(e.X,r),a=Y(t.X,n),o=Y(e.Y,Y(r,t.Z)),s=Y(t.Y,Y(n,e.Z)),c=G_(a,i),l=G_(s,o);if(c===0n)return l===0n?nv(e):{X:L_,Y:R_,Z:L_};let u=Y(c,c),d=Y(c,u),f=Y(i,u),p=G_(G_(Y(l,l),d),Y(z_,f)),m=G_(Y(l,G_(f,p)),Y(o,d)),h=Y(c,Y(e.Z,t.Z));return{X:p,Y:m,Z:h}},iv=e=>e.Z===0n?e:{X:e.X,Y:B_-e.Y,Z:e.Z},av=(e,t,n=5)=>{let r=`${n}:${t.x.toString(16)}:${t.y.toString(16)}`,i=tv.get(r),a;if(i===void 0){let e=1<<n-1;i=Array(e),a={X:t.x,Y:t.y,Z:R_},i[0]=a;let o=nv(a);for(let t=1;t<e;t++)i[t]=rv(i[t-1],o);tv.set(r,i)}else a=i[0];let o=[],s=1n<<BigInt(n),c=s>>1n,l=e;for(;l>0n;)if((l&1n)==0n)o.push(0),l>>=R_;else{let e=l&s-1n;e>c&&(e-=s),o.push(Number(e)),l-=e,l>>=R_}let u={X:L_,Y:R_,Z:L_};for(let e=o.length-1;e>=0;e--){u=nv(u);let t=o[e];if(t!==0){let e=Math.abs(t)>>1,n=t>0?i[e]:iv(i[e]);u=rv(u,n)}}return u},ov=e=>{let t=e%V_;return t<0n&&(t+=V_),t},sv=(e,t)=>ov(e*t),cv=e=>{let t=1n,n=0n,r=ov(e),i=V_;for(;r>1n;){let e=i/r;[t,n]=[n-t*e,t],[r,i]=[i-r*e,r]}return ov(t)};var lv=class e extends Vh{x;y;inf;static fromDER(t){if((t[0]===4||t[0]===6||t[0]===7)&&t.length-1==64){if(t[0]===6){if(t[t.length-1]%2!=0)throw Error(`Point string value is wrong length`)}else if(t[0]===7&&t[t.length-1]%2!=1)throw Error(`Point string value is wrong length`);return new e(t.slice(1,33),t.slice(33,65))}else if((t[0]===2||t[0]===3)&&t.length-1==32)return e.fromX(t.slice(1,33),t[0]===3);throw Error(`Unknown point format`)}static fromString(t){let n=x_(t,`hex`);return e.fromDER(n)}static fromX(t,n){let r=Q_(t);r=W_(r);let i=K_(Y(J_(r),r),7n),a=Z_(i);if(a===null)throw Error(`Invalid point`);let o=a;(o&1n)!=(n?1n:0n)&&(o=G_(B_,o));let s=new J(r.toString(16),16),c=new J(o.toString(16),16);return new e(s,c)}static fromJSON(t,n){typeof t==`string`&&(t=JSON.parse(t));let r=new e(t[0],t[1],n);if(typeof t[2]!=`object`)return r;let i=t=>new e(t[0],t[1],n),a=t[2];return r.precomputed={beta:null,doubles:typeof a.doubles==`object`&&a.doubles!==null?{step:a.doubles.step,points:[r].concat(a.doubles.points.map(i))}:void 0,naf:typeof a.naf==`object`&&a.naf!==null?{wnd:a.naf.wnd,points:[r].concat(a.naf.points.map(i))}:void 0},r}constructor(e,t,n=!0){super(`affine`),this.precomputed=null,e===null&&t===null?(this.x=null,this.y=null,this.inf=!0):(J.isBN(e)||(e=new J(e,16)),this.x=e,J.isBN(t)||(t=new J(t,16)),this.y=t,n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red===null&&(this.x=this.x.toRed(this.curve.red)),this.y.red===null&&(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}validate(){return this.curve.validate(this)}encode(e=!0,t){let n=this.curve.p.byteLength(),r=this.getX().toArray(`be`,n),i;return i=e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray(`be`,n)),t===`hex`?b_(i):i}toString(){return this.encode(!0,`hex`)}toJSON(){return this.precomputed==null?[this.x,this.y]:[this.x,this.y,typeof this.precomputed==`object`&&this.precomputed!==null?{doubles:this.precomputed.doubles==null?void 0:{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf==null?void 0:{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}:void 0]}inspect(){return this.isInfinity()?`<EC Point Infinity>`:`<EC Point x: `+(this.x?.fromRed()?.toString(16,2)??`undefined`)+` y: `+(this.y?.fromRed()?.toString(16,2)??`undefined`)+`>`}isInfinity(){return this.inf}add(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t)||this.x?.cmp(t.x??new J(0))===0)return new e(null,null);let n={X:BigInt(`0x`+this.x.fromRed().toString(16)),Y:BigInt(`0x`+this.y.fromRed().toString(16)),Z:R_},r={X:BigInt(`0x`+t.x.fromRed().toString(16)),Y:BigInt(`0x`+t.y.fromRed().toString(16)),Z:R_},i=rv(n,r);if(i.Z===0n)return new e(null,null);let a=q_(i.Z),o=Y(a,a),s=Y(i.X,o),c=Y(i.Y,Y(o,a));return new e(s.toString(16),c.toString(16))}dbl(){if(this.inf)return this;if(this.x===null||this.y===null)throw Error(`Point coordinates cannot be null`);let t=BigInt(`0x`+this.x.fromRed().toString(16)),n=BigInt(`0x`+this.y.fromRed().toString(16));if(n===0n)return new e(null,null);let r=nv({X:t,Y:n,Z:R_}),i=q_(r.Z),a=Y(i,i),o=Y(r.X,a),s=Y(r.Y,Y(a,i));return new e(o.toString(16),s.toString(16))}getX(){return(this.x??new J(0)).fromRed()}getY(){return(this.y??new J(0)).fromRed()}mul(t){if(J.isBN(t)||(t=new J(t,16)),t=t,this.inf)return this;let n=BigInt(`0x`+t.toString(16)),r=n<L_;if(r&&(n=-n),n=W_(n),n===0n)return new e(null,null);if(this.x===null||this.y===null)throw Error(`Point coordinates cannot be null`);let i,a;this===this.curve.g?(i=$_,a=ev):(i=BigInt(`0x`+this.x.fromRed().toString(16)),a=BigInt(`0x`+this.y.fromRed().toString(16)));let o=av(n,{x:i,y:a});if(o.Z===0n)return new e(null,null);let s=q_(o.Z),c=Y(s,s),l=Y(o.X,c),u=Y(o.Y,Y(c,s)),d=new J(l.toString(16),16),f=new J(u.toString(16),16),p=new e(d,f);return r?p.neg():p}mulAdd(e,t,n){let r=[this,t],i=[e,n];return this._endoWnafMulAdd(r,i)}jmulAdd(e,t,n){let r=[this,t],i=[e,n];return this._endoWnafMulAdd(r,i,!0)}eq(e){return this===e||this.inf===e.inf&&(this.inf||(this.x??new J(0)).cmp(e.x??new J(0))===0&&(this.y??new J(0)).cmp(e.y??new J(0))===0)}neg(t){if(this.inf)return this;let n=new e(this.x,(this.y??new J(0)).redNeg());if(t===!0&&this.precomputed!=null){let e=this.precomputed;n.precomputed={naf:e.naf==null?void 0:{wnd:e.naf.wnd,points:e.naf.points.map(e=>e.neg())},doubles:e.doubles==null?void 0:{step:e.doubles.step,points:e.doubles.points.map(e=>e.neg())},beta:void 0}}return n}dblp(e){let t=this;for(let n=0;n<e;n++)t=t.dbl();return t}toJ(){return this.inf?new Hh(null,null,null):new Hh(this.x,this.y,this.curve.one)}_getBeta(){if(typeof this.curve.endo!=`object`)return;let t=this.precomputed;if(typeof t==`object`&&t&&typeof t.beta==`object`&&t.beta!==null)return t.beta;let n=new e((this.x??new J(0)).redMul(this.curve.endo.beta),this.y);if(t!=null){let r=this.curve,i=t=>{if(t.x===null)throw Error(`p.x is null`);if(r.endo===void 0||r.endo===null)throw Error(`curve.endo is undefined`);return new e(t.x.redMul(r.endo.beta),t.y)};t.beta=n,n.precomputed={beta:null,naf:t.naf==null?void 0:{wnd:t.naf.wnd,points:t.naf.points.map(i)},doubles:t.doubles==null?void 0:{step:t.doubles.step,points:t.doubles.points.map(i)}}}return n}_fixedNafMul(e){if(typeof this.precomputed!=`object`||this.precomputed===null)throw Error(`_fixedNafMul requires precomputed values for the point`);let t=this._getDoubles(),n=this.curve.getNAF(e,1,this.curve._bitLength),r=(1<<t.step+1)-(t.step%2==0?2:1);r/=3;let i=[];for(let e=0;e<n.length;e+=t.step){let r=0;for(let i=e+t.step-1;i>=e;i--)r=(r<<1)+n[i];i.push(r)}let a=new Hh(null,null,null),o=new Hh(null,null,null);for(let e=r;e>0;e--){for(let n=0;n<i.length;n++){let r=i[n];r===e?o=o.mixedAdd(t.points[n]):r===-e&&(o=o.mixedAdd(t.points[n].neg()))}a=a.add(o)}return a.toP()}_wnafMulAdd(e,t,n,r,i){let a=this.curve._wnafT1.map(e=>e.toNumber()),o=this.curve._wnafT2.map(()=>[]),s=this.curve._wnafT3.map(()=>[]),c=0;for(let n=0;n<r;n++){let r=t[n]._getNAFPoints(e);a[n]=r.wnd,o[n]=r.points}for(let e=r-1;e>=1;e-=2){let r=e-1,i=e;if(a[r]!==1||a[i]!==1){s[r]=this.curve.getNAF(n[r],a[r],this.curve._bitLength),s[i]=this.curve.getNAF(n[i],a[i],this.curve._bitLength),c=Math.max(s[r].length,c),c=Math.max(s[i].length,c);continue}let l=[t[r],null,null,t[i]];(t[r].y??new J(0)).cmp(t[i].y??new J(0))===0?(l[1]=t[r].add(t[i]),l[2]=t[r].toJ().mixedAdd(t[i].neg())):(t[r].y??new J(0)).cmp((t[i].y??new J(0)).redNeg())===0?(l[1]=t[r].toJ().mixedAdd(t[i]),l[2]=t[r].add(t[i].neg())):(l[1]=t[r].toJ().mixedAdd(t[i]),l[2]=t[r].toJ().mixedAdd(t[i].neg()));let u=[-3,-1,-5,-7,0,7,5,1,3],d=this.curve.getJSF(n[r],n[i]);c=Math.max(d[0].length,c),s[r]=Array(c),s[i]=Array(c);for(let e=0;e<c;e++){let t=d[0][e]|0,n=d[1][e]|0;s[r][e]=u[(t+1)*3+(n+1)],s[i][e]=0,o[r]=l}}let l=new Hh(null,null,null),u=this.curve._wnafT4;for(let e=c;e>=0;e--){let t=0;for(;e>=0;){let n=!0;for(let t=0;t<r;t++)u[t]=new J(typeof s[t][e]==`number`?s[t][e]:0),u[t].isZero()||(n=!1);if(!n)break;t++,e--}if(e>=0&&t++,l=l.dblp(t),e<0)break;let n=new J(1),i=new J(2);for(let e=0;e<r;e++){let t=u[e],r;t.cmpn(0)!==0&&(r=t.isNeg()?o[e][t.neg().sub(n).div(i).toNumber()].neg():o[e][t.sub(n).div(i).toNumber()],l=r.type===`affine`?l.mixedAdd(r):l.add(r))}}for(let e=0;e<r;e++)o[e]=[];return i===!0?l:l.toP()}_endoWnafMulAdd(t,n,r){let i=Array(t.length*2),a=Array(t.length*2),o;for(o=0;o<t.length;o++){let r=this.curve._endoSplit(n[o]),s=t[o],c=s._getBeta()??new e(null,null);r.k1.negative!==0&&(r.k1.ineg(),s=s.neg(!0)),r.k2.negative!==0&&(r.k2.ineg(),c=c.neg(!0)),i[o*2]=s,i[o*2+1]=c,a[o*2]=r.k1,a[o*2+1]=r.k2}let s=this._wnafMulAdd(1,i,a,o*2,r);for(let e=0;e<o*2;e++)i[e]=null,a[e]=null;return s}_hasDoubles(e){if(this.precomputed==null)return!1;let t=this.precomputed.doubles;return typeof t==`object`?t.points.length>=Math.ceil((e.bitLength()+1)/t.step):!1}_getDoubles(e,t){if(typeof this.precomputed==`object`&&this.precomputed!==null&&typeof this.precomputed.doubles==`object`&&this.precomputed.doubles!==null)return this.precomputed.doubles;let n=[this],r=this;for(let i=0;i<(t??0);i+=e??1){for(let t=0;t<(e??1);t++)r=r.dbl();n.push(r)}return{step:e??1,points:n}}_getNAFPoints(e){if(typeof this.precomputed==`object`&&this.precomputed!==null&&typeof this.precomputed.naf==`object`&&this.precomputed.naf!==null)return this.precomputed.naf;let t=[this],n=(1<<e)-1,r=n===1?null:this.dbl();for(let e=1;e<n;e++)r!==null&&(t[e]=t[e-1].add(r));return{wnd:e,points:t}}},uv,dv=class e{p;red;redN;zero;one;two;g;n;a;b;tinv;zeroA;threeA;endo;_endoWnafT1;_endoWnafT2;_wnafT1;_wnafT2;_wnafT3;_wnafT4;_bitLength;static assert(e,t=`Elliptic curve assertion failed`){if(!e)throw Error(t)}getNAF(e,t,n){let r=Array(Math.max(e.bitLength(),n)+1);r.fill(0);let i=1<<t+1,a=e.clone();for(let e=0;e<r.length;e++){let t,n=a.andln(i-1);a.isOdd()?(t=n>(i>>1)-1?(i>>1)-n:n,a.isubn(t)):t=0,r[e]=t,a.iushrn(1)}return r}getJSF(e,t){let n=[[],[]];e=e.clone(),t=t.clone();let r=0,i=0;for(;e.cmpn(-r)>0||t.cmpn(-i)>0;){let a=e.andln(3)+r&3,o=t.andln(3)+i&3;a===3&&(a=-1),o===3&&(o=-1);let s;if(!(a&1))s=0;else{let t=e.andln(7)+r&7;s=(t===3||t===5)&&o===2?-a:a}n[0].push(s);let c;if(!(o&1))c=0;else{let e=t.andln(7)+i&7;c=(e===3||e===5)&&a===2?-o:o}n[1].push(c),2*r===s+1&&(r=1-r),2*i===c+1&&(i=1-i),e.iushrn(1),t.iushrn(1)}return n}static cachedProperty(e,t,n){let r=`_`+t;e.prototype[t]=function(){return this[r]===void 0?this[r]=n.call(this):this[r]}}static parseBytes(e){return typeof e==`string`?x_(e,`hex`):e}static intFromLE(e){return new J(e,`hex`,`le`)}constructor(){if(uv!==void 0)return uv;uv=this;let e={prime:`k256`,p:`ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f`,a:`0`,b:`7`,n:`ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141`,h:`1`,beta:`7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee`,lambda:`5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72`,basis:[{a:`3086d221a7d46bcde86c90e49284eb15`,b:`-e4437ed6010e88286f547fa90abfe4c3`},{a:`114ca50f7a8e2f3f657c1108d9d44cfd8`,b:`3086d221a7d46bcde86c90e49284eb15`}],gRed:!1,g:[`79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798`,`483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8`,{doubles:{step:4,points:[[`e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a`,`f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821`],[`8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508`,`11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf`],[`175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739`,`d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695`],[`363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640`,`4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9`],[`8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c`,`4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36`],[`723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda`,`96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f`],[`eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa`,`5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999`],[`100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0`,`cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09`],[`e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d`,`9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d`],[`feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d`,`e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088`],[`da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1`,`9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d`],[`53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0`,`5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8`],[`8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047`,`10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a`],[`385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862`,`283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453`],[`6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7`,`7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160`],[`3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd`,`56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0`],[`85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83`,`7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6`],[`948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a`,`53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589`],[`6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8`,`bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17`],[`e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d`,`4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda`],[`e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725`,`7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd`],[`213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754`,`4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2`],[`4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c`,`17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6`],[`fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6`,`6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f`],[`76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39`,`c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01`],[`c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891`,`893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3`],[`d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b`,`febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f`],[`b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03`,`2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7`],[`e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d`,`eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78`],[`a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070`,`7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1`],[`90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4`,`e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150`],[`8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da`,`662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82`],[`e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11`,`1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc`],[`8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e`,`efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b`],[`e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41`,`2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51`],[`b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef`,`67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45`],[`d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8`,`db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120`],[`324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d`,`648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84`],[`4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96`,`35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d`],[`9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd`,`ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d`],[`6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5`,`9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8`],[`a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266`,`40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8`],[`7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71`,`34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac`],[`928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac`,`c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f`],[`85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751`,`1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962`],[`ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e`,`493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907`],[`827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241`,`c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec`],[`eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3`,`be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d`],[`e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f`,`4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414`],[`1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19`,`aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd`],[`146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be`,`b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0`],[`fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9`,`6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811`],[`da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2`,`8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1`],[`a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13`,`7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c`],[`174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c`,`ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73`],[`959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba`,`2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd`],[`d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151`,`e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405`],[`64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073`,`d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589`],[`8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458`,`38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e`],[`13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b`,`69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27`],[`bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366`,`d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1`],[`8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa`,`40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482`],[`8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0`,`620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945`],[`dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787`,`7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573`],[`f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e`,`ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82`]]},naf:{wnd:7,points:[[`f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9`,`388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672`],[`2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4`,`d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6`],[`5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc`,`6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da`],[`acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe`,`cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37`],[`774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb`,`d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b`],[`f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8`,`ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81`],[`d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e`,`581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58`],[`defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34`,`4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77`],[`2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c`,`85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a`],[`352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5`,`321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c`],[`2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f`,`2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67`],[`9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714`,`73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402`],[`daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729`,`a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55`],[`c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db`,`2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482`],[`6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4`,`e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82`],[`1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5`,`b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396`],[`605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479`,`2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49`],[`62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d`,`80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf`],[`80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f`,`1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a`],[`7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb`,`d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7`],[`d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9`,`eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933`],[`49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963`,`758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a`],[`77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74`,`958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6`],[`f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530`,`e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37`],[`463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b`,`5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e`],[`f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247`,`cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6`],[`caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1`,`cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476`],[`2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120`,`4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40`],[`7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435`,`91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61`],[`754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18`,`673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683`],[`e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8`,`59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5`],[`186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb`,`3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b`],[`df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f`,`55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417`],[`5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143`,`efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868`],[`290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba`,`e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a`],[`af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45`,`f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6`],[`766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a`,`744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996`],[`59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e`,`c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e`],[`f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8`,`e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d`],[`7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c`,`30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2`],[`948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519`,`e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e`],[`7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab`,`100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437`],[`3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca`,`ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311`],[`d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf`,`8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4`],[`1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610`,`68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575`],[`733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4`,`f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d`],[`15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c`,`d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d`],[`a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940`,`edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629`],[`e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980`,`a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06`],[`311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3`,`66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374`],[`34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf`,`9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee`],[`f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63`,`4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1`],[`d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448`,`fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b`],[`32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf`,`5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661`],[`7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5`,`8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6`],[`ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6`,`8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e`],[`16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5`,`5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d`],[`eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99`,`f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc`],[`78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51`,`f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4`],[`494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5`,`42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c`],[`a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5`,`204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b`],[`c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997`,`4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913`],[`841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881`,`73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154`],[`5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5`,`39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865`],[`36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66`,`d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc`],[`336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726`,`ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224`],[`8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede`,`6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e`],[`1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94`,`60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6`],[`85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31`,`3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511`],[`29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51`,`b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b`],[`a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252`,`ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2`],[`4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5`,`cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c`],[`d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b`,`6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3`],[`ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4`,`322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d`],[`af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f`,`6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700`],[`e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889`,`2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4`],[`591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246`,`b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196`],[`11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984`,`998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4`],[`3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a`,`b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257`],[`cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030`,`bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13`],[`c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197`,`6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096`],[`c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593`,`c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38`],[`a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef`,`21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f`],[`347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38`,`60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448`],[`da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a`,`49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a`],[`c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111`,`5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4`],[`4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502`,`7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437`],[`3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea`,`be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7`],[`cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26`,`8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d`],[`b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986`,`39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a`],[`d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e`,`62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54`],[`48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4`,`25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77`],[`dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda`,`ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517`],[`6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859`,`cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10`],[`e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f`,`f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125`],[`eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c`,`6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e`],[`13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942`,`fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1`],[`ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a`,`1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2`],[`b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80`,`5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423`],[`ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d`,`438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8`],[`8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1`,`cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758`],[`52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63`,`c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375`],[`e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352`,`6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d`],[`7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193`,`ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec`],[`5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00`,`9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0`],[`32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58`,`ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c`],[`e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7`,`d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4`],[`8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8`,`c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f`],[`4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e`,`67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649`],[`3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d`,`cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826`],[`674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b`,`299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5`],[`d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f`,`f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87`],[`30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6`,`462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b`],[`be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297`,`62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc`],[`93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a`,`7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c`],[`b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c`,`ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f`],[`d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52`,`4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a`],[`d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb`,`bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46`],[`463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065`,`bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f`],[`7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917`,`603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03`],[`74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9`,`cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08`],[`30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3`,`553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8`],[`9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57`,`712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373`],[`176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66`,`ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3`],[`75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8`,`9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8`],[`809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721`,`9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1`],[`1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180`,`4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9`]]}}]};this.p=new J(e.p,16),this.red=new zh(e.prime),this.zero=new J(0).toRed(this.red),this.one=new J(1).toRed(this.red),this.two=new J(2).toRed(this.red),this.n=new J(e.n,16),this.g=lv.fromJSON(e.g,e.gRed),this._wnafT1=[,,,,],this._wnafT2=[,,,,],this._wnafT3=[,,,,],this._wnafT4=[,,,,],this._bitLength=this.n.bitLength(),this.redN=this.n.toRed(this.red),this.a=new J(e.a,16).toRed(this.red),this.b=new J(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=[,,,,],this._endoWnafT2=[,,,,]}_getEndomorphism(t){if(!this.zeroA||this.p.modrn(3)!==1)return;let n,r;if(t.beta!==void 0)n=new J(t.beta,16).toRed(this.red);else{let e=this._getEndoRoots(this.p);if(e===null)throw Error(`Failed to get endomorphism roots for beta.`);n=e[0].cmp(e[1])<0?e[0]:e[1],n=n.toRed(this.red)}if(t.lambda!==void 0)r=new J(t.lambda,16);else{let t=this._getEndoRoots(this.n);if(t===null)throw Error(`Failed to get endomorphism roots for lambda.`);if(this.g==null)throw Error(`Curve generator point (g) is not defined.`);let i=this.g.mul(t[0])?.x,a=this.g.x==null?void 0:this.g.x.redMul(n);if(i!=null&&a!=null&&i.cmp(a)===0)r=t[0];else{if(r=t[1],this.g==null)throw Error(`Curve generator point (g) is not defined.`);let i=this.g.mul(r)?.x,a=this.g.x==null?void 0:this.g.x.redMul(n);if(i==null||a==null)throw Error(`Lambda computation failed: g.mul(lambda).x or g.x.redMul(beta) is undefined.`);e.assert(i.cmp(a)===0,`Lambda selection does not match computed beta.`)}}let i;return i=typeof t.basis==`object`&&t.basis!==null?t.basis.map(function(e){return{a:new J(e.a,16),b:new J(e.b,16)}}):this._getEndoBasis(r),{beta:n,lambda:r,basis:i}}_getEndoRoots(e){let t=e===this.p?this.red:new Bh(e),n=new J(2).toRed(t).redInvm(),r=n.redNeg(),i=new J(3).toRed(t).redNeg().redSqrt().redMul(n),a=r.redAdd(i).fromRed(),o=r.redSub(i).fromRed();return[a,o]}_getEndoBasis(e){let t=this.n.ushrn(Math.floor(this.n.bitLength()/2)),n=e,r=this.n.clone(),i=new J(1),a=new J(0),o=new J(0),s=new J(1),c,l,u,d,f,p,m=new J(0),h=0,g=new J(0),_=new J(0);for(;n.cmpn(0)!==0;){let e=r.div(n);g=r.sub(e.mul(n)),_=o.sub(e.mul(i));let f=s.sub(e.mul(a));if(u===void 0&&g.cmp(t)<0)c=m.neg(),l=i,u=g.neg(),d=_;else if(u!==void 0&&++h===2)break;m=g,r=n,n=g,o=i,i=_,s=a,a=f}if(c===void 0||l===void 0||u===void 0||d===void 0)throw Error(`Failed to compute Endo Basis values`);f=g.neg(),p=_;let v=u.sqr().add(d.sqr());return f.sqr().add(p.sqr()).cmp(v)>=0&&(f=c,p=l),u.negative!==0&&(u=u.neg(),d=d.neg()),f.negative!==0&&(f=f.neg(),p=p.neg()),[{a:u,b:d},{a:f,b:p}]}_endoSplit(e){if(this.endo==null)throw Error(`Endomorphism is not defined.`);let t=this.endo.basis,n=t[0],r=t[1],i=r.b.mul(e).divRound(this.n),a=n.b.neg().mul(e).divRound(this.n),o=i.mul(n.a),s=a.mul(r.a),c=i.mul(n.b),l=a.mul(r.b),u=e.sub(o).sub(s),d=c.add(l).neg();return{k1:u,k2:d}}validate(e){if(e.inf)return!0;let t=e.x,n=e.y;if(t===null||n===null)throw Error(`Point coordinates cannot be null`);let r=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(r).redIAdd(this.b);return n.redSqr().redISub(i).cmpn(0)===0}},fv=class e{r;s;static fromDER(t,n){let r=(e,t)=>{let n=e[t.place++];if(n&128)throw Error(`Invalid DER entity length`);return n};class i{place;constructor(){this.place=0}}t=x_(t,n);let a=new i;if(t[a.place++]!==48)throw Error(`Signature DER must start with 0x30`);if(r(t,a)+a.place!==t.length||t[a.place++]!==2)throw Error(`Signature DER invalid`);let o=r(t,a),s=t.slice(a.place,o+a.place);if(a.place+=o,t[a.place++]!==2)throw Error(`Signature DER invalid`);let c=r(t,a);if(t.length!==c+a.place)throw Error(`Invalid R-length in signature DER`);let l=t.slice(a.place,c+a.place);if(s[0]===0)if(s[1]&128)s=s.slice(1);else throw Error(`Invalid R-value in signature DER`);if(l[0]===0)if(l[1]&128)l=l.slice(1);else throw Error(`Invalid S-value in signature DER`);return new e(new J(s),new J(l))}static fromCompact(t,n){if(t=x_(t,n),t.length!==65)throw Error(`Invalid Compact Signature`);let r=t[0];if(r<27||r>=35)throw Error(`Invalid Compact Byte`);return new e(new J(t.slice(1,33)),new J(t.slice(33,65)))}constructor(e,t){this.r=e,this.s=t}verify(e,t,n){let r=new J(Sg(e,n),16);return bv(r,this,t)}toString(e){return this.toDER(e)}toDER(e){let t=(e,t)=>{if(t<128)e.push(t);else throw Error(`len must be < 0x80`)},n=e=>{let t=0,n=e.length-1;for(;e[t]===0&&!(e[t+1]&128)&&t<n;)t++;return t===0?e:e.slice(t)},r=this.r.toArray(),i=this.s.toArray();for(r[0]&128&&(r=[0].concat(r)),i[0]&128&&(i=[0].concat(i)),r=n(r),i=n(i);i[0]===0&&!(i[1]&128);)i=i.slice(1);let a=[2];t(a,r.length),a=a.concat(r),a.push(2),t(a,i.length);let o=a.concat(i),s=[48];return t(s,o.length),s=s.concat(o),e===`hex`?b_(s):e===`base64`?D_(s):s}toCompact(e,t,n){if(e<0||e>3)throw Error(`Invalid recovery param`);if(typeof t!=`boolean`)throw Error(`Invalid compressed param`);let r=27+e;t&&(r+=4);let i=[r];return i=i.concat(this.r.toArray(`be`,32)),i=i.concat(this.s.toArray(`be`,32)),n===`hex`?b_(i):n===`base64`?D_(i):i}RecoverPublicKey(e,t){let n=this.r,r=this.s,i=(e&1)!=0,a=e>>1,o=new dv,s=o.n,c=o.g,l=a===0?n:n.add(s),u=lv.fromX(l,i);if(!u.mul(s).isInfinity())throw Error(`nR is not at infinity`);let d=t.neg().umod(s),f=n.invm(s),p=f.mul(r).umod(s),m=f.mul(d).umod(s),h=c.mul(m).add(u.mul(p)),g=new xv(h);return g.validate(),g}CalculateRecoveryFactor(e,t){for(let n=0;n<4;n++){let r;try{r=this.RecoverPublicKey(n,t)}catch{continue}if(e.eq(r))return n}throw Error(`Unable to find valid recovery factor`)}},pv=class{K;V;constructor(e,t){if(e=x_(e,`hex`),t=x_(t,`hex`),e.length<32)throw Error(`Not enough entropy. Minimum is 256 bits`);let n=e.concat(t);this.K=Array(32),this.V=Array(32);for(let e=0;e<32;e++)this.K[e]=0,this.V[e]=1;this.update(n)}hmac(){return new bg(this.K)}update(e){let t=this.hmac().update(this.V).update([0]);e!==void 0&&(t=t.update(e)),this.K=t.digest(),this.V=this.hmac().update(this.V).digest(),e!==void 0&&(this.K=this.hmac().update(this.V).update([1]).update(e).digest(),this.V=this.hmac().update(this.V).digest())}generate(e){let t=[];for(;t.length<e;)this.V=this.hmac().update(this.V).digest(),t=t.concat(this.V);let n=t.slice(0,e);return this.update(),b_(n)}};function mv(e,t,n=new dv){let r=e.byteLength()*8-n.n.bitLength();return r>0&&e.iushrn(r),t===null&&e.cmp(n.n)>=0?e.sub(n.n):e}var hv=new dv,gv=hv.n.byteLength(),_v=hv.n.subn(1),vv=V_>>1n;const yv=(e,t,n=!1,r)=>{e=mv(e);let i=BigInt(`0x`+e.toString(16)),a=BigInt(`0x`+t.toString(16)),o=t.toArray(`be`,gv),s=e.toArray(`be`,gv),c=new pv(o,s);for(let e=0;;e++){let t=typeof r==`function`?r(e):J.isBN(r)?r:new J(c.generate(gv),16);if(t==null)throw Error(`k is undefined`);if(t=mv(t,!0),t.cmpn(1)<=0||t.cmp(_v)>=0){if(J.isBN(r))throw Error(`Invalid fixed custom K value (must be >1 and <N1)`);continue}let o=BigInt(`0x`+t.toString(16)),s=av(o,{x:$_,y:ev});if(s.Z===0n){if(J.isBN(r))throw Error(`Invalid fixed custom K value (kG at infinity)`);continue}let l=q_(s.Z),u=Y(l,l),d=Y(s.X,u),f=ov(d);if(f===0n){if(J.isBN(r))throw Error(`Invalid fixed custom K value (r == 0)`);continue}let p=cv(o),m=sv(f,a),h=ov(i+m),g=sv(p,h);if(g===0n){if(J.isBN(r))throw Error(`Invalid fixed custom K value (s == 0)`);continue}n&&g>vv&&(g=V_-g);let _=new J(f.toString(16),16),v=new J(g.toString(16),16);return new fv(_,v)}},bv=(e,t,n)=>{let r=BigInt(`0x`+e.toString(16));if(n.x==null||n.y==null)throw Error(`Invalid public key: missing coordinates.`);let i={x:BigInt(`0x`+n.x.toString(16)),y:BigInt(`0x`+n.y.toString(16))},{r:a,s:o}={r:BigInt(`0x`+t.r.toString(16)),s:BigInt(`0x`+t.s.toString(16))},s=r;if(a<=0n||a>=115792089237316195423570985008687907852837564279074904382605163141518161494337n||o<=0n||o>=115792089237316195423570985008687907852837564279074904382605163141518161494337n)return!1;let c=cv(o);if(c===0n)return!1;let l=sv(s,c),u=sv(a,c),d=av(l,{x:$_,y:ev}),f=av(u,i),p=rv(d,f);if(p.Z===0n)return!1;let m=q_(p.Z),h=Y(m,m),g=Y(p.X,h);return ov(g)===a};var xv=class e extends lv{static fromPrivateKey(t){let n=new dv().g.mul(t);return new e(n.x,n.y)}static fromString(t){let n=lv.fromString(t);return new e(n.x,n.y)}static fromDER(t){let n=lv.fromDER(t);return new e(n.x,n.y)}constructor(e,t=null,n=!0){if(e instanceof lv)super(e.getX(),e.getY());else{if(t===null&&n&&typeof e==`string`&&(e.length===66||e.length===130))throw Error(`You are using the "new PublicKey()" constructor with a DER hex string. You need to use "PublicKey.fromString()" instead.`);super(e,t,n)}}deriveSharedSecret(e){if(!this.validate())throw Error(`Public key not valid for ECDH secret derivation`);return this.mul(e)}verify(e,t,n){let r=new J(Sg(e,n),16);return bv(r,t,this)}toDER(e){return e===`hex`?this.encode(!0,e):this.encode(!0)}toHash(e){let t=wg(this.encode(!0));return e===`hex`?b_(t):t}toAddress(e=[0]){if(typeof e==`string`)if(e===`testnet`||e===`test`)e=[111];else if(e===`mainnet`||e===`main`)e=[0];else throw Error(`Invalid prefix ${e}`);return j_(this.toHash(),e)}deriveChild(t,n,r,i){let a;if(typeof i==`function`){let e=i(t,this);e===void 0?(a=this.deriveSharedSecret(t),typeof r==`function`&&r(t,this,a)):a=e}else a=this.deriveSharedSecret(t);let o=x_(n,`utf8`),s=Tg(a.encode(!0),o),c=new dv().g.mul(new J(s)),l=this.add(c);return new e(l.x,l.y)}static fromMsgHashAndCompactSignature(e,t,n){let r=x_(t,n);if(r.length!==65)throw Error(`Invalid Compact Signature`);let i=r[0];if(i<27||i>=35)throw Error(`Invalid Compact Byte`);let a=r[0]-27;return a>3&&(a-=4),new fv(new J(r.slice(1,33)),new J(r.slice(33,65))).RecoverPublicKey(a,e)}},Sv=class{_rand;getRandomValues(e,t){let n=new Uint8Array(t);return e.crypto.getRandomValues(n),Array.from(n)}constructor(){let e=()=>{throw Error(`No secure random number generator is available in this environment.`)};if(this._rand=e,typeof globalThis<`u`&&typeof globalThis.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(globalThis,e);return}if(typeof process<`u`&&process.release?.name===`node`)try{let e=Ut();if(typeof e.randomBytes==`function`){this._rand=t=>Array.from(e.randomBytes(t));return}}catch{}if(typeof self<`u`&&typeof self.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(self,e);return}if(typeof window<`u`&&typeof window.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(window,e);return}if(typeof navigator<`u`&&navigator.product===`ReactNative`)try{if(u(`react-native-get-random-values`),typeof globalThis.crypto?.getRandomValues==`function`){this._rand=e=>this.getRandomValues(globalThis,e);return}}catch{this._rand=()=>{throw Error(`React Native detected but crypto is not available. Please install and import "react-native-get-random-values" at the top of your entry file:
npm install react-native-get-random-values
Then add: import "react-native-get-random-values" to your index.js/App.js`)};return}this._rand=e}generate(e){return this._rand(e)}},Cv=null,wv=e=>(Cv??=new Sv,Cv.generate(e)),Tv=class e{x;y;constructor(e,t){let n=new dv().p;this.x=e.umod(n),this.y=t.umod(n)}toString(){return A_(this.x.toArray())+`.`+A_(this.y.toArray())}static fromString(t){let[n,r]=t.split(`.`);return new e(new J(k_(n)),new J(k_(r)))}},Ev=class e{points;threshold;constructor(e,t){this.points=e,this.threshold=t??e.length}static fromPrivateKey(t,n){let r=new dv().p,i=[new Tv(new J(0),new J(t.toArray()))];for(let e=1;e<n;e++){let e=new J(wv(32)).umod(r),t=new J(wv(32)).umod(r);i.push(new Tv(e,t))}return new e(i)}valueAt(e){let t=new dv().p,n=new J(0);for(let r=0;r<this.threshold;r++){let i=this.points[r].y;for(let n=0;n<this.threshold;n++)if(r!==n){let a=this.points[n].x,o=this.points[r].x,s=e.sub(a).umod(t),c=o.sub(a).umod(t).invm(t),l=s.mul(c).umod(t);i=i.mul(l).umod(t)}n=n.add(i).umod(t)}return n}},Dv=class e{points;threshold;integrity;constructor(e,t,n){this.points=e,this.threshold=t,this.integrity=n}static fromBackupFormat(t){let n=0,r=``,i=t.map((e,t)=>{let i=e.split(`.`);if(i.length!==4)throw Error(`Invalid share format in share `+t.toString()+`. Expected format: "x.y.t.i" - received `+e);let[a,o,s,c]=i;if(s===void 0)throw Error(`Threshold not found in share `+t.toString());if(c===void 0)throw Error(`Integrity not found in share `+t.toString());let l=parseInt(s);if(t!==0&&n!==l)throw Error(`Threshold mismatch in share `+t.toString());if(t!==0&&r!==c)throw Error(`Integrity mismatch in share `+t.toString());return n=l,r=c,Tv.fromString([a,o].join(`.`))});return new e(i,n,r)}toBackupFormat(){return this.points.map(e=>e.toString()+`.`+this.threshold.toString()+`.`+this.integrity)}},Ov=class e extends J{static fromRandom(){return new e(wv(32))}static fromString(t,n=`hex`){return new e(super.fromString(t,n).toArray())}static fromHex(t){return new e(super.fromHex(t,`big`))}static fromWif(t,n=1){let r=M_(t,void 0,n);if(r.data.length!==33)throw Error(`Invalid WIF length`);if(r.data[32]!==1)throw Error(`Invalid WIF padding`);return new e(r.data.slice(0,32))}constructor(e=0,t=10,n=`be`,r=`apply`){if(e instanceof J?(super(),e.copy(this)):super(e,t,n),r!==`nocheck`){let e=this.checkInField();if(!e.inField){if(r===`error`)throw Error(`Input is out of field`);J.move(this,e.modN)}}}checkInField(){let e=new dv,t=this.mod(e.n);return{inField:this.cmp(t)===0,modN:t}}isValid(){return this.checkInField().inField}sign(e,t,n=!0,r){let i=new J(Sg(e,t),16);return yv(i,this,n,r)}verify(e,t,n){let r=new J(Sg(e,n),16);return bv(r,t,this.toPublicKey())}toPublicKey(){let e=new dv().g.mul(this);return new xv(e.x,e.y)}toWif(e=[128]){if(!this.isValid())throw Error(`Value is out of field`);return j_([...this.toArray(`be`,32),1],e)}toAddress(e=[0]){return this.toPublicKey().toAddress(e)}toHex(){return super.toHex(32)}toString(e=`hex`,t=64){return super.toString(e,t)}deriveSharedSecret(e){if(!e.validate())throw Error(`Public key not valid for ECDH secret derivation`);return e.mul(this)}deriveChild(t,n,r,i){let a;if(typeof i==`function`){let e=i(this,t);e===void 0?(a=this.deriveSharedSecret(t),typeof r==`function`&&r(this,t,a)):a=e}else a=this.deriveSharedSecret(t);let o=x_(n,`utf8`),s=Tg(a.encode(!0),o),c=new dv;return new e(this.add(new J(s)).mod(c.n).toArray())}toKeyShares(e,t){if(typeof e!=`number`||typeof t!=`number`)throw Error(`threshold and totalShares must be numbers`);if(e<2)throw Error(`threshold must be at least 2`);if(t<2)throw Error(`totalShares must be at least 2`);if(e>t)throw Error(`threshold should be less than or equal to totalShares`);let n=Ev.fromPrivateKey(this,e),r=[],i=new Set,a=new dv,o=wv(64);for(let e=0;e<t;e++){let t,s=0;do{let n=[e,s,...wv(32)],r=Eg(o,n);if(t=new J(r).umod(a.p),s++,s>5)throw Error(`Failed to generate unique x coordinate after 5 attempts`)}while(t.isZero()||i.has(t.toString()));i.add(t.toString());let c=n.valueAt(t);r.push(new Tv(t,c))}let s=this.toPublicKey().toHash(`hex`).slice(0,8);return new Dv(r,e,s)}toBackupShares(e,t){return this.toKeyShares(e,t).toBackupFormat()}static fromBackupShares(t){return e.fromKeyShares(Dv.fromBackupFormat(t))}static fromKeyShares(t){let{points:n,threshold:r,integrity:i}=t;if(r<2)throw Error(`threshold must be at least 2`);if(n.length<r)throw Error(`At least ${r} shares are required to reconstruct the private key`);for(let e=0;e<r;e++)for(let t=e+1;t<r;t++)if(n[e].x.eq(n[t].x))throw Error(`Duplicate share detected, each must be unique.`);let a=new Ev(n,r),o=new e(a.valueAt(new J(0)).toArray());if(o.toPublicKey().toHash(`hex`).slice(0,8)!==i)throw Error(`Integrity hash mismatch`);return o}},kv=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),Av=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]].map(e=>new Uint8Array(e)),jv=new Uint8Array(256),Mv=new Uint8Array(256);for(let e=0;e<256;e++){let t=(e<<1^(e&128?27:0))&255;jv[e]=t,Mv[e]=t^e}function Nv(e,t,n){for(let r=0;r<4;r++){let i=t[n+r];for(let t=0;t<4;t++)e[t][r]^=i[t]}}function Pv(e){for(let t=0;t<4;t++)for(let n=0;n<4;n++)e[t][n]=kv[e[t][n]]}function Fv(e){for(let t=0;t<4;t++)e[t]=kv[e[t]]}function Iv(e){let t=e[0];e[0]=e[1],e[1]=e[2],e[2]=e[3],e[3]=t}function Lv(e){let t=e[1][0];e[1][0]=e[1][1],e[1][1]=e[1][2],e[1][2]=e[1][3],e[1][3]=t,t=e[2][0];let n=e[2][1];e[2][0]=e[2][2],e[2][1]=e[2][3],e[2][2]=t,e[2][3]=n,t=e[3][3],e[3][3]=e[3][2],e[3][2]=e[3][1],e[3][1]=e[3][0],e[3][0]=t}function Rv(e){for(let t=0;t<4;t++){let n=e[0][t],r=e[1][t],i=e[2][t],a=e[3][t];e[0][t]=jv[n]^Mv[r]^i^a,e[1][t]=n^jv[r]^Mv[i]^a,e[2][t]=n^r^jv[i]^Mv[a],e[3][t]=Mv[n]^r^i^jv[a]}}function zv(e,t){let n=t.length/4,r=[];for(let e=0;e<t.length;e++)e%4==0&&r.push([]),r[e>>2].push(t[e]);for(let t=n;t<4*e;t++){r[t]=[];let e=r[t-1].slice();if(t%n===0){Iv(e),Fv(e);let r=Av[t/n];for(let t=0;t<4;t++)e[t]^=r[t]}else n>6&&t%n===4&&Fv(e);for(let i=0;i<4;i++)r[t][i]=r[t-n][i]^e[i]}return r}function Bv(e,t){let n,r,i,a,o=[[],[],[],[]],s=[],c=Array.from(t);if(c.length<=16){for(;c.length<16;)c.unshift(0);a=11}else if(c.length<=24){for(;c.length<24;)c.unshift(0);a=13}else if(t.length<=32){for(;c.length<32;)c.unshift(0);a=15}else throw Error(`Illegal key length: `+String(t.length));let l=zv(a,c);for(let t=0;t<4;t++)o[0][t]=e[t*4],o[1][t]=e[t*4+1],o[2][t]=e[t*4+2],o[3][t]=e[t*4+3];for(Nv(o,l,0),i=1;i<a;i++)Pv(o),Lv(o),i+1<a&&Rv(o),Nv(o,l,i*4);for(n=0;n<4;n++)for(r=0;r<4;r++)s.push(o[r][n]);return s}const Vv=function(e){return[(e&4278190080)>>>24,(e&16711680)>>16,(e&65280)>>8,e&255]};var Hv=function(e){return Array(e).fill(0)},Uv=[225].concat(Hv(15)),Wv=function(e,t){for(let n=0;n<e.length;n++)e[n]^=t[n]};const Gv=function(e){let t,n=0,r=0;for(t=0;t<e.length;t++)r=n,n=e[t]&1,e[t]=e[t]>>1,r!==0&&(e[t]=e[t]|128);return e},Kv=function(e,t){let n=t.slice(),r=Hv(16);for(let t=0;t<16;t++)for(let i=7;i>=0;i--)e[t]&1<<i&&Wv(r,n),n[15]&1?(Gv(n),Wv(n,Uv)):Gv(n);return r},qv=function(e){let t,n=e.slice();for(t=15;t!==11&&(n[t]=n[t]+1,n[t]===256);t--)n[t]=0;return n};function Jv(e,t){let n=Hv(16);for(let r=0;r<e.length;r+=16){let i=n.slice();for(let t=0;t<16;t++)i[t]^=e[r+t]??0;n=Kv(i,t)}return n}function Yv(e,t,n){if(e.length===0)return[];let r=Array(e.length),i=t,a=0,o=Math.ceil(e.length/16);for(let t=0;t<o;t++){let s=Bv(i,n),c=Math.min(16,e.length-a);for(let t=0;t<c;t++)r[a]=e[a]^s[t],a++;t+1<o&&(i=qv(i))}return r}function Xv(e,t,n,r){let i,a,o=Bv(Hv(16),r);i=[...n],n.length===12?i=i.concat(Hv(3)).concat([1]):(n.length%16!=0&&(i=i.concat(Hv(16-n.length%16))),i=i.concat(Hv(8)),i=Jv(i.concat(Hv(4)).concat(Vv(n.length*8)),o));let s=Yv(e,qv(i),r);return a=t.slice(),t.length===0?a=a.concat(Hv(16)):t.length%16!=0&&(a=a.concat(Hv(16-t.length%16))),a=a.concat(s),s.length===0?a=a.concat(Hv(16)):s.length%16!=0&&(a=a.concat(Hv(16-s.length%16))),a=a.concat(Hv(4)).concat(Vv(t.length*8)).concat(Hv(4)).concat(Vv(s.length*8)),{result:s,authenticationTag:Yv(Jv(a,o),i,r)}}function Zv(e,t,n,r,i){let a,o,s=Bv(Hv(16),i);a=[...n],n.length===12?a=a.concat(Hv(3)).concat([1]):(n.length%16!=0&&(a=a.concat(Hv(16-n.length%16))),a=a.concat(Hv(8)),a=Jv(a.concat(Hv(4)).concat(Vv(n.length*8)),s));let c=Yv(e,qv(a),i);return o=t.slice(),t.length===0?o=o.concat(Hv(16)):t.length%16!=0&&(o=o.concat(Hv(16-t.length%16))),o=o.concat(e),e.length===0?o=o.concat(Hv(16)):e.length%16!=0&&(o=o.concat(Hv(16-e.length%16))),o=o.concat(Hv(4)).concat(Vv(t.length*8)).concat(Hv(4)).concat(Vv(e.length*8)),Yv(Jv(o,s),a,i).join()===r.join()?c:null}var Qv=class e extends J{static fromRandom(){return new e(wv(32))}encrypt(e,t){let n=wv(32);e=x_(e,t);let{result:r,authenticationTag:i}=Xv(e,[],n,this.toArray(`be`,32));return E_([...n,...r,...i],t)}decrypt(e,t){e=x_(e,t);let n=e.slice(0,32),r=e.slice(32),i=r.slice(-16),a=r.slice(0,-16),o=Zv(a,[],n,i,this.toArray());if(o===null)throw Error(`Decryption failed!`);return E_(o,t)}},$v=class{curve;constructor(){this.curve=new dv}generateProof(e,t,n,r){let i=Ov.fromRandom(),a=i.toPublicKey(),o=n.mul(i),s=this.computeChallenge(t,n,r,o,a),c=i.add(s.mul(e)).umod(this.curve.n);return{R:a,SPrime:o,z:c}}verifyProof(e,t,n,r){let{R:i,SPrime:a,z:o}=r,s=this.computeChallenge(e,t,n,a,i),c=this.curve.g.mul(o),l=i.add(e.mul(s));if(!c.eq(l))return!1;let u=t.mul(o),d=a.add(n.mul(s));return!!u.eq(d)}computeChallenge(e,t,n,r,i){let a=[...e.encode(!0),...t.encode(!0),...n.encode(!0),...r.encode(!0),...i.encode(!0)],o=Sg(a);return new J(o).umod(this.curve.n)}},ey={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_SPLIT:127,OP_LEFT:128,OP_NUM2BIN:128,OP_RIGHT:129,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_NOP11:186,OP_NOP12:187,OP_NOP13:188,OP_NOP14:189,OP_NOP15:190,OP_NOP16:191,OP_NOP17:192,OP_NOP18:193,OP_NOP19:194,OP_NOP20:195,OP_NOP21:196,OP_NOP22:197,OP_NOP23:198,OP_NOP24:199,OP_NOP25:200,OP_NOP26:201,OP_NOP27:202,OP_NOP28:203,OP_NOP29:204,OP_NOP30:205,OP_NOP31:206,OP_NOP32:207,OP_NOP33:208,OP_NOP34:209,OP_NOP35:210,OP_NOP36:211,OP_NOP37:212,OP_NOP38:213,OP_NOP39:214,OP_NOP40:215,OP_NOP41:216,OP_NOP42:217,OP_NOP43:218,OP_NOP44:219,OP_NOP45:220,OP_NOP46:221,OP_NOP47:222,OP_NOP48:223,OP_NOP49:224,OP_NOP50:225,OP_NOP51:226,OP_NOP52:227,OP_NOP53:228,OP_NOP54:229,OP_NOP55:230,OP_NOP56:231,OP_NOP57:232,OP_NOP58:233,OP_NOP59:234,OP_NOP60:235,OP_NOP61:236,OP_NOP62:237,OP_NOP63:238,OP_NOP64:239,OP_NOP65:240,OP_NOP66:241,OP_NOP67:242,OP_NOP68:243,OP_NOP69:244,OP_NOP70:245,OP_NOP71:246,OP_NOP72:247,OP_NOP73:248,OP_NOP77:252,OP_SMALLDATA:249,OP_SMALLINTEGER:250,OP_PUBKEYS:251,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};for(let e in ey)ey[ey[e]]=e;Object.freeze(new J(-1).toScriptNum()),Object.freeze(Array.from({length:17},(e,t)=>Object.freeze(new J(t).toScriptNum())));var ty;(function(e){e[e.RAWTX=0]=`RAWTX`,e[e.RAWTX_AND_BUMP_INDEX=1]=`RAWTX_AND_BUMP_INDEX`,e[e.TXID_ONLY=2]=`TXID_ONLY`})(ty||={});function ny(e){this._tables[0][0][0]===0&&this._precompute();let t,n,r,i=this._tables[0][4],a=this._tables[1],o=e.length,s=1;if(o!==4&&o!==6&&o!==8)throw Error(`invalid aes key size`);this._key=[n=e.slice(0),r=[]];let c;for(c=o;c<4*o+28;c++)t=n[c-1],(c%o===0||o===8&&c%o===4)&&(t=i[t>>>24]<<24^i[t>>16&255]<<16^i[t>>8&255]<<8^i[t&255],c%o===0&&(t=t<<8^t>>>24^s<<24,s=s<<1^(s>>7)*283)),n[c]=n[c-o]^t;for(let e=0;c>0;e++,c--)t=n[e&3?c:c-4],c<=4||e<4?r[e]=t:r[e]=a[0][i[t>>>24]]^a[1][i[t>>16&255]]^a[2][i[t>>8&255]]^a[3][i[t&255]]}ny.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]],_precompute:function(){let e=this._tables[0],t=this._tables[1],n=e[4],r=t[4],i,a,o,s=new Uint8Array(256),c=new Uint8Array(256),l,u,d,f,p,m;for(i=0;i<256;i++)c[(s[i]=i<<1^(i>>7)*283)^i]=i;for(a=o=0;n[a]===0;a^=l===0?1:l,o=c[o]===0?1:c[o])for(f=o^o<<1^o<<2^o<<3^o<<4,f=f>>8^f&255^99,n[a]=f,r[f]=a,d=s[u=s[l=s[a]]],m=d*16843009^u*65537^l*257^a*16843008,p=s[f]*257^f*16843008,i=0;i<4;i++)e[i][a]=p=p<<24^p>>>8,t[i][f]=m=m<<24^m>>>8},_crypt:function(e,t){if(e.length!==4)throw Error(`invalid aes block size`);let n=this._key[t],r=e[0]^n[0],i=e[t===1?3:1]^n[1],a=e[2]^n[2],o=e[t===1?1:3]^n[3],s,c,l,u=n.length/4-2,d,f=4,p=new Uint32Array(4),m=this._tables[t],h=m[0],g=m[1],_=m[2],v=m[3],y=m[4];for(d=0;d<u;d++)s=h[r>>>24]^g[i>>16&255]^_[a>>8&255]^v[o&255]^n[f],c=h[i>>>24]^g[a>>16&255]^_[o>>8&255]^v[r&255]^n[f+1],l=h[a>>>24]^g[o>>16&255]^_[r>>8&255]^v[i&255]^n[f+2],o=h[o>>>24]^g[r>>16&255]^_[i>>8&255]^v[a&255]^n[f+3],f+=4,r=s,i=c,a=l;for(d=0;d<4;d++)p[t===1?3&-d:d]=y[r>>>24]<<24^y[i>>16&255]<<16^y[a>>8&255]<<8^y[o&255]^n[f++],s=r,r=i,i=a,a=o,o=s;return p}};var ry;(function(e){e[e.Silent=0]=`Silent`,e[e.App=1]=`App`,e[e.Counterparty=2]=`Counterparty`})(ry||={});var iy=class{cacheSharedSecret;retrieveCachedSharedSecret;rootKey;identityKey;anyone;constructor(e,t,n){this.cacheSharedSecret=t,this.retrieveCachedSharedSecret=n,this.anyone=new Ov(1).toPublicKey(),e===`anyone`?this.rootKey=new Ov(1):this.rootKey=e,this.identityKey=this.rootKey.toPublicKey().toString()}derivePublicKey(e,t,n,r=!1){return n=this.normalizeCounterparty(n),r?this.rootKey.deriveChild(n,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret).toPublicKey():n.deriveChild(this.rootKey,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}derivePrivateKey(e,t,n){return n=this.normalizeCounterparty(n),this.rootKey.deriveChild(n,this.computeInvoiceNumber(e,t),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}deriveSymmetricKey(e,t,n){n=n===`anyone`?this.anyone:this.normalizeCounterparty(n);let r=this.derivePublicKey(e,t,n),i=this.derivePrivateKey(e,t,n);return new Qv(i.deriveSharedSecret(r)?.x?.toArray()??[])}revealCounterpartySecret(e){if(e===`self`)throw Error(`Counterparty secrets cannot be revealed for counterparty=self.`);e=this.normalizeCounterparty(e);let t=this.rootKey.toPublicKey(),n=this.rootKey.deriveChild(t,`test`).toHex(),r=this.rootKey.deriveChild(e,`test`).toHex();if(n===r)throw Error(`Counterparty secrets cannot be revealed for counterparty=self.`);return this.rootKey.deriveSharedSecret(e).encode(!0)}revealSpecificSecret(e,t,n){e=this.normalizeCounterparty(e);let r=this.rootKey.deriveSharedSecret(e),i=x_(this.computeInvoiceNumber(t,n),`utf8`);return Tg(r.encode(!0),i)}normalizeCounterparty(e){if(e==null)throw Error(`counterparty must be self, anyone or a public key!`);return e===`self`?this.rootKey.toPublicKey():e===`anyone`?new Ov(1).toPublicKey():typeof e==`string`?xv.fromString(e):e}computeInvoiceNumber(e,t){let n=e[0];if(!Number.isInteger(n)||n<0||n>2)throw Error(`Protocol security level must be 0, 1, or 2`);let r=e[1].toLowerCase().trim();if(t.length>800)throw Error(`Key IDs must be 800 characters or less`);if(t.length<1)throw Error(`Key IDs must be 1 character or more`);if(r.length>400)if(r.startsWith(`specific linkage revelation `)){if(r.length>430)throw Error(`Specific linkage revelation protocol names must be 430 characters or less`)}else throw Error(`Protocol names must be 400 characters or less`);if(r.length<5)throw Error(`Protocol names must be 5 characters or more`);if(r.includes(`  `))throw Error(`Protocol names cannot contain multiple consecutive spaces ("  ")`);if(!/^[a-z0-9 ]+$/g.test(r))throw Error(`Protocol names can only contain letters, numbers and spaces`);if(r.endsWith(` protocol`))throw Error(`No need to end your protocol name with " protocol"`);return`${n}-${r}-${t}`}},ay=class{keyDeriver;cache;maxCacheSize;rootKey;identityKey;constructor(e,t){e===`anyone`?this.rootKey=new Ov(1):this.rootKey=e,this.keyDeriver=new iy(this.rootKey,(e,t,n)=>{this.cacheSet(`${e.toString()}-${t.toString()}`,n)},(e,t)=>this.cacheGet(`${e.toString()}-${t.toString()}`)),this.identityKey=this.rootKey.toPublicKey().toString(),this.cache=new Map;let n=t?.maxCacheSize;this.maxCacheSize=n!=null&&!isNaN(n)&&n>0?n:1e3}derivePublicKey(e,t,n,r=!1){let i=this.generateCacheKey(`derivePublicKey`,e,t,n,r);if(this.cache.has(i)){let e=this.cacheGet(i);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let a=this.keyDeriver.derivePublicKey(e,t,n,r);return this.cacheSet(i,a),a}}derivePrivateKey(e,t,n){let r=this.generateCacheKey(`derivePrivateKey`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.derivePrivateKey(e,t,n);return this.cacheSet(r,i),i}}deriveSymmetricKey(e,t,n){let r=this.generateCacheKey(`deriveSymmetricKey`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.deriveSymmetricKey(e,t,n);return this.cacheSet(r,i),i}}revealCounterpartySecret(e){let t=this.generateCacheKey(`revealCounterpartySecret`,e);if(this.cache.has(t)){let e=this.cacheGet(t);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let n=this.keyDeriver.revealCounterpartySecret(e);return this.cacheSet(t,n),n}}revealSpecificSecret(e,t,n){let r=this.generateCacheKey(`revealSpecificSecret`,e,t,n);if(this.cache.has(r)){let e=this.cacheGet(r);if(e===void 0)throw Error(`Cached value is undefined`);return e}else{let i=this.keyDeriver.revealSpecificSecret(e,t,n);return this.cacheSet(r,i),i}}generateCacheKey(e,...t){let n=t.map(e=>this.serializeArgument(e)).join(`|`);return`${e}|${n}`}serializeArgument(e){return e instanceof xv||e instanceof Ov?e.toString():Array.isArray(e)?e.map(e=>this.serializeArgument(e)).join(`,`):typeof e==`object`&&e?JSON.stringify(e):String(e)}cacheGet(e){let t=this.cache.get(e);return this.cache.delete(e),t!==void 0&&this.cache.set(e,t),t}cacheSet(e,t){if(this.cache.size>=this.maxCacheSize){let e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}},oy=class{keyDeriver;constructor(e){typeof e.identityKey!=`string`&&(e=new ay(e)),this.keyDeriver=e}async getPublicKey(e){if(e.identityKey){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}else{if(e.protocolID==null||e.keyID==null||e.keyID===``)throw Error(`protocolID and keyID are required if identityKey is false or undefined.`);return{publicKey:(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePublicKey(e.protocolID,e.keyID,e.counterparty??`self`,e.forSelf).toString()}}}async revealCounterpartyKeyLinkage(e){let{publicKey:t}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let n=this.keyDeriver.revealCounterpartySecret(e.counterparty),r=new $v().generateProof(this.keyDeriver.rootKey,this.keyDeriver.rootKey.toPublicKey(),xv.fromString(e.counterparty),lv.fromDER(n)),i=[...r.R.encode(!0),...r.SPrime.encode(!0),...r.z.toArray()],a=new Date().toISOString(),{ciphertext:o}=await this.encrypt({plaintext:n,protocolID:[2,`counterparty linkage revelation`],keyID:a,counterparty:e.verifier}),{ciphertext:s}=await this.encrypt({plaintext:i,protocolID:[2,`counterparty linkage revelation`],keyID:a,counterparty:e.verifier});return{prover:t,verifier:e.verifier,counterparty:e.counterparty,revelationTime:a,encryptedLinkage:o,encryptedLinkageProof:s}}async revealSpecificKeyLinkage(e){let{publicKey:t}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let n=this.keyDeriver.revealSpecificSecret(e.counterparty,e.protocolID,e.keyID),{ciphertext:r}=await this.encrypt({plaintext:n,protocolID:[2,`specific linkage revelation ${e.protocolID[0]} ${e.protocolID[1]}`],keyID:e.keyID,counterparty:e.verifier}),{ciphertext:i}=await this.encrypt({plaintext:[0],protocolID:[2,`specific linkage revelation ${e.protocolID[0]} ${e.protocolID[1]}`],keyID:e.keyID,counterparty:e.verifier});return{prover:t,verifier:e.verifier,counterparty:e.counterparty,protocolID:e.protocolID,keyID:e.keyID,encryptedLinkage:r,encryptedLinkageProof:i,proofType:0}}async encrypt(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{ciphertext:this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`).encrypt(e.plaintext)}}async decrypt(e,t){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);return{plaintext:this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`).decrypt(e.ciphertext)}}async createHmac(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let t=this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`);return{hmac:Tg(t.toArray(),e.data)}}async verifyHmac(e){if(this.keyDeriver==null)throw Error(`keyDeriver is undefined`);let t=this.keyDeriver.deriveSymmetricKey(e.protocolID,e.keyID,e.counterparty??`self`),n=Tg(t.toArray(),e.data).toString()===e.hmac.toString();if(!n){let e=Error(`HMAC is not valid`);throw e.code=`ERR_INVALID_HMAC`,e}return{valid:n}}async createSignature(e){if(e.hashToDirectlySign==null&&e.data==null)throw Error(`args.data or args.hashToDirectlySign must be valid`);let t=e.hashToDirectlySign??Sg(e.data??[]),n=(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePrivateKey(e.protocolID,e.keyID,e.counterparty??`anyone`);return{signature:yv(new J(t),n,!0).toDER()}}async verifySignature(e){if(e.hashToDirectlyVerify==null&&e.data==null)throw Error(`args.data or args.hashToDirectlyVerify must be valid`);let t=e.hashToDirectlyVerify??Sg(e.data??[]),n=(this.keyDeriver??(()=>{throw Error(`keyDeriver is undefined`)})()).derivePublicKey(e.protocolID,e.keyID,e.counterparty??`self`,e.forSelf),r=bv(new J(t),fv.fromDER(e.signature),n);if(!r){let e=Error(`Signature is not valid`);throw e.code=`ERR_INVALID_SIGNATURE`,e}return{valid:r}}},sy;(function(e){e[e.unknownError=1]=`unknownError`,e[e.unsupportedAction=2]=`unsupportedAction`,e[e.invalidHmac=3]=`invalidHmac`,e[e.invalidSignature=4]=`invalidSignature`,e[e.reviewActions=5]=`reviewActions`,e[e.invalidParameter=6]=`invalidParameter`,e[e.insufficientFunds=7]=`insufficientFunds`})(sy||={});var cy=class e{type;serialNumber;subject;certifier;revocationOutpoint;fields;signature;constructor(e,t,n,r,i,a,o){this.type=e,this.serialNumber=t,this.subject=n,this.certifier=r,this.revocationOutpoint=i,this.fields=a,this.signature=o}toBinary(e=!0){let t=new N_,n=x_(this.type,`base64`);t.write(n);let r=x_(this.serialNumber,`base64`);t.write(r);let i=x_(this.subject,`hex`);t.write(i);let a=x_(this.certifier,`hex`);t.write(a);let[o,s]=this.revocationOutpoint.split(`.`),c=x_(o,`hex`);t.write(c),t.writeVarIntNum(Number(s));let l=Object.keys(this.fields).sort();t.writeVarIntNum(l.length);for(let e of l){let n=this.fields[e],r=x_(e,`utf8`);t.writeVarIntNum(r.length),t.write(r);let i=x_(n,`utf8`);t.writeVarIntNum(i.length),t.write(i)}if(e&&(this.signature??``).length>0){let e=x_(this.signature,`hex`);t.write(e)}return t.toArray()}static fromBinary(t){let n=new P_(t),r=n.read(32),i=D_(r),a=n.read(32),o=D_(a),s=n.read(33),c=b_(s),l=n.read(33),u=b_(l),d=n.read(32),f=b_(d),p=n.readVarIntNum(),m=`${f}.${p}`,h=n.readVarIntNum(),g={};for(let e=0;e<h;e++){let e=n.readVarIntNum(),t=n.read(e),r=T_(t),i=n.readVarIntNum(),a=n.read(i);g[r]=T_(a)}let _;if(!n.eof()){let e=n.read();_=fv.fromDER(e).toString(`hex`)}return new e(i,o,c,u,m,g,_)}async verify(){let e=new oy(`anyone`),t=this.toBinary(!1),n=this.signature??``,{valid:r}=await e.verifySignature({signature:x_(n,`hex`),data:t,protocolID:[2,`certificate signature`],keyID:`${this.type} ${this.serialNumber}`,counterparty:this.certifier});return r}async sign(e){if(this.signature!=null&&this.signature.length>0)throw Error(`Certificate has already been signed! Signature present: ${this.signature}`);this.certifier=(await e.getPublicKey({identityKey:!0})).publicKey;let t=this.toBinary(!1),{signature:n}=await e.createSignature({data:t,protocolID:[2,`certificate signature`],keyID:`${this.type} ${this.serialNumber}`});this.signature=b_(n)}static getCertificateFieldEncryptionDetails(e,t){return{protocolID:[2,`certificate field encryption`],keyID:t?`${t} ${e}`:e}}},ly;(function(e){e[e.createAction=1]=`createAction`,e[e.signAction=2]=`signAction`,e[e.abortAction=3]=`abortAction`,e[e.listActions=4]=`listActions`,e[e.internalizeAction=5]=`internalizeAction`,e[e.listOutputs=6]=`listOutputs`,e[e.relinquishOutput=7]=`relinquishOutput`,e[e.getPublicKey=8]=`getPublicKey`,e[e.revealCounterpartyKeyLinkage=9]=`revealCounterpartyKeyLinkage`,e[e.revealSpecificKeyLinkage=10]=`revealSpecificKeyLinkage`,e[e.encrypt=11]=`encrypt`,e[e.decrypt=12]=`decrypt`,e[e.createHmac=13]=`createHmac`,e[e.verifyHmac=14]=`verifyHmac`,e[e.createSignature=15]=`createSignature`,e[e.verifySignature=16]=`verifySignature`,e[e.acquireCertificate=17]=`acquireCertificate`,e[e.listCertificates=18]=`listCertificates`,e[e.proveCertificate=19]=`proveCertificate`,e[e.relinquishCertificate=20]=`relinquishCertificate`,e[e.discoverByIdentityKey=21]=`discoverByIdentityKey`,e[e.discoverByAttributes=22]=`discoverByAttributes`,e[e.isAuthenticated=23]=`isAuthenticated`,e[e.waitForAuthentication=24]=`waitForAuthentication`,e[e.getHeight=25]=`getHeight`,e[e.getHeaderForHeight=26]=`getHeaderForHeight`,e[e.getNetwork=27]=`getNetwork`,e[e.getVersion=28]=`getVersion`})(ly||={});var uy=class e extends cy{keyring;decryptedFields;constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,r,i,a,s),this.keyring=o,this.decryptedFields=c}static fromCertificate(t,n){return new e(t.type,t.serialNumber,t.subject,t.certifier,t.revocationOutpoint,t.fields,n,t.signature)}async decryptFields(e,t,n,r){if(this.keyring==null||Object.keys(this.keyring).length===0)throw Error(`A keyring is required to decrypt certificate fields for the verifier.`);try{let i={};for(let a in this.keyring){let{plaintext:o}=await e.decrypt({ciphertext:x_(this.keyring[a],`base64`),...cy.getCertificateFieldEncryptionDetails(a,this.serialNumber),counterparty:this.subject,privileged:t,privilegedReason:n},r),s=new Qv(o).decrypt(x_(this.fields[a],`base64`));i[a]=T_(s)}return i}catch(e){throw Error(`Failed to decrypt selectively revealed certificate fields using keyring: ${String(e instanceof Error?e.message:e)}`)}}},dy=class{sessionNonceToSession;identityKeyToNonces;constructor(){this.sessionNonceToSession=new Map,this.identityKeyToNonces=new Map}addSession(e){if(typeof e.sessionNonce!=`string`)throw Error(`Invalid session: sessionNonce is required to add a session.`);if(this.sessionNonceToSession.set(e.sessionNonce,e),typeof e.peerIdentityKey==`string`){let t=this.identityKeyToNonces.get(e.peerIdentityKey);t??(t=new Set,this.identityKeyToNonces.set(e.peerIdentityKey,t)),t.add(e.sessionNonce)}}updateSession(e){this.removeSession(e),this.addSession(e)}getSession(e){let t=this.sessionNonceToSession.get(e);if(t!=null)return t;let n=this.identityKeyToNonces.get(e);if(n==null||n.size===0)return;let r;for(let e of n){let t=this.sessionNonceToSession.get(e);t!=null&&(r==null||(t.lastUpdate??0)>(r.lastUpdate??0))&&(r=t)}return r}removeSession(e){if(typeof e.sessionNonce==`string`&&this.sessionNonceToSession.delete(e.sessionNonce),typeof e.peerIdentityKey==`string`){let t=this.identityKeyToNonces.get(e.peerIdentityKey);t!=null&&(t.delete(e.sessionNonce??``),t.size===0&&this.identityKeyToNonces.delete(e.peerIdentityKey))}}hasSession(e){if(this.sessionNonceToSession.has(e))return!0;let t=this.identityKeyToNonces.get(e);return t!=null&&t.size>0}};async function fy(e,t,n=`self`,r){let i=x_(e,`base64`),a=i.slice(0,16),o=i.slice(16),{valid:s}=await t.verifyHmac({data:a,hmac:o,protocolID:[2,`server hmac`],keyID:T_(a),counterparty:n},r);return s}async function py(e,t=`self`,n){let r=wv(16),{hmac:i}=await e.createHmac({protocolID:[2,`server hmac`],keyID:T_(r),data:r,counterparty:t},n),a=[...r,...i];return D_(a)}const my=async(e,t,n,r)=>{let i=await e.listCertificates({certifiers:t.certifiers,types:Object.keys(t.types)},r);return await Promise.all(i.certificates.map(async i=>{let{keyringForVerifier:a}=await e.proveCertificate({certificate:i,fieldsToReveal:t.types[i.type],verifier:n},r);return new uy(i.type,i.serialNumber,i.subject,i.certifier,i.revocationOutpoint,i.fields,a,i.signature)}))},hy=async(e,t,n,r)=>{if(t.certificates==null||t.certificates.length===0)throw Error(`No certificates were provided in the AuthMessage.`);await Promise.all(t.certificates.map(async i=>{if(i.subject!==t.identityKey)throw Error(`The subject of one of your certificates ("${i.subject}") is not the same as the request sender ("${t.identityKey}").`);let a=new uy(i.type,i.serialNumber,i.subject,i.certifier,i.revocationOutpoint,i.fields,i.keyring,i.signature);if(!await a.verify())throw Error(`The signature for the certificate with serial number ${a.serialNumber} is invalid!`);if(n!=null){let{certifiers:e,types:t}=n;if(!e.includes(a.certifier))throw Error(`Certificate with serial number ${a.serialNumber} has an unrequested certifier: ${a.certifier}`);if(t[a.type]==null)throw Error(`Certificate with type ${a.type} was not requested`)}await a.decryptFields(e,void 0,void 0,r)}))};var gy=`0.1`,_y=class{sessionManager;transport;wallet;certificatesToRequest;onGeneralMessageReceivedCallbacks=new Map;onCertificatesReceivedCallbacks=new Map;onCertificateRequestReceivedCallbacks=new Map;onInitialResponseReceivedCallbacks=new Map;callbackIdCounter=0;autoPersistLastSession=!0;lastInteractedWithPeer;originator;constructor(e,t,n,r,i,a){this.wallet=e,this.originator=a,this.transport=t,this.certificatesToRequest=n??{certifiers:[],types:{}},this.transport.onData(this.handleIncomingMessage.bind(this)).catch(e=>{throw e}),this.sessionManager=r??new dy,i===!1?this.autoPersistLastSession=!1:this.autoPersistLastSession=!0}async toPeer(e,t,n){this.autoPersistLastSession&&typeof this.lastInteractedWithPeer==`string`&&typeof t!=`string`&&(t=this.lastInteractedWithPeer);let r=await this.getAuthenticatedSession(t,n),i=D_(wv(32)),{signature:a}=await this.wallet.createSignature({data:e,protocolID:[2,`auth message signature`],keyID:`${i} ${r.peerNonce??``}`,counterparty:r.peerIdentityKey},this.originator),o={version:gy,messageType:`general`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,nonce:i,yourNonce:r.peerNonce,payload:e,signature:a};r.lastUpdate=Date.now(),this.sessionManager.updateSession(r);try{await this.transport.send(o)}catch(e){this.propagateTransportError(r.peerIdentityKey,e)}}async requestCertificates(e,t,n=1e4){this.autoPersistLastSession&&typeof this.lastInteractedWithPeer==`string`&&typeof t!=`string`&&(t=this.lastInteractedWithPeer);let r=await this.getAuthenticatedSession(t,n),i=D_(wv(32)),{signature:a}=await this.wallet.createSignature({data:x_(JSON.stringify(e),`utf8`),protocolID:[2,`auth message signature`],keyID:`${i} ${r.peerNonce??``}`,counterparty:r.peerIdentityKey},this.originator),o={version:gy,messageType:`certificateRequest`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,nonce:i,initialNonce:r.sessionNonce,yourNonce:r.peerNonce,requestedCertificates:e,signature:a};r.lastUpdate=Date.now(),this.sessionManager.updateSession(r);try{await this.transport.send(o)}catch(e){this.propagateTransportError(r.peerIdentityKey,e)}}async getAuthenticatedSession(e,t){if(this.transport===void 0)throw Error(`Peer transport is not connected!`);let n;if(typeof e==`string`&&(n=this.sessionManager.getSession(e)),n==null||!n.isAuthenticated){let r=await this.initiateHandshake(e,t);if(n=this.sessionManager.getSession(r),n==null||!n.isAuthenticated)throw Error(`Unable to establish mutual authentication with peer!`)}return n}listenForGeneralMessages(e){let t=this.callbackIdCounter++;return this.onGeneralMessageReceivedCallbacks.set(t,e),t}stopListeningForGeneralMessages(e){this.onGeneralMessageReceivedCallbacks.delete(e)}listenForCertificatesReceived(e){let t=this.callbackIdCounter++;return this.onCertificatesReceivedCallbacks.set(t,e),t}stopListeningForCertificatesReceived(e){this.onCertificatesReceivedCallbacks.delete(e)}listenForCertificatesRequested(e){let t=this.callbackIdCounter++;return this.onCertificateRequestReceivedCallbacks.set(t,e),t}stopListeningForCertificatesRequested(e){this.onCertificateRequestReceivedCallbacks.delete(e)}async initiateHandshake(e,t=1e4){let n=await py(this.wallet,void 0,this.originator),r=Date.now();this.sessionManager.addSession({isAuthenticated:!1,sessionNonce:n,peerIdentityKey:e,lastUpdate:r});let i={version:gy,messageType:`initialRequest`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,initialNonce:n,requestedCertificates:this.certificatesToRequest};return await this.transport.send(i),await this.waitForInitialResponse(n,t)}async waitForInitialResponse(e,t=1e4){return await new Promise((n,r)=>{let i=this.listenForInitialResponse(e,e=>{clearTimeout(a),this.stopListeningForInitialResponses(i),n(e)}),a=setTimeout(()=>{this.stopListeningForInitialResponses(i),r(Error(`Initial response timed out.`))},t)})}listenForInitialResponse(e,t){let n=this.callbackIdCounter++;return this.onInitialResponseReceivedCallbacks.set(n,{callback:t,sessionNonce:e}),n}stopListeningForInitialResponses(e){this.onInitialResponseReceivedCallbacks.delete(e)}propagateTransportError(e,t){if(t instanceof Error){if(e!=null){let n=t.details;typeof n==`object`&&n?n.peerIdentityKey??=e:t.details={peerIdentityKey:e}}throw t}let n=`Failed to send message to peer ${e??`unknown`}: ${String(t)}`;throw Error(n)}async handleIncomingMessage(e){if(typeof e.version!=`string`||e.version!==gy)throw Error(`Invalid or unsupported message auth version! Received: ${e.version}, expected: ${gy}`);switch(e.messageType){case`initialRequest`:await this.processInitialRequest(e);break;case`initialResponse`:await this.processInitialResponse(e);break;case`certificateRequest`:await this.processCertificateRequest(e);break;case`certificateResponse`:await this.processCertificateResponse(e);break;case`general`:await this.processGeneralMessage(e);break;default:throw Error(`Unknown message type of ${String(e.messageType)} from ${String(e.identityKey)}`)}}async processInitialRequest(e){if(typeof e.identityKey!=`string`||typeof e.initialNonce!=`string`||e.initialNonce===``)throw Error(`Missing required fields in initialRequest message.`);let t=await py(this.wallet,void 0,this.originator),n=Date.now();this.sessionManager.addSession({isAuthenticated:!0,sessionNonce:t,peerNonce:e.initialNonce,peerIdentityKey:e.identityKey,lastUpdate:n});let r;e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0&&(this.onCertificateRequestReceivedCallbacks.size>0?this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)}):r=await my(this.wallet,e.requestedCertificates,e.identityKey,this.originator));let{signature:i}=await this.wallet.createSignature({data:x_(e.initialNonce+t,`base64`),protocolID:[2,`auth message signature`],keyID:`${e.initialNonce} ${t}`,counterparty:e.identityKey},this.originator),a={version:gy,messageType:`initialResponse`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,initialNonce:t,yourNonce:e.initialNonce,certificates:r,requestedCertificates:this.certificatesToRequest,signature:i};this.lastInteractedWithPeer===void 0&&(this.lastInteractedWithPeer=e.identityKey),await this.transport.send(a)}async processInitialResponse(e){if(!await fy(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Initial response nonce verification failed from peer: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Peer session not found for peer: ${e.identityKey}`);let n=x_((t.sessionNonce??``)+(e.initialNonce??``),`base64`),{valid:r}=await this.wallet.verifySignature({data:n,signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${t.sessionNonce??``} ${e.initialNonce??``}`,counterparty:e.identityKey},this.originator);if(!r)throw Error(`Unable to verify initial response signature for peer: ${e.identityKey}`);if(t.peerNonce=e.initialNonce,t.peerIdentityKey=e.identityKey,t.isAuthenticated=!0,t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),this.certificatesToRequest?.certifiers?.length>0&&e.certificates?.length>0&&(await hy(this.wallet,e,this.certificatesToRequest,this.originator),this.onCertificatesReceivedCallbacks.forEach(t=>t(e.identityKey,e.certificates))),this.lastInteractedWithPeer=e.identityKey,this.onInitialResponseReceivedCallbacks.forEach(e=>{e.sessionNonce===t.sessionNonce&&e.callback(t.sessionNonce)}),e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)});else{let t=await my(this.wallet,e.requestedCertificates,e.identityKey,this.originator);await this.sendCertificateResponse(e.identityKey,t)}}async processCertificateRequest(e){if(!await fy(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Unable to verify nonce for certificate request message from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:x_(JSON.stringify(e.requestedCertificates),`utf8`),signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:t.peerIdentityKey},this.originator);if(!n)throw Error(`Invalid signature in certificate request message from ${t.peerIdentityKey}`);if(t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),e.requestedCertificates!=null&&Array.isArray(e.requestedCertificates.certifiers)&&e.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(t=>{t(e.identityKey,e.requestedCertificates)});else{let t=await my(this.wallet,e.requestedCertificates,e.identityKey,this.originator);await this.sendCertificateResponse(e.identityKey,t)}}async sendCertificateResponse(e,t){let n=await this.getAuthenticatedSession(e),r=D_(wv(32)),{signature:i}=await this.wallet.createSignature({data:x_(JSON.stringify(t),`utf8`),protocolID:[2,`auth message signature`],keyID:`${r} ${n.peerNonce??``}`,counterparty:n.peerIdentityKey},this.originator),a={version:gy,messageType:`certificateResponse`,identityKey:(await this.wallet.getPublicKey({identityKey:!0},this.originator)).publicKey,nonce:r,initialNonce:n.sessionNonce,yourNonce:n.peerNonce,certificates:t,signature:i};n.lastUpdate=Date.now(),this.sessionManager.updateSession(n);try{await this.transport.send(a)}catch(e){this.propagateTransportError(n.peerIdentityKey,e)}}async processCertificateResponse(e){if(!await fy(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Unable to verify nonce for certificate response from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:x_(JSON.stringify(e.certificates),`utf8`),signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:e.identityKey},this.originator);if(!n)throw Error(`Unable to verify certificate response signature for peer: ${e.identityKey}`);await hy(this.wallet,e,e.requestedCertificates,this.originator),this.onCertificatesReceivedCallbacks.forEach(t=>{t(e.identityKey,e.certificates??[])}),t.lastUpdate=Date.now(),this.sessionManager.updateSession(t)}async processGeneralMessage(e){if(!await fy(e.yourNonce,this.wallet,void 0,this.originator))throw Error(`Unable to verify nonce for general message from: ${e.identityKey}`);let t=this.sessionManager.getSession(e.yourNonce);if(t==null)throw Error(`Session not found for nonce: ${e.yourNonce}`);let{valid:n}=await this.wallet.verifySignature({data:e.payload,signature:e.signature,protocolID:[2,`auth message signature`],keyID:`${e.nonce??``} ${t.sessionNonce??``}`,counterparty:t.peerIdentityKey},this.originator);if(!n)throw Error(`Invalid signature in generalMessage from ${t.peerIdentityKey}`);t.lastUpdate=Date.now(),this.sessionManager.updateSession(t),this.lastInteractedWithPeer=e.identityKey,this.onGeneralMessageReceivedCallbacks.forEach(t=>{t(e.identityKey,e.payload??[])})}};typeof globalThis<`u`&&typeof globalThis.fetch==`function`?globalThis.fetch.bind(globalThis):fetch,typeof globalThis<`u`&&typeof globalThis.fetch==`function`?globalThis.fetch.bind(globalThis):fetch;var vy=class{socket;onDataCallback;constructor(e){this.socket=e,this.socket.on(`authMessage`,async e=>{this.onDataCallback&&await this.onDataCallback(e)})}async send(e){this.socket.emit(`authMessage`,e)}async onData(e){this.onDataCallback=e}},yy=class{ioSocket;peer;connected=!1;id=``;serverIdentityKey;eventCallbacks=new Map;constructor(e,t){this.ioSocket=e,this.peer=t,this.ioSocket.on(`connect`,()=>{this.connected=!0,this.id=this.ioSocket.id||``,this.fireEventCallbacks(`connect`)}),this.ioSocket.on(`disconnect`,e=>{this.connected=!1,this.fireEventCallbacks(`disconnect`,e)}),this.peer.listenForGeneralMessages((e,t)=>{this.serverIdentityKey=e;let{eventName:n,data:r}=this.decodeEventPayload(t);this.fireEventCallbacks(n,r)})}on(e,t){let n=this.eventCallbacks.get(e);return n||(n=[],this.eventCallbacks.set(e,n)),n.push(t),this}emit(e,t){let n=this.encodeEventPayload(e,t);return this.peer.toPeer(n,this.serverIdentityKey).catch(t=>{console.error(`BRC103IoClientSocket emit error for event "${e}":`,t)}),this}disconnect(){this.serverIdentityKey=void 0,this.ioSocket.disconnect()}fireEventCallbacks(e,t){let n=this.eventCallbacks.get(e);if(n)for(let e of n)e(t)}encodeEventPayload(e,t){let n={eventName:e,data:t};return x_(JSON.stringify(n),`utf8`)}decodeEventPayload(e){try{let t=T_(e);return JSON.parse(t)}catch{return{eventName:`_unknown`,data:void 0}}}};function by(e,t){let n=Ih(e,t.managerOptions),r=new vy(n),i=new _y(t.wallet,r,t.requestedCertificates,t.sessionManager,void 0,t.originator);return new yy(n,i)}var xy=!1;function Sy(){xy=!0}function X(...e){xy&&console.log(...e)}function Cy(...e){xy&&console.warn(...e)}function wy(...e){console.error(...e)}var Ty=`https://messagebox.babbage.systems`,Ey=`https://staging-messagebox.babbage.systems`,Dy=class e{host;authFetch;walletClient;socket;myIdentityKey;joinedRooms=new Set;lookupResolver;networkPreset;initialized=!1;originator;constructor(e={}){let{host:t,walletClient:n,enableLogging:r=!1,networkPreset:i=`mainnet`,originator:a=void 0}=e,o=this.networkPreset===`testnet`?Ey:Ty;this.host=t?.trim()??o,this.originator=a,this.walletClient=n??new Ap(`auto`,a),this.authFetch=new Hp(this.walletClient,void 0,void 0,a),this.networkPreset=i,this.lookupResolver=new Yp({networkPreset:i}),r&&Sy()}async init(e=this.host){let t=e?.trim();if(t===``)throw Error(`Cannot anoint host: No valid host provided`);if(t!==this.host&&(this.initialized=!1,this.host=t),this.initialized)return;let n=await this.getIdentityKey(),[r]=await this.queryAdvertisements(n,t);if(r==null||r?.host?.trim()===``||r?.host!==t){X(`[MB CLIENT] Anointing host:`,t);try{let{txid:e}=await this.anointHost(t);if(e==null||e.trim()===``)throw Error(`Failed to anoint host: No transaction ID returned`)}catch(e){X(`[MB CLIENT] Failed to anoint host, continuing with default functionality:`,e)}}this.initialized=!0}async assertInitialized(){(!this.initialized||this.host==null||this.host.trim()===``)&&await this.init()}getJoinedRooms(){return this.joinedRooms}async getIdentityKey(){if(this.myIdentityKey!=null&&this.myIdentityKey.trim()!==``)return this.myIdentityKey;X(`[MB CLIENT] Fetching identity key...`);try{return this.myIdentityKey=(await this.walletClient.getPublicKey({identityKey:!0},this.originator)).publicKey,X(`[MB CLIENT] Identity key fetched: ${this.myIdentityKey}`),this.myIdentityKey}catch(e){throw wy(`[MB CLIENT ERROR] Failed to fetch identity key:`,e),Error(`Identity key retrieval failed`)}}get testSocket(){return this.socket}async initializeConnection(e){if(X(`[MB CLIENT] initializeConnection() STARTED`),(this.myIdentityKey==null||this.myIdentityKey.trim()===``)&&await this.getIdentityKey(),this.myIdentityKey==null||this.myIdentityKey.trim()===``)throw wy(`[MB CLIENT ERROR] Identity key is still missing after retrieval!`),Error(`Identity key is missing`);if(X(`[MB CLIENT] Setting up WebSocket connection...`),this.socket==null){let t=e??this.host;if(typeof t!=`string`||t.trim()===``)throw Error(`Cannot initialize WebSocket: No valid host provided`);this.socket=by(t,{wallet:this.walletClient,originator:this.originator});let n=!1,r=!1;this.socket.on(`connect`,()=>{X(`[MB CLIENT] Connected to WebSocket.`),n||(X(`[MB CLIENT] Sending authentication data:`,this.myIdentityKey),this.myIdentityKey==null||this.myIdentityKey.trim()===``?wy(`[MB CLIENT ERROR] Cannot send authentication: Identity key is missing!`):(this.socket?.emit(`authenticated`,{identityKey:this.myIdentityKey}),n=!0))}),this.socket.on(`authenticationSuccess`,e=>{X(`[MB CLIENT] WebSocket authentication successful: ${JSON.stringify(e)}`),r=!0}),this.socket.on(`authenticationFailed`,e=>{wy(`[MB CLIENT ERROR] WebSocket authentication failed: ${JSON.stringify(e)}`),r=!1}),this.socket.on(`disconnect`,()=>{X(`[MB CLIENT] Disconnected from MessageBox server`),this.socket=void 0,n=!1,r=!1}),this.socket.on(`error`,e=>{wy(`[MB CLIENT ERROR] WebSocket error:`,e)}),await new Promise((e,t)=>{setTimeout(()=>{r?(X(`[MB CLIENT] WebSocket fully authenticated and ready!`),e()):t(Error(`[MB CLIENT ERROR] WebSocket authentication timed out!`))},5e3)})}}async resolveHostForRecipient(e){let t=await this.queryAdvertisements(e,void 0);return t.length===0?(Cy(`[MB CLIENT] No advertisements for ${e}, using default host ${this.host}`),this.host):t[0].host}async queryAdvertisements(e,t){let n=[];try{let r={identityKey:e??await this.getIdentityKey()};t!=null&&t.trim()!==``&&(r.host=t);let i=await this.lookupResolver.query({service:`ls_messagebox`,query:r});if(i.type!==`output-list`)throw Error(`Unexpected result type: ${String(i.type)}`);for(let e of i.outputs)try{let t=pf.fromBEEF(e.beef),r=t.outputs[e.outputIndex].lockingScript,[,i]=qd.decode(r).fields;if(i==null||i.length===0)throw Error(`Empty host field`);n.push({host:W(i),txid:t.id(`hex`),outputIndex:e.outputIndex,lockingScript:r,beef:e.beef})}catch{}}catch(e){wy(`[MB CLIENT ERROR] _queryAdvertisements failed:`,e)}return n}async joinRoom(e,t){if(X(`[MB CLIENT] Attempting to join WebSocket room: ${e}`),this.socket??(X(`[MB CLIENT] No WebSocket connection. Initializing...`),await this.initializeConnection(t)),this.myIdentityKey==null||this.myIdentityKey.trim()===``)throw Error(`[MB CLIENT ERROR] Identity key is not defined`);let n=`${this.myIdentityKey??``}-${e}`;if(this.joinedRooms.has(n)){X(`[MB CLIENT] Already joined WebSocket room: ${n}`);return}try{X(`[MB CLIENT] Joining WebSocket room: ${n}`),await this.socket?.emit(`joinRoom`,n),this.joinedRooms.add(n),X(`[MB CLIENT] Successfully joined room: ${n}`)}catch(e){wy(`[MB CLIENT ERROR] Failed to join WebSocket room: ${n}`,e)}}async listenForLiveMessages({onMessage:e,messageBox:t,overrideHost:n}){if(X(`[MB CLIENT] Setting up listener for WebSocket room: ${t}`),this.socket??(X(`[MB CLIENT] No WebSocket connection. Initializing...`),await this.initializeConnection(n)),await this.joinRoom(t,this.originator),this.myIdentityKey==null||this.myIdentityKey.trim()===``)throw Error(`[MB CLIENT ERROR] Identity key is missing. Cannot construct room ID.`);let r=`${this.myIdentityKey}-${t}`;X(`[MB CLIENT] Listening for messages in room: ${r}`),this.socket?.on(`sendMessage-${r}`,t=>{(async()=>{X(`[MB CLIENT] Received message in room ${r}:`,t);try{let e=t.body;if(typeof e==`string`)try{e=JSON.parse(e)}catch{}if(typeof e==`object`&&e&&typeof e.encryptedMessage==`string`){X(`[MB CLIENT] Decrypting message from ${String(t.sender)}...`);let n=await this.walletClient.decrypt({protocolID:[1,`messagebox`],keyID:`1`,counterparty:t.sender,ciphertext:U(e.encryptedMessage,`base64`)},this.originator);t.body=W(n.plaintext)}else X(`[MB CLIENT] Message is not encrypted.`),t.body=typeof e==`string`?e:(()=>{try{return JSON.stringify(e)}catch{return`[Error: Unstringifiable message]`}})()}catch(e){wy(`[MB CLIENT ERROR] Failed to parse or decrypt live message:`,e),t.body=`[Error: Failed to decrypt or parse message]`}e(t)})()})}async sendLiveMessage({recipient:e,messageBox:t,body:n,messageId:r,skipEncryption:i,checkPermissions:a},o){if(e==null||e.trim()===``)throw Error(`[MB CLIENT ERROR] Recipient identity key is required`);if(t==null||t.trim()===``)throw Error(`[MB CLIENT ERROR] MessageBox is required`);if(n==null||typeof n==`string`&&n.trim()===``)throw Error(`[MB CLIENT ERROR] Message body cannot be empty`);if(await this.joinRoom(t,this.originator),this.socket==null||!this.socket.connected){Cy(`[MB CLIENT WARNING] WebSocket not connected, falling back to HTTP`);let r=o??await this.resolveHostForRecipient(e);return await this.sendMessage({recipient:e,messageBox:t,body:n},r)}let s;try{let t=await this.walletClient.createHmac({data:Array.from(new TextEncoder().encode(JSON.stringify(n))),protocolID:[1,`messagebox`],keyID:`1`,counterparty:e},this.originator);s=r??Array.from(t.hmac).map(e=>e.toString(16).padStart(2,`0`)).join(``)}catch(e){throw wy(`[MB CLIENT ERROR] Failed to generate HMAC:`,e),Error(`Failed to generate message identifier.`)}let c=`${e}-${t}`;X(`[MB CLIENT] Sending WebSocket message to room: ${c}`);let l;if(i===!0)l=typeof n==`string`?n:JSON.stringify(n);else{let t=await this.walletClient.encrypt({protocolID:[1,`messagebox`],keyID:`1`,counterparty:e,plaintext:U(typeof n==`string`?n:JSON.stringify(n),`utf8`)},this.originator);l=JSON.stringify({encryptedMessage:$l(t.ciphertext)})}return await new Promise((r,o)=>{let u=`sendMessageAck-${c}`,d=!1,f=c=>{if(d)return;d=!0;let l=this.socket;if(typeof l?.off==`function`&&l.off(u,f),X(`[MB CLIENT] Received WebSocket acknowledgment:`,c),c==null||c.status!==`success`){Cy(`[MB CLIENT] WebSocket message failed or returned unexpected response. Falling back to HTTP.`);let c={recipient:e,messageBox:t,body:n,messageId:s,skipEncryption:i,checkPermissions:a};this.resolveHostForRecipient(e).then(async e=>await this.sendMessage(c,e)).then(r).catch(o)}else X(`[MB CLIENT] Message sent successfully via WebSocket:`,c),r(c)};this.socket?.on(u,f),this.socket?.emit(`sendMessage`,{roomId:c,message:{messageId:s,recipient:e,body:l}}),setTimeout(()=>{if(!d){d=!0;let c=this.socket;typeof c?.off==`function`&&c.off(u,f),Cy(`[CLIENT] WebSocket acknowledgment timed out, falling back to HTTP`);let l={recipient:e,messageBox:t,body:n,messageId:s,skipEncryption:i,checkPermissions:a};this.resolveHostForRecipient(e).then(async e=>await this.sendMessage(l,e)).then(r).catch(o)}},1e4)})}async leaveRoom(e){if(await this.assertInitialized(),this.socket==null){Cy(`[MB CLIENT] Attempted to leave a room but WebSocket is not connected.`);return}if(this.myIdentityKey==null||this.myIdentityKey.trim()===``)throw Error(`[MB CLIENT ERROR] Identity key is not defined`);let t=`${this.myIdentityKey}-${e}`;X(`[MB CLIENT] Leaving WebSocket room: ${t}`),this.socket.emit(`leaveRoom`,t),this.joinedRooms.delete(t)}async disconnectWebSocket(){await this.assertInitialized(),this.socket==null?X(`[MB CLIENT] No active WebSocket connection to close.`):(X(`[MB CLIENT] Closing WebSocket connection...`),this.socket.disconnect(),this.socket=void 0)}async sendMessage(e,t){if(await this.assertInitialized(),e.recipient==null||e.recipient.trim()===``)throw Error(`You must provide a message recipient!`);if(e.messageBox==null||e.messageBox.trim()===``)throw Error(`You must provide a messageBox to send this message into!`);if(e.body==null||typeof e.body==`string`&&e.body.trim().length===0)throw Error(`Every message must have a body!`);let n;if(e.checkPermissions===!0)try{X(`[MB CLIENT] Checking permissions and fees for message...`);let r=await this.getMessageBoxQuote({recipient:e.recipient,messageBox:e.messageBox},t);if(r.recipientFee===-1)throw Error(`You have been blocked from sending messages to this recipient.`);if(r.recipientFee>0||r.deliveryFee>0){let i=r.recipientFee+r.deliveryFee;i>0&&(X(`[MB CLIENT] Creating payment of ${i} sats for message...`),n=await this.createMessagePayment(e.recipient,r,t),X(`[MB CLIENT] Payment data prepared:`,n))}}catch(e){throw Error(`Permission check failed: ${e instanceof Error?e.message:`Unknown error`}`)}let r;try{let t=await this.walletClient.createHmac({data:Array.from(new TextEncoder().encode(JSON.stringify(e.body))),protocolID:[1,`messagebox`],keyID:`1`,counterparty:e.recipient},this.originator);r=e.messageId??Array.from(t.hmac).map(e=>e.toString(16).padStart(2,`0`)).join(``)}catch(e){throw wy(`[MB CLIENT ERROR] Failed to generate HMAC:`,e),Error(`Failed to generate message identifier.`)}let i;if(e.skipEncryption===!0)i=typeof e.body==`string`?e.body:JSON.stringify(e.body);else{let t=await this.walletClient.encrypt({protocolID:[1,`messagebox`],keyID:`1`,counterparty:e.recipient,plaintext:U(typeof e.body==`string`?e.body:JSON.stringify(e.body),`utf8`)},this.originator);i=JSON.stringify({encryptedMessage:$l(t.ciphertext)})}let a={message:{...e,messageId:r,body:i},...n!=null&&{payment:n}};try{let n=t??await this.resolveHostForRecipient(e.recipient);if(X(`[MB CLIENT] Sending HTTP request to:`,`${n}/sendMessage`),X(`[MB CLIENT] Request Body:`,JSON.stringify(a,null,2)),this.myIdentityKey==null||this.myIdentityKey===``)try{this.myIdentityKey=(await this.walletClient.getPublicKey({identityKey:!0},this.originator)).publicKey,X(`[MB CLIENT] Fetched identity key before sending request: ${this.myIdentityKey}`)}catch(e){throw wy(`[MB CLIENT ERROR] Failed to fetch identity key:`,e),Error(`Identity key retrieval failed`)}let i=await this.authFetch.fetch(`${n}/sendMessage`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(a)});if(i.bodyUsed)throw Error(`[MB CLIENT ERROR] Response body has already been used!`);let o=await i.json();if(X(`[MB CLIENT] Raw Response Body:`,o),!i.ok)throw wy(`[MB CLIENT ERROR] Failed to send message. HTTP ${i.status}: ${i.statusText}`),Error(`Message sending failed: HTTP ${i.status} - ${i.statusText}`);if(o.status!==`success`)throw wy(`[MB CLIENT ERROR] Server returned an error: ${String(o.description)}`),Error(o.description??`Unknown error from server.`);return X(`[MB CLIENT] Message successfully sent.`),{...o,messageId:r}}catch(e){wy(`[MB CLIENT ERROR] Network or timeout error:`,e);let t=e instanceof Error?e.message:`Unknown error`;throw Error(`Failed to send message: ${t}`)}}async sendMesagetoRecepients(e,t){await this.assertInitialized();let{recipients:n,messageBox:r,body:i,skipEncryption:a}=e;if(!Array.isArray(n)||n.length===0)throw Error(`You must provide at least one recipient!`);if(!r||r.trim()===``)throw Error(`You must provide a messageBox to send this message into!`);if(i==null||typeof i==`string`&&i.trim().length===0)throw Error(`Every message must have a body!`);let o=await this.getMessageBoxQuote({recipient:n,messageBox:r},t),s=Array.isArray(o?.quotesByRecipient)?o.quotesByRecipient:[],c=o?.blockedRecipients??[],l=o?.totals,u=n.filter(e=>!c.includes(e));if(u.length===0)return{status:`error`,description:`All ${n.length} recipients are blocked.`,sent:[],blocked:c,failed:n.map(e=>({recipient:e,error:`blocked`})),totals:l};let d=new Map;for(let e of s)d.set(e.recipient,{recipientFee:e.recipientFee,deliveryFee:e.deliveryFee});let{deliveryAgentIdentityKeyByHost:f}=o;if(!f||Object.keys(f).length===0)throw Error(`Missing delivery agent identity keys in quote response.`);if(Object.keys(f).length>1&&!t)throw Error(`Recipients resolve to multiple hosts. Use overrideHost to force a single server or split by host.`);let p=(t??await this.resolveHostForRecipient(u[0])).replace(/\/+$/,``),m=f[p]??Object.values(f)[0];if(!m)throw Error(`Could not determine server delivery agent identity key.`);this.myIdentityKey||=(await this.walletClient.getPublicKey({identityKey:!0},this.originator)).publicKey;let h=[];for(let e of u){let t=await this.walletClient.createHmac({data:Array.from(new TextEncoder().encode(JSON.stringify(i))),protocolID:[1,`messagebox`],keyID:`1`,counterparty:e},this.originator),n=Array.from(t.hmac).map(e=>e.toString(16).padStart(2,`0`)).join(``);h.push(n)}let g;g=typeof i==`string`?i:JSON.stringify(i);let _=await this.createMessagePaymentBatch(u,d,m),v={message:{recipients:u,messageBox:r,messageId:h,body:g},payment:_};X(`[MB CLIENT] Sending HTTP request to:`,`${p}/sendMessage`),X(`[MB CLIENT] Request Body (batch):`,JSON.stringify({...v,payment:{..._,tx:`<omitted>`}},null,2));try{let e=await this.authFetch.fetch(`${p}/sendMessage`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(v)}),t=await e.json().catch(()=>({}));if(!e.ok||t.status!==`success`){let n=e.ok?t.description??`Unknown server error`:`HTTP ${e.status} - ${e.statusText}`;throw Error(n)}let n=Array.isArray(t.results)?t.results:[],r=[],i=n.length===u.length?`success`:n.length>0?`partial`:`error`,a=i===`success`?`Sent to ${n.length} recipients.`:i===`partial`?`Sent to ${n.length} recipients; ${u.length-n.length} failed; ${c.length} blocked.`:`Failed to send to ${u.length} allowed recipients. ${c.length} blocked.`;return{status:i,description:a,sent:n,blocked:c,failed:r,totals:l}}catch(e){let t=e instanceof Error?e.message:`Unknown error`;return{status:`error`,description:`Batch send failed: ${t}`,sent:[],blocked:c,failed:u.map(e=>({recipient:e,error:t})),totals:l}}}async anointHost(e){X(`[MB CLIENT] Starting anointHost...`);try{if(!e.startsWith(`http`))throw Error(`Invalid host URL`);let t=await this.getIdentityKey();X(`[MB CLIENT] Fields - Identity:`,t,`Host:`,e);let n=[U(t,`hex`),U(e,`utf8`)],r=new qd(this.walletClient,this.originator);X(`Fields:`,n.map(e=>H(e))),X(`ProtocolID:`,[1,`messagebox advertisement`]),X(`KeyID:`,`1`),X(`SignAs:`,`self`),X(`anyoneCanSpend:`,!1),X(`forSelf:`,!0);let i=await r.lock(n,[1,`messagebox advertisement`],`1`,`anyone`,!0);X(`[MB CLIENT] PushDrop script:`,i.toASM());let{tx:a,txid:o}=await this.walletClient.createAction({description:`Anoint host for overlay routing`,outputs:[{basket:`overlay advertisements`,lockingScript:i.toHex(),satoshis:1,outputDescription:`Overlay advertisement output`}],options:{randomizeOutputs:!1,acceptDelayedBroadcast:!1}},this.originator);if(X(`[MB CLIENT] Transaction created:`,o),a!==void 0){let e=await new Qp([`tm_messagebox`],{networkPreset:this.networkPreset}).broadcast(pf.fromAtomicBEEF(a));if(X(`[MB CLIENT] Advertisement broadcast succeeded. TXID:`,e.txid),typeof e.txid!=`string`)throw Error(`Anoint failed: broadcast did not return a txid`);return{txid:e.txid}}throw Error(`Anoint failed: failed to create action!`)}catch(e){throw wy(`[MB CLIENT ERROR] anointHost threw:`,e),e}}async revokeHostAdvertisement(e){X(`[MB CLIENT] Starting revokeHost...`);let t=`${e.txid}.${e.outputIndex}`;try{let{signableTransaction:n}=await this.walletClient.createAction({description:`Revoke MessageBox host advertisement`,inputBEEF:e.beef,inputs:[{outpoint:t,unlockingScriptLength:73,inputDescription:`Revoking host advertisement token`}]},this.originator);if(n===void 0)throw Error(`Failed to create signable transaction.`);let r=pf.fromBEEF(n.tx),i=await(await new qd(this.walletClient,this.originator).unlock([1,`messagebox advertisement`],`1`,`anyone`,`all`,!1,e.outputIndex,e.lockingScript)).sign(r,e.outputIndex),{tx:a}=await this.walletClient.signAction({reference:n.reference,spends:{[e.outputIndex]:{unlockingScript:i.toHex()}},options:{acceptDelayedBroadcast:!1}},this.originator);if(a===void 0)throw Error(`Failed to finalize the transaction signature.`);let o=await new Qp([`tm_messagebox`],{networkPreset:this.networkPreset}).broadcast(pf.fromAtomicBEEF(a));if(X(`[MB CLIENT] Revocation broadcast succeeded. TXID:`,o.txid),typeof o.txid!=`string`)throw Error(`Revoke failed: broadcast did not return a txid`);return{txid:o.txid}}catch(e){throw wy(`[MB CLIENT ERROR] revokeHost threw:`,e),e}}async listMessages({messageBox:e,host:t,acceptPayments:n}){if(typeof n!=`boolean`&&(n=!0),e.trim()===``)throw Error(`MessageBox cannot be empty`);let r=t==null?[]:[t];if(r.length===0){let e=await this.queryAdvertisements(await this.getIdentityKey(),void 0);r=Array.from(new Set([this.host,...e.map(e=>e.host)]))}let i=await Promise.allSettled(r.map(async t=>{try{X(`[MB CLIENT] Listing messages from ${t}`);let n=await this.authFetch.fetch(`${t}/listMessages`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({messageBox:e})});if(!n.ok)throw Error(`HTTP ${n.status} ${n.statusText}`);let r=await n.json();if(r.status===`error`)throw Error(r.description??`Unknown server error`);return r.messages}catch(e){throw X(`[MB CLIENT DEBUG] listMessages failed for ${t}:`,e),e}})),a=[],o=[];for(let e of i)e.status===`fulfilled`?a.push(e.value):o.push(e.reason);if(a.length===0)throw Error(`Failed to retrieve messages from any host`);let s=new Map;for(let e of a)for(let t of e)s.has(t.messageId)||s.set(t.messageId,t);if(s.size===0)return[];let c=Array.from(s.values());for(let e of c)try{let t=typeof e.body==`string`?this.tryParse(e.body):e.body,r=t,i;if(typeof t==`object`&&t&&`message`in t){let e=t.message;r=typeof e==`string`?this.tryParse(e):e,i=t.payment}if(n&&i?.tx!=null&&i.outputs!=null)try{X(`[MB CLIENT] Processing recipient payment in message from ${String(e.sender)}`);let t=i.outputs.filter(e=>e.protocol===`wallet payment`);t.length>0?(X(`[MB CLIENT] Internalizing ${t.length} recipient payment output(s)`),(await this.walletClient.internalizeAction({tx:i.tx,outputs:t,description:i.description??`MessageBox recipient payment`},this.originator)).accepted?X(`[MB CLIENT] Successfully internalized recipient payment`):Cy(`[MB CLIENT] Recipient payment internalization was not accepted`)):X(`[MB CLIENT] No wallet payment outputs found in payment data`)}catch(e){wy(`[MB CLIENT ERROR] Failed to internalize recipient payment:`,e)}if(typeof r==`object`&&r&&typeof r.encryptedMessage==`string`){X(`[MB CLIENT] Decrypting message from ${String(e.sender)}`);let t=await this.walletClient.decrypt({protocolID:[1,`messagebox`],keyID:`1`,counterparty:e.sender,ciphertext:U(r.encryptedMessage,`base64`)},this.originator),n=W(t.plaintext);e.body=this.tryParse(n)}else e.body=r??t}catch(t){wy(`[MB CLIENT ERROR] Failed to parse or decrypt message in list:`,t),e.body=`[Error: Failed to decrypt or parse message]`}return c.sort((e,t)=>Number(t.timestamp??0)-Number(e.timestamp??0)),c}async listMessagesLite({messageBox:e,host:t}){let n=await(await this.authFetch.fetch(`${t}/listMessages`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({messageBox:e})})).json();if(n.status===`error`)throw Error(n.description??`Unknown server error`);let r=n.messages,i=e=>{try{return JSON.parse(e)}catch{return e}};for(let e of r)try{let t=typeof e.body==`string`?i(e.body):e.body,n=t;if(typeof t==`object`&&t&&`message`in t){let e=t.message;n=typeof e==`string`?i(e):e}if(typeof n==`object`&&n&&typeof n.encryptedMessage==`string`){let t=await this.walletClient.decrypt({protocolID:[1,`messagebox`],keyID:`1`,counterparty:e.sender,ciphertext:U(n.encryptedMessage,`base64`)}),r=W(t.plaintext);e.body=i(r)}else e.body=n??t}catch(t){wy(`[MB CLIENT ERROR] Failed to parse or decrypt message in list:`,t),e.body=`[Error: Failed to decrypt or parse message]`}return r}tryParse(e){try{return JSON.parse(e)}catch{return e}}async acknowledgeNotification(e){await this.acknowledgeMessage({messageIds:[e.messageId]});let t=typeof e.body==`string`?this.tryParse(e.body):e.body,n;if(typeof t==`object`&&t&&`message`in t&&(n=t.payment),n?.tx!=null&&n.outputs!=null)try{X(`[MB CLIENT] Processing recipient payment in message from ${String(e.sender)}`);let t=n.outputs.filter(e=>e.protocol===`wallet payment`);return t.length<1?(X(`[MB CLIENT] No wallet payment outputs found in payment data`),!1):(X(`[MB CLIENT] Internalizing ${t.length} recipient payment output(s)`),(await this.walletClient.internalizeAction({tx:n.tx,outputs:t,description:n.description??`MessageBox recipient payment`})).accepted?(X(`[MB CLIENT] Successfully internalized recipient payment`),!0):(Cy(`[MB CLIENT] Recipient payment internalization was not accepted`),!1))}catch(e){return wy(`[MB CLIENT ERROR] Failed to internalize recipient payment:`,e),!1}return!1}async acknowledgeMessage({messageIds:e,host:t}){if(!Array.isArray(e)||e.length===0)throw Error(`Message IDs array cannot be empty`);X(`[MB CLIENT] Acknowledging messages ${JSON.stringify(e)}`);let n=t==null?[]:[t];if(n.length===0){let e=await this.getIdentityKey(),t=await this.queryAdvertisements(e,void 0);n=Array.from(new Set([this.host,...t.map(e=>e.host)]))}let r=await Promise.allSettled(n.map(async t=>{try{let n=await this.authFetch.fetch(`${t}/acknowledgeMessage`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({messageIds:e})});if(!n.ok)throw Error(`HTTP ${n.status}`);let r=await n.json();if(r.status===`error`)throw Error(r.description);return X(`[MB CLIENT] Acknowledged on ${t}`),r.status}catch(e){return Cy(`[MB CLIENT WARN] acknowledgeMessage failed for ${t}:`,e),null}})),i=r.filter(e=>e.status===`fulfilled`).find(e=>e.value!=null)?.value;if(i!=null)return i;let a=[];for(let e of r)e.status===`rejected`&&a.push(e.reason);throw Error(`Failed to acknowledge messages on all hosts: ${a.map(e=>String(e)).join(`; `)}`)}async setMessageBoxPermission(e,t){let n=t??this.host;X(`[MB CLIENT] Setting messageBox permission...`);let r=await this.authFetch.fetch(`${n}/permissions/set`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({messageBox:e.messageBox,recipientFee:e.recipientFee,...e.sender!=null&&{sender:e.sender}})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(`Failed to set permission: HTTP ${r.status} - ${String(e.description)===``?r.statusText:String(e.description)}`)}let{status:i,description:a}=await r.json();if(i===`error`)throw Error(a??`Failed to set permission`)}async getMessageBoxPermission(e,t){let n=t??await this.resolveHostForRecipient(e.recipient),r=new URLSearchParams({recipient:e.recipient,messageBox:e.messageBox,...e.sender!=null&&{sender:e.sender}});X(`[MB CLIENT] Getting messageBox permission...`);let i=await this.authFetch.fetch(`${n}/permissions/get?${r.toString()}`,{method:`GET`});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(`Failed to get permission: HTTP ${i.status} - ${String(e.description)===``?i.statusText:String(e.description)}`)}let a=await i.json();if(a.status===`error`)throw Error(a.description??`Failed to get permission`);return a.permission}async getMessageBoxQuote(e,t){if(!Array.isArray(e.recipient)){let n=t??await this.resolveHostForRecipient(e.recipient),r=new URLSearchParams({recipient:e.recipient,messageBox:e.messageBox});X(`[MB CLIENT] Getting messageBox quote (single)...`),console.log(`HELP IM QUOTING`,`${n}/permissions/quote?${r.toString()}`);let i=await this.authFetch.fetch(`${n}/permissions/quote?${r.toString()}`,{method:`GET`});if(console.log(`server response from getquote]`,i),!i.ok){let e=await i.json().catch(()=>({}));throw Error(`Failed to get quote: HTTP ${i.status} - ${String(e.description)??i.statusText}`)}let{status:a,description:o,quote:s}=await i.json();if(a===`error`)throw Error(o??`Failed to get quote`);let c=i.headers.get(`x-bsv-auth-identity-key`);if(console.log(`deliveryAgentIdentityKey`,c),c==null)throw Error(`Failed to get quote: Delivery agent did not provide their identity key`);return{recipientFee:s.recipientFee,deliveryFee:s.deliveryFee,deliveryAgentIdentityKey:c}}let n=e.recipient;if(n.length===0)throw Error(`At least one recipient is required.`);X(`[MB CLIENT] Getting messageBox quotes (multi)...`),console.log(`[MB CLIENT] Getting messageBox quotes (multi)...`);let r=new Map;for(let e of n){let n=t??await this.resolveHostForRecipient(e),i=r.get(n);i?i.push(e):r.set(n,[e])}let i={},a=[],o=[],s=0,c=0,l=async(t,n)=>{let r=new URLSearchParams;for(let e of n)r.append(`recipient`,e);r.set(`messageBox`,e.messageBox);let l=`${t}/permissions/quote?${r.toString()}`;X(`[MB CLIENT] Multi-quote GET:`,l);let u=await this.authFetch.fetch(l,{method:`GET`});if(!u.ok){let e=await u.json().catch(()=>({}));throw Error(`Failed to get quote (host ${t}): HTTP ${u.status} - ${String(e.description)??u.statusText}`)}let d=u.headers.get(`x-bsv-auth-identity-key`);if(!d)throw Error(`Failed to get quote (host ${t}): missing delivery agent identity key`);i[t]=d;let f=await u.json();if(Array.isArray(f?.quotesByRecipient)){for(let e of f.quotesByRecipient)a.push({recipient:e.recipient,messageBox:e.messageBox,deliveryFee:e.deliveryFee,recipientFee:e.recipientFee,status:e.status}),s+=e.deliveryFee,e.recipientFee===-1?o.includes(e.recipient)||o.push(e.recipient):c+=e.recipientFee;if(Array.isArray(f?.blockedRecipients))for(let e of f.blockedRecipients)o.includes(e)||o.push(e)}else if(f?.quote)for(let t of n){let{deliveryFee:n,recipientFee:r}=f.quote,i=r===-1?`blocked`:r===0?`always_allow`:`payment_required`;a.push({recipient:t,messageBox:e.messageBox,deliveryFee:n,recipientFee:r,status:i}),s+=n,r===-1?o.push(t):c+=r}else throw Error(`Unexpected quote response shape from host ${t}`)};return await Promise.all(Array.from(r.entries()).map(([e,t])=>l(e,t))),{quotesByRecipient:a,totals:{deliveryFees:s,recipientFees:c,totalForPayableRecipients:s+c},blockedRecipients:o,deliveryAgentIdentityKeyByHost:i}}async listMessageBoxPermissions(t,n){let r=n??this.host,i=new URLSearchParams;t?.messageBox!=null&&i.set(`message_box`,t.messageBox),t?.limit!==void 0&&i.set(`limit`,t.limit.toString()),t?.offset!==void 0&&i.set(`offset`,t.offset.toString()),X(`[MB CLIENT] Listing messageBox permissions with params:`,i.toString());let a=await this.authFetch.fetch(`${r}/permissions/list?${i.toString()}`,{method:`GET`});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(`Failed to list permissions: HTTP ${a.status} - ${String(e.description)===``?a.statusText:String(e.description)}`)}let o=await a.json();if(o.status===`error`)throw Error(o.description??`Failed to list permissions`);return o.permissions.map(t=>({sender:t.sender,messageBox:t.message_box,recipientFee:t.recipient_fee,status:e.getStatusFromFee(t.recipient_fee),createdAt:t.created_at,updatedAt:t.updated_at}))}async allowNotificationsFromPeer(e,t=0,n){await this.setMessageBoxPermission({messageBox:`notifications`,sender:e,recipientFee:t},n)}async denyNotificationsFromPeer(e,t){await this.setMessageBoxPermission({messageBox:`notifications`,sender:e,recipientFee:-1},t)}async checkPeerNotificationStatus(e,t){let n=await this.getIdentityKey();return await this.getMessageBoxPermission({recipient:n,messageBox:`notifications`,sender:e},t)}async listPeerNotifications(e){return await this.listMessageBoxPermissions({messageBox:`notifications`},e)}async sendNotification(e,t,n){return await this.assertInitialized(),Array.isArray(e)?await this.sendMesagetoRecepients({recipients:e,messageBox:`notifications`,body:t},n):await this.sendMessage({recipient:e,messageBox:`notifications`,body:t,checkPermissions:!0},n)}async registerDevice(e,t){if(e.fcmToken==null||e.fcmToken.trim()===``)throw Error(`fcmToken is required and must be a non-empty string`);if(e.platform!=null&&![`ios`,`android`,`web`].includes(e.platform))throw Error(`platform must be one of: ios, android, web`);let n=t??this.host;X(`[MB CLIENT] Registering device for FCM notifications...`);let r=await this.authFetch.fetch(`${n}/registerDevice`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({fcmToken:e.fcmToken.trim(),deviceId:e.deviceId?.trim()??void 0,platform:e.platform??void 0})});if(!r.ok){let e=await r.json().catch(()=>({})),t=String(e.description)??r.statusText;throw Error(`Failed to register device: HTTP ${r.status} - ${t}`)}let i=await r.json();if(i.status===`error`)throw Error(i.description??`Failed to register device`);return X(`[MB CLIENT] Device registered successfully`),{status:i.status,message:i.message,deviceId:i.deviceId}}async listRegisteredDevices(e){let t=e??this.host;X(`[MB CLIENT] Listing registered devices...`);let n=await this.authFetch.fetch(`${t}/devices`,{method:`GET`});if(!n.ok){let e=await n.json().catch(()=>({})),t=String(e.description)??n.statusText;throw Error(`Failed to list devices: HTTP ${n.status} - ${t}`)}let r=await n.json();if(r.status===`error`)throw Error(r.description??`Failed to list devices`);return X(`[MB CLIENT] Found ${r.devices.length} registered devices`),r.devices}static getStatusFromFee(e){return e===-1?`blocked`:e===0?`always_allow`:`payment_required`}async createMessagePayment(e,t,n=`MessageBox delivery payment`){if(t.recipientFee<=0&&t.deliveryFee<=0)throw Error(`No payment required`);X(`[MB CLIENT] Creating payment transaction for ${t.recipientFee} sats (delivery: ${t.deliveryFee}, recipient: ${t.recipientFee})`);let r=[],i=[],a=await this.getIdentityKey(),o=0;if(t.deliveryFee>0){let e=$l(Qu(32)),n=$l(Qu(32));console.log(`delivery agent:`,t.deliveryAgentIdentityKey);let{publicKey:s}=await this.walletClient.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${e} ${n}`,counterparty:t.deliveryAgentIdentityKey},this.originator),c=new Gd().lock(Yu.fromString(s).toAddress()).toHex();i.push({satoshis:t.deliveryFee,lockingScript:c,outputDescription:`MessageBox server delivery fee`,customInstructions:JSON.stringify({derivationPrefix:e,derivationSuffix:n,recipientIdentityKey:t.deliveryAgentIdentityKey})}),r.push({outputIndex:o++,protocol:`wallet payment`,paymentRemittance:{derivationPrefix:e,derivationSuffix:n,senderIdentityKey:a}})}if(t.recipientFee>0){let n=$l(Qu(32)),a=$l(Qu(32)),s=new vf(`anyone`),{publicKey:c}=await s.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${n} ${a}`,counterparty:e});if(c==null||c.trim()===``)throw Error(`Failed to derive recipient's public key`);let l=new Gd().lock(Yu.fromString(c).toAddress()).toHex();i.push({satoshis:t.recipientFee,lockingScript:l,outputDescription:`Recipient message fee`,customInstructions:JSON.stringify({derivationPrefix:n,derivationSuffix:a,recipientIdentityKey:e})}),r.push({outputIndex:o++,protocol:`wallet payment`,paymentRemittance:{derivationPrefix:n,derivationSuffix:a,senderIdentityKey:(await s.getPublicKey({identityKey:!0})).publicKey}})}let{tx:s}=await this.walletClient.createAction({description:n,outputs:i,options:{randomizeOutputs:!1,acceptDelayedBroadcast:!1}},this.originator);if(s==null)throw Error(`Failed to create payment transaction`);return{tx:s,outputs:r,description:n}}async createMessagePaymentBatch(e,t,n,r=`MessageBox delivery payment (batch)`){let i=[],a=[],o=e.reduce((e,n)=>{let r=t.get(n);return r?e??r.deliveryFee:e},void 0)??0,s=await this.getIdentityKey(),c=0;if(o>0){let e=$l(Qu(32)),t=$l(Qu(32)),{publicKey:r}=await this.walletClient.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${e} ${t}`,counterparty:n},this.originator),l=new Gd().lock(Yu.fromString(r).toAddress()).toHex();a.push({satoshis:o,lockingScript:l,outputDescription:`MessageBox server delivery fee (batch)`,customInstructions:JSON.stringify({derivationPrefix:e,derivationSuffix:t,recipientIdentityKey:n})}),i.push({outputIndex:c++,protocol:`wallet payment`,paymentRemittance:{derivationPrefix:e,derivationSuffix:t,senderIdentityKey:s}})}let l=new vf(`anyone`),u=(await l.getPublicKey({identityKey:!0})).publicKey;for(let n of e){let e=t.get(n);if(!e||e.recipientFee<=0)continue;let r=$l(Qu(32)),o=$l(Qu(32)),{publicKey:s}=await l.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${r} ${o}`,counterparty:n}),d=new Gd().lock(Yu.fromString(s).toAddress()).toHex();a.push({satoshis:e.recipientFee,lockingScript:d,outputDescription:`Recipient message fee (${n.slice(0,8)})`,customInstructions:JSON.stringify({derivationPrefix:r,derivationSuffix:o,recipientIdentityKey:n})}),i.push({outputIndex:c++,protocol:`wallet payment`,paymentRemittance:{derivationPrefix:r,derivationSuffix:o,senderIdentityKey:u}})}let{tx:d}=await this.walletClient.createAction({description:r,outputs:a,options:{randomizeOutputs:!1,acceptDelayedBroadcast:!1}},this.originator);if(!d)throw Error(`Failed to create payment transaction`);return{tx:d,outputs:i,description:r}}};function Oy(e){try{return typeof e==`string`?JSON.parse(e):e}catch{return wy(`[PP CLIENT] Failed to parse input in safeParse:`,e),{}}}var ky=0,Ay=class extends Dy{peerPayWalletClient;_authFetchInstance;messageBox;constructor(e){let{messageBoxHost:t=`https://messagebox.babbage.systems`,walletClient:n,enableLogging:r=!1,originator:i}=e;super({host:t,walletClient:n,enableLogging:r,originator:i}),this.messageBox=e.messageBox??`payment_inbox`,this.peerPayWalletClient=n,this.originator=i}get authFetchInstance(){return(this._authFetchInstance===null||this._authFetchInstance===void 0)&&(this._authFetchInstance=new Hp(this.peerPayWalletClient,void 0,void 0,this.originator)),this._authFetchInstance}async createPaymentToken(e){if(e.amount<=0)throw Error(`Invalid payment details: recipient and valid amount are required`);let t=await Pp(this.peerPayWalletClient),n=await Pp(this.peerPayWalletClient);X(`[PP CLIENT] Derivation Prefix: ${t}`),X(`[PP CLIENT] Derivation Suffix: ${n}`);let{publicKey:r}=await this.peerPayWalletClient.getPublicKey({protocolID:[2,`3241645161d8`],keyID:`${t} ${n}`,counterparty:e.recipient},this.originator);if(X(`[PP CLIENT] Derived Public Key: ${r}`),r==null||r.trim()===``)throw Error(`Failed to derive recipients public key`);let i=new Gd().lock(Yu.fromString(r).toAddress()).toHex();X(`[PP CLIENT] Locking Script: ${i}`);let a=await this.peerPayWalletClient.createAction({description:`PeerPay payment`,labels:[`peerpay`],outputs:[{satoshis:e.amount,lockingScript:i,customInstructions:JSON.stringify({derivationPrefix:t,derivationSuffix:n,payee:e.recipient}),outputDescription:`Payment for PeerPay transaction`}],options:{randomizeOutputs:!1}},this.originator);if(a.tx===void 0)throw Error(`Transaction creation failed!`);return X(`[PP CLIENT] Payment Action:`,a),{customInstructions:{derivationPrefix:t,derivationSuffix:n},transaction:a.tx,amount:e.amount}}async sendPayment(e,t){if(e.recipient==null||e.recipient.trim()===``||e.amount<=0)throw Error(`Invalid payment details: recipient and valid amount are required`);let n=await this.createPaymentToken(e);await this.sendMessage({recipient:e.recipient,messageBox:this.messageBox,body:JSON.stringify(n)},t)}async sendLivePayment(e,t){let n=await this.createPaymentToken(e);try{await this.sendLiveMessage({recipient:e.recipient,messageBox:this.messageBox,body:JSON.stringify(n)},t)}catch(r){Cy(`[PP CLIENT] sendLiveMessage failed, falling back to HTTP:`,r),await this.sendMessage({recipient:e.recipient,messageBox:this.messageBox,body:JSON.stringify(n)},t)}}async listenForLivePayments({onPayment:e,overrideHost:t}){await this.listenForLiveMessages({messageBox:this.messageBox,overrideHost:t,onMessage:t=>{X(`[MB CLIENT] Received Live Payment:`,t);let n={messageId:t.messageId,sender:t.sender,token:Oy(t.body)};X(`[PP CLIENT] Converted PeerMessage to IncomingPayment:`,n),e(n)}})}async acceptPayment(e){try{X(`[PP CLIENT] Processing payment: ${JSON.stringify(e,null,2)}`);let t=await this.peerPayWalletClient.internalizeAction({tx:e.token.transaction,outputs:[{paymentRemittance:{derivationPrefix:e.token.customInstructions.derivationPrefix,derivationSuffix:e.token.customInstructions.derivationSuffix,senderIdentityKey:e.sender},outputIndex:e.token.outputIndex??ky,protocol:`wallet payment`}],labels:[`peerpay`],description:`PeerPay Payment`},this.originator);return X(`[PP CLIENT] Payment internalized successfully: ${JSON.stringify(t,null,2)}`),X(`[PP CLIENT] Acknowledging payment with messageId: ${e.messageId}`),await this.acknowledgeMessage({messageIds:[e.messageId]}),{payment:e,paymentResult:t}}catch(e){return wy(`[PP CLIENT] Error accepting payment: ${String(e)}`),`Unable to receive payment!`}}async rejectPayment(e){if(X(`[PP CLIENT] Rejecting payment: ${JSON.stringify(e,null,2)}`),e.token.amount-1e3<1e3){X(`[PP CLIENT] Payment amount too small after fee, just acknowledging.`);try{X(`[PP CLIENT] Attempting to acknowledge message ${e.messageId}...`),(this.authFetch===null||this.authFetch===void 0)&&Cy(`[PP CLIENT] Warning: authFetch is undefined! Ensure PeerPayClient is initialized correctly.`),X(`[PP CLIENT] authFetch instance:`,this.authFetch);let t=await this.acknowledgeMessage({messageIds:[e.messageId]});X(`[PP CLIENT] Acknowledgment response: ${t}`)}catch(e){if(typeof e==`object`&&e&&`message`in e&&typeof e.message==`string`&&e.message.includes(`401`))Cy(`[PP CLIENT] Authentication issue while acknowledging: ${e.message}`);else throw wy(`[PP CLIENT] Error acknowledging message: ${e.message}`),e}return}X(`[PP CLIENT] Accepting payment before refunding...`),await this.acceptPayment(e),X(`[PP CLIENT] Sending refund of ${e.token.amount-1e3} to ${e.sender}...`),await this.sendPayment({recipient:e.sender,amount:e.token.amount-1e3}),X(`[PP CLIENT] Payment successfully rejected and refunded.`);try{X(`[PP CLIENT] Acknowledging message ${e.messageId} after refunding...`),await this.acknowledgeMessage({messageIds:[e.messageId]}),X(`[PP CLIENT] Acknowledgment after refund successful.`)}catch(e){wy(`[PP CLIENT] Error acknowledging message after refund: ${e.message}`)}}async listIncomingPayments(e){return(await this.listMessages({messageBox:this.messageBox,host:e})).map(e=>{let t=Oy(e.body);return{messageId:e.messageId,sender:e.sender,token:t}})}},jy=null,My=0,Ny=3e4,Py=(...e)=>{Ks.DEBUG_VERBOSE&&console.log(...e)};async function Fy(e,t=`NukeNote fee`){let n=Ks.HELPER_CACHE_ENDPOINT||``;if(!n)return console.warn(`[donationFee] No HELPER_CACHE_ENDPOINT configured`),null;let r=Date.now();if(jy&&My>r&&jy.amountSatoshis===e)return Py(`[donationFee] Using cached invoice:`,jy.invoiceId),jy;try{let i=await fetch(`${n}/invoices`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({amountSatoshis:e,memo:t})});if(!i.ok){let e=await i.json().catch(()=>({}));return console.error(`[donationFee] Failed to create invoice:`,i.status,e),null}let a=await i.json();return Py(`[donationFee] Created invoice:`,a.id,`->`,a.address),jy={address:a.address,invoiceId:a.id,amountSatoshis:e},My=r+Ny,jy}catch(e){return console.error(`[donationFee] Failed to fetch invoice address:`,e),null}}function Iy(){jy=null,My=0}async function Ly(e=50){if(!Number.isFinite(e)||!Number.isInteger(e)||e<=0)return null;let t=await Fy(e);if(!t)return null;try{let n=new Ma().lock(t.address);return{satoshis:e,lockingScript:n.toHex(),outputDescription:`NukeNote fee`,invoiceId:t.invoiceId}}catch(e){return console.warn(`[donationFee] Failed to build donation output`,e),null}}function Ry(e){if(typeof window>`u`)return;let t=window.__NUKENOTE_MESSAGEBOX_HEALTH__||{},n={status:`unknown`,lastError:null,lastOkAt:null,lastCheckedAt:Date.now(),...t,...e};e.status===`ok`&&(n.lastOkAt=Date.now(),n.lastError=null),window.__NUKENOTE_MESSAGEBOX_HEALTH__=n;try{let e=new CustomEvent(`nukenote:messagebox-health`,{detail:n});window.dispatchEvent(e)}catch(e){console.warn(`[MessageBoxHealth] Failed to dispatch health event`,e)}}async function zy({amountSats:e,description:t}){let n=Number(e);if(!Number.isFinite(n)||!Number.isInteger(n)||n<=0)throw Error(`Amount must be a positive integer number of sats`);let{client:r}=await nc(),i=await Ly(n);if(!i)throw Error(`Failed to get donation address from server. Is HELPER_CACHE_ENDPOINT configured?`);let a=[{satoshis:i.satoshis,lockingScript:i.lockingScript,outputDescription:`Nullify donation`}],o=t||`Nullify donation (${n} sats)`,s=await r.createAction({description:o,outputs:a}),c=ac(s);return Iy(),{response:s,txid:c,invoiceId:i.invoiceId}}async function By({identityKey:e,amountSats:t,originator:n}){if(!e||typeof e!=`string`)throw Error(`Recipient identity key is required`);let r=Number(t);if(!Number.isFinite(r)||!Number.isInteger(r)||r<=0)throw Error(`Amount must be a positive integer number of sats`);let{client:i}=await nc(),a=i,o=n||typeof window<`u`&&window.location?.origin||void 0;await new Ay({walletClient:a,enableLogging:!0,originator:o}).sendLivePayment({recipient:e,amount:r})}async function Vy({onPaymentAccepted:e}={}){try{Ry({status:`connecting`});let{client:t}=await nc(),n=t,r=typeof window<`u`&&window.location?.origin?window.location.origin:void 0,i;try{i=new Ay({walletClient:n,enableLogging:!0,originator:r})}catch(e){throw console.error(`[PeerPay] Failed to construct PeerPayClient`,e),Ry({status:`error`,lastError:String(e)}),e}let a=async t=>{if(t)try{console.log(`[PeerPay] Auto-accepting payment without user prompt`,t);let a=await n.internalizeAction({tx:t.token.transaction,outputs:[{paymentRemittance:{derivationPrefix:t.token.customInstructions.derivationPrefix,derivationSuffix:t.token.customInstructions.derivationSuffix,senderIdentityKey:t.sender},outputIndex:t.token.outputIndex??0,protocol:`wallet payment`}],labels:[`peerpay`],description:`PeerPay Payment`,seekPermission:!1},r);if(console.log(`[PeerPay] Payment internalized successfully`,a),await i.acknowledgeMessage({messageIds:[t.messageId]}),console.log(`[PeerPay] Payment acknowledged`),typeof e==`function`){let n=t?.token&&typeof t.token.amount==`number`?t.token.amount:null;e({payment:t,result:a,amount:n})}}catch(e){console.error(`[PeerPay] Failed to accept incoming payment`,e)}};try{console.log(`[PeerPay] Checking for existing incoming payments to auto-accept...`);let e=await i.listIncomingPayments();if(Ry({status:`ok`}),Array.isArray(e)&&e.length>0){console.log(`[PeerPay] Found pending PeerPay payments`,e.map(e=>({messageId:e.messageId,amount:e.token&&typeof e.token.amount==`number`?e.token.amount:null})));for(let t of e)console.log(`[PeerPay] Auto-accepting existing PeerPay payment`,t),await a(t)}else console.log(`[PeerPay] No existing PeerPay payments found`)}catch(e){console.error(`[PeerPay] Failed to list/accept existing PeerPay payments`,e),Ry({status:`degraded`,lastError:String(e)})}try{i.listenForLivePayments({onPayment:async e=>{console.log(`[PeerPay] Incoming live PeerPay payment`,e),await a(e)}}),console.log(`[PeerPay] Auto-accept listener active`)}catch(e){console.error(`[PeerPay] Failed to start live PeerPay listener`,e)}let o=setInterval(async()=>{try{console.log(`[PeerPay] Polling for incoming payments...`);let e=await i.listIncomingPayments();if(Ry({status:`ok`}),Array.isArray(e)&&e.length>0){console.log(`[PeerPay] Found pending payments during poll`,e.length);for(let t of e)console.log(`[PeerPay] Auto-accepting polled payment`,t),await a(t)}}catch(e){console.error(`[PeerPay] Failed to poll for incoming payments`,e),Ry({status:`degraded`,lastError:String(e)})}},1e4);return typeof window<`u`&&(window.__NUKENOTE_PEERPAY_POLL_INTERVAL__=o),i}catch(e){return console.error(`[PeerPay] Failed to start auto-accept PeerPay helper`,e),Ry({status:`error`,lastError:String(e)}),null}}var Hy=o((e=>{var t=f(),n=Symbol.for(`react.element`),r=Symbol.for(`react.fragment`),i=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function s(e,t,r){var s,c={},l=null,u=null;for(s in r!==void 0&&(l=``+r),t.key!==void 0&&(l=``+t.key),t.ref!==void 0&&(u=t.ref),t)i.call(t,s)&&!o.hasOwnProperty(s)&&(c[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)c[s]===void 0&&(c[s]=t[s]);return{$$typeof:n,type:e,key:l,ref:u,props:c,_owner:a.current}}e.Fragment=r,e.jsx=s,e.jsxs=s})),Z=l(o(((e,t)=>{t.exports=Hy()}))()),Uy=(0,y.createContext)();function Wy({children:e}){let[t,n]=(0,y.useState)([]),r={notifications:t,addNotification:e=>{let t=Date.now()+Math.random(),r={id:t,type:`info`,timestamp:Date.now(),...e};return console.log(`[NotificationContext] Adding notification:`,r),n(e=>{let t=[...e,r];return console.log(`[NotificationContext] Notifications after add:`,t.length),t}),t},removeNotification:e=>{console.log(`[NotificationContext] Removing notification:`,e),n(t=>{let n=t.filter(t=>t.id!==e);return console.log(`[NotificationContext] Notifications after remove:`,n.length),n})},clearNotifications:()=>{console.log(`[NotificationContext] Clearing all notifications`),n([])}};return(0,Z.jsx)(Uy.Provider,{value:r,children:e})}function Gy(){let e=(0,y.useContext)(Uy);if(!e)throw Error(`useNotification must be used within a NotificationProvider`);return e}var Ky=(0,y.createContext)(),qy=`nukenote:wallet-type`;function Jy({children:e}){let[t,n]=(0,y.useState)(!1),[r,i]=(0,y.useState)(null),[a,o]=(0,y.useState)(``),[s,c]=(0,y.useState)(``),[l,u]=(0,y.useState)(!1),[d,f]=(0,y.useState)(null),[p,m]=(0,y.useState)(null),[h,g]=(0,y.useState)(null),_=(0,y.useRef)(!1),[v,b]=(0,y.useState)(!1),x=(0,y.useRef)(!1),{addNotification:S}=Gy(),C=(0,y.useCallback)(async()=>{try{let e=await oc.checkCapabilities();return f(e),e}catch(e){console.error(`Capability check failed:`,e),f({supported:!1,features:[],error:e.message})}},[]);(0,y.useEffect)(()=>{let e=oc.getStatus();if(e.isConnected){n(!0),i(e.walletType),c(e.identityKey),m(e.network||null),g(e.version||null),C();return}if(x.current)return;x.current=!0;let t=localStorage.getItem(qy);t&&(console.log(`[WalletContext] Auto-reconnecting to`,t,`wallet...`),oc.initialize(t).then(async e=>{try{await e.wallet.getPublicKey({identityKey:!0})}catch(e){console.warn(`[WalletContext] Auto-reconnect probe failed:`,e.message);return}n(!0),i(e.walletType),c(e.identityKey),m(e.network||null),g(e.version||null),C(),nc({autoConnect:!1}).catch(()=>{}),console.log(`[WalletContext] Auto-reconnect successful`)}).catch(e=>{console.warn(`[WalletContext] Auto-reconnect failed (will require manual connect):`,e.message)}))},[C]);let w=(0,y.useCallback)(async(e=`auto`)=>{console.log(`[WalletContext] connectWallet called with type:`,e),u(!0);try{console.log(`[WalletContext] calling walletBootstrap.initialize...`);let t=await oc.initialize(e);console.log(`[WalletContext] wallet initialized:`,t);try{console.log(`[WalletContext] Probing wallet with getPublicKey...`);let e=await t.wallet.getPublicKey({identityKey:!0});console.log(` Wallet alive and reachable:`,e)}catch(e){throw console.error(` Wallet transport selected but not reachable:`,e),Error(`Wallet ${t.walletType} selected but not reachable: ${e.message}`)}n(!0),i(t.walletType),c(t.identityKey),m(t.network||null),g(t.version||null);try{localStorage.setItem(qy,t.walletType)}catch(e){console.warn(`[WalletContext] Failed to persist wallet type:`,e.message)}try{let e=await t.wallet.getWalletInfo?.();e?.address&&o(e.address)}catch(e){console.warn(`Could not get wallet address:`,e.message)}await C(),console.log(`[WalletContext] Warming up wallet UTXO cache...`);try{await nc({autoConnect:!1}),console.log(`[WalletContext] Wallet warmup complete`)}catch(e){console.warn(`[WalletContext] Wallet warmup failed (non-fatal):`,e.message)}return console.log(`[WalletContext] wallet connection complete`),t}catch(e){throw console.error(`[WalletContext] Wallet connection failed:`,e),console.error(`[WalletContext] Error stack:`,e.stack),e}finally{u(!1)}},[C]),T=(0,y.useCallback)(async()=>{try{typeof window<`u`&&window.__NUKENOTE_PEERPAY_POLL_INTERVAL__&&(clearInterval(window.__NUKENOTE_PEERPAY_POLL_INTERVAL__),window.__NUKENOTE_PEERPAY_POLL_INTERVAL__=null,console.log(`[WalletContext] Stopped PeerPay polling`)),await oc.disconnect(),n(!1),i(null),o(``),c(``),f(null),m(null),g(null),_.current=!1,b(!1);try{localStorage.removeItem(qy)}catch(e){console.warn(`[WalletContext] Failed to clear stored wallet type:`,e.message)}}catch(e){console.error(`Wallet disconnect failed:`,e)}},[]),E=(0,y.useCallback)(()=>oc.wallet,[]);(0,y.useEffect)(()=>{!t||_.current||(_.current=!0,(async()=>{try{await Vy({onPaymentAccepted:({amount:e})=>{S(typeof e==`number`&&Number.isFinite(e)&&e>0?{type:`success`,message:`Received ${e} sats into your wallet.`,duration:7e3}:{type:`success`,message:`Incoming sats payment accepted into your wallet.`,duration:7e3})}}),b(!0)}catch(e){console.error(`[WalletContext] Failed to start PeerPay auto-accept listener`,e),b(!1)}})())},[t,S]);let D={isConnected:t,walletType:r,address:a,identityKey:s,isLoading:l,capabilities:d,network:p,version:h,peerPayActive:v,connectWallet:w,disconnectWallet:T,getWalletClient:E,checkCapabilities:C};return(0,Z.jsx)(Ky.Provider,{value:D,children:e})}function Yy(){let e=(0,y.useContext)(Ky);if(!e)throw Error(`useWallet must be used within a WalletProvider`);return e}var Xy=(0,y.createContext)(null);function Zy({children:e}){let t=(0,y.useRef)(null),[n,r]=(0,y.useState)(null),[i,a]=(0,y.useState)(!1),[o,s]=(0,y.useState)(null),c=(0,y.useCallback)(()=>{t.current=null,r(null),a(!1)},[]),l=(0,y.useCallback)(async()=>{s(null);let e=sc.getStatus();if(!e?.wallet)throw c(),Error(`Wallet not connected`);if(e.walletType!==`json-api`)throw c(),Error(`AuthFetch requires Metanet Desktop (JSON-API) wallet`);let n=e.wallet;if(!n||typeof n.getPublicKey!=`function`)throw c(),Error(`Connected wallet does not expose WalletClient interface`);t.current||=new ys(n);let i=e.identityKey||await n.getPublicKey({identityKey:!0});return r(i),a(!0),{authFetch:t.current,identityKey:i}},[c]),u=(0,y.useCallback)(async()=>{if(i&&t.current&&n)return{authFetch:t.current,identityKey:n};try{return await l()}catch(e){throw s(e),e}},[i,n,l]),d=(0,y.useCallback)(async(e,t)=>{let{authFetch:n}=await u();return n.fetch(e,t)},[u]);(0,y.useEffect)(()=>{sc.getStatus()?.walletType===`json-api`?l().catch(()=>{}):c()},[l,c]);let f=(0,y.useMemo)(()=>({ensureAuth:u,fetchWithAuth:d,identityKey:n,isAuthReady:i&&!!t.current,error:o}),[u,d,n,i,o]);return(0,Z.jsx)(Xy.Provider,{value:f,children:e})}
/**
* @license lucide-react v0.344.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/
var Qy={xmlns:`http://www.w3.org/2000/svg`,width:24,height:24,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:2,strokeLinecap:`round`,strokeLinejoin:`round`},$y=e=>e.replace(/([a-z0-9])([A-Z])/g,`$1-$2`).toLowerCase().trim(),eb=(e,t)=>{let n=(0,y.forwardRef)(({color:n=`currentColor`,size:r=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:o=``,children:s,...c},l)=>(0,y.createElement)(`svg`,{ref:l,...Qy,width:r,height:r,stroke:n,strokeWidth:a?Number(i)*24/Number(r):i,className:[`lucide`,`lucide-${$y(e)}`,o].join(` `),...c},[...t.map(([e,t])=>(0,y.createElement)(e,t)),...Array.isArray(s)?s:[s]]));return n.displayName=`${e}`,n},tb=eb(`Activity`,[[`path`,{d:`M22 12h-4l-3 9L9 3l-3 9H2`,key:`d5dnw9`}]]),nb=eb(`AlertCircle`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`line`,{x1:`12`,x2:`12`,y1:`8`,y2:`12`,key:`1pkeuh`}],[`line`,{x1:`12`,x2:`12.01`,y1:`16`,y2:`16`,key:`4dfq90`}]]),rb=eb(`AlertTriangle`,[[`path`,{d:`m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z`,key:`c3ski4`}],[`path`,{d:`M12 9v4`,key:`juzpu7`}],[`path`,{d:`M12 17h.01`,key:`p32p05`}]]),ib=eb(`ArrowLeft`,[[`path`,{d:`m12 19-7-7 7-7`,key:`1l729n`}],[`path`,{d:`M19 12H5`,key:`x3x0zl`}]]),ab=eb(`Ban`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`path`,{d:`m4.9 4.9 14.2 14.2`,key:`1m5liu`}]]),ob=eb(`Bell`,[[`path`,{d:`M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9`,key:`1qo2s2`}],[`path`,{d:`M10.3 21a1.94 1.94 0 0 0 3.4 0`,key:`qgo35s`}]]),sb=eb(`Brush`,[[`path`,{d:`m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08`,key:`1styjt`}],[`path`,{d:`M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z`,key:`z0l1mu`}]]),cb=eb(`Camera`,[[`path`,{d:`M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z`,key:`1tc9qg`}],[`circle`,{cx:`12`,cy:`13`,r:`3`,key:`1vg3eu`}]]),lb=eb(`CheckCircle2`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`path`,{d:`m9 12 2 2 4-4`,key:`dzmm74`}]]),ub=eb(`Check`,[[`path`,{d:`M20 6 9 17l-5-5`,key:`1gmf2c`}]]),db=eb(`ChevronDown`,[[`path`,{d:`m6 9 6 6 6-6`,key:`qrunsl`}]]),fb=eb(`ChevronRight`,[[`path`,{d:`m9 18 6-6-6-6`,key:`mthhwq`}]]),pb=eb(`ChevronUp`,[[`path`,{d:`m18 15-6-6-6 6`,key:`153udz`}]]),mb=eb(`Copy`,[[`rect`,{width:`14`,height:`14`,x:`8`,y:`8`,rx:`2`,ry:`2`,key:`17jyea`}],[`path`,{d:`M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2`,key:`zix9uf`}]]),hb=eb(`ExternalLink`,[[`path`,{d:`M15 3h6v6`,key:`1q9fwt`}],[`path`,{d:`M10 14 21 3`,key:`gplh6r`}],[`path`,{d:`M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6`,key:`a6xqqp`}]]),gb=eb(`Filter`,[[`polygon`,{points:`22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3`,key:`1yg77f`}]]),_b=eb(`Flame`,[[`path`,{d:`M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z`,key:`96xj49`}]]),vb=eb(`Heart`,[[`path`,{d:`M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z`,key:`c3ymky`}]]),yb=eb(`Info`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`path`,{d:`M12 16v-4`,key:`1dtifu`}],[`path`,{d:`M12 8h.01`,key:`e9boi3`}]]),bb=eb(`Key`,[[`circle`,{cx:`7.5`,cy:`15.5`,r:`5.5`,key:`yqb3hr`}],[`path`,{d:`m21 2-9.6 9.6`,key:`1j0ho8`}],[`path`,{d:`m15.5 7.5 3 3L22 7l-3-3`,key:`1rn1fs`}]]),xb=eb(`Loader2`,[[`path`,{d:`M21 12a9 9 0 1 1-6.219-8.56`,key:`13zald`}]]),Sb=eb(`LogOut`,[[`path`,{d:`M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4`,key:`1uf3rs`}],[`polyline`,{points:`16 17 21 12 16 7`,key:`1gabdz`}],[`line`,{x1:`21`,x2:`9`,y1:`12`,y2:`12`,key:`1uyos4`}]]),Cb=eb(`Menu`,[[`line`,{x1:`4`,x2:`20`,y1:`12`,y2:`12`,key:`1e0a9i`}],[`line`,{x1:`4`,x2:`20`,y1:`6`,y2:`6`,key:`1owob3`}],[`line`,{x1:`4`,x2:`20`,y1:`18`,y2:`18`,key:`yk5zj1`}]]),wb=eb(`MessageCircle`,[[`path`,{d:`M7.9 20A9 9 0 1 0 4 16.1L2 22Z`,key:`vv11sd`}]]),Tb=eb(`MessageSquare`,[[`path`,{d:`M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z`,key:`1lielz`}]]),Eb=eb(`PenLine`,[[`path`,{d:`M12 20h9`,key:`t2du7b`}],[`path`,{d:`M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z`,key:`ymcmye`}]]),Db=eb(`Save`,[[`path`,{d:`M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z`,key:`1owoqh`}],[`polyline`,{points:`17 21 17 13 7 13 7 21`,key:`1md35c`}],[`polyline`,{points:`7 3 7 8 15 8`,key:`8nz8an`}]]),Ob=eb(`Settings`,[[`path`,{d:`M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z`,key:`1qme2f`}],[`circle`,{cx:`12`,cy:`12`,r:`3`,key:`1v7zrd`}]]),kb=eb(`ShieldCheck`,[[`path`,{d:`M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z`,key:`oel41y`}],[`path`,{d:`m9 12 2 2 4-4`,key:`dzmm74`}]]),Ab=eb(`Shield`,[[`path`,{d:`M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z`,key:`oel41y`}]]),jb=eb(`Sparkles`,[[`path`,{d:`m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z`,key:`17u4zn`}],[`path`,{d:`M5 3v4`,key:`bklmnn`}],[`path`,{d:`M19 17v4`,key:`iiml17`}],[`path`,{d:`M3 5h4`,key:`nem4j1`}],[`path`,{d:`M17 19h4`,key:`lbex7p`}]]),Mb=eb(`SquarePen`,[[`path`,{d:`M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`,key:`1m0v6g`}],[`path`,{d:`M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z`,key:`1lpok0`}]]),Nb=eb(`Trash2`,[[`path`,{d:`M3 6h18`,key:`d0wm0j`}],[`path`,{d:`M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6`,key:`4alrt4`}],[`path`,{d:`M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2`,key:`v07s0e`}],[`line`,{x1:`10`,x2:`10`,y1:`11`,y2:`17`,key:`1uufr5`}],[`line`,{x1:`14`,x2:`14`,y1:`11`,y2:`17`,key:`xtxkd`}]]),Pb=eb(`UserRound`,[[`circle`,{cx:`12`,cy:`8`,r:`5`,key:`1hypcn`}],[`path`,{d:`M20 21a8 8 0 0 0-16 0`,key:`rfgkzh`}]]),Fb=eb(`User`,[[`path`,{d:`M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2`,key:`975kel`}],[`circle`,{cx:`12`,cy:`7`,r:`4`,key:`17ys0d`}]]),Ib=eb(`Users`,[[`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`,key:`1yyitq`}],[`circle`,{cx:`9`,cy:`7`,r:`4`,key:`nufk8`}],[`path`,{d:`M22 21v-2a4 4 0 0 0-3-3.87`,key:`kshegd`}],[`path`,{d:`M16 3.13a4 4 0 0 1 0 7.75`,key:`1da9ce`}]]),Lb=eb(`Wallet2`,[[`path`,{d:`M17 14h.01`,key:`7oqj8z`}],[`path`,{d:`M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14`,key:`u1rqew`}]]),Rb=eb(`Wallet`,[[`path`,{d:`M21 12V7H5a2 2 0 0 1 0-4h14v4`,key:`195gfw`}],[`path`,{d:`M3 5v14a2 2 0 0 0 2 2h16v-5`,key:`195n9w`}],[`path`,{d:`M18 12a2 2 0 0 0 0 4h4v-4Z`,key:`vllfpd`}]]),zb=eb(`WifiOff`,[[`path`,{d:`M12 20h.01`,key:`zekei9`}],[`path`,{d:`M8.5 16.429a5 5 0 0 1 7 0`,key:`1bycff`}],[`path`,{d:`M5 12.859a10 10 0 0 1 5.17-2.69`,key:`1dl1wf`}],[`path`,{d:`M19 12.859a10 10 0 0 0-2.007-1.523`,key:`4k23kn`}],[`path`,{d:`M2 8.82a15 15 0 0 1 4.177-2.643`,key:`1grhjp`}],[`path`,{d:`M22 8.82a15 15 0 0 0-11.288-3.764`,key:`z3jwby`}],[`path`,{d:`m2 2 20 20`,key:`1ooewy`}]]),Bb=eb(`X`,[[`path`,{d:`M18 6 6 18`,key:`1bl5f8`}],[`path`,{d:`m6 6 12 12`,key:`d8bk6v`}]]);const Vb=y.createContext({railCollapsed:!1,toggleRail:()=>{}});function Hb(e){var t,n,r=``;if(typeof e==`string`||typeof e==`number`)r+=e;else if(typeof e==`object`)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=Hb(e[t]))&&(r&&(r+=` `),r+=n)}else for(n in e)e[n]&&(r&&(r+=` `),r+=n);return r}function Ub(){for(var e,t,n=0,r=``,i=arguments.length;n<i;n++)(e=arguments[n])&&(t=Hb(e))&&(r&&(r+=` `),r+=t);return r}var Wb=`-`,Gb=e=>{let t=Yb(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{let n=e.split(Wb);return n[0]===``&&n.length!==1&&n.shift(),Kb(n,t)||Jb(e)},getConflictingClassGroupIds:(e,t)=>{let i=n[e]||[];return t&&r[e]?[...i,...r[e]]:i}}},Kb=(e,t)=>{if(e.length===0)return t.classGroupId;let n=e[0],r=t.nextPart.get(n),i=r?Kb(e.slice(1),r):void 0;if(i)return i;if(t.validators.length===0)return;let a=e.join(Wb);return t.validators.find(({validator:e})=>e(a))?.classGroupId},qb=/^\[(.+)\]$/,Jb=e=>{if(qb.test(e)){let t=qb.exec(e)[1],n=t?.substring(0,t.indexOf(`:`));if(n)return`arbitrary..`+n}},Yb=e=>{let{theme:t,prefix:n}=e,r={nextPart:new Map,validators:[]};return $b(Object.entries(e.classGroups),n).forEach(([e,n])=>{Xb(n,r,e,t)}),r},Xb=(e,t,n,r)=>{e.forEach(e=>{if(typeof e==`string`){let r=e===``?t:Zb(t,e);r.classGroupId=n;return}if(typeof e==`function`){if(Qb(e)){Xb(e(r),t,n,r);return}t.validators.push({validator:e,classGroupId:n});return}Object.entries(e).forEach(([e,i])=>{Xb(i,Zb(t,e),n,r)})})},Zb=(e,t)=>{let n=e;return t.split(Wb).forEach(e=>{n.nextPart.has(e)||n.nextPart.set(e,{nextPart:new Map,validators:[]}),n=n.nextPart.get(e)}),n},Qb=e=>e.isThemeGetter,$b=(e,t)=>t?e.map(([e,n])=>{let r=n.map(e=>typeof e==`string`?t+e:typeof e==`object`?Object.fromEntries(Object.entries(e).map(([e,n])=>[t+e,n])):e);return[e,r]}):e,ex=e=>{if(e<1)return{get:()=>void 0,set:()=>{}};let t=0,n=new Map,r=new Map,i=(i,a)=>{n.set(i,a),t++,t>e&&(t=0,r=n,n=new Map)};return{get(e){let t=n.get(e);if(t!==void 0)return t;if((t=r.get(e))!==void 0)return i(e,t),t},set(e,t){n.has(e)?n.set(e,t):i(e,t)}}},tx=`!`,nx=e=>{let{separator:t,experimentalParseClassName:n}=e,r=t.length===1,i=t[0],a=t.length,o=e=>{let n=[],o=0,s=0,c;for(let l=0;l<e.length;l++){let u=e[l];if(o===0){if(u===i&&(r||e.slice(l,l+a)===t)){n.push(e.slice(s,l)),s=l+a;continue}if(u===`/`){c=l;continue}}u===`[`?o++:u===`]`&&o--}let l=n.length===0?e:e.substring(s),u=l.startsWith(tx),d=u?l.substring(1):l,f=c&&c>s?c-s:void 0;return{modifiers:n,hasImportantModifier:u,baseClassName:d,maybePostfixModifierPosition:f}};return n?e=>n({className:e,parseClassName:o}):o},rx=e=>{if(e.length<=1)return e;let t=[],n=[];return e.forEach(e=>{e[0]===`[`?(t.push(...n.sort(),e),n=[]):n.push(e)}),t.push(...n.sort()),t},ix=e=>({cache:ex(e.cacheSize),parseClassName:nx(e),...Gb(e)}),ax=/\s+/,ox=(e,t)=>{let{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i}=t,a=[],o=e.trim().split(ax),s=``;for(let e=o.length-1;e>=0;--e){let t=o[e],{modifiers:c,hasImportantModifier:l,baseClassName:u,maybePostfixModifierPosition:d}=n(t),f=!!d,p=r(f?u.substring(0,d):u);if(!p){if(!f){s=t+(s.length>0?` `+s:s);continue}if(p=r(u),!p){s=t+(s.length>0?` `+s:s);continue}f=!1}let m=rx(c).join(`:`),h=l?m+tx:m,g=h+p;if(a.includes(g))continue;a.push(g);let _=i(p,f);for(let e=0;e<_.length;++e){let t=_[e];a.push(h+t)}s=t+(s.length>0?` `+s:s)}return s};function sx(){let e=0,t,n,r=``;for(;e<arguments.length;)(t=arguments[e++])&&(n=cx(t))&&(r&&(r+=` `),r+=n);return r}var cx=e=>{if(typeof e==`string`)return e;let t,n=``;for(let r=0;r<e.length;r++)e[r]&&(t=cx(e[r]))&&(n&&(n+=` `),n+=t);return n};function lx(e,...t){let n,r,i,a=o;function o(o){let c=t.reduce((e,t)=>t(e),e());return n=ix(c),r=n.cache.get,i=n.cache.set,a=s,s(o)}function s(e){let t=r(e);if(t)return t;let a=ox(e,n);return i(e,a),a}return function(){return a(sx.apply(null,arguments))}}var ux=e=>{let t=t=>t[e]||[];return t.isThemeGetter=!0,t},dx=/^\[(?:([a-z-]+):)?(.+)\]$/i,fx=/^\d+\/\d+$/,px=new Set([`px`,`full`,`screen`]),mx=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,hx=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,gx=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,_x=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,vx=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,yx=e=>xx(e)||px.has(e)||fx.test(e),bx=e=>Px(e,`length`,Fx),xx=e=>!!e&&!Number.isNaN(Number(e)),Sx=e=>Px(e,`number`,xx),Cx=e=>!!e&&Number.isInteger(Number(e)),wx=e=>e.endsWith(`%`)&&xx(e.slice(0,-1)),Tx=e=>dx.test(e),Ex=e=>mx.test(e),Dx=new Set([`length`,`size`,`percentage`]),Ox=e=>Px(e,Dx,Ix),kx=e=>Px(e,`position`,Ix),Ax=new Set([`image`,`url`]),jx=e=>Px(e,Ax,Rx),Mx=e=>Px(e,``,Lx),Nx=()=>!0,Px=(e,t,n)=>{let r=dx.exec(e);return r?r[1]?typeof t==`string`?r[1]===t:t.has(r[1]):n(r[2]):!1},Fx=e=>hx.test(e)&&!gx.test(e),Ix=()=>!1,Lx=e=>_x.test(e),Rx=e=>vx.test(e),zx=lx(()=>{let e=ux(`colors`),t=ux(`spacing`),n=ux(`blur`),r=ux(`brightness`),i=ux(`borderColor`),a=ux(`borderRadius`),o=ux(`borderSpacing`),s=ux(`borderWidth`),c=ux(`contrast`),l=ux(`grayscale`),u=ux(`hueRotate`),d=ux(`invert`),f=ux(`gap`),p=ux(`gradientColorStops`),m=ux(`gradientColorStopPositions`),h=ux(`inset`),g=ux(`margin`),_=ux(`opacity`),v=ux(`padding`),y=ux(`saturate`),b=ux(`scale`),x=ux(`sepia`),S=ux(`skew`),C=ux(`space`),w=ux(`translate`),T=()=>[`auto`,`contain`,`none`],E=()=>[`auto`,`hidden`,`clip`,`visible`,`scroll`],D=()=>[`auto`,Tx,t],O=()=>[Tx,t],k=()=>[``,yx,bx],A=()=>[`auto`,xx,Tx],ee=()=>[`bottom`,`center`,`left`,`left-bottom`,`left-top`,`right`,`right-bottom`,`right-top`,`top`],te=()=>[`solid`,`dashed`,`dotted`,`double`,`none`],ne=()=>[`normal`,`multiply`,`screen`,`overlay`,`darken`,`lighten`,`color-dodge`,`color-burn`,`hard-light`,`soft-light`,`difference`,`exclusion`,`hue`,`saturation`,`color`,`luminosity`],j=()=>[`start`,`end`,`center`,`between`,`around`,`evenly`,`stretch`],M=()=>[``,`0`,Tx],re=()=>[`auto`,`avoid`,`all`,`avoid-page`,`page`,`left`,`right`,`column`],ie=()=>[xx,Tx];return{cacheSize:500,separator:`:`,theme:{colors:[Nx],spacing:[yx,bx],blur:[`none`,``,Ex,Tx],brightness:ie(),borderColor:[e],borderRadius:[`none`,``,`full`,Ex,Tx],borderSpacing:O(),borderWidth:k(),contrast:ie(),grayscale:M(),hueRotate:ie(),invert:M(),gap:O(),gradientColorStops:[e],gradientColorStopPositions:[wx,bx],inset:D(),margin:D(),opacity:ie(),padding:O(),saturate:ie(),scale:ie(),sepia:M(),skew:ie(),space:O(),translate:O()},classGroups:{aspect:[{aspect:[`auto`,`square`,`video`,Tx]}],container:[`container`],columns:[{columns:[Ex]}],"break-after":[{"break-after":re()}],"break-before":[{"break-before":re()}],"break-inside":[{"break-inside":[`auto`,`avoid`,`avoid-page`,`avoid-column`]}],"box-decoration":[{"box-decoration":[`slice`,`clone`]}],box:[{box:[`border`,`content`]}],display:[`block`,`inline-block`,`inline`,`flex`,`inline-flex`,`table`,`inline-table`,`table-caption`,`table-cell`,`table-column`,`table-column-group`,`table-footer-group`,`table-header-group`,`table-row-group`,`table-row`,`flow-root`,`grid`,`inline-grid`,`contents`,`list-item`,`hidden`],float:[{float:[`right`,`left`,`none`,`start`,`end`]}],clear:[{clear:[`left`,`right`,`both`,`none`,`start`,`end`]}],isolation:[`isolate`,`isolation-auto`],"object-fit":[{object:[`contain`,`cover`,`fill`,`none`,`scale-down`]}],"object-position":[{object:[...ee(),Tx]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:T()}],"overscroll-x":[{"overscroll-x":T()}],"overscroll-y":[{"overscroll-y":T()}],position:[`static`,`fixed`,`absolute`,`relative`,`sticky`],inset:[{inset:[h]}],"inset-x":[{"inset-x":[h]}],"inset-y":[{"inset-y":[h]}],start:[{start:[h]}],end:[{end:[h]}],top:[{top:[h]}],right:[{right:[h]}],bottom:[{bottom:[h]}],left:[{left:[h]}],visibility:[`visible`,`invisible`,`collapse`],z:[{z:[`auto`,Cx,Tx]}],basis:[{basis:D()}],"flex-direction":[{flex:[`row`,`row-reverse`,`col`,`col-reverse`]}],"flex-wrap":[{flex:[`wrap`,`wrap-reverse`,`nowrap`]}],flex:[{flex:[`1`,`auto`,`initial`,`none`,Tx]}],grow:[{grow:M()}],shrink:[{shrink:M()}],order:[{order:[`first`,`last`,`none`,Cx,Tx]}],"grid-cols":[{"grid-cols":[Nx]}],"col-start-end":[{col:[`auto`,{span:[`full`,Cx,Tx]},Tx]}],"col-start":[{"col-start":A()}],"col-end":[{"col-end":A()}],"grid-rows":[{"grid-rows":[Nx]}],"row-start-end":[{row:[`auto`,{span:[Cx,Tx]},Tx]}],"row-start":[{"row-start":A()}],"row-end":[{"row-end":A()}],"grid-flow":[{"grid-flow":[`row`,`col`,`dense`,`row-dense`,`col-dense`]}],"auto-cols":[{"auto-cols":[`auto`,`min`,`max`,`fr`,Tx]}],"auto-rows":[{"auto-rows":[`auto`,`min`,`max`,`fr`,Tx]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:[`normal`,...j()]}],"justify-items":[{"justify-items":[`start`,`end`,`center`,`stretch`]}],"justify-self":[{"justify-self":[`auto`,`start`,`end`,`center`,`stretch`]}],"align-content":[{content:[`normal`,...j(),`baseline`]}],"align-items":[{items:[`start`,`end`,`center`,`baseline`,`stretch`]}],"align-self":[{self:[`auto`,`start`,`end`,`center`,`stretch`,`baseline`]}],"place-content":[{"place-content":[...j(),`baseline`]}],"place-items":[{"place-items":[`start`,`end`,`center`,`baseline`,`stretch`]}],"place-self":[{"place-self":[`auto`,`start`,`end`,`center`,`stretch`]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[C]}],"space-x-reverse":[`space-x-reverse`],"space-y":[{"space-y":[C]}],"space-y-reverse":[`space-y-reverse`],w:[{w:[`auto`,`min`,`max`,`fit`,`svw`,`lvw`,`dvw`,Tx,t]}],"min-w":[{"min-w":[Tx,t,`min`,`max`,`fit`]}],"max-w":[{"max-w":[Tx,t,`none`,`full`,`min`,`max`,`fit`,`prose`,{screen:[Ex]},Ex]}],h:[{h:[Tx,t,`auto`,`min`,`max`,`fit`,`svh`,`lvh`,`dvh`]}],"min-h":[{"min-h":[Tx,t,`min`,`max`,`fit`,`svh`,`lvh`,`dvh`]}],"max-h":[{"max-h":[Tx,t,`min`,`max`,`fit`,`svh`,`lvh`,`dvh`]}],size:[{size:[Tx,t,`auto`,`min`,`max`,`fit`]}],"font-size":[{text:[`base`,Ex,bx]}],"font-smoothing":[`antialiased`,`subpixel-antialiased`],"font-style":[`italic`,`not-italic`],"font-weight":[{font:[`thin`,`extralight`,`light`,`normal`,`medium`,`semibold`,`bold`,`extrabold`,`black`,Sx]}],"font-family":[{font:[Nx]}],"fvn-normal":[`normal-nums`],"fvn-ordinal":[`ordinal`],"fvn-slashed-zero":[`slashed-zero`],"fvn-figure":[`lining-nums`,`oldstyle-nums`],"fvn-spacing":[`proportional-nums`,`tabular-nums`],"fvn-fraction":[`diagonal-fractions`,`stacked-fractions`],tracking:[{tracking:[`tighter`,`tight`,`normal`,`wide`,`wider`,`widest`,Tx]}],"line-clamp":[{"line-clamp":[`none`,xx,Sx]}],leading:[{leading:[`none`,`tight`,`snug`,`normal`,`relaxed`,`loose`,yx,Tx]}],"list-image":[{"list-image":[`none`,Tx]}],"list-style-type":[{list:[`none`,`disc`,`decimal`,Tx]}],"list-style-position":[{list:[`inside`,`outside`]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[_]}],"text-alignment":[{text:[`left`,`center`,`right`,`justify`,`start`,`end`]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[_]}],"text-decoration":[`underline`,`overline`,`line-through`,`no-underline`],"text-decoration-style":[{decoration:[...te(),`wavy`]}],"text-decoration-thickness":[{decoration:[`auto`,`from-font`,yx,bx]}],"underline-offset":[{"underline-offset":[`auto`,yx,Tx]}],"text-decoration-color":[{decoration:[e]}],"text-transform":[`uppercase`,`lowercase`,`capitalize`,`normal-case`],"text-overflow":[`truncate`,`text-ellipsis`,`text-clip`],"text-wrap":[{text:[`wrap`,`nowrap`,`balance`,`pretty`]}],indent:[{indent:O()}],"vertical-align":[{align:[`baseline`,`top`,`middle`,`bottom`,`text-top`,`text-bottom`,`sub`,`super`,Tx]}],whitespace:[{whitespace:[`normal`,`nowrap`,`pre`,`pre-line`,`pre-wrap`,`break-spaces`]}],break:[{break:[`normal`,`words`,`all`,`keep`]}],hyphens:[{hyphens:[`none`,`manual`,`auto`]}],content:[{content:[`none`,Tx]}],"bg-attachment":[{bg:[`fixed`,`local`,`scroll`]}],"bg-clip":[{"bg-clip":[`border`,`padding`,`content`,`text`]}],"bg-opacity":[{"bg-opacity":[_]}],"bg-origin":[{"bg-origin":[`border`,`padding`,`content`]}],"bg-position":[{bg:[...ee(),kx]}],"bg-repeat":[{bg:[`no-repeat`,{repeat:[``,`x`,`y`,`round`,`space`]}]}],"bg-size":[{bg:[`auto`,`cover`,`contain`,Ox]}],"bg-image":[{bg:[`none`,{"gradient-to":[`t`,`tr`,`r`,`br`,`b`,`bl`,`l`,`tl`]},jx]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[_]}],"border-style":[{border:[...te(),`hidden`]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":[`divide-x-reverse`],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":[`divide-y-reverse`],"divide-opacity":[{"divide-opacity":[_]}],"divide-style":[{divide:te()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:[``,...te()]}],"outline-offset":[{"outline-offset":[yx,Tx]}],"outline-w":[{outline:[yx,bx]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:k()}],"ring-w-inset":[`ring-inset`],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[_]}],"ring-offset-w":[{"ring-offset":[yx,bx]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:[``,`inner`,`none`,Ex,Mx]}],"shadow-color":[{shadow:[Nx]}],opacity:[{opacity:[_]}],"mix-blend":[{"mix-blend":[...ne(),`plus-lighter`,`plus-darker`]}],"bg-blend":[{"bg-blend":ne()}],filter:[{filter:[``,`none`]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":[``,`none`,Ex,Tx]}],grayscale:[{grayscale:[l]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[y]}],sepia:[{sepia:[x]}],"backdrop-filter":[{"backdrop-filter":[``,`none`]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[l]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[_]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[x]}],"border-collapse":[{border:[`collapse`,`separate`]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:[`auto`,`fixed`]}],caption:[{caption:[`top`,`bottom`]}],transition:[{transition:[`none`,`all`,``,`colors`,`opacity`,`shadow`,`transform`,Tx]}],duration:[{duration:ie()}],ease:[{ease:[`linear`,`in`,`out`,`in-out`,Tx]}],delay:[{delay:ie()}],animate:[{animate:[`none`,`spin`,`ping`,`pulse`,`bounce`,Tx]}],transform:[{transform:[``,`gpu`,`none`]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Cx,Tx]}],"translate-x":[{"translate-x":[w]}],"translate-y":[{"translate-y":[w]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:[`center`,`top`,`top-right`,`right`,`bottom-right`,`bottom`,`bottom-left`,`left`,`top-left`,Tx]}],accent:[{accent:[`auto`,e]}],appearance:[{appearance:[`none`,`auto`]}],cursor:[{cursor:[`auto`,`default`,`pointer`,`wait`,`text`,`move`,`help`,`not-allowed`,`none`,`context-menu`,`progress`,`cell`,`crosshair`,`vertical-text`,`alias`,`copy`,`no-drop`,`grab`,`grabbing`,`all-scroll`,`col-resize`,`row-resize`,`n-resize`,`e-resize`,`s-resize`,`w-resize`,`ne-resize`,`nw-resize`,`se-resize`,`sw-resize`,`ew-resize`,`ns-resize`,`nesw-resize`,`nwse-resize`,`zoom-in`,`zoom-out`,Tx]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":[`none`,`auto`]}],resize:[{resize:[`none`,`y`,`x`,``]}],"scroll-behavior":[{scroll:[`auto`,`smooth`]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:[`start`,`end`,`center`,`align-none`]}],"snap-stop":[{snap:[`normal`,`always`]}],"snap-type":[{snap:[`none`,`x`,`y`,`both`]}],"snap-strictness":[{snap:[`mandatory`,`proximity`]}],touch:[{touch:[`auto`,`none`,`manipulation`]}],"touch-x":[{"touch-pan":[`x`,`left`,`right`]}],"touch-y":[{"touch-pan":[`y`,`up`,`down`]}],"touch-pz":[`touch-pinch-zoom`],select:[{select:[`none`,`text`,`all`,`auto`]}],"will-change":[{"will-change":[`auto`,`scroll`,`contents`,`transform`,Tx]}],fill:[{fill:[e,`none`]}],"stroke-w":[{stroke:[yx,bx,Sx]}],stroke:[{stroke:[e,`none`]}],sr:[`sr-only`,`not-sr-only`],"forced-color-adjust":[{"forced-color-adjust":[`auto`,`none`]}]},conflictingClassGroups:{overflow:[`overflow-x`,`overflow-y`],overscroll:[`overscroll-x`,`overscroll-y`],inset:[`inset-x`,`inset-y`,`start`,`end`,`top`,`right`,`bottom`,`left`],"inset-x":[`right`,`left`],"inset-y":[`top`,`bottom`],flex:[`basis`,`grow`,`shrink`],gap:[`gap-x`,`gap-y`],p:[`px`,`py`,`ps`,`pe`,`pt`,`pr`,`pb`,`pl`],px:[`pr`,`pl`],py:[`pt`,`pb`],m:[`mx`,`my`,`ms`,`me`,`mt`,`mr`,`mb`,`ml`],mx:[`mr`,`ml`],my:[`mt`,`mb`],size:[`w`,`h`],"font-size":[`leading`],"fvn-normal":[`fvn-ordinal`,`fvn-slashed-zero`,`fvn-figure`,`fvn-spacing`,`fvn-fraction`],"fvn-ordinal":[`fvn-normal`],"fvn-slashed-zero":[`fvn-normal`],"fvn-figure":[`fvn-normal`],"fvn-spacing":[`fvn-normal`],"fvn-fraction":[`fvn-normal`],"line-clamp":[`display`,`overflow`],rounded:[`rounded-s`,`rounded-e`,`rounded-t`,`rounded-r`,`rounded-b`,`rounded-l`,`rounded-ss`,`rounded-se`,`rounded-ee`,`rounded-es`,`rounded-tl`,`rounded-tr`,`rounded-br`,`rounded-bl`],"rounded-s":[`rounded-ss`,`rounded-es`],"rounded-e":[`rounded-se`,`rounded-ee`],"rounded-t":[`rounded-tl`,`rounded-tr`],"rounded-r":[`rounded-tr`,`rounded-br`],"rounded-b":[`rounded-br`,`rounded-bl`],"rounded-l":[`rounded-tl`,`rounded-bl`],"border-spacing":[`border-spacing-x`,`border-spacing-y`],"border-w":[`border-w-s`,`border-w-e`,`border-w-t`,`border-w-r`,`border-w-b`,`border-w-l`],"border-w-x":[`border-w-r`,`border-w-l`],"border-w-y":[`border-w-t`,`border-w-b`],"border-color":[`border-color-s`,`border-color-e`,`border-color-t`,`border-color-r`,`border-color-b`,`border-color-l`],"border-color-x":[`border-color-r`,`border-color-l`],"border-color-y":[`border-color-t`,`border-color-b`],"scroll-m":[`scroll-mx`,`scroll-my`,`scroll-ms`,`scroll-me`,`scroll-mt`,`scroll-mr`,`scroll-mb`,`scroll-ml`],"scroll-mx":[`scroll-mr`,`scroll-ml`],"scroll-my":[`scroll-mt`,`scroll-mb`],"scroll-p":[`scroll-px`,`scroll-py`,`scroll-ps`,`scroll-pe`,`scroll-pt`,`scroll-pr`,`scroll-pb`,`scroll-pl`],"scroll-px":[`scroll-pr`,`scroll-pl`],"scroll-py":[`scroll-pt`,`scroll-pb`],touch:[`touch-x`,`touch-y`,`touch-pz`],"touch-x":[`touch`],"touch-y":[`touch`],"touch-pz":[`touch`]},conflictingClassGroupModifiers:{"font-size":[`leading`]}}});function Q(...e){return zx(Ub(e))}function Bx(e,t=16){if(typeof e!=`string`)return``;if(e.length<=t)return e;let n=Math.floor(t/2)-1,r=e.slice(0,n+1),i=e.slice(-n);return`${r}${i}`}function Vx(e){if(!e)throw Error(`base64url string required`);let t=e.replace(/-/g,`+`).replace(/_/g,`/`);for(;t.length%4;)t+=`=`;return atob(t)}var Hx={disconnected:`border-destructive/30 bg-destructive/10 text-destructive`,loading:`border-amber-300 bg-amber-50 text-amber-700 dark:border-amber-500 dark:bg-amber-900/20 dark:text-amber-200`,connected:`border-emerald-300 bg-emerald-50 text-emerald-700 dark:border-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-200`};function Ux(){let{isConnected:e,walletType:t,identityKey:n,network:r,isLoading:i}=Yy(),a=`disconnected`,o=`Disconnected`;i?(a=`loading`,o=`Connecting`):e&&(a=`connected`,o=`Connected${t?`  ${t}`:``}`);let s=i?xb:e?Rb:zb;return(0,Z.jsxs)(`div`,{className:Q(`inline-flex min-w-[220px] items-center gap-3 rounded-lg border px-3 py-2 text-sm shadow-sm transition-colors`,Hx[a]),children:[(0,Z.jsx)(s,{className:Q(`h-4 w-4`,i&&`animate-spin`)}),(0,Z.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Z.jsx)(`span`,{className:`font-medium leading-tight text-foreground`,children:o}),(0,Z.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:n?`${n.slice(0,8)}${n.slice(-6)}`:`Wallet approval required`}),r&&(0,Z.jsx)(`span`,{className:`text-[11px] uppercase tracking-wide text-muted-foreground/70`,children:r})]})]})}function Wx(e,t){if(typeof e==`function`)return e(t);e!=null&&(e.current=t)}function Gx(...e){return t=>{let n=!1,r=e.map(e=>{let r=Wx(e,t);return!n&&typeof r==`function`&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){let n=r[t];typeof n==`function`?n():Wx(e[t],null)}}}}function Kx(...e){return y.useCallback(Gx(...e),e)}function qx(e){let t=Yx(e),n=y.forwardRef((e,n)=>{let{children:r,...i}=e,a=y.Children.toArray(r),o=a.find(Qx);if(o){let e=o.props.children,r=a.map(t=>t===o?y.Children.count(e)>1?y.Children.only(null):y.isValidElement(e)?e.props.children:null:t);return(0,Z.jsx)(t,{...i,ref:n,children:y.isValidElement(e)?y.cloneElement(e,void 0,r):null})}return(0,Z.jsx)(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}var Jx=qx(`Slot`);function Yx(e){let t=y.forwardRef((e,t)=>{let{children:n,...r}=e;if(y.isValidElement(n)){let e=eS(n),i=$x(r,n.props);return n.type!==y.Fragment&&(i.ref=t?Gx(t,e):e),y.cloneElement(n,i)}return y.Children.count(n)>1?y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Xx=Symbol(`radix.slottable`);function Zx(e){let t=({children:e})=>(0,Z.jsx)(Z.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=Xx,t}function Qx(e){return y.isValidElement(e)&&typeof e.type==`function`&&`__radixId`in e.type&&e.type.__radixId===Xx}function $x(e,t){let n={...t};for(let r in t){let i=e[r],a=t[r];/^on[A-Z]/.test(r)?i&&a?n[r]=(...e)=>{let t=a(...e);return i(...e),t}:i&&(n[r]=i):r===`style`?n[r]={...i,...a}:r===`className`&&(n[r]=[i,a].filter(Boolean).join(` `))}return{...e,...n}}function eS(e){let t=Object.getOwnPropertyDescriptor(e.props,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var tS=e=>typeof e==`boolean`?`${e}`:e===0?`0`:e;const nS=Ub,rS=(e,t)=>n=>{if(t?.variants==null)return nS(e,n?.class,n?.className);let{variants:r,defaultVariants:i}=t,a=Object.keys(r).map(e=>{let t=n?.[e],a=i?.[e];if(t===null)return null;let o=tS(t)||tS(a);return r[e][o]}),o=n&&Object.entries(n).reduce((e,t)=>{let[n,r]=t;return r===void 0||(e[n]=r),e},{}),s=t?.compoundVariants?.reduce((e,t)=>{let{class:n,className:r,...a}=t;return Object.entries(a).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...i,...o}[t]):{...i,...o}[t]===n})?[...e,n,r]:e},[]);return nS(e,a,s,n?.class,n?.className)};var iS=rS(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0`,{variants:{variant:{default:`bg-primary text-primary-foreground shadow hover:bg-primary/90`,destructive:`bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90`,outline:`border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground`,secondary:`bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-9 px-4 py-2`,sm:`h-8 rounded-md px-3 text-xs`,lg:`h-10 rounded-md px-8`,icon:`h-9 w-9`}},defaultVariants:{variant:`default`,size:`default`}}),$=y.forwardRef(({className:e,variant:t,size:n,asChild:r=!1,...i},a)=>(0,Z.jsx)(r?Jx:`button`,{className:Q(iS({variant:t,size:n,className:e})),ref:a,...i}));$.displayName=`Button`,typeof window<`u`&&window.document&&window.document.createElement;function aS(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e?.(r),n===!1||!r.defaultPrevented)return t?.(r)}}function oS(e,t){let n=y.createContext(t),r=e=>{let{children:t,...r}=e,i=y.useMemo(()=>r,Object.values(r));return(0,Z.jsx)(n.Provider,{value:i,children:t})};r.displayName=e+`Provider`;function i(r){let i=y.useContext(n);if(i)return i;if(t!==void 0)return t;throw Error(`\`${r}\` must be used within \`${e}\``)}return[r,i]}function sS(e,t=[]){let n=[];function r(t,r){let i=y.createContext(r),a=n.length;n=[...n,r];let o=t=>{let{scope:n,children:r,...o}=t,s=n?.[e]?.[a]||i,c=y.useMemo(()=>o,Object.values(o));return(0,Z.jsx)(s.Provider,{value:c,children:r})};o.displayName=t+`Provider`;function s(n,o){let s=o?.[e]?.[a]||i,c=y.useContext(s);if(c)return c;if(r!==void 0)return r;throw Error(`\`${n}\` must be used within \`${t}\``)}return[o,s]}let i=()=>{let t=n.map(e=>y.createContext(e));return function(n){let r=n?.[e]||t;return y.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return i.scopeName=e,[r,cS(i,...t)]}function cS(...e){let t=e[0];if(e.length===1)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return y.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var lS=globalThis?.document?y.useLayoutEffect:()=>{},uS=y.useId||(()=>void 0),dS=0;function fS(e){let[t,n]=y.useState(uS());return lS(()=>{e||n(e=>e??String(dS++))},[e]),e||(t?`radix-${t}`:``)}var pS=y.useInsertionEffect||lS;function mS({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){let[i,a,o]=hS({defaultProp:t,onChange:n}),s=e!==void 0,c=s?e:i;{let t=y.useRef(e!==void 0);y.useEffect(()=>{let e=t.current;if(e!==s){let t=e?`controlled`:`uncontrolled`,n=s?`controlled`:`uncontrolled`;console.warn(`${r} is changing from ${t} to ${n}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=s},[s,r])}let l=y.useCallback(t=>{if(s){let n=gS(t)?t(e):t;n!==e&&o.current?.(n)}else a(t)},[s,e,a,o]);return[c,l]}function hS({defaultProp:e,onChange:t}){let[n,r]=y.useState(e),i=y.useRef(n),a=y.useRef(t);return pS(()=>{a.current=t},[t]),y.useEffect(()=>{i.current!==n&&(a.current?.(n),i.current=n)},[n,i]),[n,r,a]}function gS(e){return typeof e==`function`}var _S=l(g(),1),vS=[`a`,`button`,`div`,`form`,`h2`,`h3`,`img`,`input`,`label`,`li`,`nav`,`ol`,`p`,`select`,`span`,`svg`,`ul`].reduce((e,t)=>{let n=qx(`Primitive.${t}`),r=y.forwardRef((e,r)=>{let{asChild:i,...a}=e,o=i?n:t;return typeof window<`u`&&(window[Symbol.for(`radix-ui`)]=!0),(0,Z.jsx)(o,{...a,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function yS(e,t){e&&_S.flushSync(()=>e.dispatchEvent(t))}function bS(e){let t=y.useRef(e);return y.useEffect(()=>{t.current=e}),y.useMemo(()=>(...e)=>t.current?.(...e),[])}function xS(e,t=globalThis?.document){let n=bS(e);y.useEffect(()=>{let e=e=>{e.key===`Escape`&&n(e)};return t.addEventListener(`keydown`,e,{capture:!0}),()=>t.removeEventListener(`keydown`,e,{capture:!0})},[n,t])}var SS=`DismissableLayer`,CS=`dismissableLayer.update`,wS=`dismissableLayer.pointerDownOutside`,TS=`dismissableLayer.focusOutside`,ES,DS=y.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),OS=y.forwardRef((e,t)=>{let{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:a,onInteractOutside:o,onDismiss:s,...c}=e,l=y.useContext(DS),[u,d]=y.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=y.useState({}),m=Kx(t,e=>d(e)),h=Array.from(l.layers),[g]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),_=h.indexOf(g),v=u?h.indexOf(u):-1,b=l.layersWithOutsidePointerEventsDisabled.size>0,x=v>=_,S=jS(e=>{let t=e.target,n=[...l.branches].some(e=>e.contains(t));!x||n||(i?.(e),o?.(e),e.defaultPrevented||s?.())},f),C=MS(e=>{let t=e.target;[...l.branches].some(e=>e.contains(t))||(a?.(e),o?.(e),e.defaultPrevented||s?.())},f);return xS(e=>{v===l.layers.size-1&&(r?.(e),!e.defaultPrevented&&s&&(e.preventDefault(),s()))},f),y.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(ES=f.body.style.pointerEvents,f.body.style.pointerEvents=`none`),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),NS(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=ES)}},[u,f,n,l]),y.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),NS())},[u,l]),y.useEffect(()=>{let e=()=>p({});return document.addEventListener(CS,e),()=>document.removeEventListener(CS,e)},[]),(0,Z.jsx)(vS.div,{...c,ref:m,style:{pointerEvents:b?x?`auto`:`none`:void 0,...e.style},onFocusCapture:aS(e.onFocusCapture,C.onFocusCapture),onBlurCapture:aS(e.onBlurCapture,C.onBlurCapture),onPointerDownCapture:aS(e.onPointerDownCapture,S.onPointerDownCapture)})});OS.displayName=SS;var kS=`DismissableLayerBranch`,AS=y.forwardRef((e,t)=>{let n=y.useContext(DS),r=y.useRef(null),i=Kx(t,r);return y.useEffect(()=>{let e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),(0,Z.jsx)(vS.div,{...e,ref:i})});AS.displayName=kS;function jS(e,t=globalThis?.document){let n=bS(e),r=y.useRef(!1),i=y.useRef(()=>{});return y.useEffect(()=>{let e=e=>{if(e.target&&!r.current){let r=function(){PS(wS,n,a,{discrete:!0})},a={originalEvent:e};e.pointerType===`touch`?(t.removeEventListener(`click`,i.current),i.current=r,t.addEventListener(`click`,i.current,{once:!0})):r()}else t.removeEventListener(`click`,i.current);r.current=!1},a=window.setTimeout(()=>{t.addEventListener(`pointerdown`,e)},0);return()=>{window.clearTimeout(a),t.removeEventListener(`pointerdown`,e),t.removeEventListener(`click`,i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function MS(e,t=globalThis?.document){let n=bS(e),r=y.useRef(!1);return y.useEffect(()=>{let e=e=>{e.target&&!r.current&&PS(TS,n,{originalEvent:e},{discrete:!1})};return t.addEventListener(`focusin`,e),()=>t.removeEventListener(`focusin`,e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function NS(){let e=new CustomEvent(CS);document.dispatchEvent(e)}function PS(e,t,n,{discrete:r}){let i=n.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?yS(i,a):i.dispatchEvent(a)}var FS=`focusScope.autoFocusOnMount`,IS=`focusScope.autoFocusOnUnmount`,LS={bubbles:!1,cancelable:!0},RS=`FocusScope`,zS=y.forwardRef((e,t)=>{let{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:a,...o}=e,[s,c]=y.useState(null),l=bS(i),u=bS(a),d=y.useRef(null),f=Kx(t,e=>c(e)),p=y.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;y.useEffect(()=>{if(r){let e=function(e){if(p.paused||!s)return;let t=e.target;s.contains(t)?d.current=t:KS(d.current,{select:!0})},t=function(e){if(p.paused||!s)return;let t=e.relatedTarget;t!==null&&(s.contains(t)||KS(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&KS(s)};document.addEventListener(`focusin`,e),document.addEventListener(`focusout`,t);let r=new MutationObserver(n);return s&&r.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener(`focusin`,e),document.removeEventListener(`focusout`,t),r.disconnect()}}},[r,s,p.paused]),y.useEffect(()=>{if(s){qS.add(p);let e=document.activeElement;if(!s.contains(e)){let t=new CustomEvent(FS,LS);s.addEventListener(FS,l),s.dispatchEvent(t),t.defaultPrevented||(BS(XS(HS(s)),{select:!0}),document.activeElement===e&&KS(s))}return()=>{s.removeEventListener(FS,l),setTimeout(()=>{let t=new CustomEvent(IS,LS);s.addEventListener(IS,u),s.dispatchEvent(t),t.defaultPrevented||KS(e??document.body,{select:!0}),s.removeEventListener(IS,u),qS.remove(p)},0)}}},[s,l,u,p]);let m=y.useCallback(e=>{if(!n&&!r||p.paused)return;let t=e.key===`Tab`&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){let t=e.currentTarget,[r,a]=VS(t);r&&a?!e.shiftKey&&i===a?(e.preventDefault(),n&&KS(r,{select:!0})):e.shiftKey&&i===r&&(e.preventDefault(),n&&KS(a,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return(0,Z.jsx)(vS.div,{tabIndex:-1,...o,ref:f,onKeyDown:m})});zS.displayName=RS;function BS(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if(KS(r,{select:t}),document.activeElement!==n)return}function VS(e){let t=HS(e),n=US(t,e),r=US(t.reverse(),e);return[n,r]}function HS(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t=e.tagName===`INPUT`&&e.type===`hidden`;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function US(e,t){for(let n of e)if(!WS(n,{upTo:t}))return n}function WS(e,{upTo:t}){if(getComputedStyle(e).visibility===`hidden`)return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display===`none`)return!0;e=e.parentElement}return!1}function GS(e){return e instanceof HTMLInputElement&&`select`in e}function KS(e,{select:t=!1}={}){if(e&&e.focus){let n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&GS(e)&&t&&e.select()}}var qS=JS();function JS(){let e=[];return{add(t){let n=e[0];t!==n&&n?.pause(),e=YS(e,t),e.unshift(t)},remove(t){e=YS(e,t),e[0]?.resume()}}}function YS(e,t){let n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function XS(e){return e.filter(e=>e.tagName!==`A`)}var ZS=l(g(),1),QS=`Portal`,$S=y.forwardRef((e,t)=>{let{container:n,...r}=e,[i,a]=y.useState(!1);lS(()=>a(!0),[]);let o=n||i&&globalThis?.document?.body;return o?ZS.createPortal((0,Z.jsx)(vS.div,{...r,ref:t}),o):null});$S.displayName=QS;function eC(e,t){return y.useReducer((e,n)=>t[e][n]??e,e)}var tC=e=>{let{present:t,children:n}=e,r=nC(t),i=typeof n==`function`?n({present:r.isPresent}):y.Children.only(n),a=Kx(r.ref,iC(i));return typeof n==`function`||r.isPresent?y.cloneElement(i,{ref:a}):null};tC.displayName=`Presence`;function nC(e){let[t,n]=y.useState(),r=y.useRef(null),i=y.useRef(e),a=y.useRef(`none`),[o,s]=eC(e?`mounted`:`unmounted`,{mounted:{UNMOUNT:`unmounted`,ANIMATION_OUT:`unmountSuspended`},unmountSuspended:{MOUNT:`mounted`,ANIMATION_END:`unmounted`},unmounted:{MOUNT:`mounted`}});return y.useEffect(()=>{let e=rC(r.current);a.current=o===`mounted`?e:`none`},[o]),lS(()=>{let t=r.current,n=i.current;if(n!==e){let r=a.current,o=rC(t);e?s(`MOUNT`):o===`none`||t?.display===`none`?s(`UNMOUNT`):s(n&&r!==o?`ANIMATION_OUT`:`UNMOUNT`),i.current=e}},[e,s]),lS(()=>{if(t){let e,n=t.ownerDocument.defaultView??window,o=a=>{let o=rC(r.current).includes(CSS.escape(a.animationName));if(a.target===t&&o&&(s(`ANIMATION_END`),!i.current)){let r=t.style.animationFillMode;t.style.animationFillMode=`forwards`,e=n.setTimeout(()=>{t.style.animationFillMode===`forwards`&&(t.style.animationFillMode=r)})}},c=e=>{e.target===t&&(a.current=rC(r.current))};return t.addEventListener(`animationstart`,c),t.addEventListener(`animationcancel`,o),t.addEventListener(`animationend`,o),()=>{n.clearTimeout(e),t.removeEventListener(`animationstart`,c),t.removeEventListener(`animationcancel`,o),t.removeEventListener(`animationend`,o)}}else s(`ANIMATION_END`)},[t,s]),{isPresent:[`mounted`,`unmountSuspended`].includes(o),ref:y.useCallback(e=>{r.current=e?getComputedStyle(e):null,n(e)},[])}}function rC(e){return e?.animationName||`none`}function iC(e){let t=Object.getOwnPropertyDescriptor(e.props,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var aC=0;function oC(){y.useEffect(()=>{let e=document.querySelectorAll(`[data-radix-focus-guard]`);return document.body.insertAdjacentElement(`afterbegin`,e[0]??sC()),document.body.insertAdjacentElement(`beforeend`,e[1]??sC()),aC++,()=>{aC===1&&document.querySelectorAll(`[data-radix-focus-guard]`).forEach(e=>e.remove()),aC--}},[])}function sC(){let e=document.createElement(`span`);return e.setAttribute(`data-radix-focus-guard`,``),e.tabIndex=0,e.style.outline=`none`,e.style.opacity=`0`,e.style.position=`fixed`,e.style.pointerEvents=`none`,e}var cC=function(){return cC=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},cC.apply(this,arguments)};function lC(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function uC(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var dC=`right-scroll-bar-position`,fC=`width-before-scroll-bar`,pC=`with-scroll-bars-hidden`,mC=`--removed-body-scroll-bar-size`;function hC(e,t){return typeof e==`function`?e(t):e&&(e.current=t),e}function gC(e,t){var n=(0,y.useState)(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(e){var t=n.value;t!==e&&(n.value=e,n.callback(e,t))}}}})[0];return n.callback=t,n.facade}var _C=typeof window<`u`?y.useLayoutEffect:y.useEffect,vC=new WeakMap;function yC(e,t){var n=gC(t||null,function(t){return e.forEach(function(e){return hC(e,t)})});return _C(function(){var t=vC.get(n);if(t){var r=new Set(t),i=new Set(e),a=n.current;r.forEach(function(e){i.has(e)||hC(e,null)}),i.forEach(function(e){r.has(e)||hC(e,a)})}vC.set(n,e)},[e]),n}function bC(e){return e}function xC(e,t){t===void 0&&(t=bC);var n=[],r=!1;return{read:function(){if(r)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var a=function(){var n=t;t=[],n.forEach(e)},o=function(){return Promise.resolve().then(a)};o(),n={push:function(e){t.push(e),o()},filter:function(e){return t=t.filter(e),n}}}}}function SC(e){e===void 0&&(e={});var t=xC(null);return t.options=cC({async:!0,ssr:!1},e),t}var CC=function(e){var t=e.sideCar,n=lC(e,[`sideCar`]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw Error(`Sidecar medium not found`);return y.createElement(r,cC({},n))};CC.isSideCarExport=!0;function wC(e,t){return e.useMedium(t),CC}var TC=SC(),EC=function(){},DC=y.forwardRef(function(e,t){var n=y.useRef(null),r=y.useState({onScrollCapture:EC,onWheelCapture:EC,onTouchMoveCapture:EC}),i=r[0],a=r[1],o=e.forwardProps,s=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,f=e.sideCar,p=e.noRelative,m=e.noIsolation,h=e.inert,g=e.allowPinchZoom,_=e.as,v=_===void 0?`div`:_,b=e.gapMode,x=lC(e,[`forwardProps`,`children`,`className`,`removeScrollBar`,`enabled`,`shards`,`sideCar`,`noRelative`,`noIsolation`,`inert`,`allowPinchZoom`,`as`,`gapMode`]),S=f,C=yC([n,t]),w=cC(cC({},x),i);return y.createElement(y.Fragment,null,u&&y.createElement(S,{sideCar:TC,removeScrollBar:l,shards:d,noRelative:p,noIsolation:m,inert:h,setCallbacks:a,allowPinchZoom:!!g,lockRef:n,gapMode:b}),o?y.cloneElement(y.Children.only(s),cC(cC({},w),{ref:C})):y.createElement(v,cC({},w,{className:c,ref:C}),s))});DC.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},DC.classNames={fullWidth:fC,zeroRight:dC};var OC,kC=function(){if(OC)return OC;if(typeof __webpack_nonce__<`u`)return __webpack_nonce__};function AC(){if(!document)return null;var e=document.createElement(`style`);e.type=`text/css`;var t=kC();return t&&e.setAttribute(`nonce`,t),e}function jC(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function MC(e){(document.head||document.getElementsByTagName(`head`)[0]).appendChild(e)}var NC=function(){var e=0,t=null;return{add:function(n){e==0&&(t=AC())&&(jC(t,n),MC(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},PC=function(){var e=NC();return function(t,n){y.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},FC=function(){var e=PC();return function(t){var n=t.styles,r=t.dynamic;return e(n,r),null}},IC={left:0,top:0,right:0,gap:0},LC=function(e){return parseInt(e||``,10)||0},RC=function(e){var t=window.getComputedStyle(document.body),n=t[e===`padding`?`paddingLeft`:`marginLeft`],r=t[e===`padding`?`paddingTop`:`marginTop`],i=t[e===`padding`?`paddingRight`:`marginRight`];return[LC(n),LC(r),LC(i)]},zC=function(e){if(e===void 0&&(e=`margin`),typeof window>`u`)return IC;var t=RC(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},BC=FC(),VC=`data-scroll-locked`,HC=function(e,t,n,r){var i=e.left,a=e.top,o=e.right,s=e.gap;return n===void 0&&(n=`margin`),`
  .${pC} {
   overflow: hidden ${r};
   padding-right: ${s}px ${r};
  }
  body[${VC}] {
    overflow: hidden ${r};
    overscroll-behavior: contain;
    ${[t&&`position: relative ${r};`,n===`margin`&&`
    padding-left: ${i}px;
    padding-top: ${a}px;
    padding-right: ${o}px;
    margin-left:0;
    margin-top:0;
    margin-right: ${s}px ${r};
    `,n===`padding`&&`padding-right: ${s}px ${r};`].filter(Boolean).join(``)}
  }
  
  .${dC} {
    right: ${s}px ${r};
  }
  
  .${fC} {
    margin-right: ${s}px ${r};
  }
  
  .${dC} .${dC} {
    right: 0 ${r};
  }
  
  .${fC} .${fC} {
    margin-right: 0 ${r};
  }
  
  body[${VC}] {
    ${mC}: ${s}px;
  }
`},UC=function(){var e=parseInt(document.body.getAttribute(`data-scroll-locked`)||`0`,10);return isFinite(e)?e:0},WC=function(){y.useEffect(function(){return document.body.setAttribute(VC,(UC()+1).toString()),function(){var e=UC()-1;e<=0?document.body.removeAttribute(VC):document.body.setAttribute(VC,e.toString())}},[])},GC=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=r===void 0?`margin`:r;WC();var a=y.useMemo(function(){return zC(i)},[i]);return y.createElement(BC,{styles:HC(a,!t,i,n?``:`!important`)})},KC=!1;if(typeof window<`u`)try{var qC=Object.defineProperty({},`passive`,{get:function(){return KC=!0,!0}});window.addEventListener(`test`,qC,qC),window.removeEventListener(`test`,qC,qC)}catch{KC=!1}var JC=KC?{passive:!1}:!1,YC=function(e){return e.tagName===`TEXTAREA`},XC=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!==`hidden`&&!(n.overflowY===n.overflowX&&!YC(e)&&n[t]===`visible`)},ZC=function(e){return XC(e,`overflowY`)},QC=function(e){return XC(e,`overflowX`)},$C=function(e,t){var n=t.ownerDocument,r=t;do{if(typeof ShadowRoot<`u`&&r instanceof ShadowRoot&&(r=r.host),nw(e,r)){var i=rw(e,r),a=i[1],o=i[2];if(a>o)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},ew=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},tw=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},nw=function(e,t){return e===`v`?ZC(t):QC(t)},rw=function(e,t){return e===`v`?ew(t):tw(t)},iw=function(e,t){return e===`h`&&t===`rtl`?-1:1},aw=function(e,t,n,r,i){var a=iw(e,window.getComputedStyle(t).direction),o=a*r,s=n.target,c=t.contains(s),l=!1,u=o>0,d=0,f=0;do{if(!s)break;var p=rw(e,s),m=p[0],h=p[1],g=p[2],_=h-g-a*m;(m||_)&&nw(e,s)&&(d+=_,f+=m);var v=s.parentNode;s=v&&v.nodeType===Node.DOCUMENT_FRAGMENT_NODE?v.host:v}while(!c&&s!==document.body||c&&(t.contains(s)||t===s));return(u&&(i&&Math.abs(d)<1||!i&&o>d)||!u&&(i&&Math.abs(f)<1||!i&&-o>f))&&(l=!0),l},ow=function(e){return`changedTouches`in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},sw=function(e){return[e.deltaX,e.deltaY]},cw=function(e){return e&&`current`in e?e.current:e},lw=function(e,t){return e[0]===t[0]&&e[1]===t[1]},uw=function(e){return`
  .block-interactivity-${e} {pointer-events: none;}
  .allow-interactivity-${e} {pointer-events: all;}
`},dw=0,fw=[];function pw(e){var t=y.useRef([]),n=y.useRef([0,0]),r=y.useRef(),i=y.useState(dw++)[0],a=y.useState(FC)[0],o=y.useRef(e);y.useEffect(function(){o.current=e},[e]),y.useEffect(function(){if(e.inert){document.body.classList.add(`block-interactivity-${i}`);var t=uC([e.lockRef.current],(e.shards||[]).map(cw),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add(`allow-interactivity-${i}`)}),function(){document.body.classList.remove(`block-interactivity-${i}`),t.forEach(function(e){return e.classList.remove(`allow-interactivity-${i}`)})}}},[e.inert,e.lockRef.current,e.shards]);var s=y.useCallback(function(e,t){if(`touches`in e&&e.touches.length===2||e.type===`wheel`&&e.ctrlKey)return!o.current.allowPinchZoom;var i=ow(e),a=n.current,s=`deltaX`in e?e.deltaX:a[0]-i[0],c=`deltaY`in e?e.deltaY:a[1]-i[1],l,u=e.target,d=Math.abs(s)>Math.abs(c)?`h`:`v`;if(`touches`in e&&d===`h`&&u.type===`range`)return!1;var f=$C(d,u);if(!f)return!0;if(f?l=d:(l=d===`v`?`h`:`v`,f=$C(d,u)),!f)return!1;if(!r.current&&`changedTouches`in e&&(s||c)&&(r.current=l),!l)return!0;var p=r.current||l;return aw(p,t,e,p===`h`?s:c,!0)},[]),c=y.useCallback(function(e){var n=e;if(!(!fw.length||fw[fw.length-1]!==a)){var r=`deltaY`in n?sw(n):ow(n),i=t.current.filter(function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&lw(e.delta,r)})[0];if(i&&i.should){n.cancelable&&n.preventDefault();return}if(!i){var c=(o.current.shards||[]).map(cw).filter(Boolean).filter(function(e){return e.contains(n.target)});(c.length>0?s(n,c[0]):!o.current.noIsolation)&&n.cancelable&&n.preventDefault()}}},[]),l=y.useCallback(function(e,n,r,i){var a={name:e,delta:n,target:r,should:i,shadowParent:mw(r)};t.current.push(a),setTimeout(function(){t.current=t.current.filter(function(e){return e!==a})},1)},[]),u=y.useCallback(function(e){n.current=ow(e),r.current=void 0},[]),d=y.useCallback(function(t){l(t.type,sw(t),t.target,s(t,e.lockRef.current))},[]),f=y.useCallback(function(t){l(t.type,ow(t),t.target,s(t,e.lockRef.current))},[]);y.useEffect(function(){return fw.push(a),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener(`wheel`,c,JC),document.addEventListener(`touchmove`,c,JC),document.addEventListener(`touchstart`,u,JC),function(){fw=fw.filter(function(e){return e!==a}),document.removeEventListener(`wheel`,c,JC),document.removeEventListener(`touchmove`,c,JC),document.removeEventListener(`touchstart`,u,JC)}},[]);var p=e.removeScrollBar,m=e.inert;return y.createElement(y.Fragment,null,m?y.createElement(a,{styles:uw(i)}):null,p?y.createElement(GC,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function mw(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}var hw=wC(TC,pw),gw=y.forwardRef(function(e,t){return y.createElement(DC,cC({},e,{ref:t,sideCar:hw}))});gw.classNames=DC.classNames;var _w=gw,vw=function(e){return typeof document>`u`?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},yw=new WeakMap,bw=new WeakMap,xw={},Sw=0,Cw=function(e){return e&&(e.host||Cw(e.parentNode))},ww=function(e,t){return t.map(function(t){if(e.contains(t))return t;var n=Cw(t);return n&&e.contains(n)?n:(console.error(`aria-hidden`,t,`in not contained inside`,e,`. Doing nothing`),null)}).filter(function(e){return!!e})},Tw=function(e,t,n,r){var i=ww(t,Array.isArray(e)?e:[e]);xw[n]||(xw[n]=new WeakMap);var a=xw[n],o=[],s=new Set,c=new Set(i),l=function(e){!e||s.has(e)||(s.add(e),l(e.parentNode))};i.forEach(l);var u=function(e){!e||c.has(e)||Array.prototype.forEach.call(e.children,function(e){if(s.has(e))u(e);else try{var t=e.getAttribute(r),i=t!==null&&t!==`false`,c=(yw.get(e)||0)+1,l=(a.get(e)||0)+1;yw.set(e,c),a.set(e,l),o.push(e),c===1&&i&&bw.set(e,!0),l===1&&e.setAttribute(n,`true`),i||e.setAttribute(r,`true`)}catch(t){console.error(`aria-hidden: cannot operate on `,e,t)}})};return u(t),s.clear(),Sw++,function(){o.forEach(function(e){var t=yw.get(e)-1,i=a.get(e)-1;yw.set(e,t),a.set(e,i),t||(bw.has(e)||e.removeAttribute(r),bw.delete(e)),i||e.removeAttribute(n)}),Sw--,Sw||(yw=new WeakMap,yw=new WeakMap,bw=new WeakMap,xw={})}},Ew=function(e,t,n){n===void 0&&(n=`data-aria-hidden`);var r=Array.from(Array.isArray(e)?e:[e]),i=t||vw(e);return i?(r.push.apply(r,Array.from(i.querySelectorAll(`[aria-live], script`))),Tw(r,i,n,`aria-hidden`)):function(){return null}},Dw=`Dialog`,[Ow,kw]=sS(Dw),[Aw,jw]=Ow(Dw),Mw=e=>{let{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:a,modal:o=!0}=e,s=y.useRef(null),c=y.useRef(null),[l,u]=mS({prop:r,defaultProp:i??!1,onChange:a,caller:Dw});return(0,Z.jsx)(Aw,{scope:t,triggerRef:s,contentRef:c,contentId:fS(),titleId:fS(),descriptionId:fS(),open:l,onOpenChange:u,onOpenToggle:y.useCallback(()=>u(e=>!e),[u]),modal:o,children:n})};Mw.displayName=Dw;var Nw=`DialogTrigger`,Pw=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=jw(Nw,n),a=Kx(t,i.triggerRef);return(0,Z.jsx)(vS.button,{type:`button`,"aria-haspopup":`dialog`,"aria-expanded":i.open,"aria-controls":i.contentId,"data-state":eT(i.open),...r,ref:a,onClick:aS(e.onClick,i.onOpenToggle)})});Pw.displayName=Nw;var Fw=`DialogPortal`,[Iw,Lw]=Ow(Fw,{forceMount:void 0}),Rw=e=>{let{__scopeDialog:t,forceMount:n,children:r,container:i}=e,a=jw(Fw,t);return(0,Z.jsx)(Iw,{scope:t,forceMount:n,children:y.Children.map(r,e=>(0,Z.jsx)(tC,{present:n||a.open,children:(0,Z.jsx)($S,{asChild:!0,container:i,children:e})}))})};Rw.displayName=Fw;var zw=`DialogOverlay`,Bw=y.forwardRef((e,t)=>{let n=Lw(zw,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,a=jw(zw,e.__scopeDialog);return a.modal?(0,Z.jsx)(tC,{present:r||a.open,children:(0,Z.jsx)(Hw,{...i,ref:t})}):null});Bw.displayName=zw;var Vw=qx(`DialogOverlay.RemoveScroll`),Hw=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=jw(zw,n);return(0,Z.jsx)(_w,{as:Vw,allowPinchZoom:!0,shards:[i.contentRef],children:(0,Z.jsx)(vS.div,{"data-state":eT(i.open),...r,ref:t,style:{pointerEvents:`auto`,...r.style}})})}),Uw=`DialogContent`,Ww=y.forwardRef((e,t)=>{let n=Lw(Uw,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,a=jw(Uw,e.__scopeDialog);return(0,Z.jsx)(tC,{present:r||a.open,children:a.modal?(0,Z.jsx)(Gw,{...i,ref:t}):(0,Z.jsx)(Kw,{...i,ref:t})})});Ww.displayName=Uw;var Gw=y.forwardRef((e,t)=>{let n=jw(Uw,e.__scopeDialog),r=y.useRef(null),i=Kx(t,n.contentRef,r);return y.useEffect(()=>{let e=r.current;if(e)return Ew(e)},[]),(0,Z.jsx)(qw,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:aS(e.onCloseAutoFocus,e=>{e.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:aS(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=t.button===0&&t.ctrlKey===!0;(t.button===2||n)&&e.preventDefault()}),onFocusOutside:aS(e.onFocusOutside,e=>e.preventDefault())})}),Kw=y.forwardRef((e,t)=>{let n=jw(Uw,e.__scopeDialog),r=y.useRef(!1),i=y.useRef(!1);return(0,Z.jsx)(qw,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(r.current||n.triggerRef.current?.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(r.current=!0,t.detail.originalEvent.type===`pointerdown`&&(i.current=!0));let a=t.target;n.triggerRef.current?.contains(a)&&t.preventDefault(),t.detail.originalEvent.type===`focusin`&&i.current&&t.preventDefault()}})}),qw=y.forwardRef((e,t)=>{let{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:a,...o}=e,s=jw(Uw,n),c=y.useRef(null),l=Kx(t,c);return oC(),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(zS,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:a,children:(0,Z.jsx)(OS,{role:`dialog`,id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":eT(s.open),...o,ref:l,onDismiss:()=>s.onOpenChange(!1)})}),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(iT,{titleId:s.titleId}),(0,Z.jsx)(oT,{contentRef:c,descriptionId:s.descriptionId})]})]})}),Jw=`DialogTitle`,Yw=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=jw(Jw,n);return(0,Z.jsx)(vS.h2,{id:i.titleId,...r,ref:t})});Yw.displayName=Jw;var Xw=`DialogDescription`,Zw=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=jw(Xw,n);return(0,Z.jsx)(vS.p,{id:i.descriptionId,...r,ref:t})});Zw.displayName=Xw;var Qw=`DialogClose`,$w=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=jw(Qw,n);return(0,Z.jsx)(vS.button,{type:`button`,...r,ref:t,onClick:aS(e.onClick,()=>i.onOpenChange(!1))})});$w.displayName=Qw;function eT(e){return e?`open`:`closed`}var tT=`DialogTitleWarning`,[nT,rT]=oS(tT,{contentName:Uw,titleName:Jw,docsSlug:`dialog`}),iT=({titleId:e})=>{let t=rT(tT),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return y.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},aT=`DialogDescriptionWarning`,oT=({contentRef:e,descriptionId:t})=>{let n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${rT(aT).contentName}}.`;return y.useEffect(()=>{let r=e.current?.getAttribute(`aria-describedby`);t&&r&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},sT=Mw,cT=Pw,lT=Rw,uT=Bw,dT=Ww,fT=Yw,pT=Zw,mT=$w,hT=sT,gT=cT,_T=lT,vT=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(uT,{className:Q(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));vT.displayName=uT.displayName;var yT=rS(`fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out`,{variants:{side:{top:`inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top`,bottom:`inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom`,left:`inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm`,right:`inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm`}},defaultVariants:{side:`right`}}),bT=y.forwardRef(({side:e=`right`,className:t,children:n,...r},i)=>(0,Z.jsxs)(_T,{children:[(0,Z.jsx)(vT,{}),(0,Z.jsxs)(dT,{ref:i,className:Q(yT({side:e}),t),...r,children:[(0,Z.jsxs)(mT,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary`,children:[(0,Z.jsx)(Bb,{className:`h-4 w-4`}),(0,Z.jsx)(`span`,{className:`sr-only`,children:`Close`})]}),n]})]}));bT.displayName=dT.displayName;var xT=({className:e,...t})=>(0,Z.jsx)(`div`,{className:Q(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});xT.displayName=`SheetHeader`;var ST=({className:e,...t})=>(0,Z.jsx)(`div`,{className:Q(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});ST.displayName=`SheetFooter`;var CT=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(fT,{ref:n,className:Q(`text-lg font-semibold text-foreground`,e),...t}));CT.displayName=fT.displayName;var wT=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(pT,{ref:n,className:Q(`text-sm text-muted-foreground`,e),...t}));wT.displayName=pT.displayName;var TT=sT,ET=lT,DT=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(uT,{ref:n,className:Q(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t}));DT.displayName=uT.displayName;var OT=y.forwardRef(({className:e,children:t,...n},r)=>(0,Z.jsxs)(ET,{children:[(0,Z.jsx)(DT,{}),(0,Z.jsxs)(dT,{ref:r,className:Q(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...n,children:[t,(0,Z.jsxs)(mT,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground`,children:[(0,Z.jsx)(Bb,{className:`h-4 w-4`}),(0,Z.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));OT.displayName=dT.displayName;var kT=({className:e,...t})=>(0,Z.jsx)(`div`,{className:Q(`flex flex-col space-y-1.5 text-center sm:text-left`,e),...t});kT.displayName=`DialogHeader`;var AT=({className:e,...t})=>(0,Z.jsx)(`div`,{className:Q(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});AT.displayName=`DialogFooter`;var jT=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(fT,{ref:n,className:Q(`text-lg font-semibold leading-none tracking-tight`,e),...t}));jT.displayName=fT.displayName;var MT=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(pT,{ref:n,className:Q(`text-sm text-muted-foreground`,e),...t}));MT.displayName=pT.displayName;var NT=`Separator`,PT=`horizontal`,FT=[`horizontal`,`vertical`],IT=y.forwardRef((e,t)=>{let{decorative:n,orientation:r=PT,...i}=e,a=LT(r)?r:PT,o=a===`vertical`?a:void 0,s=n?{role:`none`}:{"aria-orientation":o,role:`separator`};return(0,Z.jsx)(vS.div,{"data-orientation":a,...s,...i,ref:t})});IT.displayName=NT;function LT(e){return FT.includes(e)}var RT=IT,zT=y.forwardRef(({className:e,orientation:t=`horizontal`,decorative:n=!0,...r},i)=>(0,Z.jsx)(RT,{ref:i,decorative:n,orientation:t,className:Q(`shrink-0 bg-border`,t===`horizontal`?`h-[1px] w-full`:`h-full w-[1px]`,e),...r}));zT.displayName=RT.displayName;var BT=[`top`,`right`,`bottom`,`left`],VT=Math.min,HT=Math.max,UT=Math.round,WT=Math.floor,GT=e=>({x:e,y:e}),KT={left:`right`,right:`left`,bottom:`top`,top:`bottom`},qT={start:`end`,end:`start`};function JT(e,t,n){return HT(e,VT(t,n))}function YT(e,t){return typeof e==`function`?e(t):e}function XT(e){return e.split(`-`)[0]}function ZT(e){return e.split(`-`)[1]}function QT(e){return e===`x`?`y`:`x`}function $T(e){return e===`y`?`height`:`width`}var eE=new Set([`top`,`bottom`]);function tE(e){return eE.has(XT(e))?`y`:`x`}function nE(e){return QT(tE(e))}function rE(e,t,n){n===void 0&&(n=!1);let r=ZT(e),i=nE(e),a=$T(i),o=i===`x`?r===(n?`end`:`start`)?`right`:`left`:r===`start`?`bottom`:`top`;return t.reference[a]>t.floating[a]&&(o=fE(o)),[o,fE(o)]}function iE(e){let t=fE(e);return[aE(e),t,aE(t)]}function aE(e){return e.replace(/start|end/g,e=>qT[e])}var oE=[`left`,`right`],sE=[`right`,`left`],cE=[`top`,`bottom`],lE=[`bottom`,`top`];function uE(e,t,n){switch(e){case`top`:case`bottom`:return n?t?sE:oE:t?oE:sE;case`left`:case`right`:return t?cE:lE;default:return[]}}function dE(e,t,n,r){let i=ZT(e),a=uE(XT(e),n===`start`,r);return i&&(a=a.map(e=>e+`-`+i),t&&(a=a.concat(a.map(aE)))),a}function fE(e){return e.replace(/left|right|bottom|top/g,e=>KT[e])}function pE(e){return{top:0,right:0,bottom:0,left:0,...e}}function mE(e){return typeof e==`number`?{top:e,right:e,bottom:e,left:e}:pE(e)}function hE(e){let{x:t,y:n,width:r,height:i}=e;return{width:r,height:i,top:n,left:t,right:t+r,bottom:n+i,x:t,y:n}}function gE(e,t,n){let{reference:r,floating:i}=e,a=tE(t),o=nE(t),s=$T(o),c=XT(t),l=a===`y`,u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,f=r[s]/2-i[s]/2,p;switch(c){case`top`:p={x:u,y:r.y-i.height};break;case`bottom`:p={x:u,y:r.y+r.height};break;case`right`:p={x:r.x+r.width,y:d};break;case`left`:p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(ZT(t)){case`start`:p[o]-=f*(n&&l?-1:1);break;case`end`:p[o]+=f*(n&&l?-1:1);break}return p}var _E=async(e,t,n)=>{let{placement:r=`bottom`,strategy:i=`absolute`,middleware:a=[],platform:o}=n,s=a.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(t)),l=await o.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=gE(l,r,c),f=r,p={},m=0;for(let n=0;n<s.length;n++){let{name:a,fn:h}=s[n],{x:g,y:_,data:v,reset:y}=await h({x:u,y:d,initialPlacement:r,placement:f,strategy:i,middlewareData:p,rects:l,platform:o,elements:{reference:e,floating:t}});u=g??u,d=_??d,p={...p,[a]:{...p[a],...v}},y&&m<=50&&(m++,typeof y==`object`&&(y.placement&&(f=y.placement),y.rects&&(l=y.rects===!0?await o.getElementRects({reference:e,floating:t,strategy:i}):y.rects),{x:u,y:d}=gE(l,f,c)),n=-1)}return{x:u,y:d,placement:f,strategy:i,middlewareData:p}};async function vE(e,t){t===void 0&&(t={});let{x:n,y:r,platform:i,rects:a,elements:o,strategy:s}=e,{boundary:c=`clippingAncestors`,rootBoundary:l=`viewport`,elementContext:u=`floating`,altBoundary:d=!1,padding:f=0}=YT(t,e),p=mE(f),m=o[d?u===`floating`?`reference`:`floating`:u],h=hE(await i.getClippingRect({element:await(i.isElement==null?void 0:i.isElement(m))??!0?m:m.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:l,strategy:s})),g=u===`floating`?{x:n,y:r,width:a.floating.width,height:a.floating.height}:a.reference,_=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),v=await(i.isElement==null?void 0:i.isElement(_))&&await(i.getScale==null?void 0:i.getScale(_))||{x:1,y:1},y=hE(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:g,offsetParent:_,strategy:s}):g);return{top:(h.top-y.top+p.top)/v.y,bottom:(y.bottom-h.bottom+p.bottom)/v.y,left:(h.left-y.left+p.left)/v.x,right:(y.right-h.right+p.right)/v.x}}var yE=e=>({name:`arrow`,options:e,async fn(t){let{x:n,y:r,placement:i,rects:a,platform:o,elements:s,middlewareData:c}=t,{element:l,padding:u=0}=YT(e,t)||{};if(l==null)return{};let d=mE(u),f={x:n,y:r},p=nE(i),m=$T(p),h=await o.getDimensions(l),g=p===`y`,_=g?`top`:`left`,v=g?`bottom`:`right`,y=g?`clientHeight`:`clientWidth`,b=a.reference[m]+a.reference[p]-f[p]-a.floating[m],x=f[p]-a.reference[p],S=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l)),C=S?S[y]:0;(!C||!await(o.isElement==null?void 0:o.isElement(S)))&&(C=s.floating[y]||a.floating[m]);let w=b/2-x/2,T=C/2-h[m]/2-1,E=VT(d[_],T),D=VT(d[v],T),O=E,k=C-h[m]-D,A=C/2-h[m]/2+w,ee=JT(O,A,k),te=!c.arrow&&ZT(i)!=null&&A!==ee&&a.reference[m]/2-(A<O?E:D)-h[m]/2<0,ne=te?A<O?A-O:A-k:0;return{[p]:f[p]+ne,data:{[p]:ee,centerOffset:A-ee-ne,...te&&{alignmentOffset:ne}},reset:te}}}),bE=function(e){return e===void 0&&(e={}),{name:`flip`,options:e,async fn(t){var n;let{placement:r,middlewareData:i,rects:a,initialPlacement:o,platform:s,elements:c}=t,{mainAxis:l=!0,crossAxis:u=!0,fallbackPlacements:d,fallbackStrategy:f=`bestFit`,fallbackAxisSideDirection:p=`none`,flipAlignment:m=!0,...h}=YT(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};let g=XT(r),_=tE(o),v=XT(o)===o,y=await(s.isRTL==null?void 0:s.isRTL(c.floating)),b=d||(v||!m?[fE(o)]:iE(o)),x=p!==`none`;!d&&x&&b.push(...dE(o,m,p,y));let S=[o,...b],C=await vE(t,h),w=[],T=i.flip?.overflows||[];if(l&&w.push(C[g]),u){let e=rE(r,a,y);w.push(C[e[0]],C[e[1]])}if(T=[...T,{placement:r,overflows:w}],!w.every(e=>e<=0)){let e=(i.flip?.index||0)+1,t=S[e];if(t&&(!(u===`alignment`&&_!==tE(t))||T.every(e=>tE(e.placement)===_?e.overflows[0]>0:!0)))return{data:{index:e,overflows:T},reset:{placement:t}};let n=T.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0]?.placement;if(!n)switch(f){case`bestFit`:{let e=T.filter(e=>{if(x){let t=tE(e.placement);return t===_||t===`y`}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0]?.[0];e&&(n=e);break}case`initialPlacement`:n=o;break}if(r!==n)return{reset:{placement:n}}}return{}}}};function xE(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function SE(e){return BT.some(t=>e[t]>=0)}var CE=function(e){return e===void 0&&(e={}),{name:`hide`,options:e,async fn(t){let{rects:n}=t,{strategy:r=`referenceHidden`,...i}=YT(e,t);switch(r){case`referenceHidden`:{let e=await vE(t,{...i,elementContext:`reference`}),r=xE(e,n.reference);return{data:{referenceHiddenOffsets:r,referenceHidden:SE(r)}}}case`escaped`:{let e=await vE(t,{...i,altBoundary:!0}),r=xE(e,n.floating);return{data:{escapedOffsets:r,escaped:SE(r)}}}default:return{}}}}},wE=new Set([`left`,`top`]);async function TE(e,t){let{placement:n,platform:r,elements:i}=e,a=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=XT(n),s=ZT(n),c=tE(n)===`y`,l=wE.has(o)?-1:1,u=a&&c?-1:1,d=YT(t,e),{mainAxis:f,crossAxis:p,alignmentAxis:m}=typeof d==`number`?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return s&&typeof m==`number`&&(p=s===`end`?m*-1:m),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}var EE=function(e){return e===void 0&&(e=0),{name:`offset`,options:e,async fn(t){var n;let{x:r,y:i,placement:a,middlewareData:o}=t,s=await TE(t,e);return a===o.offset?.placement&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:r+s.x,y:i+s.y,data:{...s,placement:a}}}}},DE=function(e){return e===void 0&&(e={}),{name:`shift`,options:e,async fn(t){let{x:n,y:r,placement:i}=t,{mainAxis:a=!0,crossAxis:o=!1,limiter:s={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...c}=YT(e,t),l={x:n,y:r},u=await vE(t,c),d=tE(XT(i)),f=QT(d),p=l[f],m=l[d];if(a){let e=f===`y`?`top`:`left`,t=f===`y`?`bottom`:`right`,n=p+u[e],r=p-u[t];p=JT(n,p,r)}if(o){let e=d===`y`?`top`:`left`,t=d===`y`?`bottom`:`right`,n=m+u[e],r=m-u[t];m=JT(n,m,r)}let h=s.fn({...t,[f]:p,[d]:m});return{...h,data:{x:h.x-n,y:h.y-r,enabled:{[f]:a,[d]:o}}}}}},OE=function(e){return e===void 0&&(e={}),{options:e,fn(t){let{x:n,y:r,placement:i,rects:a,middlewareData:o}=t,{offset:s=0,mainAxis:c=!0,crossAxis:l=!0}=YT(e,t),u={x:n,y:r},d=tE(i),f=QT(d),p=u[f],m=u[d],h=YT(s,t),g=typeof h==`number`?{mainAxis:h,crossAxis:0}:{mainAxis:0,crossAxis:0,...h};if(c){let e=f===`y`?`height`:`width`,t=a.reference[f]-a.floating[e]+g.mainAxis,n=a.reference[f]+a.reference[e]-g.mainAxis;p<t?p=t:p>n&&(p=n)}if(l){let e=f===`y`?`width`:`height`,t=wE.has(XT(i)),n=a.reference[d]-a.floating[e]+(t&&o.offset?.[d]||0)+(t?0:g.crossAxis),r=a.reference[d]+a.reference[e]+(t?0:o.offset?.[d]||0)-(t?g.crossAxis:0);m<n?m=n:m>r&&(m=r)}return{[f]:p,[d]:m}}}},kE=function(e){return e===void 0&&(e={}),{name:`size`,options:e,async fn(t){var n,r;let{placement:i,rects:a,platform:o,elements:s}=t,{apply:c=()=>{},...l}=YT(e,t),u=await vE(t,l),d=XT(i),f=ZT(i),p=tE(i)===`y`,{width:m,height:h}=a.floating,g,_;d===`top`||d===`bottom`?(g=d,_=f===(await(o.isRTL==null?void 0:o.isRTL(s.floating))?`start`:`end`)?`left`:`right`):(_=d,g=f===`end`?`top`:`bottom`);let v=h-u.top-u.bottom,y=m-u.left-u.right,b=VT(h-u[g],v),x=VT(m-u[_],y),S=!t.middlewareData.shift,C=b,w=x;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(w=y),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(C=v),S&&!f){let e=HT(u.left,0),t=HT(u.right,0),n=HT(u.top,0),r=HT(u.bottom,0);p?w=m-2*(e!==0||t!==0?e+t:HT(u.left,u.right)):C=h-2*(n!==0||r!==0?n+r:HT(u.top,u.bottom))}await c({...t,availableWidth:w,availableHeight:C});let T=await o.getDimensions(s.floating);return m!==T.width||h!==T.height?{reset:{rects:!0}}:{}}}};function AE(){return typeof window<`u`}function jE(e){return PE(e)?(e.nodeName||``).toLowerCase():`#document`}function ME(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function NE(e){return((PE(e)?e.ownerDocument:e.document)||window.document)?.documentElement}function PE(e){return AE()?e instanceof Node||e instanceof ME(e).Node:!1}function FE(e){return AE()?e instanceof Element||e instanceof ME(e).Element:!1}function IE(e){return AE()?e instanceof HTMLElement||e instanceof ME(e).HTMLElement:!1}function LE(e){return!AE()||typeof ShadowRoot>`u`?!1:e instanceof ShadowRoot||e instanceof ME(e).ShadowRoot}var RE=new Set([`inline`,`contents`]);function zE(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=QE(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!RE.has(i)}var BE=new Set([`table`,`td`,`th`]);function VE(e){return BE.has(jE(e))}var HE=[`:popover-open`,`:modal`];function UE(e){return HE.some(t=>{try{return e.matches(t)}catch{return!1}})}var WE=[`transform`,`translate`,`scale`,`rotate`,`perspective`],GE=[`transform`,`translate`,`scale`,`rotate`,`perspective`,`filter`],KE=[`paint`,`layout`,`strict`,`content`];function qE(e){let t=YE(),n=FE(e)?QE(e):e;return WE.some(e=>n[e]?n[e]!==`none`:!1)||(n.containerType?n.containerType!==`normal`:!1)||!t&&(n.backdropFilter?n.backdropFilter!==`none`:!1)||!t&&(n.filter?n.filter!==`none`:!1)||GE.some(e=>(n.willChange||``).includes(e))||KE.some(e=>(n.contain||``).includes(e))}function JE(e){let t=eD(e);for(;IE(t)&&!ZE(t);){if(qE(t))return t;if(UE(t))return null;t=eD(t)}return null}function YE(){return typeof CSS>`u`||!CSS.supports?!1:CSS.supports(`-webkit-backdrop-filter`,`none`)}var XE=new Set([`html`,`body`,`#document`]);function ZE(e){return XE.has(jE(e))}function QE(e){return ME(e).getComputedStyle(e)}function $E(e){return FE(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function eD(e){if(jE(e)===`html`)return e;let t=e.assignedSlot||e.parentNode||LE(e)&&e.host||NE(e);return LE(t)?t.host:t}function tD(e){let t=eD(e);return ZE(t)?e.ownerDocument?e.ownerDocument.body:e.body:IE(t)&&zE(t)?t:tD(t)}function nD(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!0);let r=tD(e),i=r===e.ownerDocument?.body,a=ME(r);if(i){let e=rD(a);return t.concat(a,a.visualViewport||[],zE(r)?r:[],e&&n?nD(e):[])}return t.concat(r,nD(r,[],n))}function rD(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function iD(e){let t=QE(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=IE(e),a=i?e.offsetWidth:n,o=i?e.offsetHeight:r,s=UT(n)!==a||UT(r)!==o;return s&&(n=a,r=o),{width:n,height:r,$:s}}function aD(e){return FE(e)?e:e.contextElement}function oD(e){let t=aD(e);if(!IE(t))return GT(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:a}=iD(t),o=(a?UT(n.width):n.width)/r,s=(a?UT(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!s||!Number.isFinite(s))&&(s=1),{x:o,y:s}}var sD=GT(0);function cD(e){let t=ME(e);return!YE()||!t.visualViewport?sD:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function lD(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==ME(e)?!1:t}function uD(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);let i=e.getBoundingClientRect(),a=aD(e),o=GT(1);t&&(r?FE(r)&&(o=oD(r)):o=oD(e));let s=lD(a,n,r)?cD(a):GT(0),c=(i.left+s.x)/o.x,l=(i.top+s.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(a){let e=ME(a),t=r&&FE(r)?ME(r):r,n=e,i=rD(n);for(;i&&r&&t!==n;){let e=oD(i),t=i.getBoundingClientRect(),r=QE(i),a=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y;c*=e.x,l*=e.y,u*=e.x,d*=e.y,c+=a,l+=o,n=ME(i),i=rD(n)}}return hE({width:u,height:d,x:c,y:l})}function dD(e,t){let n=$E(e).scrollLeft;return t?t.left+n:uD(NE(e)).left+n}function fD(e,t){let n=e.getBoundingClientRect(),r=n.left+t.scrollLeft-dD(e,n),i=n.top+t.scrollTop;return{x:r,y:i}}function pD(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e,a=i===`fixed`,o=NE(r),s=t?UE(t.floating):!1;if(r===o||s&&a)return n;let c={scrollLeft:0,scrollTop:0},l=GT(1),u=GT(0),d=IE(r);if((d||!d&&!a)&&((jE(r)!==`body`||zE(o))&&(c=$E(r)),IE(r))){let e=uD(r);l=oD(r),u.x=e.x+r.clientLeft,u.y=e.y+r.clientTop}let f=o&&!d&&!a?fD(o,c):GT(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function mD(e){return Array.from(e.getClientRects())}function hD(e){let t=NE(e),n=$E(e),r=e.ownerDocument.body,i=HT(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),a=HT(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),o=-n.scrollLeft+dD(e),s=-n.scrollTop;return QE(r).direction===`rtl`&&(o+=HT(t.clientWidth,r.clientWidth)-i),{width:i,height:a,x:o,y:s}}var gD=25;function _D(e,t){let n=ME(e),r=NE(e),i=n.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,c=0;if(i){a=i.width,o=i.height;let e=YE();(!e||e&&t===`fixed`)&&(s=i.offsetLeft,c=i.offsetTop)}let l=dD(r);if(l<=0){let e=r.ownerDocument,t=e.body,n=getComputedStyle(t),i=e.compatMode===`CSS1Compat`&&parseFloat(n.marginLeft)+parseFloat(n.marginRight)||0,o=Math.abs(r.clientWidth-t.clientWidth-i);o<=gD&&(a-=o)}else l<=gD&&(a+=l);return{width:a,height:o,x:s,y:c}}var vD=new Set([`absolute`,`fixed`]);function yD(e,t){let n=uD(e,!0,t===`fixed`),r=n.top+e.clientTop,i=n.left+e.clientLeft,a=IE(e)?oD(e):GT(1),o=e.clientWidth*a.x,s=e.clientHeight*a.y,c=i*a.x,l=r*a.y;return{width:o,height:s,x:c,y:l}}function bD(e,t,n){let r;if(t===`viewport`)r=_D(e,n);else if(t===`document`)r=hD(NE(e));else if(FE(t))r=yD(t,n);else{let n=cD(e);r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return hE(r)}function xD(e,t){let n=eD(e);return n===t||!FE(n)||ZE(n)?!1:QE(n).position===`fixed`||xD(n,t)}function SD(e,t){let n=t.get(e);if(n)return n;let r=nD(e,[],!1).filter(e=>FE(e)&&jE(e)!==`body`),i=null,a=QE(e).position===`fixed`,o=a?eD(e):e;for(;FE(o)&&!ZE(o);){let t=QE(o),n=qE(o);!n&&t.position===`fixed`&&(i=null),(a?!n&&!i:!n&&t.position===`static`&&i&&vD.has(i.position)||zE(o)&&!n&&xD(e,o))?r=r.filter(e=>e!==o):i=t,o=eD(o)}return t.set(e,r),r}function CD(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,a=[...n===`clippingAncestors`?UE(t)?[]:SD(t,this._c):[].concat(n),r],o=a[0],s=a.reduce((e,n)=>{let r=bD(t,n,i);return e.top=HT(r.top,e.top),e.right=VT(r.right,e.right),e.bottom=VT(r.bottom,e.bottom),e.left=HT(r.left,e.left),e},bD(t,o,i));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function wD(e){let{width:t,height:n}=iD(e);return{width:t,height:n}}function TD(e,t,n){let r=IE(t),i=NE(t),a=n===`fixed`,o=uD(e,!0,a,t),s={scrollLeft:0,scrollTop:0},c=GT(0);function l(){c.x=dD(i)}if(r||!r&&!a)if((jE(t)!==`body`||zE(i))&&(s=$E(t)),r){let e=uD(t,!0,a,t);c.x=e.x+t.clientLeft,c.y=e.y+t.clientTop}else i&&l();a&&!r&&i&&l();let u=i&&!r&&!a?fD(i,s):GT(0),d=o.left+s.scrollLeft-c.x-u.x,f=o.top+s.scrollTop-c.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function ED(e){return QE(e).position===`static`}function DD(e,t){if(!IE(e)||QE(e).position===`fixed`)return null;if(t)return t(e);let n=e.offsetParent;return NE(e)===n&&(n=n.ownerDocument.body),n}function OD(e,t){let n=ME(e);if(UE(e))return n;if(!IE(e)){let t=eD(e);for(;t&&!ZE(t);){if(FE(t)&&!ED(t))return t;t=eD(t)}return n}let r=DD(e,t);for(;r&&VE(r)&&ED(r);)r=DD(r,t);return r&&ZE(r)&&ED(r)&&!qE(r)?n:r||JE(e)||n}var kD=async function(e){let t=this.getOffsetParent||OD,n=this.getDimensions,r=await n(e.floating);return{reference:TD(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function AD(e){return QE(e).direction===`rtl`}var jD={convertOffsetParentRelativeRectToViewportRelativeRect:pD,getDocumentElement:NE,getClippingRect:CD,getOffsetParent:OD,getElementRects:kD,getClientRects:mD,getDimensions:wD,getScale:oD,isElement:FE,isRTL:AD};function MD(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function ND(e,t){let n=null,r,i=NE(e);function a(){var e;clearTimeout(r),(e=n)==null||e.disconnect(),n=null}function o(s,c){s===void 0&&(s=!1),c===void 0&&(c=1),a();let l=e.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=l;if(s||t(),!f||!p)return;let m=WT(d),h=WT(i.clientWidth-(u+f)),g=WT(i.clientHeight-(d+p)),_=WT(u),v={rootMargin:-m+`px `+-h+`px `+-g+`px `+-_+`px`,threshold:HT(0,VT(1,c))||1},y=!0;function b(t){let n=t[0].intersectionRatio;if(n!==c){if(!y)return o();n?o(!1,n):r=setTimeout(()=>{o(!1,1e-7)},1e3)}n===1&&!MD(l,e.getBoundingClientRect())&&o(),y=!1}try{n=new IntersectionObserver(b,{...v,root:i.ownerDocument})}catch{n=new IntersectionObserver(b,v)}n.observe(e)}return o(!0),a}function PD(e,t,n,r){r===void 0&&(r={});let{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:o=typeof ResizeObserver==`function`,layoutShift:s=typeof IntersectionObserver==`function`,animationFrame:c=!1}=r,l=aD(e),u=i||a?[...l?nD(l):[],...nD(t)]:[];u.forEach(e=>{i&&e.addEventListener(`scroll`,n,{passive:!0}),a&&e.addEventListener(`resize`,n)});let d=l&&s?ND(l,n):null,f=-1,p=null;o&&(p=new ResizeObserver(e=>{let[r]=e;r&&r.target===l&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var e;(e=p)==null||e.observe(t)})),n()}),l&&!c&&p.observe(l),p.observe(t));let m,h=c?uD(e):null;c&&g();function g(){let t=uD(e);h&&!MD(h,t)&&n(),h=t,m=requestAnimationFrame(g)}return n(),()=>{var e;u.forEach(e=>{i&&e.removeEventListener(`scroll`,n),a&&e.removeEventListener(`resize`,n)}),d?.(),(e=p)==null||e.disconnect(),p=null,c&&cancelAnimationFrame(m)}}var FD=EE,ID=DE,LD=bE,RD=kE,zD=CE,BD=yE,VD=OE,HD=(e,t,n)=>{let r=new Map,i={platform:jD,...n},a={...i.platform,_c:r};return _E(e,t,{...i,platform:a})},UD=l(g(),1),WD=typeof document<`u`?y.useLayoutEffect:function(){};function GD(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e==`function`&&e.toString()===t.toString())return!0;let n,r,i;if(e&&t&&typeof e==`object`){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!GD(e[r],t[r]))return!1;return!0}if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,i[r]))return!1;for(r=n;r--!==0;){let n=i[r];if(!(n===`_owner`&&e.$$typeof)&&!GD(e[n],t[n]))return!1}return!0}return e!==e&&t!==t}function KD(e){return typeof window>`u`?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function qD(e,t){let n=KD(e);return Math.round(t*n)/n}function JD(e){let t=y.useRef(e);return WD(()=>{t.current=e}),t}function YD(e){e===void 0&&(e={});let{placement:t=`bottom`,strategy:n=`absolute`,middleware:r=[],platform:i,elements:{reference:a,floating:o}={},transform:s=!0,whileElementsMounted:c,open:l}=e,[u,d]=y.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[f,p]=y.useState(r);GD(f,r)||p(r);let[m,h]=y.useState(null),[g,_]=y.useState(null),v=y.useCallback(e=>{e!==C.current&&(C.current=e,h(e))},[]),b=y.useCallback(e=>{e!==w.current&&(w.current=e,_(e))},[]),x=a||m,S=o||g,C=y.useRef(null),w=y.useRef(null),T=y.useRef(u),E=c!=null,D=JD(c),O=JD(i),k=JD(l),A=y.useCallback(()=>{if(!C.current||!w.current)return;let e={placement:t,strategy:n,middleware:f};O.current&&(e.platform=O.current),HD(C.current,w.current,e).then(e=>{let t={...e,isPositioned:k.current!==!1};ee.current&&!GD(T.current,t)&&(T.current=t,UD.flushSync(()=>{d(t)}))})},[f,t,n,O,k]);WD(()=>{l===!1&&T.current.isPositioned&&(T.current.isPositioned=!1,d(e=>({...e,isPositioned:!1})))},[l]);let ee=y.useRef(!1);WD(()=>(ee.current=!0,()=>{ee.current=!1}),[]),WD(()=>{if(x&&(C.current=x),S&&(w.current=S),x&&S){if(D.current)return D.current(x,S,A);A()}},[x,S,A,D,E]);let te=y.useMemo(()=>({reference:C,floating:w,setReference:v,setFloating:b}),[v,b]),ne=y.useMemo(()=>({reference:x,floating:S}),[x,S]),j=y.useMemo(()=>{let e={position:n,left:0,top:0};if(!ne.floating)return e;let t=qD(ne.floating,u.x),r=qD(ne.floating,u.y);return s?{...e,transform:`translate(`+t+`px, `+r+`px)`,...KD(ne.floating)>=1.5&&{willChange:`transform`}}:{position:n,left:t,top:r}},[n,s,ne.floating,u.x,u.y]);return y.useMemo(()=>({...u,update:A,refs:te,elements:ne,floatingStyles:j}),[u,A,te,ne,j])}var XD=e=>{function t(e){return{}.hasOwnProperty.call(e,`current`)}return{name:`arrow`,options:e,fn(n){let{element:r,padding:i}=typeof e==`function`?e(n):e;return r&&t(r)?r.current==null?{}:BD({element:r.current,padding:i}).fn(n):r?BD({element:r,padding:i}).fn(n):{}}}},ZD=(e,t)=>({...FD(e),options:[e,t]}),QD=(e,t)=>({...ID(e),options:[e,t]}),$D=(e,t)=>({...VD(e),options:[e,t]}),eO=(e,t)=>({...LD(e),options:[e,t]}),tO=(e,t)=>({...RD(e),options:[e,t]}),nO=(e,t)=>({...zD(e),options:[e,t]}),rO=(e,t)=>({...XD(e),options:[e,t]}),iO=`Arrow`,aO=y.forwardRef((e,t)=>{let{children:n,width:r=10,height:i=5,...a}=e;return(0,Z.jsx)(vS.svg,{...a,ref:t,width:r,height:i,viewBox:`0 0 30 10`,preserveAspectRatio:`none`,children:e.asChild?n:(0,Z.jsx)(`polygon`,{points:`0,0 30,0 15,10`})})});aO.displayName=iO;var oO=aO;function sO(e){let[t,n]=y.useState(void 0);return lS(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{if(!Array.isArray(t)||!t.length)return;let r=t[0],i,a;if(`borderBoxSize`in r){let e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,a=t.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return t.observe(e,{box:`border-box`}),()=>t.unobserve(e)}else n(void 0)},[e]),t}var cO=`Popper`,[lO,uO]=sS(cO),[dO,fO]=lO(cO),pO=e=>{let{__scopePopper:t,children:n}=e,[r,i]=y.useState(null);return(0,Z.jsx)(dO,{scope:t,anchor:r,onAnchorChange:i,children:n})};pO.displayName=cO;var mO=`PopperAnchor`,hO=y.forwardRef((e,t)=>{let{__scopePopper:n,virtualRef:r,...i}=e,a=fO(mO,n),o=y.useRef(null),s=Kx(t,o),c=y.useRef(null);return y.useEffect(()=>{let e=c.current;c.current=r?.current||o.current,e!==c.current&&a.onAnchorChange(c.current)}),r?null:(0,Z.jsx)(vS.div,{...i,ref:s})});hO.displayName=mO;var gO=`PopperContent`,[_O,vO]=lO(gO),yO=y.forwardRef((e,t)=>{let{__scopePopper:n,side:r=`bottom`,sideOffset:i=0,align:a=`center`,alignOffset:o=0,arrowPadding:s=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:d=`partial`,hideWhenDetached:f=!1,updatePositionStrategy:p=`optimized`,onPlaced:m,...h}=e,g=fO(gO,n),[_,v]=y.useState(null),b=Kx(t,e=>v(e)),[x,S]=y.useState(null),C=sO(x),w=C?.width??0,T=C?.height??0,E=r+(a===`center`?``:`-`+a),D=typeof u==`number`?u:{top:0,right:0,bottom:0,left:0,...u},O=Array.isArray(l)?l:[l],k=O.length>0,A={padding:D,boundary:O.filter(CO),altBoundary:k},{refs:ee,floatingStyles:te,placement:ne,isPositioned:j,middlewareData:M}=YD({strategy:`fixed`,placement:E,whileElementsMounted:(...e)=>PD(...e,{animationFrame:p===`always`}),elements:{reference:g.anchor},middleware:[ZD({mainAxis:i+T,alignmentAxis:o}),c&&QD({mainAxis:!0,crossAxis:!1,limiter:d===`partial`?$D():void 0,...A}),c&&eO({...A}),tO({...A,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{let{width:i,height:a}=t.reference,o=e.floating.style;o.setProperty(`--radix-popper-available-width`,`${n}px`),o.setProperty(`--radix-popper-available-height`,`${r}px`),o.setProperty(`--radix-popper-anchor-width`,`${i}px`),o.setProperty(`--radix-popper-anchor-height`,`${a}px`)}}),x&&rO({element:x,padding:s}),wO({arrowWidth:w,arrowHeight:T}),f&&nO({strategy:`referenceHidden`,...A})]}),[re,ie]=TO(ne),ae=bS(m);lS(()=>{j&&ae?.()},[j,ae]);let oe=M.arrow?.x,se=M.arrow?.y,ce=M.arrow?.centerOffset!==0,[le,ue]=y.useState();return lS(()=>{_&&ue(window.getComputedStyle(_).zIndex)},[_]),(0,Z.jsx)(`div`,{ref:ee.setFloating,"data-radix-popper-content-wrapper":``,style:{...te,transform:j?te.transform:`translate(0, -200%)`,minWidth:`max-content`,zIndex:le,"--radix-popper-transform-origin":[M.transformOrigin?.x,M.transformOrigin?.y].join(` `),...M.hide?.referenceHidden&&{visibility:`hidden`,pointerEvents:`none`}},dir:e.dir,children:(0,Z.jsx)(_O,{scope:n,placedSide:re,onArrowChange:S,arrowX:oe,arrowY:se,shouldHideArrow:ce,children:(0,Z.jsx)(vS.div,{"data-side":re,"data-align":ie,...h,ref:b,style:{...h.style,animation:j?void 0:`none`}})})})});yO.displayName=gO;var bO=`PopperArrow`,xO={top:`bottom`,right:`left`,bottom:`top`,left:`right`},SO=y.forwardRef(function(e,t){let{__scopePopper:n,...r}=e,i=vO(bO,n),a=xO[i.placedSide];return(0,Z.jsx)(`span`,{ref:i.onArrowChange,style:{position:`absolute`,left:i.arrowX,top:i.arrowY,[a]:0,transformOrigin:{top:``,right:`0 0`,bottom:`center 0`,left:`100% 0`}[i.placedSide],transform:{top:`translateY(100%)`,right:`translateY(50%) rotate(90deg) translateX(-50%)`,bottom:`rotate(180deg)`,left:`translateY(50%) rotate(-90deg) translateX(50%)`}[i.placedSide],visibility:i.shouldHideArrow?`hidden`:void 0},children:(0,Z.jsx)(oO,{...r,ref:t,style:{...r.style,display:`block`}})})});SO.displayName=bO;function CO(e){return e!==null}var wO=e=>({name:`transformOrigin`,options:e,fn(t){let{placement:n,rects:r,middlewareData:i}=t,a=i.arrow?.centerOffset!==0,o=a?0:e.arrowWidth,s=a?0:e.arrowHeight,[c,l]=TO(n),u={start:`0%`,center:`50%`,end:`100%`}[l],d=(i.arrow?.x??0)+o/2,f=(i.arrow?.y??0)+s/2,p=``,m=``;return c===`bottom`?(p=a?u:`${d}px`,m=`${-s}px`):c===`top`?(p=a?u:`${d}px`,m=`${r.floating.height+s}px`):c===`right`?(p=`${-s}px`,m=a?u:`${f}px`):c===`left`&&(p=`${r.floating.width+s}px`,m=a?u:`${f}px`),{data:{x:p,y:m}}}});function TO(e){let[t,n=`center`]=e.split(`-`);return[t,n]}var EO=pO,DO=hO,OO=yO,kO=SO,AO=Object.freeze({position:`absolute`,border:0,width:1,height:1,padding:0,margin:-1,overflow:`hidden`,clip:`rect(0, 0, 0, 0)`,whiteSpace:`nowrap`,wordWrap:`normal`}),jO=`VisuallyHidden`,MO=y.forwardRef((e,t)=>(0,Z.jsx)(vS.span,{...e,ref:t,style:{...AO,...e.style}}));MO.displayName=jO;var NO=MO,[PO,FO]=sS(`Tooltip`,[uO]),IO=uO(),LO=`TooltipProvider`,RO=700,zO=`tooltip.open`,[BO,VO]=PO(LO),HO=e=>{let{__scopeTooltip:t,delayDuration:n=RO,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:a}=e,o=y.useRef(!0),s=y.useRef(!1),c=y.useRef(0);return y.useEffect(()=>{let e=c.current;return()=>window.clearTimeout(e)},[]),(0,Z.jsx)(BO,{scope:t,isOpenDelayedRef:o,delayDuration:n,onOpen:y.useCallback(()=>{window.clearTimeout(c.current),o.current=!1},[]),onClose:y.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>o.current=!0,r)},[r]),isPointerInTransitRef:s,onPointerInTransitChange:y.useCallback(e=>{s.current=e},[]),disableHoverableContent:i,children:a})};HO.displayName=LO;var UO=`Tooltip`,[WO,GO]=PO(UO),KO=e=>{let{__scopeTooltip:t,children:n,open:r,defaultOpen:i,onOpenChange:a,disableHoverableContent:o,delayDuration:s}=e,c=VO(UO,e.__scopeTooltip),l=IO(t),[u,d]=y.useState(null),f=fS(),p=y.useRef(0),m=o??c.disableHoverableContent,h=s??c.delayDuration,g=y.useRef(!1),[_,v]=mS({prop:r,defaultProp:i??!1,onChange:e=>{e?(c.onOpen(),document.dispatchEvent(new CustomEvent(zO))):c.onClose(),a?.(e)},caller:UO}),b=y.useMemo(()=>_?g.current?`delayed-open`:`instant-open`:`closed`,[_]),x=y.useCallback(()=>{window.clearTimeout(p.current),p.current=0,g.current=!1,v(!0)},[v]),S=y.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v(!1)},[v]),C=y.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{g.current=!0,v(!0),p.current=0},h)},[h,v]);return y.useEffect(()=>()=>{p.current&&=(window.clearTimeout(p.current),0)},[]),(0,Z.jsx)(EO,{...l,children:(0,Z.jsx)(WO,{scope:t,contentId:f,open:_,stateAttribute:b,trigger:u,onTriggerChange:d,onTriggerEnter:y.useCallback(()=>{c.isOpenDelayedRef.current?C():x()},[c.isOpenDelayedRef,C,x]),onTriggerLeave:y.useCallback(()=>{m?S():(window.clearTimeout(p.current),p.current=0)},[S,m]),onOpen:x,onClose:S,disableHoverableContent:m,children:n})})};KO.displayName=UO;var qO=`TooltipTrigger`,JO=y.forwardRef((e,t)=>{let{__scopeTooltip:n,...r}=e,i=GO(qO,n),a=VO(qO,n),o=IO(n),s=y.useRef(null),c=Kx(t,s,i.onTriggerChange),l=y.useRef(!1),u=y.useRef(!1),d=y.useCallback(()=>l.current=!1,[]);return y.useEffect(()=>()=>document.removeEventListener(`pointerup`,d),[d]),(0,Z.jsx)(DO,{asChild:!0,...o,children:(0,Z.jsx)(vS.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:c,onPointerMove:aS(e.onPointerMove,e=>{e.pointerType!==`touch`&&!u.current&&!a.isPointerInTransitRef.current&&(i.onTriggerEnter(),u.current=!0)}),onPointerLeave:aS(e.onPointerLeave,()=>{i.onTriggerLeave(),u.current=!1}),onPointerDown:aS(e.onPointerDown,()=>{i.open&&i.onClose(),l.current=!0,document.addEventListener(`pointerup`,d,{once:!0})}),onFocus:aS(e.onFocus,()=>{l.current||i.onOpen()}),onBlur:aS(e.onBlur,i.onClose),onClick:aS(e.onClick,i.onClose)})})});JO.displayName=qO;var YO=`TooltipPortal`,[XO,ZO]=PO(YO,{forceMount:void 0}),QO=e=>{let{__scopeTooltip:t,forceMount:n,children:r,container:i}=e,a=GO(YO,t);return(0,Z.jsx)(XO,{scope:t,forceMount:n,children:(0,Z.jsx)(tC,{present:n||a.open,children:(0,Z.jsx)($S,{asChild:!0,container:i,children:r})})})};QO.displayName=YO;var $O=`TooltipContent`,ek=y.forwardRef((e,t)=>{let n=ZO($O,e.__scopeTooltip),{forceMount:r=n.forceMount,side:i=`top`,...a}=e,o=GO($O,e.__scopeTooltip);return(0,Z.jsx)(tC,{present:r||o.open,children:o.disableHoverableContent?(0,Z.jsx)(ak,{side:i,...a,ref:t}):(0,Z.jsx)(tk,{side:i,...a,ref:t})})}),tk=y.forwardRef((e,t)=>{let n=GO($O,e.__scopeTooltip),r=VO($O,e.__scopeTooltip),i=y.useRef(null),a=Kx(t,i),[o,s]=y.useState(null),{trigger:c,onClose:l}=n,u=i.current,{onPointerInTransitChange:d}=r,f=y.useCallback(()=>{s(null),d(!1)},[d]),p=y.useCallback((e,t)=>{let n=e.currentTarget,r={x:e.clientX,y:e.clientY},i=ck(r,n.getBoundingClientRect()),a=lk(r,i),o=uk(t.getBoundingClientRect()),c=fk([...a,...o]);s(c),d(!0)},[d]);return y.useEffect(()=>()=>f(),[f]),y.useEffect(()=>{if(c&&u){let e=e=>p(e,u),t=e=>p(e,c);return c.addEventListener(`pointerleave`,e),u.addEventListener(`pointerleave`,t),()=>{c.removeEventListener(`pointerleave`,e),u.removeEventListener(`pointerleave`,t)}}},[c,u,p,f]),y.useEffect(()=>{if(o){let e=e=>{let t=e.target,n={x:e.clientX,y:e.clientY},r=c?.contains(t)||u?.contains(t),i=!dk(n,o);r?f():i&&(f(),l())};return document.addEventListener(`pointermove`,e),()=>document.removeEventListener(`pointermove`,e)}},[c,u,o,l,f]),(0,Z.jsx)(ak,{...e,ref:a})}),[nk,rk]=PO(UO,{isInside:!1}),ik=Zx(`TooltipContent`),ak=y.forwardRef((e,t)=>{let{__scopeTooltip:n,children:r,"aria-label":i,onEscapeKeyDown:a,onPointerDownOutside:o,...s}=e,c=GO($O,n),l=IO(n),{onClose:u}=c;return y.useEffect(()=>(document.addEventListener(zO,u),()=>document.removeEventListener(zO,u)),[u]),y.useEffect(()=>{if(c.trigger){let e=e=>{e.target?.contains(c.trigger)&&u()};return window.addEventListener(`scroll`,e,{capture:!0}),()=>window.removeEventListener(`scroll`,e,{capture:!0})}},[c.trigger,u]),(0,Z.jsx)(OS,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:a,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:u,children:(0,Z.jsxs)(OO,{"data-state":c.stateAttribute,...l,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":`var(--radix-popper-transform-origin)`,"--radix-tooltip-content-available-width":`var(--radix-popper-available-width)`,"--radix-tooltip-content-available-height":`var(--radix-popper-available-height)`,"--radix-tooltip-trigger-width":`var(--radix-popper-anchor-width)`,"--radix-tooltip-trigger-height":`var(--radix-popper-anchor-height)`},children:[(0,Z.jsx)(ik,{children:r}),(0,Z.jsx)(nk,{scope:n,isInside:!0,children:(0,Z.jsx)(NO,{id:c.contentId,role:`tooltip`,children:i||r})})]})})});ek.displayName=$O;var ok=`TooltipArrow`,sk=y.forwardRef((e,t)=>{let{__scopeTooltip:n,...r}=e,i=IO(n);return rk(ok,n).isInside?null:(0,Z.jsx)(kO,{...i,...r,ref:t})});sk.displayName=ok;function ck(e,t){let n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),i=Math.abs(t.right-e.x),a=Math.abs(t.left-e.x);switch(Math.min(n,r,i,a)){case a:return`left`;case i:return`right`;case n:return`top`;case r:return`bottom`;default:throw Error(`unreachable`)}}function lk(e,t,n=5){let r=[];switch(t){case`top`:r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case`bottom`:r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case`left`:r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case`right`:r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function uk(e){let{top:t,right:n,bottom:r,left:i}=e;return[{x:i,y:t},{x:n,y:t},{x:n,y:r},{x:i,y:r}]}function dk(e,t){let{x:n,y:r}=e,i=!1;for(let e=0,a=t.length-1;e<t.length;a=e++){let o=t[e],s=t[a],c=o.x,l=o.y,u=s.x,d=s.y;l>r!=d>r&&n<(u-c)*(r-l)/(d-l)+c&&(i=!i)}return i}function fk(e){let t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),pk(t)}function pk(e){if(e.length<=1)return e.slice();let t=[];for(let n=0;n<e.length;n++){let r=e[n];for(;t.length>=2;){let e=t[t.length-1],n=t[t.length-2];if((e.x-n.x)*(r.y-n.y)>=(e.y-n.y)*(r.x-n.x))t.pop();else break}t.push(r)}t.pop();let n=[];for(let t=e.length-1;t>=0;t--){let r=e[t];for(;n.length>=2;){let e=n[n.length-1],t=n[n.length-2];if((e.x-t.x)*(r.y-t.y)>=(e.y-t.y)*(r.x-t.x))n.pop();else break}n.push(r)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var mk=HO,hk=KO,gk=JO,_k=QO,vk=ek,yk=mk,bk=hk,xk=gk,Sk=y.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,Z.jsx)(_k,{children:(0,Z.jsx)(vk,{ref:r,sideOffset:t,className:Q(`z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]`,e),...n})}));Sk.displayName=vk.displayName;function Ck({onOpenWallet:e}){return(0,Z.jsxs)(`header`,{className:`flex items-center justify-between border-b border-border px-4 py-3 md:hidden`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Z.jsxs)(hT,{children:[(0,Z.jsx)(gT,{asChild:!0,children:(0,Z.jsx)($,{variant:`outline`,size:`icon`,children:(0,Z.jsx)(Cb,{className:`h-4 w-4`})})}),(0,Z.jsxs)(bT,{side:`left`,className:`w-[280px] sm:w-[320px]`,children:[(0,Z.jsxs)(xT,{className:`sr-only`,children:[(0,Z.jsx)(CT,{children:`Navigation`}),(0,Z.jsx)(wT,{children:`Select a destination`})]}),(0,Z.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,Z.jsx)(`span`,{className:`text-lg font-semibold`,children:`Nullify`})}),(0,Z.jsx)(zT,{className:`my-4`}),(0,Z.jsxs)(`div`,{className:`space-y-4`,children:[(0,Z.jsx)($,{variant:`outline`,className:`w-full`,onClick:e,children:`Manage wallet`}),(0,Z.jsxs)(jt,{to:`/settings`,className:({isActive:e})=>Q(`flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition`,e?`bg-muted text-foreground`:`text-muted-foreground hover:text-foreground`),onClick:()=>{},children:[(0,Z.jsx)(Ob,{className:`h-4 w-4`}),`Settings`]})]})]})]}),(0,Z.jsx)(`span`,{className:`text-lg font-semibold`,children:`NukeNote`})]}),(0,Z.jsx)($,{variant:`ghost`,size:`icon`,onClick:e,children:(0,Z.jsx)(Lb,{className:`h-5 w-5`})})]})}function wk(){let[e,t]=(0,y.useState)(!1),[n,r]=(0,y.useState)(!1),[i,a]=(0,y.useState)(!1),o=ze(),{connectWallet:s,disconnectWallet:c,isConnected:l,isLoading:u}=Yy(),{notifications:d,removeNotification:f,clearNotifications:p}=Gy();(0,y.useEffect)(()=>{a(!1)},[o.pathname]);let m=(0,y.useCallback)(()=>{a(e=>!e)},[]),h=(0,y.useCallback)(()=>t(!0),[]),g=(0,y.useCallback)(async()=>{try{await s()}catch(e){console.error(`[MainLayout] connect failed`,e)}},[s]),_=(0,y.useCallback)(async()=>{try{await c()}catch(e){console.error(`[MainLayout] disconnect failed`,e)}},[c]);return(0,Z.jsxs)(Vb.Provider,{value:{railCollapsed:i,toggleRail:m},children:[(0,Z.jsxs)(`div`,{className:`relative flex h-screen bg-background text-foreground`,children:[(0,Z.jsx)(`button`,{type:`button`,onClick:m,"aria-label":i?`Show navigation`:`Hide navigation`,className:`absolute left-4 top-4 z-50 hidden h-10 w-10 items-center justify-center rounded-md text-foreground transition hover:bg-muted md:flex`,children:(0,Z.jsx)(Cb,{className:`h-5 w-5`})}),(0,Z.jsx)(`aside`,{className:Q(`hidden overflow-hidden border-border bg-muted/10 transition-all duration-300 md:flex md:flex-col md:items-center`,i?`w-0 border-r-0`:`w-[72px] border-r`),children:(0,Z.jsx)(yk,{delayDuration:200,children:(0,Z.jsxs)(`div`,{className:Q(`flex h-full flex-col items-center justify-start gap-3 pt-16 pb-4 transition-opacity duration-200`,i&&`pointer-events-none opacity-0`),children:[(0,Z.jsx)(jt,{to:`/messages`,className:({isActive:e})=>Q(`flex h-12 w-12 shrink-0 items-center justify-center rounded-lg transition`,e?`bg-primary/10 text-primary`:`text-muted-foreground hover:bg-muted/50 hover:text-foreground`),"aria-label":`Messages`,children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)(wb,{className:`h-5 w-5 shrink-0`})}),(0,Z.jsx)(Sk,{side:`right`,children:`Messages`})]})}),(0,Z.jsx)(jt,{to:`/contacts`,className:({isActive:e})=>Q(`flex h-12 w-12 shrink-0 items-center justify-center rounded-lg transition`,e?`bg-primary/10 text-primary`:`text-muted-foreground hover:bg-muted/50 hover:text-foreground`),"aria-label":`Contacts`,children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)(Ib,{className:`h-5 w-5 shrink-0`})}),(0,Z.jsx)(Sk,{side:`right`,children:`Contacts`})]})}),(0,Z.jsxs)(`div`,{className:`mt-auto flex flex-col items-center gap-2`,children:[(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)(`button`,{type:`button`,onClick:h,className:Q(`flex h-12 w-12 shrink-0 items-center justify-center rounded-lg transition hover:bg-muted/50`,l?`text-emerald-500`:`text-red-500`),"aria-label":`Wallet status`,children:(0,Z.jsx)(Lb,{className:`h-5 w-5 shrink-0`})})}),(0,Z.jsx)(Sk,{side:`right`,children:l?`Wallet connected`:`Wallet disconnected`})]}),(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsxs)(`button`,{type:`button`,onClick:()=>r(!0),className:`relative flex h-12 w-12 shrink-0 items-center justify-center rounded-lg text-muted-foreground transition hover:bg-muted/50 hover:text-foreground`,"aria-label":`Notifications`,children:[(0,Z.jsx)(ob,{className:`h-5 w-5 shrink-0`}),d.length>0&&(0,Z.jsx)(`span`,{className:`absolute top-2 right-2 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-semibold text-white`,children:d.length})]})}),(0,Z.jsxs)(Sk,{side:`right`,children:[`Notifications `,d.length>0&&`(${d.length})`]})]}),(0,Z.jsx)(jt,{to:`/settings`,className:({isActive:e})=>Q(`flex h-12 w-12 shrink-0 items-center justify-center rounded-lg transition`,e?`bg-primary/10 text-primary`:`text-muted-foreground hover:bg-muted/50 hover:text-foreground`),"aria-label":`Settings`,children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)(Ob,{className:`h-5 w-5 shrink-0`})}),(0,Z.jsx)(Sk,{side:`right`,children:`Settings`})]})})]})]})})}),(0,Z.jsxs)(`div`,{className:`flex flex-1 flex-col min-h-0`,children:[(0,Z.jsx)(Ck,{onOpenWallet:h}),(0,Z.jsx)(`main`,{className:`flex flex-1 overflow-hidden`,children:(0,Z.jsx)(pt,{context:{railCollapsed:i,toggleRail:m}})})]})]}),(0,Z.jsx)(TT,{open:e,onOpenChange:t,children:(0,Z.jsxs)(OT,{className:`sm:max-w-[420px]`,children:[(0,Z.jsxs)(kT,{children:[(0,Z.jsx)(jT,{children:`Wallet connection`}),(0,Z.jsx)(MT,{children:`Check status or switch wallets.`})]}),(0,Z.jsxs)(`div`,{className:`space-y-4`,children:[(0,Z.jsx)(Ux,{}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)($,{onClick:g,disabled:l||u,className:`flex-1`,children:u?`Connecting`:`Connect`}),(0,Z.jsx)($,{onClick:_,variant:`outline`,disabled:!l,className:`flex-1`,children:`Disconnect`})]})]}),(0,Z.jsx)(AT,{className:`mt-4 text-xs text-muted-foreground`,children:`Wallet actions require Metanet Desktop or another compatible substrate running locally.`})]})}),(0,Z.jsx)(TT,{open:n,onOpenChange:r,children:(0,Z.jsxs)(OT,{className:`sm:max-w-[480px]`,children:[(0,Z.jsx)(kT,{children:(0,Z.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(jT,{children:`Notifications`}),(0,Z.jsx)(MT,{children:`Recent activity and payment updates`})]}),d.length>0&&(0,Z.jsx)($,{variant:`ghost`,size:`sm`,onClick:p,className:`text-xs`,children:`Clear all`})]})}),(0,Z.jsx)(`div`,{className:`max-h-[400px] space-y-3 overflow-y-auto`,children:d.length===0?(0,Z.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-8 text-center text-muted-foreground`,children:[(0,Z.jsx)(ob,{className:`mb-2 h-8 w-8 opacity-30`}),(0,Z.jsx)(`p`,{className:`text-sm`,children:`No notifications`})]}):d.map(e=>(0,Z.jsx)(`div`,{className:Q(`rounded-lg border p-3 text-sm`,e.type===`success`&&`border-emerald-500/20 bg-emerald-500/5`,e.type===`error`&&`border-red-500/20 bg-red-500/5`,e.type===`warning`&&`border-amber-500/20 bg-amber-500/5`,e.type===`info`&&`border-blue-500/20 bg-blue-500/5`),children:(0,Z.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,Z.jsxs)(`div`,{className:`flex-1`,children:[(0,Z.jsx)(`p`,{className:`text-foreground`,children:e.message}),e.timestamp&&(0,Z.jsx)(`p`,{className:`mt-1 text-xs text-muted-foreground`,children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,Z.jsx)(`button`,{onClick:()=>f(e.id),className:`shrink-0 rounded-sm p-0.5 text-muted-foreground hover:text-foreground hover:bg-muted/50 transition`,"aria-label":`Dismiss notification`,children:(0,Z.jsx)(Bb,{className:`h-4 w-4`})})]})},e.id))})]})})]})}var Tk=o(((e,t)=>{
/*!
localForage -- Offline Storage, Improved
Version 1.10.0
https://localforage.github.io/localForage
(c) 2013-2017 Mozilla, Apache License 2.0
*/
(function(n){if(typeof e==`object`&&t!==void 0)t.exports=n();else if(typeof define==`function`&&define.amd)define([],n);else{var r=typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:this;r.localforage=n()}})(function(){return(function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){var c=typeof u==`function`&&u;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var l=Error(`Cannot find module '`+o+`'`);throw l.code=`MODULE_NOT_FOUND`,l}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n||e)},d,d.exports,e,t,n,r)}return n[o].exports}for(var a=typeof u==`function`&&u,o=0;o<r.length;o++)i(r[o]);return i})({1:[function(e,t,n){(function(e){var n=e.MutationObserver||e.WebKitMutationObserver,r;if(n){var i=0,a=new n(u),o=e.document.createTextNode(``);a.observe(o,{characterData:!0}),r=function(){o.data=i=++i%2}}else if(!e.setImmediate&&e.MessageChannel!==void 0){var s=new e.MessageChannel;s.port1.onmessage=u,r=function(){s.port2.postMessage(0)}}else r=`document`in e&&`onreadystatechange`in e.document.createElement(`script`)?function(){var t=e.document.createElement(`script`);t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};var c,l=[];function u(){c=!0;for(var e,t,n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}c=!1}t.exports=d;function d(e){l.push(e)===1&&!c&&r()}}).call(this,typeof global<`u`?global:typeof self<`u`?self:typeof window<`u`?window:{})},{}],2:[function(e,t,n){var r=e(1);function i(){}var a={},o=[`REJECTED`],s=[`FULFILLED`],c=[`PENDING`];t.exports=l;function l(e){if(typeof e!=`function`)throw TypeError(`resolver must be a function`);this.state=c,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if(typeof e!=`function`&&this.state===s||typeof t!=`function`&&this.state===o)return this;var n=new this.constructor(i);if(this.state!==c){var r=this.state===s?e:t;d(n,r,this.outcome)}else this.queue.push(new u(n,e,t));return n};function u(e,t,n){this.promise=e,typeof t==`function`&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),typeof n==`function`&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}u.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){a.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)};function d(e,t,n){r(function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,TypeError(`Cannot resolve promise with itself`)):a.resolve(e,r)})}a.resolve=function(e,t){var n=m(f,t);if(n.status===`error`)return a.reject(e,n.value);var r=n.value;if(r)p(e,r);else{e.state=s,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e};function f(e){var t=e&&e.then;if(e&&(typeof e==`object`||typeof e==`function`)&&typeof t==`function`)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function i(t){n||(n=!0,a.resolve(e,t))}function o(){t(i,r)}var s=m(o);s.status===`error`&&r(s.value)}function m(e,t){var n={};try{n.value=e(t),n.status=`success`}catch(e){n.status=`error`,n.value=e}return n}l.resolve=h;function h(e){return e instanceof this?e:a.resolve(new this(i),e)}l.reject=g;function g(e){var t=new this(i);return a.reject(t,e)}l.all=_;function _(e){var t=this;if(Object.prototype.toString.call(e)!==`[object Array]`)return this.reject(TypeError(`must be an array`));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=Array(n),s=0,c=-1,l=new this(i);++c<n;)u(e[c],c);return l;function u(e,i){t.resolve(e).then(c,function(e){r||(r=!0,a.reject(l,e))});function c(e){o[i]=e,++s===n&&!r&&(r=!0,a.resolve(l,o))}}}l.race=v;function v(e){var t=this;if(Object.prototype.toString.call(e)!==`[object Array]`)return this.reject(TypeError(`must be an array`));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,s=new this(i);++o<n;)c(e[o]);return s;function c(e){t.resolve(e).then(function(e){r||(r=!0,a.resolve(s,e))},function(e){r||(r=!0,a.reject(s,e))})}}},{1:1}],3:[function(e,t,n){(function(t){typeof t.Promise!=`function`&&(t.Promise=e(2))}).call(this,typeof global<`u`?global:typeof self<`u`?self:typeof window<`u`?window:{})},{2:2}],4:[function(e,t,n){var r=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e};function i(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function a(){try{if(typeof indexedDB<`u`)return indexedDB;if(typeof webkitIndexedDB<`u`)return webkitIndexedDB;if(typeof mozIndexedDB<`u`)return mozIndexedDB;if(typeof OIndexedDB<`u`)return OIndexedDB;if(typeof msIndexedDB<`u`)return msIndexedDB}catch{return}}var o=a();function s(){try{if(!o||!o.open)return!1;var e=typeof openDatabase<`u`&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t=typeof fetch==`function`&&fetch.toString().indexOf(`[native code`)!==-1;return(!e||t)&&typeof indexedDB<`u`&&typeof IDBKeyRange<`u`}catch{return!1}}function c(e,t){e||=[],t||={};try{return new Blob(e,t)}catch(i){if(i.name!==`TypeError`)throw i;for(var n=new(typeof BlobBuilder<`u`?BlobBuilder:typeof MSBlobBuilder<`u`?MSBlobBuilder:typeof MozBlobBuilder<`u`?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}typeof Promise>`u`&&e(3);var l=Promise;function u(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function d(e,t,n){typeof t==`function`&&e.then(t),typeof n==`function`&&e.catch(n)}function f(e){return typeof e!=`string`&&(console.warn(e+` used as a key, but it is not a string.`),e=String(e)),e}function p(){if(arguments.length&&typeof arguments[arguments.length-1]==`function`)return arguments[arguments.length-1]}var m=`local-forage-detect-blob-support`,h=void 0,g={},_=Object.prototype.toString,v=`readonly`,y=`readwrite`;function b(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function x(e){return new l(function(t){var n=e.transaction(m,y),r=c([``]);n.objectStore(m).put(r,`key`),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}function S(e){return typeof h==`boolean`?l.resolve(h):x(e).then(function(e){return h=e,h})}function C(e){var t=g[e.name],n={};n.promise=new l(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function w(e){var t=g[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function T(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function E(e,t){return new l(function(n,r){if(g[e.name]=g[e.name]||re(),e.db)if(t)C(e),e.db.close();else return n(e.db);var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(m)}catch(n){if(n.name===`ConstraintError`)console.warn(`The database "`+e.name+`" has been upgraded from version `+t.oldVersion+` to version `+t.newVersion+`, but the storage "`+e.storeName+`" already exists.`);else throw n}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},n(t),w(e)}})}function D(e){return E(e,!1)}function O(e){return E(e,!0)}function k(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn(`The database "`+e.name+`" can't be downgraded from version `+e.db.version+` to version `+e.version+`.`),e.version=e.db.version),i||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function A(e){return new l(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||``);t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}function ee(e){var t=b(atob(e.data));return c([t],{type:e.type})}function te(e){return e&&e.__local_forage_encoded_blob}function ne(e){var t=this,n=t._initReady().then(function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return d(n,e,e),n}function j(e){C(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,D(e).then(function(t){return e.db=t,k(e)?O(e):t}).then(function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r}).catch(function(t){throw T(e,t),t})}function M(e,t,n,r){r===void 0&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||i.name===`InvalidStateError`||i.name===`NotFoundError`))return l.resolve().then(function(){if(!e.db||i.name===`NotFoundError`&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),O(e)}).then(function(){return j(e).then(function(){M(e,t,n,r-1)})}).catch(n);n(i)}}function re(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ie(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=g[n.name];i||(i=re(),g[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=ne);var a=[];function o(){return l.resolve()}for(var s=0;s<i.forages.length;s++){var c=i.forages[s];c!==t&&a.push(c._initReady().catch(o))}var u=i.forages.slice(0);return l.all(a).then(function(){return n.db=i.db,D(n)}).then(function(e){return n.db=e,k(n,t._defaultConfig.version)?O(n):e}).then(function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var a=u[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}})}function ae(e,t){var n=this;e=f(e);var r=new l(function(t,r){n.ready().then(function(){M(n._dbInfo,v,function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;e===void 0&&(e=null),te(e)&&(e=ee(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function oe(e,t){var n=this,r=new l(function(t,r){n.ready().then(function(){M(n._dbInfo,v,function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;te(r)&&(r=ee(r));var i=e(r,n.key,s++);i===void 0?n.continue():t(i)}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function se(e,t,n){var r=this;e=f(e);var i=new l(function(n,i){var a;r.ready().then(function(){return a=r._dbInfo,_.call(t)===`[object Blob]`?S(a.db).then(function(e){return e?t:A(t)}):t}).then(function(t){M(r._dbInfo,y,function(a,o){if(a)return i(a);try{var s=o.objectStore(r._dbInfo.storeName);t===null&&(t=void 0);var c=s.put(t,e);o.oncomplete=function(){t===void 0&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return u(i,n),i}function ce(e,t){var n=this;e=f(e);var r=new l(function(t,r){n.ready().then(function(){M(n._dbInfo,y,function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(o.error)},a.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function le(e){var t=this,n=new l(function(e,n){t.ready().then(function(){M(t._dbInfo,y,function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return u(n,e),n}function ue(e){var t=this,n=new l(function(e,n){t.ready().then(function(){M(t._dbInfo,v,function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(e){n(e)}})}).catch(n)});return u(n,e),n}function de(e,t){var n=this,r=new l(function(t,r){if(e<0){t(null);return}n.ready().then(function(){M(n._dbInfo,v,function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName),s=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;if(!n){t(null);return}e===0||s?t(n.key):(s=!0,n.advance(e))},c.onerror=function(){r(c.error)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function fe(e){var t=this,n=new l(function(e,n){t.ready().then(function(){M(t._dbInfo,v,function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];a.onsuccess=function(){var t=a.result;if(!t){e(o);return}o.push(t.key),t.continue()},a.onerror=function(){n(a.error)}}catch(e){n(e)}})}).catch(n)});return u(n,e),n}function pe(e,t){t=p.apply(this,arguments);var n=this.config();e=typeof e!=`function`&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,i;if(!e.name)i=l.reject(`Invalid arguments`);else{var a=e.name===n.name&&r._dbInfo.db?l.resolve(r._dbInfo.db):D(e).then(function(t){var n=g[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t});i=e.storeName?a.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;C(e);var r=g[e.name],i=r.forages;t.close();for(var a=0;a<i.length;a++){var s=i[a];s._dbInfo.db=null,s._dbInfo.version=n}return new l(function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,w(n._dbInfo)}}).catch(function(t){throw(T(e,t)||l.resolve()).catch(function(){}),t})}}):a.then(function(t){C(e);var n=g[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++){var a=r[i];a._dbInfo.db=null}return new l(function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn(`dropInstance blocked for database "`+e.name+`" until all open connections are closed`)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<r.length;t++){var i=r[t];w(i._dbInfo)}}).catch(function(t){throw(T(e,t)||l.resolve()).catch(function(){}),t})})}return u(i,t),i}var me={_driver:`asyncStorage`,_initStorage:ie,_support:s(),iterate:oe,getItem:ae,setItem:se,removeItem:ce,clear:le,length:ue,key:de,keys:fe,dropInstance:pe};function he(){return typeof openDatabase==`function`}var ge=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,_e=`~~local_forage_type~`,ve=/^~~local_forage_type~([^~]+)~/,ye=`__lfsc__:`,be=ye.length,xe=`arbf`,Se=`blob`,Ce=`si08`,we=`ui08`,Te=`uic8`,Ee=`si16`,De=`si32`,Oe=`ur16`,ke=`ui32`,Ae=`fl32`,je=`fl64`,Me=be+xe.length,Ne=Object.prototype.toString;function Pe(e){var t=e.length*.75,n=e.length,r,i=0,a,o,s,c;e[e.length-1]===`=`&&(t--,e[e.length-2]===`=`&&t--);var l=new ArrayBuffer(t),u=new Uint8Array(l);for(r=0;r<n;r+=4)a=ge.indexOf(e[r]),o=ge.indexOf(e[r+1]),s=ge.indexOf(e[r+2]),c=ge.indexOf(e[r+3]),u[i++]=a<<2|o>>4,u[i++]=(o&15)<<4|s>>2,u[i++]=(s&3)<<6|c&63;return l}function Fe(e){var t=new Uint8Array(e),n=``,r;for(r=0;r<t.length;r+=3)n+=ge[t[r]>>2],n+=ge[(t[r]&3)<<4|t[r+1]>>4],n+=ge[(t[r+1]&15)<<2|t[r+2]>>6],n+=ge[t[r+2]&63];return t.length%3==2?n=n.substring(0,n.length-1)+`=`:t.length%3==1&&(n=n.substring(0,n.length-2)+`==`),n}function Ie(e,t){var n=``;if(e&&(n=Ne.call(e)),e&&(n===`[object ArrayBuffer]`||e.buffer&&Ne.call(e.buffer)===`[object ArrayBuffer]`)){var r,i=ye;e instanceof ArrayBuffer?(r=e,i+=xe):(r=e.buffer,n===`[object Int8Array]`?i+=Ce:n===`[object Uint8Array]`?i+=we:n===`[object Uint8ClampedArray]`?i+=Te:n===`[object Int16Array]`?i+=Ee:n===`[object Uint16Array]`?i+=Oe:n===`[object Int32Array]`?i+=De:n===`[object Uint32Array]`?i+=ke:n===`[object Float32Array]`?i+=Ae:n===`[object Float64Array]`?i+=je:t(Error(`Failed to get type for BinaryArray`))),t(i+Fe(r))}else if(n===`[object Blob]`){var a=new FileReader;a.onload=function(){var n=_e+e.type+`~`+Fe(this.result);t(ye+Se+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error(`Couldn't convert value into a JSON string: `,e),t(null,n)}}function Le(e){if(e.substring(0,be)!==ye)return JSON.parse(e);var t=e.substring(Me),n=e.substring(be,Me),r;if(n===Se&&ve.test(t)){var i=t.match(ve);r=i[1],t=t.substring(i[0].length)}var a=Pe(t);switch(n){case xe:return a;case Se:return c([a],{type:r});case Ce:return new Int8Array(a);case we:return new Uint8Array(a);case Te:return new Uint8ClampedArray(a);case Ee:return new Int16Array(a);case Oe:return new Uint16Array(a);case De:return new Int32Array(a);case ke:return new Uint32Array(a);case Ae:return new Float32Array(a);case je:return new Float64Array(a);default:throw Error(`Unkown type: `+n)}}var Re={serialize:Ie,deserialize:Le,stringToBuffer:Pe,bufferToString:Fe};function ze(e,t,n,r){e.executeSql(`CREATE TABLE IF NOT EXISTS `+t.storeName+` (id INTEGER PRIMARY KEY, key unique, value)`,[],n,r)}function Be(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=typeof e[r]==`string`?e[r]:e[r].toString();var i=new l(function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction(function(i){ze(i,n,function(){t._dbInfo=n,e()},function(e,t){r(t)})},r)});return n.serializer=Re,i}function Ve(e,t,n,r,i,a){e.executeSql(n,r,i,function(e,o){o.code===o.SYNTAX_ERR?e.executeSql(`SELECT name FROM sqlite_master WHERE type='table' AND name = ?`,[t.storeName],function(e,s){s.rows.length?a(e,o):ze(e,t,function(){e.executeSql(n,r,i,a)},a)},a):a(e,o)},a)}function He(e,t){var n=this;e=f(e);var r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){Ve(n,i,`SELECT * FROM `+i.storeName+` WHERE key = ? LIMIT 1`,[e],function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&=i.serializer.deserialize(r),t(r)},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function Ue(e,t){var n=this,r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){Ve(n,i,`SELECT * FROM `+i.storeName,[],function(n,r){for(var a=r.rows,o=a.length,s=0;s<o;s++){var c=a.item(s),l=c.value;if(l&&=i.serializer.deserialize(l),l=e(l,c.key,s+1),l!==void 0){t(l);return}}t()},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function We(e,t,n,r){var i=this;e=f(e);var a=new l(function(a,o){i.ready().then(function(){t===void 0&&(t=null);var s=t,c=i._dbInfo;c.serializer.serialize(t,function(t,l){l?o(l):c.db.transaction(function(n){Ve(n,c,`INSERT OR REPLACE INTO `+c.storeName+` (key, value) VALUES (?, ?)`,[e,t],function(){a(s)},function(e,t){o(t)})},function(t){if(t.code===t.QUOTA_ERR){if(r>0){a(We.apply(i,[e,s,n,r-1]));return}o(t)}})})}).catch(o)});return u(a,n),a}function Ge(e,t,n){return We.apply(this,[e,t,n,1])}function Ke(e,t){var n=this;e=f(e);var r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){Ve(n,i,`DELETE FROM `+i.storeName+` WHERE key = ?`,[e],function(){t()},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function qe(e){var t=this,n=new l(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){Ve(t,r,`DELETE FROM `+r.storeName,[],function(){e()},function(e,t){n(t)})})}).catch(n)});return u(n,e),n}function Je(e){var t=this,n=new l(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){Ve(t,r,`SELECT COUNT(key) as c FROM `+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})}).catch(n)});return u(n,e),n}function Ye(e,t){var n=this,r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){Ve(n,i,`SELECT key FROM `+i.storeName+` WHERE id = ? LIMIT 1`,[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function Xe(e){var t=this,n=new l(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){Ve(t,r,`SELECT key FROM `+r.storeName,[],function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)},function(e,t){n(t)})})}).catch(n)});return u(n,e),n}function Ze(e){return new l(function(t,n){e.transaction(function(r){r.executeSql(`SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'`,[],function(n,r){for(var i=[],a=0;a<r.rows.length;a++)i.push(r.rows.item(a).name);t({db:e,storeNames:i})},function(e,t){n(t)})},function(e){n(e)})})}function Qe(e,t){t=p.apply(this,arguments);var n=this.config();e=typeof e!=`function`&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,i=e.name?new l(function(t){var i=e.name===n.name?r._dbInfo.db:openDatabase(e.name,``,``,0);e.storeName?t({db:i,storeNames:[e.storeName]}):t(Ze(i))}).then(function(e){return new l(function(t,n){e.db.transaction(function(r){function i(e){return new l(function(t,n){r.executeSql(`DROP TABLE IF EXISTS `+e,[],function(){t()},function(e,t){n(t)})})}for(var a=[],o=0,s=e.storeNames.length;o<s;o++)a.push(i(e.storeNames[o]));l.all(a).then(function(){t()}).catch(function(e){n(e)})},function(e){n(e)})})}):l.reject(`Invalid arguments`);return u(i,t),i}var $e={_driver:`webSQLStorage`,_initStorage:Be,_support:he(),iterate:Ue,getItem:He,setItem:Ge,removeItem:Ke,clear:qe,length:Je,key:Ye,keys:Xe,dropInstance:Qe};function et(){try{return typeof localStorage<`u`&&`setItem`in localStorage&&!!localStorage.setItem}catch{return!1}}function tt(e,t){var n=e.name+`/`;return e.storeName!==t.storeName&&(n+=e.storeName+`/`),n}function nt(){var e=`_localforage_support_test`;try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function rt(){return!nt()||localStorage.length>0}function it(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=tt(e,t._defaultConfig),rt()?(t._dbInfo=n,n.serializer=Re,l.resolve()):l.reject()}function at(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);r.indexOf(e)===0&&localStorage.removeItem(r)}});return u(n,e),n}function ot(e,t){var n=this;e=f(e);var r=n.ready().then(function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&=t.serializer.deserialize(r),r});return u(r,t),r}function st(e,t){var n=this,r=n.ready().then(function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,a=localStorage.length,o=1,s=0;s<a;s++){var c=localStorage.key(s);if(c.indexOf(r)===0){var l=localStorage.getItem(c);if(l&&=t.serializer.deserialize(l),l=e(l,c.substring(i),o++),l!==void 0)return l}}});return u(r,t),r}function ct(e,t){var n=this,r=n.ready().then(function(){var t=n._dbInfo,r;try{r=localStorage.key(e)}catch{r=null}return r&&=r.substring(t.keyPrefix.length),r});return u(r,t),r}function lt(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var a=localStorage.key(i);a.indexOf(e.keyPrefix)===0&&r.push(a.substring(e.keyPrefix.length))}return r});return u(n,e),n}function ut(e){var t=this.keys().then(function(e){return e.length});return u(t,e),t}function dt(e,t){var n=this;e=f(e);var r=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return u(r,t),r}function ft(e,t,n){var r=this;e=f(e);var i=r.ready().then(function(){t===void 0&&(t=null);var n=t;return new l(function(i,a){var o=r._dbInfo;o.serializer.serialize(t,function(t,r){if(r)a(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){(e.name===`QuotaExceededError`||e.name===`NS_ERROR_DOM_QUOTA_REACHED`)&&a(e),a(e)}})})});return u(i,n),i}function pt(e,t){if(t=p.apply(this,arguments),e=typeof e!=`function`&&e||{},!e.name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r=this,i=e.name?new l(function(t){e.storeName?t(tt(e,r._defaultConfig)):t(e.name+`/`)}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);n.indexOf(e)===0&&localStorage.removeItem(n)}}):l.reject(`Invalid arguments`);return u(i,t),i}var mt={_driver:`localStorageWrapper`,_initStorage:it,_support:et(),iterate:st,getItem:ot,setItem:ft,removeItem:dt,clear:at,length:ut,key:ct,keys:lt,dropInstance:pt},ht=function(e,t){return e===t||typeof e==`number`&&typeof t==`number`&&isNaN(e)&&isNaN(t)},gt=function(e,t){for(var n=e.length,r=0;r<n;){if(ht(e[r],t))return!0;r++}return!1},_t=Array.isArray||function(e){return Object.prototype.toString.call(e)===`[object Array]`},vt={},yt={},bt={INDEXEDDB:me,WEBSQL:$e,LOCALSTORAGE:mt},xt=[bt.INDEXEDDB._driver,bt.WEBSQL._driver,bt.LOCALSTORAGE._driver],St=[`dropInstance`],Ct=[`clear`,`getItem`,`iterate`,`key`,`keys`,`length`,`removeItem`,`setItem`].concat(St),wt={description:``,driver:xt.slice(),name:`localforage`,size:4980736,storeName:`keyvaluepairs`,version:1};function Tt(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function Et(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(_t(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}t.exports=new(function(){function e(t){for(var n in i(this,e),bt)if(bt.hasOwnProperty(n)){var r=bt[n],a=r._driver;this[n]=a,vt[a]||this.defineDriver(r)}this._defaultConfig=Et({},wt),this._config=Et({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if((e===void 0?`undefined`:r(e))===`object`){if(this._ready)return Error(`Can't call config() after localforage has been used.`);for(var t in e){if(t===`storeName`&&(e[t]=e[t].replace(/\W/g,`_`)),t===`version`&&typeof e[t]!=`number`)return Error(`Database version must be a number.`);this._config[t]=e[t]}return`driver`in e&&e.driver?this.setDriver(this._config.driver):!0}else if(typeof e==`string`)return this._config[e];else return this._config},e.prototype.defineDriver=function(e,t,n){var r=new l(function(t,n){try{var r=e._driver,i=Error(`Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver`);if(!e._driver){n(i);return}for(var a=Ct.concat(`_initStorage`),o=0,s=a.length;o<s;o++){var c=a[o];if((!gt(St,c)||e[c])&&typeof e[c]!=`function`){n(i);return}}(function(){for(var t=function(e){return function(){var t=Error(`Method `+e+` is not implemented by the current driver`),n=l.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=St.length;n<r;n++){var i=St[n];e[i]||(e[i]=t(i))}})();var d=function(n){vt[r]&&console.info(`Redefining LocalForage driver: `+r),vt[r]=e,yt[r]=n,t()};`_support`in e?e._support&&typeof e._support==`function`?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}});return d(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=vt[e]?l.resolve(vt[e]):l.reject(Error(`Driver not found.`));return d(r,t,n),r},e.prototype.getSerializer=function(e){var t=l.resolve(Re);return d(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return t._ready===null&&(t._ready=t._initDriver()),t._ready});return d(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;_t(e)||(e=[e]);var i=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function o(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}function s(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}a();var s=Error(`No available storage method found.`);return r._driverSet=l.reject(s),r._driverSet}return n()}}return this._driverSet=(this._driverSet===null?l.resolve():this._driverSet.catch(function(){return l.resolve()})).then(function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then(function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=s(i)})}).catch(function(){a();var e=Error(`No available storage method found.`);return r._driverSet=l.reject(e),r._driverSet}),d(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!yt[e]},e.prototype._extend=function(e){Et(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Ct.length;e<t;e++)Tt(this,Ct[e])},e.prototype.createInstance=function(t){return new e(t)},e}())},{3:3}]},{},[4])(4)})})),Ek=l(Tk()),Dk=15e3;function Ok(){return!!(Ks.REMOTE_MESSAGING_ENABLED&&Ks.REMOTE_MESSAGING_API_URL)}async function kk(){let e=oc.getStatus?.()||{};if(e?.wallet&&e?.identityKey)return e;if(typeof oc.initialize==`function`)try{return await oc.initialize()||oc.getStatus?.()||{}}catch(t){return console.warn(`[remoteClient] wallet bootstrap failed`,t),e}return e}async function Ak(e,{method:t=`GET`,headers:n,body:r,signal:i,timeoutMs:a=Dk}={}){let o=new AbortController,s=setTimeout(()=>o.abort(),a);try{let a=await fetch(e,{method:t,headers:n,body:r,signal:i||o.signal}),s=(a.headers.get(`content-type`)||``).includes(`application/json`)?await a.json().catch(()=>null):await a.text().catch(()=>null);if(!a.ok){let e=Error(`Remote messaging request failed: ${a.status}`);throw e.status=a.status,e.payload=s,e}return s}finally{clearTimeout(s)}}async function jk(e,t){let n=Ks.REMOTE_MESSAGING_API_URL;if(!n)throw Error(`Remote messaging API URL not configured`);if(!e||!t)throw Error(`Wallet identity required for remote messaging auth`);let r=(await Ak(`${n}/v1/auth/nonce`,{method:`POST`,headers:{"content-type":`application/json`},body:JSON.stringify({publicKey:t})}))?.nonce;if(!r)throw Error(`Remote messaging auth nonce invalid`);let i=await e.createSignature?.({data:r}),a=i?.signature||i;if(!a)throw Error(`Wallet failed to sign nonce for remote messaging`);let o=(await Ak(`${n}/v1/auth/token`,{method:`POST`,headers:{"content-type":`application/json`},body:JSON.stringify({publicKey:t,nonce:r,signature:a})}))?.token;if(!o)throw Error(`Remote messaging token not issued`);return o}async function Mk(){if(!Ok())return null;let e=await kk(),t=e?.wallet,n=e?.identityKey;if(!t||!n||typeof t.createSignature!=`function`)return console.warn(`[remoteClient] wallet identity or signature capability missing; remote sync disabled`),null;let r=Ks.REMOTE_MESSAGING_API_URL.replace(/\/$/,``),i={token:null,tokenExpiresAt:0};async function a(){let e=Date.now();if(i.token&&i.tokenExpiresAt>e+15e3)return i.token;let r=await jk(t,n);return i.token=r,i.tokenExpiresAt=e+3e5,r}async function o(e,t={}){let o=await a(),s={accept:`application/json`,...t.headers||{},authorization:`Bearer ${o}`,"x-nn-wallet-pubkey":n};t.body&&!s[`content-type`]&&(s[`content-type`]=`application/json`);try{return await Ak(`${r}${e}`,{...t,headers:s})}catch(e){throw e.status===401&&(i.token=null,i.tokenExpiresAt=0),e}}async function s(e,t){if(!e||!t)return null;try{return await o(`/v1/threads/${e}/metadata`,{method:`PUT`,body:JSON.stringify(t)})}catch(t){throw console.warn(`[remoteClient] metadata upload failed`,e,t),t}}async function c(e,t){if(!e||!t)return null;try{return await o(`/v1/threads/${e}/messages`,{method:`POST`,body:JSON.stringify(t)})}catch(t){throw console.warn(`[remoteClient] message upload failed`,e,t),t}}async function l(e,{sinceRevision:t,limit:n}={}){if(!e)return{messages:[],nextRevision:null};let r=new URLSearchParams;t!=null&&r.set(`sinceRevision`,String(t)),n&&r.set(`limit`,String(n));let i=r.toString()?`?${r.toString()}`:``;try{return await o(`/v1/threads/${e}/messages${i}`,{method:`GET`})}catch(t){if(t.status===404)return{messages:[],nextRevision:null};throw console.warn(`[remoteClient] fetch messages failed`,e,t),t}}async function u(e,{revisionSince:t}={}){if(!e)return null;let n=new URLSearchParams;t!=null&&n.set(`revisionSince`,String(t));let r=n.toString()?`?${n}`:``;try{return await o(`/v1/threads/${e}/metadata${r}`,{method:`GET`})}catch(t){if(t.status===404)return null;throw console.warn(`[remoteClient] fetch metadata failed`,e,t),t}}async function d(){try{return await o(`/v1/threads`,{method:`GET`})}catch(e){throw console.warn(`[remoteClient] list threads failed`,e),e}}async function f(e,t){if(!e)return null;try{return await o(`/v1/threads/${e}/messages`,{method:`DELETE`,body:JSON.stringify(t||{})})}catch(t){throw console.warn(`[remoteClient] purge thread failed`,e,t),t}}return{enabled:!0,uploadMetadata:s,uploadMessage:c,fetchMessages:l,fetchMetadata:u,listThreads:d,purgeThread:f}}var Nk=null,Pk=null;async function Fk(){return Ok()?Nk||Pk||(Pk=Mk().then(e=>(Nk=e||null,Nk)).catch(e=>(console.warn(`[remoteClient] failed to initialize shared remote client`,e),null)).finally(()=>{Pk=null}),Pk):null}function Ik(){return!!(Ks.REMOTE_MESSAGING_ENABLED&&Ks.REMOTE_MESSAGING_API_URL)}function Lk(e){Ik()&&typeof e==`function`&&Promise.resolve().then(async()=>{let t=await Fk();t&&await e(t)}).catch(e=>{console.warn(`[storage] remote sync task failed`,e)})}function Rk(e,t){return!e||!t?null:{threadId:e,ctTxid:t.ctTxid??null,ctVout:Number.isInteger(t.ctVout)?t.ctVout:null,mintedAt:t.mintedAt??null,lastMintTxid:t.lastMintTxid??null,burnTxid:t.burnTxid??null,burnedAt:t.burnedAt??null,burnedBy:t.burnedBy??null,encKeyWrap:t.encKeyWrap??null,blobHash:t.blobHash??null,hintURL:t.hintURL??null,policy:t.policy??null,helperCache:t.helperCache??null,revision:t.remoteRevision??t.revision??null}}function zk(e){return!e||!e.ciphertext?null:{threadId:e.threadId,messageId:e.id,ciphertext:e.ciphertext,author:e.author??null,delivery:e.delivery??`sent`,timestamp:e.timestamp??e.createdAt??new Date().toISOString(),helperCache:e.helperCache??null,revision:e.remoteRevision??e.revision??null}}async function Bk(e,t){if(!e)throw Error(`threadId required to save join receipt`);return await EA.setItem(e,t),t}async function Vk(e){return e?EA.getItem(e):null}async function Hk(){let e=[];return await EA.iterate(t=>{t&&e.push(t)}),e}async function Uk(e,t){if(!e)throw Error(`threadId required to update join receipt`);let n=await EA.getItem(e);if(!n)return null;let r={...n,...t};return await EA.setItem(e,r),r}async function Wk(e){e&&await EA.removeItem(e)}async function Gk(e){return e?AA.getItem(e):null}async function Kk(e,t){if(!e)throw Error(`threadId required to save metadata`);return await AA.setItem(e,t),Lk(n=>{let r=Rk(e,t);return r?n.uploadMetadata(e,r).catch(t=>{console.warn(`[storage] failed to sync metadata (save)`,e,t)}):Promise.resolve()}),t}async function qk(){let e=[];return await AA.iterate((t,n)=>{t&&e.push({threadId:n,...t})}),e}async function Jk(e,t){if(!e)throw Error(`threadId required to update metadata`);let n={...await AA.getItem(e)||{},...t||{}};return await AA.setItem(e,n),Lk(t=>{let r=Rk(e,n);return r?t.uploadMetadata(e,r).catch(t=>{console.warn(`[storage] failed to sync metadata (update)`,e,t)}):Promise.resolve()}),n}var Yk=`entries`,Xk=200;async function Zk(e){if(!e)return[];let t=await jA.getItem(Yk)||[];t.push(e);let n=t.slice(-Xk);return await jA.setItem(Yk,n),n}async function Qk(e=Xk){let t=await jA.getItem(Yk)||[];return!e||e<=0?t:t.slice(-e)}async function $k(){await jA.setItem(Yk,[])}async function eA(e,t){if(!e)throw Error(`identityId required to save guest identity`);return await DA.setItem(e,t),t}async function tA(e){return e?DA.getItem(e):null}async function nA(e){e&&await DA.removeItem(e)}var rA,iA=new Uint8Array(16);function aA(){if(!rA&&(rA=typeof crypto<`u`&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!rA))throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);return rA(iA)}var oA=[];for(let e=0;e<256;++e)oA.push((e+256).toString(16).slice(1));function sA(e,t=0){return oA[e[t+0]]+oA[e[t+1]]+oA[e[t+2]]+oA[e[t+3]]+`-`+oA[e[t+4]]+oA[e[t+5]]+`-`+oA[e[t+6]]+oA[e[t+7]]+`-`+oA[e[t+8]]+oA[e[t+9]]+`-`+oA[e[t+10]]+oA[e[t+11]]+oA[e[t+12]]+oA[e[t+13]]+oA[e[t+14]]+oA[e[t+15]]}var cA={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function lA(e,t,n){if(cA.randomUUID&&!t&&!e)return cA.randomUUID();e||={};let r=e.random||(e.rng||aA)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n||=0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return sA(r)}var uA=lA;async function dA(e){let t=[];return await OA.iterate(n=>{n&&(e&&n.threadId&&n.threadId!==e||t.push(n))}),t}async function fA(e,{id:t,author:n,text:r,ciphertext:i,delivery:a=`sent`,timestamp:o,createdAt:s,helperCache:c,remoteRevision:l},{skipRemoteSync:u=!1}={}){if(!e)throw Error(`threadId required to save vault message`);let d=t||uA(),f=t?await OA.getItem(t):null,p=s||f?.createdAt||new Date().toISOString(),m=o||f?.timestamp||p,h={id:d,threadId:e,author:n??f?.author??null,text:r??f?.text??null,ciphertext:i??f?.ciphertext??null,delivery:a??f?.delivery??`sent`,timestamp:m,createdAt:p,helperCache:c??f?.helperCache??null,remoteRevision:l??f?.remoteRevision??null};return await OA.setItem(d,h),u||Lk(t=>{let n=zk(h);return!n||!n.threadId?Promise.resolve():t.uploadMessage(e,n).catch(t=>{console.warn(`[storage] failed to sync vault message (save)`,e,t)})}),h}async function pA(e,t,{skipRemoteSync:n=!1}={}){if(!e)throw Error(`message id required for update`);let r=await OA.getItem(e);if(!r)return null;let i={...r,...t,updatedAt:new Date().toISOString(),remoteRevision:t?.remoteRevision??r.remoteRevision??null};return await OA.setItem(e,i),n||Lk(t=>{let n=zk(i);return!n||!n.threadId?Promise.resolve():t.uploadMessage(n.threadId,n).catch(t=>{console.warn(`[storage] failed to sync vault message (update)`,e,t)})}),i}async function mA(e){if(!e)return 0;let t=[];return await OA.iterate((n,r)=>{n?.threadId===e&&t.push(r)}),await Promise.all(t.map(e=>OA.removeItem(e))),Lk(t=>t.purgeThread(e,{}).catch(t=>{console.warn(`[storage] failed to sync purge`,e,t)})),t.length}function hA(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}function gA(e,t){let n=e?new Date(e).getTime():-1/0,r=t?new Date(t).getTime():-1/0;return n===r?0:n>r?1:-1}async function _A(){let e=[];return await kA.iterate((t,n)=>{!t&&!n||(t?e.push({id:n,...t}):n&&e.push({id:n}))}),e}async function vA(e,t={}){if(!e)throw Error(`inviterId required to block inviter`);let n=await kA.getItem(e),r=hA(t.updatedAt),i=hA(n?.updatedAt);if(n&&r&&i&&gA(r,i)<=0)return{id:e,...n};let a=new Date().toISOString(),o=hA(t.blockedAt)||n?.blockedAt||a,s=r||i||a,c={...n,...t,blockedAt:o,updatedAt:s,source:t.source||n?.source||`local`};return await kA.setItem(e,c),{id:e,...c}}async function yA(e,t={}){if(!e)return!1;let n=await kA.getItem(e);if(!n)return!1;let r=hA(t.updatedAt),i=hA(n?.updatedAt);return r&&i&&gA(r,i)<=0?!1:(await kA.removeItem(e),!0)}async function bA(e){return e?!!await kA.getItem(e):!1}var xA=`onboarding-complete`;async function SA(){try{return!!await TA.getItem(xA)}catch(e){return console.warn(`[storage] failed to read onboarding flag`,e),!1}}async function CA(e=!0){try{return await TA.setItem(xA,!!e),!!e}catch(e){throw console.warn(`[storage] failed to persist onboarding flag`,e),e}}var wA={name:`nukenote-messaging`};const TA=Ek.default.createInstance({...wA,storeName:`app-state`}),EA=Ek.default.createInstance({...wA,storeName:`join-receipts`}),DA=Ek.default.createInstance({...wA,storeName:`guest-identities`}),OA=Ek.default.createInstance({...wA,storeName:`vault`}),kA=Ek.default.createInstance({...wA,storeName:`blocked-inviters`}),AA=Ek.default.createInstance({...wA,storeName:`thread-metadata`}),jA=Ek.default.createInstance({...wA,storeName:`overlay-telemetry`});function MA(){let[e,t]=(0,y.useState)(!0),[n,r]=(0,y.useState)(!1),[i,a]=(0,y.useState)(null);(0,y.useEffect)(()=>{let e=!0;return SA().then(n=>{e&&(r(!!n),t(!1))}).catch(n=>{console.warn(`[onboarding] failed to determine onboarding state`,n),e&&(a(n),r(!1),t(!1))}),()=>{e=!1}},[]);let o=(0,y.useCallback)(async()=>{await CA(!0),r(!0)},[]),s=(0,y.useCallback)(async()=>{await CA(!1),r(!1)},[]);return(0,y.useMemo)(()=>({loading:e,completed:n,error:i,markComplete:o,reset:s}),[n,i,e,o,s])}var NA=MA;function PA(){let{loading:e,completed:t,error:n}=NA();return e?(0,Z.jsx)(`div`,{className:`flex min-h-[40vh] items-center justify-center text-muted-foreground`,children:`Loading`}):(n&&console.warn(`[landing] onboarding flag error, defaulting to welcome`,n),(0,Z.jsx)(ft,{to:t?`/messages`:`/welcome`,replace:!0}))}var FA=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`div`,{ref:n,className:Q(`rounded-xl border bg-card text-card-foreground shadow`,e),...t}));FA.displayName=`Card`;var IA=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`div`,{ref:n,className:Q(`flex flex-col space-y-1.5 p-6`,e),...t}));IA.displayName=`CardHeader`;var LA=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`div`,{ref:n,className:Q(`font-semibold leading-none tracking-tight`,e),...t}));LA.displayName=`CardTitle`;var RA=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`div`,{ref:n,className:Q(`text-sm text-muted-foreground`,e),...t}));RA.displayName=`CardDescription`;var zA=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`div`,{ref:n,className:Q(`p-6 pt-0`,e),...t}));zA.displayName=`CardContent`;var BA=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`div`,{ref:n,className:Q(`flex items-center p-6 pt-0`,e),...t}));BA.displayName=`CardFooter`;var VA=rS(`inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,{variants:{variant:{default:`border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80`,secondary:`border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80`,destructive:`border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80`,outline:`text-foreground`}},defaultVariants:{variant:`default`}});function HA({className:e,variant:t,...n}){return(0,Z.jsx)(`div`,{className:Q(VA({variant:t}),e),...n})}function UA(){let e=Ve(),{loading:t,completed:n,error:r,markComplete:i}=NA();(0,y.useEffect)(()=>{!t&&n&&e(`/messages`,{replace:!0})},[n,t,e]);let a=(0,y.useCallback)(async()=>{try{await i()}catch(e){console.warn(`[welcome] unable to persist onboarding flag`,e)}e(`/messages`,{replace:!0})},[i,e]);(0,y.useCallback)(()=>{e(`/workflow`)},[e]);let o=(0,y.useCallback)(()=>{e(`/messages`)},[e]);return t?(0,Z.jsx)(`div`,{className:`flex min-h-[40vh] items-center justify-center text-muted-foreground`,children:`Loading`}):(0,Z.jsxs)(`div`,{className:`mx-auto flex max-w-4xl flex-col gap-8 py-12`,children:[(0,Z.jsxs)(`div`,{className:`space-y-3 text-center`,children:[(0,Z.jsx)(HA,{variant:`outline`,className:`px-3 py-1 text-sm`,children:`Welcome to NukeNote`}),(0,Z.jsx)(`h1`,{className:`text-3xl font-semibold tracking-tight sm:text-4xl`,children:`Secure P2P Messaging with Verifiable Deletion`}),(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`Accept an invite, chat as a guest, later link a wallet to send your own chat invites.`}),r&&(0,Z.jsx)(`p`,{className:`text-sm text-destructive`,children:`We couldn't confirm your onboarding status. You can continue anyway.`})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Quick start`}),(0,Z.jsx)(RA,{children:`Three steps to your first conversation.`})]}),(0,Z.jsxs)(zA,{className:`grid gap-6 sm:grid-cols-3`,children:[(0,Z.jsxs)(`div`,{className:`space-y-2 rounded-lg border border-muted-foreground/10 bg-muted/20 p-4 text-sm`,children:[(0,Z.jsx)(`h2`,{className:`text-base font-medium`,children:`1. Accept an invite`}),(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`Your messages remain secure as a guest user.`})]}),(0,Z.jsxs)(`div`,{className:`space-y-2 rounded-lg border border-muted-foreground/10 bg-muted/20 p-4 text-sm`,children:[(0,Z.jsx)(`h2`,{className:`text-base font-medium`,children:`2. Chat in guest mode`}),(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`Messages remain P2P and all syncing relays are end-to-end encrypted.`})]}),(0,Z.jsxs)(`div`,{className:`space-y-2 rounded-lg border border-muted-foreground/10 bg-muted/20 p-4 text-sm`,children:[(0,Z.jsx)(`h2`,{className:`text-base font-medium`,children:`3. Link your wallet`}),(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`Ready for full features? Connect your Metanet Desktop wallet to send your own invites and more.`})]})]})]}),(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:justify-center`,children:[(0,Z.jsx)($,{onClick:a,className:`w-full sm:w-auto`,children:`Go to Messages`}),(0,Z.jsx)($,{variant:`ghost`,onClick:o,className:`w-full sm:w-auto`,children:`Dismiss`})]}),(0,Z.jsx)(zT,{}),(0,Z.jsxs)(`div`,{className:`mx-auto max-w-3xl space-y-4 text-sm text-muted-foreground`,children:[(0,Z.jsx)(`h2`,{className:`text-center text-base font-medium text-foreground`,children:`What happens behind the scenes?`}),(0,Z.jsxs)(`ul`,{className:`list-disc space-y-2 pl-5`,children:[(0,Z.jsx)(`li`,{children:`Guest receipts, wrapped keys, and messaging history are stored locally using encrypted stores.`}),(0,Z.jsx)(`li`,{children:`Wallet upgrades double-sign a thread linkage statement and rewrap the thread key to your identity key.`}),(0,Z.jsx)(`li`,{children:`Messages are delivered over an end-to-end encrypted overlay relay; if it's temporarily unavailable, they stay in your local encrypted store and are retried when the connection comes back.`})]})]})]})}function WA(){let e=Ve();return(0,Z.jsxs)(`div`,{className:`mx-auto flex max-w-3xl flex-col gap-8 py-10`,children:[(0,Z.jsxs)(`div`,{className:`space-y-2 text-center`,children:[(0,Z.jsx)(`h1`,{className:`text-3xl font-semibold tracking-tight sm:text-4xl`,children:`NukeNote Messaging`}),(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`The legacy on-chain access-token stepper has been retired. Threads now start from guest invites and enroll directly into the messaging surface.`})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Start chatting`}),(0,Z.jsx)(RA,{children:`Accept an invite or open an existing thread in the messaging console.`})]}),(0,Z.jsxs)(zA,{className:`space-y-4`,children:[(0,Z.jsxs)(`div`,{className:`rounded-md border border-muted-foreground/20 bg-muted/10 p-4 text-sm text-muted-foreground`,children:[(0,Z.jsx)(HA,{variant:`secondary`,children:`Guest mode`}),` Guest users can accept invites, exchange messages, and upgrade to a wallet later. Wallet-required mint flows are queued behind the new messaging UX.`]}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap items-center gap-3`,children:[(0,Z.jsx)($,{onClick:()=>e(`/messages`),children:`Open Messages`}),(0,Z.jsx)($,{variant:`outline`,onClick:()=>e(`/invite/example`),children:`Preview Invite Consent`})]}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:"Want to work with raw on-chain access tokens manually? The tooling lives in `/legacy/workflow` while we finish migrating to the new thread-first experience."})]})]})]})}var GA=y.forwardRef(({className:e,type:t,...n},r)=>(0,Z.jsx)(`input`,{type:t,className:Q(`flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:r,...n}));GA.displayName=`Input`;var KA=l(Tk()),qA=`nukenote:profiles`,JA=KA.default.createInstance({name:`NukeNote`,storeName:`profiles`,description:`User profile data (display names, about, avatars)`}),YA=KA.default.createInstance({name:`NukeNote`,storeName:`avatars`,description:`Avatar image data`});async function XA(){try{return await JA.getItem(qA)||{}}catch(e){return console.error(`[profileStore] Failed to load profiles:`,e),{}}}async function ZA(e){try{await JA.setItem(qA,e)}catch(e){throw console.error(`[profileStore] Failed to save profiles:`,e),e}}async function QA(e){if(!e||typeof e!=`string`)throw Error(`pubkey is required and must be a string`);return(await XA())[e]||null}async function $A(e,t){if(!e||typeof e!=`string`)throw Error(`pubkey is required and must be a string`);if(!t||typeof t!=`object`)throw Error(`profile is required and must be an object`);if(!t.displayName||typeof t.displayName!=`string`)throw Error(`profile.displayName is required and must be a string`);let n=await XA(),r={displayName:t.displayName.trim(),about:t.about?.trim()||null,avatarHash:t.avatarHash||null,updatedAt:new Date().toISOString()};return n[e]=r,await ZA(n),console.log(`[profileStore] Profile saved:`,{pubkey:e.slice(0,16)+`...`,displayName:r.displayName,hasAbout:!!r.about,hasAvatar:!!r.avatarHash}),r}async function ej(){return XA()}async function tj(e,t=!0){if(!e||typeof e!=`string`)throw Error(`json is required and must be a string`);let n;try{n=JSON.parse(e)}catch(e){throw Error(`Invalid JSON: `+e.message)}if(!n||typeof n!=`object`)throw Error(`Imported data must be an object`);let r=t?await XA():{},i=0;for(let[e,t]of Object.entries(n))t&&typeof t==`object`&&t.displayName&&(r[e]={displayName:t.displayName,about:t.about||null,avatarHash:t.avatarHash||null,updatedAt:t.updatedAt||new Date().toISOString()},i++);return await ZA(r),console.log(`[profileStore] Imported ${i} profiles (merge: ${t})`),i}async function nj(e,t){if(!e||typeof e!=`string`)throw Error(`pubkey is required`);if(!t||typeof t!=`string`)throw Error(`dataUrl is required`);let n=new TextEncoder().encode(t),r=await crypto.subtle.digest(`SHA-256`,n),i=new Uint8Array(r),a=Array.from(i).map(e=>e.toString(16).padStart(2,`0`)).join(``);return await YA.setItem(e,{dataUrl:t,hash:a,updatedAt:new Date().toISOString()}),console.log(`[profileStore] Avatar saved:`,{pubkey:e.slice(0,16)+`...`,hash:a.slice(0,16)+`...`}),a}async function rj(e){if(!e||typeof e!=`string`)return null;try{return await YA.getItem(e)}catch{return null}}async function ij(e){if(!(!e||typeof e!=`string`))try{await YA.removeItem(e),console.log(`[profileStore] Avatar deleted:`,e.slice(0,16)+`...`)}catch{}}async function aj(){let e={};try{await YA.iterate((t,n)=>{t&&n&&(e[n]=t)})}catch{}return e}async function oj(e){if(!e||typeof e!=`object`)return 0;let t=0;for(let[n,r]of Object.entries(e))if(r&&typeof r==`object`&&r.dataUrl)try{await YA.setItem(n,r),t++}catch{}return console.log(`[profileStore] Imported ${t} avatars`),t}function sj(e){return`hsl(${e*137.508%360}, 65%, 55%)`}function cj(e){if(!e)return`?`;let t=e.split(/[\s-]+/).filter(Boolean);return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():e.slice(0,2).toUpperCase()}function lj({name:e,colorSeed:t=0,avatarHash:n=null,pubkey:r=null,size:i=40,className:a=``}){let[o,s]=(0,y.useState)(null),c=sj(t),l=cj(e);(0,y.useEffect)(()=>{if(!n||!r){s(null);return}let e=!1;return rj(r).then(t=>{!e&&t?.dataUrl&&t.hash===n&&s(t.dataUrl)}).catch(()=>{}),()=>{e=!0}},[n,r]);let u={width:`${i}px`,height:`${i}px`,borderRadius:`50%`,flexShrink:0};if(o)return(0,Z.jsx)(`img`,{src:o,alt:e,className:`avatar ${a}`,style:{...u,objectFit:`cover`},title:e});let d={...u,backgroundColor:c,color:`white`,display:`flex`,alignItems:`center`,justifyContent:`center`,fontSize:`${i*.4}px`,fontWeight:`600`,userSelect:`none`};return(0,Z.jsx)(`div`,{className:`avatar ${a}`,style:d,title:e,"aria-label":`Avatar for ${e}`,children:l})}async function uj(e,t={}){if(!e||typeof e!=`string`)throw Error(`displayName is required and must be a string`);let{about:n=null,avatarHash:r=null}=t,{client:i}=await nc(),a=await i.getPublicKey({identityKey:!0}),o=typeof a==`string`?a:a?.publicKey;if(!o||typeof o!=`string`)throw Error(`Wallet did not return identity public key`);console.log(`[profiles] Setting profile:`,{displayName:e,hasAbout:!!n,avatarHash:r});try{await $A(o,{displayName:e,about:n,avatarHash:r}),console.log(`[profiles] Profile saved successfully`)}catch(e){throw console.error(`[profiles] Failed to save profile:`,e),Error(`Failed to set profile: ${e.message}`)}}async function dj(e){if(!e||typeof e!=`string`)throw Error(`pubkey is required and must be a string`);try{console.log(`[profiles] Looking up profile for:`,e.slice(0,16)+`...`);let t=await QA(e);return t?(console.log(`[profiles] Profile found:`,{displayName:t.displayName,hasAbout:!!t.about}),{type:`NukeNote.Profile`,fields:{displayName:t.displayName,about:t.about,avatarHash:t.avatarHash,updatedAt:t.updatedAt},certifier:e,subject:e}):(console.log(`[profiles] No profile found for pubkey`),null)}catch(e){return console.error(`[profiles] Failed to lookup profile:`,e),null}}var fj=`amber.azure.bronze.coral.crimson.crystal.cyan.ebony.emerald.frost.gold.indigo.ivory.jade.lilac.magenta.navy.olive.pearl.plum.ruby.sable.sage.silver.teal.violet.amber.azure.bronze.coral.crimson.crystal.atlas.beacon.comet.delta.echo.falcon.gamma.harbor.iris.jupiter.kilo.lunar.meteor.nebula.orbit.phoenix.quasar.radius.solar.titan.ultra.vector.wave.xenon.zenith.alpha.bravo.charlie.delta.echo.foxtrot.golf.anchor.bridge.canyon.dune.forest.glacier.horizon.island.jungle.lagoon.mountain.ocean.prairie.river.summit.tundra.valley.waterfall.cliff.desert.fjord.grove.hill.inlet.mesa.oasis.peak.reef.shore.stream.trail.vista.arrow.blade.crown.drum.flute.harp.lance.shield.sword.torch.bell.book.coin.dice.flag.gem.horn.key.lamp.mask.orb.ring.seal.star.vase.wheel.axe.bow.cup.fan.gate.helm.ash.birch.cedar.elm.fern.holly.ivy.maple.oak.pine.rose.sage.willow.acorn.bloom.branch.clover.daisy.leaf.lotus.orchid.petal.reed.root.seed.thorn.vine.bark.bud.fir.moss.palm.bear.crane.deer.eagle.fox.hawk.lion.owl.raven.seal.tiger.wolf.bat.crow.dove.elk.hare.lynx.otter.puma.swan.viper.whale.zebra.cobra.drake.finch.heron.ibis.jay.kite.lark.bolt.cloud.dawn.dusk.ember.flame.glow.haze.light.mist.moon.rain.shade.snow.spark.storm.sun.thunder.wind.ash.blaze.chill.drizzle.flash.frost.hail.ice.ray.shadow.sleet.vapor.zephyr.arch.beam.dome.edge.frame.grid.line.node.path.point.ring.sphere.spiral.tower.vault.wedge.angle.axis.base.core.curve.face.loop.mesh.plane.prism.radius.scale.vertex.zone.arc.band`.split(`.`);function pj(e){if(!e||typeof e!=`string`)throw Error(`pubkeyHex is required and must be a string`);let t=new Uint8Array(e.match(/.{1,2}/g).map(e=>parseInt(e,16)));return Mn(t),fj.length,`Contact ${`${e.slice(0,4)}...${e.slice(-4)}`}`}function mj(e){if(!e||typeof e!=`string`)throw Error(`pubkeyHex is required and must be a string`);let t=new Uint8Array(e.match(/.{1,2}/g).map(e=>parseInt(e,16))),n=Mn(t);return(n[0]<<8|n[1])%1e3}function hj(e){if(!e||typeof e!=`string`)throw Error(`pubkeyHex is required and must be a string`);let t=new Uint8Array(e.match(/.{1,2}/g).map(e=>parseInt(e,16))),n=Mn(t),r=Mn(n),i=[];for(let e=0;e<12;e++){let t=e*2%r.length,n=r[t]<<8|r[t+1],a=String(n%1e5).padStart(5,`0`);i.push(a)}return i.join(` `)}function gj(e,t){if(!e||!t)return!1;let n=e=>e.replace(/\s+/g,``).toLowerCase();return n(e)===n(t)}var _j=l(Tk()),vj=`nukenote:contacts`,yj=null,bj=new Set;async function xj(){if(yj)return yj;try{return yj=await _j.default.getItem(vj)||{},console.log(`[contactsStore] Loaded`,Object.keys(yj).length,`contacts`),yj}catch(e){return console.error(`[contactsStore] Failed to load contacts:`,e),yj={},yj}}async function Sj(e){try{await _j.default.setItem(vj,e),yj=e,console.log(`[contactsStore] Saved`,Object.keys(e).length,`contacts`)}catch(e){throw console.error(`[contactsStore] Failed to save contacts:`,e),e}}async function Cj(e){return e&&(await xj())[e.toLowerCase()]||null}async function wj(e,t){if(!e)throw Error(`pubkey is required`);let n=e.toLowerCase(),r=await xj(),i={...r[n]||{kind:`guest`,verified:!1,safetyNumber:hj(n),verifiedSafetyNumber:null,verifiedAt:null},...t,lastSeen:new Date().toISOString()};return r[n]=i,await Sj(r),bj.forEach(t=>t(e)),console.log(`[contactsStore] Upserted contact:`,{pubkey:e.slice(0,16)+`...`,kind:i.kind,verified:i.verified,nickname:i.nickname,displayName:i.displayName,source:i.source,hasCard:!!i.card,hasCert:!!i.certificate}),i}function Tj(e){return bj.add(e),()=>bj.delete(e)}async function Ej(e){if(!e)return;let t=e.toLowerCase(),n=await xj();delete n[t],await Sj(n),console.log(`[contactsStore] Deleted contact:`,t.slice(0,16)+`...`)}async function Dj(){return await xj()}async function Oj(e,t){if(!e)throw Error(`pubkey is required`);console.log(`[resolution] Resolving identity:`,{pubkey:e.slice(0,16)+`...`,kind:t});let n=await Cj(e);if(console.log(`[resolution] Contact data:`,{pubkey:e.slice(0,16)+`...`,verified:n?.verified,nickname:n?.nickname,displayName:n?.displayName,hasCard:!!n?.card}),n?.nickname){let t={name:n.nickname,avatar:n.card?.avatarHash||null,verified:n.verified||!1,colorSeed:n.card?.colorSeed||mj(e),source:`nickname`};return console.log(`[resolution] Resolved from nickname:`,t),t}if(t===`holder`)try{let t=await dj(e);if(t&&t.fields){let r={name:t.fields.displayName||pj(e),avatar:t.fields.avatarHash||null,verified:n?.verified||!1,colorSeed:mj(e),source:`certificate`};return console.log(`[resolution] Resolved from profile store:`,r),r}}catch(e){console.warn(`[resolution] Certificate discovery failed:`,e.message)}return n?.card?{name:n.card.displayName,avatar:n.card.avatarHash||null,verified:n.verified||!1,colorSeed:n.card.colorSeed||mj(e),source:`profileCard`}:{name:pj(e),avatar:null,verified:!!n?.verified,colorSeed:mj(e),source:`fallback`}}function kj(e,t=`guest`){let[n,r]=(0,y.useState)(null),[i,a]=(0,y.useState)(!0),[o,s]=(0,y.useState)(null);return(0,y.useEffect)(()=>{if(!e){r(null),a(!1);return}let n=!1;async function i(){try{a(!0),s(null);let i=await Oj(e,t);n||(r(i),a(!1))}catch(e){n||(console.error(`[useIdentity] Resolution failed:`,e),s(e.message),a(!1))}}return i(),()=>{n=!0}},[e,t]),(0,y.useEffect)(()=>{if(e)return Tj(n=>{n===e&&Oj(e,t).then(e=>{r(e)}).catch(e=>{console.error(`[useIdentity] Re-resolution failed:`,e)})})},[e,t]),{identity:n,loading:i,error:o}}const Aj=e=>e?e.identityKind===`holder`?e.holderPublicKey||null:e.identityKind===`guest`?e.guestPublicKey||null:e.guestPublicKey||e.holderPublicKey||null:null,jj=e=>e?e.identityKind===`holder`?e.guestPublicKey||null:e.identityKind===`guest`?e.holderPublicKey||null:e.holderPublicKey||e.guestPublicKey||null:null,Mj=(e,t)=>{if(!t)return e;let n=Aj(t);return!e||e===`self`||e===`unknown`?n||e||null:e===`peer`&&n?n:e},Nj=(e,t)=>{if(!t)return e;let n=jj(t);return!e||e===`peer`||e===`unknown`?n||e||null:e===`self`&&n?n:e},Pj=(e,t)=>t?e===`self`||e===`unknown`?Mj(e,t)||e:e===`peer`&&Nj(e,t)||e:e;var Fj=`nukenote:remote-sync-enabled`,Ij=null,Lj=new Set,Rj=typeof window<`u`;function zj(){if(!Rj||!window?.localStorage)return Ij;try{let e=window.localStorage.getItem(Fj);return e===null||e===``?Ij:e===`true`}catch(e){return console.warn(`[remotePreferences] failed to read stored preference`,e),Ij}}function Bj(e){if(Ij=e,!(!Rj||!window?.localStorage))try{e===null?window.localStorage.removeItem(Fj):window.localStorage.setItem(Fj,e?`true`:`false`)}catch(e){console.warn(`[remotePreferences] failed to persist preference`,e)}}function Vj(){let e=!!(Ks.REMOTE_MESSAGING_ENABLED&&Ks.REMOTE_MESSAGING_API_URL),t=zj(),n=t===null?!0:!!t;return{configEnabled:e,userOverride:t,userEnabled:n,effective:e&&n}}function Hj(){let e=Vj();Lj.forEach(t=>{try{t(e)}catch(e){console.warn(`[remotePreferences] listener threw error`,e)}})}function Uj(){return Vj()}function Wj(){return Vj().effective}function Gj(e){Bj(e==null?null:!!e),Hj()}function Kj(e){if(typeof e!=`function`)return()=>{};Lj.add(e);try{e(Vj())}catch(e){console.warn(`[remotePreferences] listener threw error during subscribe`,e)}return()=>{Lj.delete(e)}}var qj=new Set;function Jj(e){!e||typeof e!=`object`||qj.forEach(t=>{try{t(e)}catch(e){console.warn(`[remoteTelemetry] listener error`,e)}})}function Yj(e){return typeof e==`function`?(qj.add(e),()=>{qj.delete(e)}):()=>{}}async function Xj(e){if(!e?.payload?.sig)return{valid:!0,verified:!1,reason:`NO_SIGNATURE`};let{payload:t}=e,{sig:n,author:r}=t;if(!r)return{valid:!1,verified:!1,reason:`NO_AUTHOR`};try{let{PublicKey:e,Signature:i,Hash:a}=await Qs(async()=>{let{PublicKey:e,Signature:t,Hash:n}=await import(`./esm-CMhbvdo9.js`);return{PublicKey:e,Signature:t,Hash:n}},[]),o={...t};delete o.sig;let s=new TextEncoder().encode(JSON.stringify(o)),c=a.sha256(s),l=e.fromString(r,`hex`),u=i.fromDER(Uint8Array.from(atob(n),e=>e.charCodeAt(0)),`binary`),d=l.verify(c,u);return{valid:d,verified:!0,reason:d?`VALID_SIGNATURE`:`INVALID_SIGNATURE`}}catch(e){return console.warn(`[overlaySignature] Verification failed:`,e.message),{valid:!1,verified:!1,reason:`VERIFICATION_ERROR: ${e.message}`}}}async function Zj(e,{requireSignature:t=!1}={}){let n=await Xj(e);return t&&!n.verified?{trusted:!1,reason:`SIGNATURE_REQUIRED`}:n.verified&&!n.valid?{trusted:!1,reason:`SIGNATURE_INVALID`}:{trusted:!0,reason:n.reason}}const Qj=[2e3,5e3,1e4];function $j(e,t,n){typeof e==`function`&&e({status:t,...n})}function eM({endpoint:e,WebSocketImpl:t,onStatus:n,retryDelays:r,logger:i}={}){let a=e??Ks.OVERLAY_ENDPOINT,o=t??(typeof WebSocket<`u`?WebSocket:null),s=r??Qj,c=i??console,l=null,u=0,d=(e,t={})=>{let n={kind:e,timestamp:new Date().toISOString(),endpoint:a,reconnects:u,readyState:l?.readyState??null,...t};try{Jj(n)}catch(e){c.warn?.(`[overlay] telemetry emit failed`,e)}return Zk(n).catch(e=>{c.warn?.(`[overlay] telemetry persist failed`,e)}),n};if(!a||!o){let e=`offline-no-endpoint`;return $j(n,e),d(`status`,{status:e,mode:`offline`}),{mode:`offline`,subscribe(){return()=>{}},publishMessage(e,t){c.warn?.(`[overlay] offline client: dropped message`,{threadId:e,payload:t})},publishAck(e,t){c.warn?.(`[overlay] offline client: dropped ack`,{threadId:e,payload:t})},publishControl(e,t){c.warn?.(`[overlay] offline client: dropped control`,{threadId:e,payload:t})},publishTyping(e,t){c.warn?.(`[overlay] offline client: dropped typing event`,{threadId:e,payload:t})},close(){},getStatus(){return e}}}let f=!1,p=!1,m=!1,h=`connecting`,g=new Map,_=[],v=null,y=null,b=(e,t)=>{let n=String(e||``).trim(),r=g.get(n);!r||r.size===0||r.forEach(e=>{try{e(t)}catch(e){c.error(`[overlay] listener error`,e)}})},x=()=>{if(!(!l||l.readyState!==o.OPEN))for(;_.length;){let e=_.shift();try{l.send(JSON.stringify(e))}catch(t){c.error(`[overlay] send failed`,t),_.unshift(e),l.close();break}}},S=async e=>{try{let t=typeof e==`string`?JSON.parse(e):e;if(!t||typeof t!=`object`)return;if(c.info?.(`[overlay] received:`,t.type||`unknown`,t),t.type===`subscribed`){c.info?.(`[overlay] subscribed confirmed for thread ${t.threadId}`);return}if(t.type===`unsubscribed`){c.info?.(`[overlay] unsubscribed confirmed for thread ${t.threadId}`);return}if(t.type===`delivery`){c.info?.(`[overlay] delivery confirmed: ${t.subscribers} subscribers`),t.threadId&&b(t.threadId,{type:`delivery`,payload:t.payload||{}});return}if(t.type===`pong`){c.info?.(`[overlay] pong received`);let e=typeof y==`number`?Date.now()-y:null;d(`heartbeat`,{rttMs:e}),y=null;return}if(t.type===`echo`){c.info?.(`[overlay] echo received (v1 relay)`);return}if([`message`,`ack`,`typing`,`control`].includes(t.type)&&t.threadId){let e=await Zj(t,{requireSignature:!1});if(!e.trusted){c.warn?.(`[overlay] Rejecting untrusted message:`,{type:t.type,threadId:t.threadId,reason:e.reason}),d(`signature_rejected`,{type:t.type,threadId:t.threadId,reason:e.reason});return}e.reason!==`NO_SIGNATURE`&&c.info?.(`[overlay] Message signature verified:`,e.reason)}t.threadId&&b(t.threadId,{type:t.type,payload:t.payload})}catch(e){c.error(`[overlay] bad message`,e)}},C=()=>{if(f||p){f&&(h=`closed`,$j(n,`closed`));return}p=!0,u+=1;let e=s[Math.min(u-1,s.length-1)];h=`reconnecting`,$j(n,`reconnecting`,{attempts:u,delay:e}),d(`reconnect`,{attempts:u,delay:e}),setTimeout(()=>{p=!1,f||w()},e)},w=()=>{if(m||l&&l.readyState===o.CONNECTING){c.warn?.(`[overlay] connect already in progress, skipping`);return}m=!0,h=`connecting`,$j(n,`connecting`),d(`status`,{status:`connecting`}),c.info?.(`[overlay] connecting to ${a}`);try{l=new o(a)}catch(e){c.error(`[overlay] connect failed`,e),m=!1,d(`error`,{phase:`connect`,message:e?.message}),C();return}let e=()=>{v&&=(clearInterval(v),null)};l.addEventListener(`open`,()=>{if(!f){if(m=!1,u=0,c.info?.(`[overlay] connection established`),h=`online`,$j(n,`online`),d(`status`,{status:`online`}),l&&l.readyState===o.OPEN)try{y=Date.now(),l.send(JSON.stringify({type:`ping`,timestamp:y})),d(`ping`),c.info?.(`[overlay] ping sent`)}catch(e){c.warn?.(`[overlay] failed to send ping`,e)}g.forEach((e,t)=>{if(!(!e||e.size===0))try{l?.send?.(JSON.stringify({type:`subscribe`,threadId:t})),c.info?.(`[overlay] resubscribed to thread ${t}`)}catch(e){c.warn?.(`[overlay] resubscribe failed, queueing`,{threadId:t,error:e}),T({type:`subscribe`,threadId:t})}}),x(),e(),v=setInterval(()=>{if(!(!l||l.readyState!==o.OPEN))try{y=Date.now(),l.send(JSON.stringify({type:`ping`,timestamp:y})),d(`ping`)}catch(e){c.warn?.(`[overlay] heartbeat ping failed`,e),l.close()}},3e4)}}),l.addEventListener(`message`,e=>S(e.data)),l.addEventListener(`error`,e=>{c.error(`[overlay] socket error`,e),c.error(`[overlay] readyState:`,l?.readyState,`endpoint:`,a),d(`error`,{phase:`runtime`,event:e?.message||e?.type||`socket-error`})}),l.addEventListener(`close`,t=>{m=!1,e(),c.warn?.(`[overlay] connection closed`,{code:t.code,reason:t.reason,wasClean:t.wasClean}),f?(h=`closed`,$j(n,`closed`),d(`status`,{status:`closed`,code:t.code,reason:t.reason,wasClean:t.wasClean})):(h=`disconnected`,d(`status`,{status:`disconnected`,code:t.code,reason:t.reason,wasClean:t.wasClean}),C())})},T=e=>{if(e){if(l&&l.readyState===o.OPEN)try{l.send(JSON.stringify(e));return}catch(e){c.error(`[overlay] send failed, queueing`,e)}_.push(e)}};return w(),{mode:`websocket`,subscribe(e,t){if(!e||typeof t!=`function`)return()=>{};let n=String(e).trim(),r=!g.has(n)||g.get(n).size===0;g.has(n)||g.set(n,new Set);let i=g.get(n);return i.add(t),r&&(T({type:`subscribe`,threadId:n}),c.info?.(`[overlay] subscribing to thread ${n}`)),()=>{i.delete(t),i.size===0&&(T({type:`unsubscribe`,threadId:n}),c.info?.(`[overlay] unsubscribing from thread ${n}`))}},publishMessage(e,t){T({type:`message`,threadId:e,payload:t})},publishAck(e,t){T({type:`ack`,threadId:e,payload:t})},publishControl(e,t){T({type:`control`,threadId:e,payload:t})},publishTyping(e,t){T({type:`typing`,threadId:e,payload:t})},close(){f=!0,_.length=0,g.clear(),v&&=(clearInterval(v),null),l&&l.readyState===o.OPEN&&l.close(),l=null,h=`closed`,$j(n,`closed`),d(`status`,{status:`closed`})},getStatus(){return h}}}function tM({host:e,walletClient:t,identity:n,onStatus:r,logger:i}){let a=i??console,o=typeof r==`function`?r:()=>{};return e?t?n?.publicKey?(a.info(`[messagebox] Overlay integration pending  falling back to websocket transport`),o({status:`unavailable`,reason:`not-implemented`}),null):(a.warn(`[messagebox] Identity public key missing; skipping MessageBox overlay`),o({status:`unavailable`,reason:`missing-identity`}),null):(a.warn(`[messagebox] Wallet client unavailable; skipping MessageBox overlay`),o({status:`unavailable`,reason:`missing-wallet`}),null):(a.warn(`[messagebox] Host not configured; skipping MessageBox overlay`),o({status:`unavailable`,reason:`missing-host`}),null)}var nM=null,rM=null,iM=null;function aM({mode:e,messageBoxHost:t,walletClient:n,identityKey:r,onStatus:i,logger:a}){let o=e===`messagebox`?`messagebox:${t}:${r}`:`websocket`;if(nM&&rM===o){if(iM=i,i&&nM.getStatus){let e=nM.getStatus();e&&i(e)}return nM}nM&&typeof nM.close==`function`&&(nM.close(),nM=null),iM=i;let s=e=>{iM&&iM(e)};return nM=e===`messagebox`&&t&&n&&r?tM({host:t,walletClient:n,identity:{publicKey:r},onStatus:s,logger:a}):eM({onStatus:s,logger:a}),rM=o,nM}function oM(){let[e,t]=(0,y.useState)(`stub`),n=(0,y.useRef)(null),r=(0,y.useRef)(null);return r.current=e=>{let n=typeof e==`string`?e:e?.status??e;console.log(`[useOverlayClient] status update:`,n),t(n)},(0,y.useEffect)(()=>{if(n.current&&typeof n.current.subscribe==`function`)return;let e=!1,t=t=>{e||r.current?.(t)},i=typeof oc.getStatus==`function`?oc.getStatus():{};i?.wallet&&i?.identityKey;let a=Ks.MESSAGE_BOX_WS_URL||null;return n.current=aM({mode:`websocket`,messageBoxHost:a,walletClient:i.wallet,identityKey:i.identityKey,onStatus:t,logger:console}),()=>{e=!0}}),{client:n.current,status:e,clientRef:n}}const sM=(e,{blocked:t=!1,messages:n=[]}={})=>{let r=e.status||`pending`,i=e.identityKind!==`holder`,a=e.peerLeft===!0,o=e.peerLeftAt||null,s=Aj(e),c=`No messages yet`;if(n&&n.length>0){let e=n[n.length-1],t=e.text||`No messages yet`;c=e.author===s||e.author===`self`?`You: ${t}`:t}else r===`blocked`?c=`Thread blocked. Further messages disabled.`:r===`burned`?c=`Thread burned. Local vault purged.`:r===`left`?c=`Left thread. Waiting for cleanup.`:a&&!i&&(c=` Guest left thread. You can burn when ready.`);let l=e.lastMessageAt||e.acceptedAt||e.updatedAt||e.createdAt||null,u=Array.isArray(e.dtIssuances)?e.dtIssuances:Array.isArray(e.threadMetadata?.dtIssuances)?e.threadMetadata.dtIssuances:[],d=new Set,f=[];u.forEach(e=>{if(!e||!Array.isArray(e.outputs))return;let t=e.txid||null;e.outputs.forEach(e=>{if(!e)return;let n=e.recipientPubkey||e.recipient||null,r=Number.isInteger(e.vout)?e.vout:null;n&&d.add(n),t&&r!==null&&f.push({txid:t,vout:r,recipientPubkey:n})})});let p=Array.from(d),m=p.length,h=e?.ctTxid&&Number.isInteger(e?.ctVout)?{txid:e.ctTxid,vout:e.ctVout}:null,g=jj(e),_=Aj(e),v=i?`holder`:`guest`,y=e.inviterName||e.threadMetadata?.inviterName||e.inviter||`Unknown`;return{id:e.threadId,title:e.label||`Thread ${Bx(e.threadId,12)}`,preview:c,lastActivity:l?new Date(l).toLocaleTimeString():null,status:r,ctOutpoint:h,initials:e.initials||`??`,guestMode:i,policy:e.policy||`mutual`,inviterName:y,inviter:e.inviter,inviterProfile:e.inviterProfile||null,lastActivityIso:l||null,blocked:t||r===`blocked`,presence:{state:`offline`},burnedAt:e.burnedAt||null,burnedBy:e.burnedBy||null,upgradedAt:e.upgradedAt||null,peerLeft:a,peerLeftAt:o,selfPublicKey:_,peerPublicKey:g,peerKind:v,supportsLeave:!!e.supportsLeave,blobHash:e.blobHash||null,encKeyWrap:e.encKeyWrap||null,hintURL:e.hintURL||null,mintedAt:e.mintedAt||null,lastMintTxid:e.lastMintTxid||null,threadMetadata:e.threadMetadata||null,dtIssuances:u,dtOutpoints:f,dtRecipients:p,dtRecipientCount:m,rawThreadKeyBase64:e.rawThreadKeyBase64||e.threadMetadata?.rawKeyBase64||null,peerWalletPublicKey:e.peerWalletPublicKey||e.threadMetadata?.peerWalletPublicKey||null}},cM=(e,t)=>({id:e.id,threadId:e.threadId,author:Pj(e.author,t),text:e.text??(e.ciphertext?`[encrypted message]`:``),timestamp:e.timestamp,delivery:e.delivery||`sent`});async function lM({event:e,threadId:t,receiptsRef:n,setMessagesByThread:r,overlayClientRef:i,bumpConversationActivity:a,setReceiptsByThread:o,setConversations:s,conversationFromReceipt:c}){let l=n.current[t],u=Aj(l);if(u&&e.payload?.author===u)return;if(l?.identityKind===`holder`&&!l.guestPublicKey&&e.payload?.author){let r=e.payload.author;console.log(`[handleMessageEvent] Storing guest public key:`,r.slice(0,16)+`...`),await Uk(t,{guestPublicKey:r});let i={...l,guestPublicKey:r};n.current[t]=i,o&&o(e=>({...e,[t]:i})),s&&c&&s(e=>e.map(e=>e.id===t?c(i,{blocked:e.blocked}):e))}let d=e.payload?.id,f=await fA(t,{id:d,author:Nj(e.payload.author,l)||`peer`,text:e.payload.text,delivery:e.payload.delivery||`delivered`}),p=d||f.id;r(e=>{let n=e[t]||[];return p&&n.some(e=>e.id===p)?e:{...e,[t]:[...n,cM(f,l)]}}),typeof a==`function`&&a(t,e.payload?.timestamp),e.payload?.id&&i.current?.publishAck(t,{messageId:e.payload.id,delivery:`delivered`,ackedAt:new Date().toISOString()})}function uM({event:e,threadId:t,receiptsRef:n,setTypingByThread:r,typingTimersRef:i,clearTyping:a}){let o=n.current[t],s=Aj(o);if(e.payload?.author===`self`||s&&e.payload?.author===s)return;r(e=>({...e,[t]:!0}));let c=i.current[t];c&&clearTimeout(c),i.current[t]=setTimeout(()=>{a(t)},2e3)}async function dM({event:e,threadId:t,setMessagesByThread:n,bumpConversationActivity:r}){let{messageId:i,id:a,delivery:o}=e.payload||{},s=i||a;if(!s)return;let c=o===`acknowledged`||!o?`delivered`:o;await pA(s,{delivery:c}),n(e=>{let n=e[t]||[];return{...e,[t]:n.map(e=>e.id===s?{...e,delivery:c}:e)}}),typeof r==`function`&&r(t,e.payload?.ackedAt)}async function fM({event:e,threadId:t,setMessagesByThread:n,bumpConversationActivity:r}){let{messageId:i,id:a,status:o,timestamp:s}=e.payload||{},c=i||a;if(!c)return;let l=o===`failed`?`failed`:o===`relayed`||o===`acknowledged`||!o?`delivered`:o;await pA(c,{delivery:l}),n(e=>{let n=e[t]||[];return{...e,[t]:n.map(e=>e.id===c?{...e,delivery:l}:e)}}),typeof r==`function`&&r(t,s)}async function pM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,clearTyping:a,updateJoinReceipt:o,conversationFromReceipt:s}){let c=n.current[t];if(!c)return;let l=e.payload?.occurredAt||new Date().toISOString(),u=null;if(typeof o==`function`)try{u=await o(t,{peerLeft:!0,peerLeftAt:l})}catch(e){console.error(`[guestThreads] failed to persist peer left state`,e)}u||={...c,peerLeft:!0,peerLeftAt:l},r(e=>({...e,[t]:u})),i(e=>e.map(e=>e.id===t?s(u):e)),a(t)}async function mM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,setMessagesByThread:a,clearTyping:o,updateJoinReceipt:s,deleteGuestIdentity:c,conversationFromReceipt:l}){let u=n.current[t],d=e.payload?.occurredAt||new Date().toISOString(),f=e.payload?.actor||`peer`;if(await mA(t),u?.guestIdentityId&&typeof c==`function`)try{await c(u.guestIdentityId)}catch(e){console.error(`[guestThreads] failed to delete guest identity after burn`,e)}let p=null;if(typeof s==`function`)try{p=await s(t,{status:`burned`,burnedAt:d,burnedBy:f})}catch(e){console.error(`[guestThreads] failed to persist burn state`,e)}if(!p){let e=n.current[t];e&&(p={...e,status:`burned`,burnedAt:d,burnedBy:f})}p&&(n.current[t]=p,r(e=>({...e,[t]:p})),i(e=>e.map(e=>e.id===t?l(p):e))),a(e=>({...e,[t]:[]})),o(t)}async function hM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateThreadMetadata:a,conversationFromReceipt:o}){let s=e.payload?.txid||e.payload?.ctTxid||null,c=e.payload?.vout??e.payload?.ctVout,l=e.payload?.occurredAt||new Date().toISOString(),u=Number.isInteger(c)&&c>=0?c:null;if(typeof a==`function`)try{await a(t,{ctTxid:s||null,ctVout:u,mintedAt:l,lastMintTxid:s||null})}catch(e){console.warn(`[guestThreads] failed to persist thread metadata from mint-ct`,e)}let d=null;r(e=>{let r=e[t];if(!r)return e;let i=Number.isInteger(r.ctVout)?r.ctVout:null,a=u??i;return d={...r,ctTxid:s||r.ctTxid||null,ctVout:a,mintedAt:l||r.mintedAt||null,lastMintTxid:s||r.lastMintTxid||null,threadMetadata:{...r.threadMetadata||{},ctTxid:s||r.threadMetadata?.ctTxid||null,ctVout:a,mintedAt:l||r.threadMetadata?.mintedAt||null,lastMintTxid:s||r.threadMetadata?.lastMintTxid||null}},n.current[t]=d,{...e,[t]:d}}),d&&i(e=>e.map(e=>e.id===t?o(d,{blocked:e.blocked}):e))}async function gM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateThreadMetadata:a,conversationFromReceipt:o}){let s=e.payload?.issuance;if(!s)return;let c=n.current[t],l=Array.isArray(c?.dtIssuances)?c.dtIssuances:Array.isArray(c?.threadMetadata?.dtIssuances)?c.threadMetadata.dtIssuances:[],u=l.some(e=>e?.txid&&e.txid===s.txid),d=u?l:[...l,s];if(!u&&typeof a==`function`)try{await a(t,{dtIssuances:d})}catch(e){console.warn(`[guestThreads] failed to persist thread metadata from mint-dt`,e)}let f=null;r(e=>{let r=e[t];if(!r)return e;let i=Array.isArray(r.dtIssuances)?r.dtIssuances:[];if(i.some(e=>e?.txid===s.txid))return e;let a=[...i,s];return f={...r,dtIssuances:a,threadMetadata:{...r.threadMetadata||{},dtIssuances:a}},n.current[t]=f,{...e,[t]:f}}),f&&i(e=>e.map(e=>e.id===t?o(f,{blocked:e.blocked}):e))}async function _M({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,conversationFromReceipt:a,updateJoinReceipt:o}){let s=e.payload?.walletPublicKey,c=e.payload?.upgradedAt;if(!s)return;let l=null;if(r(e=>{let r=e[t];return r?r.identityKind===`guest`?(l={...r,identityKind:`holder`,holderPublicKey:s,upgradedAt:c,peerWalletPublicKey:r.peerWalletPublicKey||r.holderPublicKey||null},n.current[t]=l,{...e,[t]:l}):r.identityKind===`holder`&&s&&s!==r.holderPublicKey?(l={...r,peerWalletPublicKey:s},n.current[t]=l,{...e,[t]:l}):e:e}),l){if(typeof o==`function`)try{o(t,l)}catch(e){console.warn(`[guestThreads] failed to persist link state`,e)}i(e=>e.map(e=>e.id===t?a(l):e))}}async function vM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateJoinReceipt:a,conversationFromReceipt:o}){let s=e.payload?.blockedAt||new Date().toISOString(),c=e.payload?.actor||`peer`,l=null;if(typeof a==`function`)try{l=await a(t,{status:`blocked`,blockedAt:s,blockedBy:c})}catch(e){console.error(`[guestThreads] failed to persist block state`,e)}if(!l){let e=n.current[t];e&&(l={...e,status:`blocked`,blockedAt:s,blockedBy:c})}l&&(n.current[t]=l,r(e=>({...e,[t]:l})),i(e=>e.map(e=>e.id===t?o(l,{blocked:!0}):e)))}async function yM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateJoinReceipt:a,conversationFromReceipt:o}){let s=e.payload?.actor||`peer`,c=null;if(typeof a==`function`)try{c=await a(t,{status:`ready`,blockedAt:null,blockedBy:s===`peer`?void 0:s})}catch(e){console.error(`[guestThreads] failed to persist unblock state`,e)}if(!c){let e=n.current[t];e&&(c={...e,status:e.status===`blocked`?`ready`:e.status,blockedAt:null,blockedBy:s===`peer`?e.blockedBy:s})}c&&(n.current[t]=c,r(e=>({...e,[t]:c})),i(e=>e.map(e=>e.id===t?o(c,{blocked:!1}):e)))}async function bM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,setMessagesByThread:a,clearTyping:o,updateJoinReceipt:s,deleteJoinReceipt:c,deleteGuestIdentity:l,updateThreadMetadata:u,conversationFromReceipt:d,bumpConversationActivity:f}){switch(e?.payload?.action){case`leave`:return pM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,clearTyping:o,updateJoinReceipt:s,conversationFromReceipt:d});case`burn`:return mM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,setMessagesByThread:a,clearTyping:o,updateJoinReceipt:s,deleteGuestIdentity:l,conversationFromReceipt:d});case`mint-ct`:return hM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateThreadMetadata:u,conversationFromReceipt:d});case`mint-dt`:return gM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateThreadMetadata:u,conversationFromReceipt:d});case`link`:return _M({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,conversationFromReceipt:d,updateJoinReceipt:s});case`block`:return vM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateJoinReceipt:s,conversationFromReceipt:d});case`unblock`:return yM({event:e,threadId:t,receiptsRef:n,setReceiptsByThread:r,setConversations:i,updateJoinReceipt:s,conversationFromReceipt:d});default:return}}function xM({threadId:e,receiptsRef:t,setMessagesByThread:n,setTypingByThread:r,setReceiptsByThread:i,setConversations:a,typingTimersRef:o,clearTyping:s,removeThreadLocally:c,conversationFromReceipt:l,overlayClientRef:u,updateJoinReceipt:d,deleteJoinReceipt:f,deleteGuestIdentity:p,updateThreadMetadata:m,typingEnabledRef:h,bumpConversationActivity:g}){return async _=>{if(_.type===`message`){await lM({event:_,threadId:e,receiptsRef:t,setMessagesByThread:n,overlayClientRef:u,bumpConversationActivity:g,setReceiptsByThread:i,setConversations:a,conversationFromReceipt:l});return}if(_.type===`typing`){uM({event:_,threadId:e,receiptsRef:t,setTypingByThread:r,typingTimersRef:o,clearTyping:s});return}if(_.type===`ack`){await dM({event:_,threadId:e,setMessagesByThread:n,bumpConversationActivity:g});return}if(_.type===`delivery`){await fM({event:_,threadId:e,setMessagesByThread:n,bumpConversationActivity:g});return}if(_.type===`control`){await bM({event:_,threadId:e,receiptsRef:t,setReceiptsByThread:i,setConversations:a,setMessagesByThread:n,setTypingByThread:r,typingTimersRef:o,clearTyping:s,removeThreadLocally:c,overlayClientRef:u,updateJoinReceipt:d,deleteJoinReceipt:f,deleteGuestIdentity:p,updateThreadMetadata:m,typingEnabledRef:h,bumpConversationActivity:g,conversationFromReceipt:l});return}}}function SM({client:e,receiptsSnapshot:t,activeSubscriptions:n,createHandler:r}){let i=typeof window<`u`,a=new Set(Object.keys(t));return n.forEach((e,t)=>{a.has(t)||(i&&console.info(`[subscriptions] unsubscribing thread`,{threadId:t}),e?.(),n.delete(t))}),a.forEach(t=>{if(n.has(t))return;i&&console.info(`[subscriptions] subscribing thread`,{threadId:t});let a=r(t),o=e.subscribe(t,a);n.set(t,o)}),n}function CM({client:e,threadIdsKey:t,receiptsByThread:n,receiptsRef:r,typingTimersRef:i,setMessagesByThread:a,setTypingByThread:o,setReceiptsByThread:s,setConversations:c,clearTyping:l,removeThreadLocally:u,bumpConversationActivity:d,overlayClientRef:f,typingEnabledRef:p,overlayStatus:m}){let h=(0,y.useRef)(new Map),g=(0,y.useCallback)(e=>xM({threadId:e,receiptsRef:r,setMessagesByThread:a,setTypingByThread:o,setReceiptsByThread:s,setConversations:c,typingTimersRef:i,clearTyping:l,removeThreadLocally:u,conversationFromReceipt:sM,overlayClientRef:f,updateJoinReceipt:Uk,deleteJoinReceipt:Wk,deleteGuestIdentity:nA,updateThreadMetadata:Jk,typingEnabledRef:p,bumpConversationActivity:d}),[r,a,o,s,c,i,l,u,f,p,d]),_=(0,y.useCallback)(t=>{if(!t)return;if(!e){typeof window<`u`&&console.info(`[useThreadSubscriptions] ensureThreadSubscribed: no overlay client`,{threadId:t,overlayStatus:m});return}let n=h.current;if(n.has(t))return;typeof window<`u`&&console.info(`[useThreadSubscriptions] ensureThreadSubscribed: subscribing thread`,{threadId:t});let r=g(t),i=e.subscribe(t,r);n.set(t,i)},[e,g,m]);return(0,y.useEffect)(()=>{let t=typeof window<`u`&&!1;if(!e){t&&console.info(`[useThreadSubscriptions] subscriptions skipped: no overlay client`,{threadIds:Object.keys(n||{}),overlayStatus:m});return}t&&console.info(`[useThreadSubscriptions] managing subscriptions`,{threadIds:Object.keys(n||{}),activeCount:h.current?.size??0,overlayStatus:m});let r=n,i=h.current;h.current=SM({client:e,receiptsSnapshot:r,activeSubscriptions:i,createHandler:g})},[e,t,n,g,m]),(0,y.useEffect)(()=>()=>{h.current.forEach(e=>e?.()),h.current=new Map,Object.values(i.current).forEach(e=>clearTimeout(e)),i.current={}},[i]),{ensureThreadSubscribed:_}}async function wM({inviterId:e,metadata:t={},receiptsRef:n,setBlockedInviters:r,setReceiptsByThread:i,setMessagesByThread:a,clearTyping:o,overlayClientRef:s,applyConversationUpdate:c}){if(!e)return;let l=t.blockedAt||new Date().toISOString(),u=await vA(e,{reason:t.reason||`user_action`,blockedVia:t.source||`thread_view`,lastThreadId:t.threadId||null,blockedAt:l});r(t=>[...t.filter(t=>t.id!==e),u]);let d=n.current,f=Object.values(d).filter(t=>t?.inviter===e).map(e=>e.threadId);if(t.threadId&&!f.includes(t.threadId)&&f.push(t.threadId),!f.length)return;f.forEach(e=>{s.current?.publishControl(e,{action:`block`,actor:`self`,blockedAt:l})});let p=f.map(e=>d[e]).filter(Boolean);await Promise.all(f.map((e,t)=>Promise.all([mA(e),Wk(e),p[t]?.guestIdentityId?nA(p[t].guestIdentityId):Promise.resolve()]))),i(e=>{let t={...e};return f.forEach(e=>delete t[e]),t}),c(e=>e.filter(e=>!f.includes(e.id))),a(e=>{let t={...e};return f.forEach(e=>delete t[e]),t}),f.forEach(e=>o(e))}function TM({threadId:e,userPublicKey:t,receipt:n}){let r={hasAccess:!1,reason:null,dtOutpoint:null,ctOutpoint:null,validationTimestamp:new Date().toISOString()};if(!n)return r.reason=`NO_DT_FOUND`,r.details=`No Data Token found for this user. Access denied.`,r;if(n.threadId!==e)return r.reason=`THREAD_MISMATCH`,r.details=`Data Token does not match requested thread.`,r;if(n.status===`burned`)return r.reason=`CT_BURNED`,r.details=`Control Token has been burned. All access revoked.`,r.ctOutpoint=n.ctTxid&&n.ctVout!==void 0?{txid:n.ctTxid,vout:n.ctVout}:null,r.burnProof={burnTxid:n.burnTxid,burnedAt:n.burnedAt,burnedBy:n.burnedBy},r;if(n.status===`left`)return r.reason=`USER_LEFT`,r.details=`User has voluntarily left this thread.`,r;if(!(n.ctTxid&&Number.isInteger(n.ctVout)))return r.reason=`NO_CT_REFERENCE`,r.details=`Data Token does not reference a valid Control Token.`,r;let i=(n.dtIssuances||n.threadMetadata?.dtIssuances||[]).flatMap(e=>e.outputs||[]).find(e=>e.recipientPubkey===t);return!i||!Number.isInteger(i.vout)?(r.reason=`NO_DT_FOUND`,r.details=`No valid Data Token found for this user. DT ownership is required for thread access.`,r):(r.dtOutpoint={txid:i.txid||n.lastMintTxid,vout:i.vout},r.hasAccess=!0,r.reason=`VALID_DT`,r.details=`Valid Data Token found. Control Token is active. Access granted.`,r.ctOutpoint={txid:n.ctTxid,vout:n.ctVout},r)}function EM(e){if(!e)return`No access token found`;switch(e.status){case`burned`:return` Thread burned - Access permanently revoked`;case`left`:return` You left this thread`;case`blocked`:return` Thread blocked`;case`active`:case`ready`:return` Active - Access granted`;default:return`Status: ${e.status}`}}function DM(e,t=`main`){return e?.txid?`${t===`test`?`https://test.whatsonchain.com`:`https://whatsonchain.com`}/tx/${e.txid}`:null}function OM(e){return e?.txid?`${e.txid.slice(0,8)}...${e.txid.slice(-8)}:${e.vout}`:`N/A`}var kM=[0,300,1e3],AM=new Set([408,425,429,500,502,503,504]);function jM(e){return new Promise(t=>setTimeout(t,e))}function MM(){let e=(Ks.HELPER_CACHE_ENDPOINT||``).trim();return e?e.endsWith(`/`)?e.slice(0,-1):e:``}function NM(){return!!MM()}function PM(e){let t=MM();if(!t)throw Error(`Helper cache endpoint not configured`);return e?`${t}${e.startsWith(`/`)?e:`/${e}`}`:t}async function FM(e,t={},n={}){let{retryDelays:r=kM,retryStatuses:i=AM,logger:a=console}=n,o=PM(e),s=Math.max(1,r.length||1),c=0;for(;c<s;){if(c>0){let e=r[c]??r[r.length-1];e>0&&await jM(e)}try{let e=await fetch(o,t);if(e.ok)return e;if(!(i instanceof Set?i.has(e.status):Array.isArray(i)&&i.includes(e.status))){let t=await e.text().catch(()=>``),n=Error(`Helper cache request failed (${e.status}): ${t}`);throw n.fatal=!0,n.status=e.status,n}if(c===s-1){let t=await e.text().catch(()=>``),n=Error(`Helper cache request failed (${e.status}): ${t}`);throw n.status=e.status,n}a.warn?.(`[helper-cache] request failed, retrying`,{attempt:c+1,status:e.status,url:o})}catch(e){if(e?.fatal)throw e;if(c===s-1){let t=Error(`Helper cache request error: ${e.message}`);throw t.cause=e,t}a.warn?.(`[helper-cache] network error, retrying`,{attempt:c+1,error:e.message,url:o})}c+=1}throw Error(`Helper cache request failed after retries`)}async function IM(e,t,n={}){if(!e)throw Error(`id is required to store helper cache item`);let r=JSON.stringify({id:e,payload:t});return(await FM(`/cache`,{method:`POST`,headers:{"content-type":`application/json`},body:r,signal:n.signal},n)).json()}async function LM(e,t={}){if(!e)throw Error(`id is required to load helper cache item`);let n;try{n=await FM(`/cache/${encodeURIComponent(e)}`,{method:`GET`,signal:t.signal},t)}catch(e){if(e?.status===404)return null;throw e}return(n.headers?.get?.(`content-type`)||``).includes(`application/json`)?n.json():n.text()}async function RM(e,t={}){if(!e)throw Error(`id is required to delete helper cache item`);try{return(await FM(`/cache/${encodeURIComponent(e)}`,{method:`DELETE`,signal:t.signal},t)).json()}catch(e){if(e?.status===404)return{deleted:!1};throw e}}var zM=`[helper-cache]`;function BM(){return NM()}function VM(e,t){if(!e||!Number.isInteger(t)&&typeof t!=`number`)return null;let n=Number(t);return`${e}:${Number.isInteger(n)&&n>=0?n:0}`}async function HM({threadId:e,ctTxid:t,ctVout:n,payload:r,logger:i=console}){if(!BM())return null;let a=VM(t,n);if(!a)return i.warn?.(zM,`missing CT outpoint for helper cache enrollment`,{threadId:e,ctTxid:t,ctVout:n}),null;if(!r||typeof r!=`object`)return i.warn?.(zM,`missing payload for helper cache enrollment`,{threadId:e,cacheId:a}),null;let o=new Date().toISOString();try{return await IM(a,{...r,threadId:e,enrolledAt:o,version:1}),i.info?.(zM,`enrolled helper cache entry`,{threadId:e,cacheId:a}),{cacheId:a,enrolled:!0,enrolledAt:o}}catch(t){return i.warn?.(zM,`failed to enroll helper cache entry`,{threadId:e,cacheId:a,error:t?.message||String(t)}),{cacheId:a,enrolled:!1,error:t?.message||String(t),lastAttemptAt:o}}}async function UM(e,{logger:t=console,signal:n}={}){if(!e||!BM())return null;try{let r=await LM(e,{signal:n});return t.info?.(zM,`fetched helper cache entry`,{cacheId:e}),r}catch(n){return n?.status===404?(t.info?.(zM,`helper cache entry missing`,{cacheId:e}),null):(t.warn?.(zM,`failed to fetch helper cache entry`,{cacheId:e,error:n?.message||String(n)}),null)}}async function WM({threadId:e,author:t,text:n,receiptsByThread:r,setMessagesByThread:i,bumpConversationActivity:a,overlayClientRef:o}){if(!e||!n)return null;let s=r[e];if(!s||s.status===`blocked`)return null;console.log(`[guestThreads] sendMessage - receipt check:`,{threadId:e,hasReceipt:!!s,identityKind:s?.identityKind,ctTxid:s?.ctTxid,ctVout:s?.ctVout,dtIssuances:s?.dtIssuances?.length||0,threadMetadata:!!s?.threadMetadata});let c=TM({threadId:e,userPublicKey:s?.guestPublicKey||s?.holderPublicKey,receipt:s});if(!c.hasAccess)throw console.warn(`[guestThreads] sendMessage blocked - DT validation failed:`,c),console.warn(`[guestThreads] Full receipt at validation:`,s),Error(c.details||`Access denied`);let l=Aj(s)||`unknown`;console.info(`[guestThreads] sendMessage`,{threadId:e,author:t,resolvedAuthor:l,receiptSnapshot:s});let u=typeof n==`string`&&n.startsWith(`[JOINED]`),d=await fA(e,{id:u?`system:joined:${e}`:void 0,author:Mj(t,s)||l,text:n,delivery:`sent`});i(t=>{let n=t[e]||[];return d.id&&n.some(e=>e.id===d.id)?t:{...t,[e]:[...n,cM(d,s)]}}),a(e,d.timestamp);let f=VM(s?.ctTxid,s?.ctVout),p={...d,author:l,text:n,timestamp:d.timestamp||new Date().toISOString(),cacheId:f};return o.current?.publishMessage(e,p),f&&BM()&&GM(f,e,p).catch(e=>{console.warn(`[guestThreads] Helper cache seeding failed (non-blocking):`,e.message)}),d}async function GM(e,t,n){try{let r=`${e}:messages`;await IM(r,{threadId:t,message:{id:n.id,author:n.author,text:n.text,timestamp:n.timestamp,cacheId:e},seededAt:new Date().toISOString(),ttl:2880*60*1e3}),console.info(`[guestThreads] Message seeded to helper cache:`,{cacheId:e,messageId:n.id})}catch(e){console.warn(`[guestThreads] Failed to seed helper cache:`,e.message)}}function KM({threadId:e,receiptsByThread:t,typingEnabledRef:n,overlayClientRef:r}){if(!e||!n.current)return!1;let i=t[e];if(!i||i.status===`blocked`)return!1;let a=Aj(i)||`self`;return console.info(`[guestThreads] notifyTyping`,{threadId:e,enabled:n.current,resolvedAuthor:a,receiptSnapshot:i}),r.current?.publishTyping?.(e,{author:a,occurredAt:new Date().toISOString()}),!0}function qM({threadId:e,setReceiptsByThread:t,applyConversationUpdate:n,setMessagesByThread:r,clearTyping:i}){e&&(t(t=>{if(!t[e])return t;let n={...t};return delete n[e],n}),n(t=>t.filter(t=>t.id!==e)),r(t=>{if(!t[e])return t;let n={...t};return delete n[e],n}),i(e))}var JM=o(((e,t)=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.utils=e.schnorr=e.verify=e.signSync=e.sign=e.getSharedSecret=e.recoverPublicKey=e.getPublicKey=e.SignResult=e.Signature=e.Point=e.CURVE=void 0;var n={a:0n,b:7n,P:2n**256n-2n**32n-977n,n:2n**256n-432420386565659656852420866394968145599n,h:1n,Gx:55066263022277343669578718895168534326250603453777594175500187360389116729240n,Gy:32670510020758816978083085130507043184471273380659243275938904335757337482424n,beta:55594575648329892869085402983802832744385952214688224221778511981742606582254n};e.CURVE=n;function r(e){let{a:t,b:r}=n;return S(e**3n+t*e+r)}var i=n.a===0n,a=class e{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(t){if(!(t instanceof s))throw TypeError(`JacobianPoint#fromAffine: expected Point`);return new e(t.x,t.y,1n)}static toAffineBatch(e){let t=E(e.map(e=>e.z));return e.map((e,n)=>e.toAffine(t[n]))}static normalizeZ(t){return e.toAffineBatch(t).map(e.fromAffine)}equals(e){let t=this,n=e,r=S(t.z*t.z),i=S(t.z*r),a=S(n.z*n.z),o=S(n.z*a);return S(t.x*a)===S(r*n.x)&&S(t.y*o)===S(i*n.y)}negate(){return new e(this.x,S(-this.y),this.z)}double(){let t=this.x,n=this.y,r=this.z,i=S(t**2n),a=S(n**2n),o=S(a**2n),s=S(2n*(S(S((t+a)**2n))-i-o)),c=S(3n*i),l=S(c**2n),u=S(l-2n*s),d=S(c*(s-u)-8n*o),f=S(2n*n*r);return new e(u,d,f)}add(t){if(!(t instanceof e))throw TypeError(`JacobianPoint#add: expected JacobianPoint`);let n=this.x,r=this.y,i=this.z,a=t.x,o=t.y,s=t.z;if(a===0n||o===0n)return this;if(n===0n||r===0n)return t;let c=S(i**2n),l=S(s**2n),u=S(n*l),d=S(a*c),f=S(r*s*l),p=S(S(o*i)*c),m=S(d-u),h=S(p-f);if(m===0n)return h===0n?this.double():e.ZERO;let g=S(m**2n),_=S(m*g),v=S(u*g),y=S(h**2n-_-2n*v),b=S(h*(v-y)-f*_),x=S(i*s*m);return new e(y,b,x)}subtract(e){return this.add(e.negate())}multiplyUnsafe(t){if(!x(t))throw TypeError(`Point#multiply: expected valid scalar`);let r=S(BigInt(t),n.n);if(!i){let t=e.ZERO,n=this;for(;r>0n;)r&1n&&(t=t.add(n)),n=n.double(),r>>=1n;return t}let[a,o,s,c]=k(r),l=e.ZERO,u=e.ZERO,d=this;for(;o>0n||c>0n;)o&1n&&(l=l.add(d)),c&1n&&(u=u.add(d)),d=d.double(),o>>=1n,c>>=1n;return a&&(l=l.negate()),s&&(u=u.negate()),u=new e(S(u.x*n.beta),u.y,u.z),l.add(u)}precomputeWindow(e){let t=i?128/e+1:256/e+1,n=[],r=this,a=r;for(let i=0;i<t;i++){a=r,n.push(a);for(let t=1;t<2**(e-1);t++)a=a.add(r),n.push(a);r=a.double()}return n}wNAF(t,n){!n&&this.equals(e.BASE)&&(n=s.BASE);let r=n&&n._WINDOW_SIZE||1;if(256%r)throw Error(`Point#wNAF: Invalid precomputation window, must be power of 2`);let a=n&&o.get(n);a||(a=this.precomputeWindow(r),n&&r!==1&&(a=e.normalizeZ(a),o.set(n,a)));let c=e.ZERO,l=e.ZERO,u=i?128/r+1:256/r+1,d=2**(r-1),f=BigInt(2**r-1),p=2**r,m=BigInt(r);for(let e=0;e<u;e++){let n=e*d,r=Number(t&f);if(t>>=m,r>d&&(r-=p,t+=1n),r===0)l=l.add(e%2?a[n].negate():a[n]);else{let e=a[n+Math.abs(r)-1];c=c.add(r<0?e.negate():e)}}return[c,l]}multiply(t,r){if(!x(t))throw TypeError(`Point#multiply: expected valid scalar`);let a=S(BigInt(t),n.n),o,s;if(i){let[t,i,c,l]=k(a),u,d,f,p;[u,f]=this.wNAF(i,r),[d,p]=this.wNAF(l,r),t&&(u=u.negate()),c&&(d=d.negate()),d=new e(S(d.x*n.beta),d.y,d.z),[o,s]=[u.add(d),f.add(p)]}else [o,s]=this.wNAF(a,r);return e.normalizeZ([o,s])[0]}toAffine(e=T(this.z)){let t=e**2n,n=S(this.x*t),r=S(this.y*t*e);return new s(n,r)}};a.BASE=new a(n.Gx,n.Gy,1n),a.ZERO=new a(0n,1n,0n);var o=new WeakMap,s=class e{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,o.delete(this)}static fromCompressedHex(t){let n=t.length===32,i=y(n?t:t.slice(1)),a=r(i),o=w(a),s=(o&1n)==1n;n?s&&(o=S(-o)):(t[0]&1)==1!==s&&(o=S(-o));let c=new e(i,o);return c.assertValidity(),c}static fromUncompressedHex(t){let n=y(t.slice(1,33)),r=y(t.slice(33)),i=new e(n,r);return i.assertValidity(),i}static fromHex(e){let t=v(e),n=t[0];if(t.length===32||t.length===33&&(n===2||n===3))return this.fromCompressedHex(t);if(t.length===65&&n===4)return this.fromUncompressedHex(t);throw Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${t.length}`)}static fromPrivateKey(t){return e.BASE.multiply(re(t))}static fromSignature(t,r,i){let o=t instanceof Uint8Array?y(t):g(t),{r:s,s:c}=ae(r);if(i!==0&&i!==1)throw Error(`Cannot recover signature: invalid yParity bit`);let l=2+(i&1),u=e.fromHex(`0${l}${p(s)}`),d=a.fromAffine(u).multiplyUnsafe(c),f=a.BASE.multiply(o),m=T(s,n.n),h=d.subtract(f).multiplyUnsafe(m).toAffine();return h.assertValidity(),h}toRawBytes(e=!1){return _(this.toHex(e))}toHex(e=!1){let t=p(this.x);return e?`${this.y&1n?`03`:`02`}${t}`:`04${t}${p(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e=`Point is not on elliptic curve`,{P:t}=n,{x:i,y:a}=this;if(i===0n||a===0n||i>=t||a>=t)throw Error(e);let o=S(a*a),s=r(i);if((o-s)%t!==0n)throw Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new e(this.x,S(-this.y))}double(){return a.fromAffine(this).double().toAffine()}add(e){return a.fromAffine(this).add(a.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return a.fromAffine(this).multiply(e,this).toAffine()}};e.Point=s,s.BASE=new s(n.Gx,n.Gy),s.ZERO=new s(0n,0n);function c(e){return Number.parseInt(e[0],16)>=8?`00`+e:e}var l=class e{constructor(e,t){this.r=e,this.s=t}static fromCompact(t){if(typeof t!=`string`&&!(t instanceof Uint8Array))throw TypeError(`Signature.fromCompact: Expected string or Uint8Array`);let n=t instanceof Uint8Array?f(t):t;if(n.length!==128)throw Error(`Signature.fromCompact: Expected 64-byte hex`);let r=new e(g(n.slice(0,64)),g(n.slice(64,128)));return r.assertValidity(),r}static fromDER(t){let n=`Signature.fromDER`;if(typeof t!=`string`&&!(t instanceof Uint8Array))throw TypeError(`${n}: Expected string or Uint8Array`);let r=t instanceof Uint8Array?f(t):t,i=b(r.slice(2,4));if(r.slice(0,2)!==`30`||i!==r.length-4||r.slice(4,6)!==`02`)throw Error(`${n}: Invalid signature ${r}`);let a=b(r.slice(6,8)),o=8+a,s=r.slice(8,o);if(s.startsWith(`00`)&&b(s.slice(2,4))<=127)throw Error(`${n}: Invalid r with trailing length`);let c=g(s);if(r.slice(o,o+2)!==`02`)throw Error(`${n}: Invalid r-s separator`);let l=b(r.slice(o+2,o+4)),u=i-l-a-10;if(u>0||u===-4)throw Error(`${n}: Invalid total length`);if(l>i-a-4)throw Error(`${n}: Invalid s`);let d=o+4,p=r.slice(d,d+l);if(p.startsWith(`00`)&&b(p.slice(2,4))<=127)throw Error(`${n}: Invalid s with trailing length`);let m=g(p),h=new e(c,m);return h.assertValidity(),h}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!j(e))throw Error(`Invalid Signature: r must be 0 < r < n`);if(!j(t))throw Error(`Invalid Signature: s must be 0 < s < n`)}toDERRawBytes(e=!1){return _(this.toDERHex(e))}toDERHex(e=!1){let t=c(h(this.s));if(e)return t;let n=c(h(this.r)),r=h(n.length/2),i=h(t.length/2);return`30${h(n.length/2+t.length/2+4)}02${r}${n}02${i}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return _(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}};e.Signature=l,e.SignResult=l;function d(...e){if(e.length===1)return e[0];let t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n}function f(e){let t=``;for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,`0`);return t}function p(e){return e.toString(16).padStart(64,`0`)}function m(e){return _(p(e))}function h(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function g(e){if(typeof e!=`string`)throw TypeError(`hexToNumber: expected string, got `+typeof e);return BigInt(`0x${e}`)}function _(e){if(typeof e!=`string`)throw TypeError(`hexToBytes: expected string, got `+typeof e);if(e.length%2)throw Error(`hexToBytes: received invalid unpadded hex`);let t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++){let r=n*2;t[n]=Number.parseInt(e.slice(r,r+2),16)}return t}function v(e){return e instanceof Uint8Array?e:_(e)}function y(e){return g(f(e))}function b(e){return Number.parseInt(e,16)*2}function x(e){return!!(typeof e==`bigint`&&e>0n||typeof e==`number`&&e>0&&Number.isSafeInteger(e))}function S(e,t=n.P){let r=e%t;return r>=0?r:t+r}function C(e,t){let{P:r}=n,i=e;for(;t-- >0n;)i*=i,i%=r;return i}function w(e){let{P:t}=n,r=e*e*e%t,i=r*r*e%t,a=C(i,3n)*i%t,o=C(a,3n)*i%t,s=C(o,2n)*r%t,c=C(s,11n)*s%t,l=C(c,22n)*c%t,u=C(l,44n)*l%t,d=C(u,88n)*u%t,f=C(d,44n)*l%t,p=C(f,3n)*i%t,m=C(p,23n)*c%t,h=C(m,6n)*r%t;return C(h,2n)}function T(e,t=n.P){if(e===0n||t<=0n)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=S(e,t),i=t,[a,o,s,c]=[0n,1n,1n,0n];for(;r!==0n;){let e=i/r,t=i%r,n=a-s*e,l=o-c*e;[i,r]=[r,t],[a,o]=[s,c],[s,c]=[n,l]}if(i!==1n)throw Error(`invert: does not exist`);return S(a,t)}function E(e,t=n.P){let r=e.length,i=Array(r),a=1n;for(let n=0;n<r;n++)e[n]!==0n&&(i[n]=a,a=S(a*e[n],t));a=T(a,t);for(let n=r-1;n>=0;n--){if(e[n]===0n)continue;let r=S(a*e[n],t);e[n]=S(a*i[n],t),a=r}return e}var D=(e,t)=>(e+t/2n)/t,O=2n**128n;function k(e){let{n:t}=n,r=64502973549206556628585045361533709077n,i=-303414439467246543595250775667605759171n,a=r,o=D(a*e,t),s=D(-i*e,t),c=S(e-o*r-s*367917413016453100223835821029139468248n,t),l=S(-o*i-s*a,t),u=c>O,d=l>O;if(u&&(c=t-c),d&&(l=t-l),c>O||l>O)throw Error(`splitScalarEndo: Endomorphism failed`);return[u,c,d,l]}function A(e){typeof e!=`string`&&(e=f(e));let t=g(e||`0`),r=e.length/2*8-256;return r>0&&(t>>=BigInt(r)),t>=n.n&&(t-=n.n),t}function ee(e,t){if(e==null)throw Error(`sign: expected valid msgHash, not "${e}"`);let n=typeof e==`string`?g(e):y(e),r=m(n),i=y(r),a=m(t),o=new Uint8Array(32).fill(1),s=new Uint8Array(32).fill(0),c=Uint8Array.from([0]),l=Uint8Array.from([1]);return[r,i,a,o,s,c,l]}async function te(t,n){let r=re(n),[i,a,o,s,c,l,u]=ee(t,r),d=e.utils.hmacSha256;c=await d(c,s,l,o,i),s=await d(c,s),c=await d(c,s,u,o,i),s=await d(c,s);for(let e=0;e<1e3;e++){s=await d(c,s);let e=M(s,a,r);if(e)return e;c=await d(c,s,l),s=await d(c,s)}throw TypeError(`secp256k1: Tried 1,000 k values for sign(), all were invalid`)}function ne(t,n){let r=re(n),[i,a,o,s,c,l,u]=ee(t,r),d=e.utils.hmacSha256Sync;if(!d)throw Error(`utils.hmacSha256Sync is undefined, you need to set it`);if(c=d(c,s,l,o,i),c instanceof Promise)throw Error(`To use sync sign(), ensure utils.hmacSha256 is sync`);s=d(c,s),c=d(c,s,u,o,i),s=d(c,s);for(let e=0;e<1e3;e++){s=d(c,s);let e=M(s,a,r);if(e)return e;c=d(c,s,l),s=d(c,s)}throw TypeError(`secp256k1: Tried 1,000 k values for sign(), all were invalid`)}function j(e){return 0<e&&e<n.n}function M(e,t,r){let i=y(e);if(!j(i))return;let a=n.n,o=s.BASE.multiply(i),c=S(o.x,a),l=S(T(i,a)*(t+c*r),a);if(!(c===0n||l===0n))return[o,c,l]}function re(e){let t;if(typeof e==`bigint`)t=e;else if(typeof e==`number`&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if(typeof e==`string`){if(e.length!==64)throw Error(`Expected 32 bytes of private key`);t=g(e)}else if(e instanceof Uint8Array){if(e.length!==32)throw Error(`Expected 32 bytes of private key`);t=y(e)}else throw TypeError(`Expected valid private key`);if(!j(t))throw Error(`Expected private key: 0 < key < n`);return t}function ie(e){return e instanceof s?(e.assertValidity(),e):s.fromHex(e)}function ae(e){return e instanceof l?(e.assertValidity(),e):l.fromDER(e)}function oe(e,t=!1){let n=s.fromPrivateKey(e);return typeof e==`string`?n.toHex(t):n.toRawBytes(t)}e.getPublicKey=oe;function se(e,t,n){let r=s.fromSignature(e,t,n);return typeof e==`string`?r.toHex():r.toRawBytes()}e.recoverPublicKey=se;function ce(e){let t=e instanceof Uint8Array,n=typeof e==`string`,r=(t||n)&&e.length;return t?r===33||r===65:n?r===66||r===130:e instanceof s}function le(e,t,n=!1){if(ce(e))throw TypeError(`getSharedSecret: first arg must be private key`);if(!ce(t))throw TypeError(`getSharedSecret: second arg must be public key`);let r=ie(t);r.assertValidity();let i=r.multiply(re(e));return typeof e==`string`?i.toHex(n):i.toRawBytes(n)}e.getSharedSecret=le;function ue(e,t,r=!1){let[i,a,o]=e,{canonical:s,der:c,recovered:u}=t,d=(i.x===a?0:2)|Number(i.y&1n),f=o,p=n.n>>1n;o>p&&s&&(f=n.n-o,d^=1);let m=new l(a,f);m.assertValidity();let h=c===!1?m.toCompactHex():m.toDERHex(),g=r?h:_(h);return u?[g,d]:g}async function de(e,t,n={}){return ue(await te(e,t),n,typeof e==`string`)}e.sign=de;function fe(e,t,n={}){return ue(ne(e,t),n,typeof e==`string`)}e.signSync=fe;function pe(e,t,r){let{n:i}=n,o;try{o=ae(e)}catch{return!1}let{r:s,s:c}=o,l=A(t);if(l===0n)return!1;let u=a.fromAffine(ie(r)),d=T(c,i),f=S(l*d,i),p=S(s*d,i),m=a.BASE.multiply(f),h=u.multiplyUnsafe(p),g=m.add(h).toAffine();return S(g.x,i)===s}e.verify=pe;async function me(t,...n){let r=new Uint8Array(t.split(``).map(e=>e.charCodeAt(0))),i=await e.utils.sha256(r),a=await e.utils.sha256(d(i,i,...n));return y(a)}async function he(e,t,r){let i=m(e),a=await me(`BIP0340/challenge`,i,t.toRawX(),r);return S(a,n.n)}function ge(e){return S(e.y,2n)===0n}var _e=class e{constructor(e,t){if(this.r=e,this.s=t,e<=0n||t<=0n||e>=n.P||t>=n.n)throw Error(`Invalid signature`)}static fromHex(t){let n=v(t);if(n.length!==64)throw TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${n.length}`);let r=y(n.slice(0,32)),i=y(n.slice(32));return new e(r,i)}toHex(){return p(this.r)+p(this.s)}toRawBytes(){return _(this.toHex())}};function ve(e){let t=s.fromPrivateKey(e);return typeof e==`string`?t.toHexX():t.toRawX()}async function ye(t,r,i=e.utils.randomBytes()){if(t==null)throw TypeError(`sign: Expected valid message, not "${t}"`);r||=0n;let{n:a}=n,o=v(t),c=re(r),l=v(i);if(l.length!==32)throw TypeError(`sign: Expected 32 bytes of aux randomness`);let u=s.fromPrivateKey(c),d=ge(u)?c:a-c,f=await me(`BIP0340/aux`,l),p=d^f,h=await me(`BIP0340/nonce`,m(p),u.toRawX(),o),g=S(h,a);if(g===0n)throw Error(`sign: Creation of signature failed. k is zero`);let _=s.fromPrivateKey(g),y=ge(_)?g:a-g,b=await he(_.x,u,o),x=new _e(_.x,S(y+b*d,a));if(!await be(x.toRawBytes(),o,u.toRawX()))throw Error(`sign: Invalid signature produced`);return typeof t==`string`?x.toHex():x.toRawBytes()}async function be(e,t,n){let r=e instanceof _e?e:_e.fromHex(e),i=typeof t==`string`?_(t):t,a=ie(n),o=await he(r.r,a,i),c=s.fromPrivateKey(r.s),l=a.multiply(o),u=c.subtract(l);return!(u.equals(s.BASE)||!ge(u)||u.x!==r.r)}e.schnorr={Signature:_e,getPublicKey:ve,sign:ye,verify:be},s.BASE._setWindowSize(8);var xe=(()=>{let e=typeof self==`object`&&`crypto`in self?self.crypto:void 0;return{node:t!==void 0&&typeof u==`function`&&!e?Ut():void 0,web:e}})();e.utils={isValidPrivateKey(e){try{return re(e),!0}catch{return!1}},randomBytes:(e=32)=>{if(xe.web)return xe.web.getRandomValues(new Uint8Array(e));if(xe.node){let{randomBytes:t}=xe.node;return new Uint8Array(t(e).buffer)}else throw Error(`The environment doesn't have randomBytes function`)},randomPrivateKey:()=>{let t=8;for(;t--;){let t=e.utils.randomBytes(32),n=y(t);if(j(n)&&n!==1n)return t}throw Error(`Valid private key was not found in 8 iterations. PRNG is broken`)},sha256:async e=>{if(xe.web){let t=await xe.web.subtle.digest(`SHA-256`,e.buffer);return new Uint8Array(t)}else if(xe.node){let{createHash:t}=xe.node;return Uint8Array.from(t(`sha256`).update(e).digest())}else throw Error(`The environment doesn't have sha256 function`)},hmacSha256:async(e,...t)=>{if(xe.web){let n=await xe.web.subtle.importKey(`raw`,e,{name:`HMAC`,hash:{name:`SHA-256`}},!1,[`sign`]),r=d(...t),i=await xe.web.subtle.sign(`HMAC`,n,r);return new Uint8Array(i)}else if(xe.node){let{createHmac:n}=xe.node,r=n(`sha256`,e);for(let e of t)r.update(e);return Uint8Array.from(r.digest())}else throw Error(`The environment doesn't have hmac-sha256 function`)},sha256Sync:void 0,hmacSha256Sync:void 0,precompute(e=8,t=s.BASE){let n=t===s.BASE?t:new s(t.x,t.y);return n._setWindowSize(e),n.multiply(3n),n}}})),YM=l(JM()),XM=e=>{if(!e)return``;if(typeof e==`string`)return e;if(e?.signature)return XM(e.signature);if(typeof e.toCompactHex==`function`)return e.toCompactHex();if(typeof e.toHex==`function`)return e.toHex();let t=e=>Array.from(e,e=>e.toString(16).padStart(2,`0`)).join(``);if(e instanceof Uint8Array)return t(e);if(ArrayBuffer.isView(e))return t(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));if(e instanceof ArrayBuffer)return t(new Uint8Array(e));if(Array.isArray(e))return t(Uint8Array.from(e));throw Error(`Unsupported signature format`)},ZM=e=>{if(!e)return``;let t=e instanceof Uint8Array?e:new Uint8Array(e);if(typeof btoa==`function`){let e=``;return t.forEach(t=>{e+=String.fromCharCode(t)}),btoa(e)}return typeof Buffer<`u`?Buffer.from(t).toString(`base64`):Array.from(t,e=>e.toString(16).padStart(2,`0`)).join(``)};async function QM(e){if(typeof e?.getStatus!=`function`)throw Error(`Wallet bootstrap unavailable`);let t=e.getStatus();if(!t?.wallet){let n=await e.initialize?.();t={...t,...n}}let n=t?.wallet,r=t?.identityKey;if(!n||!r)throw Error(`Wallet connection required to upgrade thread`);return{walletClient:n,walletPublicKey:r}}async function $M(e){return e?.unwrapKeyWithECIES&&e?.wrapKeyWithECIES?e:Qs(()=>import(`./keyWrapping-zVnDilXu.js`),[])}async function eN(e,t,n,r){let{unwrapKeyWithECIES:i,wrapKeyWithECIES:a}=await $M(r),o=await i(e.wrap,t);return{wrappedKey:await a(o,n),rawKeyBase64:ZM(o)}}async function tN({threadId:e,receipt:t,getGuestIdentity:n,updateJoinReceipt:r,deleteGuestIdentity:i,walletBootstrap:a,keyWrapping:o}){if(!e)throw Error(`threadId required for upgrade`);if(!t)throw Error(`Join receipt missing for upgrade`);if(t.identityKind===`holder`)return t;let s=t.guestIdentityId;console.log(`[guestUpgrade] receipt:`,t),console.log(`[guestUpgrade] guestIdentityId:`,s);let c=s?await n(s):null;if(console.log(`[guestUpgrade] guestIdentity:`,c),!c?.privateKey||!c?.publicKey)throw Error(`Guest identity key material unavailable`);let{walletClient:l,walletPublicKey:u}=await QM(a),d=new Date().toISOString(),f={intent:`nukenote.link-guest-to-wallet`,threadId:e,inviteHash:t.inviteHash,guestPublicKey:c.publicKey,walletPublicKey:u,timestamp:d},p=JSON.stringify(f),m=new TextEncoder().encode(p),h=await YM.utils.sha256(m),g=XM(await YM.sign(h,c.privateKey)),_,v,y=!1,b={hashToDirectlySign:Array.from(h),seekPermission:!1,keyID:`1`};try{console.log(`[guestUpgrade] Requesting wallet signature...`),_=await l.createSignature?.(b),v=_?.signature||_,console.log(`[guestUpgrade] Wallet signature obtained successfully`)}catch(e){console.warn(`[guestUpgrade] Wallet signature failed, using fallback:`,e.message);try{v=XM(await YM.sign(h,c.privateKey)),y=!0,console.log(`[guestUpgrade] Fallback signature generated successfully`)}catch(t){throw console.error(`[guestUpgrade] Fallback signature also failed:`,t),Error(`Unable to sign upgrade statement: ${e.message}`)}}if(!v)throw Error(`Wallet did not return a signature for upgrade statement`);let{wrappedKey:x,rawKeyBase64:S}=await eN(t,c.privateKey,u,o),C=t.holderPublicKey||t.peerWalletPublicKey||null,w=await r(e,{identityKind:`holder`,holderPublicKey:u,guestIdentityId:null,wrap:x,upgradedAt:d,supportsLeave:!1,peerWalletPublicKey:C,upgradeProof:{statement:f,guestSignature:g,walletSignature:v,walletSignatureFallback:y?!0:void 0}});return s&&await i(s),{receipt:w,controlPayload:{action:`link`,walletPublicKey:u,upgradedAt:d},rawThreadKeyBase64:S}}var nN=null;function rN(){return nN||=Qs(()=>import(`./esm-CMhbvdo9.js`),[]),nN}function iN(e){if(!e)return null;if(e instanceof Uint8Array)return e;if(Array.isArray(e))return Uint8Array.from(e);if(typeof e==`string`)try{let t=e.trim();if(/^[0-9a-fA-F]+$/.test(t)&&t.length%2==0){let e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=parseInt(t.slice(n,n+2),16);return e}}catch{console.warn(`[uint8ArrayFromMaybe] Failed to parse string as bytes`)}return null}function aN(e){if(!e)return null;let t=e instanceof Uint8Array?e:Array.isArray(e)?Uint8Array.from(e):iN(e);if(!t)return null;let n=``,r=32768;for(let e=0;e<t.length;e+=r)n+=String.fromCharCode.apply(null,t.subarray(e,e+r));return btoa(n)}async function oN(e){if(!e||typeof e!=`object`)return null;let{Transaction:t}=await rN(),n=e.tx||e.transaction||e.btx,r=e.rawTx||e.txHex||e.hex||e.rawtx;if(typeof r==`string`&&r.trim())try{return t.fromHex(r.trim())}catch(e){console.warn(`[parseTransactionFromResponse] Failed to parse hex tx`,e)}if(Array.isArray(n)&&n.length)try{let e=n instanceof Uint8Array?n:Uint8Array.from(n);return t.fromBEEF(e)}catch(e){console.warn(`[parseTransactionFromResponse] Failed to parse BEEF tx`,e)}if(n&&typeof n==`object`){let e=n.beef||n.raw||n.tx;if(Array.isArray(e))try{let n=Uint8Array.from(e);return t.fromBEEF(n)}catch(e){console.warn(`[parseTransactionFromResponse] Failed to parse nested BEEF tx`,e)}let r=n.hex||n.rawTx;if(typeof r==`string`&&r.trim())try{return t.fromHex(r.trim())}catch(e){console.warn(`[parseTransactionFromResponse] Failed to parse nested hex tx`,e)}}return null}async function sN(e){let{Transaction:t}=await rN(),n=await oN(e),r=null,i=null;if(n){try{r=n.toBEEF()}catch(e){console.warn(`[collectTransactionArtifacts] Failed to convert tx to BEEF`,e)}try{i=n.toHex()}catch(e){console.warn(`[collectTransactionArtifacts] Failed to convert tx to hex`,e)}}else{let a=e?.tx||e?.transaction||e?.btx;r=iN(a);let o=e?.rawTx||e?.txHex||e?.hex||e?.rawtx;if(typeof o==`string`&&o.trim()&&(i=o.trim()),!n)try{r?n=t.fromBEEF(r):i&&(n=t.fromHex(i))}catch(e){console.warn(`[collectTransactionArtifacts] Unable to reconstruct transaction from response`,e)}}if(!i&&n)try{i=n.toHex()}catch(e){console.warn(`[collectTransactionArtifacts] Failed to derive hex from transaction`,e)}if((!r||r.length===0)&&n)try{r=n.toBEEF()}catch(e){console.warn(`[collectTransactionArtifacts] Failed to derive BEEF from transaction`,e)}let a=r?aN(r):null;return{transactionHex:typeof i==`string`&&i.length?i:null,transactionBeefBase64:a,hasArtifacts:!!(i&&i.length||a&&a.length)}}var cN=`nukenote.tx.`;function lN(e,t){if(!e||!t||typeof window>`u`)return;let n={hex:t.transactionHex||null,beefBase64:t.transactionBeefBase64||null,storedAt:Date.now()};try{window.localStorage.setItem(`${cN}${e}`,JSON.stringify(n))}catch(e){console.warn(`[persistTransactionArtifactsToStorage] Failed to persist artifacts`,e)}}async function uN(e,t=[]){if(!Array.isArray(t)||t.length===0)return[];let n=await oN(e);if(!n)return console.warn(`[mapLockingScriptsToIndexes] Transaction unavailable in wallet response`),t.map(()=>null);let r=t.map(e=>typeof e==`string`?e.toLowerCase():``),i=(n.outputs||[]).map(e=>{try{return e.lockingScript?.toHex()?.toLowerCase()||``}catch{return``}});return r.map(e=>{if(!e)return null;let t=i.indexOf(e);return t>=0?(i[t]=null,t):(console.warn(`[mapLockingScriptsToIndexes] Unable to locate lockingScript in transaction outputs`,{target:e}),null)})}function dN({blobHash:e,hintURL:t=``,encKeyWrap:n,meta:r={}}){let i=new Date().toISOString();return{type:`CT`,blobHash:String(e||``),hintURL:t?String(t):``,encKeyWrap:String(n||``),meta:{name:String(r.name||``),created:String(r.created||i),expiry:r.expiry||null,version:String(r.version||`1.0`),...r},timestamp:Date.now()}}function fN(e){let t=[];return(!e||typeof e!=`object`)&&t.push(`payload must be object`),e.type!==`CT`&&t.push(`type must be CT`),/^[0-9a-fA-F]{64}$/.test(String(e.blobHash||``))||t.push(`blobHash must be 64-hex`),e.encKeyWrap||t.push(`encKeyWrap (wrapped key) required`),(!e.meta||typeof e.meta!=`object`)&&t.push(`meta required`),{ok:t.length===0,errors:t}}function pN(e){let{ok:t,errors:n}=fN(e);if(!t)throw Error(`Invalid CT payload: `+n.join(`, `));return{t:`CT`,h:e.blobHash,u:e.hintURL||void 0,k:e.encKeyWrap,m:e.meta,ts:e.timestamp}}function mN(e){if(!e||typeof e!=`string`)throw Error(`base64 string required`);let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r}async function hN(e,t){if(!e||e.length!==32)throw Error(`keyToWrap must be 32 bytes (AES-256 key)`);if(!t||typeof t!=`string`)throw Error(`recipientPubKey must be a hex string`);let{PublicKey:n,PrivateKey:r,Hash:i}=await Qs(async()=>{let{PublicKey:e,PrivateKey:t,Hash:n}=await import(`./esm-CMhbvdo9.js`);return{PublicKey:e,PrivateKey:t,Hash:n}},[]),a=n.fromString(t,`hex`),o=r.fromRandom(),s=o.toPublicKey(),c=a.deriveSharedSecret(o),l=i.sha256(c.encode(!0)),u=new Uint8Array(l),d=await crypto.subtle.importKey(`raw`,u,{name:`AES-GCM`},!1,[`encrypt`]),f=crypto.getRandomValues(new Uint8Array(12)),p=await crypto.subtle.encrypt({name:`AES-GCM`,iv:f},d,e),m=s.encode(!0),h=new Uint8Array(45+p.byteLength);return h.set(m,0),h.set(f,33),h.set(new Uint8Array(p),45),btoa(String.fromCharCode(...h))}async function gN(e,t){if(!e||typeof e!=`string`)throw Error(`wrappedKey must be a base64 string`);if(!t||typeof t!=`string`)throw Error(`recipientPrivKey required`);let{PrivateKey:n,PublicKey:r,Hash:i}=await Qs(async()=>{let{PrivateKey:e,PublicKey:t,Hash:n}=await import(`./esm-CMhbvdo9.js`);return{PrivateKey:e,PublicKey:t,Hash:n}},[]),a;try{a=typeof t==`string`&&(t.length===51||t.length===52)&&/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]+$/.test(t)?n.fromWif(t):n.fromString(t,`hex`)}catch(e){throw console.error(`[keyWrapping] Failed to parse recipientPrivKey`,e),e}let o=Vx(e),s=Uint8Array.from(o,e=>e.charCodeAt(0)),c=s.slice(0,33),l=s.slice(33,45),u=s.slice(45),d=r.fromString(Array.from(c).map(e=>e.toString(16).padStart(2,`0`)).join(``),`hex`).deriveSharedSecret(a),f=i.sha256(d.encode(!0)),p=new Uint8Array(f),m=await crypto.subtle.importKey(`raw`,p,{name:`AES-GCM`},!1,[`decrypt`]),h;try{h=await crypto.subtle.decrypt({name:`AES-GCM`,iv:l},m,u)}catch(e){throw e.name===`OperationError`?Error(`Key unwrap failed: authentication tag mismatch or corrupted ciphertext. The wrapped key may have been tampered with or the wrong private key was used.`):e}return new Uint8Array(h)}async function _N(e,t){if(!t)throw Error(`Wallet instance required`);let n=await t.getPublicKey({identityKey:!0}),r=n.publicKey||n.identityKey||n;if(!r)throw Error(`Failed to get public key from wallet`);return hN(e,r)}async function vN({ctTxid:e,ctVout:t=0,recipients:n,permissions:r=`read-only`,description:i=`Mint NukeNote DTs`,fundingUtxos:a=[],rawKeyBase64:o}){if(console.log(`[mintDataTokens] Called with:`,{ctTxid:e,ctVout:t,recipients:n,permissions:r}),!/^[0-9a-fA-F]{64}$/.test(e||``))throw Error(`ctTxid must be 64-hex`);if(!Array.isArray(n)||n.length===0)throw Error(`recipients array required`);if(!o||typeof o!=`string`)throw Error(`rawKeyBase64 required`);console.log(`[mintDataTokens] Getting wallet...`);let{client:s}=await nc();console.log(`[mintDataTokens] Wallet obtained, importing PushDrop...`);let{PushDrop:c}=await Qs(async()=>{let{PushDrop:e}=await import(`./esm-CMhbvdo9.js`);return{PushDrop:e}},[]);console.log(`[mintDataTokens] Creating PushDrop instance...`);let l=new c(s);console.log(`[mintDataTokens] Building outputs...`);let u=[],d=mN(o),f=[],p=[];for(let i of n){let n=await hN(d,i),a={t:`DT`,mode:`outpoint`,txid:e,vout:t,to:i,p:r,k:n,m:{created:new Date().toISOString()},ts:Date.now()};console.log(`[mintDataTokens] DT payload:`,a);let o=new TextEncoder().encode(JSON.stringify(a)),s=[Array.from(o)];console.log(`[mintDataTokens] Calling pushdrop.lock (instance method)...`);let c=await l.lock(s,[2,`NukeNote DT`],`1`,`self`,!1,!1);console.log(`[mintDataTokens] pushdrop.lock completed`);let m=c.toHex(),h=m.toLowerCase(),g=u.length;u.push({satoshis:1,lockingScript:m,outputDescription:`NukeNote DT for ${i.slice(0,8)}...`}),f.push(h),p.push({lockingScriptHex:h,satoshis:1,vout:g})}console.log(`[mintDataTokens] Outputs built, calling wallet.createAction...`);let m=await Ly(50),h=m?[m,...u]:u,g=await s.createAction({description:i,outputs:h,fundingUtxos:a,options:{randomizeOutputs:!1}});console.log(`[mintDataTokens] createAction response:`,g);let _=ac(g);if(_&&!g.txid)try{g.txid=_}catch(e){console.debug(`Unable to assign txid on data token response`,e)}let v=m?1:0,y=u.map((e,t)=>({txid:_||null,vout:v+t,recipient:n[t]}));try{(await uN(g,f)).forEach((e,t)=>{typeof e==`number`&&e>=0&&(y[t].vout=e,p[t].vout=e)})}catch(e){console.warn(`[mintDataTokens] Failed to map DT outputs to actual vout indexes`,e)}let b=null;try{b=await sN(g)}catch(e){console.warn(`[mintDataTokens] Failed to collect transaction artifacts`,e)}_&&b?.hasArtifacts&&lN(_,b);let x={txid:_||null,outputs:p};return Iy(),{response:g,txid:_,dtOutpoints:y,artifacts:b,broadcast:x}}async function yN({ctTxid:e,ctVout:t=0,description:n=`Burn NukeNote CT`,fundingUtxos:r=[],broadcast:i=null,artifacts:a=null}){if(!/^[0-9a-fA-F]{64}$/.test(e||``))throw Error(`ctTxid must be 64-hex`);console.log(`[burnControlToken] Called with:`,{ctTxid:e,ctVout:t}),await ic();let{client:o}=await nc(),{Script:s,PushDrop:c,Transaction:l}=await Qs(async()=>{let{Script:e,PushDrop:t,Transaction:n}=await import(`./esm-CMhbvdo9.js`);return{Script:e,PushDrop:t,Transaction:n}},[]),u=sc.getStatus?.()||{},d=u.walletType===`json-api`,f=s.fromASM(`OP_FALSE OP_RETURN`);console.log(`[burnControlToken] Creating PushDrop instance for unlock template...`);let p=new c(o),m=[2,`NukeNote Thread CT`],h=`thread-ct`,g=`self`,_=i?.lockingScriptHex||null,v=typeof i?.satoshis==`number`?i.satoshis:null;if(d&&(!_||v===null))throw Error(`Missing Control Token broadcast metadata for this thread. JSON-API wallet cannot burn this CT.`);let y=null;if(a?.transactionBeefBase64)try{y=mN(a.transactionBeefBase64)}catch(e){console.warn(`[burnControlToken] Failed to decode transactionBeefBase64`,e)}if(!y&&a?.transactionHex)try{y=l.fromHex(a.transactionHex).toBEEF()}catch(e){console.warn(`[burnControlToken] Failed to convert transactionHex to BEEF`,e)}y||console.warn(`[burnControlToken] No transaction artifacts available for CT burn input`);let b=p.unlock(m,h,g,`all`,!1),x={txid:e,vout:t,inputDescription:`Control Token to burn`,unlockingScriptTemplate:b,outpoint:`${e}.${t}`};_&&(x.lockingScript=_,x.lockingScriptHex=_),v!==null&&(x.satoshis=v,x.sourceSatoshis=v),(d||u.walletType===`brc6`)&&(x.unlockingScriptTemplate={type:`pushdrop`,params:{protocol_id:m,key_id:h,counterparty:g,permission:`all`,for_self:!1}},x.unlockingScriptLength=220);let S=await Ly(50),C=S?[S,{satoshis:0,lockingScript:f.toHex(),outputDescription:`CT burn (provable erasure)`}]:[{satoshis:0,lockingScript:f.toHex(),outputDescription:`CT burn (provable erasure)`}];console.log(`[burnControlToken] Calling wallet.createAction with burn output...`);let w={description:n,inputs:[x],outputs:C,fundingUtxos:r,options:{randomizeOutputs:!1}};y&&(w.inputBEEF=Array.from(y));let T=await o.createAction(w);console.log(`[burnControlToken] createAction response:`,T);let E=ac(T),D=null;try{if(T?.signableTransaction){console.log(`[burnControlToken] signableTransaction returned, performing manual signature...`);let{reference:e,tx:t}=T.signableTransaction;if(!e||!t)throw Error(`Wallet returned malformed signableTransaction payload`);let n=l.fromBEEF(t),r=(await b.sign(n,0)).toHex(),i=r.length/2;D=await o.signAction({reference:e,spends:{0:{unlockingScript:r,unlockingScriptLength:i}}}),console.log(`[burnControlToken] signAction response:`,D),E=ac(D)||E}}catch(e){let t=String(e?.message||``);throw t.includes(`unlockScript parameter must be valid`)||t.includes(`Script evaluation error`)?Error(`This wallet does not control the Control Token for this thread. Only the wallet that minted the Control Token can burn it.`):e}if(E&&!T.txid)try{T.txid=E}catch(e){console.debug(`Unable to assign txid on burn response`,e)}let O=D||T,k=null;try{k=await sN(O)}catch(e){console.warn(`[burnControlToken] Failed to collect burn transaction artifacts`,e)}return E&&k?.hasArtifacts&&lN(E,k),Iy(),{response:T,burnTxid:E,signResult:D,artifacts:k}}async function bN({blobHash:e,encKeyWrap:t,hintURL:n=``,policy:r=`mutual`,meta:i={}}){if(!/^[0-9a-fA-F]{64}$/.test(e||``))throw Error(`blobHash must be 64-hex`);if(!t||typeof t!=`string`)throw Error(`encKeyWrap required`);let a=dN({blobHash:e,hintURL:n,encKeyWrap:t,meta:{policy:r,...i}}),o=pN(a),s=JSON.stringify(o),c=new TextEncoder().encode(s),{client:l}=await nc(),{PushDrop:u}=await Qs(async()=>{let{PushDrop:e}=await import(`./esm-CMhbvdo9.js`);return{PushDrop:e}},[]),d=(await new u(l).lock([Array.from(c)],[2,`NukeNote Thread CT`],`thread-ct`,`self`,!1,!1)).toHex(),f=[{satoshis:1,lockingScript:d,outputDescription:`NukeNote Thread CT`}],p=await Ly(50),m=p?[p,...f]:f,h=await l.createAction({description:`Mint NukeNote Thread CT`,outputs:m,options:{randomizeOutputs:!1}}),g=ac(h),_=p?1:0;try{let[e]=await uN(h,[d]);typeof e==`number`&&e>=0&&(_=e)}catch(e){console.warn(`[mintThreadControlToken] unable to map locking script index`,e)}let v=null;try{v=await sN(h),g&&v?.hasArtifacts&&lN(g,v)}catch(e){console.warn(`[mintThreadControlToken] failed collecting artifacts`,e)}let y={txid:g||null,lockingScriptHex:d,satoshis:f[0]?.satoshis??1,vout:_};return Iy(),{txid:g,vout:_,wrapPayload:o,ctOutpoint:g?{txid:g,vout:_}:null,artifacts:v,broadcast:y}}async function xN({ctTxid:e,ctVout:t=0,broadcast:n=null,artifacts:r=null}){if(!/^[0-9a-fA-F]{64}$/.test(e||``))throw Error(`ctTxid must be 64-hex`);let i=await yN({ctTxid:e,ctVout:t,broadcast:n,artifacts:r,description:`Burn NukeNote Thread CT`});return{burnTxid:i?.burnTxid||null,artifacts:i?.artifacts||null,response:i?.response||null,signResult:i?.signResult||null}}async function SN(e){let t=new TextEncoder,n=await crypto.subtle.importKey(`raw`,t.encode(e),`HKDF`,!1,[`deriveKey`]);return crypto.subtle.deriveKey({name:`HKDF`,salt:t.encode(`nukenote-backup-salt`),info:t.encode(`nukenote-backup-key`),hash:`SHA-256`},n,{name:`AES-GCM`,length:256},!1,[`encrypt`,`decrypt`])}async function CN(e,t){let n=await SN(t),r=crypto.getRandomValues(new Uint8Array(12)),i=new TextEncoder,a=await crypto.subtle.encrypt({name:`AES-GCM`,iv:r},n,i.encode(JSON.stringify(e))),o=new Uint8Array(r.length+a.byteLength);return o.set(r,0),o.set(new Uint8Array(a),r.length),btoa(String.fromCharCode(...o))}async function wN(e,t){let n=await SN(t),r=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),i=r.slice(0,12),a=r.slice(12),o=await crypto.subtle.decrypt({name:`AES-GCM`,iv:i},n,a),s=new TextDecoder;return JSON.parse(s.decode(o))}async function TN(e,t=``){let n=new TextEncoder().encode(`${t}${e}`),r=await crypto.subtle.digest(`SHA-256`,n),i=new Uint8Array(r);return t+Array.from(i.slice(0,16)).map(e=>e.toString(16).padStart(2,`0`)).join(``)}var EN=`backup:`,DN=`[thread-backup]`;function ON(e,t){let n=VM(e,t);return n?`${EN}${n}`:null}async function kN({ctTxid:e,ctVout:t,logger:n=console}){if(!BM())return{success:!0};let r=ON(e,t);if(!r)return{success:!1,error:`Invalid CT outpoint`};try{return await RM(r),n.info?.(DN,`thread backup deleted`,{cacheId:r}),{success:!0}}catch(e){return n.warn?.(DN,`failed to delete thread backup`,{cacheId:r,error:e?.message||String(e)}),{success:!1,error:e?.message||`Delete failed`}}}async function AN({ctTxid:e,ctVout:t=0,recipientPubkeys:n,threadKeyBase64:r,permissions:i=`read-only`}){if(!/^[0-9a-fA-F]{64}$/.test(e||``))throw Error(`ctTxid must be 64-hex`);if(!Number.isInteger(t)||t<0)throw Error(`ctVout must be a non-negative integer`);if(!Array.isArray(n)||n.length===0)throw Error(`recipientPubkeys array required`);if(!r||typeof r!=`string`)throw Error(`threadKeyBase64 required`);let{txid:a,dtOutpoints:o,artifacts:s,broadcast:c}=await vN({ctTxid:e,ctVout:t,recipients:n,permissions:i,rawKeyBase64:r}),l=o.map(({recipient:e,vout:t})=>({recipientPubkey:e,vout:t}));return{txid:a||null,outputs:l,artifacts:s||null,broadcast:c||null}}async function jN(e,t,n,r,i,a,{rawThreadKeyBase64:o}={}){let s=await Gk(e);if(!s)return console.warn(`[threadLifecycle] No thread metadata found for CT minting`,e),null;let{encKeyWrap:c,blobHash:l}=s,u=o||s.rawKeyBase64||null;if(!c||!l)return console.warn(`[threadLifecycle] Missing encKeyWrap/blobHash for CT mint`,e,{hasEncKeyWrap:!!c,hasBlobHash:!!l}),null;u||console.warn(`[threadLifecycle] Missing raw thread key for DT issuance`,e);let d=new Date().toISOString();try{let o=await bN({threadId:e,encKeyWrap:c,blobHash:l,hintURL:s.hintURL||``,policy:s.policy||t.policy||`mutual`});console.log(`[threadLifecycle] CT minted for thread ${e}:`,{ctTxid:o.txid,ctVout:o.vout,ctOutpoint:`${o.txid}:${o.vout}`});let f=null,p=s.helperCache||null,m=p,h=Array.isArray(s.dtIssuances)?s.dtIssuances:[];if(!u||!t?.holderPublicKey)throw Error(`[threadLifecycle] Cannot mint DTs: missing rawKeyBase64 or holderPublicKey for thread ${e}`);try{let n=[t.holderPublicKey];t.guestPublicKey&&n.push(t.guestPublicKey);let r=await AN({ctTxid:o.txid,ctVout:o.vout,recipientPubkeys:n,threadKeyBase64:u});f={txid:r.txid,outputs:r.outputs,broadcast:r.broadcast,artifacts:r.artifacts,issuedAt:new Date().toISOString()},console.log(`[threadLifecycle] DT(s) minted for thread ${e}:`,{dtTxid:r.txid,recipients:n.length,outputs:r.outputs.map(e=>`${r.txid}:${e.vout}  ${e.recipientPubkey.slice(0,8)}...`)}),i.current?.publishControl(e,{action:`mint-dt`,issuance:f})}catch(t){throw console.error(`[threadLifecycle] CRITICAL: Failed to mint DTs - thread will be unusable`,t),Error(`DT minting failed for thread ${e}: ${t.message}`)}if((!m||m.cacheId!==`${o.txid}:${o.vout}`||m.enrolled===!1)&&s.encKeyWrap&&s.blobHash){let n={encKeyWrap:s.encKeyWrap,blobHash:s.blobHash,hintURL:s.hintURL||``,policy:s.policy||t.policy||`mutual`},r=await HM({threadId:e,ctTxid:o.txid,ctVout:o.vout,payload:n,logger:console});if(r){let e=r.lastAttemptAt||r.enrolledAt||new Date().toISOString();m={...p,...r,lastAttemptAt:e,lastFetchAt:p?.lastFetchAt||null,lastFetchSucceeded:p?.lastFetchSucceeded??null}}}let g=t.guestPublicKey||t.holderPublicKey||null,_=t.guestPublicKey?`guest`:`holder`,v={...s,ctTxid:o.txid,ctVout:o.vout,encKeyWrap:s.encKeyWrap,blobHash:s.blobHash,hintURL:s.hintURL||``,policy:s.policy||t.policy||`mutual`,mintedAt:d,lastMintTxid:o.txid,ctBroadcast:o.broadcast||s.ctBroadcast||null,ctArtifacts:o.artifacts||s.ctArtifacts||null,dtIssuances:f?[...h,f]:h,helperCache:m||p||null,peerPublicKey:g,peerKind:_};delete v.rawKeyBase64,s=await Kk(e,v);let y=u,b={...t,ctTxid:o.txid,ctVout:o.vout,mintedAt:d,lastMintTxid:o.txid,threadMetadata:s,dtIssuances:s.dtIssuances||[],helperCache:s.helperCache||null,rawThreadKeyBase64:y},{saveJoinReceipt:x}=await Qs(async()=>{let{saveJoinReceipt:e}=await import(`./storage-CvT-bkm4.js`);return{saveJoinReceipt:e}},[]),S={...b};return delete S.rawThreadKeyBase64,await x(e,S),n(t=>({...t,[e]:b})),a?.current&&(a.current[e]=b),r(t=>t.some(t=>t.id===e)?t.map(t=>t.id===e?sM(b):t):[...t,sM(b)]),o.broadcast&&i.current?.publishControl(e,{action:`mint-ct`,txid:o.txid,vout:o.vout,occurredAt:d}),s}catch(t){throw console.error(`[threadLifecycle] CRITICAL: Failed to mint thread CT`,t),Error(`CT minting failed for thread ${e}: ${t.message}`)}}async function MN(e,t,n,r,i,{rawThreadKeyBase64:a}={}){if(!e||!t)throw Error(`[threadLifecycle] mintGuestDTForThread requires threadId and guestPublicKey`);let o=await Gk(e);if(!o)throw Error(`[threadLifecycle] No thread metadata found for guest DT mint: ${e}`);let s=o.ctTxid||null,c=Number.isInteger(o.ctVout)?o.ctVout:0,l=Number.isInteger(c)&&c>=0?c:0;if(!s)throw Error(`[threadLifecycle] Cannot mint guest DT without CT reference for thread ${e}`);let u=a||o.rawKeyBase64||null;if(!u)throw Error(`[threadLifecycle] Cannot mint guest DT: missing raw thread key for thread ${e}`);let d=Array.isArray(o.dtIssuances)?o.dtIssuances:[],f=await AN({ctTxid:s,ctVout:l,recipientPubkeys:[t],threadKeyBase64:u}),p={txid:f.txid,outputs:f.outputs,broadcast:f.broadcast,artifacts:f.artifacts,issuedAt:new Date().toISOString()};console.log(`[threadLifecycle] Guest DT minted for thread ${e}:`,{dtTxid:f.txid,guest:`${t.slice(0,8)}...`,outputs:f.outputs.map(e=>`${f.txid}:${e.vout}`)});let m={...o,dtIssuances:[...d,p]};delete m.rawKeyBase64,o=await Kk(e,m);let h=await Uk(e,{threadMetadata:o,dtIssuances:o.dtIssuances||[]});return h&&(n(t=>({...t,[e]:h})),r(t=>t.map(t=>t.id===e?sM(h):t))),i.current?.publishControl(e,{action:`mint-dt`,issuance:p}),{ctTxid:s,ctVout:l,dtIssuance:p,threadMetadata:o,receipt:h||null}}async function NN(e,t,n,r){if(!e)return;console.log(`[threadLifecycle] leaveThreadAction starting`,{threadId:e,status:t?.status});let i=t?.guestIdentityId,a=t?.status===`burned`;a||r.current?.publishControl(e,{action:`leave`,occurredAt:new Date().toISOString()});let o=new Date().toISOString();try{await Uk(e,a?{dismissedAt:o,status:`burned`}:{dismissedAt:o}),console.log(`[threadLifecycle] Marked receipt as dismissed`,{threadId:e,isBurnedStub:a})}catch(t){console.warn(`[threadLifecycle] Failed to mark receipt as dismissed`,e,t)}try{console.log(`[threadLifecycle] Deleting join receipt for thread`,e),await Wk(e),console.log(`[threadLifecycle] Join receipt deleted successfully`,e)}catch(t){console.error(`[threadLifecycle] Failed to delete join receipt`,e,t)}let s={ctTxid:null,ctVout:null,encKeyWrap:null,rawKeyBase64:null,ctEncKeyWrapped:null,blobHash:null,hintURL:null,lastMintTxid:null,ctBroadcast:null,ctArtifacts:null,helperCache:null,dismissedAt:o};a||(s.burnTxid=null,s.burnedAt=null,s.burnedBy=null),await Promise.all([i?nA(i).catch(e=>{console.warn(`[threadLifecycle] Failed to delete guest identity`,i,e)}):Promise.resolve(),Jk(e,s).catch(t=>{console.warn(`[threadLifecycle] Failed to clear thread metadata on leave`,e,t)})]),await mA(e),n(e),console.log(`[threadLifecycle] leaveThreadAction completed`,e)}async function PN(e,t,n,r,i){if(console.log(`[burnThreadAction] Starting burn for thread:`,e),console.log(`[burnThreadAction] Receipt status:`,t?.status),!e){console.warn(`[burnThreadAction] No threadId provided`);return}if(t?.status===`burned`)return console.log(`[burnThreadAction] Thread already burned, skipping`),t;console.log(`[burnThreadAction] Loading thread metadata...`);let a=await Gk(e),o=t?.ctTxid||a?.ctTxid||null,s=Number.isInteger(t?.ctVout)?t.ctVout:Number.isInteger(a?.ctVout)?a.ctVout:null,c=Number.isInteger(s)&&s>=0?s:0;console.log(`[burnThreadAction] CT info:`,{ctTxid:o,ctVout:c,hasMetadata:!!a});let l=null;if(o){console.log(`[burnThreadAction] CT found, preparing to burn...`);let n=a?.ctArtifacts||t?.threadMetadata?.ctArtifacts||null,r=a?.ctBroadcast||t?.threadMetadata?.ctBroadcast||null;console.log(`[burnThreadAction] CT artifacts available:`,!!n),console.log(`[burnThreadAction] CT broadcast available:`,!!r),console.log(`[burnThreadAction] Calling burnThreadControlToken...`);let i=await xN({ctTxid:o,ctVout:c,artifacts:n,broadcast:r});if(l=i?.burnTxid||null,console.log(`[burnThreadAction] Burn result:`,i),console.log(`[threadLifecycle] CT burn transaction for thread ${e}:`,{ctTxid:o,ctVout:c,burnTxid:l,ctOutpoint:`${o}:${c}`,burnProof:l?`Burned in tx: ${l}`:`BURN FAILED`}),!l)throw Error(`Failed to burn Control Token on-chain. Thread not marked as burned.`)}let u=new Date().toISOString(),d=await Uk(e,{status:`burned`,burnedAt:u,burnedBy:`self`,burnTxid:l,encKeyWrap:null,rawKeyBase64:null});return d||={...t,status:`burned`,burnedAt:u,burnedBy:`self`,encKeyWrap:null,rawKeyBase64:null},await Jk(e,{burnTxid:l,burnedAt:u,burnedBy:`self`,encKeyWrap:null,rawKeyBase64:null,ctEncKeyWrapped:null}),r(t=>({...t,[e]:d})),n(t=>t.map(t=>t.id===e?sM(d):t)),i.current?.publishControl(e,{action:`burn`,actor:`self`,occurredAt:u,burnTxid:l}),o&&kN({ctTxid:o,ctVout:c}).catch(t=>{console.warn(`[threadLifecycle] Failed to delete thread backup on burn`,e,t)}),d}async function FN({threadId:e,receiptsByThread:t,setMessagesByThread:n,bumpConversationActivity:r,overlayClientRef:i,walletPublicKey:a}){if(!e||!a)return;let o=` I just linked a Bitcoin wallet! You can now send sats to help cover messaging fees.

Wallet: `+a;try{console.info(`[guestThreads] postUpgradeSatsHint sending sats hint`,{threadId:e,walletPublicKey:a}),await WM({threadId:e,author:`self`,text:o,receiptsByThread:t,setMessagesByThread:n,bumpConversationActivity:r,overlayClientRef:i})}catch(e){console.warn(`[guestThreads] failed to send upgrade sats hint message`,e)}}async function IN({threadId:e,receiptsByThread:t,setReceiptsByThread:n,applyConversationUpdate:r,overlayClientRef:i,receiptsRef:a,setMessagesByThread:o,bumpConversationActivity:s}){let c=t[e];if(!c)throw Error(`Join receipt not found`);if(c.identityKind===`holder`)return c;let l=await tN({threadId:e,receipt:c,getGuestIdentity:tA,updateJoinReceipt:Uk,deleteGuestIdentity:nA,walletBootstrap:oc}),u=await jN(e,l.receipt,n,r,i,a,{rawThreadKeyBase64:l.rawThreadKeyBase64}),d=u?{...l.receipt,ctTxid:u.ctTxid,ctVout:u.ctVout,mintedAt:u.mintedAt,lastMintTxid:u.lastMintTxid,threadMetadata:u}:l.receipt;n(t=>({...t,[e]:d})),r(t=>t.map(t=>t.id===e?sM(d):t)),l.controlPayload&&i.current?.publishControl(e,l.controlPayload);let f=l.controlPayload?.walletPublicKey||d.holderPublicKey;if(f&&o&&s){let n={...t,[e]:d};await FN({threadId:e,receiptsByThread:n,setMessagesByThread:o,bumpConversationActivity:s,overlayClientRef:i,walletPublicKey:f})}return l.receipt}JM();function LN(){let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,`0`)).join(``)}async function RN(){let e=new Uint8Array(32);return crypto.getRandomValues(e),e}function zN(e){if(typeof btoa==`function`){let t=``;return e.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t)}return typeof Buffer<`u`?Buffer.from(e).toString(`base64`):Array.from(e,e=>e.toString(16).padStart(2,`0`)).join(``)}async function BN({walletBootstrap:e,keyWrapping:t}){if(typeof e?.getStatus!=`function`)throw Error(`Wallet bootstrap unavailable`);let n=e.getStatus();if(!n?.wallet){let t=await e.initialize?.();n={...n,...t}}let r=n?.identityKey;if(!r)throw Error(`Wallet connection required to create thread`);let{wrapKeyWithECIES:i}=t?.wrapKeyWithECIES?t:await Qs(()=>import(`./keyWrapping-zVnDilXu.js`),[]),a=LN(),o=await RN(),s=zN(o),c=await i(o,r),l=new TextEncoder().encode(JSON.stringify({messages:[]})),u=await crypto.subtle.digest(`SHA-256`,l),d=Array.from(new Uint8Array(u),e=>e.toString(16).padStart(2,`0`)).join(``),f=new Date().toISOString(),p={threadId:a,identityKind:`holder`,holderPublicKey:r,guestIdentityId:null,guestPublicKey:null,wrap:c,policy:`mutual`,inviter:r,inviterName:`Self`,label:`New Thread`,initials:`NT`,status:`active`,createdAt:f,acceptedAt:f,updatedAt:f,supportsLeave:!1},m={threadId:a,policy:`mutual`,rawKeyBase64:s,blobHash:d,encKeyWrap:c,hintURL:``,createdAt:f};return await Bk(a,p),await Kk(a,m),{receipt:p,metadata:m,rawKeyBase64:s}}async function VN({threadId:e,receiptsByThread:t,overlayClientRef:n,removeThreadLocally:r}){let i=t[e];await NN(e,i,r,n)}async function HN({threadId:e,receiptsByThread:t,applyConversationUpdate:n,setReceiptsByThread:r,overlayClientRef:i}){let a=t[e];return await PN(e,a,n,r,i)}async function UN({setReceiptsByThread:e,applyConversationUpdate:t,overlayClientRef:n,receiptsRef:r}){let i=await BN({walletBootstrap:oc}),a=await jN(i.receipt.threadId,i.receipt,e,t,n,r,{rawThreadKeyBase64:i.rawKeyBase64});return a?{...i.receipt,ctTxid:a.ctTxid,ctVout:a.ctVout,mintedAt:a.mintedAt,lastMintTxid:a.lastMintTxid,threadMetadata:a,dtIssuances:a.dtIssuances||[],helperCache:a.helperCache||null,rawThreadKeyBase64:i.rawKeyBase64}:i.receipt}var WN=l(JM());function GN(e){let t=``;return e.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=/g,``)}function KN(e){return Array.from(e,e=>e.toString(16).padStart(2,`0`)).join(``)}async function qN({threadId:e,holderPublicKey:t,holderName:n=`Thread Creator`,threadKeyBase64:r,policy:i=`mutual`,keyWrapping:a,guestPrivateKeyHex:o,guestPublicKey:s,tokens:c,inviterProfile:l}){if(!e)throw Error(`threadId required`);if(!t)throw Error(`holderPublicKey required`);if(!r)throw Error(`threadKeyBase64 required for invite generation`);let{wrapKeyWithECIES:u}=a?.wrapKeyWithECIES?a:await Qs(()=>import(`./keyWrapping-zVnDilXu.js`),[]),d=o||null,f=s||null;if(!d){let e=WN.utils.randomPrivateKey();d=KN(e)}if(!f){let e=WN.getPublicKey(d,!0);f=typeof e==`string`?e:KN(e)}let p=Uint8Array.from(atob(r),e=>e.charCodeAt(0)),m=await u(p,f),h={proto:`NukeNote.Invite`,v:1,t:`invite`,threadId:e,inviter:t,inviterName:n,policy:i,wrap:m,sig:``,exp:Math.floor(Date.now()/1e3)+86400*7};h.guest={keyDerivation:{scheme:`secp256k1-direct-v1`,privateKeyHex:d},publicKey:f},c&&(c.ct||c.dtIssuance)&&(h.tokens={},c.ct&&(h.tokens.ct=c.ct),c.dtIssuance&&(h.tokens.dtIssuance=c.dtIssuance)),l&&l.displayName&&(h.meta={inviterProfile:{displayName:l.displayName,avatarHash:l.avatarHash||null}});let g={intent:`nukenote.invite`,threadId:e,inviter:t,guestPublicKey:f,policy:i,timestamp:new Date().toISOString()},_=new TextEncoder().encode(JSON.stringify(g)),v=await WN.utils.sha256(_),y=await WN.sign(v,d);h.sig=Array.from(y,e=>e.toString(16).padStart(2,`0`)).join(``),h.inviteHash=Array.from(v,e=>e.toString(16).padStart(2,`0`)).join(``);let b=JSON.stringify(h),x=new TextEncoder().encode(b),S=GN(x);return`${typeof window<`u`?window.location.origin:`http://localhost:5173`}/invite/${S}`}var JN=l(JM()),YN=e=>Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``);async function XN({threadId:e,receiptsByThread:t,receiptsRef:n,setReceiptsByThread:r,applyConversationUpdate:i,overlayClientRef:a}){let o=t[e]||n.current?.[e];if(!o)throw Error(`Thread not found`);if(o.identityKind!==`holder`)throw Error(`Only holder threads can generate invites`);let s=o.rawThreadKeyBase64||o.threadMetadata?.rawKeyBase64;if(!s)throw Error(`Thread key not available for invite generation`);let c=JN.utils.randomPrivateKey(),l=YN(c),u=JN.getPublicKey(l,!0),d=typeof u==`string`?u:YN(u),f,p=await MN(e,d,r,i,a,{rawThreadKeyBase64:s});if(!p||!p.dtIssuance)throw Error(`Failed to mint guest Data Token. Invite cannot be generated without valid DT.`);let m=Array.isArray(p.dtIssuance.outputs)?p.dtIssuance.outputs:[],h=m.find(e=>e.recipientPubkey===d)||m[0]||null;if(!h)throw Error(`Guest DT output not found in issuance. Invite cannot be generated.`);f={ct:{txid:p.ctTxid,vout:p.ctVout},dtIssuance:{txid:p.dtIssuance.txid,outputs:[{recipientPubkey:d,vout:h.vout}]}};let g=null;try{let e=await QA(o.holderPublicKey);e&&e.displayName&&(g={displayName:e.displayName,avatarHash:e.avatarHash})}catch(e){console.warn(`[guestThreads] Failed to fetch holder profile for invite`,e)}let _=await qN({threadId:e,holderPublicKey:o.holderPublicKey,holderName:o.label||`Thread Creator`,threadKeyBase64:s,policy:o.policy||`mutual`,guestPrivateKeyHex:l,guestPublicKey:d,tokens:f,inviterProfile:g});try{let t=await Uk(e,{guestPublicKey:d});t&&(r(n=>({...n,[e]:t})),i(n=>n.map(n=>n.id===e?sM(t,{blocked:n.blocked}):n)))}catch(t){console.warn(`[guestThreads] Failed to persist guestPublicKey on holder receipt`,{threadId:e,error:t})}return _}async function ZN({threadId:e,label:t,receiptsByThread:n,setReceiptsByThread:r,applyConversationUpdate:i}){if(!n[e])throw Error(`Thread not found`);let a=await Uk(e,{label:t||null});if(a){r(t=>({...t,[e]:a}));let t=sM(a);i(n=>n.map(n=>n.id===e?t:n))}return a}function QN({receiptsByThread:e,setReceiptsByThread:t,setConversations:n,setMessagesByThread:r,setBlockedInviters:i,receiptsRef:a,applyConversationUpdate:o,bumpConversationActivity:s,clearTyping:c,typingEnabledRef:l,overlayClientRef:u}){let d=(0,y.useCallback)(async(e,n={})=>{await wM({inviterId:e,metadata:n,receiptsRef:a,setBlockedInviters:i,setReceiptsByThread:t,setMessagesByThread:r,clearTyping:c,overlayClientRef:u,applyConversationUpdate:o})},[o,c,u,a,i,r,t]),f=(0,y.useCallback)(async(t,{author:n,text:i})=>WM({threadId:t,author:n,text:i,receiptsByThread:e,setMessagesByThread:r,bumpConversationActivity:s,overlayClientRef:u}),[s,u,e,r]),p=(0,y.useCallback)(t=>KM({threadId:t,receiptsByThread:e,typingEnabledRef:l,overlayClientRef:u}),[u,e,l]),m=(0,y.useCallback)(e=>{qM({threadId:e,setReceiptsByThread:t,applyConversationUpdate:o,setMessagesByThread:r,clearTyping:c})},[o,c,r,t]),h=(0,y.useCallback)(async n=>IN({threadId:n,receiptsByThread:e,setReceiptsByThread:t,applyConversationUpdate:o,overlayClientRef:u,receiptsRef:a,setMessagesByThread:r,bumpConversationActivity:s}),[o,s,u,e,a,r,t]),g=(0,y.useCallback)(async t=>{await VN({threadId:t,receiptsByThread:e,overlayClientRef:u,removeThreadLocally:m})},[u,e,m]),_=(0,y.useCallback)(async n=>HN({threadId:n,receiptsByThread:e,applyConversationUpdate:o,setReceiptsByThread:t,overlayClientRef:u}),[o,u,e,t]),v=(0,y.useCallback)(async()=>UN({setReceiptsByThread:t,applyConversationUpdate:o,overlayClientRef:u,receiptsRef:a}),[o,u,a,t]),b=(0,y.useCallback)(async n=>XN({threadId:n,receiptsByThread:e,receiptsRef:a,setReceiptsByThread:t,applyConversationUpdate:o,overlayClientRef:u}),[o,u,e,a,t]),x=(0,y.useCallback)(async(n,r)=>ZN({threadId:n,label:r,receiptsByThread:e,setReceiptsByThread:t,applyConversationUpdate:o}),[o,e,t]);return{blockInviter:d,sendMessage:f,notifyTyping:p,removeThreadLocally:m,upgradeThreadToHolder:h,leaveThread:g,burnThread:_,createNewThread:v,generateThreadInvite:b,updateThreadLabel:x}}var $N=e=>{if(!e)return-1/0;let t=new Date(e).getTime();return Number.isNaN(t)?-1/0:t};const eP=e=>{if(!e)return``;let t=new Date(e);return Number.isNaN(t.getTime())?``:t.toLocaleTimeString([],{hour:`2-digit`,minute:`2-digit`})},tP=e=>Array.isArray(e)?[...e].sort((e,t)=>{let n=$N(e?.lastActivityIso||e?.lastActivity),r=$N(t?.lastActivityIso||t?.lastActivity);return n===r?(t?.title||``).localeCompare(e?.title||``):r-n}):[],nP=e=>{if(e==null)return null;let t=Number(e);return Number.isFinite(t)&&t>=0?t:null},rP=e=>{if(!e)return 0;let t=Date.parse(e);return Number.isNaN(t)?0:t};function iP(e,t,n){e[t]||(e[t]=[]);let r=e[t],i=r.findIndex(e=>e.id===n.id);return i>=0?r[i]=n:r.push(n),r}async function aP({metadataByThread:e,vaultEntriesByThread:t,messageRevisionByThread:n,applyHydratedState:r,getReceipt:i,setMessagesByThread:a,bumpConversationActivity:o,setRemoteApiAvailable:s}){if(!Wj())return;let c=await Fk();if(!c)return;let l;try{l=await c.listThreads(),s&&s(!0)}catch(e){console.warn(`[guestThreads] remote metadata sync failed`,e);let t=e?.message?.includes(`404`)||e?.status===404;s&&s(t?!1:null),Jj({component:`remoteSync`,type:`list-threads-failed`,error:e?.message||String(e)});return}let u=Array.isArray(l?.threads)?l.threads:[];if(!u.length)return;Jj({component:`remoteSync`,type:`list-threads-success`,threads:u.length});let d={...e},f=!1;await Promise.all(u.map(async t=>{let n=t?.threadId;if(!n)return;let r=nP(t.metadataRevision??t.revision??t.remoteRevision),i=d[n],a=nP(i?.remoteRevision??i?.revision);if(!(r!==null&&a!==null&&r<=a))try{let t=await c.fetchMetadata(n,{revisionSince:a??void 0});if(!t||typeof t!=`object`)return;let o={...i||{},...t,threadId:n},s=nP(t.revision??t.remoteRevision)??r;s!==null&&(o.remoteRevision=s),d[n]=o,e[n]=o,f=!0,Jj({component:`remoteSync`,type:`metadata-updated`,threadId:n,revision:o.remoteRevision??null})}catch(e){console.warn(`[guestThreads] failed to fetch remote metadata for thread`,n,e),Jj({component:`remoteSync`,type:`metadata-failed`,threadId:n,error:e?.message||String(e)})}})),f&&r(d),await Promise.all(u.map(async e=>{let r=e?.threadId;if(!r)return;let s=nP(e.messageRevision??e.messagesRevision??e.remoteMessageRevision);if(s===null)return;let l=nP(n[r]);if(l!==null&&s<=l)return;let u=i(r);if(!u)return;let d;try{d=await c.fetchMessages(r,{sinceRevision:l??void 0})}catch(e){console.warn(`[guestThreads] remote message sync failed`,r,e),Jj({component:`remoteSync`,type:`messages-failed`,threadId:r,error:e?.message||String(e)});return}let f=Array.isArray(d?.messages)?d.messages:[];if(!f.length)return;let p=null,m=!1;for(let e of f){let i=e?.messageId;if(!i||!e.ciphertext)continue;let a=nP(e.revision??e.remoteRevision);if(!(a!==null&&l!==null&&a<=l))try{let o=await fA(r,{id:i,ciphertext:e.ciphertext,author:e.author??null,delivery:e.delivery??`delivered`,timestamp:e.timestamp??e.createdAt??null,helperCache:e.helperCache??null,remoteRevision:a??s},{skipRemoteSync:!0});if(!o)continue;iP(t,r,o),a!==null&&(n[r]=n[r]===void 0?a:Math.max(n[r],a));let c=o.timestamp||o.createdAt||null;c&&(!p||rP(c)>rP(p))&&(p=c),m=!0,Jj({component:`remoteSync`,type:`message-updated`,threadId:r,messageId:i,revision:a??s??null})}catch(e){console.warn(`[guestThreads] failed to persist remote message`,r,i,e),Jj({component:`remoteSync`,type:`message-persist-failed`,threadId:r,messageId:i,error:e?.message||String(e)})}}if(!m)return;let h=(t[r]||[]).slice().sort((e,t)=>rP(e.timestamp||e.createdAt)-rP(t.timestamp||t.createdAt));t[r]=h;let g=h.map(e=>cM(e,u));a(e=>({...e,[r]:g})),p&&o(r,p)}))}async function oP({receiptMap:e,vaultEntriesByThread:t,setMessagesByThread:n,bumpConversationActivity:r}){!e||!t||await Promise.all(Object.entries(e).map(async([e,t])=>{let i=t?.helperCache;if(i?.cacheId&&!(t?.status===`burned`||t?.burnedAt))try{let a=await UM(i.cacheId,{logger:console});if(!a||typeof a!=`object`)return;let o=new Date().toISOString(),s=Array.isArray(a.messages)?a.messages:[],c=typeof a.text==`string`||typeof a.ciphertext==`string`||a.delivery||a.id,l=s.length>0?s:c?[a]:[];if(l.length===0)return;let u=l.filter(e=>e&&typeof e==`object`).sort((e,t)=>{let n=e.timestamp||o,r=t.timestamp||o;return n.localeCompare(r)}),d=null,f=[];for(let n of u){if(!(typeof n.text==`string`||typeof n.ciphertext==`string`||n.delivery||n.id))continue;if(n.id&&await OA.getItem(n.id)){console.log(`[guestThreads] skipping already-imported message`,n.id);continue}let r=n.timestamp||o,s=await fA(e,{id:n.id,author:Nj(n.author,t)||`peer`,text:n.text??null,ciphertext:n.ciphertext??null,delivery:n.delivery||`delivered`,timestamp:r,helperCache:{...n.helperCache||a.helperCache||null,cacheId:i.cacheId,importedAt:o}},{skipRemoteSync:!0});(!d||s.timestamp&&s.timestamp>d)&&(d=s.timestamp),f.push(cM(s,t))}f.length>0&&n(t=>{let n=t[e]||[],r=new Set(n.map(e=>e.id).filter(Boolean)),i=f.filter(e=>!r.has(e.id));return i.length===0?t:{...t,[e]:[...n,...i]}}),d&&typeof r==`function`&&r(e,d);try{await RM(i.cacheId)}catch(t){console.warn(`[guestThreads] failed to delete helper cache entry`,{threadId:e,cacheId:i.cacheId,error:t?.message||String(t)})}}catch(t){console.warn(`[guestThreads] offline helper cache fetch failed`,{threadId:e,cacheId:i.cacheId,error:t?.message||String(t)})}}))}function sP({setReceiptsByThread:e,setConversations:t,setMessagesByThread:n,setBlockedInviters:r,setLoading:i,loadInFlightRef:a,applyConversationUpdate:o,bumpConversationActivity:s,setRemoteApiAvailable:c}){return{load:(0,y.useCallback)(async(o={})=>{let{background:l=!1}=o;a.current+=1,l||i(!0);try{let[i,a,o,l]=await Promise.all([Hk(),dA(),_A(),qk()]),u=new Set(o.map(e=>e.id)),d=l.reduce((e,t)=>(t?.threadId&&(e[t.threadId]=t),e),{}),f=i.filter(e=>{let t=e?.inviter;if(t&&u.has(t))return!1;let n=d[e?.threadId],r=e?.dismissedAt||n?.dismissedAt;return(e?.status===`burned`||e?.burnedAt||e?.burnedBy||n?.burnedAt||n?.burnedBy)&&r?(console.log(`[loadState] Filtering out burned+dismissed thread`,e?.threadId),!1):r&&e?.status!==`active`?(console.log(`[loadState] Filtering out dismissed thread`,e?.threadId,e?.status),!1):!0}),p=l.reduce((e,t)=>(t?.threadId&&(e[t.threadId]=t),e),{});BM()&&await Promise.all(Object.entries(p).map(async([e,t])=>{let n=t?.helperCache;if(!n?.cacheId||t?.burnedAt||t?.burnedBy||n.lastFetchSucceeded===!1&&n.lastFetchAt)return;let r=!!t?.encKeyWrap,i=!!t?.blobHash;if(r&&i)return;let a=new Date().toISOString(),o=t;try{let e=await UM(n.cacheId,{logger:console});o=e&&typeof e==`object`?{...t,encKeyWrap:t.encKeyWrap||e.encKeyWrap||null,blobHash:t.blobHash||e.blobHash||null,hintURL:t.hintURL||e.hintURL||t.hintURL||``,policy:t.policy||e.policy||t.policy||`mutual`,helperCache:{...n,cacheId:n.cacheId,enrolled:n.enrolled!==!1,lastFetchAt:a,lastFetchSucceeded:!0}}:{...t,helperCache:{...n,cacheId:n.cacheId,enrolled:n.enrolled!==!1,lastFetchAt:a,lastFetchSucceeded:!1}}}catch(r){console.warn(`[guestThreads] helper cache fetch failed`,{threadId:e,cacheId:n.cacheId,error:r?.message||String(r)}),o={...t,helperCache:{...n,cacheId:n.cacheId,enrolled:n.enrolled!==!1,lastFetchAt:a,lastFetchSucceeded:!1}}}if(p[e]=o,o!==t)try{await Jk(e,o)}catch(t){console.warn(`[guestThreads] failed to persist helper cache metadata`,e,t)}}));let m=a.reduce((e,t)=>t?.threadId?(e[t.threadId]||(e[t.threadId]=[]),e[t.threadId].push(t),e):e,{}),h=Object.entries(m).reduce((e,[t,n])=>(n.forEach(n=>{let r=nP(n?.remoteRevision??n?.revision);r!==null&&(e[t]=e[t]===void 0?r:Math.max(e[t],r))}),e),{}),g={},_=i=>{let a=f.map(e=>{let t=i[e.threadId];if(!t)return e;let n=Number.isInteger(t.ctVout)?t.ctVout:void 0;return{...e,threadMetadata:t,ctTxid:t.ctTxid??e.ctTxid??null,ctVout:Number.isInteger(e.ctVout)&&e.ctVout>=0?e.ctVout:n??null,encKeyWrap:t.encKeyWrap??e.encKeyWrap??null,blobHash:t.blobHash??e.blobHash??null,hintURL:t.hintURL??e.hintURL??null,mintedAt:t.mintedAt??e.mintedAt??null,lastMintTxid:t.lastMintTxid??e.lastMintTxid??null,ctBroadcast:t.ctBroadcast??e.ctBroadcast??null,ctArtifacts:t.ctArtifacts??e.ctArtifacts??null,burnTxid:t.burnTxid??e.burnTxid??null,burnedAt:t.burnedAt??e.burnedAt??null,burnedBy:t.burnedBy??e.burnedBy??null,rawThreadKeyBase64:t.rawKeyBase64??e.rawThreadKeyBase64??null,dtIssuances:Array.isArray(t.dtIssuances)?t.dtIssuances:Array.isArray(e.dtIssuances)?e.dtIssuances:[],helperCache:t.helperCache??e.helperCache??null}}),s=a.reduce((e,t)=>(e[t.threadId]=t,e),{});g=s;let c={};Object.entries(m).forEach(([e,t])=>{let n=s[e];c[e]=t.slice().sort((e,t)=>rP(e.timestamp||e.createdAt)-rP(t.timestamp||t.createdAt)).map(e=>cM(e,n))});let l=tP(a.map(e=>sM(e,{blocked:u.has(e?.inviter),messages:c[e.threadId]||[]})));e(s),t(l),n(c),r(o)};_(p),BM()&&await oP({receiptMap:g,vaultEntriesByThread:m,setMessagesByThread:n,bumpConversationActivity:s}),aP({metadataByThread:p,vaultEntriesByThread:m,messageRevisionByThread:h,applyHydratedState:_,getReceipt:e=>g[e],setMessagesByThread:n,bumpConversationActivity:s,setRemoteApiAvailable:c}).catch(e=>{console.warn(`[guestThreads] remote sync failed`,e)})}finally{a.current=Math.max(0,a.current-1),l||i(!1)}},[o,s,a,r,t,i,n,e,c])}}function cP({remoteAllowed:e,load:t}){let n=(0,y.useRef)(null),r=(0,y.useRef)(6e4),i=(0,y.useRef)(!1),a=(0,y.useRef)(t);return(0,y.useEffect)(()=>{a.current=t},[t]),(0,y.useEffect)(()=>{let t=6e4,o=()=>{n.current&&=(clearTimeout(n.current),null)};if(!e||!Ks.REMOTE_MESSAGING_ENABLED||!Ks.REMOTE_MESSAGING_API_URL){o(),r.current=t;return}let s=!1;r.current=t;let c=e=>{s||(o(),n.current=setTimeout(()=>{n.current=null,l()},e))},l=async()=>{if(!s){if(i.current){c(r.current);return}i.current=!0;try{await a.current({background:!0}),r.current=t}catch(e){console.warn(`[guestThreads] background remote sync failed`,e),r.current=Math.min(r.current*2,3e5)}finally{i.current=!1,s||c(r.current)}}};return c(3e4),()=>{s=!0,o()}},[e]),{}}function lP({blockedInviters:e,load:t}){let n=(0,y.useCallback)(async e=>{e&&(await yA(e),await t())},[t]),r=(0,y.useCallback)(t=>e.some(e=>e.id===t),[e]);return{unblockInviter:n,isInviterBlocked:r}}var uP=`nukenote:typing-indicator-preferences`,dP=`__default__`,fP=typeof window<`u`;function pP(){if(!fP||!window?.localStorage)return{};try{let e=window.localStorage.getItem(uP);if(!e)return{};let t=JSON.parse(e);return t&&typeof t==`object`?t:{}}catch(e){return console.warn(`[guestThreads] failed to read typing preference map`,e),{}}}function mP(e){if(!(!fP||!window?.localStorage))try{window.localStorage.setItem(uP,JSON.stringify(e))}catch(e){console.warn(`[guestThreads] failed to persist typing preference map`,e)}}function hP(e){return e&&e.trim()!==``?e:dP}function gP(){let e=(0,y.useRef)(pP()),t=(0,y.useRef)(null),n=(0,y.useCallback)(t=>{let n=e.current,r=hP(t);if(Object.prototype.hasOwnProperty.call(n,r)){let e=n[r];return typeof e==`boolean`?e:null}return null},[]),[r,i]=(0,y.useState)(()=>{let t=e.current[dP];return typeof t==`boolean`?t:!0}),a=(0,y.useRef)(r),o=(0,y.useCallback)((t,n)=>{let r={...e.current};r[hP(t)]=!!n,e.current=r,mP(r)},[]),s=(0,y.useCallback)(e=>{i(n=>{let r=!!(typeof e==`function`?e(n):e);return a.current=r,o(t.current,r),r})},[o]),c=(0,y.useCallback)(r=>{let o=r||null;if(t.current===o)return;let s=pP();if(e.current=s,console.info(`[typingPreference] setTypingIdentityKey`,{incomingIdentity:r,normalizedKey:o,activeIdentity:t.current,storedKeys:Object.keys(s)}),o){let t=hP(o);if(!Object.prototype.hasOwnProperty.call(s,t)){let n=s[dP];if(console.info(`[typingPreference] migrating default`,{defaultValue:n}),typeof n==`boolean`){let r={...s,[t]:n};delete r[dP],e.current=r,mP(r),console.info(`[typingPreference] migration complete`,{migratedKey:t,mapKeys:Object.keys(r)})}}}t.current=o;let c=n(o||null),l=c??!0;console.info(`[typingPreference] resolved preference`,{normalizedKey:o,stored:c,nextValue:l}),a.current=l,i(l)},[n]);return{typingIndicatorEnabled:r,setTypingIndicatorEnabled:s,typingEnabledRef:a,setTypingIdentityKey:c}}function _P(e){let[t,n]=(0,y.useState)({}),[r,i]=(0,y.useState)([]),[a,o]=(0,y.useState)({}),[s,c]=(0,y.useState)({}),[l,u]=(0,y.useState)([]),[d,f]=(0,y.useState)(!0),[p,m]=(0,y.useState)(()=>Wj()),h=(0,y.useRef)({}),g=(0,y.useRef)({}),_=(0,y.useRef)(0),v=(0,y.useCallback)(e=>i(t=>{let n=e(t);return n===t?t:tP(n)}),[]),b=(0,y.useCallback)((e,n)=>{if(!e)return;let r=n||new Date().toISOString();v(n=>{let i=!1,o=n.map(n=>{if(n.id!==e)return n;i=!0;let o=a[e]||[],s=t[e],c=n.preview;if(o.length>0&&s){let e=o[o.length-1],t=e.text||`No messages yet`,n=s.guestPublicKey||s.holderPublicKey;c=e.author===n||e.author===`self`?`You: ${t}`:t}return{...n,lastActivityIso:r,lastActivity:eP(r),preview:c}});return i?o:n})},[v,a,t]),x=(0,y.useCallback)(e=>{if(!e)return;c(t=>{if(!t[e])return t;let n={...t};return delete n[e],n});let t=g.current[e];t&&(clearTimeout(t),delete g.current[e])},[]),{load:S}=sP({setReceiptsByThread:n,setConversations:i,setMessagesByThread:o,setBlockedInviters:u,setLoading:f,loadInFlightRef:_,applyConversationUpdate:v,bumpConversationActivity:b,setRemoteApiAvailable:e}),{unblockInviter:C,isInviterBlocked:w}=lP({blockedInviters:l,load:S});(0,y.useEffect)(()=>{h.current=t},[t]);let T=(0,y.useCallback)(()=>S(),[S]),E=(0,y.useMemo)(()=>new Map(r.map(e=>[e.id,e])),[r]);return(0,y.useEffect)(()=>{let e=Kj(e=>{m(e.effective)});return()=>{try{e?.()}catch(e){console.warn(`[guestThreads] failed to unsubscribe remote preference in state`,e)}}},[]),cP({remoteAllowed:p,load:S}),{receiptsByThread:t,setReceiptsByThread:n,conversations:r,setConversations:i,messagesByThread:a,setMessagesByThread:o,typingByThread:s,setTypingByThread:c,blockedInviters:l,setBlockedInviters:u,loading:d,setLoading:f,receiptsRef:h,typingTimersRef:g,applyConversationUpdate:v,bumpConversationActivity:b,clearTyping:x,load:S,refresh:T,conversationMap:E,unblockInviter:C,isInviterBlocked:w}}var vP=`nukenote:send-on-enter`,yP=typeof window<`u`;function bP(){if(!yP||!window?.localStorage)return null;try{let e=window.localStorage.getItem(vP);return e===null||e===``?null:e===`true`}catch(e){return console.warn(`[sendPreference] failed to read send-on-enter preference`,e),null}}function xP(e){if(!(!yP||!window?.localStorage))try{e===null?window.localStorage.removeItem(vP):window.localStorage.setItem(vP,e?`true`:`false`)}catch(e){console.warn(`[sendPreference] failed to persist send-on-enter preference`,e)}}function SP(){let[e,t]=(0,y.useState)(()=>bP()??!1),n=(0,y.useCallback)(e=>{t(t=>{let n=!!(typeof e==`function`?e(t):e);return xP(n),n})},[]);return{sendOnEnter:e,setSendOnEnter:n}}function CP(){let[e,t]=(0,y.useState)(null),{receiptsByThread:n,setReceiptsByThread:r,conversations:i,setConversations:a,messagesByThread:o,setMessagesByThread:s,typingByThread:c,setTypingByThread:l,blockedInviters:u,setBlockedInviters:d,loading:f,receiptsRef:p,typingTimersRef:m,applyConversationUpdate:h,bumpConversationActivity:g,clearTyping:_,load:v,refresh:b,conversationMap:x,unblockInviter:S,isInviterBlocked:C}=_P(t),{typingIndicatorEnabled:w,setTypingIndicatorEnabled:T,typingEnabledRef:E,setTypingIdentityKey:D}=gP(),{sendOnEnter:O,setSendOnEnter:k}=SP(),[A,ee]=(0,y.useState)(()=>Uj()),{client:te,status:ne,clientRef:j}=oM();(0,y.useEffect)(()=>{let e=Kj(e=>{ee(e)});return()=>{try{e?.()}catch(e){console.warn(`[useGuestThreads] failed to unsubscribe remote preference`,e)}}},[]),(0,y.useMemo)(()=>{let e=Object.values(n);return e.length>0&&e.every(e=>e?.identityKind===`holder`)},[n]);let M=(0,y.useMemo)(()=>Object.keys(n).sort().join(`|`),[n]),re=(0,y.useMemo)(()=>A.configEnabled?e===!1?`Multi-device sync unavailable (API not deployed)`:A.effective?e===!0?`Multi-device sync active`:`Multi-device sync checking...`:`Multi-device sync paused`:`Multi-device sync not configured`,[A,e]),ie=(0,y.useCallback)(e=>{Gj(e)},[]),ae=(0,y.useRef)(v);(0,y.useEffect)(()=>{ae.current=v},[v]),(0,y.useEffect)(()=>{ae.current()},[]),(0,y.useEffect)(()=>{let e=Object.values(n),t=null;for(let n of e){let e=Aj(n);if(e){t=e;break}}if(!t){let e=oc.getStatus?.();e?.identityKey&&(t=e.identityKey)}D(t)},[n,D]);let{blockInviter:oe,sendMessage:se,notifyTyping:ce,removeThreadLocally:le,upgradeThreadToHolder:ue,leaveThread:de,burnThread:fe,createNewThread:pe,generateThreadInvite:me,updateThreadLabel:he}=QN({receiptsByThread:n,setReceiptsByThread:r,setConversations:a,setMessagesByThread:s,setBlockedInviters:d,receiptsRef:p,applyConversationUpdate:h,bumpConversationActivity:g,clearTyping:_,typingEnabledRef:E,overlayClientRef:j}),{ensureThreadSubscribed:ge}=CM({client:te,threadIdsKey:M,receiptsByThread:n,receiptsRef:p,typingTimersRef:m,setMessagesByThread:s,setTypingByThread:l,setReceiptsByThread:r,setConversations:a,clearTyping:_,removeThreadLocally:le,bumpConversationActivity:g,overlayClientRef:j,typingEnabledRef:E,overlayStatus:ne});return{loading:f,conversations:i,messagesByThread:o,typingByThread:c,blockedInviters:u,getConversation:e=>x.get(e)||null,refresh:b,overlayStatus:ne,ensureThreadSubscribed:ge,blockInviter:oe,unblockInviter:S,isInviterBlocked:C,sendMessage:se,notifyTyping:ce,upgradeThreadToHolder:ue,leaveThread:de,burnThread:fe,createNewThread:pe,generateThreadInvite:me,updateThreadLabel:he,typingIndicatorEnabled:w,setTypingIndicatorEnabled:T,sendOnEnter:O,setSendOnEnter:k,remoteSyncPreference:A,remoteSyncStatus:re,setRemoteSyncEnabled:ie}}function wP(e){let{getConversation:t,updateThreadLabel:n}=CP(),[r,i]=(0,y.useState)(null),[a,o]=(0,y.useState)(!0);(0,y.useEffect)(()=>{if(!e){o(!1);return}let n=t(e)?.title||null,r=n?.startsWith(`Thread `)||n===`New Thread`;i(r?null:n),o(!1)},[e,t]);let s=(0,y.useCallback)(async t=>{if(!e)throw Error(`threadId is required`);try{await n(e,t),i(t||null),console.log(`[useThreadLabel] Updated label:`,{threadId:e,newLabel:t})}catch(e){throw console.error(`[useThreadLabel] Failed to set label:`,e),e}},[e,n]);return{label:r,setLabel:s,loading:a}}function TP({verified:e}){return e?(0,Z.jsx)(yk,{children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)(`span`,{className:`inline-flex h-5 w-5 items-center justify-center rounded-full bg-emerald-500/90 text-white`,children:(0,Z.jsx)(`svg`,{className:`h-4 w-4`,fill:`currentColor`,viewBox:`0 0 20 20`,children:(0,Z.jsx)(`path`,{fillRule:`evenodd`,d:`M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z`,clipRule:`evenodd`})})})}),(0,Z.jsx)(Sk,{children:`Verified`})]})}):null}var EP=(0,y.createContext)({theme:`light`,toggle:()=>{},setTheme:()=>{},textScale:`md`,setTextScale:()=>{}});function DP({children:e}){let[t,n]=(0,y.useState)(`dark`),[r,i]=(0,y.useState)(`md`);(0,y.useEffect)(()=>{try{let e=localStorage.getItem(`nukenote.theme`),t=`dark`;e===`dark`||e===`light`||e===`system`?t=e:typeof window<`u`&&window.matchMedia&&(t=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`),n(t)}catch(e){console.warn(`Failed to read stored theme preference`,e)}},[]),(0,y.useEffect)(()=>{try{let e=localStorage.getItem(`nukenote.textScale`);(e===`sm`||e===`md`||e===`lg`)&&i(e)}catch(e){console.warn(`Failed to read stored text scale preference`,e)}},[]),(0,y.useEffect)(()=>{try{let e=document.documentElement,n=t;t===`system`&&typeof window<`u`&&window.matchMedia&&(n=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`),n===`dark`?e.classList.add(`dark`):e.classList.remove(`dark`),localStorage.setItem(`nukenote.theme`,t)}catch(e){console.warn(`Failed to persist theme preference`,e)}},[t]),(0,y.useEffect)(()=>{try{localStorage.setItem(`nukenote.textScale`,r)}catch(e){console.warn(`Failed to persist text scale preference`,e)}},[r]);let a=(0,y.useMemo)(()=>({theme:t,setTheme:n,toggle:()=>n(e=>e===`dark`?`light`:`dark`),textScale:r,setTextScale:i}),[t,r]);return(0,Z.jsx)(EP.Provider,{value:a,children:e})}function OP(){return(0,y.useContext)(EP)}function kP({conversation:e,isActive:t,onOpen:n}){let{id:r,title:i,preview:a,lastActivity:o,status:s,ctOutpoint:c,unreadCount:l,peerPublicKey:u,peerKind:d,guestMode:f}=e,{identity:p,loading:m}=kj(u,d||`guest`),{label:h}=wP(r),{textScale:g=`md`}=OP(),_=g===`sm`?`text-sm`:g===`lg`?`text-base`:`text-sm`,v=g===`sm`?`text-[11px]`:g===`lg`?`text-sm`:`text-xs`,y=p?.name||`Guest ${u?.slice(0,8)||`Unknown`}`,b=p?.colorSeed??(u?mj(u):0),x=p?.avatar||null,S=Number(l)>0,C=null;return s===`pending`?C=(0,Z.jsx)(HA,{variant:`outline`,children:`Invite`}):s===`muted`?C=(0,Z.jsx)(HA,{variant:`secondary`,children:`Muted`}):s===`burned`?C=(0,Z.jsx)(HA,{variant:`destructive`,children:`Burned`}):s===`left`?C=(0,Z.jsx)(HA,{variant:`secondary`,children:`Left`}):s===`blocked`&&(C=(0,Z.jsx)(HA,{variant:`destructive`,children:`Blocked`})),(0,Z.jsx)(FA,{className:Q(`overflow-hidden transition-colors`,t?`border-primary bg-primary/5 shadow-sm`:`border-border hover:border-primary/40`,s===`pending`&&`border-dashed border-primary/60`,s===`muted`&&`opacity-80`),children:(0,Z.jsxs)(`button`,{type:`button`,className:`flex w-full items-center justify-between gap-4 py-4 text-left`,onClick:()=>n?.(e),children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-3 px-4`,children:[(0,Z.jsx)(lj,{name:y||i,colorSeed:b,avatarHash:x,pubkey:u,size:40}),(0,Z.jsxs)(`div`,{className:`space-y-1`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(`span`,{className:Q(`leading-none`,_,S?`font-semibold`:`font-medium`),children:y}),C,(0,Z.jsx)(TP,{verified:p?.verified})]}),(0,Z.jsx)(`p`,{className:Q(`text-muted-foreground line-clamp-1`,v),children:m?`Resolving identity`:a})]})]}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-3 pr-4`,children:[(0,Z.jsx)(`div`,{className:`text-right text-xs text-muted-foreground`,children:(0,Z.jsx)(`div`,{children:o})}),(0,Z.jsx)(`div`,{className:`flex items-center gap-2`,children:Number(l)>0&&(0,Z.jsx)(HA,{variant:`secondary`,className:`h-6 w-6 items-center justify-center rounded-full p-0 text-[11px]`,children:l})})]})]})})}function AP({conversations:e=[],activeId:t,onOpenConversation:n}){return e.length?(0,Z.jsx)(`div`,{className:`space-y-3`,children:e.map(e=>(0,Z.jsx)(kP,{conversation:e,isActive:e.id===t,onOpen:n},`${e.id}-${e.status||`normal`}`))}):(0,Z.jsx)(`div`,{className:`rounded-md border border-dashed border-muted-foreground/40 bg-muted/10 p-6 text-sm text-muted-foreground`,children:`No messages yet. Invitations and active sessions will appear once overlay helpers connect to your wallet identity.`})}function jP({conversations:e=[],activeId:t,onSelectConversation:n,onNewThread:r,searchValue:i,onSearchChange:a}){let{railCollapsed:o}=(0,y.useContext)(Vb);return(0,Z.jsxs)(`aside`,{className:Q(`flex h-full max-h-full w-full flex-col border-border bg-muted/10 transition-all duration-300`,`md:w-[320px] md:min-w-[320px] md:border-r`),children:[(0,Z.jsxs)(`div`,{className:Q(`flex items-center justify-between gap-3 py-4 transition-all duration-300`,o?`pl-16 pr-4`:`px-4`),children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold leading-tight`,children:`Threads`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Encrypted 1:1 threads`})]}),(0,Z.jsx)($,{size:`icon`,variant:`default`,onClick:r,"aria-label":`Start new chat`,className:`h-12 w-12 rounded-full shadow-md`,children:(0,Z.jsx)(Mb,{className:`h-7 w-7`})})]}),(0,Z.jsx)(`div`,{className:`px-4 py-3`,children:(0,Z.jsx)(GA,{value:i,onChange:e=>a?.(e.target.value),placeholder:`Search threads`,className:`h-9 bg-background/60`})}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-y-auto px-2 py-3`,children:(0,Z.jsx)(AP,{conversations:e,activeId:t,onOpenConversation:n})})]})}function MP({thread:e,identity:t,identityLoading:n=!1,onShowDetails:r,onAction:i,onUpgrade:a,onOpenContact:o}){if(!e)return(0,Z.jsx)(`div`,{className:`flex items-center justify-between border-b border-muted-foreground/20 bg-background/80 px-4 py-3`,children:(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h2`,{className:`text-base font-semibold`,children:`No thread selected`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Pick a conversation from the sidebar or create a new invite.`})]})});let{status:s,guestMode:c,blocked:l,lastActivity:u,inviter:d,ctTxid:f,dtRecipientCount:p,dtRecipients:m,peerPublicKey:h,peerKind:g,helperCache:_}=e,v=!!f,y=s===`burned`,b=Number(p)||(Array.isArray(m)?m.length:0);Array.isArray(m)&&m.length>0&&m[0];let x=t?.name||`Guest ${h?.slice(0,8)||`Unknown`}`;h&&Bx(h,20);let S=t?.colorSeed??(h?mj(h):0),C=t?.avatar||null;t?.source;let w=null;s===`pending`?w=(0,Z.jsx)(HA,{variant:`outline`,children:`Pending`}):s===`left`?w=(0,Z.jsx)(HA,{variant:`secondary`,children:`Left`}):l?w=(0,Z.jsx)(HA,{variant:`destructive`,children:`Blocked`}):y&&(w=(0,Z.jsx)(HA,{variant:`destructive`,children:`Burned`}));let T=null;v&&!y?T=(0,Z.jsx)(HA,{variant:`outline`,children:b>0?`Access active`:`Access token ready`}):v&&y&&(T=(0,Z.jsx)(HA,{variant:`destructive`,children:`Access revoked`}));let E=e?.inviter&&e.inviter===e.selfPublicKey,D=e?.mintedAt&&!e?.upgradedAt&&!y&&(e?.policy!==`initiator`||E),O=c||!D?`leave`:`burn`,k=O===`burn`?`Burn Thread`:`Leave Thread`,A=O===`burn`?_b:Sb,ee=()=>{if(O===`burn`)try{if(typeof window<`u`&&!window.confirm(`Burn this conversation?

This will permanently destroy access for everyone and erase the conversation data tied to this on-chain access token. This cannot be undone.`))return}catch{}else if(O===`leave`)try{if(typeof window<`u`&&!window.confirm(`Leave this conversation?

This will delete all local copies of messages for this conversation on this device. You can only rejoin if you receive a new invite.`))return}catch{}i?.(O)};return(0,Z.jsx)(`div`,{className:`border-b border-muted-foreground/20 bg-background/80 px-4 py-3`,children:(0,Z.jsx)(`div`,{className:`flex flex-col gap-2`,children:(0,Z.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Z.jsx)(lj,{name:x,colorSeed:S,avatarHash:C,pubkey:h,size:40}),(0,Z.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,Z.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,Z.jsx)(`span`,{className:`font-semibold`,children:x}),(0,Z.jsx)(TP,{verified:t?.verified}),u&&(0,Z.jsxs)(`span`,{className:`text-xs text-muted-foreground ml-2`,children:[`Last activity: `,u]})]}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-xs`,children:[w,T]})]})]}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,Z.jsx)(yk,{children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)($,{size:`icon`,variant:`ghost`,onClick:o,"aria-label":`Contact details`,className:`h-9 w-9`,children:(0,Z.jsx)(Pb,{className:`h-5 w-5`})})}),(0,Z.jsx)(Sk,{children:`Contact details & verification`})]})}),(0,Z.jsx)(yk,{children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)($,{size:`icon`,variant:`ghost`,onClick:r,"aria-label":`Thread info`,className:`h-9 w-9`,children:(0,Z.jsx)(yb,{className:`h-5 w-5`})})}),(0,Z.jsx)(Sk,{children:`Thread details`})]})}),c&&typeof a==`function`&&(0,Z.jsx)(yk,{children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:a,"aria-label":`Upgrade this thread with your wallet`,className:`hidden sm:inline-flex text-xs font-medium`,children:(0,Z.jsx)(`span`,{children:`Upgrade`})})}),(0,Z.jsx)(Sk,{children:`Link your wallet to this thread`})]})}),(0,Z.jsx)(yk,{children:(0,Z.jsxs)(bk,{children:[(0,Z.jsx)(xk,{asChild:!0,children:(0,Z.jsx)($,{size:`icon`,variant:`ghost`,onClick:ee,"aria-label":k,className:`h-9 w-9 text-destructive hover:text-destructive`,children:(0,Z.jsx)(A,{className:`h-5 w-5`})})}),(0,Z.jsx)(Sk,{children:k})]})})]})]})})})}var NP=[{value:1e4,label:`10K`,description:`Small tip`},{value:5e4,label:`50K`,description:`Nice gesture`},{value:1e5,label:`100K`,description:`Generous!`}];function PP({peerName:e=`This contact`,onSendSats:t,onDismiss:n,isSending:r=!1}){let[i,a]=(0,y.useState)(!1),[o,s]=(0,y.useState)(``),c=e=>{t?.(e)},l=()=>{let e=Number(o);Number.isFinite(e)&&e>0&&(t?.(e),s(``),a(!1))};return(0,Z.jsxs)(`div`,{className:`relative mx-auto my-4 max-w-md rounded-xl border-2 border-primary/20 bg-gradient-to-br from-primary/5 via-background to-primary/5 p-6 shadow-lg`,children:[n&&(0,Z.jsx)(`button`,{onClick:n,className:`absolute right-3 top-3 rounded-full p-1 text-muted-foreground/60 hover:bg-muted/50 hover:text-foreground`,"aria-label":`Dismiss`,children:(0,Z.jsx)(Bb,{className:`h-4 w-4`})}),(0,Z.jsxs)(`div`,{className:`mb-4 flex items-center gap-3`,children:[(0,Z.jsx)(`div`,{className:`flex h-12 w-12 items-center justify-center rounded-full bg-primary/10`,children:(0,Z.jsx)(jb,{className:`h-6 w-6 text-primary`})}),(0,Z.jsxs)(`div`,{className:`flex-1`,children:[(0,Z.jsxs)(`h3`,{className:`text-lg font-semibold text-foreground`,children:[e,` linked a wallet!`]}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Help cover messaging fees`})]})]}),i?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`div`,{className:`mb-3 space-y-2`,children:[(0,Z.jsx)(`label`,{className:`text-sm font-medium text-foreground`,children:`Custom amount (sats)`}),(0,Z.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Z.jsx)(GA,{type:`number`,min:1,step:1,value:o,onChange:e=>s(e.target.value),placeholder:`Enter amount`,className:`flex-1`,autoFocus:!0}),(0,Z.jsx)($,{onClick:l,disabled:r||!o||Number(o)<=0,children:r?`Sending`:`Send`})]})]}),(0,Z.jsx)($,{variant:`ghost`,size:`sm`,onClick:()=>{a(!1),s(``)},disabled:r,className:`w-full text-xs text-muted-foreground hover:text-foreground`,children:` Back to quick amounts`})]}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`div`,{className:`mb-4 grid grid-cols-3 gap-2`,children:NP.map(e=>(0,Z.jsxs)($,{variant:`outline`,onClick:()=>c(e.value),disabled:r,className:`h-auto flex-col gap-1 border-2 py-3 hover:border-primary hover:bg-primary/5`,children:[(0,Z.jsx)(`span`,{className:`text-base font-bold`,children:e.label}),(0,Z.jsx)(`span`,{className:`text-[10px] text-muted-foreground`,children:e.description})]},e.value))}),(0,Z.jsx)($,{variant:`ghost`,size:`sm`,onClick:()=>a(!0),disabled:r,className:`w-full text-xs text-muted-foreground hover:text-foreground`,children:`Enter custom amount`})]}),(0,Z.jsx)(`p`,{className:`mt-4 text-center text-[11px] text-muted-foreground/70`,children:`Your wallet will ask for confirmation before sending`})]})}var FP={sent:`single`,delivered:`double`,failed:`failed`,burned:`failed`},IP=[`0s`,`0.15s`,`0.3s`],LP=` I just linked a Bitcoin wallet!`,RP=`[SATS_SENT]`,zP=`[SAFETY_CHANGED]`,BP=`[JOINED]`;function VP(){return(0,Z.jsx)(`div`,{className:`flex flex-col items-start gap-1`,children:(0,Z.jsxs)(`div`,{className:`max-w-[120px] rounded-2xl bg-muted px-3 py-2 text-sm text-muted-foreground`,children:[(0,Z.jsx)(`span`,{className:`sr-only`,children:`Peer is typing`}),(0,Z.jsx)(`div`,{className:`flex items-center gap-1`,children:IP.map(e=>(0,Z.jsx)(`span`,{className:`h-2.5 w-2.5 rounded-full bg-muted-foreground/70 animate-pulse`,style:{animationDelay:e}},e))})]})})}function HP(e){let[,t]=(0,y.useState)(0);if((0,y.useEffect)(()=>{let e=setInterval(()=>t(e=>e+1),1e3);return()=>clearInterval(e)},[]),!e)return``;let n=Date.now(),r=new Date(e).getTime(),i=Math.floor((n-r)/1e3);if(i<60)return`${i}s`;let a=Math.floor(i/60);if(a<60)return`${a}m`;let o=Math.floor(a/60);return o<24?`${o}h`:`${Math.floor(o/24)}d`}function UP({message:e,isOwnMessage:t,bubbleTone:n,deliveryStatus:r}){let{textScale:i=`md`}=OP(),a=i===`sm`?`text-xs`:i===`lg`?`text-base`:`text-sm`,o=i===`sm`?`text-[10px]`:i===`lg`?`text-sm`:`text-xs`,s=HP(e.timestamp);return(0,Z.jsx)(`div`,{className:`max-w-lg rounded-2xl px-4 py-2 shadow-sm ${n} ${a}`,children:(0,Z.jsxs)(`div`,{className:`flex flex-col gap-1`,children:[(0,Z.jsx)(`div`,{className:`break-words`,children:e.text}),(0,Z.jsxs)(`div`,{className:`flex items-center justify-end gap-1.5 opacity-70 ${o}`,children:[(0,Z.jsx)(`span`,{children:s}),t&&(0,Z.jsx)(Z.Fragment,{children:r===`double`?(0,Z.jsxs)(`div`,{className:`flex items-center -space-x-1`,children:[(0,Z.jsx)(ub,{className:`h-3 w-3 stroke-[1.5]`}),(0,Z.jsx)(ub,{className:`h-3 w-3 stroke-[1.5]`})]}):r===`failed`?(0,Z.jsx)(ab,{className:`h-3 w-3 stroke-[1.5]`}):(0,Z.jsx)(ub,{className:`h-3 w-3 stroke-[1.5]`})})]})]})})}function WP({messages:e=[],participantPubKey:t,showTypingIndicator:n=!1,dimmed:r=!1,onOpenSatsSupport:i,onSendSats:a,peerName:o,isSendingSats:s=!1}){let c=(0,y.useRef)(null),[l,u]=(0,y.useState)(new Set);(0,y.useEffect)(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[e]);let d=(0,y.useMemo)(()=>e.map(e=>({...e,delivery:e.delivery||`sent`})),[e]);return(0,Z.jsx)(`div`,{ref:c,className:`flex-1 overflow-y-auto bg-background px-4 py-2 transition ${r?`pointer-events-none filter blur-sm`:``}`,children:(0,Z.jsxs)(`div`,{className:`space-y-4`,children:[d.map(e=>{let n=t&&e.author===t,r=typeof e.text==`string`&&e.text.startsWith(RP),c=typeof e.text==`string`&&e.text.startsWith(zP),d=typeof e.text==`string`&&e.text.startsWith(BP);if(c)return(0,Z.jsx)(`div`,{className:`flex justify-center`,children:(0,Z.jsx)(`div`,{className:`w-full max-w-lg rounded-md border border-destructive/40 bg-destructive/10 px-3 py-2 text-[11px] text-destructive text-center`,children:`Security warning: ${o||`This contact`}'s verified safety number changed. Treat this conversation as unverified until you re-verify their safety number.`})},e.id);if(d){let t=`${n?`You`:o||`This contact`} joined this chat.`;return(0,Z.jsx)(`div`,{className:`flex justify-center`,children:(0,Z.jsx)(`div`,{className:`max-w-xs rounded-full bg-muted px-3 py-1 text-[11px] text-muted-foreground text-center`,children:t})},e.id)}if(r){let t=e.text.slice(11),r=null;if(t.startsWith(`amount=`)){let e=t.slice(7),n=Number(e);Number.isFinite(n)&&n>0&&(r=`${n} sats`)}let i=n?r?`You sent ${r} to this contact via your wallet.`:`You sent sats to this contact via your wallet.`:r?`This contact sent you ${r}. Your wallet accepted the payment automatically.`:`This contact sent you sats via their wallet. Your wallet accepted the payment automatically.`;return(0,Z.jsx)(`div`,{className:`flex justify-center`,children:(0,Z.jsx)(`div`,{className:`max-w-xs rounded-full bg-muted px-3 py-1 text-[11px] text-muted-foreground text-center`,children:i})},e.id)}let f=n?`items-end text-right`:`items-start text-left`,p=n?`bg-primary text-primary-foreground`:`bg-muted text-foreground`,m=FP[e.delivery]||`single`,h=!n&&typeof e.text==`string`&&e.text.startsWith(LP);return h&&a&&!l.has(e.id)?(0,Z.jsx)(`div`,{className:`my-2`,children:(0,Z.jsx)(PP,{peerName:o||`This contact`,onSendSats:a,onDismiss:()=>{u(t=>new Set([...t,e.id]))},isSending:s})},e.id):(0,Z.jsxs)(`div`,{className:`flex flex-col ${f} gap-1`,children:[(0,Z.jsx)(UP,{message:e,isOwnMessage:n,bubbleTone:p,deliveryStatus:m}),h&&i&&l.has(e.id)&&(0,Z.jsx)(`div`,{className:`mt-1 flex justify-start`,children:(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:i,className:`px-3 py-1.5 text-xs h-auto`,children:`Send sats`})})]},e.id)}),n&&(0,Z.jsx)(VP,{})]})})}var GP=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(`textarea`,{className:Q(`flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:n,...t}));GP.displayName=`Textarea`;var KP=2e3;function qP({disabled:e,guestMode:t,onSend:n,onUpgrade:r,upgradePending:i=!1,placeholder:a=`Type a secure message`,onTyping:o,sendOnEnter:s=!1}){let[c,l]=(0,y.useState)(``),u=(0,y.useRef)(0);return(0,Z.jsx)(`div`,{className:`bg-background/95 px-4 py-3`,children:(0,Z.jsxs)(`form`,{onSubmit:t=>{if(t.preventDefault(),e)return;let r=c.trim();r&&(n?.(r),l(``))},className:`space-y-3`,children:[t&&(0,Z.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border border-muted-foreground/30 bg-muted/20 px-3 py-2 text-xs text-muted-foreground`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(HA,{variant:`secondary`,children:`Guest`}),(0,Z.jsx)(`span`,{children:`No wallet linked. Link once to unlock burns.`})]}),(0,Z.jsx)($,{size:`xs`,variant:`outline`,onClick:r,type:`button`,disabled:i,children:i?`Linking`:`Link wallet`})]}),(0,Z.jsxs)(`div`,{className:`flex items-end gap-3`,children:[(0,Z.jsx)(GP,{value:c,onChange:t=>{let n=t.target.value.slice(0,KP);if(l(n),e||!o)return;let r=Date.now();r-u.current>1200&&(u.current=r,o())},onKeyDown:t=>{if(!e&&s&&t.key===`Enter`&&!t.shiftKey){t.preventDefault();let e=c.trim();if(!e)return;n?.(e),l(``)}},placeholder:e?`Activate the thread to start messaging`:a,disabled:e,className:`min-h-[72px] flex-1 resize-none border-border`}),(0,Z.jsx)($,{type:`submit`,size:`sm`,disabled:e||c.trim().length===0,children:`Send`})]})]})})}function JP({thread:e}){if(!e)return null;let{ctOutpoint:t,dtOutpoints:n,dtRecipientCount:r,status:i,burnTxid:a,burnedAt:o}=e,s=t?.txid,c=n&&n.length>0;return(0,Z.jsxs)(`div`,{className:`space-y-4 p-4 bg-muted/30 rounded-lg border border-muted-foreground/20`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 text-sm font-semibold`,children:[(0,Z.jsx)(Ab,{className:`w-4 h-4`}),(0,Z.jsx)(`span`,{children:`Thread access tokens (advanced view)`})]}),(0,Z.jsxs)(`div`,{className:`text-sm`,children:[(0,Z.jsx)(`div`,{className:`font-medium mb-1`,children:`Access Status`}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 ${i===`burned`?`text-red-500`:`text-green-500`}`,children:[i===`burned`&&(0,Z.jsx)(_b,{className:`w-4 h-4`}),EM({status:i})]})]}),s&&(0,Z.jsxs)(`div`,{className:`text-sm space-y-1`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 font-medium`,children:[(0,Z.jsx)(bb,{className:`w-4 h-4`}),(0,Z.jsx)(`span`,{children:`Thread access control token`})]}),(0,Z.jsxs)(`div`,{className:`pl-6 space-y-1`,children:[(0,Z.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Outpoint: `,(0,Z.jsx)(`code`,{className:`text-xs`,children:OM(t)})]}),(0,Z.jsxs)(`a`,{href:DM(t),target:`_blank`,rel:`noopener noreferrer`,className:`inline-flex items-center gap-1 text-xs text-blue-500 hover:text-blue-600`,children:[(0,Z.jsx)(hb,{className:`w-3 h-3`}),`View on WhatsOnChain`]})]})]}),(0,Z.jsxs)(`div`,{className:`text-sm space-y-1`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 font-medium`,children:[(0,Z.jsx)(Ab,{className:`w-4 h-4`}),(0,Z.jsx)(`span`,{children:`Participant access tokens`})]}),(0,Z.jsx)(`div`,{className:`pl-6 space-y-1`,children:c?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[r,` recipient`,r===1?``:`s`,` with access tokens`]}),n.slice(0,3).map((e,t)=>(0,Z.jsxs)(`div`,{className:`text-xs`,children:[(0,Z.jsx)(`code`,{className:`text-xs`,children:OM({txid:e.txid,vout:e.vout})}),e.recipientPubkey&&(0,Z.jsxs)(`span`,{className:`text-muted-foreground ml-2`,children:[` `,e.recipientPubkey.slice(0,8),`...`]})]},t)),n.length>3&&(0,Z.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`+`,n.length-3,` more...`]})]}):(0,Z.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:r>0?`${r} recipient${r===1?``:`s`} (outpoints not loaded)`:`No data tokens minted yet`})})]}),i===`burned`&&a&&(0,Z.jsxs)(`div`,{className:`text-sm space-y-1 border-t border-muted-foreground/20 pt-3`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 font-medium text-red-500`,children:[(0,Z.jsx)(_b,{className:`w-4 h-4`}),(0,Z.jsx)(`span`,{children:`Burn Proof (On-Chain)`})]}),(0,Z.jsxs)(`div`,{className:`pl-6 space-y-1`,children:[(0,Z.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Burned: `,o?new Date(o).toLocaleString():`Unknown`]}),(0,Z.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Burn TX: `,(0,Z.jsxs)(`code`,{className:`text-xs`,children:[a.slice(0,16),`...`]})]}),(0,Z.jsxs)(`a`,{href:DM({txid:a}),target:`_blank`,rel:`noopener noreferrer`,className:`inline-flex items-center gap-1 text-xs text-red-500 hover:text-red-600`,children:[(0,Z.jsx)(hb,{className:`w-3 h-3`}),`Verify Burn on Blockchain`]})]})]}),(0,Z.jsx)(`div`,{className:`text-xs text-muted-foreground italic border-t border-muted-foreground/20 pt-3`,children:`On-chain access-token system: Provable access revocation via token burning`})]})}var YP=[{match:/must be valid transaction on chain/i,message:`Your wallet has outdated transaction data.`,action:`Open your wallet app and refresh, then try again.`,recoverable:!0,category:`wallet`},{match:/insufficient funds|not enough.*satoshis/i,message:`Not enough funds in your wallet.`,action:`Add more Bitcoin to your wallet and try again.`,recoverable:!0,category:`wallet`},{match:/u is not iterable/i,message:`Wallet signature request failed.`,action:`This is a known wallet compatibility issue. The action may still complete using a fallback method.`,recoverable:!0,category:`wallet`},{match:/no.*wallet.*available|install.*wallet/i,message:`No BSV wallet detected.`,action:`Install and run Metanet Desktop (https://getmetanet.com/#desktop), then reconnect.`,recoverable:!0,category:`wallet`},{match:/wallet.*connection.*refused|ERR_CONNECTION_REFUSED.*3321/i,message:`Cannot connect to your wallet.`,action:`Make sure your wallet app is running and try again.`,recoverable:!0,category:`wallet`},{match:/wallet.*timeout|wallet.*timed out/i,message:`Wallet took too long to respond.`,action:`Check if your wallet is unlocked and responsive, then try again.`,recoverable:!0,category:`wallet`},{match:/access control checks|not allowed to request resource/i,message:`Your browser blocked NukeNote from reaching your local wallet.`,action:`If you are using a desktop wallet on this machine, try running NukeNote from a local address (for example http://localhost) or a desktop-bundled version, then try again.`,recoverable:!0,category:`wallet`},{match:/overlay.*connection|websocket.*failed|ws:\/\/.*failed/i,message:`Cannot connect to the messaging server.`,action:`Check your internet connection. Messages will sync when connection is restored.`,recoverable:!0,category:`network`},{match:/overlay.*timeout/i,message:`Messaging server is slow to respond.`,action:`Your message may still be delivered. Check back in a moment.`,recoverable:!0,category:`network`},{match:/messagebox.*failed|messagebox.*error/i,message:`Payment messaging service is temporarily unavailable.`,action:`Try sending the payment again in a few moments.`,recoverable:!0,category:`network`},{match:/peerpay.*failed|payment.*failed/i,message:`Bitcoin payment could not be completed.`,action:`Check your wallet balance and try again.`,recoverable:!0,category:`payment`},{match:/thread.*not found|receipt.*not found/i,message:`This conversation could not be found.`,action:`The thread may have been deleted or you may need to rejoin.`,recoverable:!1,category:`thread`},{match:/CT.*burned|control token.*burned/i,message:`This conversation has been permanently deleted.`,action:`The thread creator burned the access token. This cannot be undone.`,recoverable:!1,category:`thread`},{match:/DT.*invalid|data token.*invalid/i,message:`Your access to this conversation is no longer valid.`,action:`You may need a new invite to rejoin this thread.`,recoverable:!1,category:`thread`},{match:/invite.*expired/i,message:`This invite link has expired.`,action:`Ask the sender for a new invite link.`,recoverable:!1,category:`invite`},{match:/invite.*invalid|malformed invite/i,message:`This invite link is invalid.`,action:`Make sure you copied the complete invite link.`,recoverable:!0,category:`invite`},{match:/network.*error|fetch.*failed|net::ERR_/i,message:`Network connection problem.`,action:`Check your internet connection and try again.`,recoverable:!0,category:`network`},{match:/storage.*quota|quota.*exceeded/i,message:`Browser storage is full.`,action:`Clear some browser data or use a different browser.`,recoverable:!1,category:`storage`},{match:/decrypt.*failed|encryption.*error/i,message:`Could not decrypt message.`,action:`The message may be corrupted or your keys may have changed.`,recoverable:!1,category:`crypto`}];function XP(e){if(!e)return``;if(e instanceof Error)return e.message||String(e);if(typeof e==`string`)try{let t=JSON.parse(e);return t.message||t.error||e}catch{return e}if(typeof e==`object`){if(e.message)try{return JSON.parse(e.message).message||e.message}catch{return e.message}return JSON.stringify(e)}return String(e)}function ZP(e,t={}){let{context:n,fallback:r}=t,i=XP(e);for(let e of YP)if(typeof e.match==`string`?i.toLowerCase().includes(e.match.toLowerCase()):e.match.test(i))return{message:e.message,action:e.action,recoverable:e.recoverable,category:e.category,original:i};let a=n?`Something went wrong while trying to ${n}.`:`Something went wrong.`;return{message:r||a,action:`Please try again. If the problem persists, check your wallet and internet connection.`,recoverable:!0,category:`unknown`,original:i}}function QP(e,t={}){let n=ZP(e,t);return n.action&&n.recoverable?`${n.message} ${n.action}`:n.message}var $P={mutual:`Burn policy: thread owner only`,initiator:`Burn policy: thread owner only`},eF={pending:`Invite pending`,burned:`Burned`,left:`Left`,ready:`Active`};function tF({open:e,onOpenChange:t,thread:n,onGenerateInvite:r,onSatsSent:i}){let a=(0,y.useMemo)(()=>n?.policy?$P[n.policy]||n.policy:null,[n?.policy]),o=(0,y.useMemo)(()=>n?.status?eF[n.status]||n.status:null,[n?.status]),s=(0,y.useMemo)(()=>{if(n?.lastActivityIso)try{return new Date(n.lastActivityIso).toLocaleString()}catch(e){console.warn(`Unable to parse lastActivityIso`,n.lastActivityIso,e)}return n?.lastActivity||null},[n?.lastActivityIso,n?.lastActivity]),c=n?.blocked===!0,l=!!(n?.inviter&&n?.selfPublicKey&&n.inviter===n.selfPublicKey),u=n?.mintedAt?new Date(n.mintedAt).toLocaleString():null,d=n?.burnedAt?new Date(n.burnedAt).toLocaleString():null,f=Array.isArray(n?.dtIssuances)?n.dtIssuances:[],p=f.length>0?f[f.length-1]:null,m=p?.issuedAt?new Date(p.issuedAt).toLocaleString():null,{addNotification:h}=Gy(),[g,_]=(0,y.useState)(`50000`),[v,b]=(0,y.useState)(!1),x=[{value:1e4,label:`10K sats`},{value:5e4,label:`50K sats`},{value:1e5,label:`100K sats`}],S=async(e=null)=>{if(!n?.peerWalletPublicKey){h({type:`error`,message:`This contact has not linked a wallet yet. Try again after they upgrade.`,duration:6e3});return}let t=e===null?Number(g):e;if(!Number.isFinite(t)||!Number.isInteger(t)||t<=0){h({type:`error`,message:`Amount must be a positive whole number of sats.`,duration:5e3});return}b(!0);try{h({type:`success`,message:`Bitcoin payment created. Your wallet will ask for confirmation.`,duration:8e3}),await By({identityKey:n.peerWalletPublicKey,amountSats:t}),typeof i==`function`&&i(t)}catch(e){console.error(`[ThreadInfoSheet] Failed to send sats`,e),h({type:`error`,message:QP(e,{context:`send payment`}),duration:8e3})}finally{b(!1)}};return(0,Z.jsx)(hT,{open:e,onOpenChange:t,children:(0,Z.jsxs)(bT,{side:`right`,className:`w-full max-w-sm overflow-y-auto`,children:[(0,Z.jsxs)(xT,{children:[(0,Z.jsx)(CT,{children:`Thread details`}),(0,Z.jsx)(wT,{children:`Status, participants, and advanced access details for this conversation.`})]}),(0,Z.jsxs)(`div`,{className:`mt-6 space-y-4 text-sm text-muted-foreground`,children:[(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Status`}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[o&&(0,Z.jsx)(HA,{variant:`outline`,children:o}),n?.guestMode&&(0,Z.jsx)(HA,{variant:`secondary`,children:`Guest session`}),a&&(0,Z.jsx)(HA,{variant:n.policy===`initiator`?`destructive`:`outline`,children:a}),c&&(0,Z.jsx)(HA,{variant:`destructive`,children:`Inviter blocked`})]}),(0,Z.jsx)(`p`,{className:`text-[11px] text-muted-foreground/80`,children:`Burning this conversation permanently revokes access for everyone and deletes the local data that was tied to it.`})]}),(0,Z.jsx)(zT,{className:`my-4`}),(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Participants`}),(0,Z.jsxs)(`p`,{children:[(0,Z.jsx)(`span`,{className:`font-medium text-foreground`,children:`Thread created by:`}),` `,n?.inviterName||`Unknown`]}),n?.inviter&&(0,Z.jsx)(`p`,{className:`text-xs font-mono text-foreground/70`,children:Bx(n.inviter,34)}),l&&(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground/80`,children:`You started this thread.`})]}),(0,Z.jsx)(zT,{className:`my-4`}),!n?.guestMode&&r&&(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Add another person`}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>{t?.(!1),r(n.id)},className:`w-full`,children:`Generate invite link`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground/70`,children:`Create a new invite link to add another participant to this thread. Each person gets their own access token.`})]}),!n?.guestMode&&r&&(0,Z.jsx)(zT,{className:`my-4`}),(n?.upgradedAt||u)&&(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Upgrade`}),n?.upgradedAt&&(0,Z.jsxs)(`p`,{children:[`Wallet linked at `,(0,Z.jsx)(`span`,{className:`text-foreground/80`,children:n.upgradedAt})]}),u&&(0,Z.jsxs)(`p`,{children:[`Thread access token minted on `,(0,Z.jsx)(`span`,{className:`text-foreground/80`,children:u})]}),n?.burnTxid&&(0,Z.jsxs)(`div`,{className:`space-y-1`,children:[(0,Z.jsxs)(`p`,{children:[`Burn tx:`,` `,(0,Z.jsx)(`code`,{className:`rounded bg-muted/30 px-1 font-mono text-[11px] text-foreground/80`,children:Bx(n.burnTxid,28)})]}),d&&(0,Z.jsxs)(`p`,{children:[`Burned on `,(0,Z.jsx)(`span`,{className:`text-foreground/80`,children:d})]})]})]}),(n?.upgradedAt||u)&&(0,Z.jsx)(zT,{className:`my-4`}),!n?.guestMode&&n?.peerWalletPublicKey&&(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Send Bitcoin`}),(0,Z.jsx)(`p`,{className:`text-xs text-foreground/70`,children:`Help cover messaging fees by sending sats to this contact's wallet.`}),(0,Z.jsx)(`div`,{className:`grid grid-cols-3 gap-2`,children:x.map(e=>(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>S(e.value),disabled:v,className:`h-auto flex-col gap-0.5 py-2`,children:(0,Z.jsx)(`span`,{className:`text-xs font-semibold`,children:e.label})},e.value))}),(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground/70`,children:`Or enter a custom amount:`}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(GA,{type:`number`,min:1,step:1,value:g,onChange:e=>_(e.target.value),className:`flex-1`,placeholder:`Enter amount`}),(0,Z.jsx)($,{size:`sm`,onClick:()=>S(),disabled:v,children:v?`Sending`:`Send`})]})]}),(0,Z.jsxs)(`details`,{className:`text-[11px] text-muted-foreground/60`,children:[(0,Z.jsx)(`summary`,{className:`cursor-pointer hover:text-muted-foreground`,children:`Wallet details`}),(0,Z.jsx)(`p`,{className:`mt-1 font-mono break-all`,children:n.peerWalletPublicKey})]})]}),!n?.guestMode&&n?.peerWalletPublicKey&&(0,Z.jsx)(zT,{className:`my-4`}),f.length>0&&(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Participant access tokens (advanced)`}),m&&(0,Z.jsxs)(`p`,{children:[`Last issuance on `,(0,Z.jsx)(`span`,{className:`text-foreground/80`,children:m})]}),(0,Z.jsx)(`div`,{className:`space-y-2`,children:f.map((e,t)=>(0,Z.jsxs)(`details`,{className:`rounded-md border border-muted-foreground/20 bg-muted/10 p-2 text-[11px]`,children:[(0,Z.jsx)(`summary`,{className:`cursor-pointer text-muted-foreground/70`,children:e?.txid?Bx(e.txid,32):`Issuance ${t+1}`}),(0,Z.jsx)(`pre`,{className:`mt-2 max-h-40 overflow-auto whitespace-pre-wrap text-[11px] text-foreground/80`,children:JSON.stringify(e,null,2)})]},`${e?.txid||`issuance`}-${t}`))})]}),f.length>0&&(0,Z.jsx)(zT,{className:`my-4`}),s&&(0,Z.jsxs)(`section`,{className:`space-y-3`,children:[(0,Z.jsx)(`h3`,{className:`text-[13px] font-semibold uppercase tracking-wide text-foreground/60`,children:`Last activity`}),(0,Z.jsx)(`p`,{children:s})]}),s&&(0,Z.jsx)(zT,{className:`my-4`}),(0,Z.jsx)(`section`,{className:`space-y-2`,children:(0,Z.jsx)(JP,{thread:n})})]})]})})}function nF({pubkey:e,identity:t,onClose:n,onVerify:r,onBlock:i,onUnblock:a,onDelete:o,isBlocked:s=!1,open:c=!1}){let[l,u]=(0,y.useState)(!1),[d,f]=(0,y.useState)(``),[p,m]=(0,y.useState)(t);if((0,y.useEffect)(()=>{m(t)},[t]),!c)return null;if(!e||!p)return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`div`,{className:`fixed inset-0 z-[999] bg-black/50`,onClick:n,"aria-hidden":`true`}),(0,Z.jsxs)(`div`,{className:`fixed right-0 top-0 bottom-0 z-[1000] flex w-full max-w-[400px] flex-col bg-background shadow-lg`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between border-b border-border px-4 py-4`,children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold`,children:`Contact Details`}),(0,Z.jsx)(`button`,{onClick:n,className:`text-2xl leading-none hover:opacity-70 transition-opacity`,"aria-label":`Close`,children:``})]}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Z.jsxs)(`div`,{className:`rounded-lg border border-muted-foreground/20 bg-muted/10 p-6 text-center`,children:[(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Contact information not available for this thread.`}),(0,Z.jsx)(`p`,{className:`mt-2 text-xs text-muted-foreground`,children:`This may be an older thread created before identity tracking was implemented.`})]})})]})]});let h=p.verified,g=p.source,_=async()=>{try{let t=d.trim()||null;await wj(e,{nickname:t}),m({...p,name:t||p.name,source:t?`nickname`:p.source}),u(!1),f(``)}catch(e){console.error(`[ContactSheet] Failed to set nickname:`,e),alert(`Failed to set nickname`)}};return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`div`,{className:`fixed inset-0 z-[999] bg-black/50`,onClick:n,"aria-hidden":`true`}),(0,Z.jsxs)(`div`,{className:`fixed right-0 top-0 bottom-0 z-[1000] flex w-full max-w-[400px] flex-col bg-background shadow-lg`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between border-b border-border px-4 py-4`,children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold`,children:`Contact Details`}),(0,Z.jsx)(`button`,{onClick:n,className:`text-2xl leading-none hover:opacity-70 transition-opacity`,"aria-label":`Close`,children:``})]}),(0,Z.jsxs)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:[(0,Z.jsxs)(`div`,{className:`mb-6 flex flex-col items-center`,children:[(0,Z.jsx)(lj,{name:p.name,colorSeed:p.colorSeed,avatarHash:p.avatar,pubkey:e,size:80}),(0,Z.jsx)(`h3`,{className:`mt-3 mb-2 text-xl font-semibold`,children:p.name}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap justify-center gap-2`,children:[h&&(0,Z.jsxs)(`span`,{className:`flex items-center gap-1 rounded-full bg-green-500 px-3 py-1 text-xs font-medium text-white`,children:[(0,Z.jsx)(`svg`,{className:`h-3 w-3`,fill:`currentColor`,viewBox:`0 0 20 20`,children:(0,Z.jsx)(`path`,{fillRule:`evenodd`,d:`M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z`,clipRule:`evenodd`})}),`Verified`]}),g===`certificate`&&(0,Z.jsxs)(`span`,{className:`flex items-center gap-1 rounded-full bg-blue-500/10 px-3 py-1 text-xs font-medium text-blue-600 dark:text-blue-400 border border-blue-500/20`,children:[(0,Z.jsx)(`svg`,{className:`h-3 w-3`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,Z.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z`})}),`BRC-100 Certificate`]}),g===`profileCard`&&(0,Z.jsxs)(`span`,{className:`flex items-center gap-1 rounded-full bg-purple-500/10 px-3 py-1 text-xs font-medium text-purple-600 dark:text-purple-400 border border-purple-500/20`,children:[(0,Z.jsx)(`svg`,{className:`h-3 w-3`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,Z.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2`})}),`Guest ProfileCard`]}),g===`nickname`&&(0,Z.jsxs)(`span`,{className:`flex items-center gap-1 rounded-full bg-amber-500/10 px-3 py-1 text-xs font-medium text-amber-600 dark:text-amber-400 border border-amber-500/20`,children:[(0,Z.jsx)(`svg`,{className:`h-3 w-3`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,Z.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z`})}),`Custom Nickname`]}),g===`fallback`&&(0,Z.jsxs)(`span`,{className:`flex items-center gap-1 rounded-full bg-muted px-3 py-1 text-xs font-medium text-muted-foreground border border-muted-foreground/20`,children:[(0,Z.jsx)(`svg`,{className:`h-3 w-3`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,Z.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z`})}),`Generated Name`]})]})]}),g===`certificate`&&(0,Z.jsx)(`div`,{className:`mb-6 rounded-lg border border-blue-500/20 bg-blue-500/5 p-3`,children:(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[(0,Z.jsx)(`strong`,{className:`text-blue-600 dark:text-blue-400`,children:`BRC-100 Certificate:`}),` This identity is stored in the holder's wallet and cryptographically verifiable. Other wallet holders can discover this name automatically.`]})}),g===`profileCard`&&(0,Z.jsx)(`div`,{className:`mb-6 rounded-lg border border-purple-500/20 bg-purple-500/5 p-3`,children:(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[(0,Z.jsx)(`strong`,{className:`text-purple-600 dark:text-purple-400`,children:`Guest ProfileCard:`}),` This identity was signed by the guest's ephemeral key. It's not backed by a wallet but is cryptographically signed.`]})}),g===`fallback`&&(0,Z.jsx)(`div`,{className:`mb-6 rounded-lg border border-muted-foreground/20 bg-muted/5 p-3`,children:(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[(0,Z.jsx)(`strong`,{children:`Generated name:`}),` This contact hasn't chosen a name yet. We've given them a stable placeholder so you can recognize them. You can set a nickname anytime.`]})}),(0,Z.jsxs)(`div`,{className:`mb-6`,children:[(0,Z.jsx)(`h4`,{className:`mb-2 text-sm font-semibold text-muted-foreground`,children:`Verify Identity`}),(0,Z.jsxs)(`p`,{className:`mb-3 text-xs text-muted-foreground`,children:[`Use safety numbers to confirm this contact really is who they say they are. Your device will show `,(0,Z.jsx)(`span`,{className:`font-semibold`,children:`your`}),` safety number; ask `,p.name,` to send you the number they see on their own device (for example by screenshot or secure message) and make sure they match.`]}),(0,Z.jsx)(`button`,{onClick:r,className:`w-full rounded border border-border bg-background px-4 py-2 text-sm hover:bg-muted transition-colors`,children:h?`Re-verify`:`Verify Identity`})]}),(0,Z.jsxs)(`div`,{className:`mb-6`,children:[(0,Z.jsxs)(`div`,{className:`mb-2 flex items-center justify-between`,children:[(0,Z.jsx)(`h4`,{className:`text-sm font-semibold text-muted-foreground`,children:`Nickname`}),p?.source===`nickname`&&!l&&(0,Z.jsxs)($,{variant:`ghost`,size:`sm`,onClick:async()=>{try{await wj(e,{nickname:null}),m({...p,source:`fallback`})}catch(e){console.error(`[ContactSheet] Failed to clear nickname:`,e)}},className:`h-7 text-xs text-muted-foreground hover:text-destructive`,children:[(0,Z.jsx)(Nb,{className:`mr-1 h-3 w-3`}),`Clear`]})]}),l?(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[(0,Z.jsx)(GA,{type:`text`,value:d,onChange:e=>f(e.target.value),placeholder:`Enter nickname`,maxLength:30,autoFocus:!0}),(0,Z.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Z.jsx)($,{onClick:_,className:`flex-1`,children:`Save`}),(0,Z.jsx)($,{variant:`outline`,onClick:()=>{u(!1),f(``)},className:`flex-1`,children:`Cancel`})]})]}):(0,Z.jsxs)($,{variant:`outline`,onClick:()=>u(!0),className:`w-full justify-start`,children:[(0,Z.jsx)(Eb,{className:`mr-2 h-4 w-4`}),p?.source===`nickname`?`Edit Nickname`:`Set Nickname`]})]})]}),p?.kind&&(0,Z.jsx)(`div`,{className:`border-t border-border px-4 py-3`,children:p.kind===`holder`?(0,Z.jsxs)(`div`,{className:`rounded-lg border border-emerald-500/20 bg-emerald-500/5 p-3`,children:[(0,Z.jsx)(`p`,{className:`text-xs font-medium text-emerald-600 dark:text-emerald-400 mb-1`,children:`Wallet Contact`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`This contact has a linked wallet. You can send them thread invites directly via MessageBox, and they can reconnect with you across threads.`})]}):(0,Z.jsxs)(`div`,{className:`rounded-lg border border-amber-500/20 bg-amber-500/5 p-3`,children:[(0,Z.jsx)(`p`,{className:`text-xs font-medium text-amber-600 dark:text-amber-400 mb-1`,children:`Guest Contact`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`This is a guest identity (ephemeral key). Guest contacts cannot receive direct invites and may not be reachable after the thread ends. Consider encouraging them to link a wallet.`})]})}),(0,Z.jsxs)(`div`,{className:`border-t border-border px-4 py-3 space-y-2`,children:[s?(0,Z.jsx)($,{variant:`outline`,size:`sm`,onClick:a,className:`w-full`,children:`Unblock contact`}):(0,Z.jsx)($,{variant:`destructive`,size:`sm`,onClick:i,className:`w-full`,disabled:!i,children:`Block Contact`}),(0,Z.jsxs)($,{variant:`ghost`,size:`sm`,onClick:()=>{window.confirm(`Delete ${p?.name||`this contact`} from your contacts? This cannot be undone.`)&&o?.()},className:`w-full text-muted-foreground hover:text-destructive`,disabled:!o,children:[(0,Z.jsx)(Nb,{className:`mr-2 h-4 w-4`}),`Delete Contact`]})]})]})]})}var rF=o(((e,t)=>{t.exports=function(){return typeof Promise==`function`&&Promise.prototype&&Promise.prototype.then}})),iF=o((e=>{var t,n=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];e.getSymbolSize=function(e){if(!e)throw Error(`"version" cannot be null or undefined`);if(e<1||e>40)throw Error(`"version" should be in range from 1 to 40`);return e*4+17},e.getSymbolTotalCodewords=function(e){return n[e]},e.getBCHDigit=function(e){let t=0;for(;e!==0;)t++,e>>>=1;return t},e.setToSJISFunction=function(e){if(typeof e!=`function`)throw Error(`"toSJISFunc" is not a valid function.`);t=e},e.isKanjiModeEnabled=function(){return t!==void 0},e.toSJIS=function(e){return t(e)}})),aF=o((e=>{e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(t){if(typeof t!=`string`)throw Error(`Param is not a string`);switch(t.toLowerCase()){case`l`:case`low`:return e.L;case`m`:case`medium`:return e.M;case`q`:case`quartile`:return e.Q;case`h`:case`high`:return e.H;default:throw Error(`Unknown EC Level: `+t)}}e.isValid=function(e){return e&&e.bit!==void 0&&e.bit>=0&&e.bit<4},e.from=function(n,r){if(e.isValid(n))return n;try{return t(n)}catch{return r}}})),oF=o(((e,t)=>{function n(){this.buffer=[],this.length=0}n.prototype={get:function(e){let t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)==1},put:function(e,t){for(let n=0;n<t;n++)this.putBit((e>>>t-n-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},t.exports=n})),sF=o(((e,t)=>{function n(e){if(!e||e<1)throw Error(`BitMatrix size must be defined and greater than 0`);this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}n.prototype.set=function(e,t,n,r){let i=e*this.size+t;this.data[i]=n,r&&(this.reservedBit[i]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},t.exports=n})),cF=o((e=>{var t=iF().getSymbolSize;e.getRowColCoords=function(e){if(e===1)return[];let n=Math.floor(e/7)+2,r=t(e),i=r===145?26:Math.ceil((r-13)/(2*n-2))*2,a=[r-7];for(let e=1;e<n-1;e++)a[e]=a[e-1]-i;return a.push(6),a.reverse()},e.getPositions=function(t){let n=[],r=e.getRowColCoords(t),i=r.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)e===0&&t===0||e===0&&t===i-1||e===i-1&&t===0||n.push([r[e],r[t]]);return n}})),lF=o((e=>{var t=iF().getSymbolSize,n=7;e.getPositions=function(e){let r=t(e);return[[0,0],[r-n,0],[0,r-n]]}})),uF=o((e=>{e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(e){return e!=null&&e!==``&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){let n=e.size,r=0,i=0,a=0,o=null,s=null;for(let c=0;c<n;c++){i=a=0,o=s=null;for(let l=0;l<n;l++){let n=e.get(c,l);n===o?i++:(i>=5&&(r+=t.N1+(i-5)),o=n,i=1),n=e.get(l,c),n===s?a++:(a>=5&&(r+=t.N1+(a-5)),s=n,a=1)}i>=5&&(r+=t.N1+(i-5)),a>=5&&(r+=t.N1+(a-5))}return r},e.getPenaltyN2=function(e){let n=e.size,r=0;for(let t=0;t<n-1;t++)for(let i=0;i<n-1;i++){let n=e.get(t,i)+e.get(t,i+1)+e.get(t+1,i)+e.get(t+1,i+1);(n===4||n===0)&&r++}return r*t.N2},e.getPenaltyN3=function(e){let n=e.size,r=0,i=0,a=0;for(let t=0;t<n;t++){i=a=0;for(let o=0;o<n;o++)i=i<<1&2047|e.get(t,o),o>=10&&(i===1488||i===93)&&r++,a=a<<1&2047|e.get(o,t),o>=10&&(a===1488||a===93)&&r++}return r*t.N3},e.getPenaltyN4=function(e){let n=0,r=e.data.length;for(let t=0;t<r;t++)n+=e.data[t];return Math.abs(Math.ceil(n*100/r/5)-10)*t.N4};function n(t,n,r){switch(t){case e.Patterns.PATTERN000:return(n+r)%2==0;case e.Patterns.PATTERN001:return n%2==0;case e.Patterns.PATTERN010:return r%3==0;case e.Patterns.PATTERN011:return(n+r)%3==0;case e.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2==0;case e.Patterns.PATTERN101:return n*r%2+n*r%3==0;case e.Patterns.PATTERN110:return(n*r%2+n*r%3)%2==0;case e.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2==0;default:throw Error(`bad maskPattern:`+t)}}e.applyMask=function(e,t){let r=t.size;for(let i=0;i<r;i++)for(let a=0;a<r;a++)t.isReserved(a,i)||t.xor(a,i,n(e,a,i))},e.getBestMask=function(t,n){let r=Object.keys(e.Patterns).length,i=0,a=1/0;for(let o=0;o<r;o++){n(o),e.applyMask(o,t);let r=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(o,t),r<a&&(a=r,i=o)}return i}})),dF=o((e=>{var t=aF(),n=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];e.getBlocksCount=function(e,r){switch(r){case t.L:return n[(e-1)*4+0];case t.M:return n[(e-1)*4+1];case t.Q:return n[(e-1)*4+2];case t.H:return n[(e-1)*4+3];default:return}},e.getTotalCodewordsCount=function(e,n){switch(n){case t.L:return r[(e-1)*4+0];case t.M:return r[(e-1)*4+1];case t.Q:return r[(e-1)*4+2];case t.H:return r[(e-1)*4+3];default:return}}})),fF=o((e=>{var t=new Uint8Array(512),n=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)t[r]=e,n[e]=r,e<<=1,e&256&&(e^=285);for(let e=255;e<512;e++)t[e]=t[e-255]})(),e.log=function(e){if(e<1)throw Error(`log(`+e+`)`);return n[e]},e.exp=function(e){return t[e]},e.mul=function(e,r){return e===0||r===0?0:t[n[e]+n[r]]}})),pF=o((e=>{var t=fF();e.mul=function(e,n){let r=new Uint8Array(e.length+n.length-1);for(let i=0;i<e.length;i++)for(let a=0;a<n.length;a++)r[i+a]^=t.mul(e[i],n[a]);return r},e.mod=function(e,n){let r=new Uint8Array(e);for(;r.length-n.length>=0;){let e=r[0];for(let i=0;i<n.length;i++)r[i]^=t.mul(n[i],e);let i=0;for(;i<r.length&&r[i]===0;)i++;r=r.slice(i)}return r},e.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let i=0;i<n;i++)r=e.mul(r,new Uint8Array([1,t.exp(i)]));return r}})),mF=o(((e,t)=>{var n=pF();function r(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}r.prototype.initialize=function(e){this.degree=e,this.genPoly=n.generateECPolynomial(this.degree)},r.prototype.encode=function(e){if(!this.genPoly)throw Error(`Encoder not initialized`);let t=new Uint8Array(e.length+this.degree);t.set(e);let r=n.mod(t,this.genPoly),i=this.degree-r.length;if(i>0){let e=new Uint8Array(this.degree);return e.set(r,i),e}return r},t.exports=r})),hF=o((e=>{e.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}})),gF=o((e=>{var t=`[0-9]+`,n=`[A-Z $%*+\\-./:]+`,r=`(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+`;r=r.replace(/u/g,`\\u`);var i=`(?:(?![A-Z0-9 $%*+\\-./:]|`+r+`)(?:.|[\r
]))+`;e.KANJI=new RegExp(r,`g`),e.BYTE_KANJI=RegExp(`[^A-Z0-9 $%*+\\-./:]+`,`g`),e.BYTE=new RegExp(i,`g`),e.NUMERIC=new RegExp(t,`g`),e.ALPHANUMERIC=new RegExp(n,`g`);var a=RegExp(`^`+r+`$`),o=RegExp(`^`+t+`$`),s=RegExp(`^[A-Z0-9 $%*+\\-./:]+$`);e.testKanji=function(e){return a.test(e)},e.testNumeric=function(e){return o.test(e)},e.testAlphanumeric=function(e){return s.test(e)}})),_F=o((e=>{var t=hF(),n=gF();e.NUMERIC={id:`Numeric`,bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:`Alphanumeric`,bit:2,ccBits:[9,11,13]},e.BYTE={id:`Byte`,bit:4,ccBits:[8,16,16]},e.KANJI={id:`Kanji`,bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,n){if(!e.ccBits)throw Error(`Invalid mode: `+e);if(!t.isValid(n))throw Error(`Invalid version: `+n);return n>=1&&n<10?e.ccBits[0]:n<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return n.testNumeric(t)?e.NUMERIC:n.testAlphanumeric(t)?e.ALPHANUMERIC:n.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw Error(`Invalid mode`)},e.isValid=function(e){return e&&e.bit&&e.ccBits};function r(t){if(typeof t!=`string`)throw Error(`Param is not a string`);switch(t.toLowerCase()){case`numeric`:return e.NUMERIC;case`alphanumeric`:return e.ALPHANUMERIC;case`kanji`:return e.KANJI;case`byte`:return e.BYTE;default:throw Error(`Unknown mode: `+t)}}e.from=function(t,n){if(e.isValid(t))return t;try{return r(t)}catch{return n}}})),vF=o((e=>{var t=iF(),n=dF(),r=aF(),i=_F(),a=hF(),o=7973,s=t.getBCHDigit(o);function c(t,n,r){for(let i=1;i<=40;i++)if(n<=e.getCapacity(i,r,t))return i}function l(e,t){return i.getCharCountIndicator(e,t)+4}function u(e,t){let n=0;return e.forEach(function(e){let r=l(e.mode,t);n+=r+e.getBitsLength()}),n}function d(t,n){for(let r=1;r<=40;r++)if(u(t,r)<=e.getCapacity(r,n,i.MIXED))return r}e.from=function(e,t){return a.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,r,o){if(!a.isValid(e))throw Error(`Invalid QR Code version`);o===void 0&&(o=i.BYTE);let s=t.getSymbolTotalCodewords(e),c=n.getTotalCodewordsCount(e,r),u=(s-c)*8;if(o===i.MIXED)return u;let d=u-l(o,e);switch(o){case i.NUMERIC:return Math.floor(d/10*3);case i.ALPHANUMERIC:return Math.floor(d/11*2);case i.KANJI:return Math.floor(d/13);case i.BYTE:default:return Math.floor(d/8)}},e.getBestVersionForData=function(e,t){let n,i=r.from(t,r.M);if(Array.isArray(e)){if(e.length>1)return d(e,i);if(e.length===0)return 1;n=e[0]}else n=e;return c(n.mode,n.getLength(),i)},e.getEncodedBits=function(e){if(!a.isValid(e)||e<7)throw Error(`Invalid QR Code version`);let n=e<<12;for(;t.getBCHDigit(n)-s>=0;)n^=o<<t.getBCHDigit(n)-s;return e<<12|n}})),yF=o((e=>{var t=iF(),n=1335,r=21522,i=t.getBCHDigit(n);e.getEncodedBits=function(e,a){let o=e.bit<<3|a,s=o<<10;for(;t.getBCHDigit(s)-i>=0;)s^=n<<t.getBCHDigit(s)-i;return(o<<10|s)^r}})),bF=o(((e,t)=>{var n=_F();function r(e){this.mode=n.NUMERIC,this.data=e.toString()}r.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);let i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,i*3+1))},t.exports=r})),xF=o(((e,t)=>{var n=_F(),r=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:`.split(``);function i(e){this.mode=n.ALPHANUMERIC,this.data=e}i.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=r.indexOf(this.data[t])*45;n+=r.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(r.indexOf(this.data[t]),6)},t.exports=i})),SF=o(((e,t)=>{var n=_F();function r(e){this.mode=n.BYTE,typeof e==`string`?this.data=new TextEncoder().encode(e):this.data=new Uint8Array(e)}r.getBitsLength=function(e){return e*8},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},t.exports=r})),CF=o(((e,t)=>{var n=_F(),r=iF();function i(e){this.mode=n.KANJI,this.data=e}i.getBitsLength=function(e){return e*13},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=r.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw Error(`Invalid SJIS character: `+this.data[t]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),e.put(n,13)}},t.exports=i})),wF=o(((e,t)=>{var n={single_source_shortest_paths:function(e,t,r){var i={},a={};a[t]=0;var o=n.PriorityQueue.make();o.push(t,0);for(var s,c,l,u,d,f,p,m,h;!o.empty();)for(l in s=o.pop(),c=s.value,u=s.cost,d=e[c]||{},d)d.hasOwnProperty(l)&&(f=d[l],p=u+f,m=a[l],h=a[l]===void 0,(h||m>p)&&(a[l]=p,o.push(l,p),i[l]=c));if(r!==void 0&&a[r]===void 0){var g=[`Could not find a path from `,t,` to `,r,`.`].join(``);throw Error(g)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(e,t,r){var i=n.single_source_shortest_paths(e,t,r);return n.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(e){var t=n.PriorityQueue,r={},i;for(i in e||={},t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r.queue=[],r.sorter=e.sorter||t.default_sorter,r},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t!==void 0&&(t.exports=n)})),TF=o((e=>{var t=_F(),n=bF(),r=xF(),i=SF(),a=CF(),o=gF(),s=iF(),c=wF();function l(e){return unescape(encodeURIComponent(e)).length}function u(e,t,n){let r=[],i;for(;(i=e.exec(n))!==null;)r.push({data:i[0],index:i.index,mode:t,length:i[0].length});return r}function d(e){let n=u(o.NUMERIC,t.NUMERIC,e),r=u(o.ALPHANUMERIC,t.ALPHANUMERIC,e),i,a;return s.isKanjiModeEnabled()?(i=u(o.BYTE,t.BYTE,e),a=u(o.KANJI,t.KANJI,e)):(i=u(o.BYTE_KANJI,t.BYTE,e),a=[]),n.concat(r,i,a).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function f(e,o){switch(o){case t.NUMERIC:return n.getBitsLength(e);case t.ALPHANUMERIC:return r.getBitsLength(e);case t.KANJI:return a.getBitsLength(e);case t.BYTE:return i.getBitsLength(e)}}function p(e){return e.reduce(function(e,t){let n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}function m(e){let n=[];for(let r=0;r<e.length;r++){let i=e[r];switch(i.mode){case t.NUMERIC:n.push([i,{data:i.data,mode:t.ALPHANUMERIC,length:i.length},{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.ALPHANUMERIC:n.push([i,{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.KANJI:n.push([i,{data:i.data,mode:t.BYTE,length:l(i.data)}]);break;case t.BYTE:n.push([{data:i.data,mode:t.BYTE,length:l(i.data)}])}}return n}function h(e,n){let r={},i={start:{}},a=[`start`];for(let o=0;o<e.length;o++){let s=e[o],c=[];for(let e=0;e<s.length;e++){let l=s[e],u=``+o+e;c.push(u),r[u]={node:l,lastCount:0},i[u]={};for(let e=0;e<a.length;e++){let o=a[e];r[o]&&r[o].node.mode===l.mode?(i[o][u]=f(r[o].lastCount+l.length,l.mode)-f(r[o].lastCount,l.mode),r[o].lastCount+=l.length):(r[o]&&(r[o].lastCount=l.length),i[o][u]=f(l.length,l.mode)+4+t.getCharCountIndicator(l.mode,n))}}a=c}for(let e=0;e<a.length;e++)i[a[e]].end=0;return{map:i,table:r}}function g(e,o){let c,l=t.getBestModeForData(e);if(c=t.from(o,l),c!==t.BYTE&&c.bit<l.bit)throw Error(`"`+e+`" cannot be encoded with mode `+t.toString(c)+`.
 Suggested mode is: `+t.toString(l));switch(c===t.KANJI&&!s.isKanjiModeEnabled()&&(c=t.BYTE),c){case t.NUMERIC:return new n(e);case t.ALPHANUMERIC:return new r(e);case t.KANJI:return new a(e);case t.BYTE:return new i(e)}}e.fromArray=function(e){return e.reduce(function(e,t){return typeof t==`string`?e.push(g(t,null)):t.data&&e.push(g(t.data,t.mode)),e},[])},e.fromString=function(t,n){let r=d(t,s.isKanjiModeEnabled()),i=m(r),a=h(i,n),o=c.find_path(a.map,`start`,`end`),l=[];for(let e=1;e<o.length-1;e++)l.push(a.table[o[e]].node);return e.fromArray(p(l))},e.rawSplit=function(t){return e.fromArray(d(t,s.isKanjiModeEnabled()))}})),EF=o((e=>{var t=iF(),n=aF(),r=oF(),i=sF(),a=cF(),o=lF(),s=uF(),c=dF(),l=mF(),u=vF(),d=yF(),f=_F(),p=TF();function m(e,t){let n=e.size,r=o.getPositions(t);for(let t=0;t<r.length;t++){let i=r[t][0],a=r[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1||n<=i+t))for(let r=-1;r<=7;r++)a+r<=-1||n<=a+r||(t>=0&&t<=6&&(r===0||r===6)||r>=0&&r<=6&&(t===0||t===6)||t>=2&&t<=4&&r>=2&&r<=4?e.set(i+t,a+r,!0,!0):e.set(i+t,a+r,!1,!0))}}function h(e){let t=e.size;for(let n=8;n<t-8;n++){let t=n%2==0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}function g(e,t){let n=a.getPositions(t);for(let t=0;t<n.length;t++){let r=n[t][0],i=n[t][1];for(let t=-2;t<=2;t++)for(let n=-2;n<=2;n++)t===-2||t===2||n===-2||n===2||t===0&&n===0?e.set(r+t,i+n,!0,!0):e.set(r+t,i+n,!1,!0)}}function _(e,t){let n=e.size,r=u.getEncodedBits(t),i,a,o;for(let t=0;t<18;t++)i=Math.floor(t/3),a=t%3+n-8-3,o=(r>>t&1)==1,e.set(i,a,o,!0),e.set(a,i,o,!0)}function v(e,t,n){let r=e.size,i=d.getEncodedBits(t,n),a,o;for(a=0;a<15;a++)o=(i>>a&1)==1,a<6?e.set(a,8,o,!0):a<8?e.set(a+1,8,o,!0):e.set(r-15+a,8,o,!0),a<8?e.set(8,r-a-1,o,!0):a<9?e.set(8,15-a-1+1,o,!0):e.set(8,15-a-1,o,!0);e.set(r-8,8,1,!0)}function y(e,t){let n=e.size,r=-1,i=n-1,a=7,o=0;for(let s=n-1;s>0;s-=2)for(s===6&&s--;;){for(let n=0;n<2;n++)if(!e.isReserved(i,s-n)){let r=!1;o<t.length&&(r=(t[o]>>>a&1)==1),e.set(i,s-n,r),a--,a===-1&&(o++,a=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}function b(e,n,i){let a=new r;i.forEach(function(t){a.put(t.mode.bit,4),a.put(t.getLength(),f.getCharCountIndicator(t.mode,e)),t.write(a)});let o=t.getSymbolTotalCodewords(e),s=c.getTotalCodewordsCount(e,n),l=(o-s)*8;for(a.getLengthInBits()+4<=l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(0);let u=(l-a.getLengthInBits())/8;for(let e=0;e<u;e++)a.put(e%2?17:236,8);return x(a,e,n)}function x(e,n,r){let i=t.getSymbolTotalCodewords(n),a=c.getTotalCodewordsCount(n,r),o=i-a,s=c.getBlocksCount(n,r),u=i%s,d=s-u,f=Math.floor(i/s),p=Math.floor(o/s),m=p+1,h=f-p,g=new l(h),_=0,v=Array(s),y=Array(s),b=0,x=new Uint8Array(e.buffer);for(let e=0;e<s;e++){let t=e<d?p:m;v[e]=x.slice(_,_+t),y[e]=g.encode(v[e]),_+=t,b=Math.max(b,t)}let S=new Uint8Array(i),C=0,w,T;for(w=0;w<b;w++)for(T=0;T<s;T++)w<v[T].length&&(S[C++]=v[T][w]);for(w=0;w<h;w++)for(T=0;T<s;T++)S[C++]=y[T][w];return S}function S(e,n,r,a){let o;if(Array.isArray(e))o=p.fromArray(e);else if(typeof e==`string`){let t=n;if(!t){let n=p.rawSplit(e);t=u.getBestVersionForData(n,r)}o=p.fromString(e,t||40)}else throw Error(`Invalid data`);let c=u.getBestVersionForData(o,r);if(!c)throw Error(`The amount of data is too big to be stored in a QR Code`);if(!n)n=c;else if(n<c)throw Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+c+`.
`);let l=b(n,r,o),d=t.getSymbolSize(n),f=new i(d);return m(f,n),h(f),g(f,n),v(f,r,0),n>=7&&_(f,n),y(f,l),isNaN(a)&&(a=s.getBestMask(f,v.bind(null,f,r))),s.applyMask(a,f),v(f,r,a),{modules:f,version:n,errorCorrectionLevel:r,maskPattern:a,segments:o}}e.create=function(e,r){if(e===void 0||e===``)throw Error(`No input text`);let i=n.M,a,o;return r!==void 0&&(i=n.from(r.errorCorrectionLevel,n.M),a=u.from(r.version),o=s.from(r.maskPattern),r.toSJISFunc&&t.setToSJISFunction(r.toSJISFunc)),S(e,a,i,o)}})),DF=o((e=>{function t(e){if(typeof e==`number`&&(e=e.toString()),typeof e!=`string`)throw Error(`Color should be defined as hex string`);let t=e.slice().replace(`#`,``).split(``);if(t.length<3||t.length===5||t.length>8)throw Error(`Invalid hex color: `+e);(t.length===3||t.length===4)&&(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),t.length===6&&t.push(`F`,`F`);let n=parseInt(t.join(``),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:`#`+t.slice(0,6).join(``)}}e.getOptions=function(e){e||={},e.color||={};let n=e.margin===void 0||e.margin===null||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:r,scale:r?4:i,margin:n,color:{dark:t(e.color.dark||`#000000ff`),light:t(e.color.light||`#ffffffff`)},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+t.margin*2?t.width/(e+t.margin*2):t.scale},e.getImageWidth=function(t,n){let r=e.getScale(t,n);return Math.floor((t+n.margin*2)*r)},e.qrToImageData=function(t,n,r){let i=n.modules.size,a=n.modules.data,o=e.getScale(i,r),s=Math.floor((i+r.margin*2)*o),c=r.margin*o,l=[r.color.light,r.color.dark];for(let e=0;e<s;e++)for(let n=0;n<s;n++){let u=(e*s+n)*4,d=r.color.light;if(e>=c&&n>=c&&e<s-c&&n<s-c){let t=Math.floor((e-c)/o),r=Math.floor((n-c)/o);d=l[a[t*i+r]?1:0]}t[u++]=d.r,t[u++]=d.g,t[u++]=d.b,t[u]=d.a}}})),OF=o((e=>{var t=DF();function n(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||={},t.height=n,t.width=n,t.style.height=n+`px`,t.style.width=n+`px`}function r(){try{return document.createElement(`canvas`)}catch{throw Error(`You need to specify a canvas element`)}}e.render=function(e,i,a){let o=a,s=i;o===void 0&&(!i||!i.getContext)&&(o=i,i=void 0),i||(s=r()),o=t.getOptions(o);let c=t.getImageWidth(e.modules.size,o),l=s.getContext(`2d`),u=l.createImageData(c,c);return t.qrToImageData(u.data,e,o),n(l,s,c),l.putImageData(u,0,0),s},e.renderToDataURL=function(t,n,r){let i=r;i===void 0&&(!n||!n.getContext)&&(i=n,n=void 0),i||={};let a=e.render(t,n,i),o=i.type||`image/png`,s=i.rendererOpts||{};return a.toDataURL(o,s.quality)}})),kF=o((e=>{var t=DF();function n(e,t){let n=e.a/255,r=t+`="`+e.hex+`"`;return n<1?r+` `+t+`-opacity="`+n.toFixed(2).slice(1)+`"`:r}function r(e,t,n){let r=e+t;return n!==void 0&&(r+=` `+n),r}function i(e,t,n){let i=``,a=0,o=!1,s=0;for(let c=0;c<e.length;c++){let l=Math.floor(c%t),u=Math.floor(c/t);!l&&!o&&(o=!0),e[c]?(s++,c>0&&l>0&&e[c-1]||(i+=o?r(`M`,l+n,.5+u+n):r(`m`,a,0),a=0,o=!1),l+1<t&&e[c+1]||(i+=r(`h`,s),s=0)):a++}return i}e.render=function(e,r,a){let o=t.getOptions(r),s=e.modules.size,c=e.modules.data,l=s+o.margin*2,u=o.color.light.a?`<path `+n(o.color.light,`fill`)+` d="M0 0h`+l+`v`+l+`H0z"/>`:``,d=`<path `+n(o.color.dark,`stroke`)+` d="`+i(c,s,o.margin)+`"/>`,f=`viewBox="0 0 `+l+` `+l+`"`,p=`<svg xmlns="http://www.w3.org/2000/svg" `+(o.width?`width="`+o.width+`" height="`+o.width+`" `:``)+f+` shape-rendering="crispEdges">`+u+d+`</svg>
`;return typeof a==`function`&&a(null,p),p}})),AF=l(o((e=>{var t=rF(),n=EF(),r=OF(),i=kF();function a(e,r,i,a,o){let s=[].slice.call(arguments,1),c=s.length,l=typeof s[c-1]==`function`;if(!l&&!t())throw Error(`Callback required as last argument`);if(l){if(c<2)throw Error(`Too few arguments provided`);c===2?(o=i,i=r,r=a=void 0):c===3&&(r.getContext&&o===void 0?(o=a,a=void 0):(o=a,a=i,i=r,r=void 0))}else{if(c<1)throw Error(`Too few arguments provided`);return c===1?(i=r,r=a=void 0):c===2&&!r.getContext&&(a=i,i=r,r=void 0),new Promise(function(t,o){try{let o=n.create(i,a);t(e(o,r,a))}catch(e){o(e)}})}try{let t=n.create(i,a);o(null,e(t,r,a))}catch(e){o(e)}}e.create=n.create,e.toCanvas=a.bind(null,r.render),e.toDataURL=a.bind(null,r.renderToDataURL),e.toString=a.bind(null,function(e,t,n){return i.render(e,n)})}))());function jF(){let[e,t]=(0,y.useState)({}),[n,r]=(0,y.useState)(!0),i=(0,y.useCallback)(async()=>{try{r(!0);let e=await Dj();t(e)}catch(e){console.error(`[useContacts] Failed to load contacts:`,e)}finally{r(!1)}},[]);(0,y.useEffect)(()=>{i()},[i]);let a=(0,y.useCallback)(async(e,t)=>{try{await wj(e,t),await i()}catch(e){throw console.error(`[useContacts] Failed to upsert contact:`,e),e}},[i]),o=(0,y.useCallback)(async e=>{try{let n=e?.toLowerCase();n&&t(t=>{let r={...t};return delete r[n],delete r[e],r}),await Ej(e),await i()}catch(e){throw console.error(`[useContacts] Failed to delete contact:`,e),await i(),e}},[i]);return{contacts:e,loading:n,upsert:a,remove:o,refresh:i}}function MF({pubkey:e,name:t,onClose:n,open:r=!0,ownPubkey:i,ownName:a=`You`,inviteProfile:o=null}){let{upsert:s}=jF(),[c,l]=(0,y.useState)(``),[u,d]=(0,y.useState)(!1),[f,p]=(0,y.useState)(null),[m,h]=(0,y.useState)(!1),[g,_]=(0,y.useState)(!1),[v,b]=(0,y.useState)(null);(0,y.useEffect)(()=>{r&&o?console.log(`[VerifyDialog] Opened with inviteProfile:`,o):r&&console.log(`[VerifyDialog] Opened without inviteProfile`)},[r,o]);let x=e?hj(e):null,S=i?hj(i):null;if((0,y.useEffect)(()=>{async function e(){try{if(S){let e=await AF.toDataURL(S,{width:180,margin:2,color:{dark:`#000000`,light:`#FFFFFF`}});b(e)}else b(null)}catch(e){console.error(`[VerifyDialog] Failed to generate QR code:`,e)}}e()},[S]),!e||!r)return null;let C=async()=>{try{await navigator.clipboard.writeText(S),_(!0),setTimeout(()=>_(!1),2e3)}catch(e){console.error(`[VerifyDialog] Failed to copy own:`,e)}},w=async()=>{if(console.log(`[VerifyDialog] VERIFY BUTTON CLICKED`,{pubkey:e?.slice(0,16)+`...`,manualInput:c?.slice(0,20)+`...`,safetyTheirsPreview:x?.slice(0,20)+`...`}),!c.trim()){p(`Please enter the safety number from `+t+` to verify`);return}d(!0),p(null);try{let t=gj(x,c);if(console.log(`[VerifyDialog] Safety numbers match:`,t),t){let t={verified:!0,verifiedSafetyNumber:x,verifiedAt:new Date().toISOString()};if(console.log(`[VerifyDialog] Marking contact as verified, inviteProfile:`,o),o&&o.displayName){t.displayName=o.displayName,t.avatarHash=o.avatarHash||null,t.source=`verified-profile`,console.log(`[VerifyDialog] Adding profile to contact update:`,t);try{await $A(e,{displayName:o.displayName,avatarHash:o.avatarHash}),console.log(`[VerifyDialog] Auto-populated profile from invite:`,o.displayName)}catch(e){console.warn(`[VerifyDialog] Failed to store profile:`,e)}}console.log(`[VerifyDialog] Upserting contact with:`,t),await s(e,t),console.log(`[VerifyDialog] Contact upserted successfully`),h(!0),setTimeout(()=>{n()},1500)}else console.log(`[VerifyDialog] Safety numbers DO NOT match - marking as unverified`),await s(e,{verified:!1}),p(`Safety numbers do not match. Contact marked as unverified.`)}catch(e){p(`Verification failed: `+e.message)}finally{d(!1)}};return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`div`,{className:`fixed inset-0 z-[2000] bg-black/50`,onClick:n,"aria-hidden":`true`}),(0,Z.jsxs)(`div`,{className:`fixed left-1/2 top-1/2 z-[2001] flex w-full max-w-[900px] -translate-x-1/2 -translate-y-1/2 flex-col rounded-lg bg-background shadow-xl`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between border-b border-border px-4 py-4`,children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold`,children:`Verify Identity`}),(0,Z.jsx)($,{variant:`ghost`,size:`icon`,onClick:n,className:`h-8 w-8`,children:(0,Z.jsx)(Bb,{className:`h-4 w-4`})})]}),(0,Z.jsxs)(`div`,{className:`max-h-[75vh] overflow-y-auto p-6`,children:[(0,Z.jsxs)(`p`,{className:`mb-6 text-sm text-muted-foreground`,children:[`Exchange your safety numbers with `,(0,Z.jsx)(`strong`,{children:t}),` by sending them through a trusted channel (such as secure messaging or a screenshot) instead of this app for added security. Your safety number is listed below, and `,(0,Z.jsx)(`strong`,{children:t}),` has a different one. Share numbers and enter `,(0,Z.jsx)(`strong`,{children:t}),`'s safety number in the confirmation box below. If anything about their identity changes, their safety number will change and you should verify again. If this safety number ever changes on this device, you'll see a security warning in this chat and should verify again.`]}),(0,Z.jsxs)(`div`,{className:`mb-6 rounded-lg border border-border p-4`,children:[(0,Z.jsx)(`h3`,{className:`mb-3 text-base font-semibold text-foreground`,children:`Your Safety Number`}),(0,Z.jsxs)(`div`,{className:`relative mb-4 rounded-lg bg-muted p-3`,children:[(0,Z.jsx)(`div`,{className:`break-all font-mono text-[11px] leading-relaxed`,children:S||`Not available`}),S&&(0,Z.jsx)($,{variant:`ghost`,size:`sm`,onClick:C,className:`absolute right-2 top-2 h-7 w-7 p-0`,title:`Copy your safety number`,children:g?(0,Z.jsx)(ub,{className:`h-3 w-3 text-green-500`}):(0,Z.jsx)(mb,{className:`h-3 w-3`})})]}),(0,Z.jsx)(`div`,{className:`flex justify-center rounded-lg border border-border bg-white p-3`,children:v?(0,Z.jsx)(`img`,{src:v,alt:`Your Safety Number QR`,className:`h-[180px] w-[180px]`}):(0,Z.jsx)(`div`,{className:`flex h-[180px] w-[180px] items-center justify-center text-xs text-muted-foreground`,children:S?`Generating...`:`Not available`})}),(0,Z.jsxs)(`p`,{className:`mt-2 text-xs text-muted-foreground text-center`,children:[`Show this QR to `,t,` so they can scan and confirm.`]})]}),(0,Z.jsxs)(`div`,{className:`mt-6`,children:[(0,Z.jsx)(`h3`,{className:`mb-2 text-sm font-semibold`,children:`Confirm Verification`}),(0,Z.jsxs)(`p`,{className:`mb-2 text-sm text-muted-foreground`,children:[`After comparing numbers, enter what `,t,` told you to confirm:`]}),(0,Z.jsx)(GP,{value:c,onChange:e=>l(e.target.value),placeholder:`Paste or type ${t}'s safety number here`,rows:3,className:`font-mono text-xs`}),f&&(0,Z.jsx)(`div`,{className:`mt-2 rounded-lg border border-destructive bg-destructive/10 p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm text-destructive`,children:f})}),m&&(0,Z.jsx)(`div`,{className:`mt-2 rounded-lg border border-green-500 bg-green-500/10 p-3`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 text-sm text-green-600 dark:text-green-400`,children:[(0,Z.jsx)(lb,{className:`h-4 w-4`}),(0,Z.jsx)(`span`,{children:`Safety number verified! Identity confirmed.`})]})})]}),(0,Z.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Z.jsx)($,{onClick:w,disabled:u||!c.trim()||m,className:`flex-1`,children:u?`Verifying...`:m?`Verified!`:`Verify`}),(0,Z.jsx)($,{variant:`outline`,onClick:n,className:`flex-1`,children:m?`Done`:`Skip for Now`})]})]})]})]})}function NF({thread:e,messages:t,participantPubKey:n,onSendMessage:r,onShowDetails:i,onUpgrade:a,onAction:o,onTyping:s,onGenerateInvite:c,isTyping:l=!1,upgradePending:u=!1,sendOnEnter:d=!1,onSatsSent:f}){let p=e?.guestMode||!1,m=e?.status||`ready`,h=m===`blocked`||e?.blocked,g=m===`burned`,_=m===`pending`,v=e?.peerLeft===!0,b=!e||_||g||h||v,[x,S]=(0,y.useState)(!1),[C,w]=(0,y.useState)(!1),[T,E]=(0,y.useState)(!1),[D,O]=(0,y.useState)(!1),k=(()=>{if(!e)return null;let t=e.ctTxid||e?.ctOutpoint?.txid||null;if(!t)return null;let n=Number.isInteger(e.ctVout)?e.ctVout:Number.isInteger(e?.ctOutpoint?.vout)?e.ctOutpoint.vout:0;return{txid:t,vout:n}})(),A=k?`${k.txid}:${k.vout}`:null;e?.mintedAt&&new Date(e.mintedAt).toLocaleString();let ee=e?.peerKind||(p?`holder`:`guest`),te=e?.peerPublicKey||null,{identity:ne,loading:j}=kj(te,ee),{upsert:M}=jF(),{addNotification:re}=Gy(),ie=ne?.name||`Guest`,ae=(0,y.useMemo)(()=>Array.isArray(t)?t.some(e=>typeof e?.text==`string`&&e.text.startsWith(`[JOINED]`)):!1,[t]);return(0,y.useEffect)(()=>{if(e&&p&&e.id&&!ae)try{e.selfPublicKey,r?.(`[JOINED]`)}catch(e){console.warn(`[ThreadView] Failed to post join system message`,e)}},[e,p,ae,n,r]),(0,Z.jsxs)(`section`,{className:`flex h-full flex-1 flex-col`,children:[(0,Z.jsx)(MP,{thread:e,identity:ne,identityLoading:j,onShowDetails:()=>S(!0),onAction:o,onUpgrade:a,onOpenContact:()=>w(!0)}),_&&(0,Z.jsx)(`div`,{className:`border-b border-muted-foreground/10 bg-muted/30 px-4 py-2 text-xs text-muted-foreground`,children:`Invite pending. Messages will appear after both parties accept.`}),(0,Z.jsx)(WP,{messages:t,participantPubKey:n,dimmed:g,showTypingIndicator:!g&&!_&&!v&&l,onOpenSatsSupport:()=>S(!0),onSendSats:async t=>{let n=e?.peerWalletPublicKey||null;if(!n){re({type:`error`,message:`This contact has not linked a wallet yet.`,duration:6e3});return}if(!Number.isFinite(t)||t<=0){re({type:`error`,message:`Invalid amount.`,duration:5e3});return}O(!0);try{re({type:`success`,message:`Bitcoin payment created. Your wallet will ask for confirmation.`,duration:8e3}),await By({identityKey:n,amountSats:t}),typeof f==`function`&&f(t)}catch(e){console.error(`[ThreadView] Failed to send sats`,e),re({type:`error`,message:QP(e,{context:`send payment`}),duration:8e3})}finally{O(!1)}},peerName:ie,isSendingSats:D}),v&&(0,Z.jsxs)(`div`,{className:`border-t border-muted-foreground/10 bg-muted/30 px-4 py-2 text-xs text-muted-foreground`,children:[(0,Z.jsx)(`span`,{className:`font-semibold text-foreground`,children:ie}),` `,`deleted local data and left the chat.`]}),g?(0,Z.jsx)(`div`,{className:`border-t border-border bg-background/95 px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{className:`space-y-1 text-xs text-muted-foreground`,children:[(0,Z.jsx)(`p`,{className:`text-sm font-semibold text-foreground`,children:`Conversation burned.`}),(0,Z.jsx)(`p`,{children:`This conversation's on-chain access token was destroyed and the data tied to it was permanently deleted.`}),(0,Z.jsxs)(`p`,{children:[`Burned by `,(0,Z.jsx)(`span`,{className:`font-medium text-foreground`,children:e?.burnedBy||`peer`}),` on`,` `,(0,Z.jsx)(`span`,{className:`font-medium text-foreground`,children:e?.burnedAt?new Date(e.burnedAt).toLocaleString():`unknown time`})]}),A&&(0,Z.jsxs)(`p`,{className:`flex flex-wrap items-center gap-2`,children:[(0,Z.jsx)(`span`,{children:`Burned thread access token:`}),(0,Z.jsx)(`code`,{className:`rounded bg-muted/60 px-1 font-mono text-[11px]`,children:A}),(0,Z.jsx)($,{size:`xs`,variant:`ghost`,onClick:()=>{A&&navigator?.clipboard?.writeText(A).catch(()=>{})},children:`Copy`})]}),e?.burnTxid&&(0,Z.jsxs)(`p`,{children:[`Burn transaction:`,` `,(0,Z.jsx)(`code`,{className:`rounded bg-muted/60 px-1 font-mono text-[11px]`,children:e.burnTxid})]})]}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>o?.(`leave`),children:`Dismiss stub`})]})}):h?(0,Z.jsx)(`div`,{className:`border-t border-border bg-background/95 px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`text-sm font-semibold text-foreground`,children:`Thread blocked.`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Messaging is disabled until the inviter unblocks this session.`})]}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>o?.(`leave`),children:`Leave thread`})]})}):_?(0,Z.jsx)(`div`,{className:`border-t border-border bg-background/95 px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`text-sm font-semibold text-foreground`,children:`Waiting for acceptance`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`You can leave this thread anytime while its pending.`})]}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>o?.(`leave`),children:`Leave thread`})]})}):(0,Z.jsx)(qP,{disabled:b,guestMode:p,onSend:r,onUpgrade:a,onTyping:s,upgradePending:u,sendOnEnter:d}),(0,Z.jsx)(tF,{open:x,onOpenChange:S,thread:e,onGenerateInvite:c,onSatsSent:f}),(0,Z.jsx)(nF,{pubkey:te,identity:ne,onClose:()=>w(!1),onVerify:()=>{w(!1),E(!0)},onBlock:()=>o?.(`block`),open:C}),(0,Z.jsx)(MF,{pubkey:te,name:ne?.name||`Contact`,ownPubkey:n,ownName:`You`,onClose:()=>E(!1),open:T,inviteProfile:e?.inviterProfile||null})]})}var PF=Object.defineProperty,FF=Object.getOwnPropertySymbols,IF=Object.prototype.hasOwnProperty,LF=Object.prototype.propertyIsEnumerable,RF=(e,t,n)=>t in e?PF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zF=(e,t)=>{for(var n in t||={})IF.call(t,n)&&RF(e,n,t[n]);if(FF)for(var n of FF(t))LF.call(t,n)&&RF(e,n,t[n]);return e},BF=(e,t)=>{var n={};for(var r in e)IF.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&FF)for(var r of FF(e))t.indexOf(r)<0&&LF.call(e,r)&&(n[r]=e[r]);return n},VF;(e=>{let t=class t{constructor(e,n,r,a){if(this.version=e,this.errorCorrectionLevel=n,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw RangeError(`Version value out of range`);if(a<-1||a>7)throw RangeError(`Mask value out of range`);this.size=e*4+17;let o=[];for(let e=0;e<this.size;e++)o.push(!1);for(let e=0;e<this.size;e++)this.modules.push(o.slice()),this.isFunction.push(o.slice());this.drawFunctionPatterns();let s=this.addEccAndInterleave(r);if(this.drawCodewords(s),a==-1){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);let n=this.getPenaltyScore();n<e&&(a=t,e=n),this.applyMask(t)}}i(0<=a&&a<=7),this.mask=a,this.applyMask(a),this.drawFormatBits(a),this.isFunction=[]}static encodeText(n,r){let i=e.QrSegment.makeSegments(n);return t.encodeSegments(i,r)}static encodeBinary(n,r){let i=e.QrSegment.makeBytes(n);return t.encodeSegments([i],r)}static encodeSegments(e,r,a=1,s=40,c=-1,l=!0){if(!(t.MIN_VERSION<=a&&a<=s&&s<=t.MAX_VERSION)||c<-1||c>7)throw RangeError(`Invalid value`);let u,d;for(u=a;;u++){let n=t.getNumDataCodewords(u,r)*8,i=o.getTotalBits(e,u);if(i<=n){d=i;break}if(u>=s)throw RangeError(`Data too long`)}for(let e of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])l&&d<=t.getNumDataCodewords(u,e)*8&&(r=e);let f=[];for(let t of e){n(t.mode.modeBits,4,f),n(t.numChars,t.mode.numCharCountBits(u),f);for(let e of t.getData())f.push(e)}i(f.length==d);let p=t.getNumDataCodewords(u,r)*8;i(f.length<=p),n(0,Math.min(4,p-f.length),f),n(0,(8-f.length%8)%8,f),i(f.length%8==0);for(let e=236;f.length<p;e^=253)n(e,8,f);let m=[];for(;m.length*8<f.length;)m.push(0);return f.forEach((e,t)=>m[t>>>3]|=e<<7-(t&7)),new t(u,r,m,c)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);let e=this.getAlignmentPatternPositions(),t=e.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)n==0&&r==0||n==0&&r==t-1||n==t-1&&r==0||this.drawAlignmentPattern(e[n],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){let t=this.errorCorrectionLevel.formatBits<<3|e,n=t;for(let e=0;e<10;e++)n=n<<1^(n>>>9)*1335;let a=(t<<10|n)^21522;i(a>>>15==0);for(let e=0;e<=5;e++)this.setFunctionModule(8,e,r(a,e));this.setFunctionModule(8,7,r(a,6)),this.setFunctionModule(8,8,r(a,7)),this.setFunctionModule(7,8,r(a,8));for(let e=9;e<15;e++)this.setFunctionModule(14-e,8,r(a,e));for(let e=0;e<8;e++)this.setFunctionModule(this.size-1-e,8,r(a,e));for(let e=8;e<15;e++)this.setFunctionModule(8,this.size-15+e,r(a,e));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;let t=this.version<<12|e;i(t>>>18==0);for(let e=0;e<18;e++){let n=r(t,e),i=this.size-11+e%3,a=Math.floor(e/3);this.setFunctionModule(i,a,n),this.setFunctionModule(a,i,n)}}drawFinderPattern(e,t){for(let n=-4;n<=4;n++)for(let r=-4;r<=4;r++){let i=Math.max(Math.abs(r),Math.abs(n)),a=e+r,o=t+n;0<=a&&a<this.size&&0<=o&&o<this.size&&this.setFunctionModule(a,o,i!=2&&i!=4)}}drawAlignmentPattern(e,t){for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,t+n,Math.max(Math.abs(r),Math.abs(n))!=1)}setFunctionModule(e,t,n){this.modules[t][e]=n,this.isFunction[t][e]=!0}addEccAndInterleave(e){let n=this.version,r=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(n,r))throw RangeError(`Invalid argument`);let a=t.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][n],o=t.ECC_CODEWORDS_PER_BLOCK[r.ordinal][n],s=Math.floor(t.getNumRawDataModules(n)/8),c=a-s%a,l=Math.floor(s/a),u=[],d=t.reedSolomonComputeDivisor(o);for(let n=0,r=0;n<a;n++){let i=e.slice(r,r+l-o+(n<c?0:1));r+=i.length;let a=t.reedSolomonComputeRemainder(i,d);n<c&&i.push(0),u.push(i.concat(a))}let f=[];for(let e=0;e<u[0].length;e++)u.forEach((t,n)=>{(e!=l-o||n>=c)&&f.push(t[e])});return i(f.length==s),f}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw RangeError(`Invalid argument`);let n=0;for(let t=this.size-1;t>=1;t-=2){t==6&&(t=5);for(let i=0;i<this.size;i++)for(let a=0;a<2;a++){let o=t-a,s=t+1&2?i:this.size-1-i;!this.isFunction[s][o]&&n<e.length*8&&(this.modules[s][o]=r(e[n>>>3],7-(n&7)),n++)}}i(n==e.length*8)}applyMask(e){if(e<0||e>7)throw RangeError(`Mask value out of range`);for(let t=0;t<this.size;t++)for(let n=0;n<this.size;n++){let r;switch(e){case 0:r=(n+t)%2==0;break;case 1:r=t%2==0;break;case 2:r=n%3==0;break;case 3:r=(n+t)%3==0;break;case 4:r=(Math.floor(n/3)+Math.floor(t/2))%2==0;break;case 5:r=n*t%2+n*t%3==0;break;case 6:r=(n*t%2+n*t%3)%2==0;break;case 7:r=((n+t)%2+n*t%3)%2==0;break;default:throw Error(`Unreachable`)}!this.isFunction[t][n]&&r&&(this.modules[t][n]=!this.modules[t][n])}}getPenaltyScore(){let e=0;for(let n=0;n<this.size;n++){let r=!1,i=0,a=[0,0,0,0,0,0,0];for(let o=0;o<this.size;o++)this.modules[n][o]==r?(i++,i==5?e+=t.PENALTY_N1:i>5&&e++):(this.finderPenaltyAddHistory(i,a),r||(e+=this.finderPenaltyCountPatterns(a)*t.PENALTY_N3),r=this.modules[n][o],i=1);e+=this.finderPenaltyTerminateAndCount(r,i,a)*t.PENALTY_N3}for(let n=0;n<this.size;n++){let r=!1,i=0,a=[0,0,0,0,0,0,0];for(let o=0;o<this.size;o++)this.modules[o][n]==r?(i++,i==5?e+=t.PENALTY_N1:i>5&&e++):(this.finderPenaltyAddHistory(i,a),r||(e+=this.finderPenaltyCountPatterns(a)*t.PENALTY_N3),r=this.modules[o][n],i=1);e+=this.finderPenaltyTerminateAndCount(r,i,a)*t.PENALTY_N3}for(let n=0;n<this.size-1;n++)for(let r=0;r<this.size-1;r++){let i=this.modules[n][r];i==this.modules[n][r+1]&&i==this.modules[n+1][r]&&i==this.modules[n+1][r+1]&&(e+=t.PENALTY_N2)}let n=0;for(let e of this.modules)n=e.reduce((e,t)=>e+(t?1:0),n);let r=this.size*this.size,a=Math.ceil(Math.abs(n*20-r*10)/r)-1;return i(0<=a&&a<=9),e+=a*t.PENALTY_N4,i(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(this.version==1)return[];{let e=Math.floor(this.version/7)+2,t=this.version==32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,n=[6];for(let r=this.size-7;n.length<e;r-=t)n.splice(1,0,r);return n}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw RangeError(`Version number out of range`);let n=(16*e+128)*e+64;if(e>=2){let t=Math.floor(e/7)+2;n-=(25*t-10)*t-55,e>=7&&(n-=36)}return i(208<=n&&n<=29648),n}static getNumDataCodewords(e,n){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[n.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw RangeError(`Degree out of range`);let n=[];for(let t=0;t<e-1;t++)n.push(0);n.push(1);let r=1;for(let i=0;i<e;i++){for(let e=0;e<n.length;e++)n[e]=t.reedSolomonMultiply(n[e],r),e+1<n.length&&(n[e]^=n[e+1]);r=t.reedSolomonMultiply(r,2)}return n}static reedSolomonComputeRemainder(e,n){let r=n.map(e=>0);for(let i of e){let e=i^r.shift();r.push(0),n.forEach((n,i)=>r[i]^=t.reedSolomonMultiply(n,e))}return r}static reedSolomonMultiply(e,t){if(e>>>8||t>>>8)throw RangeError(`Byte out of range`);let n=0;for(let r=7;r>=0;r--)n=n<<1^(n>>>7)*285,n^=(t>>>r&1)*e;return i(n>>>8==0),n}finderPenaltyCountPatterns(e){let t=e[1];i(t<=this.size*3);let n=t>0&&e[2]==t&&e[3]==t*3&&e[4]==t&&e[5]==t;return(n&&e[0]>=t*4&&e[6]>=t?1:0)+(n&&e[6]>=t*4&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,n){return e&&(this.finderPenaltyAddHistory(t,n),t=0),t+=this.size,this.finderPenaltyAddHistory(t,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,t){t[0]==0&&(e+=this.size),t.pop(),t.unshift(e)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=t;function n(e,t,n){if(t<0||t>31||e>>>t)throw RangeError(`Value out of range`);for(let r=t-1;r>=0;r--)n.push(e>>>r&1)}function r(e,t){return(e>>>t&1)!=0}function i(e){if(!e)throw Error(`Assertion error`)}let a=class e{constructor(e,t,n){if(this.mode=e,this.numChars=t,this.bitData=n,t<0)throw RangeError(`Invalid argument`);this.bitData=n.slice()}static makeBytes(t){let r=[];for(let e of t)n(e,8,r);return new e(e.Mode.BYTE,t.length,r)}static makeNumeric(t){if(!e.isNumeric(t))throw RangeError(`String contains non-numeric characters`);let r=[];for(let e=0;e<t.length;){let i=Math.min(t.length-e,3);n(parseInt(t.substring(e,e+i),10),i*3+1,r),e+=i}return new e(e.Mode.NUMERIC,t.length,r)}static makeAlphanumeric(t){if(!e.isAlphanumeric(t))throw RangeError(`String contains unencodable characters in alphanumeric mode`);let r=[],i;for(i=0;i+2<=t.length;i+=2){let a=e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(i))*45;a+=e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(i+1)),n(a,11,r)}return i<t.length&&n(e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(i)),6,r),new e(e.Mode.ALPHANUMERIC,t.length,r)}static makeSegments(t){return t==``?[]:e.isNumeric(t)?[e.makeNumeric(t)]:e.isAlphanumeric(t)?[e.makeAlphanumeric(t)]:[e.makeBytes(e.toUtf8ByteArray(t))]}static makeEci(t){let r=[];if(t<0)throw RangeError(`ECI assignment value out of range`);if(t<128)n(t,8,r);else if(t<16384)n(2,2,r),n(t,14,r);else if(t<1e6)n(6,3,r),n(t,21,r);else throw RangeError(`ECI assignment value out of range`);return new e(e.Mode.ECI,0,r)}static isNumeric(t){return e.NUMERIC_REGEX.test(t)}static isAlphanumeric(t){return e.ALPHANUMERIC_REGEX.test(t)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let n=0;for(let r of e){let e=r.mode.numCharCountBits(t);if(r.numChars>=1<<e)return 1/0;n+=4+e+r.bitData.length}return n}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let n=0;n<e.length;n++)e.charAt(n)==`%`?(t.push(parseInt(e.substring(n+1,n+3),16)),n+=2):t.push(e.charCodeAt(n));return t}};a.NUMERIC_REGEX=/^[0-9]*$/,a.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,a.ALPHANUMERIC_CHARSET=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:`;let o=a;e.QrSegment=a})(VF||={}),(e=>{(e=>{let t=class{constructor(e,t){this.ordinal=e,this.formatBits=t}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),e.Ecc=t})(e.QrCode||={})})(VF||={}),(e=>{(e=>{let t=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),e.Mode=t})(e.QrSegment||={})})(VF||={});var HF=VF,UF={L:HF.QrCode.Ecc.LOW,M:HF.QrCode.Ecc.MEDIUM,Q:HF.QrCode.Ecc.QUARTILE,H:HF.QrCode.Ecc.HIGH},WF=128,GF=`L`,KF=`#FFFFFF`,qF=`#000000`,JF=!1,YF=1,XF=4,ZF=0,QF=.1;function $F(e,t=0){let n=[];return e.forEach(function(e,r){let i=null;e.forEach(function(a,o){if(!a&&i!==null){n.push(`M${i+t} ${r+t}h${o-i}v1H${i+t}z`),i=null;return}if(o===e.length-1){if(!a)return;i===null?n.push(`M${o+t},${r+t} h1v1H${o+t}z`):n.push(`M${i+t},${r+t} h${o+1-i}v1H${i+t}z`);return}a&&i===null&&(i=o)})}),n.join(``)}function eI(e,t){return e.slice().map((e,n)=>n<t.y||n>=t.y+t.h?e:e.map((e,n)=>n<t.x||n>=t.x+t.w?e:!1))}function tI(e,t,n,r){if(r==null)return null;let i=e.length+n*2,a=Math.floor(t*QF),o=i/t,s=(r.width||a)*o,c=(r.height||a)*o,l=r.x==null?e.length/2-s/2:r.x*o,u=r.y==null?e.length/2-c/2:r.y*o,d=r.opacity==null?1:r.opacity,f=null;if(r.excavate){let e=Math.floor(l),t=Math.floor(u),n=Math.ceil(s+l-e),r=Math.ceil(c+u-t);f={x:e,y:t,w:n,h:r}}let p=r.crossOrigin;return{x:l,y:u,h:c,w:s,excavation:f,opacity:d,crossOrigin:p}}function nI(e,t){return t==null?e?XF:ZF:Math.max(Math.floor(t),0)}function rI({value:e,level:t,minVersion:n,includeMargin:r,marginSize:i,imageSettings:a,size:o,boostLevel:s}){let c=y.useMemo(()=>{let r=(Array.isArray(e)?e:[e]).reduce((e,t)=>(e.push(...HF.QrSegment.makeSegments(t)),e),[]);return HF.QrCode.encodeSegments(r,UF[t],n,void 0,void 0,s)},[e,t,n,s]),{cells:l,margin:u,numCells:d,calculatedImageSettings:f}=y.useMemo(()=>{let e=c.getModules(),t=nI(r,i),n=e.length+t*2,s=tI(e,o,t,a);return{cells:e,margin:t,numCells:n,calculatedImageSettings:s}},[c,o,a,r,i]);return{qrcode:c,margin:u,cells:l,numCells:d,calculatedImageSettings:f}}var iI=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),aI=y.forwardRef(function(e,t){let n=e,{value:r,size:i=WF,level:a=GF,bgColor:o=KF,fgColor:s=qF,includeMargin:c=JF,minVersion:l=YF,boostLevel:u,marginSize:d,imageSettings:f}=n,p=BF(n,[`value`,`size`,`level`,`bgColor`,`fgColor`,`includeMargin`,`minVersion`,`boostLevel`,`marginSize`,`imageSettings`]),{style:m}=p,h=BF(p,[`style`]),g=f?.src,_=y.useRef(null),v=y.useRef(null),b=y.useCallback(e=>{_.current=e,typeof t==`function`?t(e):t&&(t.current=e)},[t]),[x,S]=y.useState(!1),{margin:C,cells:w,numCells:T,calculatedImageSettings:E}=rI({value:r,level:a,minVersion:l,boostLevel:u,includeMargin:c,marginSize:d,imageSettings:f,size:i});y.useEffect(()=>{if(_.current!=null){let e=_.current,t=e.getContext(`2d`);if(!t)return;let n=w,r=v.current,a=E!=null&&r!==null&&r.complete&&r.naturalHeight!==0&&r.naturalWidth!==0;a&&E.excavation!=null&&(n=eI(w,E.excavation));let c=window.devicePixelRatio||1;e.height=e.width=i*c;let l=i/T*c;t.scale(l,l),t.fillStyle=o,t.fillRect(0,0,T,T),t.fillStyle=s,iI?t.fill(new Path2D($F(n,C))):w.forEach(function(e,n){e.forEach(function(e,r){e&&t.fillRect(r+C,n+C,1,1)})}),E&&(t.globalAlpha=E.opacity),a&&t.drawImage(r,E.x+C,E.y+C,E.w,E.h)}}),y.useEffect(()=>{S(!1)},[g]);let D=zF({height:i,width:i},m),O=null;return g!=null&&(O=y.createElement(`img`,{src:g,key:g,style:{display:`none`},onLoad:()=>{S(!0)},ref:v,crossOrigin:E?.crossOrigin})),y.createElement(y.Fragment,null,y.createElement(`canvas`,zF({style:D,height:i,width:i,ref:b,role:`img`},h)),O)});aI.displayName=`QRCodeCanvas`;var oI=y.forwardRef(function(e,t){let n=e,{value:r,size:i=WF,level:a=GF,bgColor:o=KF,fgColor:s=qF,includeMargin:c=JF,minVersion:l=YF,boostLevel:u,title:d,marginSize:f,imageSettings:p}=n,m=BF(n,[`value`,`size`,`level`,`bgColor`,`fgColor`,`includeMargin`,`minVersion`,`boostLevel`,`title`,`marginSize`,`imageSettings`]),{margin:h,cells:g,numCells:_,calculatedImageSettings:v}=rI({value:r,level:a,minVersion:l,boostLevel:u,includeMargin:c,marginSize:f,imageSettings:p,size:i}),b=g,x=null;p!=null&&v!=null&&(v.excavation!=null&&(b=eI(g,v.excavation)),x=y.createElement(`image`,{href:p.src,height:v.h,width:v.w,x:v.x+h,y:v.y+h,preserveAspectRatio:`none`,opacity:v.opacity,crossOrigin:v.crossOrigin}));let S=$F(b,h);return y.createElement(`svg`,zF({height:i,width:i,viewBox:`0 0 ${_} ${_}`,ref:t,role:`img`},m),!!d&&y.createElement(`title`,null,d),y.createElement(`path`,{fill:o,d:`M0,0 h${_}v${_}H0z`,shapeRendering:`crispEdges`}),y.createElement(`path`,{fill:s,d:S,shapeRendering:`crispEdges`}),x)});oI.displayName=`QRCodeSVG`;var sI=`Label`,cI=y.forwardRef((e,t)=>(0,Z.jsx)(vS.label,{...e,ref:t,onMouseDown:t=>{t.target.closest(`button, input, select, textarea`)||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));cI.displayName=sI;var lI=cI,uI=rS(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),dI=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(lI,{ref:n,className:Q(uI(),e),...t}));dI.displayName=lI.displayName;function fI(e,[t,n]){return Math.min(n,Math.max(t,e))}function pI(e){let t=e+`CollectionProvider`,[n,r]=sS(t),[i,a]=n(t,{collectionRef:{current:null},itemMap:new Map}),o=e=>{let{scope:t,children:n}=e,r=y.useRef(null),a=y.useRef(new Map).current;return(0,Z.jsx)(i,{scope:t,itemMap:a,collectionRef:r,children:n})};o.displayName=t;let s=e+`CollectionSlot`,c=qx(s),l=y.forwardRef((e,t)=>{let{scope:n,children:r}=e,i=a(s,n),o=Kx(t,i.collectionRef);return(0,Z.jsx)(c,{ref:o,children:r})});l.displayName=s;let u=e+`CollectionItemSlot`,d=`data-radix-collection-item`,f=qx(u),p=y.forwardRef((e,t)=>{let{scope:n,children:r,...i}=e,o=y.useRef(null),s=Kx(t,o),c=a(u,n);return y.useEffect(()=>(c.itemMap.set(o,{ref:o,...i}),()=>void c.itemMap.delete(o))),(0,Z.jsx)(f,{[d]:``,ref:s,children:r})});p.displayName=u;function m(t){let n=a(e+`CollectionConsumer`,t);return y.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${d}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])}return[{Provider:o,Slot:l,ItemSlot:p},m,r]}var mI=y.createContext(void 0);function hI(e){let t=y.useContext(mI);return e||t||`ltr`}function gI(e){let t=y.useRef({value:e,previous:e});return y.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var _I=l(g(),1),vI=[` `,`Enter`,`ArrowUp`,`ArrowDown`],yI=[` `,`Enter`],bI=`Select`,[xI,SI,CI]=pI(bI),[wI,TI]=sS(bI,[CI,uO]),EI=uO(),[DI,OI]=wI(bI),[kI,AI]=wI(bI),jI=e=>{let{__scopeSelect:t,children:n,open:r,defaultOpen:i,onOpenChange:a,value:o,defaultValue:s,onValueChange:c,dir:l,name:u,autoComplete:d,disabled:f,required:p,form:m}=e,h=EI(t),[g,_]=y.useState(null),[v,b]=y.useState(null),[x,S]=y.useState(!1),C=hI(l),[w,T]=mS({prop:r,defaultProp:i??!1,onChange:a,caller:bI}),[E,D]=mS({prop:o,defaultProp:s,onChange:c,caller:bI}),O=y.useRef(null),k=g?m||!!g.closest(`form`):!0,[A,ee]=y.useState(new Set),te=Array.from(A).map(e=>e.props.value).join(`;`);return(0,Z.jsx)(EO,{...h,children:(0,Z.jsxs)(DI,{required:p,scope:t,trigger:g,onTriggerChange:_,valueNode:v,onValueNodeChange:b,valueNodeHasChildren:x,onValueNodeHasChildrenChange:S,contentId:fS(),value:E,onValueChange:D,open:w,onOpenChange:T,dir:C,triggerPointerDownPosRef:O,disabled:f,children:[(0,Z.jsx)(xI.Provider,{scope:t,children:(0,Z.jsx)(kI,{scope:e.__scopeSelect,onNativeOptionAdd:y.useCallback(e=>{ee(t=>new Set(t).add(e))},[]),onNativeOptionRemove:y.useCallback(e=>{ee(t=>{let n=new Set(t);return n.delete(e),n})},[]),children:n})}),k?(0,Z.jsxs)(EL,{"aria-hidden":!0,required:p,tabIndex:-1,name:u,autoComplete:d,value:E,onChange:e=>D(e.target.value),disabled:f,form:m,children:[E===void 0?(0,Z.jsx)(`option`,{value:``}):null,Array.from(A)]},te):null]})})};jI.displayName=bI;var MI=`SelectTrigger`,NI=y.forwardRef((e,t)=>{let{__scopeSelect:n,disabled:r=!1,...i}=e,a=EI(n),o=OI(MI,n),s=o.disabled||r,c=Kx(t,o.onTriggerChange),l=SI(n),u=y.useRef(`touch`),[d,f,p]=OL(e=>{let t=l().filter(e=>!e.disabled),n=t.find(e=>e.value===o.value),r=kL(t,e,n);r!==void 0&&o.onValueChange(r.value)}),m=e=>{s||(o.onOpenChange(!0),p()),e&&(o.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return(0,Z.jsx)(DO,{asChild:!0,...a,children:(0,Z.jsx)(vS.button,{type:`button`,role:`combobox`,"aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":`none`,dir:o.dir,"data-state":o.open?`open`:`closed`,disabled:s,"data-disabled":s?``:void 0,"data-placeholder":DL(o.value)?``:void 0,...i,ref:c,onClick:aS(i.onClick,e=>{e.currentTarget.focus(),u.current!==`mouse`&&m(e)}),onPointerDown:aS(i.onPointerDown,e=>{u.current=e.pointerType;let t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),e.button===0&&e.ctrlKey===!1&&e.pointerType===`mouse`&&(m(e),e.preventDefault())}),onKeyDown:aS(i.onKeyDown,e=>{let t=d.current!==``;!(e.ctrlKey||e.altKey||e.metaKey)&&e.key.length===1&&f(e.key),!(t&&e.key===` `)&&vI.includes(e.key)&&(m(),e.preventDefault())})})})});NI.displayName=MI;var PI=`SelectValue`,FI=y.forwardRef((e,t)=>{let{__scopeSelect:n,className:r,style:i,children:a,placeholder:o=``,...s}=e,c=OI(PI,n),{onValueNodeHasChildrenChange:l}=c,u=a!==void 0,d=Kx(t,c.onValueNodeChange);return lS(()=>{l(u)},[l,u]),(0,Z.jsx)(vS.span,{...s,ref:d,style:{pointerEvents:`none`},children:DL(c.value)?(0,Z.jsx)(Z.Fragment,{children:o}):a})});FI.displayName=PI;var II=`SelectIcon`,LI=y.forwardRef((e,t)=>{let{__scopeSelect:n,children:r,...i}=e;return(0,Z.jsx)(vS.span,{"aria-hidden":!0,...i,ref:t,children:r||``})});LI.displayName=II;var RI=`SelectPortal`,zI=e=>(0,Z.jsx)($S,{asChild:!0,...e});zI.displayName=RI;var BI=`SelectContent`,VI=y.forwardRef((e,t)=>{let n=OI(BI,e.__scopeSelect),[r,i]=y.useState();if(lS(()=>{i(new DocumentFragment)},[]),!n.open){let t=r;return t?_I.createPortal((0,Z.jsx)(UI,{scope:e.__scopeSelect,children:(0,Z.jsx)(xI.Slot,{scope:e.__scopeSelect,children:(0,Z.jsx)(`div`,{children:e.children})})}),t):null}return(0,Z.jsx)(qI,{...e,ref:t})});VI.displayName=BI;var HI=10,[UI,WI]=wI(BI),GI=`SelectContentImpl`,KI=qx(`SelectContent.RemoveScroll`),qI=y.forwardRef((e,t)=>{let{__scopeSelect:n,position:r=`item-aligned`,onCloseAutoFocus:i,onEscapeKeyDown:a,onPointerDownOutside:o,side:s,sideOffset:c,align:l,alignOffset:u,arrowPadding:d,collisionBoundary:f,collisionPadding:p,sticky:m,hideWhenDetached:h,avoidCollisions:g,..._}=e,v=OI(BI,n),[b,x]=y.useState(null),[S,C]=y.useState(null),w=Kx(t,e=>x(e)),[T,E]=y.useState(null),[D,O]=y.useState(null),k=SI(n),[A,ee]=y.useState(!1),te=y.useRef(!1);y.useEffect(()=>{if(b)return Ew(b)},[b]),oC();let ne=y.useCallback(e=>{let[t,...n]=k().map(e=>e.ref.current),[r]=n.slice(-1),i=document.activeElement;for(let n of e)if(n===i||(n?.scrollIntoView({block:`nearest`}),n===t&&S&&(S.scrollTop=0),n===r&&S&&(S.scrollTop=S.scrollHeight),n?.focus(),document.activeElement!==i))return},[k,S]),j=y.useCallback(()=>ne([T,b]),[ne,T,b]);y.useEffect(()=>{A&&j()},[A,j]);let{onOpenChange:M,triggerPointerDownPosRef:re}=v;y.useEffect(()=>{if(b){let e={x:0,y:0},t=t=>{e={x:Math.abs(Math.round(t.pageX)-(re.current?.x??0)),y:Math.abs(Math.round(t.pageY)-(re.current?.y??0))}},n=n=>{e.x<=10&&e.y<=10?n.preventDefault():b.contains(n.target)||M(!1),document.removeEventListener(`pointermove`,t),re.current=null};return re.current!==null&&(document.addEventListener(`pointermove`,t),document.addEventListener(`pointerup`,n,{capture:!0,once:!0})),()=>{document.removeEventListener(`pointermove`,t),document.removeEventListener(`pointerup`,n,{capture:!0})}}},[b,M,re]),y.useEffect(()=>{let e=()=>M(!1);return window.addEventListener(`blur`,e),window.addEventListener(`resize`,e),()=>{window.removeEventListener(`blur`,e),window.removeEventListener(`resize`,e)}},[M]);let[ie,ae]=OL(e=>{let t=k().filter(e=>!e.disabled),n=t.find(e=>e.ref.current===document.activeElement),r=kL(t,e,n);r&&setTimeout(()=>r.ref.current.focus())}),oe=y.useCallback((e,t,n)=>{let r=!te.current&&!n;(v.value!==void 0&&v.value===t||r)&&(E(e),r&&(te.current=!0))},[v.value]),se=y.useCallback(()=>b?.focus(),[b]),ce=y.useCallback((e,t,n)=>{let r=!te.current&&!n;(v.value!==void 0&&v.value===t||r)&&O(e)},[v.value]),le=r===`popper`?ZI:YI,ue=le===ZI?{side:s,sideOffset:c,align:l,alignOffset:u,arrowPadding:d,collisionBoundary:f,collisionPadding:p,sticky:m,hideWhenDetached:h,avoidCollisions:g}:{};return(0,Z.jsx)(UI,{scope:n,content:b,viewport:S,onViewportChange:C,itemRefCallback:oe,selectedItem:T,onItemLeave:se,itemTextRefCallback:ce,focusSelectedItem:j,selectedItemText:D,position:r,isPositioned:A,searchRef:ie,children:(0,Z.jsx)(_w,{as:KI,allowPinchZoom:!0,children:(0,Z.jsx)(zS,{asChild:!0,trapped:v.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:aS(i,e=>{v.trigger?.focus({preventScroll:!0}),e.preventDefault()}),children:(0,Z.jsx)(OS,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:a,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>v.onOpenChange(!1),children:(0,Z.jsx)(le,{role:`listbox`,id:v.contentId,"data-state":v.open?`open`:`closed`,dir:v.dir,onContextMenu:e=>e.preventDefault(),..._,...ue,onPlaced:()=>ee(!0),ref:w,style:{display:`flex`,flexDirection:`column`,outline:`none`,..._.style},onKeyDown:aS(_.onKeyDown,e=>{let t=e.ctrlKey||e.altKey||e.metaKey;if(e.key===`Tab`&&e.preventDefault(),!t&&e.key.length===1&&ae(e.key),[`ArrowUp`,`ArrowDown`,`Home`,`End`].includes(e.key)){let t=k().filter(e=>!e.disabled).map(e=>e.ref.current);if([`ArrowUp`,`End`].includes(e.key)&&(t=t.slice().reverse()),[`ArrowUp`,`ArrowDown`].includes(e.key)){let n=e.target,r=t.indexOf(n);t=t.slice(r+1)}setTimeout(()=>ne(t)),e.preventDefault()}})})})})})})});qI.displayName=GI;var JI=`SelectItemAlignedPosition`,YI=y.forwardRef((e,t)=>{let{__scopeSelect:n,onPlaced:r,...i}=e,a=OI(BI,n),o=WI(BI,n),[s,c]=y.useState(null),[l,u]=y.useState(null),d=Kx(t,e=>u(e)),f=SI(n),p=y.useRef(!1),m=y.useRef(!0),{viewport:h,selectedItem:g,selectedItemText:_,focusSelectedItem:v}=o,b=y.useCallback(()=>{if(a.trigger&&a.valueNode&&s&&l&&h&&g&&_){let e=a.trigger.getBoundingClientRect(),t=l.getBoundingClientRect(),n=a.valueNode.getBoundingClientRect(),i=_.getBoundingClientRect();if(a.dir!==`rtl`){let r=i.left-t.left,a=n.left-r,o=e.left-a,c=e.width+o,l=Math.max(c,t.width),u=window.innerWidth-HI,d=fI(a,[HI,Math.max(HI,u-l)]);s.style.minWidth=c+`px`,s.style.left=d+`px`}else{let r=t.right-i.right,a=window.innerWidth-n.right-r,o=window.innerWidth-e.right-a,c=e.width+o,l=Math.max(c,t.width),u=window.innerWidth-HI,d=fI(a,[HI,Math.max(HI,u-l)]);s.style.minWidth=c+`px`,s.style.right=d+`px`}let o=f(),c=window.innerHeight-HI*2,u=h.scrollHeight,d=window.getComputedStyle(l),m=parseInt(d.borderTopWidth,10),v=parseInt(d.paddingTop,10),y=parseInt(d.borderBottomWidth,10),b=parseInt(d.paddingBottom,10),x=m+v+u+b+y,S=Math.min(g.offsetHeight*5,x),C=window.getComputedStyle(h),w=parseInt(C.paddingTop,10),T=parseInt(C.paddingBottom,10),E=e.top+e.height/2-HI,D=c-E,O=g.offsetHeight/2,k=g.offsetTop+O,A=m+v+k,ee=x-A;if(A<=E){let e=o.length>0&&g===o[o.length-1].ref.current;s.style.bottom=`0px`;let t=l.clientHeight-h.offsetTop-h.offsetHeight,n=Math.max(D,O+(e?T:0)+t+y),r=A+n;s.style.height=r+`px`}else{let e=o.length>0&&g===o[0].ref.current;s.style.top=`0px`;let t=Math.max(E,m+h.offsetTop+(e?w:0)+O)+ee;s.style.height=t+`px`,h.scrollTop=A-E+h.offsetTop}s.style.margin=`${HI}px 0`,s.style.minHeight=S+`px`,s.style.maxHeight=c+`px`,r?.(),requestAnimationFrame(()=>p.current=!0)}},[f,a.trigger,a.valueNode,s,l,h,g,_,a.dir,r]);lS(()=>b(),[b]);let[x,S]=y.useState();lS(()=>{l&&S(window.getComputedStyle(l).zIndex)},[l]);let C=y.useCallback(e=>{e&&m.current===!0&&(b(),v?.(),m.current=!1)},[b,v]);return(0,Z.jsx)(QI,{scope:n,contentWrapper:s,shouldExpandOnScrollRef:p,onScrollButtonChange:C,children:(0,Z.jsx)(`div`,{ref:c,style:{display:`flex`,flexDirection:`column`,position:`fixed`,zIndex:x},children:(0,Z.jsx)(vS.div,{...i,ref:d,style:{boxSizing:`border-box`,maxHeight:`100%`,...i.style}})})})});YI.displayName=JI;var XI=`SelectPopperPosition`,ZI=y.forwardRef((e,t)=>{let{__scopeSelect:n,align:r=`start`,collisionPadding:i=HI,...a}=e,o=EI(n);return(0,Z.jsx)(OO,{...o,...a,ref:t,align:r,collisionPadding:i,style:{boxSizing:`border-box`,...a.style,"--radix-select-content-transform-origin":`var(--radix-popper-transform-origin)`,"--radix-select-content-available-width":`var(--radix-popper-available-width)`,"--radix-select-content-available-height":`var(--radix-popper-available-height)`,"--radix-select-trigger-width":`var(--radix-popper-anchor-width)`,"--radix-select-trigger-height":`var(--radix-popper-anchor-height)`}})});ZI.displayName=XI;var[QI,$I]=wI(BI,{}),eL=`SelectViewport`,tL=y.forwardRef((e,t)=>{let{__scopeSelect:n,nonce:r,...i}=e,a=WI(eL,n),o=$I(eL,n),s=Kx(t,a.onViewportChange),c=y.useRef(0);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`style`,{dangerouslySetInnerHTML:{__html:`[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}`},nonce:r}),(0,Z.jsx)(xI.Slot,{scope:n,children:(0,Z.jsx)(vS.div,{"data-radix-select-viewport":``,role:`presentation`,...i,ref:s,style:{position:`relative`,flex:1,overflow:`hidden auto`,...i.style},onScroll:aS(i.onScroll,e=>{let t=e.currentTarget,{contentWrapper:n,shouldExpandOnScrollRef:r}=o;if(r?.current&&n){let e=Math.abs(c.current-t.scrollTop);if(e>0){let r=window.innerHeight-HI*2,i=parseFloat(n.style.minHeight),a=parseFloat(n.style.height),o=Math.max(i,a);if(o<r){let i=o+e,a=Math.min(r,i),s=i-a;n.style.height=a+`px`,n.style.bottom===`0px`&&(t.scrollTop=s>0?s:0,n.style.justifyContent=`flex-end`)}}}c.current=t.scrollTop})})})]})});tL.displayName=eL;var nL=`SelectGroup`,[rL,iL]=wI(nL),aL=y.forwardRef((e,t)=>{let{__scopeSelect:n,...r}=e,i=fS();return(0,Z.jsx)(rL,{scope:n,id:i,children:(0,Z.jsx)(vS.div,{role:`group`,"aria-labelledby":i,...r,ref:t})})});aL.displayName=nL;var oL=`SelectLabel`,sL=y.forwardRef((e,t)=>{let{__scopeSelect:n,...r}=e,i=iL(oL,n);return(0,Z.jsx)(vS.div,{id:i.id,...r,ref:t})});sL.displayName=oL;var cL=`SelectItem`,[lL,uL]=wI(cL),dL=y.forwardRef((e,t)=>{let{__scopeSelect:n,value:r,disabled:i=!1,textValue:a,...o}=e,s=OI(cL,n),c=WI(cL,n),l=s.value===r,[u,d]=y.useState(a??``),[f,p]=y.useState(!1),m=Kx(t,e=>c.itemRefCallback?.(e,r,i)),h=fS(),g=y.useRef(`touch`),_=()=>{i||(s.onValueChange(r),s.onOpenChange(!1))};if(r===``)throw Error(`A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.`);return(0,Z.jsx)(lL,{scope:n,value:r,disabled:i,textId:h,isSelected:l,onItemTextChange:y.useCallback(e=>{d(t=>t||(e?.textContent??``).trim())},[]),children:(0,Z.jsx)(xI.ItemSlot,{scope:n,value:r,disabled:i,textValue:u,children:(0,Z.jsx)(vS.div,{role:`option`,"aria-labelledby":h,"data-highlighted":f?``:void 0,"aria-selected":l&&f,"data-state":l?`checked`:`unchecked`,"aria-disabled":i||void 0,"data-disabled":i?``:void 0,tabIndex:i?void 0:-1,...o,ref:m,onFocus:aS(o.onFocus,()=>p(!0)),onBlur:aS(o.onBlur,()=>p(!1)),onClick:aS(o.onClick,()=>{g.current!==`mouse`&&_()}),onPointerUp:aS(o.onPointerUp,()=>{g.current===`mouse`&&_()}),onPointerDown:aS(o.onPointerDown,e=>{g.current=e.pointerType}),onPointerMove:aS(o.onPointerMove,e=>{g.current=e.pointerType,i?c.onItemLeave?.():g.current===`mouse`&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:aS(o.onPointerLeave,e=>{e.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:aS(o.onKeyDown,e=>{c.searchRef?.current!==``&&e.key===` `||(yI.includes(e.key)&&_(),e.key===` `&&e.preventDefault())})})})})});dL.displayName=cL;var fL=`SelectItemText`,pL=y.forwardRef((e,t)=>{let{__scopeSelect:n,className:r,style:i,...a}=e,o=OI(fL,n),s=WI(fL,n),c=uL(fL,n),l=AI(fL,n),[u,d]=y.useState(null),f=Kx(t,e=>d(e),c.onItemTextChange,e=>s.itemTextRefCallback?.(e,c.value,c.disabled)),p=u?.textContent,m=y.useMemo(()=>(0,Z.jsx)(`option`,{value:c.value,disabled:c.disabled,children:p},c.value),[c.disabled,c.value,p]),{onNativeOptionAdd:h,onNativeOptionRemove:g}=l;return lS(()=>(h(m),()=>g(m)),[h,g,m]),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(vS.span,{id:c.textId,...a,ref:f}),c.isSelected&&o.valueNode&&!o.valueNodeHasChildren?_I.createPortal(a.children,o.valueNode):null]})});pL.displayName=fL;var mL=`SelectItemIndicator`,hL=y.forwardRef((e,t)=>{let{__scopeSelect:n,...r}=e;return uL(mL,n).isSelected?(0,Z.jsx)(vS.span,{"aria-hidden":!0,...r,ref:t}):null});hL.displayName=mL;var gL=`SelectScrollUpButton`,_L=y.forwardRef((e,t)=>{let n=WI(gL,e.__scopeSelect),r=$I(gL,e.__scopeSelect),[i,a]=y.useState(!1),o=Kx(t,r.onScrollButtonChange);return lS(()=>{if(n.viewport&&n.isPositioned){let e=function(){let e=t.scrollTop>0;a(e)},t=n.viewport;return e(),t.addEventListener(`scroll`,e),()=>t.removeEventListener(`scroll`,e)}},[n.viewport,n.isPositioned]),i?(0,Z.jsx)(bL,{...e,ref:o,onAutoScroll:()=>{let{viewport:e,selectedItem:t}=n;e&&t&&(e.scrollTop-=t.offsetHeight)}}):null});_L.displayName=gL;var vL=`SelectScrollDownButton`,yL=y.forwardRef((e,t)=>{let n=WI(vL,e.__scopeSelect),r=$I(vL,e.__scopeSelect),[i,a]=y.useState(!1),o=Kx(t,r.onScrollButtonChange);return lS(()=>{if(n.viewport&&n.isPositioned){let e=function(){let e=t.scrollHeight-t.clientHeight,n=Math.ceil(t.scrollTop)<e;a(n)},t=n.viewport;return e(),t.addEventListener(`scroll`,e),()=>t.removeEventListener(`scroll`,e)}},[n.viewport,n.isPositioned]),i?(0,Z.jsx)(bL,{...e,ref:o,onAutoScroll:()=>{let{viewport:e,selectedItem:t}=n;e&&t&&(e.scrollTop+=t.offsetHeight)}}):null});yL.displayName=vL;var bL=y.forwardRef((e,t)=>{let{__scopeSelect:n,onAutoScroll:r,...i}=e,a=WI(`SelectScrollButton`,n),o=y.useRef(null),s=SI(n),c=y.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return y.useEffect(()=>()=>c(),[c]),lS(()=>{s().find(e=>e.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:`nearest`})},[s]),(0,Z.jsx)(vS.div,{"aria-hidden":!0,...i,ref:t,style:{flexShrink:0,...i.style},onPointerDown:aS(i.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(r,50))}),onPointerMove:aS(i.onPointerMove,()=>{a.onItemLeave?.(),o.current===null&&(o.current=window.setInterval(r,50))}),onPointerLeave:aS(i.onPointerLeave,()=>{c()})})}),xL=`SelectSeparator`,SL=y.forwardRef((e,t)=>{let{__scopeSelect:n,...r}=e;return(0,Z.jsx)(vS.div,{"aria-hidden":!0,...r,ref:t})});SL.displayName=xL;var CL=`SelectArrow`,wL=y.forwardRef((e,t)=>{let{__scopeSelect:n,...r}=e,i=EI(n),a=OI(CL,n),o=WI(CL,n);return a.open&&o.position===`popper`?(0,Z.jsx)(kO,{...i,...r,ref:t}):null});wL.displayName=CL;var TL=`SelectBubbleInput`,EL=y.forwardRef(({__scopeSelect:e,value:t,...n},r)=>{let i=y.useRef(null),a=Kx(r,i),o=gI(t);return y.useEffect(()=>{let e=i.current;if(!e)return;let n=window.HTMLSelectElement.prototype,r=Object.getOwnPropertyDescriptor(n,`value`).set;if(o!==t&&r){let n=new Event(`change`,{bubbles:!0});r.call(e,t),e.dispatchEvent(n)}},[o,t]),(0,Z.jsx)(vS.select,{...n,style:{...AO,...n.style},ref:a,defaultValue:t})});EL.displayName=TL;function DL(e){return e===``||e===void 0}function OL(e){let t=bS(e),n=y.useRef(``),r=y.useRef(0),i=y.useCallback(e=>{let i=n.current+e;t(i),(function e(t){n.current=t,window.clearTimeout(r.current),t!==``&&(r.current=window.setTimeout(()=>e(``),1e3))})(i)},[t]),a=y.useCallback(()=>{n.current=``,window.clearTimeout(r.current)},[]);return y.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,i,a]}function kL(e,t,n){let r=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,i=n?e.indexOf(n):-1,a=AL(e,Math.max(i,0));r.length===1&&(a=a.filter(e=>e!==n));let o=a.find(e=>e.textValue.toLowerCase().startsWith(r.toLowerCase()));return o===n?void 0:o}function AL(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var jL=jI,ML=NI,NL=FI,PL=LI,FL=zI,IL=VI,LL=tL,RL=sL,zL=dL,BL=pL,VL=hL,HL=_L,UL=yL,WL=SL,GL=jL,KL=NL,qL=y.forwardRef(({className:e,children:t,...n},r)=>(0,Z.jsxs)(ML,{ref:r,className:Q(`flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1`,e),...n,children:[t,(0,Z.jsx)(PL,{asChild:!0,children:(0,Z.jsx)(db,{className:`h-4 w-4 opacity-50`})})]}));qL.displayName=ML.displayName;var JL=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(HL,{ref:n,className:Q(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,Z.jsx)(pb,{className:`h-4 w-4`})}));JL.displayName=HL.displayName;var YL=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(UL,{ref:n,className:Q(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,Z.jsx)(db,{className:`h-4 w-4`})}));YL.displayName=UL.displayName;var XL=y.forwardRef(({className:e,children:t,position:n=`popper`,...r},i)=>(0,Z.jsx)(FL,{children:(0,Z.jsxs)(IL,{ref:i,className:Q(`relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]`,n===`popper`&&`data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1`,e),position:n,...r,children:[(0,Z.jsx)(JL,{}),(0,Z.jsx)(LL,{className:Q(`p-1`,n===`popper`&&`h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]`),children:t}),(0,Z.jsx)(YL,{})]})}));XL.displayName=IL.displayName;var ZL=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(RL,{ref:n,className:Q(`px-2 py-1.5 text-sm font-semibold`,e),...t}));ZL.displayName=RL.displayName;var QL=y.forwardRef(({className:e,children:t,...n},r)=>(0,Z.jsxs)(zL,{ref:r,className:Q(`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,Z.jsx)(`span`,{className:`absolute right-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,Z.jsx)(VL,{children:(0,Z.jsx)(ub,{className:`h-4 w-4`})})}),(0,Z.jsx)(BL,{children:t})]}));QL.displayName=zL.displayName;var $L=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(WL,{ref:n,className:Q(`-mx-1 my-1 h-px bg-muted`,e),...t}));$L.displayName=WL.displayName;function eR({open:e,onOpenChange:t,threadId:n,inviteUrl:r,loading:i,onRegenerate:a,notify:o,holderPubKey:s,holderKind:c=`holder`,contacts:l={},onSendToContact:u}){let[d,f]=(0,y.useState)(``),p=(0,y.useRef)(null),m=(0,y.useMemo)(()=>n?n.length>16?`${n.slice(0,8)}${n.slice(-6)}`:n:``,[n]),h=(0,y.useMemo)(()=>r?r.length>1400?320:r.length>1e3?256:192:192,[r]),g=(0,y.useMemo)(()=>r&&r.length<=2e3?r:``,[r]),{identity:_,loading:v}=kj(s,c),b=(0,y.useMemo)(()=>Object.entries(l).filter(([e,t])=>(t?.kind===`holder`||t?.walletPubkey)&&e).map(([e,t])=>({pubkey:e,name:t?.nickname||t?.displayName||t?.card?.displayName||pj(e),colorSeed:t?.card?.colorSeed||mj(e),avatarHash:t?.avatarHash||t?.card?.avatarHash||null,kind:t?.kind||`guest`,verified:!!t?.verified})).sort((e,t)=>e.name.localeCompare(t.name)),[l]),x=(0,y.useMemo)(()=>b.find(e=>e.pubkey===d)||null,[b,d]),S=(0,y.useCallback)(()=>{!d||!u||(u(d,x),f(``))},[d,x,u]),C=(0,y.useCallback)(async()=>{if(r)try{await navigator.clipboard.writeText(r),o?.(`success`,`Invite link copied to clipboard`)}catch(e){console.error(`[NewThreadInviteDialog] Failed to copy invite link`,e),o?.(`error`,`Unable to copy invite link`)}},[r,o]),w=(0,y.useCallback)(async()=>{let e=p.current;if(!(!e||!r)){try{if(e.toBlob&&window.ClipboardItem){let t=await new Promise(t=>e.toBlob(t));if(t){await navigator.clipboard.write([new window.ClipboardItem({"image/png":t})]),o?.(`success`,`QR image copied to clipboard`);return}}}catch(e){console.warn(`[NewThreadInviteDialog] ClipboardItem copy failed, falling back`,e)}try{let t=e.toDataURL(`image/png`);await navigator.clipboard.writeText(t),o?.(`success`,`QR image data URL copied to clipboard`)}catch(e){console.error(`[NewThreadInviteDialog] Failed to copy QR data URL`,e),o?.(`error`,`Unable to copy QR image`)}}},[r,o]);return(0,Z.jsx)(TT,{open:e,onOpenChange:t,children:(0,Z.jsxs)(OT,{className:`max-w-2xl max-h-[calc(100vh-4rem)] overflow-y-auto`,children:[(0,Z.jsxs)(kT,{children:[(0,Z.jsx)(jT,{children:`Invite someone to this thread`}),(0,Z.jsxs)(MT,{children:[`Share this link or QR code with a guest. Thread ID: `,m||``]})]}),(0,Z.jsxs)(`div`,{className:`space-y-6`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-3 rounded-md border border-muted-foreground/20 bg-muted/10 p-4`,children:[(0,Z.jsx)(lj,{name:_?.name||`Your profile`,colorSeed:_?.colorSeed||0,avatarHash:_?.avatar||null,pubkey:s,size:48}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`text-sm font-medium text-foreground/90`,children:v?`Resolving your wallet profile`:_?.name||`Wallet holder`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Invite will appear as coming from your wallet identity once certificates are integrated.`})]})]}),(0,Z.jsxs)(`div`,{className:`space-y-3 rounded-md border border-muted-foreground/20 bg-muted/5 p-4`,children:[(0,Z.jsx)(dI,{className:`text-sm font-medium`,children:`Send to a saved contact`}),b.length>0?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Z.jsxs)(GL,{value:d,onValueChange:f,disabled:i,children:[(0,Z.jsx)(qL,{className:`flex-1`,children:(0,Z.jsx)(KL,{placeholder:`Select a contact`})}),(0,Z.jsx)(XL,{children:b.map(e=>(0,Z.jsx)(QL,{value:e.pubkey,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(`span`,{className:`font-medium`,children:e.name}),e.verified&&(0,Z.jsx)(`span`,{className:`text-[10px] text-emerald-500`,children:``}),(0,Z.jsx)(`span`,{className:`text-[10px] text-muted-foreground`,children:e.kind===`holder`?`Wallet`:`Guest`})]})},e.pubkey))})]}),(0,Z.jsx)($,{size:`sm`,disabled:!d||i||!u,onClick:S,children:`Send invite`})]}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Select a contact with a linked wallet to send them a direct invite. They'll receive a DT minted specifically for their identity.`})]}):(0,Z.jsx)(`div`,{className:`rounded-md bg-muted/30 px-3 py-2`,children:(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`No contacts with linked wallets yet. Share the guest invite link below, or wait for contacts to link their wallets.`})})]}),(0,Z.jsx)(zT,{}),(0,Z.jsxs)(`div`,{className:`grid gap-4 sm:grid-cols-[minmax(0,1.2fr)_minmax(260px,360px)] sm:items-start`,children:[(0,Z.jsxs)(`div`,{className:`space-y-3`,children:[(0,Z.jsx)(dI,{htmlFor:`invite-link`,className:`text-sm font-medium`,children:`Guest invite link`}),(0,Z.jsx)(GA,{id:`invite-link`,value:r||``,readOnly:!0,disabled:i,className:`font-mono`}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,Z.jsx)($,{size:`sm`,disabled:!r||i,onClick:C,children:`Copy link`}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,disabled:i,onClick:()=>a?.(n),children:`Refresh link`})]}),i&&(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Generating invite`})]}),(0,Z.jsxs)(`div`,{className:`flex flex-col items-center gap-2 rounded-md border border-muted-foreground/20 bg-muted/10 p-4`,children:[g?(0,Z.jsx)(aI,{value:g,size:h,includeMargin:!0,level:`L`,ref:e=>{e&&(p.current=e)}}):(0,Z.jsx)(`div`,{className:`flex items-center justify-center rounded-md bg-muted/40 text-xs text-muted-foreground`,style:{width:h,height:h},children:i?`Generating QR`:`Invite link unavailable`}),(0,Z.jsx)($,{size:`sm`,variant:`secondary`,disabled:!g||i,onClick:w,children:`Copy QR image`}),(0,Z.jsx)(`p`,{className:`text-[11px] text-muted-foreground text-center`,children:`Guests can scan this QR code from another device to join the thread.`})]})]})]}),(0,Z.jsx)(AT,{className:`flex flex-col gap-2 sm:flex-row sm:justify-end`,children:(0,Z.jsx)($,{variant:`ghost`,onClick:()=>t?.(!1),children:`Close`})})]})})}async function tR({contacts:e,conversations:t,messagesByThread:n,sendMessage:r,upsertContact:i}){if(!e||!t||t.length===0)return;let a=Object.entries(e);if(a.length)for(let[e,o]of a){if(!o||!o.verified||!o.verifiedSafetyNumber)continue;let a;try{a=hj(e)}catch(t){console.warn(`[useSafetyNumberChangeWarnings] Failed to compute safety number for contact`,{pubkey:e.slice(0,16)+`...`,error:t?.message});continue}let s=o.verifiedSafetyNumber;if(gj(a,s))continue;try{await i(e,{verified:!1,verifiedSafetyNumber:null,lastVerifiedSafetyNumber:s})}catch(e){console.warn(`[useSafetyNumberChangeWarnings] Failed to update contact after safety-number change`,e)}let c=t.filter(t=>{if(!t?.peerPublicKey)return!1;try{return t.peerPublicKey.toLowerCase()===e.toLowerCase()}catch{return!1}});for(let e of c){let t=e.id;if(!t||(n[t]||[]).some(e=>typeof e?.text==`string`&&e.text.startsWith(`[SAFETY_CHANGED]`)))continue;let i=e.selfPublicKey||`self`;try{await r(t,{author:i,text:`[SAFETY_CHANGED]`})}catch(e){console.warn(`[useSafetyNumberChangeWarnings] Failed to post safety-changed system message`,e)}}}}function nR(e){(0,y.useEffect)(()=>{tR(e)},[e.contacts,e.conversations,e.messagesByThread,e.sendMessage,e.upsertContact])}function rR({open:e,onOpenChange:t,onConfirm:n,onCancel:r,connecting:i=!1}){return(0,Z.jsx)(TT,{open:e,onOpenChange:t,children:(0,Z.jsxs)(OT,{children:[(0,Z.jsxs)(kT,{children:[(0,Z.jsx)(jT,{children:`Upgrade unavailable`}),(0,Z.jsx)(MT,{children:`Your wallet is not connected. Connect it to upgrade this thread from guest mode.`})]}),(0,Z.jsxs)(AT,{children:[(0,Z.jsx)($,{variant:`outline`,onClick:r,disabled:i,children:`Cancel`}),(0,Z.jsx)($,{onClick:n,disabled:i,children:i?`Connecting`:`Connect wallet`})]})]})})}function iR({onClose:e}){let[t,n]=(0,y.useState)([]),[r,i]=(0,y.useState)({totalEvents:0,avgRtt:null,reconnects:0}),a=async()=>{try{let e=await Qk(50);n(e),o(e)}catch(e){console.error(`[OverlayTelemetryPanel] Failed to load events`,e)}},o=e=>{let t=e.filter(e=>e.kind===`heartbeat`&&typeof e.rttMs==`number`),n=t.length>0?Math.round(t.reduce((e,t)=>e+t.rttMs,0)/t.length):null,r=e.filter(e=>e.kind===`reconnect`).length;i({totalEvents:e.length,avgRtt:n,reconnects:r})},s=async()=>{try{await $k(),n([]),i({totalEvents:0,avgRtt:null,reconnects:0})}catch(e){console.error(`[OverlayTelemetryPanel] Failed to clear telemetry`,e)}};return(0,y.useEffect)(()=>(a(),Yj(()=>{a()})),[]),(0,Z.jsx)(`div`,{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/50`,children:(0,Z.jsxs)(`div`,{className:`relative w-full max-w-3xl max-h-[80vh] overflow-hidden rounded-lg border border-border bg-background shadow-lg`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between border-b border-border px-4 py-3`,children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold`,children:`Overlay Telemetry`}),(0,Z.jsx)($,{size:`icon`,variant:`ghost`,onClick:e,"aria-label":`Close diagnostics`,children:(0,Z.jsx)(Bb,{className:`h-4 w-4`})})]}),(0,Z.jsxs)(`div`,{className:`p-4 space-y-4`,children:[(0,Z.jsxs)(`div`,{className:`grid grid-cols-3 gap-4 text-sm`,children:[(0,Z.jsxs)(`div`,{className:`rounded border border-border bg-muted/50 p-3`,children:[(0,Z.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Total Events`}),(0,Z.jsx)(`div`,{className:`text-xl font-semibold`,children:r.totalEvents})]}),(0,Z.jsxs)(`div`,{className:`rounded border border-border bg-muted/50 p-3`,children:[(0,Z.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Avg RTT`}),(0,Z.jsx)(`div`,{className:`text-xl font-semibold`,children:r.avgRtt===null?``:`${r.avgRtt}ms`})]}),(0,Z.jsxs)(`div`,{className:`rounded border border-border bg-muted/50 p-3`,children:[(0,Z.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Reconnects`}),(0,Z.jsx)(`div`,{className:`text-xl font-semibold`,children:r.reconnects})]})]}),(0,Z.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Z.jsx)(`h3`,{className:`text-sm font-medium`,children:`Recent Events (last 50)`}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:s,children:`Clear Log`})]}),(0,Z.jsx)(`div`,{className:`max-h-96 overflow-y-auto rounded border border-border bg-muted/20 p-2 text-xs font-mono`,children:t.length===0?(0,Z.jsx)(`div`,{className:`text-center text-muted-foreground py-8`,children:`No telemetry events recorded yet.`}):(0,Z.jsxs)(`table`,{className:`w-full`,children:[(0,Z.jsx)(`thead`,{className:`sticky top-0 bg-background border-b border-border`,children:(0,Z.jsxs)(`tr`,{className:`text-left`,children:[(0,Z.jsx)(`th`,{className:`px-2 py-1`,children:`Timestamp`}),(0,Z.jsx)(`th`,{className:`px-2 py-1`,children:`Kind`}),(0,Z.jsx)(`th`,{className:`px-2 py-1`,children:`Details`})]})}),(0,Z.jsx)(`tbody`,{children:t.slice().reverse().map((e,t)=>(0,Z.jsxs)(`tr`,{className:`border-b border-border/50 hover:bg-muted/30`,children:[(0,Z.jsx)(`td`,{className:`px-2 py-1 text-muted-foreground`,children:new Date(e.timestamp).toLocaleTimeString()}),(0,Z.jsx)(`td`,{className:`px-2 py-1`,children:(0,Z.jsx)(`span`,{className:`inline-block px-1.5 py-0.5 rounded text-[10px] font-semibold ${aR(e.kind)}`,children:e.kind})}),(0,Z.jsx)(`td`,{className:`px-2 py-1 text-muted-foreground`,children:oR(e)})]},t))})]})})]})]})})}function aR(e){switch(e){case`status`:return`bg-blue-500/20 text-blue-300`;case`reconnect`:return`bg-yellow-500/20 text-yellow-300`;case`error`:return`bg-red-500/20 text-red-300`;case`heartbeat`:return`bg-green-500/20 text-green-300`;case`ping`:return`bg-purple-500/20 text-purple-300`;default:return`bg-muted text-muted-foreground`}}function oR(e){let t=[];return e.status&&t.push(`status=${e.status}`),e.rttMs!==void 0&&t.push(`rtt=${e.rttMs}ms`),e.attempts!==void 0&&t.push(`attempts=${e.attempts}`),e.delay!==void 0&&t.push(`delay=${e.delay}ms`),e.code!==void 0&&t.push(`code=${e.code}`),e.reason&&t.push(`reason="${e.reason}"`),e.message&&t.push(`msg="${e.message}"`),e.phase&&t.push(`phase=${e.phase}`),e.readyState!==null&&e.readyState!==void 0&&t.push(`readyState=${e.readyState}`),t.length>0?t.join(`, `):``}var sR=`https://messagebox.babbage.systems`,cR=`nukenote_invites`,lR=null,uR=null;async function dR(e,t=sR){if(!e)throw Error(`WalletClient is required for MessageBox`);let{publicKey:n}=await e.getPublicKey({identityKey:!0});return lR&&uR===n?lR:(lR=new Dy({host:t,walletClient:e}),await lR.init(),uR=n,console.log(`[MessageBoxService] Initialized for identity:`,n.slice(0,16)+`...`),lR)}async function fR({walletClient:e,recipientPubKey:t,threadId:n,inviteUrl:r,senderName:i=`Someone`}){try{let a=await dR(e),o={type:`nukenote_thread_invite`,version:1,threadId:n,inviteUrl:r,senderName:i,timestamp:new Date().toISOString()};return await a.sendMessage({recipient:t,messageBox:cR,body:JSON.stringify(o)}),console.log(`[MessageBoxService] Sent thread invite to:`,t.slice(0,16)+`...`),{success:!0}}catch(e){return console.error(`[MessageBoxService] Failed to send thread invite:`,e),{success:!1,error:e.message||`Failed to send invite`}}}async function pR({walletClient:e,inviteDialogThread:t,inviteLink:n,contactPubkey:r,contact:i,notifyUser:a}){if(!t||!r)return;let o=i?.name||`your contact`;if(e&&n)try{let i=await fR({walletClient:e,recipientPubKey:r,threadId:t,inviteUrl:n,senderName:`NukeNote User`});if(i.success){a?.(`success`,`Invite sent to ${o} via MessageBox! They'll receive it in their wallet.`);return}console.warn(`[sendInviteToContact] MessageBox send failed, falling back to clipboard:`,i.error)}catch(e){console.warn(`[sendInviteToContact] MessageBox unavailable, falling back to clipboard:`,e)}try{n?(await navigator.clipboard.writeText(n),a?.(`success`,`Invite link copied! Share it with ${o} to connect.`)):a?.(`error`,`No invite link available. Try regenerating.`)}catch(e){console.error(`[sendInviteToContact] Failed to copy invite for contact`,e),a?.(`error`,`Failed to copy invite link`)}}function mR(){let{conversations:e,messagesByThread:t,sendMessage:n,leaveThread:r,burnThread:i,upgradeThreadToHolder:a,createNewThread:o,generateThreadInvite:s,typingByThread:c,notifyTyping:l,blockInviter:u,sendOnEnter:d,ensureThreadSubscribed:f}=CP(),{isConnected:p,isLoading:m,connectWallet:h,identityKey:g,getWalletClient:_}=Yy(),v=p?_?.():null,{addNotification:b}=Gy(),{contacts:x,upsert:S}=jF(),[C,w]=(0,y.useState)(null),[T,E]=(0,y.useState)(!1),[D,O]=(0,y.useState)(!1),[k,A]=(0,y.useState)(null),[ee,te]=(0,y.useState)(!1),[ne,j]=(0,y.useState)(!1),[M,re]=(0,y.useState)(!1),[ie,ae]=(0,y.useState)(null),[oe,se]=(0,y.useState)(``),[ce,le]=(0,y.useState)(!1),[ue,de]=(0,y.useState)(``);(0,y.useEffect)(()=>{},[]);let fe=(0,y.useMemo)(()=>{let t=ue.trim().toLowerCase();return t?e.filter(e=>{let n=e.title?.toLowerCase?.()||``,r=e.preview?.toLowerCase?.()||``,i=e.peerPublicKey?.toLowerCase?.()||``;return n.includes(t)||r.includes(t)||i.includes(t)}):e},[e,ue]),pe=fe[0]??e[0]??null,me=C||pe?.id||null,he=(0,y.useMemo)(()=>e.find(e=>e.id===me)||null,[e,me]),ge=(0,y.useMemo)(()=>me&&t[me]||[],[me,t]);(0,y.useEffect)(()=>{if(!C&&!(typeof window>`u`))try{let t=new URLSearchParams(window.location.search).get(`thread`);if(!t)return;e.some(e=>e.id===t)&&w(t)}catch(e){console.warn(`[MessagesPage] Failed to read thread from query params`,e)}},[C,e]),(0,y.useEffect)(()=>{me&&f(me)},[me,f]),nR({contacts:x,conversations:e,messagesByThread:t,sendMessage:n,upsertContact:S});let _e=(0,y.useCallback)((e,t,n=e===`error`?6e3:3e3)=>{b({type:e,message:t,duration:n})},[b]),ve=(0,y.useCallback)(async(e,{silent:t=!1}={})=>{if(!e)return null;le(!0);try{let n=await s(e);return se(n),t||_e(`success`,`Fresh invite link generated`),n}catch(e){console.error(`[MessagesPage] Failed to generate invite link`,e);let t=e?.message||``;return/Thread key not available for invite generation/i.test(t)||/Cannot mint guest DT: missing raw thread key/i.test(t)?_e(`error`,`New invites are not available for this conversation in this browser session because the encryption key is no longer in memory. Start a new thread to invite additional people.`):_e(`error`,QP(e,{context:`generate invite link`})),null}finally{le(!1)}},[s,_e]),ye=(0,y.useCallback)(async e=>e?(ae(e),re(!0),await ve(e,{silent:!1})):null,[ve]),be=(0,y.useCallback)(async e=>{if(!(!e||T))try{E(!0),await a(e)}catch(e){throw console.error(`Failed to upgrade thread`,e),_e(`error`,QP(e,{context:`upgrade thread`})),e}finally{E(!1)}},[_e,T,a]),xe=(0,y.useCallback)(async e=>{if(e){if(A(e),!p){O(!0);return}try{await be(e)}finally{A(null)}}},[p,be]),Se=(0,y.useCallback)(async()=>{if(!k){O(!1);return}try{te(!0),await h(),O(!1),await be(k),A(null)}catch(e){console.error(`Wallet connection required for upgrade failed`,e),_e(`error`,QP(e,{context:`connect wallet`}))}finally{te(!1)}},[h,_e,k,be]),Ce=(0,y.useCallback)(()=>{O(!1),T||A(null)},[T]),we=(0,y.useCallback)(async()=>{if(!p)try{te(!0),await h()}catch(e){console.error(`Wallet connection required for new thread`,e);return}finally{te(!1)}try{let e=await o();w(e.threadId),ae(e.threadId),re(!0),se(``),await ve(e.threadId,{silent:!0}),_e(`success`,`New thread created. Invite link is ready to share.`)}catch(e){console.error(`Failed to create new thread`,e),_e(`error`,e.message||`Failed to create new thread`),re(!1),ae(null),se(``)}},[p,h,o,ve,_e]),Te=(0,y.useCallback)(e=>{re(e),e||(ae(null),se(``))},[]),Ee=(0,y.useCallback)(async(e,t)=>{await pR({walletClient:v,inviteDialogThread:ie,inviteLink:oe,contactPubkey:e,contact:t,notifyUser:_e})},[ie,oe,_e,v]),De=(0,y.useCallback)(async e=>{if(!me||!he)return;let t=he.selfPublicKey||`self`,r=Number(e),i=`[SATS_SENT]${Number.isFinite(r)&&r>0?`amount=${r}`:``}`;try{await n(me,{author:t,text:i})}catch(e){console.warn(`[MessagesPage] Failed to post sats system message`,e)}},[me,he,n]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`div`,{className:`flex h-full min-h-[640px] flex-1 overflow-hidden bg-background`,children:[(0,Z.jsx)(jP,{conversations:fe,activeId:me,onSelectConversation:e=>w(e.id),onNewThread:we,searchValue:ue,onSearchChange:de}),(0,Z.jsx)(`div`,{className:`flex flex-1 overflow-hidden`,children:(0,Z.jsx)(NF,{thread:he,messages:ge,participantPubKey:he?.selfPublicKey||`self`,isTyping:!!(me&&c[me]),onSendMessage:async e=>{if(!me)return;f(me);let t=he?.selfPublicKey||`self`;await n(me,{author:t,text:e})},onShowDetails:()=>{},onUpgrade:()=>xe(me),onTyping:()=>{me&&(f(me),l(me))},onGenerateInvite:ye,sendOnEnter:d,onSatsSent:De,onAction:async e=>{if(me){if(e===`burn`)try{await i(me),b({type:`success`,message:`Thread burned successfully`,duration:3e3})}catch(e){console.error(`[MessagesPage] Burn failed:`,e),b({type:`error`,message:QP(e,{context:`burn thread`}),duration:8e3})}else if(e===`leave`)await r(me),w(null);else if(e===`block`){let e=he?.inviter;if(!e)return;await u(e,{source:`thread_overflow`,threadId:me}),w(null)}}},upgradePending:T||m||ee})})]}),(0,Z.jsx)(rR,{open:D,onOpenChange:O,onConfirm:Se,onCancel:Ce,connecting:ee||m}),ne&&(0,Z.jsx)(iR,{onClose:()=>j(!1)}),(0,Z.jsx)(eR,{open:M,onOpenChange:Te,threadId:ie,inviteUrl:oe,loading:ce,onRegenerate:e=>ve(e),notify:(e,t)=>_e(e,t),contacts:x,onSendToContact:Ee,holderPubKey:g})]})}var hR=`nukenote-session-id`;function gR(){if(typeof window>`u`||!window.sessionStorage)return`default-session`;let e=window.sessionStorage.getItem(hR);return e||(e=`session-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,window.sessionStorage.setItem(hR,e)),e}function _R(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name===`Uint8Array`}function vR(e,...t){if(!_R(e))throw Error(`Uint8Array expected`);if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length `+t+`, got length=`+e.length)}function yR(e,t=!0){if(e.destroyed)throw Error(`Hash instance has been destroyed`);if(t&&e.finished)throw Error(`Hash#digest() has already been called`)}function bR(e,t){vR(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least `+n)}function xR(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function SR(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function CR(e,t){return e<<32-t|e>>>t}function wR(e){if(typeof e!=`string`)throw Error(`string expected`);return new Uint8Array(new TextEncoder().encode(e))}function TR(e){return typeof e==`string`&&(e=wR(e)),vR(e),e}var ER=class{};function DR(e){let t=t=>e().update(TR(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function OR(e,t,n,r){if(typeof e.setBigUint64==`function`)return e.setBigUint64(t,n,r);let i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,s,r)}function kR(e,t,n){return e&t^~e&n}function AR(e,t,n){return e&t^e&n^t&n}var jR=class extends ER{constructor(e,t,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=SR(this.buffer)}update(e){yR(this),e=TR(e),vR(e);let{view:t,buffer:n,blockLen:r}=this,i=e.length;for(let a=0;a<i;){let o=Math.min(r-this.pos,i-a);if(o===r){let t=SR(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yR(this),bR(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:a}=this;t[a++]=128,xR(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;OR(n,r-8,BigInt(this.length*8),i),this.process(n,0);let o=SR(e),s=this.outputLen;if(s%4)throw Error(`_sha2: outputLen should be aligned to 32bit`);let c=s/4,l=this.get();if(c>l.length)throw Error(`_sha2: outputLen bigger than state`);for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.destroyed=a,e.finished=i,e.length=r,e.pos=o,r%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const MR=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var NR=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),PR=new Uint32Array(64),FR=class extends jR{constructor(e=32){super(64,e,8,!1),this.A=MR[0]|0,this.B=MR[1]|0,this.C=MR[2]|0,this.D=MR[3]|0,this.E=MR[4]|0,this.F=MR[5]|0,this.G=MR[6]|0,this.H=MR[7]|0}get(){let{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=a|0,this.G=o|0,this.H=s|0}process(e,t){for(let n=0;n<16;n++,t+=4)PR[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=PR[e-15],n=PR[e-2],r=CR(t,7)^CR(t,18)^t>>>3;PR[e]=(CR(n,17)^CR(n,19)^n>>>10)+PR[e-7]+r+PR[e-16]|0}let{A:n,B:r,C:i,D:a,E:o,F:s,G:c,H:l}=this;for(let e=0;e<64;e++){let t=CR(o,6)^CR(o,11)^CR(o,25),u=l+t+kR(o,s,c)+NR[e]+PR[e]|0,d=(CR(n,2)^CR(n,13)^CR(n,22))+AR(n,r,i)|0;l=c,c=s,s=o,o=a+u|0,a=i,i=r,r=n,n=u+d|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,s=s+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,a,o,s,c,l)}roundClean(){xR(PR)}destroy(){this.set(0,0,0,0,0,0,0,0),xR(this.buffer)}};const IR=DR(()=>new FR);var LR=1,RR=`invite`,zR=new Set([`mutual`,`initiator`]);function BR(e){return Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``)}async function VR(e){return e?.payload?.inviter?bA(e.payload.inviter):!1}function HR(e){if(!e)throw Error(`Invite blob required`);try{let t=Vx(e),n=JSON.parse(t),r=UR(n);if(!r.valid){let e=r.errors.join(`, `);throw Error(`Invalid invite payload: ${e}`)}let i=BR(IR(t));return{blob:e,payload:n,hash:i}}catch(e){throw e instanceof SyntaxError?Error(`Invite blob is not valid JSON`):e}}function UR(e){let t=[];if(!e||typeof e!=`object`)return{valid:!1,errors:[`Payload must be an object`]};e.t!==RR&&t.push(`Unexpected payload type ${e.t??`(missing)`}`),e.v!==LR&&t.push(`Unsupported invite version ${e.v??`(missing)`}`),e.threadId||t.push(`threadId missing`),e.inviter||t.push(`inviter missing`),e.wrap||t.push(`wrap missing`),zR.has(e.policy)||t.push(`policy must be one of ${Array.from(zR).join(`, `)}`);let n=Number(e.exp);return Number.isFinite(n)||t.push(`exp (expiry) must be numeric (unix seconds)`),{valid:t.length===0,errors:t}}var WR=l(JM()),GR={IDLE:`idle`,LOADING:`loading`,READY:`ready`,ACCEPTED:`accepted`,DECLINED:`declined`,ERROR:`error`,EXPIRED:`expired`,BLOCKED:`blocked`},KR=e=>Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``),qR=`guest-private-key:`;function JR(e){let t=gR();return`${qR}${t}:${e}`}function YR(e){let[t,n]=(0,y.useState)(GR.IDLE),[r,i]=(0,y.useState)(null),[a,o]=(0,y.useState)(!1),[s,c]=(0,y.useState)(null),[l,u]=(0,y.useState)(null),[d,f]=(0,y.useState)(null),[p,m]=(0,y.useState)(null),h=s?.payload?.threadId,g=(0,y.useMemo)(()=>{if(!s?.payload?.exp)return!1;let e=Number(s.payload.exp)*1e3;return Number.isFinite(e)&&e<Date.now()},[s]),_=(0,y.useCallback)(async()=>{if(!e)return null;let t=HR(e),n=t.payload?.inviter??null,r=n?await VR(t):!1,i=null,a=null;return r||(i=await Vk(t.payload.threadId),a=await tA(JR(t.payload.threadId))),{parsed:t,inviterId:n,blocked:r,existingReceipt:i,existingIdentity:a}},[e]),v=(0,y.useCallback)(e=>{if(!e){c(null),m(null),u(null),f(null),n(GR.IDLE);return}let{parsed:t,inviterId:r,blocked:i,existingReceipt:a,existingIdentity:o}=e;if(c(t),i){m(r),u(null),f(null),n(GR.BLOCKED);return}if(m(null),a?.identityKind===`holder`){f(a),u(null),n(GR.ACCEPTED);return}a&&o?(f(a),u(o),n(GR.ACCEPTED)):(f(null),u(null),n(GR.READY))},[]);(0,y.useEffect)(()=>{let e=!1;async function t(){try{let t=await _();if(e)return;i(null),v(t)}catch(t){if(e)return;c(null),u(null),f(null),m(null),i(t.message||`Failed to parse invite`),n(GR.ERROR)}}return t(),()=>{e=!0}},[_,v]);let b=(0,y.useCallback)(async()=>{if(s){if(t===GR.BLOCKED){i(`This inviter is blocked. Unblock to accept the invite.`);return}o(!0),i(null);try{let e=s.payload.threadId;if((await Vk(e))?.identityKind===`holder`){i(`This device is already the thread creator for this thread.`),n(GR.ERROR);return}let t,r,a=s.payload?.guest,o=a?.keyDerivation;if(o?.privateKeyHex&&a?.publicKey){t=o.privateKeyHex,r=a.publicKey;try{let e=WR.getPublicKey(t,!0);(typeof e==`string`?e:KR(e))!==r&&console.warn(`[useGuestThreadJoin] Guest key mismatch between seed and publicKey; using invite publicKey`)}catch(e){console.warn(`[useGuestThreadJoin] Failed to derive guest public key from invite seed`,e)}}else{let e=WR.utils.randomPrivateKey();t=KR(e);let n=WR.getPublicKey(t,!0);r=typeof n==`string`?n:KR(n)}let c=JR(e),l={id:c,kind:`guest`,threadId:e,privateKey:t,publicKey:r,createdAt:new Date().toISOString(),sessionId:gR()},d=s.payload.tokens?.ct||null,p=s.payload.tokens?.dtIssuance||null,m=typeof d?.vout==`number`&&Number.isInteger(d.vout)&&d.vout>=0?d.vout:null,h=p?[{txid:p.txid,outputs:(p.outputs||[]).map(e=>({...e,recipientPubkey:e.recipientPubkey||r,txid:e.txid||p.txid}))}]:[];(!d?.txid||h.length===0||h[0].outputs.length===0)&&console.warn(`[useGuestThreadJoin] Invite missing CT/DT tokens - guest may not be able to send messages`);let g={threadId:e,inviter:s.payload.inviter,holderPublicKey:s.payload.inviter,peerWalletPublicKey:s.payload.inviter,policy:s.payload.policy,wrap:s.payload.wrap,inviteHash:s.hash,acceptedAt:new Date().toISOString(),guestPublicKey:r,guestIdentityId:c,identityKind:`guest`,status:`ready`,supportsLeave:!0,ctTxid:d?.txid||null,ctVout:m,dtIssuances:h,lastMintTxid:p?.txid||null,inviterProfile:s.payload.meta?.inviterProfile||null};await eA(c,l),await Bk(e,g);let _=s.payload.meta?.inviterProfile;if(_&&_.displayName&&s.payload.inviter)try{await $A(s.payload.inviter,{displayName:_.displayName,avatarHash:_.avatarHash||null}),console.log(`[useGuestThreadJoin] Saved inviter profile to store:`,{inviter:s.payload.inviter.slice(0,16)+`...`,displayName:_.displayName})}catch(e){console.warn(`[useGuestThreadJoin] Failed to save inviter profile:`,e)}u(l),f(g),n(GR.ACCEPTED)}catch(e){i(e.message||`Failed to accept invite`),n(GR.ERROR)}finally{o(!1)}}},[s,t]),x=(0,y.useCallback)(()=>{n(GR.DECLINED)},[]),S=(0,y.useCallback)(()=>{n(GR.READY),i(null),u(null),f(null)},[]),C=(0,y.useCallback)(async()=>{if(p){o(!0),i(null);try{await yA(p);let e=await _();v(e)}catch(e){i(e.message||`Failed to unblock inviter`),n(GR.ERROR)}finally{o(!1)}}},[p,v,_]);return{status:t,STATUS:GR,blockedInviter:p,isExpired:g,invite:s,threadId:h,error:r,loading:a,guestIdentity:l,joinReceipt:d,acceptAsGuest:b,declineInvite:x,reset:S,unblockInviter:C}}function XR(){let e=Ve(),{blob:t}=Ge(),{status:n,STATUS:r,invite:i,isExpired:a,error:o,loading:s,acceptAsGuest:c,declineInvite:l,blockedInviter:u,unblockInviter:d}=YR(t),f=i?.payload,p=(0,y.useMemo)(()=>f&&(f.inviterName||f.inviterLabel||f.inviter)||`Unknown inviter`,[f]),m=(0,y.useMemo)(()=>!p||p===`Unknown inviter`||p===`New Thread`?`Alice`:p,[p]),[h,g]=(0,y.useState)(!1),_=(0,y.useMemo)(()=>async()=>{if(!h){if(!i?.payload?.inviter){l();return}try{g(!0),await vA(i.payload.inviter,{reason:`invite_decline`,blockedVia:`invite_page`,inviteHash:i.hash||null})}catch(e){console.error(`Failed to block inviter during decline`,e)}finally{g(!1),l()}}},[h,l,i]);(0,y.useEffect)(()=>{t||e(`/messages`,{replace:!0})},[t,e]),(0,y.useEffect)(()=>{n===r.ACCEPTED&&e(`/messages`,{replace:!0})},[e,n,r]);let v=n===r.BLOCKED,b=n===r.READY&&!a&&!v,x=n===r.DECLINED,S=n===r.ERROR||a&&!v;return(0,Z.jsx)(`div`,{className:`flex min-h-screen items-center justify-center bg-background px-4 py-10`,children:(0,Z.jsx)(FA,{className:`w-full max-w-md shadow-lg`,children:(0,Z.jsxs)(zA,{className:`space-y-6 p-6`,children:[S&&(0,Z.jsx)(`div`,{className:`rounded-md border border-destructive/40 bg-destructive/10 px-3 py-2 text-xs text-destructive`,children:a?`This invite has expired.`:o||`Unable to load invite. Please check the link.`}),v&&(0,Z.jsxs)(`div`,{className:`space-y-3 rounded-md border border-muted-foreground/20 bg-muted/20 px-3 py-3`,children:[(0,Z.jsxs)(`div`,{className:`space-y-1`,children:[(0,Z.jsx)(`p`,{className:`text-sm font-semibold text-foreground`,children:`Inviter blocked`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`This inviter is on your block list. To review the invite or message them again, unblock first.`})]}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,Z.jsx)(Badge,{variant:`outline`,children:Bx(u,28)}),(0,Z.jsx)($,{size:`sm`,onClick:d,disabled:s,children:s?`Unblocking`:`Unblock inviter`}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>e(`/messages`),className:`ml-auto`,children:`Back to messages`})]})]}),f&&(0,Z.jsxs)(`div`,{className:`space-y-3`,children:[(0,Z.jsxs)(`div`,{className:`space-y-1`,children:[(0,Z.jsxs)(`p`,{className:`text-base font-semibold text-foreground`,children:[m,` has invited you to an Encrypted P2P Chat`]}),(0,Z.jsxs)(`p`,{className:`text-sm leading-5 text-muted-foreground`,children:[`All data is end-to-end encrypted on `,m,`'s device and yours. Your data is erased when you leave the chat.`]})]}),a&&(0,Z.jsx)(`div`,{className:`rounded-md border border-destructive/40 bg-destructive/10 px-3 py-2 text-[11px] text-destructive`,children:`This invite has expired.`})]}),s&&(0,Z.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Preparing guest identity`}),b&&(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)($,{onClick:c,disabled:s||h,size:`sm`,className:`w-full`,children:s?`Joining`:`Join Chat`}),(0,Z.jsx)($,{onClick:_,disabled:s||h,size:`sm`,variant:`outline`,className:`w-full`,children:h?`Blocking`:`Decline & block`}),(0,Z.jsx)(`p`,{className:`text-[11px] text-muted-foreground`,children:`Accepting creates a local guest session. You can connect a wallet later for more features.`})]}),x&&(0,Z.jsx)(`div`,{className:`rounded-md border border-muted/30 bg-muted/10 px-3 py-2 text-xs text-muted-foreground`,children:`Invite declined. You can close this window.`})]})})})}var ZR={ok:`secondary`,pending:`outline`,danger:`destructive`};function QR(){let e=(0,y.useMemo)(()=>({summary:[{id:`relay-handshake`,label:`Relay handshake`,value:`Awaiting Desktop overlay helper`,tone:`pending`},{id:`presence-feed`,label:`Presence feed`,value:`Dormant  no active sockets`,tone:`pending`},{id:`burn-watch`,label:`Burn watchdog`,value:`Idle  CT heartbeat disabled`,tone:`ok`}],relays:[{id:`relay-001`,name:`localhost overlay helper`,transport:`WebSocket`,status:`pending`,lastSeen:``,pointerDepth:0},{id:`relay-002`,name:`Metanet Desktop sidecar`,transport:`XDM bridge`,status:`pending`,lastSeen:`Not connected`,pointerDepth:0}],events:[{id:`evt-001`,time:`12:04:11`,scope:`overlay`,message:`Overlay console initialised. Awaiting relay handshake.`},{id:`evt-002`,time:`12:04:13`,scope:`presence`,message:`No presence sockets registered yet.`},{id:`evt-003`,time:`12:05:02`,scope:`watchdog`,message:`CT burn watchdog paused until overlay helpers connect.`}]}),[]);return(0,Z.jsxs)(`div`,{className:`mx-auto flex max-w-5xl flex-col gap-6`,children:[(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`h1`,{className:`text-3xl font-semibold tracking-tight sm:text-4xl`,children:`Overlay Console`}),(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`Monitor pointer, presence, and acknowledgement traffic as the messaging overlay comes online.`})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`System status`}),(0,Z.jsx)(RA,{children:`Live relay metrics will appear once a helper service connects to your wallet identity.`})]}),(0,Z.jsx)(zA,{className:`grid gap-4 sm:grid-cols-2`,children:e.summary.map(({id:e,label:t,value:n,tone:r})=>(0,Z.jsxs)(`div`,{className:`rounded-md border border-muted-foreground/20 bg-muted/20 p-4`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between text-xs uppercase tracking-wide text-muted-foreground`,children:[(0,Z.jsx)(`span`,{children:t}),(0,Z.jsx)(HA,{variant:ZR[r]??`secondary`,className:`text-[10px]`,children:r})]}),(0,Z.jsx)(`p`,{className:`mt-2 text-sm text-foreground/80`,children:n})]},e))})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Relay inventory`}),(0,Z.jsx)(RA,{children:`Targets the overlay will negotiate with once the helper bridge is active.`})]}),(0,Z.jsxs)(zA,{className:`space-y-3 text-sm text-muted-foreground`,children:[e.relays.map(({id:e,name:t,transport:n,status:r,lastSeen:i,pointerDepth:a})=>(0,Z.jsxs)(`div`,{className:`flex flex-col gap-1 rounded-md border border-dashed border-muted-foreground/30 bg-muted/10 p-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`font-medium text-foreground/80`,children:t}),(0,Z.jsxs)(`p`,{className:`text-xs`,children:[`Transport: `,n]})]}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-3 text-xs`,children:[(0,Z.jsx)(HA,{variant:ZR[r]??`outline`,className:`capitalize`,children:r}),(0,Z.jsxs)(`span`,{children:[`Last seen: `,i]}),(0,Z.jsxs)(`span`,{children:[`Pointer depth: `,a]})]})]},e)),(0,Z.jsx)(zT,{}),(0,Z.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Z.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:`Overlay relays are disabled in the current build. Start the helper bridge to activate this panel.`}),(0,Z.jsx)($,{size:`sm`,variant:`outline`,disabled:!0,children:`Awaiting helper`})]})]})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Event log`}),(0,Z.jsx)(RA,{children:`Once connected, this feed will stream presence, pointer, and burn watchdog activity.`})]}),(0,Z.jsxs)(zA,{className:`space-y-2 text-sm`,children:[(0,Z.jsx)(`div`,{className:`rounded-md border border-muted-foreground/30 bg-muted/10`,children:(0,Z.jsx)(`ul`,{className:`divide-y divide-muted-foreground/20`,children:e.events.map(({id:e,time:t,scope:n,message:r})=>(0,Z.jsxs)(`li`,{className:`flex flex-col gap-1 px-4 py-2 sm:flex-row sm:items-center sm:gap-3`,children:[(0,Z.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:t}),(0,Z.jsx)(HA,{variant:`outline`,className:`w-fit text-[10px] uppercase tracking-wide`,children:n}),(0,Z.jsx)(`p`,{className:`text-sm text-foreground/80`,children:r})]},e))})}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Diagnostic entries persist locally during this session. They will reset once a relay handshake completes.`})]})]})]})}function $R({section:e,isActive:t,onSelect:n}){let r=e.icon;return(0,Z.jsxs)(`button`,{type:`button`,onClick:()=>n(e.id),className:Q(`flex w-full items-center gap-3 px-3 py-3 text-left transition`,t?`bg-primary/10 text-primary`:`hover:bg-muted`),children:[r&&(0,Z.jsx)(r,{className:`h-5 w-5`}),(0,Z.jsx)(`div`,{className:`flex-1`,children:(0,Z.jsx)(`p`,{className:`text-sm font-medium leading-tight text-foreground`,children:e.label})})]})}function ez({sections:e,activeSectionId:t,onSelectSection:n}){return e?.length?(0,Z.jsx)(`div`,{className:`space-y-3`,children:e.map(e=>(0,Z.jsx)($R,{section:e,isActive:e.id===t,onSelect:n},e.id))}):(0,Z.jsx)(`div`,{className:`rounded-md border border-dashed border-muted-foreground/40 bg-muted/10 p-6 text-sm text-muted-foreground`,children:`No settings categories defined yet.`})}function tz({sections:e=[],activeSectionId:t,onSelectSection:n,searchValue:r,onSearchChange:i}){let{railCollapsed:a}=(0,y.useContext)(Vb);return(0,Z.jsxs)(`aside`,{className:Q(`flex h-full max-h-full w-full flex-col border-border bg-muted/10 transition-all duration-300`,`md:w-[320px] md:min-w-[320px] md:border-r`),children:[(0,Z.jsx)(`div`,{className:Q(`flex items-center justify-between gap-3 py-4 transition-all duration-300`,a?`pl-16 pr-4`:`px-4`),children:(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold leading-tight`,children:`Settings`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Choose a category`})]})}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-y-auto px-2 py-3`,children:(0,Z.jsx)(ez,{sections:e,activeSectionId:t,onSelectSection:n})}),(0,Z.jsx)(`div`,{className:`border-t border-border px-4 py-3`,children:(0,Z.jsx)(GA,{value:r,onChange:e=>i?.(e.target.value),placeholder:`Search settings`,className:`h-9 bg-background/60`})})]})}function nz({guestThreads:e,upgradingThreadId:t,upgradeErrorByThread:n,walletLoading:r,onUpgrade:i}){return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Guest conversations you can link to your wallet`}),(0,Z.jsx)(RA,{children:`These are chats running in guest mode. Linking them to your wallet lets you keep using them after you switch devices and send your own invites, using a small on-chain action approved by your wallet.`})]}),(0,Z.jsx)(zA,{className:`space-y-3 text-sm`,children:e.length===0?(0,Z.jsx)(`p`,{className:`text-muted-foreground`,children:`All threads are already wallet-linked. No action required.`}):e.map(e=>{let a=t===e.id,o=n[e.id];return(0,Z.jsx)(`div`,{className:`rounded-lg border border-border/60 bg-muted/10 px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{className:`space-y-1`,children:[(0,Z.jsx)(`p`,{className:`font-medium text-foreground`,children:e.title}),(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Status: `,e.status===`ready`?`Guest ready`:e.status]}),o&&(0,Z.jsx)(`p`,{className:`text-xs text-destructive`,children:o})]}),(0,Z.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,Z.jsx)($,{size:`sm`,onClick:()=>i(e.id),disabled:r||a,children:a?`Linking`:`Link this chat to my wallet`})})]})},e.id)})})]})}var rz=`Progress`,iz=100,[az,oz]=sS(rz),[sz,cz]=az(rz),lz=y.forwardRef((e,t)=>{let{__scopeProgress:n,value:r=null,max:i,getValueLabel:a=fz,...o}=e;(i||i===0)&&!hz(i)&&console.error(_z(`${i}`,`Progress`));let s=hz(i)?i:iz;r!==null&&!gz(r,s)&&console.error(vz(`${r}`,`Progress`));let c=gz(r,s)?r:null,l=mz(c)?a(c,s):void 0;return(0,Z.jsx)(sz,{scope:n,value:c,max:s,children:(0,Z.jsx)(vS.div,{"aria-valuemax":s,"aria-valuemin":0,"aria-valuenow":mz(c)?c:void 0,"aria-valuetext":l,role:`progressbar`,"data-state":pz(c,s),"data-value":c??void 0,"data-max":s,...o,ref:t})})});lz.displayName=rz;var uz=`ProgressIndicator`,dz=y.forwardRef((e,t)=>{let{__scopeProgress:n,...r}=e,i=cz(uz,n);return(0,Z.jsx)(vS.div,{"data-state":pz(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...r,ref:t})});dz.displayName=uz;function fz(e,t){return`${Math.round(e/t*100)}%`}function pz(e,t){return e==null?`indeterminate`:e===t?`complete`:`loading`}function mz(e){return typeof e==`number`}function hz(e){return mz(e)&&!isNaN(e)&&e>0}function gz(e,t){return mz(e)&&!isNaN(e)&&e<=t&&e>=0}function _z(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${iz}\`.`}function vz(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${iz} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var yz=lz,bz=dz,xz=y.forwardRef(({className:e,value:t,indicatorClassName:n,...r},i)=>(0,Z.jsx)(yz,{ref:i,className:Q(`relative h-2 w-full overflow-hidden rounded-full bg-muted`,e),...r,children:(0,Z.jsx)(bz,{className:Q(`h-full w-full flex-1 bg-primary transition-all`,n),style:{transform:`translateX(-${100-(t||0)}%)`},children:(0,Z.jsxs)(`span`,{className:`sr-only`,children:[t||0,`%`]})})}));xz.displayName=yz.displayName;function Sz({overlayDiagnostics:e}){return e?(0,Z.jsxs)(`section`,{className:`space-y-6 text-sm`,children:[(0,Z.jsxs)(`header`,{className:`space-y-1.5`,children:[(0,Z.jsx)(`h3`,{className:`text-base font-semibold leading-none tracking-tight`,children:`Connection diagnostics`}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Quick check that live messaging, offline delivery, and background payments are working as expected.`})]}),(0,Z.jsx)(`div`,{className:`grid gap-4 sm:grid-cols-2`,children:e.summary.map(({id:e,label:t,value:n,tone:r})=>(0,Z.jsxs)(`div`,{className:`rounded-md border border-muted-foreground/20 bg-muted/20 p-4`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between text-[11px] uppercase tracking-wide text-muted-foreground`,children:[(0,Z.jsx)(`span`,{children:t}),(0,Z.jsx)(HA,{variant:r===`danger`?`destructive`:`outline`,className:Q(`text-[10px]`,(r===`ok`||r===`online`)&&`border-emerald-500/60 bg-emerald-500/10 text-emerald-600`),children:r})]}),(0,Z.jsx)(`p`,{className:`mt-2 text-sm text-foreground/80`,children:n})]},e))}),(0,Z.jsx)(`div`,{className:`space-y-3 text-sm text-muted-foreground`,children:e.relays.map(({id:e,name:t,transport:n,status:r,lastSeen:i,reconnects:a,avgRtt:o})=>{let s=String(r||``).toLowerCase(),c=s===`online`,l=s===`offline`||s===`disconnected`,u=s===`stub`||s===``?`local only`:r;return(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-md border border-dashed border-muted-foreground/30 bg-muted/10 p-3`,children:[(0,Z.jsxs)(`div`,{className:`flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`font-medium text-foreground/80`,children:t}),(0,Z.jsxs)(`p`,{className:`text-xs`,children:[`Transport: `,n]})]}),(0,Z.jsx)(`div`,{className:`flex items-center gap-3 text-xs`,children:(0,Z.jsx)(HA,{variant:l?`destructive`:`outline`,className:Q(`capitalize`,c&&`border-emerald-500/60 bg-emerald-500/10 text-emerald-600`),children:u})})]}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap gap-x-4 gap-y-1 text-xs`,children:[(0,Z.jsxs)(`span`,{children:[`Last seen: `,i]}),a>0&&(0,Z.jsxs)(`span`,{className:`text-amber-600 dark:text-amber-400`,children:[`Reconnects: `,a]}),o!=null&&c&&(0,Z.jsxs)(`span`,{className:`text-emerald-600 dark:text-emerald-400`,children:[`Avg RTT: `,o,`ms`]})]})]},e)})}),!1]}):null}function Cz(e){if(!e)return`Unknown`;try{return new Date(e).toLocaleString()}catch(t){return console.warn(`Unable to format timestamp`,e,t),e}}function wz({blockedInviters:e=[],onUnblock:t,syncStatus:n=`Local only`}){let r=e.length>0;return(0,Z.jsxs)(`div`,{className:`space-y-3`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Inviters you have blocked across threads and invites.`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground/80`,children:`Overlay syncing keeps this list consistent across devices; until then it stays local to this browser.`})]}),(0,Z.jsx)(HA,{variant:`outline`,children:n})]}),r?(0,Z.jsx)(`div`,{className:`overflow-hidden rounded-md border border-muted-foreground/20`,children:(0,Z.jsxs)(`table`,{className:`w-full text-left text-sm`,children:[(0,Z.jsx)(`thead`,{className:`bg-muted/40 text-xs uppercase tracking-wide text-muted-foreground`,children:(0,Z.jsxs)(`tr`,{children:[(0,Z.jsx)(`th`,{className:`px-4 py-2`,children:`Inviter key`}),(0,Z.jsx)(`th`,{className:`px-4 py-2`,children:`Blocked at`}),(0,Z.jsx)(`th`,{className:`px-4 py-2 text-right`,children:`Actions`})]})}),(0,Z.jsx)(`tbody`,{children:e.map(e=>(0,Z.jsxs)(`tr`,{className:`border-t border-muted-foreground/10`,children:[(0,Z.jsx)(`td`,{className:`px-4 py-2 font-mono text-xs text-foreground/80`,children:e.id}),(0,Z.jsx)(`td`,{className:`px-4 py-2 text-xs text-muted-foreground`,children:Cz(e.blockedAt)}),(0,Z.jsx)(`td`,{className:`px-4 py-2 text-right`,children:(0,Z.jsx)($,{size:`xs`,variant:`outline`,onClick:()=>t?.(e.id),children:`Unblock`})})]},e.id))})]})}):(0,Z.jsx)(`div`,{className:`rounded-md border border-dashed border-muted-foreground/30 px-4 py-6 text-center text-sm text-muted-foreground`,children:`No inviters are currently blocked.`})]})}var Tz=`Switch`,[Ez,Dz]=sS(Tz),[Oz,kz]=Ez(Tz),Az=y.forwardRef((e,t)=>{let{__scopeSwitch:n,name:r,checked:i,defaultChecked:a,required:o,disabled:s,value:c=`on`,onCheckedChange:l,form:u,...d}=e,[f,p]=y.useState(null),m=Kx(t,e=>p(e)),h=y.useRef(!1),g=f?u||!!f.closest(`form`):!0,[_,v]=mS({prop:i,defaultProp:a??!1,onChange:l,caller:Tz});return(0,Z.jsxs)(Oz,{scope:n,checked:_,disabled:s,children:[(0,Z.jsx)(vS.button,{type:`button`,role:`switch`,"aria-checked":_,"aria-required":o,"data-state":Fz(_),"data-disabled":s?``:void 0,disabled:s,value:c,...d,ref:m,onClick:aS(e.onClick,e=>{v(e=>!e),g&&(h.current=e.isPropagationStopped(),h.current||e.stopPropagation())})}),g&&(0,Z.jsx)(Pz,{control:f,bubbles:!h.current,name:r,value:c,checked:_,required:o,disabled:s,form:u,style:{transform:`translateX(-100%)`}})]})});Az.displayName=Tz;var jz=`SwitchThumb`,Mz=y.forwardRef((e,t)=>{let{__scopeSwitch:n,...r}=e,i=kz(jz,n);return(0,Z.jsx)(vS.span,{"data-state":Fz(i.checked),"data-disabled":i.disabled?``:void 0,...r,ref:t})});Mz.displayName=jz;var Nz=`SwitchBubbleInput`,Pz=y.forwardRef(({__scopeSwitch:e,control:t,checked:n,bubbles:r=!0,...i},a)=>{let o=y.useRef(null),s=Kx(o,a),c=gI(n),l=sO(t);return y.useEffect(()=>{let e=o.current;if(!e)return;let t=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(t,`checked`).set;if(c!==n&&i){let t=new Event(`click`,{bubbles:r});i.call(e,n),e.dispatchEvent(t)}},[c,n,r]),(0,Z.jsx)(`input`,{type:`checkbox`,"aria-hidden":!0,defaultChecked:n,...i,tabIndex:-1,ref:s,style:{...i.style,...l,position:`absolute`,pointerEvents:`none`,opacity:0,margin:0}})});Pz.displayName=Nz;function Fz(e){return e?`checked`:`unchecked`}var Iz=Az,Lz=Mz,Rz=y.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(Iz,{className:Q(`peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input`,e),...t,ref:n,children:(0,Z.jsx)(Lz,{className:Q(`pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0`)})}));Rz.displayName=Iz.displayName;function zz({remoteSyncPreference:e,remoteSyncStatus:t,setRemoteSyncEnabled:n,blockedInviters:r,unblockInviter:i,syncStatus:a}){return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Privacy & Blocking`}),(0,Z.jsx)(RA,{children:`Manage remote sync preferences and blocked inviters.`})]}),(0,Z.jsxs)(zA,{className:`space-y-6`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border border-border bg-muted/20 p-4`,children:[(0,Z.jsxs)(`div`,{className:`pr-4`,children:[(0,Z.jsx)(`h3`,{className:`font-medium`,children:`Multi-device vault sync`}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:e.configEnabled?`Sync thread metadata across your devices via remote messaging service.`:`Multi-device sync requires configuration. Provide REMOTE_MESSAGING_API_URL and enable the flag to opt in.`}),e.configEnabled?(0,Z.jsx)(`p`,{className:`mt-1 text-xs text-muted-foreground/80`,children:t}):(0,Z.jsxs)(`p`,{className:`mt-1 text-xs text-muted-foreground/80`,children:[`Set `,(0,Z.jsx)(`code`,{className:`rounded bg-muted px-1`,children:`VITE_REMOTE_MESSAGING_API_URL`}),` and`,(0,Z.jsx)(`code`,{className:`ml-1 rounded bg-muted px-1`,children:`VITE_REMOTE_MESSAGING_ENABLED=true`}),` to enable remote sync.`]})]}),(0,Z.jsx)(Rz,{checked:e.effective,disabled:!e.configEnabled,onCheckedChange:n})]}),(0,Z.jsx)(wz,{blockedInviters:r,onUnblock:i,syncStatus:a})]})]})}function Bz({walletConnected:e,hasGuestThreads:t=!1}){let n=Ve();return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsxs)(LA,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(Fb,{className:`h-5 w-5`}),`Profile`]}),(0,Z.jsx)(RA,{children:`Manage your identity and how others see you`})]}),(0,Z.jsx)(zA,{className:`space-y-2`,children:e?(0,Z.jsxs)($,{variant:`outline`,className:`w-full justify-between`,onClick:()=>n(`/settings/profile`),children:[(0,Z.jsx)(`span`,{children:`Edit display name`}),(0,Z.jsx)(fb,{className:`h-4 w-4`})]}):t?(0,Z.jsxs)($,{variant:`outline`,className:`w-full justify-between`,onClick:()=>n(`/settings/guest-profile`),children:[(0,Z.jsx)(`span`,{children:`Edit Display Name (Guest)`}),(0,Z.jsx)(fb,{className:`h-4 w-4`})]}):(0,Z.jsx)(`div`,{className:`rounded-lg border border-muted-foreground/20 bg-muted/10 p-4 text-center`,children:(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Connect your wallet or join a thread to set up your profile`})})})]})}function Vz(){return(0,Z.jsxs)(`div`,{className:`space-y-2 text-sm text-muted-foreground`,children:[(0,Z.jsx)(`p`,{className:`font-medium text-foreground`,children:`Session approvals & spend caps`}),(0,Z.jsx)(`p`,{children:`Your wallet is called for all spending to create new threads, burn existing threads and create bitcoin transfers. There are no other charges or per-message fees within a thread.`}),(0,Z.jsx)(`p`,{className:`text-xs`,children:`To change spend caps, open your wallet and adjust session or policy settings there.`})]})}function Hz({walletConnected:e}){let{addNotification:t}=Gy(),[n,r]=(0,y.useState)(`1,000,000`),[i,a]=(0,y.useState)(!1),o=Ks.HELPER_CACHE_ENDPOINT||``,s=typeof o==`string`&&o.length>0,c=[{value:1e4,label:`10K sats`},{value:5e4,label:`50K sats`},{value:1e5,label:`100K sats`}],l=async(r=null)=>{if(!e){t({type:`error`,message:`Connect a BRC-100 compatible wallet to send a donation.`,duration:6e3});return}if(!s){t({type:`error`,message:`Donation server is not configured.`,duration:6e3});return}let i=(()=>{if(r!==null)return r;let e=typeof n==`string`?n.replace(/,/g,``).trim():n;return Number(e)})();if(!Number.isFinite(i)||!Number.isInteger(i)||i<=0){t({type:`error`,message:`Amount must be a positive whole number of sats.`,duration:5e3});return}a(!0);try{t({type:`success`,message:`Bitcoin payment created. Your wallet will ask for confirmation.`,duration:8e3});let e=await zy({amountSats:i,description:`NukeNote donation (${i.toLocaleString()} sats)`});t({type:`success`,message:`Donation sent! Transaction: ${e.txid?.slice(0,12)}...`,duration:8e3})}catch(e){console.error(`[DonateSection] Failed to send donation`,e),t({type:`error`,message:QP(e,{context:`send donation`}),duration:8e3})}finally{a(!1)}};return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Support NukeNote`}),(0,Z.jsx)(RA,{children:`Send a Bitcoin donation to help cover development and infrastructure costs.`})]}),(0,Z.jsxs)(zA,{className:`space-y-4 text-sm text-muted-foreground`,children:[!s&&(0,Z.jsx)(`p`,{className:`text-xs text-amber-500`,children:`Donation server is not configured. Set VITE_HELPER_CACHE_ENDPOINT in your environment to enable this.`}),s&&(0,Z.jsx)(`p`,{children:`Each donation is sent to a newly generated address.`}),(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground/80`,children:`Quick amounts`}),(0,Z.jsx)(`div`,{className:`grid grid-cols-3 gap-2`,children:c.map(e=>(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>l(e.value),disabled:i||!s,className:`h-auto flex-col gap-0.5 py-2`,children:(0,Z.jsx)(`span`,{className:`text-xs font-semibold`,children:e.label})},e.value))})]}),(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground/80`,children:`Or enter a custom amount:`}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(GA,{type:`text`,value:n,onChange:e=>{let t=e.target.value.replace(/,/g,``);if(t===``){r(``);return}let n=Number(t);!Number.isFinite(n)||n<0||r(n.toLocaleString(`en-US`))},className:`w-32`,placeholder:`1,000,000`,disabled:i}),(0,Z.jsx)(`span`,{className:`text-xs text-muted-foreground/80`,children:`sats`}),(0,Z.jsx)($,{size:`sm`,onClick:()=>l(),disabled:i||!s,children:i?`Sending`:`Send donation`})]})]}),s&&null]})]})}function Uz(e){return typeof e!=`string`||e.length<=18?e:`${e.slice(0,10)}${e.slice(-6)}`}function Wz({walletConnected:e,walletLoading:t,walletType:n,network:r,version:i,identityKey:a,connectionError:o,syncStatus:s,onConnect:c,onConnectBrc6:l}){let u=(0,y.useMemo)(()=>e?(0,Z.jsxs)(`div`,{className:`rounded-md border border-emerald-200 bg-emerald-50 px-3 py-2 text-emerald-900 dark:border-emerald-900/40 dark:bg-emerald-900/10 dark:text-emerald-100`,children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`Wallet ready for on-chain actions`}),a&&(0,Z.jsxs)(`p`,{className:`flex items-center gap-2 text-xs opacity-80`,children:[(0,Z.jsxs)(`span`,{children:[`Identity key: `,(0,Z.jsx)(`code`,{children:Uz(a)})]}),(0,Z.jsx)($,{size:`xs`,variant:`outline`,onClick:()=>{try{navigator?.clipboard?.writeText(a)}catch(e){console.warn(`Failed to copy identity key`,e)}},children:`Copy full key`})]}),(0,Z.jsx)(`p`,{className:`mt-1 text-[11px] opacity-80`,children:`Set a spending cap in your wallet so on-chain thread setup and upgrades can stay quiet in the background.`})]}):(0,Z.jsxs)(`div`,{className:`rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-amber-900 dark:border-amber-900/40 dark:bg-amber-900/10 dark:text-amber-100`,children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`No wallet connected (guest messaging still works)`}),(0,Z.jsxs)(`ul`,{className:`mt-1 list-disc space-y-1 pl-4 text-xs opacity-80`,children:[(0,Z.jsx)(`li`,{children:`Connect only when you need to set up on-chain access for threads or upgrade them to a holder wallet.`}),(0,Z.jsxs)(`li`,{children:[`No wallet installed? Get`,` `,(0,Z.jsx)(`a`,{href:`https://getmetanet.com/#desktop`,target:`_blank`,rel:`noreferrer`,className:`underline`,children:`Metanet Desktop`}),` `,`and keep it running while you use Nullify.`]}),(0,Z.jsx)(`li`,{children:`Start Metanet Desktop and enable the BRC-6 bridge when you want to use your wallet.`}),(0,Z.jsx)(`li`,{children:`If you have a BRC-7 browser wallet, ensure it injects window.CWI before loading the invite link.`}),(0,Z.jsx)(`li`,{children:`Set a spending cap in your wallet so approvals stay pre-authorized and mostly silent.`})]})]}),[e,a]);return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Wallet connection`}),(0,Z.jsx)(RA,{children:`Used for on-chain actions like creating thread access tokens or upgrading threads. Guest messaging works without a wallet; connect when needed and keep a spending cap set in your wallet.`})]}),(0,Z.jsxs)(zA,{className:`space-y-4 text-sm`,children:[u,o&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`p`,{className:`text-xs text-destructive`,children:o}),/access control checks|not allowed to request resource/i.test(o)&&(0,Z.jsx)(`p`,{className:`mt-1 text-xs text-muted-foreground`,children:`Your browser is blocking Nullify from reaching your local wallet on this machine (for example Metanet Desktop on http://localhost:3321). This can happen when Nullify is loaded over HTTPS and tries to call a local HTTP port. For local testing, run Nullify from a http://localhost address or use the desktop-bundled version, and keep your wallet running.`})]}),(0,Z.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,Z.jsx)($,{size:`sm`,onClick:c,disabled:t,children:t?`Connecting`:e?`Reconnect wallet`:`Connect wallet`}),l&&(0,Z.jsx)($,{size:`sm`,variant:`outline`,onClick:()=>{try{typeof window<`u`&&window.open(`https://getmetanet.com/#desktop`,`_blank`,`noopener,noreferrer`)}catch(e){console.warn(`Failed to open Metanet site`,e)}l?.()},disabled:t,children:`Get Metanet`})]})]})]})}function Gz({sendOnEnter:e,setSendOnEnter:t,typingIndicatorEnabled:n,setTypingIndicatorEnabled:r}){return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Threads & messaging`}),(0,Z.jsx)(RA,{children:`Messaging shortcuts and thread defaults.`})]}),(0,Z.jsxs)(zA,{className:`space-y-4`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border border-border bg-muted/20 p-4`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h3`,{className:`font-medium`,children:`Send messages with Enter`}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`When enabled, press Enter to send and Shift+Enter for a new line.`})]}),(0,Z.jsx)(Rz,{checked:e,onCheckedChange:t})]}),(0,Z.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border border-border bg-muted/20 p-4`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h3`,{className:`font-medium`,children:`Typing indicator`}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Show when you are typing and display incoming typing status.`})]}),(0,Z.jsx)(Rz,{checked:n,onCheckedChange:r})]})]})]})}var Kz=[{id:`light`,label:`Light`},{id:`dark`,label:`Dark`},{id:`system`,label:`System`}],qz=[{id:`sm`,label:`Small`},{id:`md`,label:`Default`},{id:`lg`,label:`Large`}];function Jz(){let{theme:e,setTheme:t,textScale:n=`md`,setTextScale:r}=OP();return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Appearance`}),(0,Z.jsx)(RA,{children:`Theme and text size on this device.`})]}),(0,Z.jsxs)(zA,{className:`space-y-4`,children:[(0,Z.jsxs)(`div`,{className:`flex flex-col gap-3 rounded-lg border border-border bg-muted/20 p-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h3`,{className:`font-medium`,children:`Theme`}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Switch between light, dark, or follow your system setting.`})]}),(0,Z.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:Kz.map(n=>(0,Z.jsx)($,{type:`button`,size:`sm`,variant:e===n.id?`default`:`outline`,onClick:()=>t(n.id),children:n.label},n.id))})]}),(0,Z.jsxs)(`div`,{className:`flex flex-col gap-3 rounded-lg border border-border bg-muted/20 p-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h3`,{className:`font-medium`,children:`Text size`}),(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Adjust chat text and thread previews.`})]}),(0,Z.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:qz.map(e=>(0,Z.jsx)($,{type:`button`,size:`sm`,variant:n===e.id?`default`:`outline`,onClick:()=>r(e.id),children:e.label},e.id))})]})]})]})}var Yz=`wallet-spend-caps`;const Xz=1e3;async function Zz(){try{let e=await TA.getItem(Yz);if(!e||typeof e!=`object`)return{satsPerMessage:25,dailyCapSats:Xz};let t=Number.parseInt(e.satsPerMessage??25,10),n=Number.parseInt(e.dailyCapSats??1e3,10);return{satsPerMessage:Number.isFinite(t)&&t>=0?t:25,dailyCapSats:Number.isFinite(n)&&n>=0?n:Xz}}catch(e){return console.warn(`[spendCaps] failed to read caps, using defaults`,e),{satsPerMessage:25,dailyCapSats:Xz}}}async function Qz({satsPerMessage:e,dailyCapSats:t}){let n={satsPerMessage:Number.isFinite(e)&&e>=0?Math.floor(e):25,dailyCapSats:Number.isFinite(t)&&t>=0?Math.floor(t):Xz};try{return await TA.setItem(Yz,n),n}catch(e){throw console.warn(`[spendCaps] failed to persist caps`,e),e}}var $z=typeof window<`u`;function eB(e){if(!$z||!window.localStorage)return null;try{return window.localStorage.getItem(e)}catch{return null}}function tB(e,t){if(!(!$z||!window.localStorage))try{t==null?window.localStorage.removeItem(e):window.localStorage.setItem(e,t)}catch{}}async function nB(){let[e,t,n,r,i,a]=await Promise.all([ej(),Dj(),_A(),SA(),Zz(),aj()]),o=eB(`nukenote.theme`),s=eB(`nukenote.textScale`),c=eB(`nukenote:send-on-enter`),l=eB(`nukenote:typing-indicator-preferences`),u=eB(`nukenote:remote-sync-enabled`);return{version:1,createdAt:new Date().toISOString(),profiles:e,avatars:a,contacts:t,blockedInviters:n,ui:{theme:o,textScale:s,sendOnEnter:c,typingPrefs:l,remoteSyncEnabled:u},preferences:{onboardingComplete:!!r,spendCaps:i}}}async function rB(e){if(!e||typeof e!=`object`)throw Error(`Invalid backup payload`);if(e.version!==1)throw Error(`Unsupported backup version`);let t=await Dj(),n=new Set;if(e.contacts&&typeof e.contacts==`object`)for(let[r,i]of Object.entries(e.contacts)){if(!r||!i||typeof i!=`object`)continue;let e=t[r];(i&&i.verified||e&&e.verified)&&n.add(r);let{verified:a,...o}=i;await wj(r,{...o,verified:!1})}if(e.profiles&&typeof e.profiles==`object`)try{let t=JSON.stringify(e.profiles);await tj(t,!0)}catch{}if(e.avatars&&typeof e.avatars==`object`)try{await oj(e.avatars)}catch{}if(Array.isArray(e.blockedInviters))for(let t of e.blockedInviters)!t||typeof t!=`object`||!t.id||await vA(t.id,t);if(e.ui&&typeof e.ui==`object`){let{theme:t,textScale:n,sendOnEnter:r,typingPrefs:i,remoteSyncEnabled:a}=e.ui;(t===`dark`||t===`light`||t===`system`)&&tB(`nukenote.theme`,t),(n===`sm`||n===`md`||n===`lg`)&&tB(`nukenote.textScale`,n),(r===`true`||r===`false`||r===null)&&(r===null?tB(`nukenote:send-on-enter`,null):tB(`nukenote:send-on-enter`,r)),typeof i==`string`&&tB(`nukenote:typing-indicator-preferences`,i),(a===`true`||a===`false`||a===null)&&(a===null?tB(`nukenote:remote-sync-enabled`,null):tB(`nukenote:remote-sync-enabled`,a))}if(e.preferences&&typeof e.preferences==`object`){let{onboardingComplete:t,spendCaps:n}=e.preferences;try{await CA(!!t)}catch{}if(n&&typeof n==`object`)try{await Qz(n)}catch{}}return{lostVerifiedPubkeys:Array.from(n)}}var iB=2,aB=`wallet-backup:`,oB=`[wallet-backup]`;async function sB(){let{client:e}=await nc({autoConnect:!1});if(!e)throw Error(`Wallet not connected`);if(typeof e.getPublicKey==`function`)try{let t=await e.getPublicKey({protocolID:[2,`nukenote backup`],keyID:`backup-encryption-key-v1`}),n=t?.publicKey||t;if(n){let e=typeof n==`string`?n:Buffer.from(n).toString(`hex`);return console.log(`[wallet-backup] derived backup key from wallet`),e}}catch(e){console.warn(`[wallet-backup] getPublicKey with protocol failed, trying identity key`,e?.message)}if(typeof e.getPublicKey==`function`)try{let t=await e.getPublicKey({identityKey:!0}),n=t?.publicKey||t;if(n){let e=typeof n==`string`?n:Buffer.from(n).toString(`hex`);return console.log(`[wallet-backup] using identity key for backup encryption`),e}}catch(e){console.warn(`[wallet-backup] getPublicKey identity failed`,e?.message)}throw Error(`Wallet does not support key derivation for backup`)}async function cB(e){return TN(e,aB)}async function lB(){let e=[],t=[];return await EA.iterate((t,n)=>{if(t&&n){if(t.status===`burned`||t.status===`left`)return;let r={...t};delete r.rawKeyBase64,delete r.rawThreadKeyBase64,delete r.threadMetadata,e.push({threadId:n,receipt:r})}}),await DA.iterate((e,n)=>{e&&n&&t.push({id:n,identity:{id:e.id,kind:e.kind,threadId:e.threadId,privateKey:e.privateKey,publicKey:e.publicKey,createdAt:e.createdAt}})}),{receipts:e,identities:t}}async function uB({identityKey:e,logger:t=console}){if(!BM())return t.info?.(oB,`helper cache not configured, skipping backup`),{success:!1,error:`Backup service not available`};if(!e)return{success:!1,error:`Wallet identity key required`};try{t.info?.(oB,`deriving backup encryption key from wallet...`);let n=await sB(),[r,i]=await Promise.all([lB(),nB()]),a={version:iB,createdAt:new Date().toISOString(),threads:r,local:i},o=await CN(a,n),s=await cB(e);return await IM(s,{encrypted:o,version:iB,createdAt:new Date().toISOString(),identityKeyHash:s.replace(aB,``)}),t.info?.(oB,`backup created successfully`,{threadCount:r.receipts.length,identityCount:r.identities.length}),{success:!0,threadCount:r.receipts.length,identityCount:r.identities.length}}catch(e){return t.error?.(oB,`backup failed`,{error:e?.message}),{success:!1,error:e?.message||`Backup failed`}}}async function dB({identityKey:e,logger:t=console}){if(!BM())return{success:!1,error:`Backup service not available`};if(!e)return{success:!1,error:`Wallet identity key required`};try{let n=await cB(e),r=await LM(n);if(!r?.encrypted)return t.info?.(oB,`no backup found for this wallet`),{success:!1,error:`No backup found for this wallet`};t.info?.(oB,`deriving backup decryption key from wallet...`);let i=await sB(),a=await wN(r.encrypted,i);if(!a||a.version!==iB)return{success:!1,error:`Invalid or incompatible backup`};let{threads:o,local:s}=a,c=0;if(o?.receipts)for(let{threadId:e,receipt:t}of o.receipts)await EA.setItem(e,t),c++;if(o?.identities)for(let{id:e,identity:t}of o.identities)await DA.setItem(e,t);return s&&await rB(s),t.info?.(oB,`backup restored successfully`,{threadCount:c}),{success:!0,threadCount:c,needsReload:!0}}catch(e){return e?.message?.includes(`decrypt`)||e?.name===`OperationError`?(t.error?.(oB,`decryption failed - wallet key mismatch?`),{success:!1,error:`Could not decrypt backup. Wrong wallet?`}):(t.error?.(oB,`restore failed`,{error:e?.message}),{success:!1,error:e?.message||`Restore failed`})}}async function fB({identityKey:e,logger:t=console}){if(!e)return{success:!1,error:`Wallet identity key required`};try{t.info?.(oB,`deriving local backup encryption key from wallet...`);let e=await sB(),[n,r]=await Promise.all([lB(),nB()]),i={version:iB,createdAt:new Date().toISOString(),threads:n,local:r};return{success:!0,encrypted:await CN(i,e),createdAt:i.createdAt,threadCount:n.receipts.length,identityCount:n.identities.length}}catch(e){return t.error?.(oB,`local backup build failed`,{error:e?.message}),{success:!1,error:e?.message||`Backup failed`}}}async function pB({identityKey:e,encrypted:t,logger:n=console}){if(!e)return{success:!1,error:`Wallet identity key required`};if(!t)return{success:!1,error:`Encrypted backup data required`};try{n.info?.(oB,`deriving backup decryption key from wallet (local file)...`);let e=await sB(),r=await wN(t,e);if(!r||r.version!==iB)return{success:!1,error:`Invalid or incompatible backup`};let{threads:i,local:a}=r,o=0;if(i?.receipts)for(let{threadId:e,receipt:t}of i.receipts)await EA.setItem(e,t),o++;if(i?.identities)for(let{id:e,identity:t}of i.identities)await DA.setItem(e,t);return a&&await rB(a),n.info?.(oB,`local backup restored successfully`,{threadCount:o}),{success:!0,threadCount:o,needsReload:!0}}catch(e){return e?.message?.includes(`decrypt`)||e?.name===`OperationError`?(n.error?.(oB,`local backup decryption failed - wallet key mismatch?`),{success:!1,error:`Could not decrypt backup. Wrong wallet?`}):(n.error?.(oB,`local restore failed`,{error:e?.message}),{success:!1,error:e?.message||`Restore failed`})}}async function mB(e){if(!BM()||!e)return{exists:!1};try{let t=await cB(e),n=await LM(t);return n?.encrypted?{exists:!0,createdAt:n.createdAt,version:n.version}:{exists:!1}}catch{return{exists:!1}}}async function hB(e){if(!BM()||!e)return{success:!1};try{let t=await cB(e);return await RM(t),{success:!0}}catch{return{success:!1}}}function gB(){let{addNotification:e}=Gy(),{identityKey:t,isConnected:n}=Yy(),[r,i]=(0,y.useState)(!1),[a,o]=(0,y.useState)(!1),[s,c]=(0,y.useState)(!1),[l,u]=(0,y.useState)(!1),[d,f]=(0,y.useState)(null),[p,m]=(0,y.useState)(!1),h=(0,y.useRef)(null),g=BM();(0,y.useEffect)(()=>{if(!n||!t||!g){f(null);return}let e=!1;return u(!0),mB(t).then(t=>{e||f(t)}).catch(e=>{console.warn(`[BackupSection] Failed to check backup status:`,e)}).finally(()=>{e||u(!1)}),()=>{e=!0}},[n,t,g]);let _=(0,y.useCallback)(async()=>{if(!t){e({type:`error`,message:`Connect your wallet first to create a backup.`,duration:5e3});return}i(!0);try{e({type:`info`,message:`Your wallet will ask you to sign a message to encrypt the backup.`,duration:5e3});let n=await uB({identityKey:t});if(n.success){e({type:`success`,message:`Backed up ${n.threadCount} thread${n.threadCount===1?``:`s`} and all settings.`,duration:5e3});let r=await mB(t);f(r)}else e({type:`error`,message:n.error||`Backup failed.`,duration:6e3})}catch(t){console.error(`[BackupSection] Backup failed:`,t),e({type:`error`,message:QP(t,{context:`backup data`}),duration:8e3})}finally{i(!1)}},[t,e]),v=(0,y.useCallback)(async()=>{if(!t){e({type:`error`,message:`Connect your wallet first to restore a backup.`,duration:5e3});return}o(!0);try{e({type:`info`,message:`Your wallet will ask you to sign a message to decrypt the backup.`,duration:5e3});let n=await dB({identityKey:t});n.success?(e({type:`success`,message:`Restored ${n.threadCount} thread${n.threadCount===1?``:`s`} and settings. Refreshing page...`,duration:4e3}),setTimeout(()=>{window.location.reload()},2e3)):e({type:`error`,message:n.error||`Restore failed.`,duration:6e3})}catch(t){console.error(`[BackupSection] Restore failed:`,t),e({type:`error`,message:QP(t,{context:`restore backup`}),duration:8e3})}finally{o(!1)}},[t,e]),b=(0,y.useCallback)(async()=>{if(!t){e({type:`error`,message:`Connect your wallet first to create a backup.`,duration:5e3});return}i(!0);try{let n=await fB({identityKey:t});if(!n?.success||!n.encrypted){e({type:`error`,message:n?.error||`Backup failed.`,duration:6e3});return}let r={version:2,encrypted:n.encrypted,createdAt:n.createdAt},i=new Blob([JSON.stringify(r,null,2)],{type:`application/json`}),a=`nukenote-backup-${(n.createdAt||new Date().toISOString()).replace(/[:.]/g,``).replace(/Z$/,``)}.json`,o=URL.createObjectURL(i),s=document.createElement(`a`);s.href=o,s.download=a,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(o),e({type:`success`,message:`Encrypted backup file downloaded${typeof n.threadCount==`number`?` (${n.threadCount} thread${n.threadCount===1?``:`s`})`:``}.`,duration:6e3})}catch(t){console.error(`[BackupSection] Local backup download failed:`,t),e({type:`error`,message:QP(t,{context:`download backup file`}),duration:8e3})}finally{i(!1)}},[t,e]),x=(0,y.useCallback)(async n=>{let r=n.target.files?.[0];if(r){if(!t){e({type:`error`,message:`Connect your wallet first to restore a backup.`,duration:5e3}),n.target.value=``;return}o(!0);try{let n=await r.text(),i;try{i=JSON.parse(n)}catch{throw Error(`Backup file is not valid JSON.`)}if(!i||typeof i.encrypted!=`string`)throw Error(`Backup file is missing encrypted data.`);e({type:`info`,message:`Your wallet will ask you to sign a message to decrypt the backup.`,duration:5e3});let a=await pB({identityKey:t,encrypted:i.encrypted});a?.success?(e({type:`success`,message:`Restored ${a.threadCount??0} thread${a.threadCount===1?``:`s`} and settings. Refreshing page...`,duration:4e3}),setTimeout(()=>{window.location.reload()},2e3)):e({type:`error`,message:a?.error||`Restore failed.`,duration:6e3})}catch(t){console.error(`[BackupSection] Restore from file failed:`,t),e({type:`error`,message:QP(t,{context:`restore from backup file`}),duration:8e3})}finally{o(!1),n.target.value=``}}},[t,e]),S=(0,y.useCallback)(()=>{if(!t){e({type:`error`,message:`Connect your wallet first to restore a backup.`,duration:5e3});return}h.current?.click()},[t,e]),C=(0,y.useCallback)(async()=>{if(t&&window.confirm(`Delete your cloud backup? This cannot be undone. Your local data will not be affected.`)){c(!0);try{(await hB(t)).success?(e({type:`success`,message:`Backup deleted.`,duration:4e3}),f({exists:!1})):e({type:`error`,message:`Failed to delete backup.`,duration:5e3})}catch(t){console.error(`[BackupSection] Delete failed:`,t),e({type:`error`,message:QP(t,{context:`delete backup`}),duration:6e3})}finally{c(!1)}}},[t,e]),w=(0,y.useCallback)(()=>{m(e=>!e)},[]);return{isConnected:n,isBackingUp:r,isRestoring:a,isDeleting:s,isChecking:l,backupInfo:d,showCloudBridge:p,helperCacheAvailable:g,fileInputRef:h,handleDownloadLocalBackup:b,handleRestoreFromFileClick:S,handleRestoreFromFileSelected:x,handleBackup:_,handleRestore:v,handleDelete:C,toggleCloudBridge:w}}function _B(){let{isConnected:e,isBackingUp:t,isRestoring:n,isDeleting:r,isChecking:i,backupInfo:a,showCloudBridge:o,helperCacheAvailable:s,fileInputRef:c,handleDownloadLocalBackup:l,handleRestoreFromFileClick:u,handleRestoreFromFileSelected:d,handleBackup:f,handleRestore:p,handleDelete:m,toggleCloudBridge:h}=gB();return(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`Backup & Recovery`}),(0,Z.jsx)(RA,{children:`Download an encrypted backup file you can keep anywhere, and optionally use a temporary cloud bridge to move between devices.`})]}),(0,Z.jsx)(zA,{className:`space-y-4`,children:e?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row`,children:[(0,Z.jsx)($,{onClick:l,disabled:t||n||r,className:`flex-1`,children:t?`Preparing backup`:`Download backup file`}),(0,Z.jsx)($,{onClick:u,disabled:t||n||r,variant:`outline`,className:`flex-1`,children:`Restore from file`}),(0,Z.jsx)(`input`,{ref:c,type:`file`,accept:`application/json`,className:`hidden`,onChange:d})]}),s&&(0,Z.jsxs)(`div`,{className:`space-y-2 border-t pt-4`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Need to move data between devices without copying a file? Use a temporary cloud bridge.`}),(0,Z.jsx)($,{size:`sm`,variant:`ghost`,disabled:t||n||r,onClick:h,children:o?`Hide cloud bridge`:`Use cloud bridge`})]}),o&&(0,Z.jsxs)(`div`,{className:`space-y-3 rounded-md border border-dashed border-muted-foreground/40 bg-muted/30 p-3`,children:[i?(0,Z.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Checking cloud bridge status...`}):a?.exists?(0,Z.jsxs)(`div`,{className:`rounded-md bg-muted/60 p-3 text-sm`,children:[(0,Z.jsx)(`p`,{className:`font-medium text-foreground`,children:`Cloud bridge backup available`}),(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Last bridge backup: `,new Date(a.createdAt).toLocaleString()]})]}):(0,Z.jsxs)(`div`,{className:`rounded-md bg-amber-500/10 p-3 text-sm text-amber-700 dark:text-amber-300`,children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`No cloud bridge backup`}),(0,Z.jsx)(`p`,{className:`text-xs`,children:`Create a temporary encrypted backup on the helper server, then restore it on another device and delete it when you are done.`})]}),(0,Z.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row`,children:[(0,Z.jsx)($,{onClick:f,disabled:t||n||r,className:`flex-1`,children:t?`Saving to cloud bridge`:a?.exists?`Update cloud bridge backup`:`Create cloud bridge backup`}),a?.exists&&(0,Z.jsx)($,{onClick:p,disabled:t||n||r,variant:`outline`,className:`flex-1`,children:n?`Restoring from cloud`:`Restore from cloud bridge`})]}),a?.exists&&(0,Z.jsxs)(`div`,{className:`border-t pt-3`,children:[(0,Z.jsx)($,{onClick:m,disabled:t||n||r,variant:`ghost`,size:`sm`,className:`text-destructive hover:text-destructive`,children:r?`Removing cloud backup`:`Delete cloud bridge backup`}),(0,Z.jsx)(`p`,{className:`mt-1 text-xs text-muted-foreground`,children:`Removes the encrypted bridge copy from the helper server. Your local data will not be affected.`})]}),(0,Z.jsx)(`p`,{className:`mt-1 text-[11px] text-muted-foreground`,children:`Cloud bridge backups are provided as a convenience only and may be removed at any time. Do not rely on the server as your only backup; always keep a local backup file for important data.`})]})]}),(0,Z.jsxs)(`div`,{className:`space-y-2 text-xs text-muted-foreground`,children:[(0,Z.jsxs)(`p`,{children:[(0,Z.jsx)(`strong`,{children:`What's backed up:`}),` Thread access, guest identities, profile, contacts, blocked users, and app preferences.`]}),(0,Z.jsxs)(`p`,{children:[(0,Z.jsx)(`strong`,{children:`What's NOT backed up:`}),` Message history (stored locally only) and burned threads (permanently deleted).`]}),(0,Z.jsxs)(`p`,{children:[(0,Z.jsx)(`strong`,{children:`Security:`}),` Your backup is encrypted with a key derived from your wallet. Only this wallet can decrypt it.`]})]})]}):(0,Z.jsx)(`p`,{className:`text-sm text-amber-500`,children:`Connect your wallet to enable backup and restore.`})})]})}function vB({walletConnected:e,walletLoading:t,walletType:n,network:r,version:i,identityKey:a,connectionError:o,syncStatus:s,handleConnectWallet:c,handleConnectWalletBrc6:l,guestThreads:u,upgradingThreadId:d,upgradeErrorByThread:f,handleUpgradeThread:p,remoteSyncPreference:m,remoteSyncStatus:h,setRemoteSyncEnabled:g,typingIndicatorEnabled:_,setTypingIndicatorEnabled:v,blockedInviters:b,unblockInviter:x,overlayDiagnostics:S,sendOnEnter:C,setSendOnEnter:w}){return(0,y.useMemo)(()=>[{id:`general`,label:`Account & identity`,description:`Display name, upgrading guest threads to wallet-linked, and session approvals.`,icon:Ob,render:()=>(0,Z.jsxs)(Z.Fragment,{children:[!e&&(0,Z.jsxs)(`div`,{className:`flex flex-col gap-3 rounded-md border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-900 dark:border-amber-900/40 dark:bg-amber-900/10 dark:text-amber-50`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`Wallet required for profile & backup`}),(0,Z.jsx)(`p`,{className:`text-xs opacity-80`,children:`Connect a wallet to edit your holder profile and enable cloud backup & recovery.`})]}),(0,Z.jsx)(`div`,{className:`flex flex-wrap items-center gap-2`,children:(0,Z.jsx)($,{size:`sm`,onClick:c,disabled:t,children:t?`Connecting\b5`:`Connect wallet`})})]}),(0,Z.jsx)(Bz,{walletConnected:e,hasGuestThreads:u.length>0}),(0,Z.jsx)(_B,{}),(0,Z.jsx)(nz,{guestThreads:u,upgradingThreadId:d,upgradeErrorByThread:f,walletLoading:t,onUpgrade:p}),(0,Z.jsx)(Vz,{})]})},{id:`appearance`,label:`Appearance`,description:`Theme and text size on this device.`,icon:sb,render:()=>(0,Z.jsx)(Jz,{})},{id:`chats`,label:`Threads & messaging`,description:`Messaging shortcuts and thread behavior.`,icon:wb,render:()=>(0,Z.jsx)(Gz,{sendOnEnter:C,setSendOnEnter:w,typingIndicatorEnabled:_,setTypingIndicatorEnabled:v})},{id:`privacy`,label:`Privacy & safety`,description:`Cross-device sync and blocked inviters.`,icon:Ab,render:()=>(0,Z.jsx)(zz,{remoteSyncPreference:m,remoteSyncStatus:h,setRemoteSyncEnabled:g,blockedInviters:b,unblockInviter:x,syncStatus:s})},{id:`diagnostics`,label:`Diagnostics`,description:`Wallet connection, relay health, and offline delivery status.`,icon:tb,render:()=>(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Wz,{walletConnected:e,walletLoading:t,walletType:n,network:r,version:i,identityKey:a,connectionError:o,syncStatus:s,onConnect:c,onConnectBrc6:l}),(0,Z.jsx)(Sz,{overlayDiagnostics:S})]})},{id:`donate`,label:`Donate`,description:`Support NukeNote development with a Bitcoin donation.`,icon:vb,render:()=>(0,Z.jsx)(Hz,{walletConnected:e})}],[b,o,u,c,l,p,a,r,S,m,h,g,v,s,_,x,f,d,e,t,n,i,C,w])}var yB={status:`unknown`,lastError:null,lastOkAt:null,lastCheckedAt:null};function bB(){let[e,t]=(0,y.useState)(()=>{if(typeof window>`u`)return yB;let e=window.__NUKENOTE_MESSAGEBOX_HEALTH__;return e?{...yB,...e}:yB});return(0,y.useEffect)(()=>{if(typeof window>`u`)return;let e=e=>{!e||!e.detail||t(t=>({...t,...e.detail}))};window.addEventListener(`nukenote:messagebox-health`,e);let n=window.__NUKENOTE_MESSAGEBOX_HEALTH__;return n&&t(e=>({...e,...n})),()=>{window.removeEventListener(`nukenote:messagebox-health`,e)}},[]),e}function xB({overlayStatus:e,walletConnected:t,walletType:n,network:r,version:i,remoteSyncStatus:a,peerPayActive:o,telemetry:s,helperCacheHealth:c}){let l=bB();return(0,y.useMemo)(()=>{let i=String(e||``).toLowerCase(),a,u;if(i===`online`)a=`Live connection is on. Other devices can see your messages in real time.`,u=`online`;else if(i===`offline-no-endpoint`)a=`Live relay is not configured. Messages stay on this device only.`,u=`local`;else if(i===`offline`||i===`disconnected`)a=`Live connection is down. New messages may not reach other devices until it's back.`,u=`offline`;else if(i===`stub`||!i)a=`Using this device only. Messages stay on this browser.`,u=`local`;else if(i===`connecting`||i===`reconnecting`){let e=s?.reconnectCount||0;!s?.lastConnected&&e>=3?(a=`Having trouble reaching the live relay. Messages may only be visible on this device right now.`,u=`offline`):(a=`Connecting to live message relay`,u=`connecting`)}else a=`Connecting to live message relay`,u=`info`;let d=(()=>e===`online`&&s?.lastConnected?`Connected at ${new Date(s.lastConnected).toLocaleTimeString()}`:e===`online`?`Connected now`:s?.lastDisconnected?`Disconnected at ${new Date(s.lastDisconnected).toLocaleTimeString()}`:``)(),f=r||`wallet connection`,p,m;c?c.available&&c.status===`ok`?(p=`Can hold encrypted messages for friends who are offline (${c.entries||0} waiting).`,m=`ok`):c.status===`not-configured`?(p=`Offline delivery helper not set up.`,m=`off`):(p=`Offline delivery helper unavailable. Messages only deliver while both of you are online.`,m=`off`):(p=`Checking offline delivery helper`,m=`connecting`);let h=`Coming soon: sync your conversations across multiple devices.`,g=String(l?.status||`unknown`).toLowerCase(),_,v,y=!!(Ks.MESSAGE_BOX_WS_URL&&Ks.MESSAGE_BOX_APP_ID),b;return t?g===`ok`&&o?(b=`MessageBox connected via your wallet`,_=`Incoming sats can be accepted automatically and queued for you if your wallet is briefly offline.`,v=`ok`):o&&(g===`degraded`||g===`error`)?(b=`Wallet connected, but MessageBox is not responding (see console logs)`,_=`Your wallet is connected, but the background payment queue is having problems. Automatic payments may be delayed.`,v=`off`):o&&g===`connecting`?(b=`Checking MessageBox status via your wallet`,_=`Setting up automatic payments and the background queue`,v=`connecting`):(b=`Managed by your wallet`,_=`Your wallet is connected, but automatic payments and the background queue are off.`,v=`off`):(b=y?`Configured at ${Ks.MESSAGE_BOX_WS_URL}`:`Waiting for wallet connection`,_=`Connect your wallet to turn on automatic payments and the background payment queue.`,v=`off`),{summary:[{id:`overlay-status`,label:`Live message connection`,value:d?`${a} (${d})`:a,tone:u},{id:`helper-cache`,label:`Offline delivery helper`,value:p,tone:m},{id:`remote-sync`,label:`Multi-device sync (coming soon)`,value:h,tone:`info`},{id:`payments-and-queue`,label:`Automatic payments & queue`,value:_,tone:v}],relays:[],events:[{id:`evt-wallet`,time:``,scope:`wallet`,message:t?`Wallet connected (${n||`unknown type`} on ${f}).`:`No wallet connected.`},{id:`evt-remote-sync`,time:``,scope:`sync`,message:h},{id:`evt-payments-queue`,time:``,scope:`payments`,message:_},{id:`evt-messagebox`,time:``,scope:`messagebox`,message:b}]}},[e,t,n,r,i,a,o,s,c,l])}function SB(){let[e,t]=(0,y.useState)({lastConnected:null,lastDisconnected:null,reconnectCount:0,lastPing:null,avgRtt:null,recentEvents:[]});return(0,y.useEffect)(()=>{let e=!0,n=async()=>{try{let n=await Qk(50);if(!e)return;let r=null,i=null,a=0,o=null,s=[];for(let e=n.length-1;e>=0;e--){let t=n[e];t.kind===`status`&&t.status===`online`&&!r&&(r=t.timestamp),t.kind===`status`&&(t.status===`disconnected`||t.status===`closed`)&&!i&&(i=t.timestamp),t.kind===`reconnect`&&(a=Math.max(a,t.attempts||0)),t.kind===`heartbeat`&&!o?(o=t.timestamp,t.rttMs!=null&&s.push(t.rttMs)):t.kind===`heartbeat`&&t.rttMs!=null&&s.push(t.rttMs)}let c=s.length>0?Math.round(s.reduce((e,t)=>e+t,0)/s.length):null;t({lastConnected:r,lastDisconnected:i,reconnectCount:a,lastPing:o,avgRtt:c,recentEvents:n.slice(-10).reverse()})}catch(e){console.error(`[useOverlayTelemetry] Failed to load telemetry:`,e)}};n();let r=setInterval(n,1e4);return()=>{e=!1,clearInterval(r)}},[]),e}function CB(){let[e,t]=(0,y.useState)({available:!1,status:`checking`,uptime:null,entries:null,error:null});return(0,y.useEffect)(()=>{let e=Ks.HELPER_CACHE_ENDPOINT;if(!e){t({available:!1,status:`not-configured`,uptime:null,entries:null,error:`Helper cache endpoint not configured`});return}let n=!1;async function r(){try{let r=await fetch(`${e}/status`,{method:`GET`,headers:{"Content-Type":`application/json`}});if(n)return;if(!r.ok)throw Error(`HTTP ${r.status}`);let i=await r.json();t({available:!0,status:i.status||`ok`,uptime:i.uptime,entries:i.entries,error:null})}catch(e){if(n)return;t({available:!1,status:`unavailable`,uptime:null,entries:null,error:e.message})}}r();let i=setInterval(r,3e4);return()=>{n=!0,clearInterval(i)}},[]),e}function wB({connectWallet:e,addNotification:t,upgradeThreadToHolder:n,walletConnected:r}){let[i,a]=(0,y.useState)(null),[o,s]=(0,y.useState)({}),[c,l]=(0,y.useState)(null),u=(0,y.useCallback)(async n=>{a(null);try{await e(n),t({type:`success`,message:`Wallet connected`,duration:3500})}catch(e){let n=e?.message||`Wallet connection failed`;a(n),t({type:`error`,message:n,duration:6e3})}},[e,t]),d=(0,y.useCallback)(async()=>u(),[u]),f=(0,y.useCallback)(async()=>u(`brc6`),[u]),p=(0,y.useCallback)(async e=>{if(!(!e||c)){s(t=>({...t,[e]:null})),l(e);try{r||await d(),await n(e),t({type:`success`,message:`Thread upgraded. Wallet-linked session ready.`,duration:4500})}catch(n){let r=n?.message||`Failed to upgrade thread`;s(t=>({...t,[e]:r})),t({type:`error`,message:r,duration:7e3})}finally{l(null)}}},[t,d,n,c,r]);return{connectionError:i,upgradeErrorByThread:o,upgradingThreadId:c,handleConnectWallet:d,handleConnectWalletBrc6:f,handleUpgradeThread:p}}function TB({conversations:e}){let[t,n]=(0,y.useState)(``),r=(0,y.useMemo)(()=>e.filter(e=>e.guestMode&&e.status!==`burned`&&e.status!==`blocked`),[e]);return{sidebarSearch:t,setSidebarSearch:n,guestThreads:r}}function EB(){let{railCollapsed:e}=(0,y.useContext)(Vb),{conversations:t,blockedInviters:n,unblockInviter:r,overlayStatus:i,typingIndicatorEnabled:a,setTypingIndicatorEnabled:o,remoteSyncPreference:s,remoteSyncStatus:c,setRemoteSyncEnabled:l,upgradeThreadToHolder:u,sendOnEnter:d,setSendOnEnter:f}=CP(),{isConnected:p,isLoading:m,walletType:h,identityKey:g,network:_,version:v,peerPayActive:b,connectWallet:x}=Yy(),{addNotification:S}=Gy(),{sidebarSearch:C,setSidebarSearch:w,guestThreads:T}=TB({conversations:t}),E=(0,y.useMemo)(()=>!i||i===`stub`?`Local only`:i===`online`?`Synced via overlay`:`Overlay: ${i}`,[i]),D=SB(),O=CB(),k=xB({overlayStatus:i,walletConnected:p,walletType:h,network:_,version:v,remoteSyncStatus:c,peerPayActive:b,telemetry:D,helperCacheHealth:O}),{connectionError:A,upgradeErrorByThread:ee,upgradingThreadId:te,handleConnectWallet:ne,handleUpgradeThread:j}=wB({connectWallet:x,addNotification:S,upgradeThreadToHolder:u,walletConnected:p}),M=y.useCallback(()=>{if(!T||T.length===0){S({type:`error`,message:`No guest threads available to upgrade.`,duration:5e3});return}let e=T[0];j(e.id)},[S,T,j]),re=vB({walletConnected:p,walletLoading:m,walletType:h,network:_,version:v,identityKey:g,connectionError:A,syncStatus:E,handleConnectWallet:ne,handleConnectWalletBrc6:M,guestThreads:T,upgradingThreadId:te,upgradeErrorByThread:ee,handleUpgradeThread:j,remoteSyncPreference:s,remoteSyncStatus:c,setRemoteSyncEnabled:l,typingIndicatorEnabled:a,setTypingIndicatorEnabled:o,blockedInviters:n,unblockInviter:r,overlayDiagnostics:k,sendOnEnter:d,setSendOnEnter:f}),[ie,ae]=(0,y.useState)(()=>re[0]?.id??null);(0,y.useEffect)(()=>{if(re.length===0){ae(null);return}ae(e=>e??re[0].id)},[re]);let oe=(0,y.useMemo)(()=>{if(!C.trim())return re;let e=C.trim().toLowerCase();return re.filter(t=>t.label.toLowerCase().includes(e))},[re,C]);(0,y.useEffect)(()=>{if(oe.length===0){ae(null);return}oe.some(e=>e.id===ie)||ae(oe[0].id)},[oe,ie]);let se=(0,y.useMemo)(()=>re.find(e=>e.id===ie)??re[0]??null,[re,ie]);return(0,Z.jsxs)(`div`,{className:`flex h-full min-h-[640px] flex-1 overflow-hidden bg-background`,children:[(0,Z.jsx)(tz,{sections:oe,activeSectionId:ie,onSelectSection:ae,searchValue:C,onSearchChange:w}),(0,Z.jsxs)(`div`,{className:`flex flex-1 flex-col overflow-hidden`,children:[(0,Z.jsxs)(`header`,{className:Q(`border-b border-border/60 bg-background px-6 py-5 transition-all`,e?`md:pl-16 md:pr-6`:`md:px-6`),children:[(0,Z.jsx)(`h2`,{className:`text-2xl font-semibold tracking-tight`,children:se?.label??`Settings`}),se?.description&&(0,Z.jsx)(`p`,{className:`mt-1 text-sm text-muted-foreground`,children:se.description})]}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-y-auto px-6 py-6`,children:(0,Z.jsx)(`div`,{className:`mx-auto flex w-full max-w-3xl flex-col gap-6`,children:se?.render?.()||(0,Z.jsx)(SettingsPlaceholderCard,{title:`Nothing to show`,description:`No settings match your search.`})})})]})]})}var DB=512*1024,OB=256;function kB(){let e=Ve(),t=(0,y.useRef)(null),[n,r]=(0,y.useState)(``),[i,a]=(0,y.useState)(``),[o,s]=(0,y.useState)(null),[c,l]=(0,y.useState)(null),[u,d]=(0,y.useState)(null),[f,p]=(0,y.useState)(null),[m,h]=(0,y.useState)(!0),[g,_]=(0,y.useState)(!1),[v,b]=(0,y.useState)(null),[x,S]=(0,y.useState)(!1);(0,y.useEffect)(()=>{async function e(){try{h(!0),b(null);let{client:e}=await nc(),t=await e.getPublicKey({identityKey:!0}),n=typeof t==`string`?t:t?.publicKey;if(!n||typeof n!=`string`)throw Error(`Wallet did not return identity public key`);p(n);let i=await dj(n);i&&i.fields&&(d(i),r(i.fields.displayName||``),a(i.fields.about||``),l(i.fields.avatarHash||null));let o=await rj(n);o?.dataUrl&&s(o.dataUrl)}catch(e){console.error(`[ProfileSettings] Failed to load profile:`,e),b(`Failed to load profile. Make sure your wallet is connected.`)}finally{h(!1)}}e()},[]);let C=e=>new Promise((t,n)=>{let r=new FileReader;r.onload=e=>{let r=new Image;r.onload=()=>{let e=document.createElement(`canvas`);e.width=e.height=OB;let n=e.getContext(`2d`),i=Math.min(r.width,r.height),a=(r.width-i)/2,o=(r.height-i)/2;n.drawImage(r,a,o,i,i,0,0,OB,OB),t(e.toDataURL(`image/jpeg`,.85))},r.onerror=n,r.src=e.target.result},r.onerror=n,r.readAsDataURL(e)});return(0,Z.jsxs)(`div`,{className:`flex min-h-screen flex-col bg-background`,children:[(0,Z.jsx)(`header`,{className:`border-b border-muted-foreground/20 bg-background/80 px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Z.jsx)($,{variant:`ghost`,size:`icon`,onClick:()=>e(`/settings`),className:`h-10 w-10`,children:(0,Z.jsx)(ib,{className:`h-5 w-5`})}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h1`,{className:`text-lg font-semibold`,children:`Profile Settings`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Manage your holder identity`})]})]})}),(0,Z.jsx)(`main`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Z.jsxs)(`div`,{className:`mx-auto max-w-2xl space-y-6`,children:[(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsxs)(LA,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(cb,{className:`h-5 w-5`}),`Avatar`]}),(0,Z.jsx)(RA,{children:`Add a profile picture. It will be stored locally and included in your backups.`})]}),(0,Z.jsx)(zA,{children:m?(0,Z.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading...`}):(0,Z.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,Z.jsx)(`div`,{className:`relative`,children:o?(0,Z.jsxs)(`div`,{className:`relative`,children:[(0,Z.jsx)(`img`,{src:o,alt:`Avatar`,className:`h-20 w-20 rounded-full object-cover border-2 border-muted`}),(0,Z.jsx)(`button`,{onClick:async()=>{f&&await ij(f),s(null),l(null),t.current&&(t.current.value=``)},className:`absolute -top-1 -right-1 rounded-full bg-destructive p-1 text-destructive-foreground hover:bg-destructive/90`,title:`Remove avatar`,children:(0,Z.jsx)(Bb,{className:`h-3 w-3`})})]}):(0,Z.jsx)(`div`,{className:`flex h-20 w-20 items-center justify-center rounded-full bg-muted border-2 border-dashed border-muted-foreground/30`,children:(0,Z.jsx)(Fb,{className:`h-8 w-8 text-muted-foreground`})})}),(0,Z.jsxs)(`div`,{className:`flex-1`,children:[(0,Z.jsx)(`input`,{ref:t,type:`file`,accept:`image/*`,onChange:async e=>{let t=e.target.files?.[0];if(t){if(!t.type.startsWith(`image/`)){b(`Please select an image file`);return}if(t.size>DB*4){b(`Image too large. Please select an image under 2MB.`);return}try{b(null);let e=await C(t);if(s(e),f){let t=await nj(f,e);l(t)}}catch(e){console.error(`[ProfileSettings] Failed to process avatar:`,e),b(`Failed to process image`)}}},className:`hidden`,id:`avatar-upload`}),(0,Z.jsxs)($,{variant:`outline`,size:`sm`,onClick:()=>t.current?.click(),disabled:g,children:[(0,Z.jsx)(cb,{className:`mr-2 h-4 w-4`}),o?`Change Photo`:`Upload Photo`]}),(0,Z.jsx)(`p`,{className:`mt-1 text-xs text-muted-foreground`,children:`JPG, PNG or GIF. Will be resized to 256256.`})]})]})})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsxs)(LA,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(Fb,{className:`h-5 w-5`}),`Display Name`]}),(0,Z.jsx)(RA,{children:`Your display name is shown to other participants in threads.`})]}),(0,Z.jsx)(zA,{className:`space-y-4`,children:m?(0,Z.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading profile...`}):(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(dI,{htmlFor:`displayName`,children:`Display Name`}),(0,Z.jsx)(GA,{id:`displayName`,type:`text`,value:n,onChange:e=>r(e.target.value),placeholder:`Enter your display name`,maxLength:50,disabled:g}),(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[n.length,`/50 characters`]})]})})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsx)(LA,{children:`About`}),(0,Z.jsx)(RA,{children:`A short bio or status message. Keep it brief.`})]}),(0,Z.jsx)(zA,{children:m?(0,Z.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading...`}):(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(GP,{id:`about`,value:i,onChange:e=>a(e.target.value),placeholder:`Tell others a bit about yourself...`,maxLength:160,disabled:g,rows:3,className:`resize-none`}),(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[i.length,`/160 characters`]})]})})]}),v&&(0,Z.jsx)(`div`,{className:`rounded-lg border border-destructive bg-destructive/10 p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm text-destructive`,children:v})}),x&&(0,Z.jsx)(`div`,{className:`rounded-lg border border-green-500 bg-green-500/10 p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm text-green-600 dark:text-green-400`,children:`Profile saved successfully!`})}),!m&&(0,Z.jsx)($,{onClick:async()=>{if(!n.trim()){b(`Display name is required`);return}if(n.length>50){b(`Display name must be 50 characters or less`);return}if(i.length>160){b(`About must be 160 characters or less`);return}try{_(!0),b(null),S(!1),await uj(n.trim(),{about:i.trim()||null,avatarHash:c||null}),S(!0),setTimeout(()=>S(!1),3e3);let e=await dj(f);e&&d(e)}catch(e){console.error(`[ProfileSettings] Failed to save profile:`,e),b(e.message||`Failed to save profile`)}finally{_(!1)}},disabled:g||!n.trim(),className:`w-full`,size:`lg`,children:g?(0,Z.jsx)(Z.Fragment,{children:`Saving...`}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Db,{className:`mr-2 h-4 w-4`}),`Save Profile`]})}),u&&(0,Z.jsx)(FA,{children:(0,Z.jsxs)(zA,{className:`pt-4`,children:[(0,Z.jsx)(`p`,{className:`text-xs font-medium text-muted-foreground`,children:`Current Profile`}),(0,Z.jsx)(`p`,{className:`mt-1 text-sm`,children:u.fields.displayName}),u.fields.about&&(0,Z.jsx)(`p`,{className:`mt-1 text-sm text-muted-foreground`,children:u.fields.about}),(0,Z.jsx)(`p`,{className:`mt-2 text-xs text-muted-foreground`,children:`Stored locally on this device (keyed by your wallet identity key).`}),u.fields.updatedAt&&(0,Z.jsxs)(`p`,{className:`mt-1 text-xs text-muted-foreground`,children:[`Updated: `,new Date(u.fields.updatedAt).toLocaleString()]})]})})]})})]})}async function AB(e,t,n){if(!e.displayName)throw Error(`displayName is required`);if(!t||typeof t!=`function`)throw Error(`signFn must be a function`);if(!n)throw Error(`issuerPubKey is required`);let r={proto:`NukeNote.ProfileCard`,v:1,displayName:e.displayName,avatarHash:e.avatarHash||null,colorSeed:e.colorSeed||Math.floor(Math.random()*1e3),since:new Date().toISOString(),issuerPubKey:n},i=jB(r),a=new TextEncoder().encode(i),o=await t(a),s=btoa(String.fromCharCode(...o));return{...r,sig:s}}function jB(e){let t=Object.keys(e).sort(),n={};for(let r of t)n[r]=e[r];return JSON.stringify(n)}function MB(){let e=Ve(),[t,n]=(0,y.useState)(``),[r,i]=(0,y.useState)(null),[a,o]=(0,y.useState)(null),[s,c]=(0,y.useState)(!0),[l,u]=(0,y.useState)(!1),[d,f]=(0,y.useState)(null),[p,m]=(0,y.useState)(!1);return(0,y.useEffect)(()=>{async function e(){try{c(!0),f(null);let e=`guest_key_placeholder`;i(e);let t=Cj(e);t?.card&&(o(t.card),n(t.card.displayName||``))}catch(e){console.error(`[GuestProfile] Failed to load profile:`,e),f(`Failed to load profile.`)}finally{c(!1)}}e()},[]),(0,Z.jsxs)(`div`,{className:`flex min-h-screen flex-col bg-background`,children:[(0,Z.jsx)(`header`,{className:`border-b border-muted-foreground/20 bg-background/80 px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Z.jsx)($,{variant:`ghost`,size:`icon`,onClick:()=>e(`/settings`),className:`h-10 w-10`,children:(0,Z.jsx)(ib,{className:`h-5 w-5`})}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`h1`,{className:`text-lg font-semibold`,children:`Guest Profile`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Set your display name`})]})]})}),(0,Z.jsx)(`main`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Z.jsxs)(`div`,{className:`mx-auto max-w-2xl space-y-6`,children:[(0,Z.jsxs)(FA,{children:[(0,Z.jsxs)(IA,{children:[(0,Z.jsxs)(LA,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(Fb,{className:`h-5 w-5`}),`Display Name`]}),(0,Z.jsx)(RA,{children:`Your display name is stored in a signed ProfileCard and can be shared with your contacts.`})]}),(0,Z.jsx)(zA,{className:`space-y-4`,children:s?(0,Z.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading profile...`}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(dI,{htmlFor:`displayName`,children:`Display Name`}),(0,Z.jsx)(GA,{id:`displayName`,type:`text`,value:t,onChange:e=>n(e.target.value),placeholder:`Enter your display name`,maxLength:50,disabled:l}),(0,Z.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[t.length,`/50 characters`]})]}),a&&(0,Z.jsxs)(`div`,{className:`rounded-lg border border-muted-foreground/20 bg-muted/10 p-3`,children:[(0,Z.jsx)(`p`,{className:`text-xs font-medium text-muted-foreground`,children:`Current Profile`}),(0,Z.jsx)(`p`,{className:`mt-1 text-sm`,children:a.displayName}),(0,Z.jsxs)(`p`,{className:`mt-1 text-xs text-muted-foreground`,children:[`Signed: `,new Date(a.since).toLocaleString()]})]}),d&&(0,Z.jsx)(`div`,{className:`rounded-lg border border-destructive bg-destructive/10 p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm text-destructive`,children:d})}),p&&(0,Z.jsx)(`div`,{className:`rounded-lg border border-green-500 bg-green-500/10 p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm text-green-600 dark:text-green-400`,children:`Profile saved successfully!`})}),(0,Z.jsx)($,{onClick:async()=>{if(!t.trim()){f(`Display name is required`);return}if(t.length>50){f(`Display name must be 50 characters or less`);return}if(!r||r===`guest_key_placeholder`){f(`Guest session not initialized. Please join a thread first.`);return}try{u(!0),f(null),m(!1);let e=await AB({displayName:t.trim(),colorSeed:Math.floor(Math.random()*1e3)},async e=>new Uint8Array(64),r);await wj(r,{card:e}),o(e),m(!0),setTimeout(()=>m(!1),3e3)}catch(e){console.error(`[GuestProfile] Failed to save profile:`,e),f(e.message||`Failed to save profile`)}finally{u(!1)}},disabled:l||!t.trim(),className:`w-full`,children:l?(0,Z.jsx)(Z.Fragment,{children:`Saving...`}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Db,{className:`mr-2 h-4 w-4`}),`Save Profile`]})})]})})]}),(0,Z.jsxs)(FA,{children:[(0,Z.jsx)(IA,{children:(0,Z.jsx)(LA,{className:`text-base`,children:`About Guest Profiles`})}),(0,Z.jsxs)(zA,{className:`space-y-2 text-sm text-muted-foreground`,children:[(0,Z.jsx)(`p`,{children:` Your ProfileCard is signed with your ephemeral guest key`}),(0,Z.jsx)(`p`,{children:` It can be shared with your contacts via the overlay network`}),(0,Z.jsx)(`p`,{children:` Guests cannot discover certificates (wallet holders only)`}),(0,Z.jsx)(`p`,{children:` You can upgrade to a wallet holder to get a BRC-100 certificate`})]})]}),(0,Z.jsxs)(FA,{className:`border-primary/20 bg-primary/5`,children:[(0,Z.jsx)(IA,{children:(0,Z.jsx)(LA,{className:`text-base`,children:`Upgrade to Wallet Holder`})}),(0,Z.jsxs)(zA,{className:`space-y-2 text-sm text-muted-foreground`,children:[(0,Z.jsx)(`p`,{children:`As a guest, your settings are temporary and won't persist across sessions.`}),(0,Z.jsx)(`p`,{children:`Connect a wallet to unlock:`}),(0,Z.jsxs)(`ul`,{className:`ml-4 list-disc space-y-1`,children:[(0,Z.jsx)(`li`,{children:`Persistent profile settings`}),(0,Z.jsx)(`li`,{children:`Create and manage your own threads`}),(0,Z.jsx)(`li`,{children:`Cloud backup and recovery`}),(0,Z.jsx)(`li`,{children:`Full identity verification`})]})]})]})]})})]})}function NB({pubkey:e,contact:t,onOpen:n,onOpenThread:r,onStartThread:i,hasThread:a,isBlocked:o,isStartingThread:s}){let c=t?.nickname||t?.displayName||t?.card?.displayName||pj(e),l=t?.kind||`guest`,u=t?.card?.colorSeed||mj(e),d=!!t?.verified,f=t?.avatarHash||t?.card?.avatarHash||null,p=e.length>20?`${e.slice(0,10)}${e.slice(-8)}`:e;return(0,Z.jsxs)(`div`,{role:`button`,tabIndex:0,onClick:()=>n(e),onKeyDown:t=>t.key===`Enter`&&n(e),className:`group flex w-full items-center gap-4 rounded-lg border border-transparent px-4 py-3 text-left transition-all hover:border-border/50 hover:bg-muted/30 cursor-pointer`,children:[(0,Z.jsx)(lj,{name:c,colorSeed:u,avatarHash:f,pubkey:e,size:44}),(0,Z.jsxs)(`div`,{className:`flex flex-1 flex-col min-w-0`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(`span`,{className:`font-medium text-foreground truncate`,children:c}),d&&(0,Z.jsx)(kb,{className:`h-4 w-4 flex-shrink-0 text-emerald-500`})]}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 mt-0.5`,children:[(0,Z.jsx)(`span`,{className:`text-xs text-muted-foreground font-mono truncate`,children:p}),(0,Z.jsx)(`span`,{className:`flex items-center gap-1 text-[10px] text-muted-foreground`,children:l===`holder`?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Rb,{className:`h-3 w-3`}),(0,Z.jsx)(`span`,{children:`Wallet`})]}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Fb,{className:`h-3 w-3`}),(0,Z.jsx)(`span`,{children:`Guest`})]})})]})]}),(0,Z.jsx)(`div`,{className:Q(`flex items-center gap-2`,o&&`opacity-60`),children:o?(0,Z.jsx)(`span`,{className:`rounded-full bg-destructive/10 px-3 py-1.5 text-xs font-medium text-destructive`,children:`Blocked`}):a?(0,Z.jsxs)($,{type:`button`,variant:`secondary`,size:`sm`,className:`gap-1.5`,onClick:t=>{t.stopPropagation(),r?.(e)},children:[(0,Z.jsx)(Tb,{className:`h-3.5 w-3.5`}),`Open chat`]}):(0,Z.jsxs)($,{type:`button`,variant:`default`,size:`sm`,className:`gap-1.5`,onClick:t=>{t.stopPropagation(),i?.(e)},disabled:s,children:[(0,Z.jsx)(Tb,{className:`h-3.5 w-3.5`}),s?`Creating`:`New chat`]})})]})}var PB=NB;function FB(){let{contacts:e,loading:t,refresh:n,remove:r}=jF(),[i,a]=(0,y.useState)(null),[o,s]=(0,y.useState)(``),[c,l]=(0,y.useState)(!1),[u,d]=(0,y.useState)(null),[f,p]=(0,y.useState)(!1),{blockInviter:m,unblockInviter:h,conversations:g,isInviterBlocked:_,createNewThread:v,generateThreadInvite:b}=CP(),{isConnected:x,connectWallet:S}=Yy(),{addNotification:C}=Gy(),{railCollapsed:w}=(0,y.useContext)(Vb),T=Ve(),E=(0,y.useCallback)(async t=>{if(!(!t||u)){d(t);try{x||await S();let n=await v(),r=await b(n.threadId);if(r){await navigator.clipboard.writeText(r);let n=e[t]?.nickname||e[t]?.displayName||pj(t);C({type:`success`,message:`Thread created! Invite link copied. Share it with ${n} to connect.`,duration:6e3})}T(`/messages?thread=${encodeURIComponent(n.threadId)}`)}catch(e){console.error(`[ContactsPage] Failed to start thread`,e),C({type:`error`,message:e.message||`Failed to create thread`,duration:5e3})}finally{d(null)}}},[u,x,S,v,b,e,C,T]),D=(0,y.useCallback)(e=>{let t=g.find(t=>t?.peerPublicKey===e);t?.id?T(`/messages?thread=${encodeURIComponent(t.id)}`):T(`/messages`)},[g,T]),O=(0,y.useMemo)(()=>{let t=Object.entries(e||{}),n=(e,t)=>{let n=e?.kind||`guest`,r=!!e?.verified,i=!!(e?.certificate||e?.card||e?.nickname);return n===`holder`&&r?0:n===`holder`?1:n===`guest`&&r?2:n===`guest`&&i?3:4},r=(e,t)=>e?.nickname||e?.displayName||e?.card?.displayName||pj(t);return t.sort(([e,t],[i,a])=>{let o=n(t,e),s=n(a,i);if(o!==s)return o-s;let c=r(t,e).toLowerCase(),l=r(a,i).toLowerCase();return c===l?e.localeCompare(i):c.localeCompare(l)})},[e]),k=(0,y.useMemo)(()=>{let e=0,t=0;for(let[,n]of O)n?.kind===`holder`?e++:t++;return{wallets:e,guests:t}},[O]),A=(0,y.useMemo)(()=>{let e=O;f||(e=e.filter(([,e])=>e?.kind===`holder`));let t=o.trim().toLowerCase();return t&&(e=e.filter(([e,n])=>{let r=(n?.nickname||n?.displayName||n?.card?.displayName||pj(e)).toLowerCase(),i=e.toLowerCase(),a=n?.safetyNumber?.toLowerCase()||``;return r.includes(t)||i.includes(t)||a.includes(t)})),e},[O,o,f]),ee=i&&e[i]||null,{identity:te}=kj(i,ee?.kind||`guest`),ne=te?.name||(i?pj(i):`Contact`);return(0,Z.jsx)(`div`,{className:`flex h-full min-h-[640px] flex-1 overflow-hidden bg-background`,children:(0,Z.jsxs)(`div`,{className:`flex flex-1 flex-col overflow-hidden`,children:[(0,Z.jsxs)(`header`,{className:Q(`border-b border-border/60 bg-background px-6 py-5 transition-all`,w?`md:pl-16 md:pr-6`:`md:px-6`),children:[(0,Z.jsx)(`h2`,{className:`text-lg font-semibold leading-tight`,children:`Contacts`}),(0,Z.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Local address book for peers you have chatted with. Nicknames and verification live only on this device.`})]}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-y-auto px-6 py-6`,children:(0,Z.jsxs)(`div`,{className:`flex w-full max-w-3xl flex-col gap-6`,children:[(0,Z.jsxs)(`div`,{className:`flex flex-col gap-3`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,Z.jsx)(`div`,{className:`flex-1 max-w-md`,children:(0,Z.jsx)(GA,{type:`search`,value:o,onChange:e=>s(e.target.value),placeholder:`Search contacts`,className:`h-9 bg-background/60`})}),(0,Z.jsx)($,{variant:`ghost`,size:`sm`,onClick:()=>{n().catch(e=>{console.error(`[ContactsPage] Refresh failed`,e)})},disabled:t,children:`Refresh`})]}),(0,Z.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-4 text-xs text-muted-foreground`,children:[(0,Z.jsxs)(`span`,{className:`flex items-center gap-1`,children:[(0,Z.jsx)(Rb,{className:`h-3 w-3`}),k.wallets,` wallet`,k.wallets===1?``:`s`]}),k.guests>0&&(0,Z.jsxs)(`span`,{className:`flex items-center gap-1`,children:[(0,Z.jsx)(Fb,{className:`h-3 w-3`}),k.guests,` guest`,k.guests===1?``:`s`,!f&&` (hidden)`]})]}),k.guests>0&&(0,Z.jsxs)($,{variant:`ghost`,size:`sm`,onClick:()=>p(!f),className:`h-7 text-xs gap-1.5`,children:[(0,Z.jsx)(gb,{className:`h-3 w-3`}),f?`Hide guests`:`Show guests`]})]})]}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-auto`,children:t&&O.length===0?(0,Z.jsx)(`div`,{className:`flex h-full items-center justify-center text-xs text-muted-foreground`,children:`Loading contacts...`}):A.length===0?(0,Z.jsxs)(`div`,{className:`flex h-full flex-col items-center justify-center gap-2 text-center text-sm text-muted-foreground py-12`,children:[(0,Z.jsx)(Fb,{className:`h-12 w-12 text-muted-foreground/30`}),O.length===0?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`No contacts yet`}),(0,Z.jsx)(`p`,{className:`max-w-sm text-xs text-muted-foreground`,children:`Contacts are created automatically when you exchange messages with someone or verify their safety number. Start a new thread from Messages to populate this list.`})]}):!f&&k.wallets===0?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`No wallet contacts`}),(0,Z.jsxs)(`p`,{className:`max-w-sm text-xs text-muted-foreground`,children:[`You have `,k.guests,` guest contact`,k.guests===1?``:`s`,` hidden. Guest contacts use ephemeral keys and can't receive direct invites.`]}),(0,Z.jsx)($,{variant:`outline`,size:`sm`,onClick:()=>p(!0),className:`mt-2`,children:`Show guest contacts`})]}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`p`,{className:`font-medium`,children:`No matching contacts`}),(0,Z.jsx)(`p`,{className:`max-w-sm text-xs text-muted-foreground`,children:`Try a different search term.`})]})]}):(0,Z.jsx)(`div`,{className:`flex flex-col gap-1`,children:A.map(([e,t])=>(0,Z.jsx)(PB,{pubkey:e,contact:t,onOpen:a,onOpenThread:D,onStartThread:E,hasThread:g.some(t=>t?.peerPublicKey===e),isBlocked:_?.(e),isStartingThread:u===e},e))})})]})}),(0,Z.jsx)(nF,{pubkey:i,identity:te?{...te,kind:ee?.kind||`guest`}:null,open:!!i,onClose:()=>a(null),onVerify:()=>{l(!0)},isBlocked:i?_?.(i):!1,onBlock:async()=>{if(i)try{await m(i,{source:`contacts_page`})}catch(e){console.error(`[ContactsPage] Block failed`,e)}finally{a(null)}},onUnblock:async()=>{if(i)try{await h(i)}catch(e){console.error(`[ContactsPage] Unblock failed`,e)}finally{a(null)}},onDelete:async()=>{if(i)try{await r(i),C({type:`success`,message:`Contact deleted`,duration:3e3})}catch(e){console.error(`[ContactsPage] Delete failed`,e),C({type:`error`,message:`Failed to delete contact`,duration:5e3})}finally{a(null)}}}),(0,Z.jsx)(MF,{pubkey:i,name:ne,ownPubkey:null,ownName:`You`,open:c&&!!i,onClose:()=>l(!1)})]})})}var IB={success:lb,error:nb,warning:rb,info:yb},LB={success:`bg-green-500/10 border-green-500/20 text-green-500`,error:`bg-red-500/10 border-red-500/20 text-red-500`,warning:`bg-yellow-500/10 border-yellow-500/20 text-yellow-500`,info:`bg-blue-500/10 border-blue-500/20 text-blue-500`};function RB({notification:e,onRemove:t,onAutoHide:n}){let r=IB[e.type]||yb,i=LB[e.type]||LB.info;return(0,y.useEffect)(()=>{if(!e.duration||e.duration<=0)return;let t=setTimeout(()=>{n&&n(e.id)},e.duration);return()=>clearTimeout(t)},[e.id,e.duration,n]),(0,Z.jsxs)(`div`,{className:`flex items-start gap-3 p-4 rounded-lg border ${i} shadow-lg animate-in slide-in-from-right-full duration-300`,role:`alert`,children:[(0,Z.jsx)(r,{className:`w-5 h-5 flex-shrink-0 mt-0.5`}),(0,Z.jsxs)(`div`,{className:`flex-1 min-w-0`,children:[e.title&&(0,Z.jsx)(`div`,{className:`font-semibold mb-1`,children:e.title}),(0,Z.jsx)(`div`,{className:`text-sm opacity-90`,children:e.message})]}),(0,Z.jsx)(`button`,{onClick:()=>t(e.id),className:`flex-shrink-0 opacity-50 hover:opacity-100 transition-opacity`,"aria-label":`Dismiss`,children:(0,Z.jsx)(Bb,{className:`w-4 h-4`})})]})}function zB(){let{notifications:e,removeNotification:t}=Gy(),[n,r]=(0,y.useState)(new Set),i=e.filter(e=>!n.has(e.id));return i.length===0?null:(0,Z.jsx)(`div`,{className:`fixed bottom-24 left-24 z-50 flex flex-col gap-2 max-w-sm w-auto pointer-events-none`,children:(0,Z.jsx)(`div`,{className:`pointer-events-auto space-y-2`,children:i.map(e=>(0,Z.jsx)(RB,{notification:e,onRemove:t,onAutoHide:e=>r(t=>new Set([...t,e]))},e.id))})})}function BB(){return(0,Z.jsx)(gt,{children:(0,Z.jsxs)(mt,{path:`/`,element:(0,Z.jsx)(wk,{}),children:[(0,Z.jsx)(mt,{index:!0,element:(0,Z.jsx)(PA,{})}),(0,Z.jsx)(mt,{path:`welcome`,element:(0,Z.jsx)(UA,{})}),(0,Z.jsx)(mt,{path:`workflow`,element:(0,Z.jsx)(WA,{})}),(0,Z.jsx)(mt,{path:`messages`,element:(0,Z.jsx)(mR,{})}),(0,Z.jsx)(mt,{path:`contacts`,element:(0,Z.jsx)(FB,{})}),(0,Z.jsx)(mt,{path:`invite/:blob`,element:(0,Z.jsx)(XR,{})}),(0,Z.jsx)(mt,{path:`overlay`,element:(0,Z.jsx)(QR,{})}),(0,Z.jsx)(mt,{path:`settings`,element:(0,Z.jsx)(EB,{})}),(0,Z.jsx)(mt,{path:`settings/profile`,element:(0,Z.jsx)(kB,{})}),(0,Z.jsx)(mt,{path:`settings/guest-profile`,element:(0,Z.jsx)(MB,{})}),(0,Z.jsx)(mt,{path:`*`,element:(0,Z.jsx)(ft,{to:`/`,replace:!0})})]})})}function VB(){return(0,Z.jsx)(Wy,{children:(0,Z.jsx)(Jy,{children:(0,Z.jsx)(Zy,{children:(0,Z.jsxs)(DP,{children:[(0,Z.jsx)(BB,{}),(0,Z.jsx)(zB,{})]})})})})}_.createRoot(document.getElementById(`root`)).render((0,Z.jsx)(y.StrictMode,{children:(0,Z.jsx)(Dt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:(0,Z.jsx)(VB,{})})}));export{Ss as $,Ka as $t,Jk as A,Si as An,Io as At,Ws as B,co as Bt,eA as C,Bi as Cn,Vo as Ct,Gk as D,Ei as Dn,zo as Dt,Qk as E,Di as En,Bo as Et,Uk as F,wo as Ft,zs as G,to as Gt,Us as H,io as Ht,zk as I,yo as It,Fs as J,Ya as Jt,Ls as K,eo as Kt,Rk as L,ho as Lt,Vk as M,Wt as Mn,Mo as Mt,Hk as N,N as Nn,jo as Nt,qk as O,Ti as On,Ro as Ot,Bk as P,Eo as Pt,xs as Q,qa as Qt,Ik as R,uo as Rt,tA as S,zi as Sn,Wo as St,$k as T,Fi as Tn,Ho as Tt,Bs as U,ro as Ut,Hs as V,so as Vt,Rs as W,no as Wt,Ds as X,$a as Xt,ks as Y,Xa as Yt,Os as Z,Qa as Zt,dA as _,ma as _n,$o as _t,kA as a,za as an,hs as at,pA as b,Vi as bn,Jo as bt,jA as c,Ia as cn,ds as ct,SA as d,Aa as dn,cs as dt,Ga as en,ws as et,CA as f,ya as fn,ss as ft,vA as g,z as gn,es as gt,yA as h,ga as hn,ns as ht,TA as i,Ba as in,_s as it,Wk as j,Pr as jn,No as jt,Kk as k,wi as kn,Lo as kt,AA as l,Na as ln,us as lt,_A as m,_a as mn,rs as mt,hN as n,Ua as nn,bs as nt,DA as o,Ra as on,ps as ot,bA as p,va as pn,os as pt,Is as q,Za as qt,_N as r,Ha as rn,ys as rt,EA as s,La as sn,fs as st,gN as t,Wa as tn,Ts as tt,OA as u,Ma as un,ls as ut,mA as v,pa as vn,Zo as vt,Zk as w,Ri as wn,Uo as wt,nA as x,Hi as xn,Go as xt,fA as y,fa as yn,Yo as yt,Lk as z,lo as zt};